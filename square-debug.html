<!DOCTYPE html>
<html>
<head>
    <title>Square API Debug</title>
    <style>
        body { background: #0a0814; color: #e2e2e2; font-family: monospace; padding: 20px; }
        .box { background: #1a1a1a; border: 1px solid #2c2c2c; padding: 15px; margin: 10px 0; border-radius: 6px; }
        button { background: #7c3aed; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #a78bfa; }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .warning { color: #eab308; }
        pre { background: #0d0d0d; padding: 10px; border-left: 2px solid #7c3aed; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Square API Diagnostic</h1>
    
    <div class="box">
        <h2>Status Check</h2>
        <button onclick="testSquareStatus()">Test /api/payments/status</button>
        <div id="status-result"></div>
    </div>

    <div class="box">
        <h2>Response Details</h2>
        <pre id="response-details">Click test button above...</pre>
    </div>

    <script>
        async function testSquareStatus() {
            const resultDiv = document.getElementById('status-result');
            const detailsDiv = document.getElementById('response-details');
            
            resultDiv.innerHTML = '<p>Testing...</p>';
            
            try {
                const response = await fetch('/api/payments/status');
                const json = await response.json();
                
                console.log('Response:', json);
                detailsDiv.textContent = JSON.stringify(json, null, 2);
                
                let html = '<div>';
                
                // Environment
                html += `<p>Environment: <strong>${json.env || 'unknown'}</strong></p>`;
                
                // Token status
                const tokenStatus = json.hasToken ? '<span class="success">âœ“ Present</span>' : '<span class="error">âœ— Missing</span>';
                html += `<p>Access Token: ${tokenStatus}</p>`;
                
                // Location ID
                const locationStatus = json.hasLocationId ? '<span class="success">âœ“ Present</span>' : '<span class="error">âœ— Missing</span>';
                html += `<p>Location ID: ${locationStatus}</p>`;
                
                // Client ready
                const clientStatus = json.clientReady ? '<span class="success">âœ“ Ready</span>' : '<span class="error">âœ— Not ready</span>';
                html += `<p>Client Ready: ${clientStatus}</p>`;
                
                // API test
                const apiStatus = json.apiOk ? '<span class="success">âœ“ API OK</span>' : '<span class="error">âœ— API Failed</span>';
                html += `<p>Square API: ${apiStatus}</p>`;
                
                // Details
                if (json.details) {
                    html += `<p class="warning">Details: ${json.details}</p>`;
                }
                
                // Error
                if (json.error) {
                    html += `<p class="error">Error: ${json.error}</p>`;
                }
                
                html += '</div>';
                resultDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Fetch error:', error);
                resultDiv.innerHTML = `<p class="error">Fetch failed: ${error.message}</p>`;
                detailsDiv.textContent = `Error: ${error.message}\n\n${error.stack}`;
            }
        }
        
        // Auto-test on load
        window.addEventListener('load', () => {
            testSquareStatus();
        });
    </script>
</body>
</html>
