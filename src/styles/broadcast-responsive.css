/* 
 * Broadcast Seats Responsive Layout
 * Fully responsive for all device sizes with PWA safe area support
 * 
 * Responsive Test Breakpoints:
 * - iPhone SE (320px): ~40px seats, 4px gap, 2-col grid
 * - iPhone 14/15 Pro (390px): ~52px seats, 6px gap, 2-3 col grid  
 * - Android midrange (360–412px): ~48–56px seats, 5–7px gap
 * - iPad portrait (768px): ~64px seats, 10px gap, 3-4 col grid
 * - iPad landscape (1024px): ~72px seats, 12px gap, wraps smoothly
 * - Desktop 1366–1920px: 72px seats, 14px gap, single row
 * - Ultrawide (>1920px): 72px seats, 14px gap, single row
 */

:root {
  /* Broadcast boxes container sizing */
  --boxSize: clamp(160px, 18vw, 240px);
  --boxGap: 14px;
  
  /* Responsive seat sizing with clamp() - small seats for overflow grid */
  --seatSize: clamp(40px, 9vw, 72px);
  --guestSeatSize: clamp(36px, 7.5vw, 64px);
  --seatGap: clamp(4px, 1.2vw, 14px);
  --hostBroadcasterSize: clamp(52px, 12vw, 100px);
  
  /* Safe area defaults (will be overridden by PWA notches/home bar) */
  --safe-left: env(safe-area-inset-left, 0);
  --safe-right: env(safe-area-inset-right, 0);
  --safe-top: env(safe-area-inset-top, 0);
  --safe-bottom: env(safe-area-inset-bottom, 0);
}

/* ================== FIXED GRID LAYOUT ================== */
/* Desktop/Tablet: 3-column fixed layout with center broadcaster */
.broadcast-fixed-grid {
  display: grid;
  grid-template-columns: minmax(140px, 200px) 1fr minmax(140px, 200px);
  grid-template-rows: repeat(3, 1fr);
  gap: 12px;
  width: 100%;
  height: auto;
  min-height: 400px;
  max-height: 70vh;
  align-items: stretch;
}

@media (max-width: 768px) {
  .broadcast-fixed-grid {
    grid-template-columns: minmax(90px, 120px) 1fr minmax(90px, 120px);
    gap: 8px;
    min-height: 300px;
    max-height: 60vh;
  }
}

/* Left column - 3 guest slots stacked */
.broadcast-left-column {
  display: grid;
  grid-template-rows: 1fr 1fr 1fr;
  gap: 12px;
  grid-row: 1 / 4;
}

@media (max-width: 768px) {
  .broadcast-left-column {
    gap: 8px;
  }
}

/* Right column - 3 guest slots stacked */
.broadcast-right-column {
  display: grid;
  grid-template-rows: 1fr 1fr 1fr;
  gap: 12px;
  grid-row: 1 / 4;
}

@media (max-width: 768px) {
  .broadcast-right-column {
    gap: 8px;
  }
}

/* Center broadcaster slot - spans all 3 rows */
.broadcast-center-slot {
  position: relative;
  grid-row: 1 / 4;
  width: 100%;
  height: 100%;
  border-radius: 16px;
  overflow: hidden;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

@media (max-width: 768px) {
  .broadcast-center-slot {
    border-radius: 12px;
  }
}

/* Guest slot styling */
.broadcast-guest-slot {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 12px;
  overflow: hidden;
  background: rgba(26, 11, 46, 0.5);
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
  transition: background 200ms ease, border-color 200ms ease;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

@media (max-width: 768px) {
  .broadcast-guest-slot {
    border-radius: 8px;
  }
}

.broadcast-guest-slot:hover {
  background: rgba(26, 11, 46, 0.7);
}

/* Video tiles fill their containers */
.broadcast-center-slot video,
.broadcast-guest-slot video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ================== LEGACY SUPPORT ================== */

/* Broadcast Container with PWA Safe Areas */
.broadcast-seats-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: auto;
  min-height: 0;
  gap: var(--seatGap);
  /* Respect PWA safe areas (notches, home bar, action bar on Android) */
  padding-left: max(8px, var(--safe-left));
  padding-right: max(8px, var(--safe-right));
  padding-top: max(8px, var(--safe-top));
  padding-bottom: max(8px, var(--safe-bottom));
  /* Allow content to expand naturally */
  overflow: visible;
}

/* Responsive padding adjustments for viewports */
@media (min-width: 640px) {
  .broadcast-seats-container {
    padding-left: max(12px, var(--safe-left));
    padding-right: max(12px, var(--safe-right));
  }
}

@media (min-width: 1024px) {
  .broadcast-seats-container {
    padding-left: max(16px, var(--safe-left));
    padding-right: max(16px, var(--safe-right));
  }
}

/* Broadcaster Box - Dynamic grid container */
.broadcast-boxes-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: var(--boxGap);
  align-content: start;
  width: 100%;
  height: auto;
  /* Allow container to grow/shrink with content */
  overflow: visible;
}

/* Broadcaster Tile - Always maintains aspect ratio 1:1 */
.broadcast-tile {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  min-width: 160px;
  max-width: 240px;
  border-radius: clamp(8px, 2vw, 16px);
  overflow: hidden;
  background: rgba(0, 0, 0, 0.4);
  /* Center and contain content */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Guest Seats Grid Container - Dynamic sizing */
.guest-seats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: var(--boxGap);
  width: 100%;
  height: auto;
  align-content: start;
  /* Allow container to grow/shrink with number of items */
  overflow: visible;
}

/* Individual Guest Seat - Uniform responsive sizing */
.guest-seat {
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;
  min-width: 160px;
  max-width: 240px;
  border-radius: 8px;
  overflow: hidden;
  background: rgba(26, 11, 46, 0.5);
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
  transition: background 200ms ease, border-color 200ms ease;
  /* Center and contain content */
  display: flex;
  align-items: center;
  justify-content: center;
}

.guest-seat:hover {
  background: rgba(26, 11, 46, 0.7);
}

/* Video Tile within seats - fills parent */
.seat-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Mobile-specific: Traditional grid layout with responsive sizing */
@media (max-width: 480px) {
  .broadcast-seats-container {
    /* Minimal padding on mobile for max content width */
    padding: 6px;
    gap: 6px;
  }
  
  /* Force 3-column grid on mobile to match screenshot layout */
  .w-full.h-auto.grid.auto-rows-max {
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 6px !important;
  }
  
  /* Adjust box sizing for mobile */
  .w-full.h-auto.grid.auto-rows-max > div {
    min-width: 90px !important;
    max-width: none !important;
  }
}

/* Tablet: Optimize for 3-4 items per row */
@media (min-width: 481px) and (max-width: 1024px) {
  .broadcast-boxes-container,
  .guest-seats-grid {
    /* Balanced layout for tablet */
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
  }
}

/* Desktop: Allow 4+ items per row */
@media (min-width: 1025px) {
  .broadcast-boxes-container,
  .guest-seats-grid {
    /* Desktop layout - can fit more boxes per row */
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
  }
}

/* Frame Styles - Maintain proportions at all sizes */
.frame-rgb,
.frame-default {
  box-sizing: border-box;
  transition: all 200ms ease;
}

/* Hit target minimum (44px on touch devices) */
@media (hover: none) and (pointer: coarse) {
  .guest-seat {
    min-height: max(44px, var(--guestSeatSize));
    min-width: max(44px, var(--guestSeatSize));
  }
  
  .broadcast-tile {
    min-height: max(44px, var(--hostBroadcasterSize));
    min-width: max(44px, var(--hostBroadcasterSize));
  }
}

/* Prevent overflow on ultra-wide displays */
@media (min-width: 1920px) {
  :root {
    --hostBroadcasterSize: 100px;
    --guestSeatSize: 64px;
    --seatGap: 14px;
  }
}

/* Ultra-small phones (390px and below) - iPhone SE, older models */
@media (max-width: 390px) {
  .broadcast-seats-container {
    padding-left: max(2px, var(--safe-left));
    padding-right: max(2px, var(--safe-right));
    gap: 4px;
  }
  
  .broadcast-boxes-container,
  .guest-seats-grid {
    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)) !important;
    gap: 6px;  /* Minimal gap */
  }
  
  .broadcast-tile,
  .guest-seat {
    min-width: 110px !important;
    max-width: 130px !important;
    border-radius: 4px;  /* Minimal radius */
  }
}

/* Prevent overflow on very small screens */
@media (max-width: 320px) {
  :root {
    --hostBroadcasterSize: clamp(44px, 11vw, 52px);
    --guestSeatSize: clamp(36px, 9vw, 44px);
    --seatGap: clamp(2px, 0.8vw, 4px);
  }
  
  .broadcast-boxes-container,
  .guest-seats-grid {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
  }
  
  .broadcast-tile,
  .guest-seat {
    min-width: 100px !important;
    max-width: 120px !important;
  }
}

/* ================== MOBILE ACTION BUTTONS ================== */

/* Mobile action button row - always visible and accessible */
.mobile-action-row {
  display: flex;
  gap: 6px;
  padding: max(4px, env(safe-area-inset-left)) max(4px, env(safe-area-inset-right)) 4px;
  overflow-x: auto;
  overflow-y: hidden;
  background: linear-gradient(135deg, rgba(20, 8, 40, 0.8), rgba(30, 12, 50, 0.8));
  border-bottom: 1px solid rgba(147, 51, 234, 0.2);
  width: 100%;
  align-items: center;
  flex-wrap: nowrap;
  white-space: nowrap;
}

.mobile-action-row::-webkit-scrollbar {
  height: 2px;
}

.mobile-action-row::-webkit-scrollbar-track {
  background: transparent;
}

.mobile-action-row::-webkit-scrollbar-thumb {
  background: rgba(147, 51, 234, 0.3);
  border-radius: 1px;
}

/* Action button - compact size for mobile */
.action-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 6px 10px;
  min-height: 36px;
  min-width: 36px;
  border-radius: 6px;
  border: 1px solid rgba(147, 51, 234, 0.3);
  background: linear-gradient(135deg, rgba(147, 51, 234, 0.15), rgba(88, 28, 135, 0.1));
  color: #c4b5fd;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 200ms ease;
  flex-shrink: 0;
  box-shadow: 0 4px 12px rgba(147, 51, 234, 0.15);
}

.action-button:active {
  background: linear-gradient(135deg, rgba(147, 51, 234, 0.3), rgba(88, 28, 135, 0.2));
  box-shadow: 0 0 12px rgba(147, 51, 234, 0.4);
  transform: scale(0.95);
}

.action-button:hover:not(:active) {
  border-color: rgba(147, 51, 234, 0.6);
  background: linear-gradient(135deg, rgba(147, 51, 234, 0.25), rgba(88, 28, 135, 0.15));
  box-shadow: 0 6px 16px rgba(147, 51, 234, 0.25);
}

/* Primary action button (Gift) - more prominent */
.action-button.primary {
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.4), rgba(147, 51, 234, 0.3));
  border-color: rgba(168, 85, 247, 0.6);
  color: #fbbf24;
  font-weight: 700;
  box-shadow: 0 4px 16px rgba(147, 51, 234, 0.3);
}

.action-button.primary:active {
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.6), rgba(147, 51, 234, 0.5));
  box-shadow: 0 0 16px rgba(251, 191, 36, 0.5), 0 0 12px rgba(147, 51, 234, 0.6);
}

.action-button.primary:hover:not(:active) {
  border-color: rgba(168, 85, 247, 0.8);
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.5), rgba(147, 51, 234, 0.4));
  box-shadow: 0 6px 20px rgba(147, 51, 234, 0.4);
}

/* Icon in action button */
.action-button svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

/* ================== MAIN CONTENT RESPONSIVE FIXES ================== */

/* Main content container - prevent overlap */
.live-main-content {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  gap: clamp(4px, 1.5vw, 8px);
  padding: clamp(4px, 1.5vw, 8px);
  overflow-y: auto;
  overflow-x: hidden;
}

/* Mobile: Stack action buttons above broadcast grid */
@media (max-width: 1024px) {
  .live-main-content {
    padding-bottom: 2px;
  }
  
  .mobile-action-row {
    order: -1;  /* Place above broadcast grid */
  }
}

/* Video cover area - no overlap with header */
.video-cover {
  min-height: 0;
  flex: 1;
  position: relative;
  overflow: hidden;
}

/* Broadcast grid wrapper - prevent scrolling issues */
.broadcast-grid-wrapper {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: auto;
  min-height: 0;
  overflow: visible;
  position: relative;
  z-index: 1;
}

/* ================== SAFE AREA & NOTCH HANDLING ================== */

/* Ensure safe areas respected in flex containers */
.safe-area-start {
  padding-left: max(0px, env(safe-area-inset-left));
  padding-right: max(0px, env(safe-area-inset-right));
  padding-top: max(0px, env(safe-area-inset-top));
}

.safe-area-end {
  padding-bottom: max(0px, env(safe-area-inset-bottom));
}

/* Mobile: Ensure controls visible above bottom nav */
@media (max-width: 768px) {
  .mobile-action-row {
    position: relative;
    z-index: 40;
  }
}

/* ================== ANIMATIONS ================== */

/* RGB rotating border animation */
@keyframes rgb-rotate {
  0% {
    border-color: rgb(255, 0, 0);
  }
  16.67% {
    border-color: rgb(255, 255, 0);
  }
  33.33% {
    border-color: rgb(0, 255, 0);
  }
  50% {
    border-color: rgb(0, 255, 255);
  }
  66.67% {
    border-color: rgb(0, 0, 255);
  }
  83.33% {
    border-color: rgb(255, 0, 255);
  }
  100% {
    border-color: rgb(255, 0, 0);
  }
}

.rgb-frame {
  border: 2px solid rgb(255, 0, 0);
  animation: rgb-rotate 3s linear infinite;
  box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
}

.rgb-frame-small {
  border: 1px solid rgb(255, 0, 0);
  animation: rgb-rotate 3s linear infinite;
  box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
}
