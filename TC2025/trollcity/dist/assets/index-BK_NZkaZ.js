var L8=i=>{throw TypeError(i)};var ek=(i,n,a)=>n.has(i)||L8("Cannot "+a);var Re=(i,n,a)=>(ek(i,n,"read from private field"),a?a.call(i):n.get(i)),cr=(i,n,a)=>n.has(i)?L8("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(i):n.set(i,a),Bt=(i,n,a,l)=>(ek(i,n,"write to private field"),l?l.call(i,a):n.set(i,a),a),Jr=(i,n,a)=>(ek(i,n,"access private method"),a);var _C=(i,n,a,l)=>({set _(u){Bt(i,n,u,a)},get _(){return Re(i,n,l)}});function $G(i,n){for(var a=0;a<n.length;a++){const l=n[a];if(typeof l!="string"&&!Array.isArray(l)){for(const u in l)if(u!=="default"&&!(u in i)){const m=Object.getOwnPropertyDescriptor(l,u);m&&Object.defineProperty(i,u,m.get?m:{enumerable:!0,get:()=>l[u]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))l(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const y of m.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&l(y)}).observe(document,{childList:!0,subtree:!0});function a(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(u){if(u.ep)return;u.ep=!0;const m=a(u);fetch(u.href,m)}})();var tk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qw(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Bie(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var n=i.default;if(typeof n=="function"){var a=function l(){return this instanceof l?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(i).forEach(function(l){var u=Object.getOwnPropertyDescriptor(i,l);Object.defineProperty(a,l,u.get?u:{enumerable:!0,get:function(){return i[l]}})}),a}var rk={exports:{}},nw={},nk={exports:{}},sn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M8;function Wie(){if(M8)return sn;M8=1;var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),y=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),N=Symbol.iterator;function O(fe){return fe===null||typeof fe!="object"?null:(fe=N&&fe[N]||fe["@@iterator"],typeof fe=="function"?fe:null)}var P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F=Object.assign,z={};function V(fe,De,je){this.props=fe,this.context=De,this.refs=z,this.updater=je||P}V.prototype.isReactComponent={},V.prototype.setState=function(fe,De){if(typeof fe!="object"&&typeof fe!="function"&&fe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,fe,De,"setState")},V.prototype.forceUpdate=function(fe){this.updater.enqueueForceUpdate(this,fe,"forceUpdate")};function W(){}W.prototype=V.prototype;function te(fe,De,je){this.props=fe,this.context=De,this.refs=z,this.updater=je||P}var $=te.prototype=new W;$.constructor=te,F($,V.prototype),$.isPureReactComponent=!0;var Q=Array.isArray,G=Object.prototype.hasOwnProperty,se={current:null},ie={key:!0,ref:!0,__self:!0,__source:!0};function ce(fe,De,je){var _e,Je={},st=null,vt=null;if(De!=null)for(_e in De.ref!==void 0&&(vt=De.ref),De.key!==void 0&&(st=""+De.key),De)G.call(De,_e)&&!ie.hasOwnProperty(_e)&&(Je[_e]=De[_e]);var pt=arguments.length-2;if(pt===1)Je.children=je;else if(1<pt){for(var er=Array(pt),gt=0;gt<pt;gt++)er[gt]=arguments[gt+2];Je.children=er}if(fe&&fe.defaultProps)for(_e in pt=fe.defaultProps,pt)Je[_e]===void 0&&(Je[_e]=pt[_e]);return{$$typeof:i,type:fe,key:st,ref:vt,props:Je,_owner:se.current}}function Se(fe,De){return{$$typeof:i,type:fe.type,key:De,ref:fe.ref,props:fe.props,_owner:fe._owner}}function oe(fe){return typeof fe=="object"&&fe!==null&&fe.$$typeof===i}function ve(fe){var De={"=":"=0",":":"=2"};return"$"+fe.replace(/[=:]/g,function(je){return De[je]})}var he=/\/+/g;function Ze(fe,De){return typeof fe=="object"&&fe!==null&&fe.key!=null?ve(""+fe.key):De.toString(36)}function Qe(fe,De,je,_e,Je){var st=typeof fe;(st==="undefined"||st==="boolean")&&(fe=null);var vt=!1;if(fe===null)vt=!0;else switch(st){case"string":case"number":vt=!0;break;case"object":switch(fe.$$typeof){case i:case n:vt=!0}}if(vt)return vt=fe,Je=Je(vt),fe=_e===""?"."+Ze(vt,0):_e,Q(Je)?(je="",fe!=null&&(je=fe.replace(he,"$&/")+"/"),Qe(Je,De,je,"",function(gt){return gt})):Je!=null&&(oe(Je)&&(Je=Se(Je,je+(!Je.key||vt&&vt.key===Je.key?"":(""+Je.key).replace(he,"$&/")+"/")+fe)),De.push(Je)),1;if(vt=0,_e=_e===""?".":_e+":",Q(fe))for(var pt=0;pt<fe.length;pt++){st=fe[pt];var er=_e+Ze(st,pt);vt+=Qe(st,De,je,er,Je)}else if(er=O(fe),typeof er=="function")for(fe=er.call(fe),pt=0;!(st=fe.next()).done;)st=st.value,er=_e+Ze(st,pt++),vt+=Qe(st,De,je,er,Je);else if(st==="object")throw De=String(fe),Error("Objects are not valid as a React child (found: "+(De==="[object Object]"?"object with keys {"+Object.keys(fe).join(", ")+"}":De)+"). If you meant to render a collection of children, use an array instead.");return vt}function me(fe,De,je){if(fe==null)return fe;var _e=[],Je=0;return Qe(fe,_e,"","",function(st){return De.call(je,st,Je++)}),_e}function ye(fe){if(fe._status===-1){var De=fe._result;De=De(),De.then(function(je){(fe._status===0||fe._status===-1)&&(fe._status=1,fe._result=je)},function(je){(fe._status===0||fe._status===-1)&&(fe._status=2,fe._result=je)}),fe._status===-1&&(fe._status=0,fe._result=De)}if(fe._status===1)return fe._result.default;throw fe._result}var ge={current:null},Ee={transition:null},Oe={ReactCurrentDispatcher:ge,ReactCurrentBatchConfig:Ee,ReactCurrentOwner:se};function we(){throw Error("act(...) is not supported in production builds of React.")}return sn.Children={map:me,forEach:function(fe,De,je){me(fe,function(){De.apply(this,arguments)},je)},count:function(fe){var De=0;return me(fe,function(){De++}),De},toArray:function(fe){return me(fe,function(De){return De})||[]},only:function(fe){if(!oe(fe))throw Error("React.Children.only expected to receive a single React element child.");return fe}},sn.Component=V,sn.Fragment=a,sn.Profiler=u,sn.PureComponent=te,sn.StrictMode=l,sn.Suspense=b,sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Oe,sn.act=we,sn.cloneElement=function(fe,De,je){if(fe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+fe+".");var _e=F({},fe.props),Je=fe.key,st=fe.ref,vt=fe._owner;if(De!=null){if(De.ref!==void 0&&(st=De.ref,vt=se.current),De.key!==void 0&&(Je=""+De.key),fe.type&&fe.type.defaultProps)var pt=fe.type.defaultProps;for(er in De)G.call(De,er)&&!ie.hasOwnProperty(er)&&(_e[er]=De[er]===void 0&&pt!==void 0?pt[er]:De[er])}var er=arguments.length-2;if(er===1)_e.children=je;else if(1<er){pt=Array(er);for(var gt=0;gt<er;gt++)pt[gt]=arguments[gt+2];_e.children=pt}return{$$typeof:i,type:fe.type,key:Je,ref:st,props:_e,_owner:vt}},sn.createContext=function(fe){return fe={$$typeof:y,_currentValue:fe,_currentValue2:fe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},fe.Provider={$$typeof:m,_context:fe},fe.Consumer=fe},sn.createElement=ce,sn.createFactory=function(fe){var De=ce.bind(null,fe);return De.type=fe,De},sn.createRef=function(){return{current:null}},sn.forwardRef=function(fe){return{$$typeof:w,render:fe}},sn.isValidElement=oe,sn.lazy=function(fe){return{$$typeof:T,_payload:{_status:-1,_result:fe},_init:ye}},sn.memo=function(fe,De){return{$$typeof:x,type:fe,compare:De===void 0?null:De}},sn.startTransition=function(fe){var De=Ee.transition;Ee.transition={};try{fe()}finally{Ee.transition=De}},sn.unstable_act=we,sn.useCallback=function(fe,De){return ge.current.useCallback(fe,De)},sn.useContext=function(fe){return ge.current.useContext(fe)},sn.useDebugValue=function(){},sn.useDeferredValue=function(fe){return ge.current.useDeferredValue(fe)},sn.useEffect=function(fe,De){return ge.current.useEffect(fe,De)},sn.useId=function(){return ge.current.useId()},sn.useImperativeHandle=function(fe,De,je){return ge.current.useImperativeHandle(fe,De,je)},sn.useInsertionEffect=function(fe,De){return ge.current.useInsertionEffect(fe,De)},sn.useLayoutEffect=function(fe,De){return ge.current.useLayoutEffect(fe,De)},sn.useMemo=function(fe,De){return ge.current.useMemo(fe,De)},sn.useReducer=function(fe,De,je){return ge.current.useReducer(fe,De,je)},sn.useRef=function(fe){return ge.current.useRef(fe)},sn.useState=function(fe){return ge.current.useState(fe)},sn.useSyncExternalStore=function(fe,De,je){return ge.current.useSyncExternalStore(fe,De,je)},sn.useTransition=function(){return ge.current.useTransition()},sn.version="18.3.1",sn}var U8;function dD(){return U8||(U8=1,nk.exports=Wie()),nk.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F8;function qie(){if(F8)return nw;F8=1;var i=dD(),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,u=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m={key:!0,ref:!0,__self:!0,__source:!0};function y(w,b,x){var T,N={},O=null,P=null;x!==void 0&&(O=""+x),b.key!==void 0&&(O=""+b.key),b.ref!==void 0&&(P=b.ref);for(T in b)l.call(b,T)&&!m.hasOwnProperty(T)&&(N[T]=b[T]);if(w&&w.defaultProps)for(T in b=w.defaultProps,b)N[T]===void 0&&(N[T]=b[T]);return{$$typeof:n,type:w,key:O,ref:P,props:N,_owner:u.current}}return nw.Fragment=a,nw.jsx=y,nw.jsxs=y,nw}var V8;function Gie(){return V8||(V8=1,rk.exports=qie()),rk.exports}var o=Gie(),M=dD();const ut=Qw(M),YG=$G({__proto__:null,default:ut},[M]);var yC={},sk={exports:{}},to={},ik={exports:{}},ak={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B8;function Hie(){return B8||(B8=1,(function(i){function n(Ee,Oe){var we=Ee.length;Ee.push(Oe);e:for(;0<we;){var fe=we-1>>>1,De=Ee[fe];if(0<u(De,Oe))Ee[fe]=Oe,Ee[we]=De,we=fe;else break e}}function a(Ee){return Ee.length===0?null:Ee[0]}function l(Ee){if(Ee.length===0)return null;var Oe=Ee[0],we=Ee.pop();if(we!==Oe){Ee[0]=we;e:for(var fe=0,De=Ee.length,je=De>>>1;fe<je;){var _e=2*(fe+1)-1,Je=Ee[_e],st=_e+1,vt=Ee[st];if(0>u(Je,we))st<De&&0>u(vt,Je)?(Ee[fe]=vt,Ee[st]=we,fe=st):(Ee[fe]=Je,Ee[_e]=we,fe=_e);else if(st<De&&0>u(vt,we))Ee[fe]=vt,Ee[st]=we,fe=st;else break e}}return Oe}function u(Ee,Oe){var we=Ee.sortIndex-Oe.sortIndex;return we!==0?we:Ee.id-Oe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;i.unstable_now=function(){return m.now()}}else{var y=Date,w=y.now();i.unstable_now=function(){return y.now()-w}}var b=[],x=[],T=1,N=null,O=3,P=!1,F=!1,z=!1,V=typeof setTimeout=="function"?setTimeout:null,W=typeof clearTimeout=="function"?clearTimeout:null,te=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(Ee){for(var Oe=a(x);Oe!==null;){if(Oe.callback===null)l(x);else if(Oe.startTime<=Ee)l(x),Oe.sortIndex=Oe.expirationTime,n(b,Oe);else break;Oe=a(x)}}function Q(Ee){if(z=!1,$(Ee),!F)if(a(b)!==null)F=!0,ye(G);else{var Oe=a(x);Oe!==null&&ge(Q,Oe.startTime-Ee)}}function G(Ee,Oe){F=!1,z&&(z=!1,W(ce),ce=-1),P=!0;var we=O;try{for($(Oe),N=a(b);N!==null&&(!(N.expirationTime>Oe)||Ee&&!ve());){var fe=N.callback;if(typeof fe=="function"){N.callback=null,O=N.priorityLevel;var De=fe(N.expirationTime<=Oe);Oe=i.unstable_now(),typeof De=="function"?N.callback=De:N===a(b)&&l(b),$(Oe)}else l(b);N=a(b)}if(N!==null)var je=!0;else{var _e=a(x);_e!==null&&ge(Q,_e.startTime-Oe),je=!1}return je}finally{N=null,O=we,P=!1}}var se=!1,ie=null,ce=-1,Se=5,oe=-1;function ve(){return!(i.unstable_now()-oe<Se)}function he(){if(ie!==null){var Ee=i.unstable_now();oe=Ee;var Oe=!0;try{Oe=ie(!0,Ee)}finally{Oe?Ze():(se=!1,ie=null)}}else se=!1}var Ze;if(typeof te=="function")Ze=function(){te(he)};else if(typeof MessageChannel<"u"){var Qe=new MessageChannel,me=Qe.port2;Qe.port1.onmessage=he,Ze=function(){me.postMessage(null)}}else Ze=function(){V(he,0)};function ye(Ee){ie=Ee,se||(se=!0,Ze())}function ge(Ee,Oe){ce=V(function(){Ee(i.unstable_now())},Oe)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ee){Ee.callback=null},i.unstable_continueExecution=function(){F||P||(F=!0,ye(G))},i.unstable_forceFrameRate=function(Ee){0>Ee||125<Ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Se=0<Ee?Math.floor(1e3/Ee):5},i.unstable_getCurrentPriorityLevel=function(){return O},i.unstable_getFirstCallbackNode=function(){return a(b)},i.unstable_next=function(Ee){switch(O){case 1:case 2:case 3:var Oe=3;break;default:Oe=O}var we=O;O=Oe;try{return Ee()}finally{O=we}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ee,Oe){switch(Ee){case 1:case 2:case 3:case 4:case 5:break;default:Ee=3}var we=O;O=Ee;try{return Oe()}finally{O=we}},i.unstable_scheduleCallback=function(Ee,Oe,we){var fe=i.unstable_now();switch(typeof we=="object"&&we!==null?(we=we.delay,we=typeof we=="number"&&0<we?fe+we:fe):we=fe,Ee){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=we+De,Ee={id:T++,callback:Oe,priorityLevel:Ee,startTime:we,expirationTime:De,sortIndex:-1},we>fe?(Ee.sortIndex=we,n(x,Ee),a(b)===null&&Ee===a(x)&&(z?(W(ce),ce=-1):z=!0,ge(Q,we-fe))):(Ee.sortIndex=De,n(b,Ee),F||P||(F=!0,ye(G))),Ee},i.unstable_shouldYield=ve,i.unstable_wrapCallback=function(Ee){var Oe=O;return function(){var we=O;O=Oe;try{return Ee.apply(this,arguments)}finally{O=we}}}})(ak)),ak}var W8;function Kie(){return W8||(W8=1,ik.exports=Hie()),ik.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q8;function zie(){if(q8)return to;q8=1;var i=dD(),n=Kie();function a(p){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+p,S=1;S<arguments.length;S++)_+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+p+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=new Set,u={};function m(p,_){y(p,_),y(p+"Capture",_)}function y(p,_){for(u[p]=_,p=0;p<_.length;p++)l.add(_[p])}var w=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),b=Object.prototype.hasOwnProperty,x=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,T={},N={};function O(p){return b.call(N,p)?!0:b.call(T,p)?!1:x.test(p)?N[p]=!0:(T[p]=!0,!1)}function P(p,_,S,I){if(S!==null&&S.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return I?!1:S!==null?!S.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function F(p,_,S,I){if(_===null||typeof _>"u"||P(p,_,S,I))return!0;if(I)return!1;if(S!==null)switch(S.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function z(p,_,S,I,j,q,ae){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=I,this.attributeNamespace=j,this.mustUseProperty=S,this.propertyName=p,this.type=_,this.sanitizeURL=q,this.removeEmptyString=ae}var V={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){V[p]=new z(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var _=p[0];V[_]=new z(_,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){V[p]=new z(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){V[p]=new z(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){V[p]=new z(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){V[p]=new z(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){V[p]=new z(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){V[p]=new z(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){V[p]=new z(p,5,!1,p.toLowerCase(),null,!1,!1)});var W=/[\-:]([a-z])/g;function te(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var _=p.replace(W,te);V[_]=new z(_,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var _=p.replace(W,te);V[_]=new z(_,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var _=p.replace(W,te);V[_]=new z(_,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){V[p]=new z(p,1,!1,p.toLowerCase(),null,!1,!1)}),V.xlinkHref=new z("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){V[p]=new z(p,1,!1,p.toLowerCase(),null,!0,!0)});function $(p,_,S,I){var j=V.hasOwnProperty(_)?V[_]:null;(j!==null?j.type!==0:I||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(F(_,S,j,I)&&(S=null),I||j===null?O(_)&&(S===null?p.removeAttribute(_):p.setAttribute(_,""+S)):j.mustUseProperty?p[j.propertyName]=S===null?j.type===3?!1:"":S:(_=j.attributeName,I=j.attributeNamespace,S===null?p.removeAttribute(_):(j=j.type,S=j===3||j===4&&S===!0?"":""+S,I?p.setAttributeNS(I,_,S):p.setAttribute(_,S))))}var Q=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,G=Symbol.for("react.element"),se=Symbol.for("react.portal"),ie=Symbol.for("react.fragment"),ce=Symbol.for("react.strict_mode"),Se=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),ve=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),Ze=Symbol.for("react.suspense"),Qe=Symbol.for("react.suspense_list"),me=Symbol.for("react.memo"),ye=Symbol.for("react.lazy"),ge=Symbol.for("react.offscreen"),Ee=Symbol.iterator;function Oe(p){return p===null||typeof p!="object"?null:(p=Ee&&p[Ee]||p["@@iterator"],typeof p=="function"?p:null)}var we=Object.assign,fe;function De(p){if(fe===void 0)try{throw Error()}catch(S){var _=S.stack.trim().match(/\n( *(at )?)/);fe=_&&_[1]||""}return`
`+fe+p}var je=!1;function _e(p,_){if(!p||je)return"";je=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(et){var I=et}Reflect.construct(p,[],_)}else{try{_.call()}catch(et){I=et}p.call(_.prototype)}else{try{throw Error()}catch(et){I=et}p()}}catch(et){if(et&&I&&typeof et.stack=="string"){for(var j=et.stack.split(`
`),q=I.stack.split(`
`),ae=j.length-1,Te=q.length-1;1<=ae&&0<=Te&&j[ae]!==q[Te];)Te--;for(;1<=ae&&0<=Te;ae--,Te--)if(j[ae]!==q[Te]){if(ae!==1||Te!==1)do if(ae--,Te--,0>Te||j[ae]!==q[Te]){var Ie=`
`+j[ae].replace(" at new "," at ");return p.displayName&&Ie.includes("<anonymous>")&&(Ie=Ie.replace("<anonymous>",p.displayName)),Ie}while(1<=ae&&0<=Te);break}}}finally{je=!1,Error.prepareStackTrace=S}return(p=p?p.displayName||p.name:"")?De(p):""}function Je(p){switch(p.tag){case 5:return De(p.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return p=_e(p.type,!1),p;case 11:return p=_e(p.type.render,!1),p;case 1:return p=_e(p.type,!0),p;default:return""}}function st(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case ie:return"Fragment";case se:return"Portal";case Se:return"Profiler";case ce:return"StrictMode";case Ze:return"Suspense";case Qe:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case ve:return(p.displayName||"Context")+".Consumer";case oe:return(p._context.displayName||"Context")+".Provider";case he:var _=p.render;return p=p.displayName,p||(p=_.displayName||_.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case me:return _=p.displayName||null,_!==null?_:st(p.type)||"Memo";case ye:_=p._payload,p=p._init;try{return st(p(_))}catch{}}return null}function vt(p){var _=p.type;switch(p.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=_.render,p=p.displayName||p.name||"",_.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return st(_);case 8:return _===ce?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function pt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function er(p){var _=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function gt(p){var _=er(p)?"checked":"value",S=Object.getOwnPropertyDescriptor(p.constructor.prototype,_),I=""+p[_];if(!p.hasOwnProperty(_)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var j=S.get,q=S.set;return Object.defineProperty(p,_,{configurable:!0,get:function(){return j.call(this)},set:function(ae){I=""+ae,q.call(this,ae)}}),Object.defineProperty(p,_,{enumerable:S.enumerable}),{getValue:function(){return I},setValue:function(ae){I=""+ae},stopTracking:function(){p._valueTracker=null,delete p[_]}}}}function qe(p){p._valueTracker||(p._valueTracker=gt(p))}function Wr(p){if(!p)return!1;var _=p._valueTracker;if(!_)return!0;var S=_.getValue(),I="";return p&&(I=er(p)?p.checked?"true":"false":p.value),p=I,p!==S?(_.setValue(p),!0):!1}function en(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Cn(p,_){var S=_.checked;return we({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??p._wrapperState.initialChecked})}function Lr(p,_){var S=_.defaultValue==null?"":_.defaultValue,I=_.checked!=null?_.checked:_.defaultChecked;S=pt(_.value!=null?_.value:S),p._wrapperState={initialChecked:I,initialValue:S,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function Le(p,_){_=_.checked,_!=null&&$(p,"checked",_,!1)}function it(p,_){Le(p,_);var S=pt(_.value),I=_.type;if(S!=null)I==="number"?(S===0&&p.value===""||p.value!=S)&&(p.value=""+S):p.value!==""+S&&(p.value=""+S);else if(I==="submit"||I==="reset"){p.removeAttribute("value");return}_.hasOwnProperty("value")?xt(p,_.type,S):_.hasOwnProperty("defaultValue")&&xt(p,_.type,pt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(p.defaultChecked=!!_.defaultChecked)}function jt(p,_,S){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var I=_.type;if(!(I!=="submit"&&I!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+p._wrapperState.initialValue,S||_===p.value||(p.value=_),p.defaultValue=_}S=p.name,S!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,S!==""&&(p.name=S)}function xt(p,_,S){(_!=="number"||en(p.ownerDocument)!==p)&&(S==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+S&&(p.defaultValue=""+S))}var Tr=Array.isArray;function An(p,_,S,I){if(p=p.options,_){_={};for(var j=0;j<S.length;j++)_["$"+S[j]]=!0;for(S=0;S<p.length;S++)j=_.hasOwnProperty("$"+p[S].value),p[S].selected!==j&&(p[S].selected=j),j&&I&&(p[S].defaultSelected=!0)}else{for(S=""+pt(S),_=null,j=0;j<p.length;j++){if(p[j].value===S){p[j].selected=!0,I&&(p[j].defaultSelected=!0);return}_!==null||p[j].disabled||(_=p[j])}_!==null&&(_.selected=!0)}}function En(p,_){if(_.dangerouslySetInnerHTML!=null)throw Error(a(91));return we({},_,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function on(p,_){var S=_.value;if(S==null){if(S=_.children,_=_.defaultValue,S!=null){if(_!=null)throw Error(a(92));if(Tr(S)){if(1<S.length)throw Error(a(93));S=S[0]}_=S}_==null&&(_=""),S=_}p._wrapperState={initialValue:pt(S)}}function Sr(p,_){var S=pt(_.value),I=pt(_.defaultValue);S!=null&&(S=""+S,S!==p.value&&(p.value=S),_.defaultValue==null&&p.defaultValue!==S&&(p.defaultValue=S)),I!=null&&(p.defaultValue=""+I)}function js(p){var _=p.textContent;_===p._wrapperState.initialValue&&_!==""&&_!==null&&(p.value=_)}function ts(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _t(p,_){return p==null||p==="http://www.w3.org/1999/xhtml"?ts(_):p==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var wr,Ur=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,S,I,j){MSApp.execUnsafeLocalFunction(function(){return p(_,S,I,j)})}:p})(function(p,_){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=_;else{for(wr=wr||document.createElement("div"),wr.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=wr.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;_.firstChild;)p.appendChild(_.firstChild)}});function dn(p,_){if(_){var S=p.firstChild;if(S&&S===p.lastChild&&S.nodeType===3){S.nodeValue=_;return}}p.textContent=_}var bs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},di=["Webkit","ms","Moz","O"];Object.keys(bs).forEach(function(p){di.forEach(function(_){_=_+p.charAt(0).toUpperCase()+p.substring(1),bs[_]=bs[p]})});function Be(p,_,S){return _==null||typeof _=="boolean"||_===""?"":S||typeof _!="number"||_===0||bs.hasOwnProperty(p)&&bs[p]?(""+_).trim():_+"px"}function tt(p,_){p=p.style;for(var S in _)if(_.hasOwnProperty(S)){var I=S.indexOf("--")===0,j=Be(S,_[S],I);S==="float"&&(S="cssFloat"),I?p.setProperty(S,j):p[S]=j}}var bt=we({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ct(p,_){if(_){if(bt[p]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(a(137,p));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(a(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(a(61))}if(_.style!=null&&typeof _.style!="object")throw Error(a(62))}}function Pt(p,_){if(p.indexOf("-")===-1)return typeof _.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ot=null;function tr(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Vo=null,Da=null,ma=null;function Dc(p){if(p=Wp(p)){if(typeof Vo!="function")throw Error(a(280));var _=p.stateNode;_&&(_=og(_),Vo(p.stateNode,p.type,_))}}function ar(p){Da?ma?ma.push(p):ma=[p]:Da=p}function kn(){if(Da){var p=Da,_=ma;if(ma=Da=null,Dc(p),_)for(p=0;p<_.length;p++)Dc(_[p])}}function qn(p,_){return p(_)}function Ls(){}var Ji=!1;function hr(p,_,S){if(Ji)return p(_,S);Ji=!0;try{return qn(p,_,S)}finally{Ji=!1,(Da!==null||ma!==null)&&(Ls(),kn())}}function Ar(p,_){var S=p.stateNode;if(S===null)return null;var I=og(S);if(I===null)return null;S=I[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(p=p.type,I=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!I;break e;default:p=!1}if(p)return null;if(S&&typeof S!="function")throw Error(a(231,_,typeof S));return S}var ja=!1;if(w)try{var ui={};Object.defineProperty(ui,"passive",{get:function(){ja=!0}}),window.addEventListener("test",ui,ui),window.removeEventListener("test",ui,ui)}catch{ja=!1}function Ti(p,_,S,I,j,q,ae,Te,Ie){var et=Array.prototype.slice.call(arguments,3);try{_.apply(S,et)}catch(Et){this.onError(Et)}}var jc=!1,ga=null,ju=!1,t0=null,pb={onError:function(p){jc=!0,ga=p}};function fb(p,_,S,I,j,q,ae,Te,Ie){jc=!1,ga=null,Ti.apply(pb,arguments)}function XR(p,_,S,I,j,q,ae,Te,Ie){if(fb.apply(this,arguments),jc){if(jc){var et=ga;jc=!1,ga=null}else throw Error(a(198));ju||(ju=!0,t0=et)}}function Ld(p){var _=p,S=p;if(p.alternate)for(;_.return;)_=_.return;else{p=_;do _=p,(_.flags&4098)!==0&&(S=_.return),p=_.return;while(p)}return _.tag===3?S:null}function mb(p){if(p.tag===13){var _=p.memoizedState;if(_===null&&(p=p.alternate,p!==null&&(_=p.memoizedState)),_!==null)return _.dehydrated}return null}function r0(p){if(Ld(p)!==p)throw Error(a(188))}function gb(p){var _=p.alternate;if(!_){if(_=Ld(p),_===null)throw Error(a(188));return _!==p?null:p}for(var S=p,I=_;;){var j=S.return;if(j===null)break;var q=j.alternate;if(q===null){if(I=j.return,I!==null){S=I;continue}break}if(j.child===q.child){for(q=j.child;q;){if(q===S)return r0(j),p;if(q===I)return r0(j),_;q=q.sibling}throw Error(a(188))}if(S.return!==I.return)S=j,I=q;else{for(var ae=!1,Te=j.child;Te;){if(Te===S){ae=!0,S=j,I=q;break}if(Te===I){ae=!0,I=j,S=q;break}Te=Te.sibling}if(!ae){for(Te=q.child;Te;){if(Te===S){ae=!0,S=q,I=j;break}if(Te===I){ae=!0,I=q,S=j;break}Te=Te.sibling}if(!ae)throw Error(a(189))}}if(S.alternate!==I)throw Error(a(190))}if(S.tag!==3)throw Error(a(188));return S.stateNode.current===S?p:_}function Bm(p){return p=gb(p),p!==null?n0(p):null}function n0(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var _=n0(p);if(_!==null)return _;p=p.sibling}return null}var Md=n.unstable_scheduleCallback,_b=n.unstable_cancelCallback,JR=n.unstable_shouldYield,Bo=n.unstable_requestPaint,Ss=n.unstable_now,QR=n.unstable_getCurrentPriorityLevel,us=n.unstable_ImmediatePriority,yb=n.unstable_UserBlockingPriority,Wm=n.unstable_NormalPriority,ZR=n.unstable_LowPriority,vb=n.unstable_IdlePriority,Lu=null,Wo=null;function Eb(p){if(Wo&&typeof Wo.onCommitFiberRoot=="function")try{Wo.onCommitFiberRoot(Lu,p,void 0,(p.current.flags&128)===128)}catch{}}var po=Math.clz32?Math.clz32:Mu,eN=Math.log,tN=Math.LN2;function Mu(p){return p>>>=0,p===0?32:31-(eN(p)/tN|0)|0}var Uu=64,qm=4194304;function wn(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Gm(p,_){var S=p.pendingLanes;if(S===0)return 0;var I=0,j=p.suspendedLanes,q=p.pingedLanes,ae=S&268435455;if(ae!==0){var Te=ae&~j;Te!==0?I=wn(Te):(q&=ae,q!==0&&(I=wn(q)))}else ae=S&~j,ae!==0?I=wn(ae):q!==0&&(I=wn(q));if(I===0)return 0;if(_!==0&&_!==I&&(_&j)===0&&(j=I&-I,q=_&-_,j>=q||j===16&&(q&4194240)!==0))return _;if((I&4)!==0&&(I|=S&16),_=p.entangledLanes,_!==0)for(p=p.entanglements,_&=I;0<_;)S=31-po(_),j=1<<S,I|=p[S],_&=~j;return I}function wb(p,_){switch(p){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bb(p,_){for(var S=p.suspendedLanes,I=p.pingedLanes,j=p.expirationTimes,q=p.pendingLanes;0<q;){var ae=31-po(q),Te=1<<ae,Ie=j[ae];Ie===-1?((Te&S)===0||(Te&I)!==0)&&(j[ae]=wb(Te,_)):Ie<=_&&(p.expiredLanes|=Te),q&=~Te}}function s0(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Sb(){var p=Uu;return Uu<<=1,(Uu&4194240)===0&&(Uu=64),p}function i0(p){for(var _=[],S=0;31>S;S++)_.push(p);return _}function Sp(p,_,S){p.pendingLanes|=_,_!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,_=31-po(_),p[_]=S}function rN(p,_){var S=p.pendingLanes&~_;p.pendingLanes=_,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=_,p.mutableReadLanes&=_,p.entangledLanes&=_,_=p.entanglements;var I=p.eventTimes;for(p=p.expirationTimes;0<S;){var j=31-po(S),q=1<<j;_[j]=0,I[j]=-1,p[j]=-1,S&=~q}}function a0(p,_){var S=p.entangledLanes|=_;for(p=p.entanglements;S;){var I=31-po(S),j=1<<I;j&_|p[I]&_&&(p[I]|=_),S&=~j}}var bn=0;function o0(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Hm,c0,Km,xb,l0,d0=!1,zm=[],Il=null,Ol=null,kl=null,xp=new Map,Tp=new Map,Pl=[],Tb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Cb(p,_){switch(p){case"focusin":case"focusout":Il=null;break;case"dragenter":case"dragleave":Ol=null;break;case"mouseover":case"mouseout":kl=null;break;case"pointerover":case"pointerout":xp.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tp.delete(_.pointerId)}}function Cp(p,_,S,I,j,q){return p===null||p.nativeEvent!==q?(p={blockedOn:_,domEventName:S,eventSystemFlags:I,nativeEvent:q,targetContainers:[j]},_!==null&&(_=Wp(_),_!==null&&c0(_)),p):(p.eventSystemFlags|=I,_=p.targetContainers,j!==null&&_.indexOf(j)===-1&&_.push(j),p)}function nN(p,_,S,I,j){switch(_){case"focusin":return Il=Cp(Il,p,_,S,I,j),!0;case"dragenter":return Ol=Cp(Ol,p,_,S,I,j),!0;case"mouseover":return kl=Cp(kl,p,_,S,I,j),!0;case"pointerover":var q=j.pointerId;return xp.set(q,Cp(xp.get(q)||null,p,_,S,I,j)),!0;case"gotpointercapture":return q=j.pointerId,Tp.set(q,Cp(Tp.get(q)||null,p,_,S,I,j)),!0}return!1}function Fu(p){var _=Vd(p.target);if(_!==null){var S=Ld(_);if(S!==null){if(_=S.tag,_===13){if(_=mb(S),_!==null){p.blockedOn=_,l0(p.priority,function(){Km(S)});return}}else if(_===3&&S.stateNode.current.memoizedState.isDehydrated){p.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}p.blockedOn=null}function $m(p){if(p.blockedOn!==null)return!1;for(var _=p.targetContainers;0<_.length;){var S=u0(p.domEventName,p.eventSystemFlags,_[0],p.nativeEvent);if(S===null){S=p.nativeEvent;var I=new S.constructor(S.type,S);Ot=I,S.target.dispatchEvent(I),Ot=null}else return _=Wp(S),_!==null&&c0(_),p.blockedOn=S,!1;_.shift()}return!0}function Rb(p,_,S){$m(p)&&S.delete(_)}function sN(){d0=!1,Il!==null&&$m(Il)&&(Il=null),Ol!==null&&$m(Ol)&&(Ol=null),kl!==null&&$m(kl)&&(kl=null),xp.forEach(Rb),Tp.forEach(Rb)}function Rp(p,_){p.blockedOn===_&&(p.blockedOn=null,d0||(d0=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,sN)))}function Vu(p){function _(j){return Rp(j,p)}if(0<zm.length){Rp(zm[0],p);for(var S=1;S<zm.length;S++){var I=zm[S];I.blockedOn===p&&(I.blockedOn=null)}}for(Il!==null&&Rp(Il,p),Ol!==null&&Rp(Ol,p),kl!==null&&Rp(kl,p),xp.forEach(_),Tp.forEach(_),S=0;S<Pl.length;S++)I=Pl[S],I.blockedOn===p&&(I.blockedOn=null);for(;0<Pl.length&&(S=Pl[0],S.blockedOn===null);)Fu(S),S.blockedOn===null&&Pl.shift()}var Bu=Q.ReactCurrentBatchConfig,Ym=!0;function iN(p,_,S,I){var j=bn,q=Bu.transition;Bu.transition=null;try{bn=1,Qi(p,_,S,I)}finally{bn=j,Bu.transition=q}}function Dl(p,_,S,I){var j=bn,q=Bu.transition;Bu.transition=null;try{bn=4,Qi(p,_,S,I)}finally{bn=j,Bu.transition=q}}function Qi(p,_,S,I){if(Ym){var j=u0(p,_,S,I);if(j===null)O0(p,_,I,Np,S),Cb(p,I);else if(nN(j,p,_,S,I))I.stopPropagation();else if(Cb(p,I),_&4&&-1<Tb.indexOf(p)){for(;j!==null;){var q=Wp(j);if(q!==null&&Hm(q),q=u0(p,_,S,I),q===null&&O0(p,_,I,Np,S),q===j)break;j=q}j!==null&&I.stopPropagation()}else O0(p,_,I,null,S)}}var Np=null;function u0(p,_,S,I){if(Np=null,p=tr(I),p=Vd(p),p!==null)if(_=Ld(p),_===null)p=null;else if(S=_.tag,S===13){if(p=mb(_),p!==null)return p;p=null}else if(S===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;p=null}else _!==p&&(p=null);return Np=p,null}function Nb(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(QR()){case us:return 1;case yb:return 4;case Wm:case ZR:return 16;case vb:return 536870912;default:return 16}default:return 16}}var jl=null,hi=null,Xm=null;function Ab(){if(Xm)return Xm;var p,_=hi,S=_.length,I,j="value"in jl?jl.value:jl.textContent,q=j.length;for(p=0;p<S&&_[p]===j[p];p++);var ae=S-p;for(I=1;I<=ae&&_[S-I]===j[q-I];I++);return Xm=j.slice(p,1<I?1-I:void 0)}function Jm(p){var _=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&_===13&&(p=13)):p=_,p===10&&(p=13),32<=p||p===13?p:0}function Ud(){return!0}function h0(){return!1}function _a(p){function _(S,I,j,q,ae){this._reactName=S,this._targetInst=j,this.type=I,this.nativeEvent=q,this.target=ae,this.currentTarget=null;for(var Te in p)p.hasOwnProperty(Te)&&(S=p[Te],this[Te]=S?S(q):q[Te]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?Ud:h0,this.isPropagationStopped=h0,this}return we(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=Ud)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=Ud)},persist:function(){},isPersistent:Ud}),_}var Ll={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},p0=_a(Ll),Fd=we({},Ll,{view:0,detail:0}),f0=_a(Fd),Ap,m0,Ip,qo=we({},Fd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_0,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Ip&&(Ip&&p.type==="mousemove"?(Ap=p.screenX-Ip.screenX,m0=p.screenY-Ip.screenY):m0=Ap=0,Ip=p),Ap)},movementY:function(p){return"movementY"in p?p.movementY:m0}}),Wu=_a(qo),aN=we({},qo,{dataTransfer:0}),oN=_a(aN),cN=we({},Fd,{relatedTarget:0}),g0=_a(cN),lN=we({},Ll,{animationName:0,elapsedTime:0,pseudoElement:0}),qu=_a(lN),dN=we({},Ll,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Gu=_a(dN),Ib=we({},Ll,{data:0}),Ob=_a(Ib),kr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pN(p){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(p):(p=hN[p])?!!_[p]:!1}function _0(){return pN}var y0=we({},Fd,{key:function(p){if(p.key){var _=kr[p.key]||p.key;if(_!=="Unidentified")return _}return p.type==="keypress"?(p=Jm(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?uN[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_0,charCode:function(p){return p.type==="keypress"?Jm(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Jm(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),fN=_a(y0),mN=we({},qo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kb=_a(mN),v0=we({},Fd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_0}),gN=_a(v0),_N=we({},Ll,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pb=_a(_N),yN=we({},qo,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Ml=_a(yN),vN=[9,13,27,32],E0=w&&"CompositionEvent"in window,Op=null;w&&"documentMode"in document&&(Op=document.documentMode);var Db=w&&"TextEvent"in window&&!Op,Qm=w&&(!E0||Op&&8<Op&&11>=Op),jb=" ",Lb=!1;function Mb(p,_){switch(p){case"keyup":return vN.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ya(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Hu=!1;function EN(p,_){switch(p){case"compositionend":return ya(_);case"keypress":return _.which!==32?null:(Lb=!0,jb);case"textInput":return p=_.data,p===jb&&Lb?null:p;default:return null}}function wN(p,_){if(Hu)return p==="compositionend"||!E0&&Mb(p,_)?(p=Ab(),Xm=hi=jl=null,Hu=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return Qm&&_.locale!=="ko"?null:_.data;default:return null}}var bN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function w0(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _==="input"?!!bN[p.type]:_==="textarea"}function Ub(p,_,S,I){ar(I),_=Up(_,"onChange"),0<_.length&&(S=new p0("onChange","change",null,S,I),p.push({event:S,listeners:_}))}var kp=null,Ku=null;function b0(p){Yb(p,0)}function Zm(p){var _=Zu(p);if(Wr(_))return p}function SN(p,_){if(p==="change")return _}var Pp=!1;if(w){var S0;if(w){var x0="oninput"in document;if(!x0){var Fb=document.createElement("div");Fb.setAttribute("oninput","return;"),x0=typeof Fb.oninput=="function"}S0=x0}else S0=!1;Pp=S0&&(!document.documentMode||9<document.documentMode)}function Lc(){kp&&(kp.detachEvent("onpropertychange",Vb),Ku=kp=null)}function Vb(p){if(p.propertyName==="value"&&Zm(Ku)){var _=[];Ub(_,Ku,p,tr(p)),hr(b0,_)}}function xN(p,_,S){p==="focusin"?(Lc(),kp=_,Ku=S,kp.attachEvent("onpropertychange",Vb)):p==="focusout"&&Lc()}function Zi(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Zm(Ku)}function TN(p,_){if(p==="click")return Zm(_)}function CN(p,_){if(p==="input"||p==="change")return Zm(_)}function RN(p,_){return p===_&&(p!==0||1/p===1/_)||p!==p&&_!==_}var fo=typeof Object.is=="function"?Object.is:RN;function zu(p,_){if(fo(p,_))return!0;if(typeof p!="object"||p===null||typeof _!="object"||_===null)return!1;var S=Object.keys(p),I=Object.keys(_);if(S.length!==I.length)return!1;for(I=0;I<S.length;I++){var j=S[I];if(!b.call(_,j)||!fo(p[j],_[j]))return!1}return!0}function Bb(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function Wb(p,_){var S=Bb(p);p=0;for(var I;S;){if(S.nodeType===3){if(I=p+S.textContent.length,p<=_&&I>=_)return{node:S,offset:_-p};p=I}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=Bb(S)}}function qb(p,_){return p&&_?p===_?!0:p&&p.nodeType===3?!1:_&&_.nodeType===3?qb(p,_.parentNode):"contains"in p?p.contains(_):p.compareDocumentPosition?!!(p.compareDocumentPosition(_)&16):!1:!1}function T0(){for(var p=window,_=en();_ instanceof p.HTMLIFrameElement;){try{var S=typeof _.contentWindow.location.href=="string"}catch{S=!1}if(S)p=_.contentWindow;else break;_=en(p.document)}return _}function C0(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _&&(_==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||_==="textarea"||p.contentEditable==="true")}function NN(p){var _=T0(),S=p.focusedElem,I=p.selectionRange;if(_!==S&&S&&S.ownerDocument&&qb(S.ownerDocument.documentElement,S)){if(I!==null&&C0(S)){if(_=I.start,p=I.end,p===void 0&&(p=_),"selectionStart"in S)S.selectionStart=_,S.selectionEnd=Math.min(p,S.value.length);else if(p=(_=S.ownerDocument||document)&&_.defaultView||window,p.getSelection){p=p.getSelection();var j=S.textContent.length,q=Math.min(I.start,j);I=I.end===void 0?q:Math.min(I.end,j),!p.extend&&q>I&&(j=I,I=q,q=j),j=Wb(S,q);var ae=Wb(S,I);j&&ae&&(p.rangeCount!==1||p.anchorNode!==j.node||p.anchorOffset!==j.offset||p.focusNode!==ae.node||p.focusOffset!==ae.offset)&&(_=_.createRange(),_.setStart(j.node,j.offset),p.removeAllRanges(),q>I?(p.addRange(_),p.extend(ae.node,ae.offset)):(_.setEnd(ae.node,ae.offset),p.addRange(_)))}}for(_=[],p=S;p=p.parentNode;)p.nodeType===1&&_.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<_.length;S++)p=_[S],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var R0=w&&"documentMode"in document&&11>=document.documentMode,Ul=null,N0=null,$e=null,A0=!1;function Gb(p,_,S){var I=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;A0||Ul==null||Ul!==en(I)||(I=Ul,"selectionStart"in I&&C0(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),$e&&zu($e,I)||($e=I,I=Up(N0,"onSelect"),0<I.length&&(_=new p0("onSelect","select",null,_,S),p.push({event:_,listeners:I}),_.target=Ul)))}function eg(p,_){var S={};return S[p.toLowerCase()]=_.toLowerCase(),S["Webkit"+p]="webkit"+_,S["Moz"+p]="moz"+_,S}var $u={animationend:eg("Animation","AnimationEnd"),animationiteration:eg("Animation","AnimationIteration"),animationstart:eg("Animation","AnimationStart"),transitionend:eg("Transition","TransitionEnd")},tg={},I0={};w&&(I0=document.createElement("div").style,"AnimationEvent"in window||(delete $u.animationend.animation,delete $u.animationiteration.animation,delete $u.animationstart.animation),"TransitionEvent"in window||delete $u.transitionend.transition);function rg(p){if(tg[p])return tg[p];if(!$u[p])return p;var _=$u[p],S;for(S in _)if(_.hasOwnProperty(S)&&S in I0)return tg[p]=_[S];return p}var Hb=rg("animationend"),Kb=rg("animationiteration"),Dp=rg("animationstart"),Yu=rg("transitionend"),zb=new Map,$b="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mo(p,_){zb.set(p,_),m(_,[p])}for(var jp=0;jp<$b.length;jp++){var Xu=$b[jp],AN=Xu.toLowerCase(),IN=Xu[0].toUpperCase()+Xu.slice(1);mo(AN,"on"+IN)}mo(Hb,"onAnimationEnd"),mo(Kb,"onAnimationIteration"),mo(Dp,"onAnimationStart"),mo("dblclick","onDoubleClick"),mo("focusin","onFocus"),mo("focusout","onBlur"),mo(Yu,"onTransitionEnd"),y("onMouseEnter",["mouseout","mouseover"]),y("onMouseLeave",["mouseout","mouseover"]),y("onPointerEnter",["pointerout","pointerover"]),y("onPointerLeave",["pointerout","pointerover"]),m("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),m("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),m("onBeforeInput",["compositionend","keypress","textInput","paste"]),m("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),m("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),m("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ON=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lp));function ng(p,_,S){var I=p.type||"unknown-event";p.currentTarget=S,XR(I,_,void 0,p),p.currentTarget=null}function Yb(p,_){_=(_&4)!==0;for(var S=0;S<p.length;S++){var I=p[S],j=I.event;I=I.listeners;e:{var q=void 0;if(_)for(var ae=I.length-1;0<=ae;ae--){var Te=I[ae],Ie=Te.instance,et=Te.currentTarget;if(Te=Te.listener,Ie!==q&&j.isPropagationStopped())break e;ng(j,Te,et),q=Ie}else for(ae=0;ae<I.length;ae++){if(Te=I[ae],Ie=Te.instance,et=Te.currentTarget,Te=Te.listener,Ie!==q&&j.isPropagationStopped())break e;ng(j,Te,et),q=Ie}}}if(ju)throw p=t0,ju=!1,t0=null,p}function Gn(p,_){var S=_[j0];S===void 0&&(S=_[j0]=new Set);var I=p+"__bubble";S.has(I)||(Xb(_,p,2,!1),S.add(I))}function ea(p,_,S){var I=0;_&&(I|=4),Xb(S,p,I,_)}var sg="_reactListening"+Math.random().toString(36).slice(2);function Mc(p){if(!p[sg]){p[sg]=!0,l.forEach(function(S){S!=="selectionchange"&&(ON.has(S)||ea(S,!1,p),ea(S,!0,p))});var _=p.nodeType===9?p:p.ownerDocument;_===null||_[sg]||(_[sg]=!0,ea("selectionchange",!1,_))}}function Xb(p,_,S,I){switch(Nb(_)){case 1:var j=iN;break;case 4:j=Dl;break;default:j=Qi}S=j.bind(null,_,S,p),j=void 0,!ja||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(j=!0),I?j!==void 0?p.addEventListener(_,S,{capture:!0,passive:j}):p.addEventListener(_,S,!0):j!==void 0?p.addEventListener(_,S,{passive:j}):p.addEventListener(_,S,!1)}function O0(p,_,S,I,j){var q=I;if((_&1)===0&&(_&2)===0&&I!==null)e:for(;;){if(I===null)return;var ae=I.tag;if(ae===3||ae===4){var Te=I.stateNode.containerInfo;if(Te===j||Te.nodeType===8&&Te.parentNode===j)break;if(ae===4)for(ae=I.return;ae!==null;){var Ie=ae.tag;if((Ie===3||Ie===4)&&(Ie=ae.stateNode.containerInfo,Ie===j||Ie.nodeType===8&&Ie.parentNode===j))return;ae=ae.return}for(;Te!==null;){if(ae=Vd(Te),ae===null)return;if(Ie=ae.tag,Ie===5||Ie===6){I=q=ae;continue e}Te=Te.parentNode}}I=I.return}hr(function(){var et=q,Et=tr(S),St=[];e:{var yt=zb.get(p);if(yt!==void 0){var qt=p0,$t=p;switch(p){case"keypress":if(Jm(S)===0)break e;case"keydown":case"keyup":qt=fN;break;case"focusin":$t="focus",qt=g0;break;case"focusout":$t="blur",qt=g0;break;case"beforeblur":case"afterblur":qt=g0;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=Wu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=oN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=gN;break;case Hb:case Kb:case Dp:qt=qu;break;case Yu:qt=Pb;break;case"scroll":qt=f0;break;case"wheel":qt=Ml;break;case"copy":case"cut":case"paste":qt=Gu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=kb}var Xt=(_&4)!==0,cs=!Xt&&p==="scroll",Ge=Xt?yt!==null?yt+"Capture":null:yt;Xt=[];for(var Pe=et,Ye;Pe!==null;){Ye=Pe;var Rt=Ye.stateNode;if(Ye.tag===5&&Rt!==null&&(Ye=Rt,Ge!==null&&(Rt=Ar(Pe,Ge),Rt!=null&&Xt.push(Mp(Pe,Rt,Ye)))),cs)break;Pe=Pe.return}0<Xt.length&&(yt=new qt(yt,$t,null,S,Et),St.push({event:yt,listeners:Xt}))}}if((_&7)===0){e:{if(yt=p==="mouseover"||p==="pointerover",qt=p==="mouseout"||p==="pointerout",yt&&S!==Ot&&($t=S.relatedTarget||S.fromElement)&&(Vd($t)||$t[Uc]))break e;if((qt||yt)&&(yt=Et.window===Et?Et:(yt=Et.ownerDocument)?yt.defaultView||yt.parentWindow:window,qt?($t=S.relatedTarget||S.toElement,qt=et,$t=$t?Vd($t):null,$t!==null&&(cs=Ld($t),$t!==cs||$t.tag!==5&&$t.tag!==6)&&($t=null)):(qt=null,$t=et),qt!==$t)){if(Xt=Wu,Rt="onMouseLeave",Ge="onMouseEnter",Pe="mouse",(p==="pointerout"||p==="pointerover")&&(Xt=kb,Rt="onPointerLeave",Ge="onPointerEnter",Pe="pointer"),cs=qt==null?yt:Zu(qt),Ye=$t==null?yt:Zu($t),yt=new Xt(Rt,Pe+"leave",qt,S,Et),yt.target=cs,yt.relatedTarget=Ye,Rt=null,Vd(Et)===et&&(Xt=new Xt(Ge,Pe+"enter",$t,S,Et),Xt.target=Ye,Xt.relatedTarget=cs,Rt=Xt),cs=Rt,qt&&$t)t:{for(Xt=qt,Ge=$t,Pe=0,Ye=Xt;Ye;Ye=Ju(Ye))Pe++;for(Ye=0,Rt=Ge;Rt;Rt=Ju(Rt))Ye++;for(;0<Pe-Ye;)Xt=Ju(Xt),Pe--;for(;0<Ye-Pe;)Ge=Ju(Ge),Ye--;for(;Pe--;){if(Xt===Ge||Ge!==null&&Xt===Ge.alternate)break t;Xt=Ju(Xt),Ge=Ju(Ge)}Xt=null}else Xt=null;qt!==null&&Jb(St,yt,qt,Xt,!1),$t!==null&&cs!==null&&Jb(St,cs,$t,Xt,!0)}}e:{if(yt=et?Zu(et):window,qt=yt.nodeName&&yt.nodeName.toLowerCase(),qt==="select"||qt==="input"&&yt.type==="file")var Jt=SN;else if(w0(yt))if(Pp)Jt=CN;else{Jt=Zi;var dr=xN}else(qt=yt.nodeName)&&qt.toLowerCase()==="input"&&(yt.type==="checkbox"||yt.type==="radio")&&(Jt=TN);if(Jt&&(Jt=Jt(p,et))){Ub(St,Jt,S,Et);break e}dr&&dr(p,yt,et),p==="focusout"&&(dr=yt._wrapperState)&&dr.controlled&&yt.type==="number"&&xt(yt,"number",yt.value)}switch(dr=et?Zu(et):window,p){case"focusin":(w0(dr)||dr.contentEditable==="true")&&(Ul=dr,N0=et,$e=null);break;case"focusout":$e=N0=Ul=null;break;case"mousedown":A0=!0;break;case"contextmenu":case"mouseup":case"dragend":A0=!1,Gb(St,S,Et);break;case"selectionchange":if(R0)break;case"keydown":case"keyup":Gb(St,S,Et)}var ur;if(E0)e:{switch(p){case"compositionstart":var _r="onCompositionStart";break e;case"compositionend":_r="onCompositionEnd";break e;case"compositionupdate":_r="onCompositionUpdate";break e}_r=void 0}else Hu?Mb(p,S)&&(_r="onCompositionEnd"):p==="keydown"&&S.keyCode===229&&(_r="onCompositionStart");_r&&(Qm&&S.locale!=="ko"&&(Hu||_r!=="onCompositionStart"?_r==="onCompositionEnd"&&Hu&&(ur=Ab()):(jl=Et,hi="value"in jl?jl.value:jl.textContent,Hu=!0)),dr=Up(et,_r),0<dr.length&&(_r=new Ob(_r,p,null,S,Et),St.push({event:_r,listeners:dr}),ur?_r.data=ur:(ur=ya(S),ur!==null&&(_r.data=ur)))),(ur=Db?EN(p,S):wN(p,S))&&(et=Up(et,"onBeforeInput"),0<et.length&&(Et=new Ob("onBeforeInput","beforeinput",null,S,Et),St.push({event:Et,listeners:et}),Et.data=ur))}Yb(St,_)})}function Mp(p,_,S){return{instance:p,listener:_,currentTarget:S}}function Up(p,_){for(var S=_+"Capture",I=[];p!==null;){var j=p,q=j.stateNode;j.tag===5&&q!==null&&(j=q,q=Ar(p,S),q!=null&&I.unshift(Mp(p,q,j)),q=Ar(p,_),q!=null&&I.push(Mp(p,q,j))),p=p.return}return I}function Ju(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function Jb(p,_,S,I,j){for(var q=_._reactName,ae=[];S!==null&&S!==I;){var Te=S,Ie=Te.alternate,et=Te.stateNode;if(Ie!==null&&Ie===I)break;Te.tag===5&&et!==null&&(Te=et,j?(Ie=Ar(S,q),Ie!=null&&ae.unshift(Mp(S,Ie,Te))):j||(Ie=Ar(S,q),Ie!=null&&ae.push(Mp(S,Ie,Te)))),S=S.return}ae.length!==0&&p.push({event:_,listeners:ae})}var kN=/\r\n?/g,k0=/\u0000|\uFFFD/g;function Qb(p){return(typeof p=="string"?p:""+p).replace(kN,`
`).replace(k0,"")}function Fp(p,_,S){if(_=Qb(_),Qb(p)!==_&&S)throw Error(a(425))}function Vp(){}var P0=null,ig=null;function Qu(p,_){return p==="textarea"||p==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var D0=typeof setTimeout=="function"?setTimeout:void 0,PN=typeof clearTimeout=="function"?clearTimeout:void 0,Zb=typeof Promise=="function"?Promise:void 0,DN=typeof queueMicrotask=="function"?queueMicrotask:typeof Zb<"u"?function(p){return Zb.resolve(null).then(p).catch(jN)}:D0;function jN(p){setTimeout(function(){throw p})}function ag(p,_){var S=_,I=0;do{var j=S.nextSibling;if(p.removeChild(S),j&&j.nodeType===8)if(S=j.data,S==="/$"){if(I===0){p.removeChild(j),Vu(_);return}I--}else S!=="$"&&S!=="$?"&&S!=="$!"||I++;S=j}while(S);Vu(_)}function Go(p){for(;p!=null;p=p.nextSibling){var _=p.nodeType;if(_===1||_===3)break;if(_===8){if(_=p.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return p}function eS(p){p=p.previousSibling;for(var _=0;p;){if(p.nodeType===8){var S=p.data;if(S==="$"||S==="$!"||S==="$?"){if(_===0)return p;_--}else S==="/$"&&_++}p=p.previousSibling}return null}var Fl=Math.random().toString(36).slice(2),Ho="__reactFiber$"+Fl,Bp="__reactProps$"+Fl,Uc="__reactContainer$"+Fl,j0="__reactEvents$"+Fl,LN="__reactListeners$"+Fl,MN="__reactHandles$"+Fl;function Vd(p){var _=p[Ho];if(_)return _;for(var S=p.parentNode;S;){if(_=S[Uc]||S[Ho]){if(S=_.alternate,_.child!==null||S!==null&&S.child!==null)for(p=eS(p);p!==null;){if(S=p[Ho])return S;p=eS(p)}return _}p=S,S=p.parentNode}return null}function Wp(p){return p=p[Ho]||p[Uc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Zu(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(a(33))}function og(p){return p[Bp]||null}var L0=[],Fc=-1;function go(p){return{current:p}}function Mn(p){0>Fc||(p.current=L0[Fc],L0[Fc]=null,Fc--)}function Hn(p,_){Fc++,L0[Fc]=p.current,p.current=_}var Vl={},Ci=go(Vl),Fi=go(!1),Bl=Vl;function Wl(p,_){var S=p.type.contextTypes;if(!S)return Vl;var I=p.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===_)return I.__reactInternalMemoizedMaskedChildContext;var j={},q;for(q in S)j[q]=_[q];return I&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=_,p.__reactInternalMemoizedMaskedChildContext=j),j}function ta(p){return p=p.childContextTypes,p!=null}function cg(){Mn(Fi),Mn(Ci)}function eh(p,_,S){if(Ci.current!==Vl)throw Error(a(168));Hn(Ci,_),Hn(Fi,S)}function tS(p,_,S){var I=p.stateNode;if(_=_.childContextTypes,typeof I.getChildContext!="function")return S;I=I.getChildContext();for(var j in I)if(!(j in _))throw Error(a(108,vt(p)||"Unknown",j));return we({},S,I)}function lg(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Vl,Bl=Ci.current,Hn(Ci,p),Hn(Fi,Fi.current),!0}function rS(p,_,S){var I=p.stateNode;if(!I)throw Error(a(169));S?(p=tS(p,_,Bl),I.__reactInternalMemoizedMergedChildContext=p,Mn(Fi),Mn(Ci),Hn(Ci,p)):Mn(Fi),Hn(Fi,S)}var Vc=null,dg=!1,M0=!1;function U0(p){Vc===null?Vc=[p]:Vc.push(p)}function UN(p){dg=!0,U0(p)}function ql(){if(!M0&&Vc!==null){M0=!0;var p=0,_=bn;try{var S=Vc;for(bn=1;p<S.length;p++){var I=S[p];do I=I(!0);while(I!==null)}Vc=null,dg=!1}catch(j){throw Vc!==null&&(Vc=Vc.slice(p+1)),Md(us,ql),j}finally{bn=_,M0=!1}}return null}var th=[],Gl=0,ug=null,hg=0,Vi=[],La=0,Bd=null,Bc=1,Wc="";function Wd(p,_){th[Gl++]=hg,th[Gl++]=ug,ug=p,hg=_}function nS(p,_,S){Vi[La++]=Bc,Vi[La++]=Wc,Vi[La++]=Bd,Bd=p;var I=Bc;p=Wc;var j=32-po(I)-1;I&=~(1<<j),S+=1;var q=32-po(_)+j;if(30<q){var ae=j-j%5;q=(I&(1<<ae)-1).toString(32),I>>=ae,j-=ae,Bc=1<<32-po(_)+j|S<<j|I,Wc=q+p}else Bc=1<<q|S<<j|I,Wc=p}function rh(p){p.return!==null&&(Wd(p,1),nS(p,1,0))}function pg(p){for(;p===ug;)ug=th[--Gl],th[Gl]=null,hg=th[--Gl],th[Gl]=null;for(;p===Bd;)Bd=Vi[--La],Vi[La]=null,Wc=Vi[--La],Vi[La]=null,Bc=Vi[--La],Vi[La]=null}var va=null,Ea=null,Yn=!1,_o=null;function sS(p,_){var S=Ba(5,null,null,0);S.elementType="DELETED",S.stateNode=_,S.return=p,_=p.deletions,_===null?(p.deletions=[S],p.flags|=16):_.push(S)}function iS(p,_){switch(p.tag){case 5:var S=p.type;return _=_.nodeType!==1||S.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(p.stateNode=_,va=p,Ea=Go(_.firstChild),!0):!1;case 6:return _=p.pendingProps===""||_.nodeType!==3?null:_,_!==null?(p.stateNode=_,va=p,Ea=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(S=Bd!==null?{id:Bc,overflow:Wc}:null,p.memoizedState={dehydrated:_,treeContext:S,retryLane:1073741824},S=Ba(18,null,null,0),S.stateNode=_,S.return=p,p.child=S,va=p,Ea=null,!0):!1;default:return!1}}function qp(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Gp(p){if(Yn){var _=Ea;if(_){var S=_;if(!iS(p,_)){if(qp(p))throw Error(a(418));_=Go(S.nextSibling);var I=va;_&&iS(p,_)?sS(I,S):(p.flags=p.flags&-4097|2,Yn=!1,va=p)}}else{if(qp(p))throw Error(a(418));p.flags=p.flags&-4097|2,Yn=!1,va=p}}}function F0(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;va=p}function nh(p){if(p!==va)return!1;if(!Yn)return F0(p),Yn=!0,!1;var _;if((_=p.tag!==3)&&!(_=p.tag!==5)&&(_=p.type,_=_!=="head"&&_!=="body"&&!Qu(p.type,p.memoizedProps)),_&&(_=Ea)){if(qp(p))throw V0(),Error(a(418));for(;_;)sS(p,_),_=Go(_.nextSibling)}if(F0(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(a(317));e:{for(p=p.nextSibling,_=0;p;){if(p.nodeType===8){var S=p.data;if(S==="/$"){if(_===0){Ea=Go(p.nextSibling);break e}_--}else S!=="$"&&S!=="$!"&&S!=="$?"||_++}p=p.nextSibling}Ea=null}}else Ea=va?Go(p.stateNode.nextSibling):null;return!0}function V0(){for(var p=Ea;p;)p=Go(p.nextSibling)}function qd(){Ea=va=null,Yn=!1}function sh(p){_o===null?_o=[p]:_o.push(p)}var Hp=Q.ReactCurrentBatchConfig;function Kp(p,_,S){if(p=S.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(a(309));var I=S.stateNode}if(!I)throw Error(a(147,p));var j=I,q=""+p;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===q?_.ref:(_=function(ae){var Te=j.refs;ae===null?delete Te[q]:Te[q]=ae},_._stringRef=q,_)}if(typeof p!="string")throw Error(a(284));if(!S._owner)throw Error(a(290,p))}return p}function fg(p,_){throw p=Object.prototype.toString.call(_),Error(a(31,p==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":p))}function B0(p){var _=p._init;return _(p._payload)}function aS(p){function _(Ge,Pe){if(p){var Ye=Ge.deletions;Ye===null?(Ge.deletions=[Pe],Ge.flags|=16):Ye.push(Pe)}}function S(Ge,Pe){if(!p)return null;for(;Pe!==null;)_(Ge,Pe),Pe=Pe.sibling;return null}function I(Ge,Pe){for(Ge=new Map;Pe!==null;)Pe.key!==null?Ge.set(Pe.key,Pe):Ge.set(Pe.index,Pe),Pe=Pe.sibling;return Ge}function j(Ge,Pe){return Ge=rd(Ge,Pe),Ge.index=0,Ge.sibling=null,Ge}function q(Ge,Pe,Ye){return Ge.index=Ye,p?(Ye=Ge.alternate,Ye!==null?(Ye=Ye.index,Ye<Pe?(Ge.flags|=2,Pe):Ye):(Ge.flags|=2,Pe)):(Ge.flags|=1048576,Pe)}function ae(Ge){return p&&Ge.alternate===null&&(Ge.flags|=2),Ge}function Te(Ge,Pe,Ye,Rt){return Pe===null||Pe.tag!==6?(Pe=Gg(Ye,Ge.mode,Rt),Pe.return=Ge,Pe):(Pe=j(Pe,Ye),Pe.return=Ge,Pe)}function Ie(Ge,Pe,Ye,Rt){var Jt=Ye.type;return Jt===ie?Et(Ge,Pe,Ye.props.children,Rt,Ye.key):Pe!==null&&(Pe.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===ye&&B0(Jt)===Pe.type)?(Rt=j(Pe,Ye.props),Rt.ref=Kp(Ge,Pe,Ye),Rt.return=Ge,Rt):(Rt=gh(Ye.type,Ye.key,Ye.props,null,Ge.mode,Rt),Rt.ref=Kp(Ge,Pe,Ye),Rt.return=Ge,Rt)}function et(Ge,Pe,Ye,Rt){return Pe===null||Pe.tag!==4||Pe.stateNode.containerInfo!==Ye.containerInfo||Pe.stateNode.implementation!==Ye.implementation?(Pe=_h(Ye,Ge.mode,Rt),Pe.return=Ge,Pe):(Pe=j(Pe,Ye.children||[]),Pe.return=Ge,Pe)}function Et(Ge,Pe,Ye,Rt,Jt){return Pe===null||Pe.tag!==7?(Pe=nd(Ye,Ge.mode,Rt,Jt),Pe.return=Ge,Pe):(Pe=j(Pe,Ye),Pe.return=Ge,Pe)}function St(Ge,Pe,Ye){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return Pe=Gg(""+Pe,Ge.mode,Ye),Pe.return=Ge,Pe;if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case G:return Ye=gh(Pe.type,Pe.key,Pe.props,null,Ge.mode,Ye),Ye.ref=Kp(Ge,null,Pe),Ye.return=Ge,Ye;case se:return Pe=_h(Pe,Ge.mode,Ye),Pe.return=Ge,Pe;case ye:var Rt=Pe._init;return St(Ge,Rt(Pe._payload),Ye)}if(Tr(Pe)||Oe(Pe))return Pe=nd(Pe,Ge.mode,Ye,null),Pe.return=Ge,Pe;fg(Ge,Pe)}return null}function yt(Ge,Pe,Ye,Rt){var Jt=Pe!==null?Pe.key:null;if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number")return Jt!==null?null:Te(Ge,Pe,""+Ye,Rt);if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case G:return Ye.key===Jt?Ie(Ge,Pe,Ye,Rt):null;case se:return Ye.key===Jt?et(Ge,Pe,Ye,Rt):null;case ye:return Jt=Ye._init,yt(Ge,Pe,Jt(Ye._payload),Rt)}if(Tr(Ye)||Oe(Ye))return Jt!==null?null:Et(Ge,Pe,Ye,Rt,null);fg(Ge,Ye)}return null}function qt(Ge,Pe,Ye,Rt,Jt){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number")return Ge=Ge.get(Ye)||null,Te(Pe,Ge,""+Rt,Jt);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case G:return Ge=Ge.get(Rt.key===null?Ye:Rt.key)||null,Ie(Pe,Ge,Rt,Jt);case se:return Ge=Ge.get(Rt.key===null?Ye:Rt.key)||null,et(Pe,Ge,Rt,Jt);case ye:var dr=Rt._init;return qt(Ge,Pe,Ye,dr(Rt._payload),Jt)}if(Tr(Rt)||Oe(Rt))return Ge=Ge.get(Ye)||null,Et(Pe,Ge,Rt,Jt,null);fg(Pe,Rt)}return null}function $t(Ge,Pe,Ye,Rt){for(var Jt=null,dr=null,ur=Pe,_r=Pe=0,Ys=null;ur!==null&&_r<Ye.length;_r++){ur.index>_r?(Ys=ur,ur=null):Ys=ur.sibling;var gn=yt(Ge,ur,Ye[_r],Rt);if(gn===null){ur===null&&(ur=Ys);break}p&&ur&&gn.alternate===null&&_(Ge,ur),Pe=q(gn,Pe,_r),dr===null?Jt=gn:dr.sibling=gn,dr=gn,ur=Ys}if(_r===Ye.length)return S(Ge,ur),Yn&&Wd(Ge,_r),Jt;if(ur===null){for(;_r<Ye.length;_r++)ur=St(Ge,Ye[_r],Rt),ur!==null&&(Pe=q(ur,Pe,_r),dr===null?Jt=ur:dr.sibling=ur,dr=ur);return Yn&&Wd(Ge,_r),Jt}for(ur=I(Ge,ur);_r<Ye.length;_r++)Ys=qt(ur,Ge,_r,Ye[_r],Rt),Ys!==null&&(p&&Ys.alternate!==null&&ur.delete(Ys.key===null?_r:Ys.key),Pe=q(Ys,Pe,_r),dr===null?Jt=Ys:dr.sibling=Ys,dr=Ys);return p&&ur.forEach(function(Jo){return _(Ge,Jo)}),Yn&&Wd(Ge,_r),Jt}function Xt(Ge,Pe,Ye,Rt){var Jt=Oe(Ye);if(typeof Jt!="function")throw Error(a(150));if(Ye=Jt.call(Ye),Ye==null)throw Error(a(151));for(var dr=Jt=null,ur=Pe,_r=Pe=0,Ys=null,gn=Ye.next();ur!==null&&!gn.done;_r++,gn=Ye.next()){ur.index>_r?(Ys=ur,ur=null):Ys=ur.sibling;var Jo=yt(Ge,ur,gn.value,Rt);if(Jo===null){ur===null&&(ur=Ys);break}p&&ur&&Jo.alternate===null&&_(Ge,ur),Pe=q(Jo,Pe,_r),dr===null?Jt=Jo:dr.sibling=Jo,dr=Jo,ur=Ys}if(gn.done)return S(Ge,ur),Yn&&Wd(Ge,_r),Jt;if(ur===null){for(;!gn.done;_r++,gn=Ye.next())gn=St(Ge,gn.value,Rt),gn!==null&&(Pe=q(gn,Pe,_r),dr===null?Jt=gn:dr.sibling=gn,dr=gn);return Yn&&Wd(Ge,_r),Jt}for(ur=I(Ge,ur);!gn.done;_r++,gn=Ye.next())gn=qt(ur,Ge,_r,gn.value,Rt),gn!==null&&(p&&gn.alternate!==null&&ur.delete(gn.key===null?_r:gn.key),Pe=q(gn,Pe,_r),dr===null?Jt=gn:dr.sibling=gn,dr=gn);return p&&ur.forEach(function(tA){return _(Ge,tA)}),Yn&&Wd(Ge,_r),Jt}function cs(Ge,Pe,Ye,Rt){if(typeof Ye=="object"&&Ye!==null&&Ye.type===ie&&Ye.key===null&&(Ye=Ye.props.children),typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case G:e:{for(var Jt=Ye.key,dr=Pe;dr!==null;){if(dr.key===Jt){if(Jt=Ye.type,Jt===ie){if(dr.tag===7){S(Ge,dr.sibling),Pe=j(dr,Ye.props.children),Pe.return=Ge,Ge=Pe;break e}}else if(dr.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===ye&&B0(Jt)===dr.type){S(Ge,dr.sibling),Pe=j(dr,Ye.props),Pe.ref=Kp(Ge,dr,Ye),Pe.return=Ge,Ge=Pe;break e}S(Ge,dr);break}else _(Ge,dr);dr=dr.sibling}Ye.type===ie?(Pe=nd(Ye.props.children,Ge.mode,Rt,Ye.key),Pe.return=Ge,Ge=Pe):(Rt=gh(Ye.type,Ye.key,Ye.props,null,Ge.mode,Rt),Rt.ref=Kp(Ge,Pe,Ye),Rt.return=Ge,Ge=Rt)}return ae(Ge);case se:e:{for(dr=Ye.key;Pe!==null;){if(Pe.key===dr)if(Pe.tag===4&&Pe.stateNode.containerInfo===Ye.containerInfo&&Pe.stateNode.implementation===Ye.implementation){S(Ge,Pe.sibling),Pe=j(Pe,Ye.children||[]),Pe.return=Ge,Ge=Pe;break e}else{S(Ge,Pe);break}else _(Ge,Pe);Pe=Pe.sibling}Pe=_h(Ye,Ge.mode,Rt),Pe.return=Ge,Ge=Pe}return ae(Ge);case ye:return dr=Ye._init,cs(Ge,Pe,dr(Ye._payload),Rt)}if(Tr(Ye))return $t(Ge,Pe,Ye,Rt);if(Oe(Ye))return Xt(Ge,Pe,Ye,Rt);fg(Ge,Ye)}return typeof Ye=="string"&&Ye!==""||typeof Ye=="number"?(Ye=""+Ye,Pe!==null&&Pe.tag===6?(S(Ge,Pe.sibling),Pe=j(Pe,Ye),Pe.return=Ge,Ge=Pe):(S(Ge,Pe),Pe=Gg(Ye,Ge.mode,Rt),Pe.return=Ge,Ge=Pe),ae(Ge)):S(Ge,Pe)}return cs}var ih=aS(!0),W0=aS(!1),mg=go(null),gg=null,ah=null,q0=null;function G0(){q0=ah=gg=null}function H0(p){var _=mg.current;Mn(mg),p._currentValue=_}function _g(p,_,S){for(;p!==null;){var I=p.alternate;if((p.childLanes&_)!==_?(p.childLanes|=_,I!==null&&(I.childLanes|=_)):I!==null&&(I.childLanes&_)!==_&&(I.childLanes|=_),p===S)break;p=p.return}}function yo(p,_){gg=p,q0=ah=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&_)!==0&&(na=!0),p.firstContext=null)}function Ma(p){var _=p._currentValue;if(q0!==p)if(p={context:p,memoizedValue:_,next:null},ah===null){if(gg===null)throw Error(a(308));ah=p,gg.dependencies={lanes:0,firstContext:p}}else ah=ah.next=p;return _}var Gd=null;function K0(p){Gd===null?Gd=[p]:Gd.push(p)}function z0(p,_,S,I){var j=_.interleaved;return j===null?(S.next=S,K0(_)):(S.next=j.next,j.next=S),_.interleaved=S,qc(p,I)}function qc(p,_){p.lanes|=_;var S=p.alternate;for(S!==null&&(S.lanes|=_),S=p,p=p.return;p!==null;)p.childLanes|=_,S=p.alternate,S!==null&&(S.childLanes|=_),S=p,p=p.return;return S.tag===3?S.stateNode:null}var Gc=!1;function $0(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oS(p,_){p=p.updateQueue,_.updateQueue===p&&(_.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Hc(p,_){return{eventTime:p,lane:_,tag:0,payload:null,callback:null,next:null}}function vo(p,_,S){var I=p.updateQueue;if(I===null)return null;if(I=I.shared,(Yr&2)!==0){var j=I.pending;return j===null?_.next=_:(_.next=j.next,j.next=_),I.pending=_,qc(p,S)}return j=I.interleaved,j===null?(_.next=_,K0(I)):(_.next=j.next,j.next=_),I.interleaved=_,qc(p,S)}function yg(p,_,S){if(_=_.updateQueue,_!==null&&(_=_.shared,(S&4194240)!==0)){var I=_.lanes;I&=p.pendingLanes,S|=I,_.lanes=S,a0(p,S)}}function cS(p,_){var S=p.updateQueue,I=p.alternate;if(I!==null&&(I=I.updateQueue,S===I)){var j=null,q=null;if(S=S.firstBaseUpdate,S!==null){do{var ae={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};q===null?j=q=ae:q=q.next=ae,S=S.next}while(S!==null);q===null?j=q=_:q=q.next=_}else j=q=_;S={baseState:I.baseState,firstBaseUpdate:j,lastBaseUpdate:q,shared:I.shared,effects:I.effects},p.updateQueue=S;return}p=S.lastBaseUpdate,p===null?S.firstBaseUpdate=_:p.next=_,S.lastBaseUpdate=_}function vg(p,_,S,I){var j=p.updateQueue;Gc=!1;var q=j.firstBaseUpdate,ae=j.lastBaseUpdate,Te=j.shared.pending;if(Te!==null){j.shared.pending=null;var Ie=Te,et=Ie.next;Ie.next=null,ae===null?q=et:ae.next=et,ae=Ie;var Et=p.alternate;Et!==null&&(Et=Et.updateQueue,Te=Et.lastBaseUpdate,Te!==ae&&(Te===null?Et.firstBaseUpdate=et:Te.next=et,Et.lastBaseUpdate=Ie))}if(q!==null){var St=j.baseState;ae=0,Et=et=Ie=null,Te=q;do{var yt=Te.lane,qt=Te.eventTime;if((I&yt)===yt){Et!==null&&(Et=Et.next={eventTime:qt,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var $t=p,Xt=Te;switch(yt=_,qt=S,Xt.tag){case 1:if($t=Xt.payload,typeof $t=="function"){St=$t.call(qt,St,yt);break e}St=$t;break e;case 3:$t.flags=$t.flags&-65537|128;case 0:if($t=Xt.payload,yt=typeof $t=="function"?$t.call(qt,St,yt):$t,yt==null)break e;St=we({},St,yt);break e;case 2:Gc=!0}}Te.callback!==null&&Te.lane!==0&&(p.flags|=64,yt=j.effects,yt===null?j.effects=[Te]:yt.push(Te))}else qt={eventTime:qt,lane:yt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},Et===null?(et=Et=qt,Ie=St):Et=Et.next=qt,ae|=yt;if(Te=Te.next,Te===null){if(Te=j.shared.pending,Te===null)break;yt=Te,Te=yt.next,yt.next=null,j.lastBaseUpdate=yt,j.shared.pending=null}}while(!0);if(Et===null&&(Ie=St),j.baseState=Ie,j.firstBaseUpdate=et,j.lastBaseUpdate=Et,_=j.shared.interleaved,_!==null){j=_;do ae|=j.lane,j=j.next;while(j!==_)}else q===null&&(j.shared.lanes=0);Qd|=ae,p.lanes=ae,p.memoizedState=St}}function lS(p,_,S){if(p=_.effects,_.effects=null,p!==null)for(_=0;_<p.length;_++){var I=p[_],j=I.callback;if(j!==null){if(I.callback=null,I=S,typeof j!="function")throw Error(a(191,j));j.call(I)}}}var zp={},Ko=go(zp),Hd=go(zp),$p=go(zp);function Hl(p){if(p===zp)throw Error(a(174));return p}function Y0(p,_){switch(Hn($p,_),Hn(Hd,p),Hn(Ko,zp),p=_.nodeType,p){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:_t(null,"");break;default:p=p===8?_.parentNode:_,_=p.namespaceURI||null,p=p.tagName,_=_t(_,p)}Mn(Ko),Hn(Ko,_)}function Kd(){Mn(Ko),Mn(Hd),Mn($p)}function dS(p){Hl($p.current);var _=Hl(Ko.current),S=_t(_,p.type);_!==S&&(Hn(Hd,p),Hn(Ko,S))}function X0(p){Hd.current===p&&(Mn(Ko),Mn(Hd))}var as=go(0);function Eg(p){for(var _=p;_!==null;){if(_.tag===13){var S=_.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var J0=[];function Q0(){for(var p=0;p<J0.length;p++)J0[p]._workInProgressVersionPrimary=null;J0.length=0}var Yp=Q.ReactCurrentDispatcher,Z0=Q.ReactCurrentBatchConfig,zd=0,rs=null,Ks=null,xs=null,Xp=!1,Kc=!1,Jp=0,FN=0;function Ri(){throw Error(a(321))}function ev(p,_){if(_===null)return!1;for(var S=0;S<_.length&&S<p.length;S++)if(!fo(p[S],_[S]))return!1;return!0}function oh(p,_,S,I,j,q){if(zd=q,rs=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,Yp.current=p===null||p.memoizedState===null?BN:vS,p=S(I,j),Kc){q=0;do{if(Kc=!1,Jp=0,25<=q)throw Error(a(301));q+=1,xs=Ks=null,_.updateQueue=null,Yp.current=WN,p=S(I,j)}while(Kc)}if(Yp.current=lh,_=Ks!==null&&Ks.next!==null,zd=0,xs=Ks=rs=null,Xp=!1,_)throw Error(a(300));return p}function tv(){var p=Jp!==0;return Jp=0,p}function Eo(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xs===null?rs.memoizedState=xs=p:xs=xs.next=p,xs}function ra(){if(Ks===null){var p=rs.alternate;p=p!==null?p.memoizedState:null}else p=Ks.next;var _=xs===null?rs.memoizedState:xs.next;if(_!==null)xs=_,Ks=p;else{if(p===null)throw Error(a(310));Ks=p,p={memoizedState:Ks.memoizedState,baseState:Ks.baseState,baseQueue:Ks.baseQueue,queue:Ks.queue,next:null},xs===null?rs.memoizedState=xs=p:xs=xs.next=p}return xs}function $d(p,_){return typeof _=="function"?_(p):_}function rv(p){var _=ra(),S=_.queue;if(S===null)throw Error(a(311));S.lastRenderedReducer=p;var I=Ks,j=I.baseQueue,q=S.pending;if(q!==null){if(j!==null){var ae=j.next;j.next=q.next,q.next=ae}I.baseQueue=j=q,S.pending=null}if(j!==null){q=j.next,I=I.baseState;var Te=ae=null,Ie=null,et=q;do{var Et=et.lane;if((zd&Et)===Et)Ie!==null&&(Ie=Ie.next={lane:0,action:et.action,hasEagerState:et.hasEagerState,eagerState:et.eagerState,next:null}),I=et.hasEagerState?et.eagerState:p(I,et.action);else{var St={lane:Et,action:et.action,hasEagerState:et.hasEagerState,eagerState:et.eagerState,next:null};Ie===null?(Te=Ie=St,ae=I):Ie=Ie.next=St,rs.lanes|=Et,Qd|=Et}et=et.next}while(et!==null&&et!==q);Ie===null?ae=I:Ie.next=Te,fo(I,_.memoizedState)||(na=!0),_.memoizedState=I,_.baseState=ae,_.baseQueue=Ie,S.lastRenderedState=I}if(p=S.interleaved,p!==null){j=p;do q=j.lane,rs.lanes|=q,Qd|=q,j=j.next;while(j!==p)}else j===null&&(S.lanes=0);return[_.memoizedState,S.dispatch]}function nv(p){var _=ra(),S=_.queue;if(S===null)throw Error(a(311));S.lastRenderedReducer=p;var I=S.dispatch,j=S.pending,q=_.memoizedState;if(j!==null){S.pending=null;var ae=j=j.next;do q=p(q,ae.action),ae=ae.next;while(ae!==j);fo(q,_.memoizedState)||(na=!0),_.memoizedState=q,_.baseQueue===null&&(_.baseState=q),S.lastRenderedState=q}return[q,I]}function uS(){}function hS(p,_){var S=rs,I=ra(),j=_(),q=!fo(I.memoizedState,j);if(q&&(I.memoizedState=j,na=!0),I=I.queue,Sg(fS.bind(null,S,I,p),[p]),I.getSnapshot!==_||q||xs!==null&&xs.memoizedState.tag&1){if(S.flags|=2048,zc(9,Qp.bind(null,S,I,j,_),void 0,null),zs===null)throw Error(a(349));(zd&30)!==0||pS(S,_,j)}return j}function pS(p,_,S){p.flags|=16384,p={getSnapshot:_,value:S},_=rs.updateQueue,_===null?(_={lastEffect:null,stores:null},rs.updateQueue=_,_.stores=[p]):(S=_.stores,S===null?_.stores=[p]:S.push(p))}function Qp(p,_,S,I){_.value=S,_.getSnapshot=I,Yd(_)&&wg(p)}function fS(p,_,S){return S(function(){Yd(_)&&wg(p)})}function Yd(p){var _=p.getSnapshot;p=p.value;try{var S=_();return!fo(p,S)}catch{return!0}}function wg(p){var _=qc(p,1);_!==null&&Sa(_,p,1,-1)}function Zp(p){var _=Eo();return typeof p=="function"&&(p=p()),_.memoizedState=_.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$d,lastRenderedState:p},_.queue=p,p=p.dispatch=Xd.bind(null,rs,p),[_.memoizedState,p]}function zc(p,_,S,I){return p={tag:p,create:_,destroy:S,deps:I,next:null},_=rs.updateQueue,_===null?(_={lastEffect:null,stores:null},rs.updateQueue=_,_.lastEffect=p.next=p):(S=_.lastEffect,S===null?_.lastEffect=p.next=p:(I=S.next,S.next=p,p.next=I,_.lastEffect=p)),p}function ef(){return ra().memoizedState}function bg(p,_,S,I){var j=Eo();rs.flags|=p,j.memoizedState=zc(1|_,S,void 0,I===void 0?null:I)}function tf(p,_,S,I){var j=ra();I=I===void 0?null:I;var q=void 0;if(Ks!==null){var ae=Ks.memoizedState;if(q=ae.destroy,I!==null&&ev(I,ae.deps)){j.memoizedState=zc(_,S,q,I);return}}rs.flags|=p,j.memoizedState=zc(1|_,S,q,I)}function mS(p,_){return bg(8390656,8,p,_)}function Sg(p,_){return tf(2048,8,p,_)}function gS(p,_){return tf(4,2,p,_)}function _S(p,_){return tf(4,4,p,_)}function xg(p,_){if(typeof _=="function")return p=p(),_(p),function(){_(null)};if(_!=null)return p=p(),_.current=p,function(){_.current=null}}function Tg(p,_,S){return S=S!=null?S.concat([p]):null,tf(4,4,xg.bind(null,_,p),S)}function sv(){}function yS(p,_){var S=ra();_=_===void 0?null:_;var I=S.memoizedState;return I!==null&&_!==null&&ev(_,I[1])?I[0]:(S.memoizedState=[p,_],p)}function iv(p,_){var S=ra();_=_===void 0?null:_;var I=S.memoizedState;return I!==null&&_!==null&&ev(_,I[1])?I[0]:(p=p(),S.memoizedState=[p,_],p)}function Cg(p,_,S){return(zd&21)===0?(p.baseState&&(p.baseState=!1,na=!0),p.memoizedState=S):(fo(S,_)||(S=Sb(),rs.lanes|=S,Qd|=S,p.baseState=!0),_)}function VN(p,_){var S=bn;bn=S!==0&&4>S?S:4,p(!0);var I=Z0.transition;Z0.transition={};try{p(!1),_()}finally{bn=S,Z0.transition=I}}function wo(){return ra().memoizedState}function ch(p,_,S){var I=Ql(p);if(S={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null},av(p))ov(_,S);else if(S=z0(p,_,S,I),S!==null){var j=Wi();Sa(S,p,I,j),Kl(S,_,I)}}function Xd(p,_,S){var I=Ql(p),j={lane:I,action:S,hasEagerState:!1,eagerState:null,next:null};if(av(p))ov(_,j);else{var q=p.alternate;if(p.lanes===0&&(q===null||q.lanes===0)&&(q=_.lastRenderedReducer,q!==null))try{var ae=_.lastRenderedState,Te=q(ae,S);if(j.hasEagerState=!0,j.eagerState=Te,fo(Te,ae)){var Ie=_.interleaved;Ie===null?(j.next=j,K0(_)):(j.next=Ie.next,Ie.next=j),_.interleaved=j;return}}catch{}finally{}S=z0(p,_,j,I),S!==null&&(j=Wi(),Sa(S,p,I,j),Kl(S,_,I))}}function av(p){var _=p.alternate;return p===rs||_!==null&&_===rs}function ov(p,_){Kc=Xp=!0;var S=p.pending;S===null?_.next=_:(_.next=S.next,S.next=_),p.pending=_}function Kl(p,_,S){if((S&4194240)!==0){var I=_.lanes;I&=p.pendingLanes,S|=I,_.lanes=S,a0(p,S)}}var lh={readContext:Ma,useCallback:Ri,useContext:Ri,useEffect:Ri,useImperativeHandle:Ri,useInsertionEffect:Ri,useLayoutEffect:Ri,useMemo:Ri,useReducer:Ri,useRef:Ri,useState:Ri,useDebugValue:Ri,useDeferredValue:Ri,useTransition:Ri,useMutableSource:Ri,useSyncExternalStore:Ri,useId:Ri,unstable_isNewReconciler:!1},BN={readContext:Ma,useCallback:function(p,_){return Eo().memoizedState=[p,_===void 0?null:_],p},useContext:Ma,useEffect:mS,useImperativeHandle:function(p,_,S){return S=S!=null?S.concat([p]):null,bg(4194308,4,xg.bind(null,_,p),S)},useLayoutEffect:function(p,_){return bg(4194308,4,p,_)},useInsertionEffect:function(p,_){return bg(4,2,p,_)},useMemo:function(p,_){var S=Eo();return _=_===void 0?null:_,p=p(),S.memoizedState=[p,_],p},useReducer:function(p,_,S){var I=Eo();return _=S!==void 0?S(_):_,I.memoizedState=I.baseState=_,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:_},I.queue=p,p=p.dispatch=ch.bind(null,rs,p),[I.memoizedState,p]},useRef:function(p){var _=Eo();return p={current:p},_.memoizedState=p},useState:Zp,useDebugValue:sv,useDeferredValue:function(p){return Eo().memoizedState=p},useTransition:function(){var p=Zp(!1),_=p[0];return p=VN.bind(null,p[1]),Eo().memoizedState=p,[_,p]},useMutableSource:function(){},useSyncExternalStore:function(p,_,S){var I=rs,j=Eo();if(Yn){if(S===void 0)throw Error(a(407));S=S()}else{if(S=_(),zs===null)throw Error(a(349));(zd&30)!==0||pS(I,_,S)}j.memoizedState=S;var q={value:S,getSnapshot:_};return j.queue=q,mS(fS.bind(null,I,q,p),[p]),I.flags|=2048,zc(9,Qp.bind(null,I,q,S,_),void 0,null),S},useId:function(){var p=Eo(),_=zs.identifierPrefix;if(Yn){var S=Wc,I=Bc;S=(I&~(1<<32-po(I)-1)).toString(32)+S,_=":"+_+"R"+S,S=Jp++,0<S&&(_+="H"+S.toString(32)),_+=":"}else S=FN++,_=":"+_+"r"+S.toString(32)+":";return p.memoizedState=_},unstable_isNewReconciler:!1},vS={readContext:Ma,useCallback:yS,useContext:Ma,useEffect:Sg,useImperativeHandle:Tg,useInsertionEffect:gS,useLayoutEffect:_S,useMemo:iv,useReducer:rv,useRef:ef,useState:function(){return rv($d)},useDebugValue:sv,useDeferredValue:function(p){var _=ra();return Cg(_,Ks.memoizedState,p)},useTransition:function(){var p=rv($d)[0],_=ra().memoizedState;return[p,_]},useMutableSource:uS,useSyncExternalStore:hS,useId:wo,unstable_isNewReconciler:!1},WN={readContext:Ma,useCallback:yS,useContext:Ma,useEffect:Sg,useImperativeHandle:Tg,useInsertionEffect:gS,useLayoutEffect:_S,useMemo:iv,useReducer:nv,useRef:ef,useState:function(){return nv($d)},useDebugValue:sv,useDeferredValue:function(p){var _=ra();return Ks===null?_.memoizedState=p:Cg(_,Ks.memoizedState,p)},useTransition:function(){var p=nv($d)[0],_=ra().memoizedState;return[p,_]},useMutableSource:uS,useSyncExternalStore:hS,useId:wo,unstable_isNewReconciler:!1};function Ua(p,_){if(p&&p.defaultProps){_=we({},_),p=p.defaultProps;for(var S in p)_[S]===void 0&&(_[S]=p[S]);return _}return _}function Rg(p,_,S,I){_=p.memoizedState,S=S(I,_),S=S==null?_:we({},_,S),p.memoizedState=S,p.lanes===0&&(p.updateQueue.baseState=S)}var Ng={isMounted:function(p){return(p=p._reactInternals)?Ld(p)===p:!1},enqueueSetState:function(p,_,S){p=p._reactInternals;var I=Wi(),j=Ql(p),q=Hc(I,j);q.payload=_,S!=null&&(q.callback=S),_=vo(p,q,j),_!==null&&(Sa(_,p,j,I),yg(_,p,j))},enqueueReplaceState:function(p,_,S){p=p._reactInternals;var I=Wi(),j=Ql(p),q=Hc(I,j);q.tag=1,q.payload=_,S!=null&&(q.callback=S),_=vo(p,q,j),_!==null&&(Sa(_,p,j,I),yg(_,p,j))},enqueueForceUpdate:function(p,_){p=p._reactInternals;var S=Wi(),I=Ql(p),j=Hc(S,I);j.tag=2,_!=null&&(j.callback=_),_=vo(p,j,I),_!==null&&(Sa(_,p,I,S),yg(_,p,I))}};function $c(p,_,S,I,j,q,ae){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(I,q,ae):_.prototype&&_.prototype.isPureReactComponent?!zu(S,I)||!zu(j,q):!0}function ES(p,_,S){var I=!1,j=Vl,q=_.contextType;return typeof q=="object"&&q!==null?q=Ma(q):(j=ta(_)?Bl:Ci.current,I=_.contextTypes,q=(I=I!=null)?Wl(p,j):Vl),_=new _(S,q),p.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=Ng,p.stateNode=_,_._reactInternals=p,I&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=j,p.__reactInternalMemoizedMaskedChildContext=q),_}function wS(p,_,S,I){p=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(S,I),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(S,I),_.state!==p&&Ng.enqueueReplaceState(_,_.state,null)}function cv(p,_,S,I){var j=p.stateNode;j.props=S,j.state=p.memoizedState,j.refs={},$0(p);var q=_.contextType;typeof q=="object"&&q!==null?j.context=Ma(q):(q=ta(_)?Bl:Ci.current,j.context=Wl(p,q)),j.state=p.memoizedState,q=_.getDerivedStateFromProps,typeof q=="function"&&(Rg(p,_,q,S),j.state=p.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(_=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),_!==j.state&&Ng.enqueueReplaceState(j,j.state,null),vg(p,S,j,I),j.state=p.memoizedState),typeof j.componentDidMount=="function"&&(p.flags|=4194308)}function dh(p,_){try{var S="",I=_;do S+=Je(I),I=I.return;while(I);var j=S}catch(q){j=`
Error generating stack: `+q.message+`
`+q.stack}return{value:p,source:_,stack:j,digest:null}}function Ag(p,_,S){return{value:p,source:null,stack:S??null,digest:_??null}}function lv(p,_){try{console.error(_.value)}catch(S){setTimeout(function(){throw S})}}var dv=typeof WeakMap=="function"?WeakMap:Map;function uv(p,_,S){S=Hc(-1,S),S.tag=3,S.payload={element:null};var I=_.value;return S.callback=function(){Ai||(Ai=!0,Iv=I),lv(p,_)},S}function bS(p,_,S){S=Hc(-1,S),S.tag=3;var I=p.type.getDerivedStateFromError;if(typeof I=="function"){var j=_.value;S.payload=function(){return I(j)},S.callback=function(){lv(p,_)}}var q=p.stateNode;return q!==null&&typeof q.componentDidCatch=="function"&&(S.callback=function(){lv(p,_),typeof I!="function"&&(Xl===null?Xl=new Set([this]):Xl.add(this));var ae=_.stack;this.componentDidCatch(_.value,{componentStack:ae!==null?ae:""})}),S}function hv(p,_,S){var I=p.pingCache;if(I===null){I=p.pingCache=new dv;var j=new Set;I.set(_,j)}else j=I.get(_),j===void 0&&(j=new Set,I.set(_,j));j.has(S)||(j.add(S),p=VS.bind(null,p,_,S),_.then(p,p))}function SS(p){do{var _;if((_=p.tag===13)&&(_=p.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return p;p=p.return}while(p!==null);return null}function xS(p,_,S,I,j){return(p.mode&1)===0?(p===_?p.flags|=65536:(p.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(_=Hc(-1,1),_.tag=2,vo(S,_,1))),S.lanes|=1),p):(p.flags|=65536,p.lanes=j,p)}var qN=Q.ReactCurrentOwner,na=!1;function Bi(p,_,S,I){_.child=p===null?W0(_,null,S,I):ih(_,p.child,S,I)}function TS(p,_,S,I,j){S=S.render;var q=_.ref;return yo(_,j),I=oh(p,_,S,I,q,j),S=tv(),p!==null&&!na?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~j,Yc(p,_,j)):(Yn&&S&&rh(_),_.flags|=1,Bi(p,_,I,j),_.child)}function CS(p,_,S,I,j){if(p===null){var q=S.type;return typeof q=="function"&&!Vv(q)&&q.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(_.tag=15,_.type=q,pv(p,_,q,I,j)):(p=gh(S.type,null,I,_,_.mode,j),p.ref=_.ref,p.return=_,_.child=p)}if(q=p.child,(p.lanes&j)===0){var ae=q.memoizedProps;if(S=S.compare,S=S!==null?S:zu,S(ae,I)&&p.ref===_.ref)return Yc(p,_,j)}return _.flags|=1,p=rd(q,I),p.ref=_.ref,p.return=_,_.child=p}function pv(p,_,S,I,j){if(p!==null){var q=p.memoizedProps;if(zu(q,I)&&p.ref===_.ref)if(na=!1,_.pendingProps=I=q,(p.lanes&j)!==0)(p.flags&131072)!==0&&(na=!0);else return _.lanes=p.lanes,Yc(p,_,j)}return fv(p,_,S,I,j)}function zo(p,_,S){var I=_.pendingProps,j=I.children,q=p!==null?p.memoizedState:null;if(I.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Hn(uh,ba),ba|=S;else{if((S&1073741824)===0)return p=q!==null?q.baseLanes|S:S,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:p,cachePool:null,transitions:null},_.updateQueue=null,Hn(uh,ba),ba|=p,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=q!==null?q.baseLanes:S,Hn(uh,ba),ba|=I}else q!==null?(I=q.baseLanes|S,_.memoizedState=null):I=S,Hn(uh,ba),ba|=I;return Bi(p,_,j,S),_.child}function RS(p,_){var S=_.ref;(p===null&&S!==null||p!==null&&p.ref!==S)&&(_.flags|=512,_.flags|=2097152)}function fv(p,_,S,I,j){var q=ta(S)?Bl:Ci.current;return q=Wl(_,q),yo(_,j),S=oh(p,_,S,I,q,j),I=tv(),p!==null&&!na?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~j,Yc(p,_,j)):(Yn&&I&&rh(_),_.flags|=1,Bi(p,_,S,j),_.child)}function NS(p,_,S,I,j){if(ta(S)){var q=!0;lg(_)}else q=!1;if(yo(_,j),_.stateNode===null)kg(p,_),ES(_,S,I),cv(_,S,I,j),I=!0;else if(p===null){var ae=_.stateNode,Te=_.memoizedProps;ae.props=Te;var Ie=ae.context,et=S.contextType;typeof et=="object"&&et!==null?et=Ma(et):(et=ta(S)?Bl:Ci.current,et=Wl(_,et));var Et=S.getDerivedStateFromProps,St=typeof Et=="function"||typeof ae.getSnapshotBeforeUpdate=="function";St||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Te!==I||Ie!==et)&&wS(_,ae,I,et),Gc=!1;var yt=_.memoizedState;ae.state=yt,vg(_,I,ae,j),Ie=_.memoizedState,Te!==I||yt!==Ie||Fi.current||Gc?(typeof Et=="function"&&(Rg(_,S,Et,I),Ie=_.memoizedState),(Te=Gc||$c(_,S,Te,I,yt,Ie,et))?(St||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(_.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=I,_.memoizedState=Ie),ae.props=I,ae.state=Ie,ae.context=et,I=Te):(typeof ae.componentDidMount=="function"&&(_.flags|=4194308),I=!1)}else{ae=_.stateNode,oS(p,_),Te=_.memoizedProps,et=_.type===_.elementType?Te:Ua(_.type,Te),ae.props=et,St=_.pendingProps,yt=ae.context,Ie=S.contextType,typeof Ie=="object"&&Ie!==null?Ie=Ma(Ie):(Ie=ta(S)?Bl:Ci.current,Ie=Wl(_,Ie));var qt=S.getDerivedStateFromProps;(Et=typeof qt=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Te!==St||yt!==Ie)&&wS(_,ae,I,Ie),Gc=!1,yt=_.memoizedState,ae.state=yt,vg(_,I,ae,j);var $t=_.memoizedState;Te!==St||yt!==$t||Fi.current||Gc?(typeof qt=="function"&&(Rg(_,S,qt,I),$t=_.memoizedState),(et=Gc||$c(_,S,et,I,yt,$t,Ie)||!1)?(Et||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(I,$t,Ie),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(I,$t,Ie)),typeof ae.componentDidUpdate=="function"&&(_.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Te===p.memoizedProps&&yt===p.memoizedState||(_.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Te===p.memoizedProps&&yt===p.memoizedState||(_.flags|=1024),_.memoizedProps=I,_.memoizedState=$t),ae.props=I,ae.state=$t,ae.context=Ie,I=et):(typeof ae.componentDidUpdate!="function"||Te===p.memoizedProps&&yt===p.memoizedState||(_.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Te===p.memoizedProps&&yt===p.memoizedState||(_.flags|=1024),I=!1)}return mv(p,_,S,I,q,j)}function mv(p,_,S,I,j,q){RS(p,_);var ae=(_.flags&128)!==0;if(!I&&!ae)return j&&rS(_,S,!1),Yc(p,_,q);I=_.stateNode,qN.current=_;var Te=ae&&typeof S.getDerivedStateFromError!="function"?null:I.render();return _.flags|=1,p!==null&&ae?(_.child=ih(_,p.child,null,q),_.child=ih(_,null,Te,q)):Bi(p,_,Te,q),_.memoizedState=I.state,j&&rS(_,S,!0),_.child}function AS(p){var _=p.stateNode;_.pendingContext?eh(p,_.pendingContext,_.pendingContext!==_.context):_.context&&eh(p,_.context,!1),Y0(p,_.containerInfo)}function IS(p,_,S,I,j){return qd(),sh(j),_.flags|=256,Bi(p,_,S,I),_.child}var rf={dehydrated:null,treeContext:null,retryLane:0};function gv(p){return{baseLanes:p,cachePool:null,transitions:null}}function OS(p,_,S){var I=_.pendingProps,j=as.current,q=!1,ae=(_.flags&128)!==0,Te;if((Te=ae)||(Te=p!==null&&p.memoizedState===null?!1:(j&2)!==0),Te?(q=!0,_.flags&=-129):(p===null||p.memoizedState!==null)&&(j|=1),Hn(as,j&1),p===null)return Gp(_),p=_.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((_.mode&1)===0?_.lanes=1:p.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(ae=I.children,p=I.fallback,q?(I=_.mode,q=_.child,ae={mode:"hidden",children:ae},(I&1)===0&&q!==null?(q.childLanes=0,q.pendingProps=ae):q=ff(ae,I,0,null),p=nd(p,I,S,null),q.return=_,p.return=_,q.sibling=p,_.child=q,_.child.memoizedState=gv(S),_.memoizedState=rf,p):_v(_,ae));if(j=p.memoizedState,j!==null&&(Te=j.dehydrated,Te!==null))return GN(p,_,ae,I,Te,j,S);if(q){q=I.fallback,ae=_.mode,j=p.child,Te=j.sibling;var Ie={mode:"hidden",children:I.children};return(ae&1)===0&&_.child!==j?(I=_.child,I.childLanes=0,I.pendingProps=Ie,_.deletions=null):(I=rd(j,Ie),I.subtreeFlags=j.subtreeFlags&14680064),Te!==null?q=rd(Te,q):(q=nd(q,ae,S,null),q.flags|=2),q.return=_,I.return=_,I.sibling=q,_.child=I,I=q,q=_.child,ae=p.child.memoizedState,ae=ae===null?gv(S):{baseLanes:ae.baseLanes|S,cachePool:null,transitions:ae.transitions},q.memoizedState=ae,q.childLanes=p.childLanes&~S,_.memoizedState=rf,I}return q=p.child,p=q.sibling,I=rd(q,{mode:"visible",children:I.children}),(_.mode&1)===0&&(I.lanes=S),I.return=_,I.sibling=null,p!==null&&(S=_.deletions,S===null?(_.deletions=[p],_.flags|=16):S.push(p)),_.child=I,_.memoizedState=null,I}function _v(p,_){return _=ff({mode:"visible",children:_},p.mode,0,null),_.return=p,p.child=_}function Ig(p,_,S,I){return I!==null&&sh(I),ih(_,p.child,null,S),p=_v(_,_.pendingProps.children),p.flags|=2,_.memoizedState=null,p}function GN(p,_,S,I,j,q,ae){if(S)return _.flags&256?(_.flags&=-257,I=Ag(Error(a(422))),Ig(p,_,ae,I)):_.memoizedState!==null?(_.child=p.child,_.flags|=128,null):(q=I.fallback,j=_.mode,I=ff({mode:"visible",children:I.children},j,0,null),q=nd(q,j,ae,null),q.flags|=2,I.return=_,q.return=_,I.sibling=q,_.child=I,(_.mode&1)!==0&&ih(_,p.child,null,ae),_.child.memoizedState=gv(ae),_.memoizedState=rf,q);if((_.mode&1)===0)return Ig(p,_,ae,null);if(j.data==="$!"){if(I=j.nextSibling&&j.nextSibling.dataset,I)var Te=I.dgst;return I=Te,q=Error(a(419)),I=Ag(q,I,void 0),Ig(p,_,ae,I)}if(Te=(ae&p.childLanes)!==0,na||Te){if(I=zs,I!==null){switch(ae&-ae){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}j=(j&(I.suspendedLanes|ae))!==0?0:j,j!==0&&j!==q.retryLane&&(q.retryLane=j,qc(p,j),Sa(I,p,j,-1))}return fh(),I=Ag(Error(a(421))),Ig(p,_,ae,I)}return j.data==="$?"?(_.flags|=128,_.child=p.child,_=QN.bind(null,p),j._reactRetry=_,null):(p=q.treeContext,Ea=Go(j.nextSibling),va=_,Yn=!0,_o=null,p!==null&&(Vi[La++]=Bc,Vi[La++]=Wc,Vi[La++]=Bd,Bc=p.id,Wc=p.overflow,Bd=_),_=_v(_,I.children),_.flags|=4096,_)}function kS(p,_,S){p.lanes|=_;var I=p.alternate;I!==null&&(I.lanes|=_),_g(p.return,_,S)}function Og(p,_,S,I,j){var q=p.memoizedState;q===null?p.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:I,tail:S,tailMode:j}:(q.isBackwards=_,q.rendering=null,q.renderingStartTime=0,q.last=I,q.tail=S,q.tailMode=j)}function yv(p,_,S){var I=_.pendingProps,j=I.revealOrder,q=I.tail;if(Bi(p,_,I.children,S),I=as.current,(I&2)!==0)I=I&1|2,_.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=_.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&kS(p,S,_);else if(p.tag===19)kS(p,S,_);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===_)break e;for(;p.sibling===null;){if(p.return===null||p.return===_)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}I&=1}if(Hn(as,I),(_.mode&1)===0)_.memoizedState=null;else switch(j){case"forwards":for(S=_.child,j=null;S!==null;)p=S.alternate,p!==null&&Eg(p)===null&&(j=S),S=S.sibling;S=j,S===null?(j=_.child,_.child=null):(j=S.sibling,S.sibling=null),Og(_,!1,j,S,q);break;case"backwards":for(S=null,j=_.child,_.child=null;j!==null;){if(p=j.alternate,p!==null&&Eg(p)===null){_.child=j;break}p=j.sibling,j.sibling=S,S=j,j=p}Og(_,!0,S,null,q);break;case"together":Og(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function kg(p,_){(_.mode&1)===0&&p!==null&&(p.alternate=null,_.alternate=null,_.flags|=2)}function Yc(p,_,S){if(p!==null&&(_.dependencies=p.dependencies),Qd|=_.lanes,(S&_.childLanes)===0)return null;if(p!==null&&_.child!==p.child)throw Error(a(153));if(_.child!==null){for(p=_.child,S=rd(p,p.pendingProps),_.child=S,S.return=_;p.sibling!==null;)p=p.sibling,S=S.sibling=rd(p,p.pendingProps),S.return=_;S.sibling=null}return _.child}function Pg(p,_,S){switch(_.tag){case 3:AS(_),qd();break;case 5:dS(_);break;case 1:ta(_.type)&&lg(_);break;case 4:Y0(_,_.stateNode.containerInfo);break;case 10:var I=_.type._context,j=_.memoizedProps.value;Hn(mg,I._currentValue),I._currentValue=j;break;case 13:if(I=_.memoizedState,I!==null)return I.dehydrated!==null?(Hn(as,as.current&1),_.flags|=128,null):(S&_.child.childLanes)!==0?OS(p,_,S):(Hn(as,as.current&1),p=Yc(p,_,S),p!==null?p.sibling:null);Hn(as,as.current&1);break;case 19:if(I=(S&_.childLanes)!==0,(p.flags&128)!==0){if(I)return yv(p,_,S);_.flags|=128}if(j=_.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),Hn(as,as.current),I)break;return null;case 22:case 23:return _.lanes=0,zo(p,_,S)}return Yc(p,_,S)}var Dg,jg,nf,vv;Dg=function(p,_){for(var S=_.child;S!==null;){if(S.tag===5||S.tag===6)p.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},jg=function(){},nf=function(p,_,S,I){var j=p.memoizedProps;if(j!==I){p=_.stateNode,Hl(Ko.current);var q=null;switch(S){case"input":j=Cn(p,j),I=Cn(p,I),q=[];break;case"select":j=we({},j,{value:void 0}),I=we({},I,{value:void 0}),q=[];break;case"textarea":j=En(p,j),I=En(p,I),q=[];break;default:typeof j.onClick!="function"&&typeof I.onClick=="function"&&(p.onclick=Vp)}ct(S,I);var ae;S=null;for(et in j)if(!I.hasOwnProperty(et)&&j.hasOwnProperty(et)&&j[et]!=null)if(et==="style"){var Te=j[et];for(ae in Te)Te.hasOwnProperty(ae)&&(S||(S={}),S[ae]="")}else et!=="dangerouslySetInnerHTML"&&et!=="children"&&et!=="suppressContentEditableWarning"&&et!=="suppressHydrationWarning"&&et!=="autoFocus"&&(u.hasOwnProperty(et)?q||(q=[]):(q=q||[]).push(et,null));for(et in I){var Ie=I[et];if(Te=j!=null?j[et]:void 0,I.hasOwnProperty(et)&&Ie!==Te&&(Ie!=null||Te!=null))if(et==="style")if(Te){for(ae in Te)!Te.hasOwnProperty(ae)||Ie&&Ie.hasOwnProperty(ae)||(S||(S={}),S[ae]="");for(ae in Ie)Ie.hasOwnProperty(ae)&&Te[ae]!==Ie[ae]&&(S||(S={}),S[ae]=Ie[ae])}else S||(q||(q=[]),q.push(et,S)),S=Ie;else et==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Te=Te?Te.__html:void 0,Ie!=null&&Te!==Ie&&(q=q||[]).push(et,Ie)):et==="children"?typeof Ie!="string"&&typeof Ie!="number"||(q=q||[]).push(et,""+Ie):et!=="suppressContentEditableWarning"&&et!=="suppressHydrationWarning"&&(u.hasOwnProperty(et)?(Ie!=null&&et==="onScroll"&&Gn("scroll",p),q||Te===Ie||(q=[])):(q=q||[]).push(et,Ie))}S&&(q=q||[]).push("style",S);var et=q;(_.updateQueue=et)&&(_.flags|=4)}},vv=function(p,_,S,I){S!==I&&(_.flags|=4)};function sf(p,_){if(!Yn)switch(p.tailMode){case"hidden":_=p.tail;for(var S=null;_!==null;)_.alternate!==null&&(S=_),_=_.sibling;S===null?p.tail=null:S.sibling=null;break;case"collapsed":S=p.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?_||p.tail===null?p.tail=null:p.tail.sibling=null:I.sibling=null}}function pi(p){var _=p.alternate!==null&&p.alternate.child===p.child,S=0,I=0;if(_)for(var j=p.child;j!==null;)S|=j.lanes|j.childLanes,I|=j.subtreeFlags&14680064,I|=j.flags&14680064,j.return=p,j=j.sibling;else for(j=p.child;j!==null;)S|=j.lanes|j.childLanes,I|=j.subtreeFlags,I|=j.flags,j.return=p,j=j.sibling;return p.subtreeFlags|=I,p.childLanes=S,_}function Lg(p,_,S){var I=_.pendingProps;switch(pg(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pi(_),null;case 1:return ta(_.type)&&cg(),pi(_),null;case 3:return I=_.stateNode,Kd(),Mn(Fi),Mn(Ci),Q0(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(p===null||p.child===null)&&(nh(_)?_.flags|=4:p===null||p.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,_o!==null&&(kv(_o),_o=null))),jg(p,_),pi(_),null;case 5:X0(_);var j=Hl($p.current);if(S=_.type,p!==null&&_.stateNode!=null)nf(p,_,S,I,j),p.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!I){if(_.stateNode===null)throw Error(a(166));return pi(_),null}if(p=Hl(Ko.current),nh(_)){I=_.stateNode,S=_.type;var q=_.memoizedProps;switch(I[Ho]=_,I[Bp]=q,p=(_.mode&1)!==0,S){case"dialog":Gn("cancel",I),Gn("close",I);break;case"iframe":case"object":case"embed":Gn("load",I);break;case"video":case"audio":for(j=0;j<Lp.length;j++)Gn(Lp[j],I);break;case"source":Gn("error",I);break;case"img":case"image":case"link":Gn("error",I),Gn("load",I);break;case"details":Gn("toggle",I);break;case"input":Lr(I,q),Gn("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!q.multiple},Gn("invalid",I);break;case"textarea":on(I,q),Gn("invalid",I)}ct(S,q),j=null;for(var ae in q)if(q.hasOwnProperty(ae)){var Te=q[ae];ae==="children"?typeof Te=="string"?I.textContent!==Te&&(q.suppressHydrationWarning!==!0&&Fp(I.textContent,Te,p),j=["children",Te]):typeof Te=="number"&&I.textContent!==""+Te&&(q.suppressHydrationWarning!==!0&&Fp(I.textContent,Te,p),j=["children",""+Te]):u.hasOwnProperty(ae)&&Te!=null&&ae==="onScroll"&&Gn("scroll",I)}switch(S){case"input":qe(I),jt(I,q,!0);break;case"textarea":qe(I),js(I);break;case"select":case"option":break;default:typeof q.onClick=="function"&&(I.onclick=Vp)}I=j,_.updateQueue=I,I!==null&&(_.flags|=4)}else{ae=j.nodeType===9?j:j.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=ts(S)),p==="http://www.w3.org/1999/xhtml"?S==="script"?(p=ae.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof I.is=="string"?p=ae.createElement(S,{is:I.is}):(p=ae.createElement(S),S==="select"&&(ae=p,I.multiple?ae.multiple=!0:I.size&&(ae.size=I.size))):p=ae.createElementNS(p,S),p[Ho]=_,p[Bp]=I,Dg(p,_,!1,!1),_.stateNode=p;e:{switch(ae=Pt(S,I),S){case"dialog":Gn("cancel",p),Gn("close",p),j=I;break;case"iframe":case"object":case"embed":Gn("load",p),j=I;break;case"video":case"audio":for(j=0;j<Lp.length;j++)Gn(Lp[j],p);j=I;break;case"source":Gn("error",p),j=I;break;case"img":case"image":case"link":Gn("error",p),Gn("load",p),j=I;break;case"details":Gn("toggle",p),j=I;break;case"input":Lr(p,I),j=Cn(p,I),Gn("invalid",p);break;case"option":j=I;break;case"select":p._wrapperState={wasMultiple:!!I.multiple},j=we({},I,{value:void 0}),Gn("invalid",p);break;case"textarea":on(p,I),j=En(p,I),Gn("invalid",p);break;default:j=I}ct(S,j),Te=j;for(q in Te)if(Te.hasOwnProperty(q)){var Ie=Te[q];q==="style"?tt(p,Ie):q==="dangerouslySetInnerHTML"?(Ie=Ie?Ie.__html:void 0,Ie!=null&&Ur(p,Ie)):q==="children"?typeof Ie=="string"?(S!=="textarea"||Ie!=="")&&dn(p,Ie):typeof Ie=="number"&&dn(p,""+Ie):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(u.hasOwnProperty(q)?Ie!=null&&q==="onScroll"&&Gn("scroll",p):Ie!=null&&$(p,q,Ie,ae))}switch(S){case"input":qe(p),jt(p,I,!1);break;case"textarea":qe(p),js(p);break;case"option":I.value!=null&&p.setAttribute("value",""+pt(I.value));break;case"select":p.multiple=!!I.multiple,q=I.value,q!=null?An(p,!!I.multiple,q,!1):I.defaultValue!=null&&An(p,!!I.multiple,I.defaultValue,!0);break;default:typeof j.onClick=="function"&&(p.onclick=Vp)}switch(S){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return pi(_),null;case 6:if(p&&_.stateNode!=null)vv(p,_,p.memoizedProps,I);else{if(typeof I!="string"&&_.stateNode===null)throw Error(a(166));if(S=Hl($p.current),Hl(Ko.current),nh(_)){if(I=_.stateNode,S=_.memoizedProps,I[Ho]=_,(q=I.nodeValue!==S)&&(p=va,p!==null))switch(p.tag){case 3:Fp(I.nodeValue,S,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&Fp(I.nodeValue,S,(p.mode&1)!==0)}q&&(_.flags|=4)}else I=(S.nodeType===9?S:S.ownerDocument).createTextNode(I),I[Ho]=_,_.stateNode=I}return pi(_),null;case 13:if(Mn(as),I=_.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(Yn&&Ea!==null&&(_.mode&1)!==0&&(_.flags&128)===0)V0(),qd(),_.flags|=98560,q=!1;else if(q=nh(_),I!==null&&I.dehydrated!==null){if(p===null){if(!q)throw Error(a(318));if(q=_.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(a(317));q[Ho]=_}else qd(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;pi(_),q=!1}else _o!==null&&(kv(_o),_o=null),q=!0;if(!q)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=S,_):(I=I!==null,I!==(p!==null&&p.memoizedState!==null)&&I&&(_.child.flags|=8192,(_.mode&1)!==0&&(p===null||(as.current&1)!==0?$s===0&&($s=3):fh())),_.updateQueue!==null&&(_.flags|=4),pi(_),null);case 4:return Kd(),jg(p,_),p===null&&Mc(_.stateNode.containerInfo),pi(_),null;case 10:return H0(_.type._context),pi(_),null;case 17:return ta(_.type)&&cg(),pi(_),null;case 19:if(Mn(as),q=_.memoizedState,q===null)return pi(_),null;if(I=(_.flags&128)!==0,ae=q.rendering,ae===null)if(I)sf(q,!1);else{if($s!==0||p!==null&&(p.flags&128)!==0)for(p=_.child;p!==null;){if(ae=Eg(p),ae!==null){for(_.flags|=128,sf(q,!1),I=ae.updateQueue,I!==null&&(_.updateQueue=I,_.flags|=4),_.subtreeFlags=0,I=S,S=_.child;S!==null;)q=S,p=I,q.flags&=14680066,ae=q.alternate,ae===null?(q.childLanes=0,q.lanes=p,q.child=null,q.subtreeFlags=0,q.memoizedProps=null,q.memoizedState=null,q.updateQueue=null,q.dependencies=null,q.stateNode=null):(q.childLanes=ae.childLanes,q.lanes=ae.lanes,q.child=ae.child,q.subtreeFlags=0,q.deletions=null,q.memoizedProps=ae.memoizedProps,q.memoizedState=ae.memoizedState,q.updateQueue=ae.updateQueue,q.type=ae.type,p=ae.dependencies,q.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),S=S.sibling;return Hn(as,as.current&1|2),_.child}p=p.sibling}q.tail!==null&&Ss()>Fa&&(_.flags|=128,I=!0,sf(q,!1),_.lanes=4194304)}else{if(!I)if(p=Eg(ae),p!==null){if(_.flags|=128,I=!0,S=p.updateQueue,S!==null&&(_.updateQueue=S,_.flags|=4),sf(q,!0),q.tail===null&&q.tailMode==="hidden"&&!ae.alternate&&!Yn)return pi(_),null}else 2*Ss()-q.renderingStartTime>Fa&&S!==1073741824&&(_.flags|=128,I=!0,sf(q,!1),_.lanes=4194304);q.isBackwards?(ae.sibling=_.child,_.child=ae):(S=q.last,S!==null?S.sibling=ae:_.child=ae,q.last=ae)}return q.tail!==null?(_=q.tail,q.rendering=_,q.tail=_.sibling,q.renderingStartTime=Ss(),_.sibling=null,S=as.current,Hn(as,I?S&1|2:S&1),_):(pi(_),null);case 22:case 23:return hf(),I=_.memoizedState!==null,p!==null&&p.memoizedState!==null!==I&&(_.flags|=8192),I&&(_.mode&1)!==0?(ba&1073741824)!==0&&(pi(_),_.subtreeFlags&6&&(_.flags|=8192)):pi(_),null;case 24:return null;case 25:return null}throw Error(a(156,_.tag))}function HN(p,_){switch(pg(_),_.tag){case 1:return ta(_.type)&&cg(),p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 3:return Kd(),Mn(Fi),Mn(Ci),Q0(),p=_.flags,(p&65536)!==0&&(p&128)===0?(_.flags=p&-65537|128,_):null;case 5:return X0(_),null;case 13:if(Mn(as),p=_.memoizedState,p!==null&&p.dehydrated!==null){if(_.alternate===null)throw Error(a(340));qd()}return p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 19:return Mn(as),null;case 4:return Kd(),null;case 10:return H0(_.type._context),null;case 22:case 23:return hf(),null;case 24:return null;default:return null}}var af=!1,fi=!1,KN=typeof WeakSet=="function"?WeakSet:Set,Ht=null;function Jd(p,_){var S=p.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(I){os(p,_,I)}else S.current=null}function Ev(p,_,S){try{S()}catch(I){os(p,_,I)}}var PS=!1;function zN(p,_){if(P0=Ym,p=T0(),C0(p)){if("selectionStart"in p)var S={start:p.selectionStart,end:p.selectionEnd};else e:{S=(S=p.ownerDocument)&&S.defaultView||window;var I=S.getSelection&&S.getSelection();if(I&&I.rangeCount!==0){S=I.anchorNode;var j=I.anchorOffset,q=I.focusNode;I=I.focusOffset;try{S.nodeType,q.nodeType}catch{S=null;break e}var ae=0,Te=-1,Ie=-1,et=0,Et=0,St=p,yt=null;t:for(;;){for(var qt;St!==S||j!==0&&St.nodeType!==3||(Te=ae+j),St!==q||I!==0&&St.nodeType!==3||(Ie=ae+I),St.nodeType===3&&(ae+=St.nodeValue.length),(qt=St.firstChild)!==null;)yt=St,St=qt;for(;;){if(St===p)break t;if(yt===S&&++et===j&&(Te=ae),yt===q&&++Et===I&&(Ie=ae),(qt=St.nextSibling)!==null)break;St=yt,yt=St.parentNode}St=qt}S=Te===-1||Ie===-1?null:{start:Te,end:Ie}}else S=null}S=S||{start:0,end:0}}else S=null;for(ig={focusedElem:p,selectionRange:S},Ym=!1,Ht=_;Ht!==null;)if(_=Ht,p=_.child,(_.subtreeFlags&1028)!==0&&p!==null)p.return=_,Ht=p;else for(;Ht!==null;){_=Ht;try{var $t=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if($t!==null){var Xt=$t.memoizedProps,cs=$t.memoizedState,Ge=_.stateNode,Pe=Ge.getSnapshotBeforeUpdate(_.elementType===_.type?Xt:Ua(_.type,Xt),cs);Ge.__reactInternalSnapshotBeforeUpdate=Pe}break;case 3:var Ye=_.stateNode.containerInfo;Ye.nodeType===1?Ye.textContent="":Ye.nodeType===9&&Ye.documentElement&&Ye.removeChild(Ye.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Rt){os(_,_.return,Rt)}if(p=_.sibling,p!==null){p.return=_.return,Ht=p;break}Ht=_.return}return $t=PS,PS=!1,$t}function zl(p,_,S){var I=_.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var j=I=I.next;do{if((j.tag&p)===p){var q=j.destroy;j.destroy=void 0,q!==void 0&&Ev(_,S,q)}j=j.next}while(j!==I)}}function Mg(p,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var S=_=_.next;do{if((S.tag&p)===p){var I=S.create;S.destroy=I()}S=S.next}while(S!==_)}}function wv(p){var _=p.ref;if(_!==null){var S=p.stateNode;switch(p.tag){case 5:p=S;break;default:p=S}typeof _=="function"?_(p):_.current=p}}function DS(p){var _=p.alternate;_!==null&&(p.alternate=null,DS(_)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(_=p.stateNode,_!==null&&(delete _[Ho],delete _[Bp],delete _[j0],delete _[LN],delete _[MN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function bv(p){return p.tag===5||p.tag===3||p.tag===4}function jS(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||bv(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Sv(p,_,S){var I=p.tag;if(I===5||I===6)p=p.stateNode,_?S.nodeType===8?S.parentNode.insertBefore(p,_):S.insertBefore(p,_):(S.nodeType===8?(_=S.parentNode,_.insertBefore(p,S)):(_=S,_.appendChild(p)),S=S._reactRootContainer,S!=null||_.onclick!==null||(_.onclick=Vp));else if(I!==4&&(p=p.child,p!==null))for(Sv(p,_,S),p=p.sibling;p!==null;)Sv(p,_,S),p=p.sibling}function of(p,_,S){var I=p.tag;if(I===5||I===6)p=p.stateNode,_?S.insertBefore(p,_):S.appendChild(p);else if(I!==4&&(p=p.child,p!==null))for(of(p,_,S),p=p.sibling;p!==null;)of(p,_,S),p=p.sibling}var mi=null,wa=!1;function $l(p,_,S){for(S=S.child;S!==null;)xv(p,_,S),S=S.sibling}function xv(p,_,S){if(Wo&&typeof Wo.onCommitFiberUnmount=="function")try{Wo.onCommitFiberUnmount(Lu,S)}catch{}switch(S.tag){case 5:fi||Jd(S,_);case 6:var I=mi,j=wa;mi=null,$l(p,_,S),mi=I,wa=j,mi!==null&&(wa?(p=mi,S=S.stateNode,p.nodeType===8?p.parentNode.removeChild(S):p.removeChild(S)):mi.removeChild(S.stateNode));break;case 18:mi!==null&&(wa?(p=mi,S=S.stateNode,p.nodeType===8?ag(p.parentNode,S):p.nodeType===1&&ag(p,S),Vu(p)):ag(mi,S.stateNode));break;case 4:I=mi,j=wa,mi=S.stateNode.containerInfo,wa=!0,$l(p,_,S),mi=I,wa=j;break;case 0:case 11:case 14:case 15:if(!fi&&(I=S.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){j=I=I.next;do{var q=j,ae=q.destroy;q=q.tag,ae!==void 0&&((q&2)!==0||(q&4)!==0)&&Ev(S,_,ae),j=j.next}while(j!==I)}$l(p,_,S);break;case 1:if(!fi&&(Jd(S,_),I=S.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=S.memoizedProps,I.state=S.memoizedState,I.componentWillUnmount()}catch(Te){os(S,_,Te)}$l(p,_,S);break;case 21:$l(p,_,S);break;case 22:S.mode&1?(fi=(I=fi)||S.memoizedState!==null,$l(p,_,S),fi=I):$l(p,_,S);break;default:$l(p,_,S)}}function LS(p){var _=p.updateQueue;if(_!==null){p.updateQueue=null;var S=p.stateNode;S===null&&(S=p.stateNode=new KN),_.forEach(function(I){var j=mh.bind(null,p,I);S.has(I)||(S.add(I),I.then(j,j))})}}function bo(p,_){var S=_.deletions;if(S!==null)for(var I=0;I<S.length;I++){var j=S[I];try{var q=p,ae=_,Te=ae;e:for(;Te!==null;){switch(Te.tag){case 5:mi=Te.stateNode,wa=!1;break e;case 3:mi=Te.stateNode.containerInfo,wa=!0;break e;case 4:mi=Te.stateNode.containerInfo,wa=!0;break e}Te=Te.return}if(mi===null)throw Error(a(160));xv(q,ae,j),mi=null,wa=!1;var Ie=j.alternate;Ie!==null&&(Ie.return=null),j.return=null}catch(et){os(j,_,et)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)Tv(_,p),_=_.sibling}function Tv(p,_){var S=p.alternate,I=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(bo(_,p),$o(p),I&4){try{zl(3,p,p.return),Mg(3,p)}catch(Xt){os(p,p.return,Xt)}try{zl(5,p,p.return)}catch(Xt){os(p,p.return,Xt)}}break;case 1:bo(_,p),$o(p),I&512&&S!==null&&Jd(S,S.return);break;case 5:if(bo(_,p),$o(p),I&512&&S!==null&&Jd(S,S.return),p.flags&32){var j=p.stateNode;try{dn(j,"")}catch(Xt){os(p,p.return,Xt)}}if(I&4&&(j=p.stateNode,j!=null)){var q=p.memoizedProps,ae=S!==null?S.memoizedProps:q,Te=p.type,Ie=p.updateQueue;if(p.updateQueue=null,Ie!==null)try{Te==="input"&&q.type==="radio"&&q.name!=null&&Le(j,q),Pt(Te,ae);var et=Pt(Te,q);for(ae=0;ae<Ie.length;ae+=2){var Et=Ie[ae],St=Ie[ae+1];Et==="style"?tt(j,St):Et==="dangerouslySetInnerHTML"?Ur(j,St):Et==="children"?dn(j,St):$(j,Et,St,et)}switch(Te){case"input":it(j,q);break;case"textarea":Sr(j,q);break;case"select":var yt=j._wrapperState.wasMultiple;j._wrapperState.wasMultiple=!!q.multiple;var qt=q.value;qt!=null?An(j,!!q.multiple,qt,!1):yt!==!!q.multiple&&(q.defaultValue!=null?An(j,!!q.multiple,q.defaultValue,!0):An(j,!!q.multiple,q.multiple?[]:"",!1))}j[Bp]=q}catch(Xt){os(p,p.return,Xt)}}break;case 6:if(bo(_,p),$o(p),I&4){if(p.stateNode===null)throw Error(a(162));j=p.stateNode,q=p.memoizedProps;try{j.nodeValue=q}catch(Xt){os(p,p.return,Xt)}}break;case 3:if(bo(_,p),$o(p),I&4&&S!==null&&S.memoizedState.isDehydrated)try{Vu(_.containerInfo)}catch(Xt){os(p,p.return,Xt)}break;case 4:bo(_,p),$o(p);break;case 13:bo(_,p),$o(p),j=p.child,j.flags&8192&&(q=j.memoizedState!==null,j.stateNode.isHidden=q,!q||j.alternate!==null&&j.alternate.memoizedState!==null||(Av=Ss())),I&4&&LS(p);break;case 22:if(Et=S!==null&&S.memoizedState!==null,p.mode&1?(fi=(et=fi)||Et,bo(_,p),fi=et):bo(_,p),$o(p),I&8192){if(et=p.memoizedState!==null,(p.stateNode.isHidden=et)&&!Et&&(p.mode&1)!==0)for(Ht=p,Et=p.child;Et!==null;){for(St=Ht=Et;Ht!==null;){switch(yt=Ht,qt=yt.child,yt.tag){case 0:case 11:case 14:case 15:zl(4,yt,yt.return);break;case 1:Jd(yt,yt.return);var $t=yt.stateNode;if(typeof $t.componentWillUnmount=="function"){I=yt,S=yt.return;try{_=I,$t.props=_.memoizedProps,$t.state=_.memoizedState,$t.componentWillUnmount()}catch(Xt){os(I,S,Xt)}}break;case 5:Jd(yt,yt.return);break;case 22:if(yt.memoizedState!==null){Ug(St);continue}}qt!==null?(qt.return=yt,Ht=qt):Ug(St)}Et=Et.sibling}e:for(Et=null,St=p;;){if(St.tag===5){if(Et===null){Et=St;try{j=St.stateNode,et?(q=j.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none"):(Te=St.stateNode,Ie=St.memoizedProps.style,ae=Ie!=null&&Ie.hasOwnProperty("display")?Ie.display:null,Te.style.display=Be("display",ae))}catch(Xt){os(p,p.return,Xt)}}}else if(St.tag===6){if(Et===null)try{St.stateNode.nodeValue=et?"":St.memoizedProps}catch(Xt){os(p,p.return,Xt)}}else if((St.tag!==22&&St.tag!==23||St.memoizedState===null||St===p)&&St.child!==null){St.child.return=St,St=St.child;continue}if(St===p)break e;for(;St.sibling===null;){if(St.return===null||St.return===p)break e;Et===St&&(Et=null),St=St.return}Et===St&&(Et=null),St.sibling.return=St.return,St=St.sibling}}break;case 19:bo(_,p),$o(p),I&4&&LS(p);break;case 21:break;default:bo(_,p),$o(p)}}function $o(p){var _=p.flags;if(_&2){try{e:{for(var S=p.return;S!==null;){if(bv(S)){var I=S;break e}S=S.return}throw Error(a(160))}switch(I.tag){case 5:var j=I.stateNode;I.flags&32&&(dn(j,""),I.flags&=-33);var q=jS(p);of(p,q,j);break;case 3:case 4:var ae=I.stateNode.containerInfo,Te=jS(p);Sv(p,Te,ae);break;default:throw Error(a(161))}}catch(Ie){os(p,p.return,Ie)}p.flags&=-3}_&4096&&(p.flags&=-4097)}function $N(p,_,S){Ht=p,Cv(p)}function Cv(p,_,S){for(var I=(p.mode&1)!==0;Ht!==null;){var j=Ht,q=j.child;if(j.tag===22&&I){var ae=j.memoizedState!==null||af;if(!ae){var Te=j.alternate,Ie=Te!==null&&Te.memoizedState!==null||fi;Te=af;var et=fi;if(af=ae,(fi=Ie)&&!et)for(Ht=j;Ht!==null;)ae=Ht,Ie=ae.child,ae.tag===22&&ae.memoizedState!==null?MS(j):Ie!==null?(Ie.return=ae,Ht=Ie):MS(j);for(;q!==null;)Ht=q,Cv(q),q=q.sibling;Ht=j,af=Te,fi=et}Rv(p)}else(j.subtreeFlags&8772)!==0&&q!==null?(q.return=j,Ht=q):Rv(p)}}function Rv(p){for(;Ht!==null;){var _=Ht;if((_.flags&8772)!==0){var S=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:fi||Mg(5,_);break;case 1:var I=_.stateNode;if(_.flags&4&&!fi)if(S===null)I.componentDidMount();else{var j=_.elementType===_.type?S.memoizedProps:Ua(_.type,S.memoizedProps);I.componentDidUpdate(j,S.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var q=_.updateQueue;q!==null&&lS(_,q,I);break;case 3:var ae=_.updateQueue;if(ae!==null){if(S=null,_.child!==null)switch(_.child.tag){case 5:S=_.child.stateNode;break;case 1:S=_.child.stateNode}lS(_,ae,S)}break;case 5:var Te=_.stateNode;if(S===null&&_.flags&4){S=Te;var Ie=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Ie.autoFocus&&S.focus();break;case"img":Ie.src&&(S.src=Ie.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var et=_.alternate;if(et!==null){var Et=et.memoizedState;if(Et!==null){var St=Et.dehydrated;St!==null&&Vu(St)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}fi||_.flags&512&&wv(_)}catch(yt){os(_,_.return,yt)}}if(_===p){Ht=null;break}if(S=_.sibling,S!==null){S.return=_.return,Ht=S;break}Ht=_.return}}function Ug(p){for(;Ht!==null;){var _=Ht;if(_===p){Ht=null;break}var S=_.sibling;if(S!==null){S.return=_.return,Ht=S;break}Ht=_.return}}function MS(p){for(;Ht!==null;){var _=Ht;try{switch(_.tag){case 0:case 11:case 15:var S=_.return;try{Mg(4,_)}catch(Ie){os(_,S,Ie)}break;case 1:var I=_.stateNode;if(typeof I.componentDidMount=="function"){var j=_.return;try{I.componentDidMount()}catch(Ie){os(_,j,Ie)}}var q=_.return;try{wv(_)}catch(Ie){os(_,q,Ie)}break;case 5:var ae=_.return;try{wv(_)}catch(Ie){os(_,ae,Ie)}}}catch(Ie){os(_,_.return,Ie)}if(_===p){Ht=null;break}var Te=_.sibling;if(Te!==null){Te.return=_.return,Ht=Te;break}Ht=_.return}}var YN=Math.ceil,Yl=Q.ReactCurrentDispatcher,Fg=Q.ReactCurrentOwner,Ni=Q.ReactCurrentBatchConfig,Yr=0,zs=null,hs=null,Ms=0,ba=0,uh=go(0),$s=0,hh=null,Qd=0,Vg=0,Nv=0,Zd=null,Ts=null,Av=0,Fa=1/0,Yo=null,Ai=!1,Iv=null,Xl=null,cf=!1,Jl=null,lf=0,ph=0,Ov=null,df=-1,Bg=0;function Wi(){return(Yr&6)!==0?Ss():df!==-1?df:df=Ss()}function Ql(p){return(p.mode&1)===0?1:(Yr&2)!==0&&Ms!==0?Ms&-Ms:Hp.transition!==null?(Bg===0&&(Bg=Sb()),Bg):(p=bn,p!==0||(p=window.event,p=p===void 0?16:Nb(p.type)),p)}function Sa(p,_,S,I){if(50<ph)throw ph=0,Ov=null,Error(a(185));Sp(p,S,I),((Yr&2)===0||p!==zs)&&(p===zs&&((Yr&2)===0&&(Vg|=S),$s===4&&Zl(p,Ms)),Ii(p,I),S===1&&Yr===0&&(_.mode&1)===0&&(Fa=Ss()+500,dg&&ql()))}function Ii(p,_){var S=p.callbackNode;bb(p,_);var I=Gm(p,p===zs?Ms:0);if(I===0)S!==null&&_b(S),p.callbackNode=null,p.callbackPriority=0;else if(_=I&-I,p.callbackPriority!==_){if(S!=null&&_b(S),_===1)p.tag===0?UN(Wg.bind(null,p)):U0(Wg.bind(null,p)),DN(function(){(Yr&6)===0&&ql()}),S=null;else{switch(o0(I)){case 1:S=us;break;case 4:S=yb;break;case 16:S=Wm;break;case 536870912:S=vb;break;default:S=Wm}S=Uv(S,US.bind(null,p))}p.callbackPriority=_,p.callbackNode=S}}function US(p,_){if(df=-1,Bg=0,(Yr&6)!==0)throw Error(a(327));var S=p.callbackNode;if(td()&&p.callbackNode!==S)return null;var I=Gm(p,p===zs?Ms:0);if(I===0)return null;if((I&30)!==0||(I&p.expiredLanes)!==0||_)_=pf(p,I);else{_=I;var j=Yr;Yr|=2;var q=Dv();(zs!==p||Ms!==_)&&(Yo=null,Fa=Ss()+500,Xc(p,_));do try{JN();break}catch(Te){Pv(p,Te)}while(!0);G0(),Yl.current=q,Yr=j,hs!==null?_=0:(zs=null,Ms=0,_=$s)}if(_!==0){if(_===2&&(j=s0(p),j!==0&&(I=j,_=uf(p,j))),_===1)throw S=hh,Xc(p,0),Zl(p,I),Ii(p,Ss()),S;if(_===6)Zl(p,I);else{if(j=p.current.alternate,(I&30)===0&&!FS(j)&&(_=pf(p,I),_===2&&(q=s0(p),q!==0&&(I=q,_=uf(p,q))),_===1))throw S=hh,Xc(p,0),Zl(p,I),Ii(p,Ss()),S;switch(p.finishedWork=j,p.finishedLanes=I,_){case 0:case 1:throw Error(a(345));case 2:Va(p,Ts,Yo);break;case 3:if(Zl(p,I),(I&130023424)===I&&(_=Av+500-Ss(),10<_)){if(Gm(p,0)!==0)break;if(j=p.suspendedLanes,(j&I)!==I){Wi(),p.pingedLanes|=p.suspendedLanes&j;break}p.timeoutHandle=D0(Va.bind(null,p,Ts,Yo),_);break}Va(p,Ts,Yo);break;case 4:if(Zl(p,I),(I&4194240)===I)break;for(_=p.eventTimes,j=-1;0<I;){var ae=31-po(I);q=1<<ae,ae=_[ae],ae>j&&(j=ae),I&=~q}if(I=j,I=Ss()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*YN(I/1960))-I,10<I){p.timeoutHandle=D0(Va.bind(null,p,Ts,Yo),I);break}Va(p,Ts,Yo);break;case 5:Va(p,Ts,Yo);break;default:throw Error(a(329))}}}return Ii(p,Ss()),p.callbackNode===S?US.bind(null,p):null}function uf(p,_){var S=Zd;return p.current.memoizedState.isDehydrated&&(Xc(p,_).flags|=256),p=pf(p,_),p!==2&&(_=Ts,Ts=S,_!==null&&kv(_)),p}function kv(p){Ts===null?Ts=p:Ts.push.apply(Ts,p)}function FS(p){for(var _=p;;){if(_.flags&16384){var S=_.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var I=0;I<S.length;I++){var j=S[I],q=j.getSnapshot;j=j.value;try{if(!fo(q(),j))return!1}catch{return!1}}}if(S=_.child,_.subtreeFlags&16384&&S!==null)S.return=_,_=S;else{if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Zl(p,_){for(_&=~Nv,_&=~Vg,p.suspendedLanes|=_,p.pingedLanes&=~_,p=p.expirationTimes;0<_;){var S=31-po(_),I=1<<S;p[S]=-1,_&=~I}}function Wg(p){if((Yr&6)!==0)throw Error(a(327));td();var _=Gm(p,0);if((_&1)===0)return Ii(p,Ss()),null;var S=pf(p,_);if(p.tag!==0&&S===2){var I=s0(p);I!==0&&(_=I,S=uf(p,I))}if(S===1)throw S=hh,Xc(p,0),Zl(p,_),Ii(p,Ss()),S;if(S===6)throw Error(a(345));return p.finishedWork=p.current.alternate,p.finishedLanes=_,Va(p,Ts,Yo),Ii(p,Ss()),null}function eu(p,_){var S=Yr;Yr|=1;try{return p(_)}finally{Yr=S,Yr===0&&(Fa=Ss()+500,dg&&ql())}}function ed(p){Jl!==null&&Jl.tag===0&&(Yr&6)===0&&td();var _=Yr;Yr|=1;var S=Ni.transition,I=bn;try{if(Ni.transition=null,bn=1,p)return p()}finally{bn=I,Ni.transition=S,Yr=_,(Yr&6)===0&&ql()}}function hf(){ba=uh.current,Mn(uh)}function Xc(p,_){p.finishedWork=null,p.finishedLanes=0;var S=p.timeoutHandle;if(S!==-1&&(p.timeoutHandle=-1,PN(S)),hs!==null)for(S=hs.return;S!==null;){var I=S;switch(pg(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&cg();break;case 3:Kd(),Mn(Fi),Mn(Ci),Q0();break;case 5:X0(I);break;case 4:Kd();break;case 13:Mn(as);break;case 19:Mn(as);break;case 10:H0(I.type._context);break;case 22:case 23:hf()}S=S.return}if(zs=p,hs=p=rd(p.current,null),Ms=ba=_,$s=0,hh=null,Nv=Vg=Qd=0,Ts=Zd=null,Gd!==null){for(_=0;_<Gd.length;_++)if(S=Gd[_],I=S.interleaved,I!==null){S.interleaved=null;var j=I.next,q=S.pending;if(q!==null){var ae=q.next;q.next=j,I.next=ae}S.pending=I}Gd=null}return p}function Pv(p,_){do{var S=hs;try{if(G0(),Yp.current=lh,Xp){for(var I=rs.memoizedState;I!==null;){var j=I.queue;j!==null&&(j.pending=null),I=I.next}Xp=!1}if(zd=0,xs=Ks=rs=null,Kc=!1,Jp=0,Fg.current=null,S===null||S.return===null){$s=1,hh=_,hs=null;break}e:{var q=p,ae=S.return,Te=S,Ie=_;if(_=Ms,Te.flags|=32768,Ie!==null&&typeof Ie=="object"&&typeof Ie.then=="function"){var et=Ie,Et=Te,St=Et.tag;if((Et.mode&1)===0&&(St===0||St===11||St===15)){var yt=Et.alternate;yt?(Et.updateQueue=yt.updateQueue,Et.memoizedState=yt.memoizedState,Et.lanes=yt.lanes):(Et.updateQueue=null,Et.memoizedState=null)}var qt=SS(ae);if(qt!==null){qt.flags&=-257,xS(qt,ae,Te,q,_),qt.mode&1&&hv(q,et,_),_=qt,Ie=et;var $t=_.updateQueue;if($t===null){var Xt=new Set;Xt.add(Ie),_.updateQueue=Xt}else $t.add(Ie);break e}else{if((_&1)===0){hv(q,et,_),fh();break e}Ie=Error(a(426))}}else if(Yn&&Te.mode&1){var cs=SS(ae);if(cs!==null){(cs.flags&65536)===0&&(cs.flags|=256),xS(cs,ae,Te,q,_),sh(dh(Ie,Te));break e}}q=Ie=dh(Ie,Te),$s!==4&&($s=2),Zd===null?Zd=[q]:Zd.push(q),q=ae;do{switch(q.tag){case 3:q.flags|=65536,_&=-_,q.lanes|=_;var Ge=uv(q,Ie,_);cS(q,Ge);break e;case 1:Te=Ie;var Pe=q.type,Ye=q.stateNode;if((q.flags&128)===0&&(typeof Pe.getDerivedStateFromError=="function"||Ye!==null&&typeof Ye.componentDidCatch=="function"&&(Xl===null||!Xl.has(Ye)))){q.flags|=65536,_&=-_,q.lanes|=_;var Rt=bS(q,Te,_);cS(q,Rt);break e}}q=q.return}while(q!==null)}Lv(S)}catch(Jt){_=Jt,hs===S&&S!==null&&(hs=S=S.return);continue}break}while(!0)}function Dv(){var p=Yl.current;return Yl.current=lh,p===null?lh:p}function fh(){($s===0||$s===3||$s===2)&&($s=4),zs===null||(Qd&268435455)===0&&(Vg&268435455)===0||Zl(zs,Ms)}function pf(p,_){var S=Yr;Yr|=2;var I=Dv();(zs!==p||Ms!==_)&&(Yo=null,Xc(p,_));do try{XN();break}catch(j){Pv(p,j)}while(!0);if(G0(),Yr=S,Yl.current=I,hs!==null)throw Error(a(261));return zs=null,Ms=0,$s}function XN(){for(;hs!==null;)jv(hs)}function JN(){for(;hs!==null&&!JR();)jv(hs)}function jv(p){var _=WS(p.alternate,p,ba);p.memoizedProps=p.pendingProps,_===null?Lv(p):hs=_,Fg.current=null}function Lv(p){var _=p;do{var S=_.alternate;if(p=_.return,(_.flags&32768)===0){if(S=Lg(S,_,ba),S!==null){hs=S;return}}else{if(S=HN(S,_),S!==null){S.flags&=32767,hs=S;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{$s=6,hs=null;return}}if(_=_.sibling,_!==null){hs=_;return}hs=_=p}while(_!==null);$s===0&&($s=5)}function Va(p,_,S){var I=bn,j=Ni.transition;try{Ni.transition=null,bn=1,Mv(p,_,S,I)}finally{Ni.transition=j,bn=I}return null}function Mv(p,_,S,I){do td();while(Jl!==null);if((Yr&6)!==0)throw Error(a(327));S=p.finishedWork;var j=p.finishedLanes;if(S===null)return null;if(p.finishedWork=null,p.finishedLanes=0,S===p.current)throw Error(a(177));p.callbackNode=null,p.callbackPriority=0;var q=S.lanes|S.childLanes;if(rN(p,q),p===zs&&(hs=zs=null,Ms=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||cf||(cf=!0,Uv(Wm,function(){return td(),null})),q=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||q){q=Ni.transition,Ni.transition=null;var ae=bn;bn=1;var Te=Yr;Yr|=4,Fg.current=null,zN(p,S),Tv(S,p),NN(ig),Ym=!!P0,ig=P0=null,p.current=S,$N(S),Bo(),Yr=Te,bn=ae,Ni.transition=q}else p.current=S;if(cf&&(cf=!1,Jl=p,lf=j),q=p.pendingLanes,q===0&&(Xl=null),Eb(S.stateNode),Ii(p,Ss()),_!==null)for(I=p.onRecoverableError,S=0;S<_.length;S++)j=_[S],I(j.value,{componentStack:j.stack,digest:j.digest});if(Ai)throw Ai=!1,p=Iv,Iv=null,p;return(lf&1)!==0&&p.tag!==0&&td(),q=p.pendingLanes,(q&1)!==0?p===Ov?ph++:(ph=0,Ov=p):ph=0,ql(),null}function td(){if(Jl!==null){var p=o0(lf),_=Ni.transition,S=bn;try{if(Ni.transition=null,bn=16>p?16:p,Jl===null)var I=!1;else{if(p=Jl,Jl=null,lf=0,(Yr&6)!==0)throw Error(a(331));var j=Yr;for(Yr|=4,Ht=p.current;Ht!==null;){var q=Ht,ae=q.child;if((Ht.flags&16)!==0){var Te=q.deletions;if(Te!==null){for(var Ie=0;Ie<Te.length;Ie++){var et=Te[Ie];for(Ht=et;Ht!==null;){var Et=Ht;switch(Et.tag){case 0:case 11:case 15:zl(8,Et,q)}var St=Et.child;if(St!==null)St.return=Et,Ht=St;else for(;Ht!==null;){Et=Ht;var yt=Et.sibling,qt=Et.return;if(DS(Et),Et===et){Ht=null;break}if(yt!==null){yt.return=qt,Ht=yt;break}Ht=qt}}}var $t=q.alternate;if($t!==null){var Xt=$t.child;if(Xt!==null){$t.child=null;do{var cs=Xt.sibling;Xt.sibling=null,Xt=cs}while(Xt!==null)}}Ht=q}}if((q.subtreeFlags&2064)!==0&&ae!==null)ae.return=q,Ht=ae;else e:for(;Ht!==null;){if(q=Ht,(q.flags&2048)!==0)switch(q.tag){case 0:case 11:case 15:zl(9,q,q.return)}var Ge=q.sibling;if(Ge!==null){Ge.return=q.return,Ht=Ge;break e}Ht=q.return}}var Pe=p.current;for(Ht=Pe;Ht!==null;){ae=Ht;var Ye=ae.child;if((ae.subtreeFlags&2064)!==0&&Ye!==null)Ye.return=ae,Ht=Ye;else e:for(ae=Pe;Ht!==null;){if(Te=Ht,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:Mg(9,Te)}}catch(Jt){os(Te,Te.return,Jt)}if(Te===ae){Ht=null;break e}var Rt=Te.sibling;if(Rt!==null){Rt.return=Te.return,Ht=Rt;break e}Ht=Te.return}}if(Yr=j,ql(),Wo&&typeof Wo.onPostCommitFiberRoot=="function")try{Wo.onPostCommitFiberRoot(Lu,p)}catch{}I=!0}return I}finally{bn=S,Ni.transition=_}}return!1}function qg(p,_,S){_=dh(S,_),_=uv(p,_,1),p=vo(p,_,1),_=Wi(),p!==null&&(Sp(p,1,_),Ii(p,_))}function os(p,_,S){if(p.tag===3)qg(p,p,S);else for(;_!==null;){if(_.tag===3){qg(_,p,S);break}else if(_.tag===1){var I=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Xl===null||!Xl.has(I))){p=dh(S,p),p=bS(_,p,1),_=vo(_,p,1),p=Wi(),_!==null&&(Sp(_,1,p),Ii(_,p));break}}_=_.return}}function VS(p,_,S){var I=p.pingCache;I!==null&&I.delete(_),_=Wi(),p.pingedLanes|=p.suspendedLanes&S,zs===p&&(Ms&S)===S&&($s===4||$s===3&&(Ms&130023424)===Ms&&500>Ss()-Av?Xc(p,0):Nv|=S),Ii(p,_)}function BS(p,_){_===0&&((p.mode&1)===0?_=1:(_=qm,qm<<=1,(qm&130023424)===0&&(qm=4194304)));var S=Wi();p=qc(p,_),p!==null&&(Sp(p,_,S),Ii(p,S))}function QN(p){var _=p.memoizedState,S=0;_!==null&&(S=_.retryLane),BS(p,S)}function mh(p,_){var S=0;switch(p.tag){case 13:var I=p.stateNode,j=p.memoizedState;j!==null&&(S=j.retryLane);break;case 19:I=p.stateNode;break;default:throw Error(a(314))}I!==null&&I.delete(_),BS(p,S)}var WS;WS=function(p,_,S){if(p!==null)if(p.memoizedProps!==_.pendingProps||Fi.current)na=!0;else{if((p.lanes&S)===0&&(_.flags&128)===0)return na=!1,Pg(p,_,S);na=(p.flags&131072)!==0}else na=!1,Yn&&(_.flags&1048576)!==0&&nS(_,hg,_.index);switch(_.lanes=0,_.tag){case 2:var I=_.type;kg(p,_),p=_.pendingProps;var j=Wl(_,Ci.current);yo(_,S),j=oh(null,_,I,p,j,S);var q=tv();return _.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,ta(I)?(q=!0,lg(_)):q=!1,_.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,$0(_),j.updater=Ng,_.stateNode=j,j._reactInternals=_,cv(_,I,p,S),_=mv(null,_,I,!0,q,S)):(_.tag=0,Yn&&q&&rh(_),Bi(null,_,j,S),_=_.child),_;case 16:I=_.elementType;e:{switch(kg(p,_),p=_.pendingProps,j=I._init,I=j(I._payload),_.type=I,j=_.tag=ZN(I),p=Ua(I,p),j){case 0:_=fv(null,_,I,p,S);break e;case 1:_=NS(null,_,I,p,S);break e;case 11:_=TS(null,_,I,p,S);break e;case 14:_=CS(null,_,I,Ua(I.type,p),S);break e}throw Error(a(306,I,""))}return _;case 0:return I=_.type,j=_.pendingProps,j=_.elementType===I?j:Ua(I,j),fv(p,_,I,j,S);case 1:return I=_.type,j=_.pendingProps,j=_.elementType===I?j:Ua(I,j),NS(p,_,I,j,S);case 3:e:{if(AS(_),p===null)throw Error(a(387));I=_.pendingProps,q=_.memoizedState,j=q.element,oS(p,_),vg(_,I,null,S);var ae=_.memoizedState;if(I=ae.element,q.isDehydrated)if(q={element:I,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},_.updateQueue.baseState=q,_.memoizedState=q,_.flags&256){j=dh(Error(a(423)),_),_=IS(p,_,I,S,j);break e}else if(I!==j){j=dh(Error(a(424)),_),_=IS(p,_,I,S,j);break e}else for(Ea=Go(_.stateNode.containerInfo.firstChild),va=_,Yn=!0,_o=null,S=W0(_,null,I,S),_.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(qd(),I===j){_=Yc(p,_,S);break e}Bi(p,_,I,S)}_=_.child}return _;case 5:return dS(_),p===null&&Gp(_),I=_.type,j=_.pendingProps,q=p!==null?p.memoizedProps:null,ae=j.children,Qu(I,j)?ae=null:q!==null&&Qu(I,q)&&(_.flags|=32),RS(p,_),Bi(p,_,ae,S),_.child;case 6:return p===null&&Gp(_),null;case 13:return OS(p,_,S);case 4:return Y0(_,_.stateNode.containerInfo),I=_.pendingProps,p===null?_.child=ih(_,null,I,S):Bi(p,_,I,S),_.child;case 11:return I=_.type,j=_.pendingProps,j=_.elementType===I?j:Ua(I,j),TS(p,_,I,j,S);case 7:return Bi(p,_,_.pendingProps,S),_.child;case 8:return Bi(p,_,_.pendingProps.children,S),_.child;case 12:return Bi(p,_,_.pendingProps.children,S),_.child;case 10:e:{if(I=_.type._context,j=_.pendingProps,q=_.memoizedProps,ae=j.value,Hn(mg,I._currentValue),I._currentValue=ae,q!==null)if(fo(q.value,ae)){if(q.children===j.children&&!Fi.current){_=Yc(p,_,S);break e}}else for(q=_.child,q!==null&&(q.return=_);q!==null;){var Te=q.dependencies;if(Te!==null){ae=q.child;for(var Ie=Te.firstContext;Ie!==null;){if(Ie.context===I){if(q.tag===1){Ie=Hc(-1,S&-S),Ie.tag=2;var et=q.updateQueue;if(et!==null){et=et.shared;var Et=et.pending;Et===null?Ie.next=Ie:(Ie.next=Et.next,Et.next=Ie),et.pending=Ie}}q.lanes|=S,Ie=q.alternate,Ie!==null&&(Ie.lanes|=S),_g(q.return,S,_),Te.lanes|=S;break}Ie=Ie.next}}else if(q.tag===10)ae=q.type===_.type?null:q.child;else if(q.tag===18){if(ae=q.return,ae===null)throw Error(a(341));ae.lanes|=S,Te=ae.alternate,Te!==null&&(Te.lanes|=S),_g(ae,S,_),ae=q.sibling}else ae=q.child;if(ae!==null)ae.return=q;else for(ae=q;ae!==null;){if(ae===_){ae=null;break}if(q=ae.sibling,q!==null){q.return=ae.return,ae=q;break}ae=ae.return}q=ae}Bi(p,_,j.children,S),_=_.child}return _;case 9:return j=_.type,I=_.pendingProps.children,yo(_,S),j=Ma(j),I=I(j),_.flags|=1,Bi(p,_,I,S),_.child;case 14:return I=_.type,j=Ua(I,_.pendingProps),j=Ua(I.type,j),CS(p,_,I,j,S);case 15:return pv(p,_,_.type,_.pendingProps,S);case 17:return I=_.type,j=_.pendingProps,j=_.elementType===I?j:Ua(I,j),kg(p,_),_.tag=1,ta(I)?(p=!0,lg(_)):p=!1,yo(_,S),ES(_,I,j),cv(_,I,j,S),mv(null,_,I,!0,p,S);case 19:return yv(p,_,S);case 22:return zo(p,_,S)}throw Error(a(156,_.tag))};function Uv(p,_){return Md(p,_)}function Fv(p,_,S,I){this.tag=p,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ba(p,_,S,I){return new Fv(p,_,S,I)}function Vv(p){return p=p.prototype,!(!p||!p.isReactComponent)}function ZN(p){if(typeof p=="function")return Vv(p)?1:0;if(p!=null){if(p=p.$$typeof,p===he)return 11;if(p===me)return 14}return 2}function rd(p,_){var S=p.alternate;return S===null?(S=Ba(p.tag,_,p.key,p.mode),S.elementType=p.elementType,S.type=p.type,S.stateNode=p.stateNode,S.alternate=p,p.alternate=S):(S.pendingProps=_,S.type=p.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=p.flags&14680064,S.childLanes=p.childLanes,S.lanes=p.lanes,S.child=p.child,S.memoizedProps=p.memoizedProps,S.memoizedState=p.memoizedState,S.updateQueue=p.updateQueue,_=p.dependencies,S.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},S.sibling=p.sibling,S.index=p.index,S.ref=p.ref,S}function gh(p,_,S,I,j,q){var ae=2;if(I=p,typeof p=="function")Vv(p)&&(ae=1);else if(typeof p=="string")ae=5;else e:switch(p){case ie:return nd(S.children,j,q,_);case ce:ae=8,j|=8;break;case Se:return p=Ba(12,S,_,j|2),p.elementType=Se,p.lanes=q,p;case Ze:return p=Ba(13,S,_,j),p.elementType=Ze,p.lanes=q,p;case Qe:return p=Ba(19,S,_,j),p.elementType=Qe,p.lanes=q,p;case ge:return ff(S,j,q,_);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case oe:ae=10;break e;case ve:ae=9;break e;case he:ae=11;break e;case me:ae=14;break e;case ye:ae=16,I=null;break e}throw Error(a(130,p==null?p:typeof p,""))}return _=Ba(ae,S,_,j),_.elementType=p,_.type=I,_.lanes=q,_}function nd(p,_,S,I){return p=Ba(7,p,I,_),p.lanes=S,p}function ff(p,_,S,I){return p=Ba(22,p,I,_),p.elementType=ge,p.lanes=S,p.stateNode={isHidden:!1},p}function Gg(p,_,S){return p=Ba(6,p,null,_),p.lanes=S,p}function _h(p,_,S){return _=Ba(4,p.children!==null?p.children:[],p.key,_),_.lanes=S,_.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},_}function Bv(p,_,S,I,j){this.tag=_,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=i0(0),this.expirationTimes=i0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=i0(0),this.identifierPrefix=I,this.onRecoverableError=j,this.mutableSourceEagerHydrationData=null}function yh(p,_,S,I,j,q,ae,Te,Ie){return p=new Bv(p,_,S,Te,Ie),_===1?(_=1,q===!0&&(_|=8)):_=0,q=Ba(3,null,null,_),p.current=q,q.stateNode=p,q.memoizedState={element:I,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},$0(q),p}function Hg(p,_,S){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:se,key:I==null?null:""+I,children:p,containerInfo:_,implementation:S}}function Wv(p){if(!p)return Vl;p=p._reactInternals;e:{if(Ld(p)!==p||p.tag!==1)throw Error(a(170));var _=p;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(ta(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(a(171))}if(p.tag===1){var S=p.type;if(ta(S))return tS(p,S,_)}return _}function tu(p,_,S,I,j,q,ae,Te,Ie){return p=yh(S,I,!0,p,j,q,ae,Te,Ie),p.context=Wv(null),S=p.current,I=Wi(),j=Ql(S),q=Hc(I,j),q.callback=_??null,vo(S,q,j),p.current.lanes=j,Sp(p,j,I),Ii(p,I),p}function Xo(p,_,S,I){var j=_.current,q=Wi(),ae=Ql(j);return S=Wv(S),_.context===null?_.context=S:_.pendingContext=S,_=Hc(q,ae),_.payload={element:p},I=I===void 0?null:I,I!==null&&(_.callback=I),p=vo(j,_,ae),p!==null&&(Sa(p,j,ae,q),yg(p,j,ae)),ae}function Kg(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function vh(p,_){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var S=p.retryLane;p.retryLane=S!==0&&S<_?S:_}}function qv(p,_){vh(p,_),(p=p.alternate)&&vh(p,_)}function eA(){return null}var qS=typeof reportError=="function"?reportError:function(p){console.error(p)};function Gv(p){this._internalRoot=p}mf.prototype.render=Gv.prototype.render=function(p){var _=this._internalRoot;if(_===null)throw Error(a(409));Xo(p,_,null,null)},mf.prototype.unmount=Gv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var _=p.containerInfo;ed(function(){Xo(null,p,null,null)}),_[Uc]=null}};function mf(p){this._internalRoot=p}mf.prototype.unstable_scheduleHydration=function(p){if(p){var _=xb();p={blockedOn:null,target:p,priority:_};for(var S=0;S<Pl.length&&_!==0&&_<Pl[S].priority;S++);Pl.splice(S,0,p),S===0&&Fu(p)}};function gf(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function _f(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function GS(){}function HS(p,_,S,I,j){if(j){if(typeof I=="function"){var q=I;I=function(){var et=Kg(ae);q.call(et)}}var ae=tu(_,I,p,0,null,!1,!1,"",GS);return p._reactRootContainer=ae,p[Uc]=ae.current,Mc(p.nodeType===8?p.parentNode:p),ed(),ae}for(;j=p.lastChild;)p.removeChild(j);if(typeof I=="function"){var Te=I;I=function(){var et=Kg(Ie);Te.call(et)}}var Ie=yh(p,0,!1,null,null,!1,!1,"",GS);return p._reactRootContainer=Ie,p[Uc]=Ie.current,Mc(p.nodeType===8?p.parentNode:p),ed(function(){Xo(_,Ie,S,I)}),Ie}function zg(p,_,S,I,j){var q=S._reactRootContainer;if(q){var ae=q;if(typeof j=="function"){var Te=j;j=function(){var Ie=Kg(ae);Te.call(Ie)}}Xo(_,ae,p,j)}else ae=HS(S,_,p,j,I);return Kg(ae)}Hm=function(p){switch(p.tag){case 3:var _=p.stateNode;if(_.current.memoizedState.isDehydrated){var S=wn(_.pendingLanes);S!==0&&(a0(_,S|1),Ii(_,Ss()),(Yr&6)===0&&(Fa=Ss()+500,ql()))}break;case 13:ed(function(){var I=qc(p,1);if(I!==null){var j=Wi();Sa(I,p,1,j)}}),qv(p,1)}},c0=function(p){if(p.tag===13){var _=qc(p,134217728);if(_!==null){var S=Wi();Sa(_,p,134217728,S)}qv(p,134217728)}},Km=function(p){if(p.tag===13){var _=Ql(p),S=qc(p,_);if(S!==null){var I=Wi();Sa(S,p,_,I)}qv(p,_)}},xb=function(){return bn},l0=function(p,_){var S=bn;try{return bn=p,_()}finally{bn=S}},Vo=function(p,_,S){switch(_){case"input":if(it(p,S),_=S.name,S.type==="radio"&&_!=null){for(S=p;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<S.length;_++){var I=S[_];if(I!==p&&I.form===p.form){var j=og(I);if(!j)throw Error(a(90));Wr(I),it(I,j)}}}break;case"textarea":Sr(p,S);break;case"select":_=S.value,_!=null&&An(p,!!S.multiple,_,!1)}},qn=eu,Ls=ed;var yf={usingClientEntryPoint:!1,Events:[Wp,Zu,og,ar,kn,eu]},sa={findFiberByHostInstance:Vd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},KS={bundleType:sa.bundleType,version:sa.version,rendererPackageName:sa.rendererPackageName,rendererConfig:sa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Q.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Bm(p),p===null?null:p.stateNode},findFiberByHostInstance:sa.findFiberByHostInstance||eA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $g=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$g.isDisabled&&$g.supportsFiber)try{Lu=$g.inject(KS),Wo=$g}catch{}}return to.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yf,to.createPortal=function(p,_){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gf(_))throw Error(a(200));return Hg(p,_,null,S)},to.createRoot=function(p,_){if(!gf(p))throw Error(a(299));var S=!1,I="",j=qS;return _!=null&&(_.unstable_strictMode===!0&&(S=!0),_.identifierPrefix!==void 0&&(I=_.identifierPrefix),_.onRecoverableError!==void 0&&(j=_.onRecoverableError)),_=yh(p,1,!1,null,null,S,!1,I,j),p[Uc]=_.current,Mc(p.nodeType===8?p.parentNode:p),new Gv(_)},to.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var _=p._reactInternals;if(_===void 0)throw typeof p.render=="function"?Error(a(188)):(p=Object.keys(p).join(","),Error(a(268,p)));return p=Bm(_),p=p===null?null:p.stateNode,p},to.flushSync=function(p){return ed(p)},to.hydrate=function(p,_,S){if(!_f(_))throw Error(a(200));return zg(null,p,_,!0,S)},to.hydrateRoot=function(p,_,S){if(!gf(p))throw Error(a(405));var I=S!=null&&S.hydratedSources||null,j=!1,q="",ae=qS;if(S!=null&&(S.unstable_strictMode===!0&&(j=!0),S.identifierPrefix!==void 0&&(q=S.identifierPrefix),S.onRecoverableError!==void 0&&(ae=S.onRecoverableError)),_=tu(_,null,p,1,S??null,j,!1,q,ae),p[Uc]=_.current,Mc(p),I)for(p=0;p<I.length;p++)S=I[p],j=S._getVersion,j=j(S._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[S,j]:_.mutableSourceEagerHydrationData.push(S,j);return new mf(_)},to.render=function(p,_,S){if(!_f(_))throw Error(a(200));return zg(null,p,_,!1,S)},to.unmountComponentAtNode=function(p){if(!_f(p))throw Error(a(40));return p._reactRootContainer?(ed(function(){zg(null,null,p,!1,function(){p._reactRootContainer=null,p[Uc]=null})}),!0):!1},to.unstable_batchedUpdates=eu,to.unstable_renderSubtreeIntoContainer=function(p,_,S,I){if(!_f(S))throw Error(a(200));if(p==null||p._reactInternals===void 0)throw Error(a(38));return zg(p,_,S,!1,I)},to.version="18.3.1-next-f1338f8080-20240426",to}var G8;function XG(){if(G8)return sk.exports;G8=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(n){console.error(n)}}return i(),sk.exports=zie(),sk.exports}var H8;function $ie(){if(H8)return yC;H8=1;var i=XG();return yC.createRoot=i.createRoot,yC.hydrateRoot=i.hydrateRoot,yC}var Yie=$ie();const Xie=Qw(Yie);var Gy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Jie={setTimeout:(i,n)=>setTimeout(i,n),clearTimeout:i=>clearTimeout(i),setInterval:(i,n)=>setInterval(i,n),clearInterval:i=>clearInterval(i)},Zh,lD,MG,Qie=(MG=class{constructor(){cr(this,Zh,Jie);cr(this,lD,!1)}setTimeoutProvider(i){Bt(this,Zh,i)}setTimeout(i,n){return Re(this,Zh).setTimeout(i,n)}clearTimeout(i){Re(this,Zh).clearTimeout(i)}setInterval(i,n){return Re(this,Zh).setInterval(i,n)}clearInterval(i){Re(this,Zh).clearInterval(i)}},Zh=new WeakMap,lD=new WeakMap,MG),hm=new Qie;function Zie(i){setTimeout(i,0)}var km=typeof window>"u"||"Deno"in globalThis;function Oa(){}function eae(i,n){return typeof i=="function"?i(n):i}function Gk(i){return typeof i=="number"&&i>=0&&i!==1/0}function JG(i,n){return Math.max(i+(n||0)-Date.now(),0)}function lp(i,n){return typeof i=="function"?i(n):i}function wc(i,n){return typeof i=="function"?i(n):i}function K8(i,n){const{type:a="all",exact:l,fetchStatus:u,predicate:m,queryKey:y,stale:w}=i;if(y){if(l){if(n.queryHash!==uD(y,n.options))return!1}else if(!Rw(n.queryKey,y))return!1}if(a!=="all"){const b=n.isActive();if(a==="active"&&!b||a==="inactive"&&b)return!1}return!(typeof w=="boolean"&&n.isStale()!==w||u&&u!==n.state.fetchStatus||m&&!m(n))}function z8(i,n){const{exact:a,status:l,predicate:u,mutationKey:m}=i;if(m){if(!n.options.mutationKey)return!1;if(a){if(Pm(n.options.mutationKey)!==Pm(m))return!1}else if(!Rw(n.options.mutationKey,m))return!1}return!(l&&n.state.status!==l||u&&!u(n))}function uD(i,n){return((n==null?void 0:n.queryKeyHashFn)||Pm)(i)}function Pm(i){return JSON.stringify(i,(n,a)=>Hk(a)?Object.keys(a).sort().reduce((l,u)=>(l[u]=a[u],l),{}):a)}function Rw(i,n){return i===n?!0:typeof i!=typeof n?!1:i&&n&&typeof i=="object"&&typeof n=="object"?Object.keys(n).every(a=>Rw(i[a],n[a])):!1}var tae=Object.prototype.hasOwnProperty;function QG(i,n){if(i===n)return i;const a=$8(i)&&$8(n);if(!a&&!(Hk(i)&&Hk(n)))return n;const u=(a?i:Object.keys(i)).length,m=a?n:Object.keys(n),y=m.length,w=a?new Array(y):{};let b=0;for(let x=0;x<y;x++){const T=a?x:m[x],N=i[T],O=n[T];if(N===O){w[T]=N,(a?x<u:tae.call(i,T))&&b++;continue}if(N===null||O===null||typeof N!="object"||typeof O!="object"){w[T]=O;continue}const P=QG(N,O);w[T]=P,P===N&&b++}return u===y&&b===u?i:w}function sR(i,n){if(!n||Object.keys(i).length!==Object.keys(n).length)return!1;for(const a in i)if(i[a]!==n[a])return!1;return!0}function $8(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function Hk(i){if(!Y8(i))return!1;const n=i.constructor;if(n===void 0)return!0;const a=n.prototype;return!(!Y8(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function Y8(i){return Object.prototype.toString.call(i)==="[object Object]"}function rae(i){return new Promise(n=>{hm.setTimeout(n,i)})}function Kk(i,n,a){return typeof a.structuralSharing=="function"?a.structuralSharing(i,n):a.structuralSharing!==!1?QG(i,n):n}function nae(i,n,a=0){const l=[...i,n];return a&&l.length>a?l.slice(1):l}function sae(i,n,a=0){const l=[n,...i];return a&&l.length>a?l.slice(0,-1):l}var hD=Symbol();function ZG(i,n){return!i.queryFn&&(n!=null&&n.initialPromise)?()=>n.initialPromise:!i.queryFn||i.queryFn===hD?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}function eH(i,n){return typeof i=="function"?i(...n):!!i}var Em,ep,Sy,UG,iae=(UG=class extends Gy{constructor(){super();cr(this,Em);cr(this,ep);cr(this,Sy);Bt(this,Sy,n=>{if(!km&&window.addEventListener){const a=()=>n();return window.addEventListener("visibilitychange",a,!1),()=>{window.removeEventListener("visibilitychange",a)}}})}onSubscribe(){Re(this,ep)||this.setEventListener(Re(this,Sy))}onUnsubscribe(){var n;this.hasListeners()||((n=Re(this,ep))==null||n.call(this),Bt(this,ep,void 0))}setEventListener(n){var a;Bt(this,Sy,n),(a=Re(this,ep))==null||a.call(this),Bt(this,ep,n(l=>{typeof l=="boolean"?this.setFocused(l):this.onFocus()}))}setFocused(n){Re(this,Em)!==n&&(Bt(this,Em,n),this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(a=>{a(n)})}isFocused(){var n;return typeof Re(this,Em)=="boolean"?Re(this,Em):((n=globalThis.document)==null?void 0:n.visibilityState)!=="hidden"}},Em=new WeakMap,ep=new WeakMap,Sy=new WeakMap,UG),pD=new iae;function zk(){let i,n;const a=new Promise((u,m)=>{i=u,n=m});a.status="pending",a.catch(()=>{});function l(u){Object.assign(a,u),delete a.resolve,delete a.reject}return a.resolve=u=>{l({status:"fulfilled",value:u}),i(u)},a.reject=u=>{l({status:"rejected",reason:u}),n(u)},a}var aae=Zie;function oae(){let i=[],n=0,a=w=>{w()},l=w=>{w()},u=aae;const m=w=>{n?i.push(w):u(()=>{a(w)})},y=()=>{const w=i;i=[],w.length&&u(()=>{l(()=>{w.forEach(b=>{a(b)})})})};return{batch:w=>{let b;n++;try{b=w()}finally{n--,n||y()}return b},batchCalls:w=>(...b)=>{m(()=>{w(...b)})},schedule:m,setNotifyFunction:w=>{a=w},setBatchNotifyFunction:w=>{l=w},setScheduler:w=>{u=w}}}var wi=oae(),xy,tp,Ty,FG,cae=(FG=class extends Gy{constructor(){super();cr(this,xy,!0);cr(this,tp);cr(this,Ty);Bt(this,Ty,n=>{if(!km&&window.addEventListener){const a=()=>n(!0),l=()=>n(!1);return window.addEventListener("online",a,!1),window.addEventListener("offline",l,!1),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",l)}}})}onSubscribe(){Re(this,tp)||this.setEventListener(Re(this,Ty))}onUnsubscribe(){var n;this.hasListeners()||((n=Re(this,tp))==null||n.call(this),Bt(this,tp,void 0))}setEventListener(n){var a;Bt(this,Ty,n),(a=Re(this,tp))==null||a.call(this),Bt(this,tp,n(this.setOnline.bind(this)))}setOnline(n){Re(this,xy)!==n&&(Bt(this,xy,n),this.listeners.forEach(l=>{l(n)}))}isOnline(){return Re(this,xy)}},xy=new WeakMap,tp=new WeakMap,Ty=new WeakMap,FG),iR=new cae;function lae(i){return Math.min(1e3*2**i,3e4)}function tH(i){return(i??"online")==="online"?iR.isOnline():!0}var $k=class extends Error{constructor(i){super("CancelledError"),this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}};function rH(i){let n=!1,a=0,l;const u=zk(),m=()=>u.status!=="pending",y=z=>{var V;if(!m()){const W=new $k(z);O(W),(V=i.onCancel)==null||V.call(i,W)}},w=()=>{n=!0},b=()=>{n=!1},x=()=>pD.isFocused()&&(i.networkMode==="always"||iR.isOnline())&&i.canRun(),T=()=>tH(i.networkMode)&&i.canRun(),N=z=>{m()||(l==null||l(),u.resolve(z))},O=z=>{m()||(l==null||l(),u.reject(z))},P=()=>new Promise(z=>{var V;l=W=>{(m()||x())&&z(W)},(V=i.onPause)==null||V.call(i)}).then(()=>{var z;l=void 0,m()||(z=i.onContinue)==null||z.call(i)}),F=()=>{if(m())return;let z;const V=a===0?i.initialPromise:void 0;try{z=V??i.fn()}catch(W){z=Promise.reject(W)}Promise.resolve(z).then(N).catch(W=>{var se;if(m())return;const te=i.retry??(km?0:3),$=i.retryDelay??lae,Q=typeof $=="function"?$(a,W):$,G=te===!0||typeof te=="number"&&a<te||typeof te=="function"&&te(a,W);if(n||!G){O(W);return}a++,(se=i.onFail)==null||se.call(i,a,W),rae(Q).then(()=>x()?void 0:P()).then(()=>{n?O(W):F()})})};return{promise:u,status:()=>u.status,cancel:y,continue:()=>(l==null||l(),u),cancelRetry:w,continueRetry:b,canStart:T,start:()=>(T()?F():P().then(F),u)}}var wm,VG,nH=(VG=class{constructor(){cr(this,wm)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Gk(this.gcTime)&&Bt(this,wm,hm.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(km?1/0:300*1e3))}clearGcTimeout(){Re(this,wm)&&(hm.clearTimeout(Re(this,wm)),Bt(this,wm,void 0))}},wm=new WeakMap,VG),bm,Cy,Ec,Sm,Mi,zw,xm,bl,vu,BG,dae=(BG=class extends nH{constructor(n){super();cr(this,bl);cr(this,bm);cr(this,Cy);cr(this,Ec);cr(this,Sm);cr(this,Mi);cr(this,zw);cr(this,xm);Bt(this,xm,!1),Bt(this,zw,n.defaultOptions),this.setOptions(n.options),this.observers=[],Bt(this,Sm,n.client),Bt(this,Ec,Re(this,Sm).getQueryCache()),this.queryKey=n.queryKey,this.queryHash=n.queryHash,Bt(this,bm,J8(this.options)),this.state=n.state??Re(this,bm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var n;return(n=Re(this,Mi))==null?void 0:n.promise}setOptions(n){if(this.options={...Re(this,zw),...n},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const a=J8(this.options);a.data!==void 0&&(this.setState(X8(a.data,a.dataUpdatedAt)),Bt(this,bm,a))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Re(this,Ec).remove(this)}setData(n,a){const l=Kk(this.state.data,n,this.options);return Jr(this,bl,vu).call(this,{data:l,type:"success",dataUpdatedAt:a==null?void 0:a.updatedAt,manual:a==null?void 0:a.manual}),l}setState(n,a){Jr(this,bl,vu).call(this,{type:"setState",state:n,setStateOptions:a})}cancel(n){var l,u;const a=(l=Re(this,Mi))==null?void 0:l.promise;return(u=Re(this,Mi))==null||u.cancel(n),a?a.then(Oa).catch(Oa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Re(this,bm))}isActive(){return this.observers.some(n=>wc(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===hD||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(n=>lp(n.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(n=0){return this.state.data===void 0?!0:n==="static"?!1:this.state.isInvalidated?!0:!JG(this.state.dataUpdatedAt,n)}onFocus(){var a;const n=this.observers.find(l=>l.shouldFetchOnWindowFocus());n==null||n.refetch({cancelRefetch:!1}),(a=Re(this,Mi))==null||a.continue()}onOnline(){var a;const n=this.observers.find(l=>l.shouldFetchOnReconnect());n==null||n.refetch({cancelRefetch:!1}),(a=Re(this,Mi))==null||a.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),Re(this,Ec).notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(a=>a!==n),this.observers.length||(Re(this,Mi)&&(Re(this,xm)?Re(this,Mi).cancel({revert:!0}):Re(this,Mi).cancelRetry()),this.scheduleGc()),Re(this,Ec).notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Jr(this,bl,vu).call(this,{type:"invalidate"})}async fetch(n,a){var b,x,T,N,O,P,F,z,V,W,te,$;if(this.state.fetchStatus!=="idle"&&((b=Re(this,Mi))==null?void 0:b.status())!=="rejected"){if(this.state.data!==void 0&&(a!=null&&a.cancelRefetch))this.cancel({silent:!0});else if(Re(this,Mi))return Re(this,Mi).continueRetry(),Re(this,Mi).promise}if(n&&this.setOptions(n),!this.options.queryFn){const Q=this.observers.find(G=>G.options.queryFn);Q&&this.setOptions(Q.options)}const l=new AbortController,u=Q=>{Object.defineProperty(Q,"signal",{enumerable:!0,get:()=>(Bt(this,xm,!0),l.signal)})},m=()=>{const Q=ZG(this.options,a),se=(()=>{const ie={client:Re(this,Sm),queryKey:this.queryKey,meta:this.meta};return u(ie),ie})();return Bt(this,xm,!1),this.options.persister?this.options.persister(Q,se,this):Q(se)},w=(()=>{const Q={fetchOptions:a,options:this.options,queryKey:this.queryKey,client:Re(this,Sm),state:this.state,fetchFn:m};return u(Q),Q})();(x=this.options.behavior)==null||x.onFetch(w,this),Bt(this,Cy,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((T=w.fetchOptions)==null?void 0:T.meta))&&Jr(this,bl,vu).call(this,{type:"fetch",meta:(N=w.fetchOptions)==null?void 0:N.meta}),Bt(this,Mi,rH({initialPromise:a==null?void 0:a.initialPromise,fn:w.fetchFn,onCancel:Q=>{Q instanceof $k&&Q.revert&&this.setState({...Re(this,Cy),fetchStatus:"idle"}),l.abort()},onFail:(Q,G)=>{Jr(this,bl,vu).call(this,{type:"failed",failureCount:Q,error:G})},onPause:()=>{Jr(this,bl,vu).call(this,{type:"pause"})},onContinue:()=>{Jr(this,bl,vu).call(this,{type:"continue"})},retry:w.options.retry,retryDelay:w.options.retryDelay,networkMode:w.options.networkMode,canRun:()=>!0}));try{const Q=await Re(this,Mi).start();if(Q===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(Q),(P=(O=Re(this,Ec).config).onSuccess)==null||P.call(O,Q,this),(z=(F=Re(this,Ec).config).onSettled)==null||z.call(F,Q,this.state.error,this),Q}catch(Q){if(Q instanceof $k){if(Q.silent)return Re(this,Mi).promise;if(Q.revert){if(this.state.data===void 0)throw Q;return this.state.data}}throw Jr(this,bl,vu).call(this,{type:"error",error:Q}),(W=(V=Re(this,Ec).config).onError)==null||W.call(V,Q,this),($=(te=Re(this,Ec).config).onSettled)==null||$.call(te,this.state.data,Q,this),Q}finally{this.scheduleGc()}}},bm=new WeakMap,Cy=new WeakMap,Ec=new WeakMap,Sm=new WeakMap,Mi=new WeakMap,zw=new WeakMap,xm=new WeakMap,bl=new WeakSet,vu=function(n){const a=l=>{switch(n.type){case"failed":return{...l,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...l,fetchStatus:"paused"};case"continue":return{...l,fetchStatus:"fetching"};case"fetch":return{...l,...sH(l.data,this.options),fetchMeta:n.meta??null};case"success":const u={...l,...X8(n.data,n.dataUpdatedAt),dataUpdateCount:l.dataUpdateCount+1,...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Bt(this,Cy,n.manual?u:void 0),u;case"error":const m=n.error;return{...l,error:m,errorUpdateCount:l.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:l.fetchFailureCount+1,fetchFailureReason:m,fetchStatus:"idle",status:"error"};case"invalidate":return{...l,isInvalidated:!0};case"setState":return{...l,...n.state}}};this.state=a(this.state),wi.batch(()=>{this.observers.forEach(l=>{l.onQueryUpdate()}),Re(this,Ec).notify({query:this,type:"updated",action:n})})},BG);function sH(i,n){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:tH(n.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function X8(i,n){return{data:i,dataUpdatedAt:n??Date.now(),error:null,isInvalidated:!1,status:"success"}}function J8(i){const n=typeof i.initialData=="function"?i.initialData():i.initialData,a=n!==void 0,l=a?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:n,dataUpdateCount:0,dataUpdatedAt:a?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var no,fn,$w,Aa,Tm,Ry,bu,rp,Yw,Ny,Ay,Cm,Rm,np,Iy,Ln,mw,Yk,Xk,Jk,Qk,Zk,eP,tP,iH,WG,uae=(WG=class extends Gy{constructor(n,a){super();cr(this,Ln);cr(this,no);cr(this,fn);cr(this,$w);cr(this,Aa);cr(this,Tm);cr(this,Ry);cr(this,bu);cr(this,rp);cr(this,Yw);cr(this,Ny);cr(this,Ay);cr(this,Cm);cr(this,Rm);cr(this,np);cr(this,Iy,new Set);this.options=a,Bt(this,no,n),Bt(this,rp,null),Bt(this,bu,zk()),this.bindMethods(),this.setOptions(a)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(Re(this,fn).addObserver(this),Q8(Re(this,fn),this.options)?Jr(this,Ln,mw).call(this):this.updateResult(),Jr(this,Ln,Qk).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return rP(Re(this,fn),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return rP(Re(this,fn),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Jr(this,Ln,Zk).call(this),Jr(this,Ln,eP).call(this),Re(this,fn).removeObserver(this)}setOptions(n){const a=this.options,l=Re(this,fn);if(this.options=Re(this,no).defaultQueryOptions(n),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof wc(this.options.enabled,Re(this,fn))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Jr(this,Ln,tP).call(this),Re(this,fn).setOptions(this.options),a._defaulted&&!sR(this.options,a)&&Re(this,no).getQueryCache().notify({type:"observerOptionsUpdated",query:Re(this,fn),observer:this});const u=this.hasListeners();u&&Z8(Re(this,fn),l,this.options,a)&&Jr(this,Ln,mw).call(this),this.updateResult(),u&&(Re(this,fn)!==l||wc(this.options.enabled,Re(this,fn))!==wc(a.enabled,Re(this,fn))||lp(this.options.staleTime,Re(this,fn))!==lp(a.staleTime,Re(this,fn)))&&Jr(this,Ln,Yk).call(this);const m=Jr(this,Ln,Xk).call(this);u&&(Re(this,fn)!==l||wc(this.options.enabled,Re(this,fn))!==wc(a.enabled,Re(this,fn))||m!==Re(this,np))&&Jr(this,Ln,Jk).call(this,m)}getOptimisticResult(n){const a=Re(this,no).getQueryCache().build(Re(this,no),n),l=this.createResult(a,n);return pae(this,l)&&(Bt(this,Aa,l),Bt(this,Ry,this.options),Bt(this,Tm,Re(this,fn).state)),l}getCurrentResult(){return Re(this,Aa)}trackResult(n,a){return new Proxy(n,{get:(l,u)=>(this.trackProp(u),a==null||a(u),u==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&Re(this,bu).status==="pending"&&Re(this,bu).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(l,u))})}trackProp(n){Re(this,Iy).add(n)}getCurrentQuery(){return Re(this,fn)}refetch({...n}={}){return this.fetch({...n})}fetchOptimistic(n){const a=Re(this,no).defaultQueryOptions(n),l=Re(this,no).getQueryCache().build(Re(this,no),a);return l.fetch().then(()=>this.createResult(l,a))}fetch(n){return Jr(this,Ln,mw).call(this,{...n,cancelRefetch:n.cancelRefetch??!0}).then(()=>(this.updateResult(),Re(this,Aa)))}createResult(n,a){var Se;const l=Re(this,fn),u=this.options,m=Re(this,Aa),y=Re(this,Tm),w=Re(this,Ry),x=n!==l?n.state:Re(this,$w),{state:T}=n;let N={...T},O=!1,P;if(a._optimisticResults){const oe=this.hasListeners(),ve=!oe&&Q8(n,a),he=oe&&Z8(n,l,a,u);(ve||he)&&(N={...N,...sH(T.data,n.options)}),a._optimisticResults==="isRestoring"&&(N.fetchStatus="idle")}let{error:F,errorUpdatedAt:z,status:V}=N;P=N.data;let W=!1;if(a.placeholderData!==void 0&&P===void 0&&V==="pending"){let oe;m!=null&&m.isPlaceholderData&&a.placeholderData===(w==null?void 0:w.placeholderData)?(oe=m.data,W=!0):oe=typeof a.placeholderData=="function"?a.placeholderData((Se=Re(this,Ay))==null?void 0:Se.state.data,Re(this,Ay)):a.placeholderData,oe!==void 0&&(V="success",P=Kk(m==null?void 0:m.data,oe,a),O=!0)}if(a.select&&P!==void 0&&!W)if(m&&P===(y==null?void 0:y.data)&&a.select===Re(this,Yw))P=Re(this,Ny);else try{Bt(this,Yw,a.select),P=a.select(P),P=Kk(m==null?void 0:m.data,P,a),Bt(this,Ny,P),Bt(this,rp,null)}catch(oe){Bt(this,rp,oe)}Re(this,rp)&&(F=Re(this,rp),P=Re(this,Ny),z=Date.now(),V="error");const te=N.fetchStatus==="fetching",$=V==="pending",Q=V==="error",G=$&&te,se=P!==void 0,ce={status:V,fetchStatus:N.fetchStatus,isPending:$,isSuccess:V==="success",isError:Q,isInitialLoading:G,isLoading:G,data:P,dataUpdatedAt:N.dataUpdatedAt,error:F,errorUpdatedAt:z,failureCount:N.fetchFailureCount,failureReason:N.fetchFailureReason,errorUpdateCount:N.errorUpdateCount,isFetched:N.dataUpdateCount>0||N.errorUpdateCount>0,isFetchedAfterMount:N.dataUpdateCount>x.dataUpdateCount||N.errorUpdateCount>x.errorUpdateCount,isFetching:te,isRefetching:te&&!$,isLoadingError:Q&&!se,isPaused:N.fetchStatus==="paused",isPlaceholderData:O,isRefetchError:Q&&se,isStale:fD(n,a),refetch:this.refetch,promise:Re(this,bu),isEnabled:wc(a.enabled,n)!==!1};if(this.options.experimental_prefetchInRender){const oe=Ze=>{ce.status==="error"?Ze.reject(ce.error):ce.data!==void 0&&Ze.resolve(ce.data)},ve=()=>{const Ze=Bt(this,bu,ce.promise=zk());oe(Ze)},he=Re(this,bu);switch(he.status){case"pending":n.queryHash===l.queryHash&&oe(he);break;case"fulfilled":(ce.status==="error"||ce.data!==he.value)&&ve();break;case"rejected":(ce.status!=="error"||ce.error!==he.reason)&&ve();break}}return ce}updateResult(){const n=Re(this,Aa),a=this.createResult(Re(this,fn),this.options);if(Bt(this,Tm,Re(this,fn).state),Bt(this,Ry,this.options),Re(this,Tm).data!==void 0&&Bt(this,Ay,Re(this,fn)),sR(a,n))return;Bt(this,Aa,a);const l=()=>{if(!n)return!0;const{notifyOnChangeProps:u}=this.options,m=typeof u=="function"?u():u;if(m==="all"||!m&&!Re(this,Iy).size)return!0;const y=new Set(m??Re(this,Iy));return this.options.throwOnError&&y.add("error"),Object.keys(Re(this,Aa)).some(w=>{const b=w;return Re(this,Aa)[b]!==n[b]&&y.has(b)})};Jr(this,Ln,iH).call(this,{listeners:l()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Jr(this,Ln,Qk).call(this)}},no=new WeakMap,fn=new WeakMap,$w=new WeakMap,Aa=new WeakMap,Tm=new WeakMap,Ry=new WeakMap,bu=new WeakMap,rp=new WeakMap,Yw=new WeakMap,Ny=new WeakMap,Ay=new WeakMap,Cm=new WeakMap,Rm=new WeakMap,np=new WeakMap,Iy=new WeakMap,Ln=new WeakSet,mw=function(n){Jr(this,Ln,tP).call(this);let a=Re(this,fn).fetch(this.options,n);return n!=null&&n.throwOnError||(a=a.catch(Oa)),a},Yk=function(){Jr(this,Ln,Zk).call(this);const n=lp(this.options.staleTime,Re(this,fn));if(km||Re(this,Aa).isStale||!Gk(n))return;const l=JG(Re(this,Aa).dataUpdatedAt,n)+1;Bt(this,Cm,hm.setTimeout(()=>{Re(this,Aa).isStale||this.updateResult()},l))},Xk=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(Re(this,fn)):this.options.refetchInterval)??!1},Jk=function(n){Jr(this,Ln,eP).call(this),Bt(this,np,n),!(km||wc(this.options.enabled,Re(this,fn))===!1||!Gk(Re(this,np))||Re(this,np)===0)&&Bt(this,Rm,hm.setInterval(()=>{(this.options.refetchIntervalInBackground||pD.isFocused())&&Jr(this,Ln,mw).call(this)},Re(this,np)))},Qk=function(){Jr(this,Ln,Yk).call(this),Jr(this,Ln,Jk).call(this,Jr(this,Ln,Xk).call(this))},Zk=function(){Re(this,Cm)&&(hm.clearTimeout(Re(this,Cm)),Bt(this,Cm,void 0))},eP=function(){Re(this,Rm)&&(hm.clearInterval(Re(this,Rm)),Bt(this,Rm,void 0))},tP=function(){const n=Re(this,no).getQueryCache().build(Re(this,no),this.options);if(n===Re(this,fn))return;const a=Re(this,fn);Bt(this,fn,n),Bt(this,$w,n.state),this.hasListeners()&&(a==null||a.removeObserver(this),n.addObserver(this))},iH=function(n){wi.batch(()=>{n.listeners&&this.listeners.forEach(a=>{a(Re(this,Aa))}),Re(this,no).getQueryCache().notify({query:Re(this,fn),type:"observerResultsUpdated"})})},WG);function hae(i,n){return wc(n.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&n.retryOnMount===!1)}function Q8(i,n){return hae(i,n)||i.state.data!==void 0&&rP(i,n,n.refetchOnMount)}function rP(i,n,a){if(wc(n.enabled,i)!==!1&&lp(n.staleTime,i)!=="static"){const l=typeof a=="function"?a(i):a;return l==="always"||l!==!1&&fD(i,n)}return!1}function Z8(i,n,a,l){return(i!==n||wc(l.enabled,i)===!1)&&(!a.suspense||i.state.status!=="error")&&fD(i,a)}function fD(i,n){return wc(n.enabled,i)!==!1&&i.isStaleByTime(lp(n.staleTime,i))}function pae(i,n){return!sR(i.getCurrentResult(),n)}function eW(i){return{onFetch:(n,a)=>{var T,N,O,P,F;const l=n.options,u=(O=(N=(T=n.fetchOptions)==null?void 0:T.meta)==null?void 0:N.fetchMore)==null?void 0:O.direction,m=((P=n.state.data)==null?void 0:P.pages)||[],y=((F=n.state.data)==null?void 0:F.pageParams)||[];let w={pages:[],pageParams:[]},b=0;const x=async()=>{let z=!1;const V=$=>{Object.defineProperty($,"signal",{enumerable:!0,get:()=>(n.signal.aborted?z=!0:n.signal.addEventListener("abort",()=>{z=!0}),n.signal)})},W=ZG(n.options,n.fetchOptions),te=async($,Q,G)=>{if(z)return Promise.reject();if(Q==null&&$.pages.length)return Promise.resolve($);const ie=(()=>{const ve={client:n.client,queryKey:n.queryKey,pageParam:Q,direction:G?"backward":"forward",meta:n.options.meta};return V(ve),ve})(),ce=await W(ie),{maxPages:Se}=n.options,oe=G?sae:nae;return{pages:oe($.pages,ce,Se),pageParams:oe($.pageParams,Q,Se)}};if(u&&m.length){const $=u==="backward",Q=$?fae:tW,G={pages:m,pageParams:y},se=Q(l,G);w=await te(G,se,$)}else{const $=i??m.length;do{const Q=b===0?y[0]??l.initialPageParam:tW(l,w);if(b>0&&Q==null)break;w=await te(w,Q),b++}while(b<$)}return w};n.options.persister?n.fetchFn=()=>{var z,V;return(V=(z=n.options).persister)==null?void 0:V.call(z,x,{client:n.client,queryKey:n.queryKey,meta:n.options.meta,signal:n.signal},a)}:n.fetchFn=x}}}function tW(i,{pages:n,pageParams:a}){const l=n.length-1;return n.length>0?i.getNextPageParam(n[l],n,a[l],a):void 0}function fae(i,{pages:n,pageParams:a}){var l;return n.length>0?(l=i.getPreviousPageParam)==null?void 0:l.call(i,n[0],n,a[0],a):void 0}var Xw,Sd,Ia,Nm,xd,Yh,qG,mae=(qG=class extends nH{constructor(n){super();cr(this,xd);cr(this,Xw);cr(this,Sd);cr(this,Ia);cr(this,Nm);Bt(this,Xw,n.client),this.mutationId=n.mutationId,Bt(this,Ia,n.mutationCache),Bt(this,Sd,[]),this.state=n.state||aH(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){Re(this,Sd).includes(n)||(Re(this,Sd).push(n),this.clearGcTimeout(),Re(this,Ia).notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){Bt(this,Sd,Re(this,Sd).filter(a=>a!==n)),this.scheduleGc(),Re(this,Ia).notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){Re(this,Sd).length||(this.state.status==="pending"?this.scheduleGc():Re(this,Ia).remove(this))}continue(){var n;return((n=Re(this,Nm))==null?void 0:n.continue())??this.execute(this.state.variables)}async execute(n){var y,w,b,x,T,N,O,P,F,z,V,W,te,$,Q,G,se,ie,ce,Se;const a=()=>{Jr(this,xd,Yh).call(this,{type:"continue"})},l={client:Re(this,Xw),meta:this.options.meta,mutationKey:this.options.mutationKey};Bt(this,Nm,rH({fn:()=>this.options.mutationFn?this.options.mutationFn(n,l):Promise.reject(new Error("No mutationFn found")),onFail:(oe,ve)=>{Jr(this,xd,Yh).call(this,{type:"failed",failureCount:oe,error:ve})},onPause:()=>{Jr(this,xd,Yh).call(this,{type:"pause"})},onContinue:a,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Re(this,Ia).canRun(this)}));const u=this.state.status==="pending",m=!Re(this,Nm).canStart();try{if(u)a();else{Jr(this,xd,Yh).call(this,{type:"pending",variables:n,isPaused:m}),await((w=(y=Re(this,Ia).config).onMutate)==null?void 0:w.call(y,n,this,l));const ve=await((x=(b=this.options).onMutate)==null?void 0:x.call(b,n,l));ve!==this.state.context&&Jr(this,xd,Yh).call(this,{type:"pending",context:ve,variables:n,isPaused:m})}const oe=await Re(this,Nm).start();return await((N=(T=Re(this,Ia).config).onSuccess)==null?void 0:N.call(T,oe,n,this.state.context,this,l)),await((P=(O=this.options).onSuccess)==null?void 0:P.call(O,oe,n,this.state.context,l)),await((z=(F=Re(this,Ia).config).onSettled)==null?void 0:z.call(F,oe,null,this.state.variables,this.state.context,this,l)),await((W=(V=this.options).onSettled)==null?void 0:W.call(V,oe,null,n,this.state.context,l)),Jr(this,xd,Yh).call(this,{type:"success",data:oe}),oe}catch(oe){try{throw await(($=(te=Re(this,Ia).config).onError)==null?void 0:$.call(te,oe,n,this.state.context,this,l)),await((G=(Q=this.options).onError)==null?void 0:G.call(Q,oe,n,this.state.context,l)),await((ie=(se=Re(this,Ia).config).onSettled)==null?void 0:ie.call(se,void 0,oe,this.state.variables,this.state.context,this,l)),await((Se=(ce=this.options).onSettled)==null?void 0:Se.call(ce,void 0,oe,n,this.state.context,l)),oe}finally{Jr(this,xd,Yh).call(this,{type:"error",error:oe})}}finally{Re(this,Ia).runNext(this)}}},Xw=new WeakMap,Sd=new WeakMap,Ia=new WeakMap,Nm=new WeakMap,xd=new WeakSet,Yh=function(n){const a=l=>{switch(n.type){case"failed":return{...l,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...l,isPaused:!0};case"continue":return{...l,isPaused:!1};case"pending":return{...l,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...l,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...l,data:void 0,error:n.error,failureCount:l.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=a(this.state),wi.batch(()=>{Re(this,Sd).forEach(l=>{l.onMutationUpdate(n)}),Re(this,Ia).notify({mutation:this,type:"updated",action:n})})},qG);function aH(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Su,Sl,Jw,GG,gae=(GG=class extends Gy{constructor(n={}){super();cr(this,Su);cr(this,Sl);cr(this,Jw);this.config=n,Bt(this,Su,new Set),Bt(this,Sl,new Map),Bt(this,Jw,0)}build(n,a,l){const u=new mae({client:n,mutationCache:this,mutationId:++_C(this,Jw)._,options:n.defaultMutationOptions(a),state:l});return this.add(u),u}add(n){Re(this,Su).add(n);const a=vC(n);if(typeof a=="string"){const l=Re(this,Sl).get(a);l?l.push(n):Re(this,Sl).set(a,[n])}this.notify({type:"added",mutation:n})}remove(n){if(Re(this,Su).delete(n)){const a=vC(n);if(typeof a=="string"){const l=Re(this,Sl).get(a);if(l)if(l.length>1){const u=l.indexOf(n);u!==-1&&l.splice(u,1)}else l[0]===n&&Re(this,Sl).delete(a)}}this.notify({type:"removed",mutation:n})}canRun(n){const a=vC(n);if(typeof a=="string"){const l=Re(this,Sl).get(a),u=l==null?void 0:l.find(m=>m.state.status==="pending");return!u||u===n}else return!0}runNext(n){var l;const a=vC(n);if(typeof a=="string"){const u=(l=Re(this,Sl).get(a))==null?void 0:l.find(m=>m!==n&&m.state.isPaused);return(u==null?void 0:u.continue())??Promise.resolve()}else return Promise.resolve()}clear(){wi.batch(()=>{Re(this,Su).forEach(n=>{this.notify({type:"removed",mutation:n})}),Re(this,Su).clear(),Re(this,Sl).clear()})}getAll(){return Array.from(Re(this,Su))}find(n){const a={exact:!0,...n};return this.getAll().find(l=>z8(a,l))}findAll(n={}){return this.getAll().filter(a=>z8(n,a))}notify(n){wi.batch(()=>{this.listeners.forEach(a=>{a(n)})})}resumePausedMutations(){const n=this.getAll().filter(a=>a.state.isPaused);return wi.batch(()=>Promise.all(n.map(a=>a.continue().catch(Oa))))}},Su=new WeakMap,Sl=new WeakMap,Jw=new WeakMap,GG);function vC(i){var n;return(n=i.options.scope)==null?void 0:n.id}var xu,sp,so,Tu,Nu,BC,nP,HG,_ae=(HG=class extends Gy{constructor(a,l){super();cr(this,Nu);cr(this,xu);cr(this,sp);cr(this,so);cr(this,Tu);Bt(this,xu,a),this.setOptions(l),this.bindMethods(),Jr(this,Nu,BC).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){var u;const l=this.options;this.options=Re(this,xu).defaultMutationOptions(a),sR(this.options,l)||Re(this,xu).getMutationCache().notify({type:"observerOptionsUpdated",mutation:Re(this,so),observer:this}),l!=null&&l.mutationKey&&this.options.mutationKey&&Pm(l.mutationKey)!==Pm(this.options.mutationKey)?this.reset():((u=Re(this,so))==null?void 0:u.state.status)==="pending"&&Re(this,so).setOptions(this.options)}onUnsubscribe(){var a;this.hasListeners()||(a=Re(this,so))==null||a.removeObserver(this)}onMutationUpdate(a){Jr(this,Nu,BC).call(this),Jr(this,Nu,nP).call(this,a)}getCurrentResult(){return Re(this,sp)}reset(){var a;(a=Re(this,so))==null||a.removeObserver(this),Bt(this,so,void 0),Jr(this,Nu,BC).call(this),Jr(this,Nu,nP).call(this)}mutate(a,l){var u;return Bt(this,Tu,l),(u=Re(this,so))==null||u.removeObserver(this),Bt(this,so,Re(this,xu).getMutationCache().build(Re(this,xu),this.options)),Re(this,so).addObserver(this),Re(this,so).execute(a)}},xu=new WeakMap,sp=new WeakMap,so=new WeakMap,Tu=new WeakMap,Nu=new WeakSet,BC=function(){var l;const a=((l=Re(this,so))==null?void 0:l.state)??aH();Bt(this,sp,{...a,isPending:a.status==="pending",isSuccess:a.status==="success",isError:a.status==="error",isIdle:a.status==="idle",mutate:this.mutate,reset:this.reset})},nP=function(a){wi.batch(()=>{var l,u,m,y,w,b,x,T;if(Re(this,Tu)&&this.hasListeners()){const N=Re(this,sp).variables,O=Re(this,sp).context,P={client:Re(this,xu),meta:this.options.meta,mutationKey:this.options.mutationKey};(a==null?void 0:a.type)==="success"?((u=(l=Re(this,Tu)).onSuccess)==null||u.call(l,a.data,N,O,P),(y=(m=Re(this,Tu)).onSettled)==null||y.call(m,a.data,null,N,O,P)):(a==null?void 0:a.type)==="error"&&((b=(w=Re(this,Tu)).onError)==null||b.call(w,a.error,N,O,P),(T=(x=Re(this,Tu)).onSettled)==null||T.call(x,void 0,a.error,N,O,P))}this.listeners.forEach(N=>{N(Re(this,sp))})})},HG),Td,KG,yae=(KG=class extends Gy{constructor(n={}){super();cr(this,Td);this.config=n,Bt(this,Td,new Map)}build(n,a,l){const u=a.queryKey,m=a.queryHash??uD(u,a);let y=this.get(m);return y||(y=new dae({client:n,queryKey:u,queryHash:m,options:n.defaultQueryOptions(a),state:l,defaultOptions:n.getQueryDefaults(u)}),this.add(y)),y}add(n){Re(this,Td).has(n.queryHash)||(Re(this,Td).set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const a=Re(this,Td).get(n.queryHash);a&&(n.destroy(),a===n&&Re(this,Td).delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){wi.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return Re(this,Td).get(n)}getAll(){return[...Re(this,Td).values()]}find(n){const a={exact:!0,...n};return this.getAll().find(l=>K8(a,l))}findAll(n={}){const a=this.getAll();return Object.keys(n).length>0?a.filter(l=>K8(n,l)):a}notify(n){wi.batch(()=>{this.listeners.forEach(a=>{a(n)})})}onFocus(){wi.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){wi.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},Td=new WeakMap,KG),qs,ip,ap,Oy,ky,op,Py,Dy,zG,vae=(zG=class{constructor(i={}){cr(this,qs);cr(this,ip);cr(this,ap);cr(this,Oy);cr(this,ky);cr(this,op);cr(this,Py);cr(this,Dy);Bt(this,qs,i.queryCache||new yae),Bt(this,ip,i.mutationCache||new gae),Bt(this,ap,i.defaultOptions||{}),Bt(this,Oy,new Map),Bt(this,ky,new Map),Bt(this,op,0)}mount(){_C(this,op)._++,Re(this,op)===1&&(Bt(this,Py,pD.subscribe(async i=>{i&&(await this.resumePausedMutations(),Re(this,qs).onFocus())})),Bt(this,Dy,iR.subscribe(async i=>{i&&(await this.resumePausedMutations(),Re(this,qs).onOnline())})))}unmount(){var i,n;_C(this,op)._--,Re(this,op)===0&&((i=Re(this,Py))==null||i.call(this),Bt(this,Py,void 0),(n=Re(this,Dy))==null||n.call(this),Bt(this,Dy,void 0))}isFetching(i){return Re(this,qs).findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return Re(this,ip).findAll({...i,status:"pending"}).length}getQueryData(i){var a;const n=this.defaultQueryOptions({queryKey:i});return(a=Re(this,qs).get(n.queryHash))==null?void 0:a.state.data}ensureQueryData(i){const n=this.defaultQueryOptions(i),a=Re(this,qs).build(this,n),l=a.state.data;return l===void 0?this.fetchQuery(i):(i.revalidateIfStale&&a.isStaleByTime(lp(n.staleTime,a))&&this.prefetchQuery(n),Promise.resolve(l))}getQueriesData(i){return Re(this,qs).findAll(i).map(({queryKey:n,state:a})=>{const l=a.data;return[n,l]})}setQueryData(i,n,a){const l=this.defaultQueryOptions({queryKey:i}),u=Re(this,qs).get(l.queryHash),m=u==null?void 0:u.state.data,y=eae(n,m);if(y!==void 0)return Re(this,qs).build(this,l).setData(y,{...a,manual:!0})}setQueriesData(i,n,a){return wi.batch(()=>Re(this,qs).findAll(i).map(({queryKey:l})=>[l,this.setQueryData(l,n,a)]))}getQueryState(i){var a;const n=this.defaultQueryOptions({queryKey:i});return(a=Re(this,qs).get(n.queryHash))==null?void 0:a.state}removeQueries(i){const n=Re(this,qs);wi.batch(()=>{n.findAll(i).forEach(a=>{n.remove(a)})})}resetQueries(i,n){const a=Re(this,qs);return wi.batch(()=>(a.findAll(i).forEach(l=>{l.reset()}),this.refetchQueries({type:"active",...i},n)))}cancelQueries(i,n={}){const a={revert:!0,...n},l=wi.batch(()=>Re(this,qs).findAll(i).map(u=>u.cancel(a)));return Promise.all(l).then(Oa).catch(Oa)}invalidateQueries(i,n={}){return wi.batch(()=>(Re(this,qs).findAll(i).forEach(a=>{a.invalidate()}),(i==null?void 0:i.refetchType)==="none"?Promise.resolve():this.refetchQueries({...i,type:(i==null?void 0:i.refetchType)??(i==null?void 0:i.type)??"active"},n)))}refetchQueries(i,n={}){const a={...n,cancelRefetch:n.cancelRefetch??!0},l=wi.batch(()=>Re(this,qs).findAll(i).filter(u=>!u.isDisabled()&&!u.isStatic()).map(u=>{let m=u.fetch(void 0,a);return a.throwOnError||(m=m.catch(Oa)),u.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(Oa)}fetchQuery(i){const n=this.defaultQueryOptions(i);n.retry===void 0&&(n.retry=!1);const a=Re(this,qs).build(this,n);return a.isStaleByTime(lp(n.staleTime,a))?a.fetch(n):Promise.resolve(a.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(Oa).catch(Oa)}fetchInfiniteQuery(i){return i.behavior=eW(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(Oa).catch(Oa)}ensureInfiniteQueryData(i){return i.behavior=eW(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return iR.isOnline()?Re(this,ip).resumePausedMutations():Promise.resolve()}getQueryCache(){return Re(this,qs)}getMutationCache(){return Re(this,ip)}getDefaultOptions(){return Re(this,ap)}setDefaultOptions(i){Bt(this,ap,i)}setQueryDefaults(i,n){Re(this,Oy).set(Pm(i),{queryKey:i,defaultOptions:n})}getQueryDefaults(i){const n=[...Re(this,Oy).values()],a={};return n.forEach(l=>{Rw(i,l.queryKey)&&Object.assign(a,l.defaultOptions)}),a}setMutationDefaults(i,n){Re(this,ky).set(Pm(i),{mutationKey:i,defaultOptions:n})}getMutationDefaults(i){const n=[...Re(this,ky).values()],a={};return n.forEach(l=>{Rw(i,l.mutationKey)&&Object.assign(a,l.defaultOptions)}),a}defaultQueryOptions(i){if(i._defaulted)return i;const n={...Re(this,ap).queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return n.queryHash||(n.queryHash=uD(n.queryKey,n)),n.refetchOnReconnect===void 0&&(n.refetchOnReconnect=n.networkMode!=="always"),n.throwOnError===void 0&&(n.throwOnError=!!n.suspense),!n.networkMode&&n.persister&&(n.networkMode="offlineFirst"),n.queryFn===hD&&(n.enabled=!1),n}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...Re(this,ap).mutations,...(i==null?void 0:i.mutationKey)&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){Re(this,qs).clear(),Re(this,ip).clear()}},qs=new WeakMap,ip=new WeakMap,ap=new WeakMap,Oy=new WeakMap,ky=new WeakMap,op=new WeakMap,Py=new WeakMap,Dy=new WeakMap,zG),oH=M.createContext(void 0),vn=i=>{const n=M.useContext(oH);if(i)return i;if(!n)throw new Error("No QueryClient set, use QueryClientProvider to set one");return n},Eae=({client:i,children:n})=>(M.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),o.jsx(oH.Provider,{value:i,children:n})),cH=M.createContext(!1),wae=()=>M.useContext(cH);cH.Provider;function bae(){let i=!1;return{clearReset:()=>{i=!1},reset:()=>{i=!0},isReset:()=>i}}var Sae=M.createContext(bae()),xae=()=>M.useContext(Sae),Tae=(i,n)=>{(i.suspense||i.throwOnError||i.experimental_prefetchInRender)&&(n.isReset()||(i.retryOnMount=!1))},Cae=i=>{M.useEffect(()=>{i.clearReset()},[i])},Rae=({result:i,errorResetBoundary:n,throwOnError:a,query:l,suspense:u})=>i.isError&&!n.isReset()&&!i.isFetching&&l&&(u&&i.data===void 0||eH(a,[i.error,l])),Nae=i=>{if(i.suspense){const a=u=>u==="static"?u:Math.max(u??1e3,1e3),l=i.staleTime;i.staleTime=typeof l=="function"?(...u)=>a(l(...u)):a(l),typeof i.gcTime=="number"&&(i.gcTime=Math.max(i.gcTime,1e3))}},Aae=(i,n)=>i.isLoading&&i.isFetching&&!n,Iae=(i,n)=>(i==null?void 0:i.suspense)&&n.isPending,rW=(i,n,a)=>n.fetchOptimistic(i).catch(()=>{a.clearReset()});function Oae(i,n,a){var N,O,P,F,z;const l=wae(),u=xae(),m=vn(a),y=m.defaultQueryOptions(i);(O=(N=m.getDefaultOptions().queries)==null?void 0:N._experimental_beforeQuery)==null||O.call(N,y),y._optimisticResults=l?"isRestoring":"optimistic",Nae(y),Tae(y,u),Cae(u);const w=!m.getQueryCache().get(y.queryHash),[b]=M.useState(()=>new n(m,y)),x=b.getOptimisticResult(y),T=!l&&i.subscribed!==!1;if(M.useSyncExternalStore(M.useCallback(V=>{const W=T?b.subscribe(wi.batchCalls(V)):Oa;return b.updateResult(),W},[b,T]),()=>b.getCurrentResult(),()=>b.getCurrentResult()),M.useEffect(()=>{b.setOptions(y)},[y,b]),Iae(y,x))throw rW(y,b,u);if(Rae({result:x,errorResetBoundary:u,throwOnError:y.throwOnError,query:m.getQueryCache().get(y.queryHash),suspense:y.suspense}))throw x.error;if((F=(P=m.getDefaultOptions().queries)==null?void 0:P._experimental_afterQuery)==null||F.call(P,y,x),y.experimental_prefetchInRender&&!km&&Aae(x,l)){const V=w?rW(y,b,u):(z=m.getQueryCache().get(y.queryHash))==null?void 0:z.promise;V==null||V.catch(Oa).finally(()=>{b.updateResult()})}return y.notifyOnChangeProps?x:b.trackResult(x)}function mt(i,n){return Oae(i,uae,n)}function Wt(i,n){const a=vn(n),[l]=M.useState(()=>new _ae(a,i));M.useEffect(()=>{l.setOptions(i)},[l,i]);const u=M.useSyncExternalStore(M.useCallback(y=>l.subscribe(wi.batchCalls(y)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),m=M.useCallback((y,w)=>{l.mutate(y,w).catch(Oa)},[l]);if(u.error&&eH(l.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:m,mutateAsync:u.mutate}}/**
 * react-router v7.9.5
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var nW="popstate";function kae(i={}){function n(l,u){let{pathname:m,search:y,hash:w}=l.location;return sP("",{pathname:m,search:y,hash:w},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function a(l,u){return typeof u=="string"?u:Nw(u)}return Dae(n,a,null,i)}function Ds(i,n){if(i===!1||i===null||typeof i>"u")throw new Error(n)}function Tl(i,n){if(!i){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function Pae(){return Math.random().toString(36).substring(2,10)}function sW(i,n){return{usr:i.state,key:i.key,idx:n}}function sP(i,n,a=null,l){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof n=="string"?Hy(n):n,state:a,key:n&&n.key||l||Pae()}}function Nw({pathname:i="/",search:n="",hash:a=""}){return n&&n!=="?"&&(i+=n.charAt(0)==="?"?n:"?"+n),a&&a!=="#"&&(i+=a.charAt(0)==="#"?a:"#"+a),i}function Hy(i){let n={};if(i){let a=i.indexOf("#");a>=0&&(n.hash=i.substring(a),i=i.substring(0,a));let l=i.indexOf("?");l>=0&&(n.search=i.substring(l),i=i.substring(0,l)),i&&(n.pathname=i)}return n}function Dae(i,n,a,l={}){let{window:u=document.defaultView,v5Compat:m=!1}=l,y=u.history,w="POP",b=null,x=T();x==null&&(x=0,y.replaceState({...y.state,idx:x},""));function T(){return(y.state||{idx:null}).idx}function N(){w="POP";let V=T(),W=V==null?null:V-x;x=V,b&&b({action:w,location:z.location,delta:W})}function O(V,W){w="PUSH";let te=sP(z.location,V,W);x=T()+1;let $=sW(te,x),Q=z.createHref(te);try{y.pushState($,"",Q)}catch(G){if(G instanceof DOMException&&G.name==="DataCloneError")throw G;u.location.assign(Q)}m&&b&&b({action:w,location:z.location,delta:1})}function P(V,W){w="REPLACE";let te=sP(z.location,V,W);x=T();let $=sW(te,x),Q=z.createHref(te);y.replaceState($,"",Q),m&&b&&b({action:w,location:z.location,delta:0})}function F(V){return jae(V)}let z={get action(){return w},get location(){return i(u,y)},listen(V){if(b)throw new Error("A history only accepts one active listener");return u.addEventListener(nW,N),b=V,()=>{u.removeEventListener(nW,N),b=null}},createHref(V){return n(u,V)},createURL:F,encodeLocation(V){let W=F(V);return{pathname:W.pathname,search:W.search,hash:W.hash}},push:O,replace:P,go(V){return y.go(V)}};return z}function jae(i,n=!1){let a="http://localhost";typeof window<"u"&&(a=window.location.origin!=="null"?window.location.origin:window.location.href),Ds(a,"No window.location.(origin|href) available to create URL");let l=typeof i=="string"?i:Nw(i);return l=l.replace(/ $/,"%20"),!n&&l.startsWith("//")&&(l=a+l),new URL(l,a)}function lH(i,n,a="/"){return Lae(i,n,a,!1)}function Lae(i,n,a,l){let u=typeof n=="string"?Hy(n):n,m=Au(u.pathname||"/",a);if(m==null)return null;let y=dH(i);Mae(y);let w=null;for(let b=0;w==null&&b<y.length;++b){let x=$ae(m);w=Kae(y[b],x,l)}return w}function dH(i,n=[],a=[],l="",u=!1){let m=(y,w,b=u,x)=>{let T={relativePath:x===void 0?y.path||"":x,caseSensitive:y.caseSensitive===!0,childrenIndex:w,route:y};if(T.relativePath.startsWith("/")){if(!T.relativePath.startsWith(l)&&b)return;Ds(T.relativePath.startsWith(l),`Absolute route path "${T.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),T.relativePath=T.relativePath.slice(l.length)}let N=Cu([l,T.relativePath]),O=a.concat(T);y.children&&y.children.length>0&&(Ds(y.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${N}".`),dH(y.children,n,O,N,b)),!(y.path==null&&!y.index)&&n.push({path:N,score:Gae(N,y.index),routesMeta:O})};return i.forEach((y,w)=>{var b;if(y.path===""||!((b=y.path)!=null&&b.includes("?")))m(y,w);else for(let x of uH(y.path))m(y,w,!0,x)}),n}function uH(i){let n=i.split("/");if(n.length===0)return[];let[a,...l]=n,u=a.endsWith("?"),m=a.replace(/\?$/,"");if(l.length===0)return u?[m,""]:[m];let y=uH(l.join("/")),w=[];return w.push(...y.map(b=>b===""?m:[m,b].join("/"))),u&&w.push(...y),w.map(b=>i.startsWith("/")&&b===""?"/":b)}function Mae(i){i.sort((n,a)=>n.score!==a.score?a.score-n.score:Hae(n.routesMeta.map(l=>l.childrenIndex),a.routesMeta.map(l=>l.childrenIndex)))}var Uae=/^:[\w-]+$/,Fae=3,Vae=2,Bae=1,Wae=10,qae=-2,iW=i=>i==="*";function Gae(i,n){let a=i.split("/"),l=a.length;return a.some(iW)&&(l+=qae),n&&(l+=Vae),a.filter(u=>!iW(u)).reduce((u,m)=>u+(Uae.test(m)?Fae:m===""?Bae:Wae),l)}function Hae(i,n){return i.length===n.length&&i.slice(0,-1).every((l,u)=>l===n[u])?i[i.length-1]-n[n.length-1]:0}function Kae(i,n,a=!1){let{routesMeta:l}=i,u={},m="/",y=[];for(let w=0;w<l.length;++w){let b=l[w],x=w===l.length-1,T=m==="/"?n:n.slice(m.length)||"/",N=aR({path:b.relativePath,caseSensitive:b.caseSensitive,end:x},T),O=b.route;if(!N&&x&&a&&!l[l.length-1].route.index&&(N=aR({path:b.relativePath,caseSensitive:b.caseSensitive,end:!1},T)),!N)return null;Object.assign(u,N.params),y.push({params:u,pathname:Cu([m,N.pathname]),pathnameBase:Qae(Cu([m,N.pathnameBase])),route:O}),N.pathnameBase!=="/"&&(m=Cu([m,N.pathnameBase]))}return y}function aR(i,n){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[a,l]=zae(i.path,i.caseSensitive,i.end),u=n.match(a);if(!u)return null;let m=u[0],y=m.replace(/(.)\/+$/,"$1"),w=u.slice(1);return{params:l.reduce((x,{paramName:T,isOptional:N},O)=>{if(T==="*"){let F=w[O]||"";y=m.slice(0,m.length-F.length).replace(/(.)\/+$/,"$1")}const P=w[O];return N&&!P?x[T]=void 0:x[T]=(P||"").replace(/%2F/g,"/"),x},{}),pathname:m,pathnameBase:y,pattern:i}}function zae(i,n=!1,a=!0){Tl(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let l=[],u="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(y,w,b)=>(l.push({paramName:w,isOptional:b!=null}),b?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(l.push({paramName:"*"}),u+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?u+="\\/*$":i!==""&&i!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,n?void 0:"i"),l]}function $ae(i){try{return i.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Tl(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),i}}function Au(i,n){if(n==="/")return i;if(!i.toLowerCase().startsWith(n.toLowerCase()))return null;let a=n.endsWith("/")?n.length-1:n.length,l=i.charAt(a);return l&&l!=="/"?null:i.slice(a)||"/"}function Yae(i,n="/"){let{pathname:a,search:l="",hash:u=""}=typeof i=="string"?Hy(i):i;return{pathname:a?a.startsWith("/")?a:Xae(a,n):n,search:Zae(l),hash:eoe(u)}}function Xae(i,n){let a=n.replace(/\/+$/,"").split("/");return i.split("/").forEach(u=>{u===".."?a.length>1&&a.pop():u!=="."&&a.push(u)}),a.length>1?a.join("/"):"/"}function ok(i,n,a,l){return`Cannot include a '${i}' character in a manually specified \`to.${n}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Jae(i){return i.filter((n,a)=>a===0||n.route.path&&n.route.path.length>0)}function hH(i){let n=Jae(i);return n.map((a,l)=>l===n.length-1?a.pathname:a.pathnameBase)}function pH(i,n,a,l=!1){let u;typeof i=="string"?u=Hy(i):(u={...i},Ds(!u.pathname||!u.pathname.includes("?"),ok("?","pathname","search",u)),Ds(!u.pathname||!u.pathname.includes("#"),ok("#","pathname","hash",u)),Ds(!u.search||!u.search.includes("#"),ok("#","search","hash",u)));let m=i===""||u.pathname==="",y=m?"/":u.pathname,w;if(y==null)w=a;else{let N=n.length-1;if(!l&&y.startsWith("..")){let O=y.split("/");for(;O[0]==="..";)O.shift(),N-=1;u.pathname=O.join("/")}w=N>=0?n[N]:"/"}let b=Yae(u,w),x=y&&y!=="/"&&y.endsWith("/"),T=(m||y===".")&&a.endsWith("/");return!b.pathname.endsWith("/")&&(x||T)&&(b.pathname+="/"),b}var Cu=i=>i.join("/").replace(/\/\/+/g,"/"),Qae=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),Zae=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,eoe=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function toe(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var fH=["POST","PUT","PATCH","DELETE"];new Set(fH);var roe=["GET",...fH];new Set(roe);var Ky=M.createContext(null);Ky.displayName="DataRouter";var TR=M.createContext(null);TR.displayName="DataRouterState";M.createContext(!1);var mH=M.createContext({isTransitioning:!1});mH.displayName="ViewTransition";var noe=M.createContext(new Map);noe.displayName="Fetchers";var soe=M.createContext(null);soe.displayName="Await";var Pd=M.createContext(null);Pd.displayName="Navigation";var Zw=M.createContext(null);Zw.displayName="Location";var Dd=M.createContext({outlet:null,matches:[],isDataRoute:!1});Dd.displayName="Route";var mD=M.createContext(null);mD.displayName="RouteError";function ioe(i,{relative:n}={}){Ds(eb(),"useHref() may be used only in the context of a <Router> component.");let{basename:a,navigator:l}=M.useContext(Pd),{hash:u,pathname:m,search:y}=tb(i,{relative:n}),w=m;return a!=="/"&&(w=m==="/"?a:Cu([a,m])),l.createHref({pathname:w,search:y,hash:u})}function eb(){return M.useContext(Zw)!=null}function Pc(){return Ds(eb(),"useLocation() may be used only in the context of a <Router> component."),M.useContext(Zw).location}var gH="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function _H(i){M.useContext(Pd).static||M.useLayoutEffect(i)}function Wn(){let{isDataRoute:i}=M.useContext(Dd);return i?voe():aoe()}function aoe(){Ds(eb(),"useNavigate() may be used only in the context of a <Router> component.");let i=M.useContext(Ky),{basename:n,navigator:a}=M.useContext(Pd),{matches:l}=M.useContext(Dd),{pathname:u}=Pc(),m=JSON.stringify(hH(l)),y=M.useRef(!1);return _H(()=>{y.current=!0}),M.useCallback((b,x={})=>{if(Tl(y.current,gH),!y.current)return;if(typeof b=="number"){a.go(b);return}let T=pH(b,JSON.parse(m),u,x.relative==="path");i==null&&n!=="/"&&(T.pathname=T.pathname==="/"?n:Cu([n,T.pathname])),(x.replace?a.replace:a.push)(T,x.state,x)},[n,a,m,u,i])}M.createContext(null);function ooe(){let{matches:i}=M.useContext(Dd),n=i[i.length-1];return n?n.params:{}}function tb(i,{relative:n}={}){let{matches:a}=M.useContext(Dd),{pathname:l}=Pc(),u=JSON.stringify(hH(a));return M.useMemo(()=>pH(i,JSON.parse(u),l,n==="path"),[i,u,l,n])}function coe(i,n){return yH(i,n)}function yH(i,n,a,l,u){var te;Ds(eb(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:m}=M.useContext(Pd),{matches:y}=M.useContext(Dd),w=y[y.length-1],b=w?w.params:{},x=w?w.pathname:"/",T=w?w.pathnameBase:"/",N=w&&w.route;{let $=N&&N.path||"";vH(x,!N||$.endsWith("*")||$.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${x}" (under <Route path="${$}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${$}"> to <Route path="${$==="/"?"*":`${$}/*`}">.`)}let O=Pc(),P;if(n){let $=typeof n=="string"?Hy(n):n;Ds(T==="/"||((te=$.pathname)==null?void 0:te.startsWith(T)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${T}" but pathname "${$.pathname}" was given in the \`location\` prop.`),P=$}else P=O;let F=P.pathname||"/",z=F;if(T!=="/"){let $=T.replace(/^\//,"").split("/");z="/"+F.replace(/^\//,"").split("/").slice($.length).join("/")}let V=lH(i,{pathname:z});Tl(N||V!=null,`No routes matched location "${P.pathname}${P.search}${P.hash}" `),Tl(V==null||V[V.length-1].route.element!==void 0||V[V.length-1].route.Component!==void 0||V[V.length-1].route.lazy!==void 0,`Matched leaf route at location "${P.pathname}${P.search}${P.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let W=poe(V&&V.map($=>Object.assign({},$,{params:Object.assign({},b,$.params),pathname:Cu([T,m.encodeLocation?m.encodeLocation($.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:$.pathname]),pathnameBase:$.pathnameBase==="/"?T:Cu([T,m.encodeLocation?m.encodeLocation($.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:$.pathnameBase])})),y,a,l,u);return n&&W?M.createElement(Zw.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...P},navigationType:"POP"}},W):W}function loe(){let i=yoe(),n=toe(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),a=i instanceof Error?i.stack:null,l="rgba(200,200,200, 0.5)",u={padding:"0.5rem",backgroundColor:l},m={padding:"2px 4px",backgroundColor:l},y=null;return console.error("Error handled by React Router default ErrorBoundary:",i),y=M.createElement(M.Fragment,null,M.createElement("p",null," Hey developer "),M.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",M.createElement("code",{style:m},"ErrorBoundary")," or"," ",M.createElement("code",{style:m},"errorElement")," prop on your route.")),M.createElement(M.Fragment,null,M.createElement("h2",null,"Unexpected Application Error!"),M.createElement("h3",{style:{fontStyle:"italic"}},n),a?M.createElement("pre",{style:u},a):null,y)}var doe=M.createElement(loe,null),uoe=class extends M.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,n){return n.location!==i.location||n.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:n.error,location:n.location,revalidation:i.revalidation||n.revalidation}}componentDidCatch(i,n){this.props.unstable_onError?this.props.unstable_onError(i,n):console.error("React Router caught the following error during render",i)}render(){return this.state.error!==void 0?M.createElement(Dd.Provider,{value:this.props.routeContext},M.createElement(mD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function hoe({routeContext:i,match:n,children:a}){let l=M.useContext(Ky);return l&&l.static&&l.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=n.route.id),M.createElement(Dd.Provider,{value:i},a)}function poe(i,n=[],a=null,l=null,u=null){if(i==null){if(!a)return null;if(a.errors)i=a.matches;else if(n.length===0&&!a.initialized&&a.matches.length>0)i=a.matches;else return null}let m=i,y=a==null?void 0:a.errors;if(y!=null){let x=m.findIndex(T=>T.route.id&&(y==null?void 0:y[T.route.id])!==void 0);Ds(x>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(y).join(",")}`),m=m.slice(0,Math.min(m.length,x+1))}let w=!1,b=-1;if(a)for(let x=0;x<m.length;x++){let T=m[x];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(b=x),T.route.id){let{loaderData:N,errors:O}=a,P=T.route.loader&&!N.hasOwnProperty(T.route.id)&&(!O||O[T.route.id]===void 0);if(T.route.lazy||P){w=!0,b>=0?m=m.slice(0,b+1):m=[m[0]];break}}}return m.reduceRight((x,T,N)=>{let O,P=!1,F=null,z=null;a&&(O=y&&T.route.id?y[T.route.id]:void 0,F=T.route.errorElement||doe,w&&(b<0&&N===0?(vH("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),P=!0,z=null):b===N&&(P=!0,z=T.route.hydrateFallbackElement||null)));let V=n.concat(m.slice(0,N+1)),W=()=>{let te;return O?te=F:P?te=z:T.route.Component?te=M.createElement(T.route.Component,null):T.route.element?te=T.route.element:te=x,M.createElement(hoe,{match:T,routeContext:{outlet:x,matches:V,isDataRoute:a!=null},children:te})};return a&&(T.route.ErrorBoundary||T.route.errorElement||N===0)?M.createElement(uoe,{location:a.location,revalidation:a.revalidation,component:F,error:O,children:W(),routeContext:{outlet:null,matches:V,isDataRoute:!0},unstable_onError:l}):W()},null)}function gD(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function foe(i){let n=M.useContext(Ky);return Ds(n,gD(i)),n}function moe(i){let n=M.useContext(TR);return Ds(n,gD(i)),n}function goe(i){let n=M.useContext(Dd);return Ds(n,gD(i)),n}function _D(i){let n=goe(i),a=n.matches[n.matches.length-1];return Ds(a.route.id,`${i} can only be used on routes that contain a unique "id"`),a.route.id}function _oe(){return _D("useRouteId")}function yoe(){var l;let i=M.useContext(mD),n=moe("useRouteError"),a=_D("useRouteError");return i!==void 0?i:(l=n.errors)==null?void 0:l[a]}function voe(){let{router:i}=foe("useNavigate"),n=_D("useNavigate"),a=M.useRef(!1);return _H(()=>{a.current=!0}),M.useCallback(async(u,m={})=>{Tl(a.current,gH),a.current&&(typeof u=="number"?i.navigate(u):await i.navigate(u,{fromRouteId:n,...m}))},[i,n])}var aW={};function vH(i,n,a){!n&&!aW[i]&&(aW[i]=!0,Tl(!1,a))}M.memo(Eoe);function Eoe({routes:i,future:n,state:a,unstable_onError:l}){return yH(i,void 0,a,l,n)}function an(i){Ds(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function woe({basename:i="/",children:n=null,location:a,navigationType:l="POP",navigator:u,static:m=!1}){Ds(!eb(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let y=i.replace(/^\/*/,"/"),w=M.useMemo(()=>({basename:y,navigator:u,static:m,future:{}}),[y,u,m]);typeof a=="string"&&(a=Hy(a));let{pathname:b="/",search:x="",hash:T="",state:N=null,key:O="default"}=a,P=M.useMemo(()=>{let F=Au(b,y);return F==null?null:{location:{pathname:F,search:x,hash:T,state:N,key:O},navigationType:l}},[y,b,x,T,N,O,l]);return Tl(P!=null,`<Router basename="${y}"> is not able to match the URL "${b}${x}${T}" because it does not start with the basename, so the <Router> won't render anything.`),P==null?null:M.createElement(Pd.Provider,{value:w},M.createElement(Zw.Provider,{children:n,value:P}))}function boe({children:i,location:n}){return coe(iP(i),n)}function iP(i,n=[]){let a=[];return M.Children.forEach(i,(l,u)=>{if(!M.isValidElement(l))return;let m=[...n,u];if(l.type===M.Fragment){a.push.apply(a,iP(l.props.children,m));return}Ds(l.type===an,`[${typeof l.type=="string"?l.type:l.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ds(!l.props.index||!l.props.children,"An index route cannot have child routes.");let y={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,middleware:l.props.middleware,loader:l.props.loader,action:l.props.action,hydrateFallbackElement:l.props.hydrateFallbackElement,HydrateFallback:l.props.HydrateFallback,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.hasErrorBoundary===!0||l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(y.children=iP(l.props.children,m)),a.push(y)}),a}var WC="get",qC="application/x-www-form-urlencoded";function CR(i){return i!=null&&typeof i.tagName=="string"}function Soe(i){return CR(i)&&i.tagName.toLowerCase()==="button"}function xoe(i){return CR(i)&&i.tagName.toLowerCase()==="form"}function Toe(i){return CR(i)&&i.tagName.toLowerCase()==="input"}function Coe(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function Roe(i,n){return i.button===0&&(!n||n==="_self")&&!Coe(i)}function aP(i=""){return new URLSearchParams(typeof i=="string"||Array.isArray(i)||i instanceof URLSearchParams?i:Object.keys(i).reduce((n,a)=>{let l=i[a];return n.concat(Array.isArray(l)?l.map(u=>[a,u]):[[a,l]])},[]))}function Noe(i,n){let a=aP(i);return n&&n.forEach((l,u)=>{a.has(u)||n.getAll(u).forEach(m=>{a.append(u,m)})}),a}var EC=null;function Aoe(){if(EC===null)try{new FormData(document.createElement("form"),0),EC=!1}catch{EC=!0}return EC}var Ioe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ck(i){return i!=null&&!Ioe.has(i)?(Tl(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${qC}"`),null):i}function Ooe(i,n){let a,l,u,m,y;if(xoe(i)){let w=i.getAttribute("action");l=w?Au(w,n):null,a=i.getAttribute("method")||WC,u=ck(i.getAttribute("enctype"))||qC,m=new FormData(i)}else if(Soe(i)||Toe(i)&&(i.type==="submit"||i.type==="image")){let w=i.form;if(w==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let b=i.getAttribute("formaction")||w.getAttribute("action");if(l=b?Au(b,n):null,a=i.getAttribute("formmethod")||w.getAttribute("method")||WC,u=ck(i.getAttribute("formenctype"))||ck(w.getAttribute("enctype"))||qC,m=new FormData(w,i),!Aoe()){let{name:x,type:T,value:N}=i;if(T==="image"){let O=x?`${x}.`:"";m.append(`${O}x`,"0"),m.append(`${O}y`,"0")}else x&&m.append(x,N)}}else{if(CR(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=WC,l=null,u=qC,y=i}return m&&u==="text/plain"&&(y=m,m=void 0),{action:l,method:a.toLowerCase(),encType:u,formData:m,body:y}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function yD(i,n){if(i===!1||i===null||typeof i>"u")throw new Error(n)}function koe(i,n,a){let l=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return l.pathname==="/"?l.pathname=`_root.${a}`:n&&Au(l.pathname,n)==="/"?l.pathname=`${n.replace(/\/$/,"")}/_root.${a}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${a}`,l}async function Poe(i,n){if(i.id in n)return n[i.id];try{let a=await import(i.module);return n[i.id]=a,a}catch(a){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(a),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Doe(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function joe(i,n,a){let l=await Promise.all(i.map(async u=>{let m=n.routes[u.route.id];if(m){let y=await Poe(m,a);return y.links?y.links():[]}return[]}));return Foe(l.flat(1).filter(Doe).filter(u=>u.rel==="stylesheet"||u.rel==="preload").map(u=>u.rel==="stylesheet"?{...u,rel:"prefetch",as:"style"}:{...u,rel:"prefetch"}))}function oW(i,n,a,l,u,m){let y=(b,x)=>a[x]?b.route.id!==a[x].route.id:!0,w=(b,x)=>{var T;return a[x].pathname!==b.pathname||((T=a[x].route.path)==null?void 0:T.endsWith("*"))&&a[x].params["*"]!==b.params["*"]};return m==="assets"?n.filter((b,x)=>y(b,x)||w(b,x)):m==="data"?n.filter((b,x)=>{var N;let T=l.routes[b.route.id];if(!T||!T.hasLoader)return!1;if(y(b,x)||w(b,x))return!0;if(b.route.shouldRevalidate){let O=b.route.shouldRevalidate({currentUrl:new URL(u.pathname+u.search+u.hash,window.origin),currentParams:((N=a[0])==null?void 0:N.params)||{},nextUrl:new URL(i,window.origin),nextParams:b.params,defaultShouldRevalidate:!0});if(typeof O=="boolean")return O}return!0}):[]}function Loe(i,n,{includeHydrateFallback:a}={}){return Moe(i.map(l=>{let u=n.routes[l.route.id];if(!u)return[];let m=[u.module];return u.clientActionModule&&(m=m.concat(u.clientActionModule)),u.clientLoaderModule&&(m=m.concat(u.clientLoaderModule)),a&&u.hydrateFallbackModule&&(m=m.concat(u.hydrateFallbackModule)),u.imports&&(m=m.concat(u.imports)),m}).flat(1))}function Moe(i){return[...new Set(i)]}function Uoe(i){let n={},a=Object.keys(i).sort();for(let l of a)n[l]=i[l];return n}function Foe(i,n){let a=new Set;return new Set(n),i.reduce((l,u)=>{let m=JSON.stringify(Uoe(u));return a.has(m)||(a.add(m),l.push({key:m,link:u})),l},[])}function EH(){let i=M.useContext(Ky);return yD(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function Voe(){let i=M.useContext(TR);return yD(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var vD=M.createContext(void 0);vD.displayName="FrameworkContext";function wH(){let i=M.useContext(vD);return yD(i,"You must render this element inside a <HydratedRouter> element"),i}function Boe(i,n){let a=M.useContext(vD),[l,u]=M.useState(!1),[m,y]=M.useState(!1),{onFocus:w,onBlur:b,onMouseEnter:x,onMouseLeave:T,onTouchStart:N}=n,O=M.useRef(null);M.useEffect(()=>{if(i==="render"&&y(!0),i==="viewport"){let z=W=>{W.forEach(te=>{y(te.isIntersecting)})},V=new IntersectionObserver(z,{threshold:.5});return O.current&&V.observe(O.current),()=>{V.disconnect()}}},[i]),M.useEffect(()=>{if(l){let z=setTimeout(()=>{y(!0)},100);return()=>{clearTimeout(z)}}},[l]);let P=()=>{u(!0)},F=()=>{u(!1),y(!1)};return a?i!=="intent"?[m,O,{}]:[m,O,{onFocus:sw(w,P),onBlur:sw(b,F),onMouseEnter:sw(x,P),onMouseLeave:sw(T,F),onTouchStart:sw(N,P)}]:[!1,O,{}]}function sw(i,n){return a=>{i&&i(a),a.defaultPrevented||n(a)}}function Woe({page:i,...n}){let{router:a}=EH(),l=M.useMemo(()=>lH(a.routes,i,a.basename),[a.routes,i,a.basename]);return l?M.createElement(Goe,{page:i,matches:l,...n}):null}function qoe(i){let{manifest:n,routeModules:a}=wH(),[l,u]=M.useState([]);return M.useEffect(()=>{let m=!1;return joe(i,n,a).then(y=>{m||u(y)}),()=>{m=!0}},[i,n,a]),l}function Goe({page:i,matches:n,...a}){let l=Pc(),{manifest:u,routeModules:m}=wH(),{basename:y}=EH(),{loaderData:w,matches:b}=Voe(),x=M.useMemo(()=>oW(i,n,b,u,l,"data"),[i,n,b,u,l]),T=M.useMemo(()=>oW(i,n,b,u,l,"assets"),[i,n,b,u,l]),N=M.useMemo(()=>{if(i===l.pathname+l.search+l.hash)return[];let F=new Set,z=!1;if(n.forEach(W=>{var $;let te=u.routes[W.route.id];!te||!te.hasLoader||(!x.some(Q=>Q.route.id===W.route.id)&&W.route.id in w&&(($=m[W.route.id])!=null&&$.shouldRevalidate)||te.hasClientLoader?z=!0:F.add(W.route.id))}),F.size===0)return[];let V=koe(i,y,"data");return z&&F.size>0&&V.searchParams.set("_routes",n.filter(W=>F.has(W.route.id)).map(W=>W.route.id).join(",")),[V.pathname+V.search]},[y,w,l,u,x,n,i,m]),O=M.useMemo(()=>Loe(T,u),[T,u]),P=qoe(T);return M.createElement(M.Fragment,null,N.map(F=>M.createElement("link",{key:F,rel:"prefetch",as:"fetch",href:F,...a})),O.map(F=>M.createElement("link",{key:F,rel:"modulepreload",href:F,...a})),P.map(({key:F,link:z})=>M.createElement("link",{key:F,nonce:a.nonce,...z})))}function Hoe(...i){return n=>{i.forEach(a=>{typeof a=="function"?a(n):a!=null&&(a.current=n)})}}var bH=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{bH&&(window.__reactRouterVersion="7.9.5")}catch{}function Koe({basename:i,children:n,window:a}){let l=M.useRef();l.current==null&&(l.current=kae({window:a,v5Compat:!0}));let u=l.current,[m,y]=M.useState({action:u.action,location:u.location}),w=M.useCallback(b=>{M.startTransition(()=>y(b))},[y]);return M.useLayoutEffect(()=>u.listen(w),[u,w]),M.createElement(woe,{basename:i,children:n,location:m.location,navigationType:m.action,navigator:u})}var SH=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gy=M.forwardRef(function({onClick:n,discover:a="render",prefetch:l="none",relative:u,reloadDocument:m,replace:y,state:w,target:b,to:x,preventScrollReset:T,viewTransition:N,...O},P){let{basename:F}=M.useContext(Pd),z=typeof x=="string"&&SH.test(x),V,W=!1;if(typeof x=="string"&&z&&(V=x,bH))try{let Se=new URL(window.location.href),oe=x.startsWith("//")?new URL(Se.protocol+x):new URL(x),ve=Au(oe.pathname,F);oe.origin===Se.origin&&ve!=null?x=ve+oe.search+oe.hash:W=!0}catch{Tl(!1,`<Link to="${x}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let te=ioe(x,{relative:u}),[$,Q,G]=Boe(l,O),se=Xoe(x,{replace:y,state:w,target:b,preventScrollReset:T,relative:u,viewTransition:N});function ie(Se){n&&n(Se),Se.defaultPrevented||se(Se)}let ce=M.createElement("a",{...O,...G,href:V||te,onClick:W||m?n:ie,ref:Hoe(P,Q),target:b,"data-discover":!z&&a==="render"?"true":void 0});return $&&!z?M.createElement(M.Fragment,null,ce,M.createElement(Woe,{page:te})):ce});gy.displayName="Link";var zoe=M.forwardRef(function({"aria-current":n="page",caseSensitive:a=!1,className:l="",end:u=!1,style:m,to:y,viewTransition:w,children:b,...x},T){let N=tb(y,{relative:x.relative}),O=Pc(),P=M.useContext(TR),{navigator:F,basename:z}=M.useContext(Pd),V=P!=null&&tce(N)&&w===!0,W=F.encodeLocation?F.encodeLocation(N).pathname:N.pathname,te=O.pathname,$=P&&P.navigation&&P.navigation.location?P.navigation.location.pathname:null;a||(te=te.toLowerCase(),$=$?$.toLowerCase():null,W=W.toLowerCase()),$&&z&&($=Au($,z)||$);const Q=W!=="/"&&W.endsWith("/")?W.length-1:W.length;let G=te===W||!u&&te.startsWith(W)&&te.charAt(Q)==="/",se=$!=null&&($===W||!u&&$.startsWith(W)&&$.charAt(W.length)==="/"),ie={isActive:G,isPending:se,isTransitioning:V},ce=G?n:void 0,Se;typeof l=="function"?Se=l(ie):Se=[l,G?"active":null,se?"pending":null,V?"transitioning":null].filter(Boolean).join(" ");let oe=typeof m=="function"?m(ie):m;return M.createElement(gy,{...x,"aria-current":ce,className:Se,ref:T,style:oe,to:y,viewTransition:w},typeof b=="function"?b(ie):b)});zoe.displayName="NavLink";var $oe=M.forwardRef(({discover:i="render",fetcherKey:n,navigate:a,reloadDocument:l,replace:u,state:m,method:y=WC,action:w,onSubmit:b,relative:x,preventScrollReset:T,viewTransition:N,...O},P)=>{let F=Zoe(),z=ece(w,{relative:x}),V=y.toLowerCase()==="get"?"get":"post",W=typeof w=="string"&&SH.test(w),te=$=>{if(b&&b($),$.defaultPrevented)return;$.preventDefault();let Q=$.nativeEvent.submitter,G=(Q==null?void 0:Q.getAttribute("formmethod"))||y;F(Q||$.currentTarget,{fetcherKey:n,method:G,navigate:a,replace:u,state:m,relative:x,preventScrollReset:T,viewTransition:N})};return M.createElement("form",{ref:P,method:V,action:z,onSubmit:l?b:te,...O,"data-discover":!W&&i==="render"?"true":void 0})});$oe.displayName="Form";function Yoe(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function xH(i){let n=M.useContext(Ky);return Ds(n,Yoe(i)),n}function Xoe(i,{target:n,replace:a,state:l,preventScrollReset:u,relative:m,viewTransition:y}={}){let w=Wn(),b=Pc(),x=tb(i,{relative:m});return M.useCallback(T=>{if(Roe(T,n)){T.preventDefault();let N=a!==void 0?a:Nw(b)===Nw(x);w(i,{replace:N,state:l,preventScrollReset:u,relative:m,viewTransition:y})}},[b,w,x,a,l,n,i,u,m,y])}function TH(i){Tl(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let n=M.useRef(aP(i)),a=M.useRef(!1),l=Pc(),u=M.useMemo(()=>Noe(l.search,a.current?null:n.current),[l.search]),m=Wn(),y=M.useCallback((w,b)=>{const x=aP(typeof w=="function"?w(new URLSearchParams(u)):w);a.current=!0,m("?"+x,b)},[m,u]);return[u,y]}var Joe=0,Qoe=()=>`__${String(++Joe)}__`;function Zoe(){let{router:i}=xH("useSubmit"),{basename:n}=M.useContext(Pd),a=_oe();return M.useCallback(async(l,u={})=>{let{action:m,method:y,encType:w,formData:b,body:x}=Ooe(l,n);if(u.navigate===!1){let T=u.fetcherKey||Qoe();await i.fetch(T,a,u.action||m,{preventScrollReset:u.preventScrollReset,formData:b,body:x,formMethod:u.method||y,formEncType:u.encType||w,flushSync:u.flushSync})}else await i.navigate(u.action||m,{preventScrollReset:u.preventScrollReset,formData:b,body:x,formMethod:u.method||y,formEncType:u.encType||w,replace:u.replace,state:u.state,fromRouteId:a,flushSync:u.flushSync,viewTransition:u.viewTransition})},[i,n,a])}function ece(i,{relative:n}={}){let{basename:a}=M.useContext(Pd),l=M.useContext(Dd);Ds(l,"useFormAction must be used inside a RouteContext");let[u]=l.matches.slice(-1),m={...tb(i||".",{relative:n})},y=Pc();if(i==null){m.search=y.search;let w=new URLSearchParams(m.search),b=w.getAll("index");if(b.some(T=>T==="")){w.delete("index"),b.filter(N=>N).forEach(N=>w.append("index",N));let T=w.toString();m.search=T?`?${T}`:""}}return(!i||i===".")&&u.route.index&&(m.search=m.search?m.search.replace(/^\?/,"?index&"):"?index"),a!=="/"&&(m.pathname=m.pathname==="/"?a:Cu([a,m.pathname])),Nw(m)}function tce(i,{relative:n}={}){let a=M.useContext(mH);Ds(a!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=xH("useViewTransitionState"),u=tb(i,{relative:n});if(!a.isTransitioning)return!1;let m=Au(a.currentLocation.pathname,l)||a.currentLocation.pathname,y=Au(a.nextLocation.pathname,l)||a.nextLocation.pathname;return aR(u.pathname,y)!=null||aR(u.pathname,m)!=null}var ED=XG();const rce=Qw(ED);function Or(i){return i?{Home:"/Home",Store:"/Store",Profile:"/Profile",Admin:"/Admin",Trending:"/Trending",Following:"/Following",Followers:"/Followers",Messages:"/Messages",GoLive:"/GoLive",PublicProfile:"/PublicProfile",StreamViewer:"/StreamViewer",Notifications:"/Notifications",NotificationsPage:"/NotificationsPage",Login:"/Login",TrollFamilyApplication:"/TrollFamilyApplication",PaymentRequired:"/PaymentRequired",KickBanFee:"/KickBanFee"}[i]||`/${String(i)}`:"/"}/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nce=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),CH=(...i)=>i.filter((n,a,l)=>!!n&&n.trim()!==""&&l.indexOf(n)===a).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sce={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ice=M.forwardRef(({color:i="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:u="",children:m,iconNode:y,...w},b)=>M.createElement("svg",{ref:b,...sce,width:n,height:n,stroke:i,strokeWidth:l?Number(a)*24/Number(n):a,className:CH("lucide",u),...w},[...y.map(([x,T])=>M.createElement(x,T)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=(i,n)=>{const a=M.forwardRef(({className:l,...u},m)=>M.createElement(ice,{ref:m,iconNode:n,className:CH(`lucide-${nce(i)}`,l),...u}));return a.displayName=`${i}`,a};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ace=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],oce=kt("Archive",ace);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cce=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],RH=kt("ArrowLeft",cce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lce=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],dce=kt("AtSign",lce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uce=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],GC=kt("Award",uce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],pce=kt("Ban",hce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fce=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Am=kt("Bell",fce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mce=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],ay=kt("Bot",mce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gce=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],_ce=kt("Building",gce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yce=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],wD=kt("Calendar",yce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vce=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],NH=kt("Camera",vce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ece=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],AH=kt("Check",Ece);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wce=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],bc=kt("ChevronDown",wce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bce=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Zf=kt("ChevronUp",bce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],fp=kt("CircleAlert",Sce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xce=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ui=kt("CircleCheckBig",xce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Aw=kt("CircleX",Tce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],uo=kt("Clock",Cce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rce=[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]],Nce=kt("Code",Rce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ace=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],ni=kt("Coins",Ace);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ice=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],_y=kt("CreditCard",Ice);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oce=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],dp=kt("Crown",Oce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kce=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],Pce=kt("Diamond",kce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dce=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]],jce=kt("Dices",Dce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lce=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Es=kt("DollarSign",Lce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mce=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Uce=kt("Download",Mce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fce=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],bD=kt("ExternalLink",Fce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vce=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Mm=kt("Eye",Vce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bce=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],Wce=kt("FileCode",Bce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qce=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],Gce=kt("Filter",qce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hce=[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]],Kce=kt("Flag",Hce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zce=[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]],$ce=kt("Flame",zce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yce=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],jy=kt("Gift",Yce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xce=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],lk=kt("Grid3x3",Xce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jce=[["path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9",key:"eefl8a"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"b7pghm"}]],cW=kt("Hammer",Jce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qce=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],Ru=kt("Heart",Qce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zce=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],IH=kt("House",Zce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ele=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],yy=kt("LoaderCircle",ele);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tle=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],oP=kt("LockOpen",tle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rle=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Ly=kt("Lock",rle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nle=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],sle=kt("MapPin",nle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ile=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Um=kt("MessageCircle",ile);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ale=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],mp=kt("MessageSquare",ale);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ole=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],cle=kt("MicOff",ole);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lle=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],dle=kt("Mic",lle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ule=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],hle=kt("Palette",ule);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ple=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],fle=kt("Pause",ple);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mle=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],cP=kt("PenLine",mle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gle=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],OH=kt("Play",gle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _le=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],kH=kt("Plus",_le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yle=[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]],Si=kt("Radio",yle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vle=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],cp=kt("RefreshCw",vle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ele=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],wle=kt("RotateCcw",Ele);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ble=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],RR=kt("Save",ble);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sle=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],oR=kt("Search",Sle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xle=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Iw=kt("Send",xle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tle=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],My=kt("Settings",Tle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cle=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Rle=kt("Share2",Cle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nle=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],xi=kt("Shield",Nle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ale=[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]],lW=kt("ShoppingBag",Ale);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ile=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],dW=kt("ShoppingCart",Ile);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ole=[["path",{d:"M22 2 2 22",key:"y4kqgn"}]],uW=kt("Slash",Ole);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kle=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Ple=kt("Smartphone",kle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dle=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],lP=kt("Sparkles",Dle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jle=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],SD=kt("SquarePen",jle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lle=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Ow=kt("Star",Lle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mle=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],dk=kt("Target",Mle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ule=[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]],Fle=kt("Terminal",Ule);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vle=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],up=kt("Trash2",Vle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ble=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],Wle=kt("TrendingDown",Ble);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qle=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],kw=kt("TrendingUp",qle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gle=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ic=kt("TriangleAlert",Gle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hle=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],PH=kt("Trophy",Hle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kle=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],DH=kt("Upload",Kle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zle=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],$le=kt("UserMinus",zle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yle=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Xle=kt("UserPlus",Yle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jle=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],jH=kt("UserX",Jle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qle=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Pa=kt("User",Qle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zle=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],jn=kt("Users",Zle);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ede=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],tde=kt("VideoOff",ede);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rde=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],nde=kt("Video",rde);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sde=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],ide=kt("Wallet",sde);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ade=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Oc=kt("X",ade);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ode=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Pw=kt("Zap",ode),LH=ut.createContext({openMobile:!1,setOpenMobile:()=>{}});function cde({children:i}){const[n,a]=ut.useState(!1),l=ut.useMemo(()=>({openMobile:n,setOpenMobile:a}),[n]);return o.jsx(LH.Provider,{value:l,children:i})}function MH(){return ut.useContext(LH)}function lde({children:i,className:n=""}){return o.jsx("aside",{className:n,children:i})}function dde({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function ude({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function hde({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function em({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function iw({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function aw({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function ow({children:i,className:n=""}){return o.jsx("ul",{className:["list-none m-0 p-0 space-y-2",n].filter(Boolean).join(" "),children:i})}function pde({children:i,className:n=""}){return o.jsx("li",{className:["list-none",n].filter(Boolean).join(" "),children:i})}function fde({children:i,className:n="",onClick:a,asChild:l=!1}){if(l&&ut.isValidElement(i)){const u=i,m=[u.props.className,n].filter(Boolean).join(" "),y=w=>{typeof u.props.onClick=="function"&&u.props.onClick(w),typeof a=="function"&&a(w)};return ut.cloneElement(u,{className:m,onClick:y})}return o.jsx("button",{className:n,onClick:a,children:i})}function mde({children:i,className:n=""}){const{openMobile:a,setOpenMobile:l}=MH();return o.jsx("button",{className:n,onClick:()=>l(!a),children:i||(a?"Close":"Open")})}const xD=ut.createContext({value:!1,setValue:()=>{}});function Sc({open:i,onOpenChange:n,children:a,className:l=""}){const[u,m]=ut.useState(!!i);ut.useEffect(()=>{typeof i=="boolean"&&m(i)},[i]);const y=w=>{m(w),n&&n(w)};return o.jsx(xD.Provider,{value:{value:u,setValue:y},children:o.jsx("div",{className:l,children:a})})}function xc({children:i,className:n="",asChild:a=!1}){const{value:l,setValue:u}=ut.useContext(xD),m={className:n,onClick:()=>u(!l)};return a?ut.cloneElement(i,m):o.jsx("button",{...m,children:i})}function Tc({children:i,className:n=""}){const{value:a}=ut.useContext(xD);return o.jsx("div",{className:n,style:{display:a?"block":"none"},children:i})}const hW={default:"bg-blue-600 text-white hover:bg-blue-700",outline:"border border-[#2a2a3a] text-gray-300 bg-transparent hover:bg-[#2a2a3a] hover:text-white"};function ke({className:i="",variant:n="default",children:a,...l}){const u="inline-flex items-center justify-center h-9 px-4 py-2 rounded-xl text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",m=hW[n]||hW.default;return o.jsx("button",{className:`${u} ${m} ${i}`,...l,children:a})}function wt({className:i="",children:n,...a}){return o.jsx("span",{className:`inline-flex items-center rounded-lg px-2 py-0.5 text-xs font-medium ${i}`,...a,children:n})}var dP=function(i,n){return dP=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a[u]=l[u])},dP(i,n)};function UH(i,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");dP(i,n);function a(){this.constructor=i}i.prototype=n===null?Object.create(n):(a.prototype=n.prototype,new a)}var cR=function(){return cR=Object.assign||function(n){for(var a,l=1,u=arguments.length;l<u;l++){a=arguments[l];for(var m in a)Object.prototype.hasOwnProperty.call(a,m)&&(n[m]=a[m])}return n},cR.apply(this,arguments)};function zy(i,n){var a={};for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&n.indexOf(l)<0&&(a[l]=i[l]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,l=Object.getOwnPropertySymbols(i);u<l.length;u++)n.indexOf(l[u])<0&&Object.prototype.propertyIsEnumerable.call(i,l[u])&&(a[l[u]]=i[l[u]]);return a}function FH(i,n,a,l){var u=arguments.length,m=u<3?n:l===null?l=Object.getOwnPropertyDescriptor(n,a):l,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(i,n,a,l);else for(var w=i.length-1;w>=0;w--)(y=i[w])&&(m=(u<3?y(m):u>3?y(n,a,m):y(n,a))||m);return u>3&&m&&Object.defineProperty(n,a,m),m}function VH(i,n){return function(a,l){n(a,l,i)}}function BH(i,n,a,l,u,m){function y(W){if(W!==void 0&&typeof W!="function")throw new TypeError("Function expected");return W}for(var w=l.kind,b=w==="getter"?"get":w==="setter"?"set":"value",x=!n&&i?l.static?i:i.prototype:null,T=n||(x?Object.getOwnPropertyDescriptor(x,l.name):{}),N,O=!1,P=a.length-1;P>=0;P--){var F={};for(var z in l)F[z]=z==="access"?{}:l[z];for(var z in l.access)F.access[z]=l.access[z];F.addInitializer=function(W){if(O)throw new TypeError("Cannot add initializers after decoration has completed");m.push(y(W||null))};var V=(0,a[P])(w==="accessor"?{get:T.get,set:T.set}:T[b],F);if(w==="accessor"){if(V===void 0)continue;if(V===null||typeof V!="object")throw new TypeError("Object expected");(N=y(V.get))&&(T.get=N),(N=y(V.set))&&(T.set=N),(N=y(V.init))&&u.unshift(N)}else(N=y(V))&&(w==="field"?u.unshift(N):T[b]=N)}x&&Object.defineProperty(x,l.name,T),O=!0}function WH(i,n,a){for(var l=arguments.length>2,u=0;u<n.length;u++)a=l?n[u].call(i,a):n[u].call(i);return l?a:void 0}function qH(i){return typeof i=="symbol"?i:"".concat(i)}function GH(i,n,a){return typeof n=="symbol"&&(n=n.description?"[".concat(n.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:a?"".concat(a," ",n):n})}function HH(i,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,n)}function rr(i,n,a,l){function u(m){return m instanceof a?m:new a(function(y){y(m)})}return new(a||(a=Promise))(function(m,y){function w(T){try{x(l.next(T))}catch(N){y(N)}}function b(T){try{x(l.throw(T))}catch(N){y(N)}}function x(T){T.done?m(T.value):u(T.value).then(w,b)}x((l=l.apply(i,n||[])).next())})}function KH(i,n){var a={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},l,u,m,y=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return y.next=w(0),y.throw=w(1),y.return=w(2),typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function w(x){return function(T){return b([x,T])}}function b(x){if(l)throw new TypeError("Generator is already executing.");for(;y&&(y=0,x[0]&&(a=0)),a;)try{if(l=1,u&&(m=x[0]&2?u.return:x[0]?u.throw||((m=u.return)&&m.call(u),0):u.next)&&!(m=m.call(u,x[1])).done)return m;switch(u=0,m&&(x=[x[0]&2,m.value]),x[0]){case 0:case 1:m=x;break;case 4:return a.label++,{value:x[1],done:!1};case 5:a.label++,u=x[1],x=[0];continue;case 7:x=a.ops.pop(),a.trys.pop();continue;default:if(m=a.trys,!(m=m.length>0&&m[m.length-1])&&(x[0]===6||x[0]===2)){a=0;continue}if(x[0]===3&&(!m||x[1]>m[0]&&x[1]<m[3])){a.label=x[1];break}if(x[0]===6&&a.label<m[1]){a.label=m[1],m=x;break}if(m&&a.label<m[2]){a.label=m[2],a.ops.push(x);break}m[2]&&a.ops.pop(),a.trys.pop();continue}x=n.call(i,a)}catch(T){x=[6,T],u=0}finally{l=m=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var NR=Object.create?(function(i,n,a,l){l===void 0&&(l=a);var u=Object.getOwnPropertyDescriptor(n,a);(!u||("get"in u?!n.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return n[a]}}),Object.defineProperty(i,l,u)}):(function(i,n,a,l){l===void 0&&(l=a),i[l]=n[a]});function zH(i,n){for(var a in i)a!=="default"&&!Object.prototype.hasOwnProperty.call(n,a)&&NR(n,i,a)}function lR(i){var n=typeof Symbol=="function"&&Symbol.iterator,a=n&&i[n],l=0;if(a)return a.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&l>=i.length&&(i=void 0),{value:i&&i[l++],done:!i}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function TD(i,n){var a=typeof Symbol=="function"&&i[Symbol.iterator];if(!a)return i;var l=a.call(i),u,m=[],y;try{for(;(n===void 0||n-- >0)&&!(u=l.next()).done;)m.push(u.value)}catch(w){y={error:w}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(y)throw y.error}}return m}function $H(){for(var i=[],n=0;n<arguments.length;n++)i=i.concat(TD(arguments[n]));return i}function YH(){for(var i=0,n=0,a=arguments.length;n<a;n++)i+=arguments[n].length;for(var l=Array(i),u=0,n=0;n<a;n++)for(var m=arguments[n],y=0,w=m.length;y<w;y++,u++)l[u]=m[y];return l}function XH(i,n,a){if(a||arguments.length===2)for(var l=0,u=n.length,m;l<u;l++)(m||!(l in n))&&(m||(m=Array.prototype.slice.call(n,0,l)),m[l]=n[l]);return i.concat(m||Array.prototype.slice.call(n))}function Uy(i){return this instanceof Uy?(this.v=i,this):new Uy(i)}function JH(i,n,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l=a.apply(i,n||[]),u,m=[];return u=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),w("next"),w("throw"),w("return",y),u[Symbol.asyncIterator]=function(){return this},u;function y(P){return function(F){return Promise.resolve(F).then(P,N)}}function w(P,F){l[P]&&(u[P]=function(z){return new Promise(function(V,W){m.push([P,z,V,W])>1||b(P,z)})},F&&(u[P]=F(u[P])))}function b(P,F){try{x(l[P](F))}catch(z){O(m[0][3],z)}}function x(P){P.value instanceof Uy?Promise.resolve(P.value.v).then(T,N):O(m[0][2],P)}function T(P){b("next",P)}function N(P){b("throw",P)}function O(P,F){P(F),m.shift(),m.length&&b(m[0][0],m[0][1])}}function QH(i){var n,a;return n={},l("next"),l("throw",function(u){throw u}),l("return"),n[Symbol.iterator]=function(){return this},n;function l(u,m){n[u]=i[u]?function(y){return(a=!a)?{value:Uy(i[u](y)),done:!1}:m?m(y):y}:m}}function ZH(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=i[Symbol.asyncIterator],a;return n?n.call(i):(i=typeof lR=="function"?lR(i):i[Symbol.iterator](),a={},l("next"),l("throw"),l("return"),a[Symbol.asyncIterator]=function(){return this},a);function l(m){a[m]=i[m]&&function(y){return new Promise(function(w,b){y=i[m](y),u(w,b,y.done,y.value)})}}function u(m,y,w,b){Promise.resolve(b).then(function(x){m({value:x,done:w})},y)}}function eK(i,n){return Object.defineProperty?Object.defineProperty(i,"raw",{value:n}):i.raw=n,i}var gde=Object.create?(function(i,n){Object.defineProperty(i,"default",{enumerable:!0,value:n})}):function(i,n){i.default=n},uP=function(i){return uP=Object.getOwnPropertyNames||function(n){var a=[];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(a[a.length]=l);return a},uP(i)};function tK(i){if(i&&i.__esModule)return i;var n={};if(i!=null)for(var a=uP(i),l=0;l<a.length;l++)a[l]!=="default"&&NR(n,i,a[l]);return gde(n,i),n}function rK(i){return i&&i.__esModule?i:{default:i}}function nK(i,n,a,l){if(a==="a"&&!l)throw new TypeError("Private accessor was defined without a getter");if(typeof n=="function"?i!==n||!l:!n.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?l:a==="a"?l.call(i):l?l.value:n.get(i)}function sK(i,n,a,l,u){if(l==="m")throw new TypeError("Private method is not writable");if(l==="a"&&!u)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?i!==n||!u:!n.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return l==="a"?u.call(i,a):u?u.value=a:n.set(i,a),a}function iK(i,n){if(n===null||typeof n!="object"&&typeof n!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof i=="function"?n===i:i.has(n)}function aK(i,n,a){if(n!=null){if(typeof n!="object"&&typeof n!="function")throw new TypeError("Object expected.");var l,u;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");l=n[Symbol.asyncDispose]}if(l===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");l=n[Symbol.dispose],a&&(u=l)}if(typeof l!="function")throw new TypeError("Object not disposable.");u&&(l=function(){try{u.call(this)}catch(m){return Promise.reject(m)}}),i.stack.push({value:n,dispose:l,async:a})}else a&&i.stack.push({async:!0});return n}var _de=typeof SuppressedError=="function"?SuppressedError:function(i,n,a){var l=new Error(a);return l.name="SuppressedError",l.error=i,l.suppressed=n,l};function oK(i){function n(m){i.error=i.hasError?new _de(m,i.error,"An error was suppressed during disposal."):m,i.hasError=!0}var a,l=0;function u(){for(;a=i.stack.pop();)try{if(!a.async&&l===1)return l=0,i.stack.push(a),Promise.resolve().then(u);if(a.dispose){var m=a.dispose.call(a.value);if(a.async)return l|=2,Promise.resolve(m).then(u,function(y){return n(y),u()})}else l|=1}catch(y){n(y)}if(l===1)return i.hasError?Promise.reject(i.error):Promise.resolve();if(i.hasError)throw i.error}return u()}function cK(i,n){return typeof i=="string"&&/^\.\.?\//.test(i)?i.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(a,l,u,m,y){return l?n?".jsx":".js":u&&(!m||!y)?a:u+m+"."+y.toLowerCase()+"js"}):i}const yde={__extends:UH,__assign:cR,__rest:zy,__decorate:FH,__param:VH,__esDecorate:BH,__runInitializers:WH,__propKey:qH,__setFunctionName:GH,__metadata:HH,__awaiter:rr,__generator:KH,__createBinding:NR,__exportStar:zH,__values:lR,__read:TD,__spread:$H,__spreadArrays:YH,__spreadArray:XH,__await:Uy,__asyncGenerator:JH,__asyncDelegator:QH,__asyncValues:ZH,__makeTemplateObject:eK,__importStar:tK,__importDefault:rK,__classPrivateFieldGet:nK,__classPrivateFieldSet:sK,__classPrivateFieldIn:iK,__addDisposableResource:aK,__disposeResources:oK,__rewriteRelativeImportExtension:cK},vde=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:aK,get __assign(){return cR},__asyncDelegator:QH,__asyncGenerator:JH,__asyncValues:ZH,__await:Uy,__awaiter:rr,__classPrivateFieldGet:nK,__classPrivateFieldIn:iK,__classPrivateFieldSet:sK,__createBinding:NR,__decorate:FH,__disposeResources:oK,__esDecorate:BH,__exportStar:zH,__extends:UH,__generator:KH,__importDefault:rK,__importStar:tK,__makeTemplateObject:eK,__metadata:HH,__param:VH,__propKey:qH,__read:TD,__rest:zy,__rewriteRelativeImportExtension:cK,__runInitializers:WH,__setFunctionName:GH,__spread:$H,__spreadArray:XH,__spreadArrays:YH,__values:lR,default:yde},Symbol.toStringTag,{value:"Module"})),Ede=i=>i?(...n)=>i(...n):(...n)=>fetch(...n);class CD extends Error{constructor(n,a="FunctionsError",l){super(n),this.name=a,this.context=l}}class wde extends CD{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}}class pW extends CD{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}}class fW extends CD{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}}var hP;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(hP||(hP={}));class bde{constructor(n,{headers:a={},customFetch:l,region:u=hP.Any}={}){this.url=n,this.headers=a,this.region=u,this.fetch=Ede(l)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n){return rr(this,arguments,void 0,function*(a,l={}){var u;let m,y;try{const{headers:w,method:b,body:x,signal:T,timeout:N}=l;let O={},{region:P}=l;P||(P=this.region);const F=new URL(`${this.url}/${a}`);P&&P!=="any"&&(O["x-region"]=P,F.searchParams.set("forceFunctionRegion",P));let z;x&&(w&&!Object.prototype.hasOwnProperty.call(w,"Content-Type")||!w)?typeof Blob<"u"&&x instanceof Blob||x instanceof ArrayBuffer?(O["Content-Type"]="application/octet-stream",z=x):typeof x=="string"?(O["Content-Type"]="text/plain",z=x):typeof FormData<"u"&&x instanceof FormData?z=x:(O["Content-Type"]="application/json",z=JSON.stringify(x)):z=x;let V=T;N&&(y=new AbortController,m=setTimeout(()=>y.abort(),N),T?(V=y.signal,T.addEventListener("abort",()=>y.abort())):V=y.signal);const W=yield this.fetch(F.toString(),{method:b||"POST",headers:Object.assign(Object.assign(Object.assign({},O),this.headers),w),body:z,signal:V}).catch(G=>{throw new wde(G)}),te=W.headers.get("x-relay-error");if(te&&te==="true")throw new pW(W);if(!W.ok)throw new fW(W);let $=((u=W.headers.get("Content-Type"))!==null&&u!==void 0?u:"text/plain").split(";")[0].trim(),Q;return $==="application/json"?Q=yield W.json():$==="application/octet-stream"||$==="application/pdf"?Q=yield W.blob():$==="text/event-stream"?Q=W:$==="multipart/form-data"?Q=yield W.formData():Q=yield W.text(),{data:Q,error:null,response:W}}catch(w){return{data:null,error:w,response:w instanceof fW||w instanceof pW?w.context:void 0}}finally{m&&clearTimeout(m)}})}}var ha={};const $y=Bie(vde);var wC={},bC={},SC={},xC={},TC={},CC={},mW;function lK(){if(mW)return CC;mW=1,Object.defineProperty(CC,"__esModule",{value:!0});class i extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}return CC.default=i,CC}var gW;function dK(){if(gW)return TC;gW=1,Object.defineProperty(TC,"__esModule",{value:!0});const n=$y.__importDefault(lK());class a{constructor(u){var m,y;this.shouldThrowOnError=!1,this.method=u.method,this.url=u.url,this.headers=new Headers(u.headers),this.schema=u.schema,this.body=u.body,this.shouldThrowOnError=(m=u.shouldThrowOnError)!==null&&m!==void 0?m:!1,this.signal=u.signal,this.isMaybeSingle=(y=u.isMaybeSingle)!==null&&y!==void 0?y:!1,u.fetch?this.fetch=u.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(u,m){return this.headers=new Headers(this.headers),this.headers.set(u,m),this}then(u,m){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const y=this.fetch;let w=y(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async b=>{var x,T,N,O;let P=null,F=null,z=null,V=b.status,W=b.statusText;if(b.ok){if(this.method!=="HEAD"){const G=await b.text();G===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((x=this.headers.get("Accept"))===null||x===void 0)&&x.includes("application/vnd.pgrst.plan+text"))?F=G:F=JSON.parse(G))}const $=(T=this.headers.get("Prefer"))===null||T===void 0?void 0:T.match(/count=(exact|planned|estimated)/),Q=(N=b.headers.get("content-range"))===null||N===void 0?void 0:N.split("/");$&&Q&&Q.length>1&&(z=parseInt(Q[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(F)&&(F.length>1?(P={code:"PGRST116",details:`Results contain ${F.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},F=null,z=null,V=406,W="Not Acceptable"):F.length===1?F=F[0]:F=null)}else{const $=await b.text();try{P=JSON.parse($),Array.isArray(P)&&b.status===404&&(F=[],P=null,V=200,W="OK")}catch{b.status===404&&$===""?(V=204,W="No Content"):P={message:$}}if(P&&this.isMaybeSingle&&(!((O=P==null?void 0:P.details)===null||O===void 0)&&O.includes("0 rows"))&&(P=null,V=200,W="OK"),P&&this.shouldThrowOnError)throw new n.default(P)}return{error:P,data:F,count:z,status:V,statusText:W}});return this.shouldThrowOnError||(w=w.catch(b=>{var x,T,N;return{error:{message:`${(x=b==null?void 0:b.name)!==null&&x!==void 0?x:"FetchError"}: ${b==null?void 0:b.message}`,details:`${(T=b==null?void 0:b.stack)!==null&&T!==void 0?T:""}`,hint:"",code:`${(N=b==null?void 0:b.code)!==null&&N!==void 0?N:""}`},data:null,count:null,status:0,statusText:""}})),w.then(u,m)}returns(){return this}overrideTypes(){return this}}return TC.default=a,TC}var _W;function uK(){if(_W)return xC;_W=1,Object.defineProperty(xC,"__esModule",{value:!0});const n=$y.__importDefault(dK());class a extends n.default{select(u){let m=!1;const y=(u??"*").split("").map(w=>/\s/.test(w)&&!m?"":(w==='"'&&(m=!m),w)).join("");return this.url.searchParams.set("select",y),this.headers.append("Prefer","return=representation"),this}order(u,{ascending:m=!0,nullsFirst:y,foreignTable:w,referencedTable:b=w}={}){const x=b?`${b}.order`:"order",T=this.url.searchParams.get(x);return this.url.searchParams.set(x,`${T?`${T},`:""}${u}.${m?"asc":"desc"}${y===void 0?"":y?".nullsfirst":".nullslast"}`),this}limit(u,{foreignTable:m,referencedTable:y=m}={}){const w=typeof y>"u"?"limit":`${y}.limit`;return this.url.searchParams.set(w,`${u}`),this}range(u,m,{foreignTable:y,referencedTable:w=y}={}){const b=typeof w>"u"?"offset":`${w}.offset`,x=typeof w>"u"?"limit":`${w}.limit`;return this.url.searchParams.set(b,`${u}`),this.url.searchParams.set(x,`${m-u+1}`),this}abortSignal(u){return this.signal=u,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:u=!1,verbose:m=!1,settings:y=!1,buffers:w=!1,wal:b=!1,format:x="text"}={}){var T;const N=[u?"analyze":null,m?"verbose":null,y?"settings":null,w?"buffers":null,b?"wal":null].filter(Boolean).join("|"),O=(T=this.headers.get("Accept"))!==null&&T!==void 0?T:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${x}; for="${O}"; options=${N};`),x==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(u){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${u}`),this}}return xC.default=a,xC}var yW;function RD(){if(yW)return SC;yW=1,Object.defineProperty(SC,"__esModule",{value:!0});const n=$y.__importDefault(uK()),a=new RegExp("[,()]");class l extends n.default{eq(m,y){return this.url.searchParams.append(m,`eq.${y}`),this}neq(m,y){return this.url.searchParams.append(m,`neq.${y}`),this}gt(m,y){return this.url.searchParams.append(m,`gt.${y}`),this}gte(m,y){return this.url.searchParams.append(m,`gte.${y}`),this}lt(m,y){return this.url.searchParams.append(m,`lt.${y}`),this}lte(m,y){return this.url.searchParams.append(m,`lte.${y}`),this}like(m,y){return this.url.searchParams.append(m,`like.${y}`),this}likeAllOf(m,y){return this.url.searchParams.append(m,`like(all).{${y.join(",")}}`),this}likeAnyOf(m,y){return this.url.searchParams.append(m,`like(any).{${y.join(",")}}`),this}ilike(m,y){return this.url.searchParams.append(m,`ilike.${y}`),this}ilikeAllOf(m,y){return this.url.searchParams.append(m,`ilike(all).{${y.join(",")}}`),this}ilikeAnyOf(m,y){return this.url.searchParams.append(m,`ilike(any).{${y.join(",")}}`),this}is(m,y){return this.url.searchParams.append(m,`is.${y}`),this}in(m,y){const w=Array.from(new Set(y)).map(b=>typeof b=="string"&&a.test(b)?`"${b}"`:`${b}`).join(",");return this.url.searchParams.append(m,`in.(${w})`),this}contains(m,y){return typeof y=="string"?this.url.searchParams.append(m,`cs.${y}`):Array.isArray(y)?this.url.searchParams.append(m,`cs.{${y.join(",")}}`):this.url.searchParams.append(m,`cs.${JSON.stringify(y)}`),this}containedBy(m,y){return typeof y=="string"?this.url.searchParams.append(m,`cd.${y}`):Array.isArray(y)?this.url.searchParams.append(m,`cd.{${y.join(",")}}`):this.url.searchParams.append(m,`cd.${JSON.stringify(y)}`),this}rangeGt(m,y){return this.url.searchParams.append(m,`sr.${y}`),this}rangeGte(m,y){return this.url.searchParams.append(m,`nxl.${y}`),this}rangeLt(m,y){return this.url.searchParams.append(m,`sl.${y}`),this}rangeLte(m,y){return this.url.searchParams.append(m,`nxr.${y}`),this}rangeAdjacent(m,y){return this.url.searchParams.append(m,`adj.${y}`),this}overlaps(m,y){return typeof y=="string"?this.url.searchParams.append(m,`ov.${y}`):this.url.searchParams.append(m,`ov.{${y.join(",")}}`),this}textSearch(m,y,{config:w,type:b}={}){let x="";b==="plain"?x="pl":b==="phrase"?x="ph":b==="websearch"&&(x="w");const T=w===void 0?"":`(${w})`;return this.url.searchParams.append(m,`${x}fts${T}.${y}`),this}match(m){return Object.entries(m).forEach(([y,w])=>{this.url.searchParams.append(y,`eq.${w}`)}),this}not(m,y,w){return this.url.searchParams.append(m,`not.${y}.${w}`),this}or(m,{foreignTable:y,referencedTable:w=y}={}){const b=w?`${w}.or`:"or";return this.url.searchParams.append(b,`(${m})`),this}filter(m,y,w){return this.url.searchParams.append(m,`${y}.${w}`),this}}return SC.default=l,SC}var vW;function hK(){if(vW)return bC;vW=1,Object.defineProperty(bC,"__esModule",{value:!0});const n=$y.__importDefault(RD());class a{constructor(u,{headers:m={},schema:y,fetch:w}){this.url=u,this.headers=new Headers(m),this.schema=y,this.fetch=w}select(u,m){const{head:y=!1,count:w}=m??{},b=y?"HEAD":"GET";let x=!1;const T=(u??"*").split("").map(N=>/\s/.test(N)&&!x?"":(N==='"'&&(x=!x),N)).join("");return this.url.searchParams.set("select",T),w&&this.headers.append("Prefer",`count=${w}`),new n.default({method:b,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(u,{count:m,defaultToNull:y=!0}={}){var w;const b="POST";if(m&&this.headers.append("Prefer",`count=${m}`),y||this.headers.append("Prefer","missing=default"),Array.isArray(u)){const x=u.reduce((T,N)=>T.concat(Object.keys(N)),[]);if(x.length>0){const T=[...new Set(x)].map(N=>`"${N}"`);this.url.searchParams.set("columns",T.join(","))}}return new n.default({method:b,url:this.url,headers:this.headers,schema:this.schema,body:u,fetch:(w=this.fetch)!==null&&w!==void 0?w:fetch})}upsert(u,{onConflict:m,ignoreDuplicates:y=!1,count:w,defaultToNull:b=!0}={}){var x;const T="POST";if(this.headers.append("Prefer",`resolution=${y?"ignore":"merge"}-duplicates`),m!==void 0&&this.url.searchParams.set("on_conflict",m),w&&this.headers.append("Prefer",`count=${w}`),b||this.headers.append("Prefer","missing=default"),Array.isArray(u)){const N=u.reduce((O,P)=>O.concat(Object.keys(P)),[]);if(N.length>0){const O=[...new Set(N)].map(P=>`"${P}"`);this.url.searchParams.set("columns",O.join(","))}}return new n.default({method:T,url:this.url,headers:this.headers,schema:this.schema,body:u,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}update(u,{count:m}={}){var y;const w="PATCH";return m&&this.headers.append("Prefer",`count=${m}`),new n.default({method:w,url:this.url,headers:this.headers,schema:this.schema,body:u,fetch:(y=this.fetch)!==null&&y!==void 0?y:fetch})}delete({count:u}={}){var m;const y="DELETE";return u&&this.headers.append("Prefer",`count=${u}`),new n.default({method:y,url:this.url,headers:this.headers,schema:this.schema,fetch:(m=this.fetch)!==null&&m!==void 0?m:fetch})}}return bC.default=a,bC}var EW;function Sde(){if(EW)return wC;EW=1,Object.defineProperty(wC,"__esModule",{value:!0});const i=$y,n=i.__importDefault(hK()),a=i.__importDefault(RD());class l{constructor(m,{headers:y={},schema:w,fetch:b}={}){this.url=m,this.headers=new Headers(y),this.schemaName=w,this.fetch=b}from(m){const y=new URL(`${this.url}/${m}`);return new n.default(y,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(m){return new l(this.url,{headers:this.headers,schema:m,fetch:this.fetch})}rpc(m,y={},{head:w=!1,get:b=!1,count:x}={}){var T;let N;const O=new URL(`${this.url}/rpc/${m}`);let P;w||b?(N=w?"HEAD":"GET",Object.entries(y).filter(([z,V])=>V!==void 0).map(([z,V])=>[z,Array.isArray(V)?`{${V.join(",")}}`:`${V}`]).forEach(([z,V])=>{O.searchParams.append(z,V)})):(N="POST",P=y);const F=new Headers(this.headers);return x&&F.set("Prefer",`count=${x}`),new a.default({method:N,url:O,headers:F,schema:this.schemaName,body:P,fetch:(T=this.fetch)!==null&&T!==void 0?T:fetch})}}return wC.default=l,wC}var wW;function xde(){if(wW)return ha;wW=1,Object.defineProperty(ha,"__esModule",{value:!0}),ha.PostgrestError=ha.PostgrestBuilder=ha.PostgrestTransformBuilder=ha.PostgrestFilterBuilder=ha.PostgrestQueryBuilder=ha.PostgrestClient=void 0;const i=$y,n=i.__importDefault(Sde());ha.PostgrestClient=n.default;const a=i.__importDefault(hK());ha.PostgrestQueryBuilder=a.default;const l=i.__importDefault(RD());ha.PostgrestFilterBuilder=l.default;const u=i.__importDefault(uK());ha.PostgrestTransformBuilder=u.default;const m=i.__importDefault(dK());ha.PostgrestBuilder=m.default;const y=i.__importDefault(lK());return ha.PostgrestError=y.default,ha.default={PostgrestClient:n.default,PostgrestQueryBuilder:a.default,PostgrestFilterBuilder:l.default,PostgrestTransformBuilder:u.default,PostgrestBuilder:m.default,PostgrestError:y.default},ha}var pK=xde();const fK=Qw(pK),Tde=$G({__proto__:null,default:fK},[pK]),{PostgrestClient:Cde,PostgrestQueryBuilder:pSe,PostgrestFilterBuilder:fSe,PostgrestTransformBuilder:mSe,PostgrestBuilder:gSe,PostgrestError:_Se}=fK||Tde;class Rde{static detectEnvironment(){var n;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((n=navigator.userAgent)===null||n===void 0)&&n.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const a=process.versions;if(a&&a.node){const l=a.node,u=parseInt(l.replace(/^v/,"").split(".")[0]);return u>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${u} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${u} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const n=this.detectEnvironment();if(n.constructor)return n.constructor;let a=n.error||"WebSocket not supported in this environment.";throw n.workaround&&(a+=`

Suggested solution: ${n.workaround}`),new Error(a)}static createWebSocket(n,a){const l=this.getWebSocketConstructor();return new l(n,a)}static isWebSocketSupported(){try{const n=this.detectEnvironment();return n.type==="native"||n.type==="ws"}catch{return!1}}}const Nde="2.81.1",Ade=`realtime-js/${Nde}`,mK="1.0.0",Ide="2.0.0",bW=mK,pP=1e4,Ode=1e3,kde=100;var lm;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(lm||(lm={}));var Ei;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(Ei||(Ei={}));var Cc;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Cc||(Cc={}));var fP;(function(i){i.websocket="websocket"})(fP||(fP={}));var dm;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(dm||(dm={}));class Pde{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(n,a){if(this._isArrayBuffer(n.payload))return a(this._binaryEncodePush(n));if(n.event===this.BROADCAST&&!(n.payload instanceof ArrayBuffer)&&typeof n.payload.event=="string")return a(this._binaryEncodeUserBroadcastPush(n));let l=[n.join_ref,n.ref,n.topic,n.event,n.payload];return a(JSON.stringify(l))}_binaryEncodePush(n){const{join_ref:a,ref:l,event:u,topic:m,payload:y}=n,w=this.META_LENGTH+a.length+l.length+m.length+u.length,b=new ArrayBuffer(this.HEADER_LENGTH+w);let x=new DataView(b),T=0;x.setUint8(T++,this.KINDS.push),x.setUint8(T++,a.length),x.setUint8(T++,l.length),x.setUint8(T++,m.length),x.setUint8(T++,u.length),Array.from(a,O=>x.setUint8(T++,O.charCodeAt(0))),Array.from(l,O=>x.setUint8(T++,O.charCodeAt(0))),Array.from(m,O=>x.setUint8(T++,O.charCodeAt(0))),Array.from(u,O=>x.setUint8(T++,O.charCodeAt(0)));var N=new Uint8Array(b.byteLength+y.byteLength);return N.set(new Uint8Array(b),0),N.set(new Uint8Array(y),b.byteLength),N.buffer}_binaryEncodeUserBroadcastPush(n){var a;return this._isArrayBuffer((a=n.payload)===null||a===void 0?void 0:a.payload)?this._encodeBinaryUserBroadcastPush(n):this._encodeJsonUserBroadcastPush(n)}_encodeBinaryUserBroadcastPush(n){var a,l;const{join_ref:u,ref:m,topic:y}=n,w=n.payload.event,b=(l=(a=n.payload)===null||a===void 0?void 0:a.payload)!==null&&l!==void 0?l:new ArrayBuffer(0),x=this.USER_BROADCAST_PUSH_META_LENGTH+u.length+m.length+y.length+w.length,T=new ArrayBuffer(this.HEADER_LENGTH+x);let N=new DataView(T),O=0;N.setUint8(O++,this.KINDS.userBroadcastPush),N.setUint8(O++,u.length),N.setUint8(O++,m.length),N.setUint8(O++,y.length),N.setUint8(O++,w.length),N.setUint8(O++,this.BINARY_ENCODING),Array.from(u,F=>N.setUint8(O++,F.charCodeAt(0))),Array.from(m,F=>N.setUint8(O++,F.charCodeAt(0))),Array.from(y,F=>N.setUint8(O++,F.charCodeAt(0))),Array.from(w,F=>N.setUint8(O++,F.charCodeAt(0)));var P=new Uint8Array(T.byteLength+b.byteLength);return P.set(new Uint8Array(T),0),P.set(new Uint8Array(b),T.byteLength),P.buffer}_encodeJsonUserBroadcastPush(n){var a,l;const{join_ref:u,ref:m,topic:y}=n,w=n.payload.event,b=(l=(a=n.payload)===null||a===void 0?void 0:a.payload)!==null&&l!==void 0?l:{},T=new TextEncoder().encode(JSON.stringify(b)).buffer,N=this.USER_BROADCAST_PUSH_META_LENGTH+u.length+m.length+y.length+w.length,O=new ArrayBuffer(this.HEADER_LENGTH+N);let P=new DataView(O),F=0;P.setUint8(F++,this.KINDS.userBroadcastPush),P.setUint8(F++,u.length),P.setUint8(F++,m.length),P.setUint8(F++,y.length),P.setUint8(F++,w.length),P.setUint8(F++,this.JSON_ENCODING),Array.from(u,V=>P.setUint8(F++,V.charCodeAt(0))),Array.from(m,V=>P.setUint8(F++,V.charCodeAt(0))),Array.from(y,V=>P.setUint8(F++,V.charCodeAt(0))),Array.from(w,V=>P.setUint8(F++,V.charCodeAt(0)));var z=new Uint8Array(O.byteLength+T.byteLength);return z.set(new Uint8Array(O),0),z.set(new Uint8Array(T),O.byteLength),z.buffer}decode(n,a){if(this._isArrayBuffer(n)){let l=this._binaryDecode(n);return a(l)}if(typeof n=="string"){const l=JSON.parse(n),[u,m,y,w,b]=l;return a({join_ref:u,ref:m,topic:y,event:w,payload:b})}return a({})}_binaryDecode(n){const a=new DataView(n),l=a.getUint8(0),u=new TextDecoder;switch(l){case this.KINDS.push:return this._decodePush(n,a,u);case this.KINDS.reply:return this._decodeReply(n,a,u);case this.KINDS.broadcast:return this._decodeBroadcast(n,a,u);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(n,a,u)}}_decodePush(n,a,l){const u=a.getUint8(1),m=a.getUint8(2),y=a.getUint8(3);let w=this.HEADER_LENGTH+this.META_LENGTH-1;const b=l.decode(n.slice(w,w+u));w=w+u;const x=l.decode(n.slice(w,w+m));w=w+m;const T=l.decode(n.slice(w,w+y));w=w+y;const N=JSON.parse(l.decode(n.slice(w,n.byteLength)));return{join_ref:b,ref:null,topic:x,event:T,payload:N}}_decodeReply(n,a,l){const u=a.getUint8(1),m=a.getUint8(2),y=a.getUint8(3),w=a.getUint8(4);let b=this.HEADER_LENGTH+this.META_LENGTH;const x=l.decode(n.slice(b,b+u));b=b+u;const T=l.decode(n.slice(b,b+m));b=b+m;const N=l.decode(n.slice(b,b+y));b=b+y;const O=l.decode(n.slice(b,b+w));b=b+w;const P=JSON.parse(l.decode(n.slice(b,n.byteLength))),F={status:O,response:P};return{join_ref:x,ref:T,topic:N,event:Cc.reply,payload:F}}_decodeBroadcast(n,a,l){const u=a.getUint8(1),m=a.getUint8(2);let y=this.HEADER_LENGTH+2;const w=l.decode(n.slice(y,y+u));y=y+u;const b=l.decode(n.slice(y,y+m));y=y+m;const x=JSON.parse(l.decode(n.slice(y,n.byteLength)));return{join_ref:null,ref:null,topic:w,event:b,payload:x}}_decodeUserBroadcast(n,a,l){const u=a.getUint8(1),m=a.getUint8(2),y=a.getUint8(3),w=a.getUint8(4);let b=this.HEADER_LENGTH+4;const x=l.decode(n.slice(b,b+u));b=b+u;const T=l.decode(n.slice(b,b+m));b=b+m;const N=l.decode(n.slice(b,b+y));b=b+y;const O=n.slice(b,n.byteLength),P=w===this.JSON_ENCODING?JSON.parse(l.decode(O)):O,F={type:this.BROADCAST,event:T,payload:P};return y>0&&(F.meta=JSON.parse(N)),{join_ref:null,ref:null,topic:x,event:this.BROADCAST,payload:F}}_isArrayBuffer(n){var a;return n instanceof ArrayBuffer||((a=n==null?void 0:n.constructor)===null||a===void 0?void 0:a.name)==="ArrayBuffer"}}class gK{constructor(n,a){this.callback=n,this.timerCalc=a,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=a}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var is;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(is||(is={}));const SW=(i,n,a={})=>{var l;const u=(l=a.skipTypes)!==null&&l!==void 0?l:[];return n?Object.keys(n).reduce((m,y)=>(m[y]=Dde(y,i,n,u),m),{}):{}},Dde=(i,n,a,l)=>{const u=n.find(w=>w.name===i),m=u==null?void 0:u.type,y=a[i];return m&&!l.includes(m)?_K(m,y):mP(y)},_K=(i,n)=>{if(i.charAt(0)==="_"){const a=i.slice(1,i.length);return Ude(n,a)}switch(i){case is.bool:return jde(n);case is.float4:case is.float8:case is.int2:case is.int4:case is.int8:case is.numeric:case is.oid:return Lde(n);case is.json:case is.jsonb:return Mde(n);case is.timestamp:return Fde(n);case is.abstime:case is.date:case is.daterange:case is.int4range:case is.int8range:case is.money:case is.reltime:case is.text:case is.time:case is.timestamptz:case is.timetz:case is.tsrange:case is.tstzrange:return mP(n);default:return mP(n)}},mP=i=>i,jde=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Lde=i=>{if(typeof i=="string"){const n=parseFloat(i);if(!Number.isNaN(n))return n}return i},Mde=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(n){return console.log(`JSON parse error: ${n}`),i}return i},Ude=(i,n)=>{if(typeof i!="string")return i;const a=i.length-1,l=i[a];if(i[0]==="{"&&l==="}"){let m;const y=i.slice(1,a);try{m=JSON.parse("["+y+"]")}catch{m=y?y.split(","):[]}return m.map(w=>_K(n,w))}return i},Fde=i=>typeof i=="string"?i.replace(" ","T"):i,yK=i=>{const n=new URL(i);return n.protocol=n.protocol.replace(/^ws/i,"http"),n.pathname=n.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),n.pathname===""||n.pathname==="/"?n.pathname="/api/broadcast":n.pathname=n.pathname+"/api/broadcast",n.href};class uk{constructor(n,a,l={},u=pP){this.channel=n,this.event=a,this.payload=l,this.timeout=u,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,a){var l;return this._hasReceived(n)&&a((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:n,callback:a}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const n=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,a){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:a})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:a}){this.recHooks.filter(l=>l.status===n).forEach(l=>l.callback(a))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}}var xW;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(xW||(xW={}));class Ew{constructor(n,a){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=(a==null?void 0:a.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},u=>{const{onJoin:m,onLeave:y,onSync:w}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ew.syncState(this.state,u,m,y),this.pendingDiffs.forEach(b=>{this.state=Ew.syncDiff(this.state,b,m,y)}),this.pendingDiffs=[],w()}),this.channel._on(l.diff,{},u=>{const{onJoin:m,onLeave:y,onSync:w}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(u):(this.state=Ew.syncDiff(this.state,u,m,y),w())}),this.onJoin((u,m,y)=>{this.channel._trigger("presence",{event:"join",key:u,currentPresences:m,newPresences:y})}),this.onLeave((u,m,y)=>{this.channel._trigger("presence",{event:"leave",key:u,currentPresences:m,leftPresences:y})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,a,l,u){const m=this.cloneDeep(n),y=this.transformState(a),w={},b={};return this.map(m,(x,T)=>{y[x]||(b[x]=T)}),this.map(y,(x,T)=>{const N=m[x];if(N){const O=T.map(V=>V.presence_ref),P=N.map(V=>V.presence_ref),F=T.filter(V=>P.indexOf(V.presence_ref)<0),z=N.filter(V=>O.indexOf(V.presence_ref)<0);F.length>0&&(w[x]=F),z.length>0&&(b[x]=z)}else w[x]=T}),this.syncDiff(m,{joins:w,leaves:b},l,u)}static syncDiff(n,a,l,u){const{joins:m,leaves:y}={joins:this.transformState(a.joins),leaves:this.transformState(a.leaves)};return l||(l=()=>{}),u||(u=()=>{}),this.map(m,(w,b)=>{var x;const T=(x=n[w])!==null&&x!==void 0?x:[];if(n[w]=this.cloneDeep(b),T.length>0){const N=n[w].map(P=>P.presence_ref),O=T.filter(P=>N.indexOf(P.presence_ref)<0);n[w].unshift(...O)}l(w,T,b)}),this.map(y,(w,b)=>{let x=n[w];if(!x)return;const T=b.map(N=>N.presence_ref);x=x.filter(N=>T.indexOf(N.presence_ref)<0),n[w]=x,u(w,x,b),x.length===0&&delete n[w]}),n}static map(n,a){return Object.getOwnPropertyNames(n).map(l=>a(l,n[l]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((a,l)=>{const u=n[l];return"metas"in u?a[l]=u.metas.map(m=>(m.presence_ref=m.phx_ref,delete m.phx_ref,delete m.phx_ref_prev,m)):a[l]=u,a},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var TW;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(TW||(TW={}));var ww;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(ww||(ww={}));var Eu;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Eu||(Eu={}));class ND{constructor(n,a={config:{}},l){var u,m;if(this.topic=n,this.params=a,this.socket=l,this.bindings={},this.state=Ei.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new uk(this,Cc.join,this.params,this.timeout),this.rejoinTimer=new gK(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ei.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(y=>y.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ei.closed,this.socket._remove(this)}),this._onError(y=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,y),this.state=Ei.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ei.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",y=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,y),this.state=Ei.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Cc.reply,{},(y,w)=>{this._trigger(this._replyEventName(w),y)}),this.presence=new Ew(this),this.broadcastEndpointURL=yK(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((m=(u=this.params.config)===null||u===void 0?void 0:u.broadcast)===null||m===void 0)&&m.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(n,a=this.timeout){var l,u,m;if(this.socket.isConnected()||this.socket.connect(),this.state==Ei.closed){const{config:{broadcast:y,presence:w,private:b}}=this.params,x=(u=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(P=>P.filter))!==null&&u!==void 0?u:[],T=!!this.bindings[ww.PRESENCE]&&this.bindings[ww.PRESENCE].length>0||((m=this.params.config.presence)===null||m===void 0?void 0:m.enabled)===!0,N={},O={broadcast:y,presence:Object.assign(Object.assign({},w),{enabled:T}),postgres_changes:x,private:b};this.socket.accessTokenValue&&(N.access_token=this.socket.accessTokenValue),this._onError(P=>n==null?void 0:n(Eu.CHANNEL_ERROR,P)),this._onClose(()=>n==null?void 0:n(Eu.CLOSED)),this.updateJoinPayload(Object.assign({config:O},N)),this.joinedOnce=!0,this._rejoin(a),this.joinPush.receive("ok",async({postgres_changes:P})=>{var F;if(this.socket.setAuth(),P===void 0){n==null||n(Eu.SUBSCRIBED);return}else{const z=this.bindings.postgres_changes,V=(F=z==null?void 0:z.length)!==null&&F!==void 0?F:0,W=[];for(let te=0;te<V;te++){const $=z[te],{filter:{event:Q,schema:G,table:se,filter:ie}}=$,ce=P&&P[te];if(ce&&ce.event===Q&&ce.schema===G&&ce.table===se&&ce.filter===ie)W.push(Object.assign(Object.assign({},$),{id:ce.id}));else{this.unsubscribe(),this.state=Ei.errored,n==null||n(Eu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=W,n&&n(Eu.SUBSCRIBED);return}}).receive("error",P=>{this.state=Ei.errored,n==null||n(Eu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(P).join(", ")||"error")))}).receive("timeout",()=>{n==null||n(Eu.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,a={}){return await this.send({type:"presence",event:"track",payload:n},a.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,a,l){return this.state===Ei.joined&&n===ww.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(n,a,l)}async httpSend(n,a,l={}){var u;const m=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(a==null)return Promise.reject("Payload is required for httpSend()");const y={method:"POST",headers:{Authorization:m,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})},w=await this._fetchWithTimeout(this.broadcastEndpointURL,y,(u=l.timeout)!==null&&u!==void 0?u:this.timeout);if(w.status===202)return{success:!0};let b=w.statusText;try{const x=await w.json();b=x.error||x.message||b}catch{}return Promise.reject(new Error(b))}async send(n,a={}){var l,u;if(!this._canPush()&&n.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:m,payload:y}=n,b={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:m,payload:y,private:this.private}]})};try{const x=await this._fetchWithTimeout(this.broadcastEndpointURL,b,(l=a.timeout)!==null&&l!==void 0?l:this.timeout);return await((u=x.body)===null||u===void 0?void 0:u.cancel()),x.ok?"ok":"error"}catch(x){return x.name==="AbortError"?"timed out":"error"}}else return new Promise(m=>{var y,w,b;const x=this._push(n.type,n,a.timeout||this.timeout);n.type==="broadcast"&&!(!((b=(w=(y=this.params)===null||y===void 0?void 0:y.config)===null||w===void 0?void 0:w.broadcast)===null||b===void 0)&&b.ack)&&m("ok"),x.receive("ok",()=>m("ok")),x.receive("error",()=>m("error")),x.receive("timeout",()=>m("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Ei.leaving;const a=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Cc.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(u=>{l=new uk(this,Cc.leave,{},n),l.receive("ok",()=>{a(),u("ok")}).receive("timeout",()=>{a(),u("timed out")}).receive("error",()=>{u("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l==null||l.destroy()})}teardown(){this.pushBuffer.forEach(n=>n.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ei.closed,this.bindings={}}async _fetchWithTimeout(n,a,l){const u=new AbortController,m=setTimeout(()=>u.abort(),l),y=await this.socket.fetch(n,Object.assign(Object.assign({},a),{signal:u.signal}));return clearTimeout(m),y}_push(n,a,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let u=new uk(this,n,a,l);return this._canPush()?u.send():this._addToPushBuffer(u),u}_addToPushBuffer(n){if(n.startTimeout(),this.pushBuffer.push(n),this.pushBuffer.length>kde){const a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(n,a,l){return a}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,a,l){var u,m;const y=n.toLocaleLowerCase(),{close:w,error:b,leave:x,join:T}=Cc;if(l&&[w,b,x,T].indexOf(y)>=0&&l!==this._joinRef())return;let O=this._onMessage(y,a,l);if(a&&!O)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(y)?(u=this.bindings.postgres_changes)===null||u===void 0||u.filter(P=>{var F,z,V;return((F=P.filter)===null||F===void 0?void 0:F.event)==="*"||((V=(z=P.filter)===null||z===void 0?void 0:z.event)===null||V===void 0?void 0:V.toLocaleLowerCase())===y}).map(P=>P.callback(O,l)):(m=this.bindings[y])===null||m===void 0||m.filter(P=>{var F,z,V,W,te,$;if(["broadcast","presence","postgres_changes"].includes(y))if("id"in P){const Q=P.id,G=(F=P.filter)===null||F===void 0?void 0:F.event;return Q&&((z=a.ids)===null||z===void 0?void 0:z.includes(Q))&&(G==="*"||(G==null?void 0:G.toLocaleLowerCase())===((V=a.data)===null||V===void 0?void 0:V.type.toLocaleLowerCase()))}else{const Q=(te=(W=P==null?void 0:P.filter)===null||W===void 0?void 0:W.event)===null||te===void 0?void 0:te.toLocaleLowerCase();return Q==="*"||Q===(($=a==null?void 0:a.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return P.type.toLocaleLowerCase()===y}).map(P=>{if(typeof O=="object"&&"ids"in O){const F=O.data,{schema:z,table:V,commit_timestamp:W,type:te,errors:$}=F;O=Object.assign(Object.assign({},{schema:z,table:V,commit_timestamp:W,eventType:te,new:{},old:{},errors:$}),this._getPayloadRecords(F))}P.callback(O,l)})}_isClosed(){return this.state===Ei.closed}_isJoined(){return this.state===Ei.joined}_isJoining(){return this.state===Ei.joining}_isLeaving(){return this.state===Ei.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,a,l){const u=n.toLocaleLowerCase(),m={type:u,filter:a,callback:l};return this.bindings[u]?this.bindings[u].push(m):this.bindings[u]=[m],this}_off(n,a){const l=n.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(u=>{var m;return!(((m=u.type)===null||m===void 0?void 0:m.toLocaleLowerCase())===l&&ND.isEqual(u.filter,a))})),this}static isEqual(n,a){if(Object.keys(n).length!==Object.keys(a).length)return!1;for(const l in n)if(n[l]!==a[l])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Cc.close,{},n)}_onError(n){this._on(Cc.error,{},a=>n(a))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ei.joining,this.joinPush.resend(n))}_getPayloadRecords(n){const a={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(a.new=SW(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(a.old=SW(n.columns,n.old_record)),a}}const hk=()=>{},RC={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Vde=[1e3,2e3,5e3,1e4],Bde=1e4,Wde=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class qde{constructor(n,a){var l;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=pP,this.transport=null,this.heartbeatIntervalMs=RC.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=hk,this.ref=0,this.reconnectTimer=null,this.vsn=bW,this.logger=hk,this.conn=null,this.sendBuffer=[],this.serializer=new Pde,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=u=>u?(...m)=>u(...m):(...m)=>fetch(...m),!(!((l=a==null?void 0:a.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=a.params.apikey,this.endPoint=`${n}/${fP.websocket}`,this.httpEndpoint=yK(n),this._initializeOptions(a),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(a==null?void 0:a.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Rde.createWebSocket(this.endpointURL())}catch(n){this._setConnectionState("disconnected");const a=n.message;throw a.includes("Node.js")?new Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(n,a){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(n?this.conn.close(n,a??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(n){const a=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),a}async removeAllChannels(){const n=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),n}log(n,a,l){this.logger(n,a,l)}connectionState(){switch(this.conn&&this.conn.readyState){case lm.connecting:return dm.Connecting;case lm.open:return dm.Open;case lm.closing:return dm.Closing;default:return dm.Closed}}isConnected(){return this.connectionState()===dm.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(n,a={config:{}}){const l=`realtime:${n}`,u=this.getChannels().find(m=>m.topic===l);if(u)return u;{const m=new ND(`realtime:${n}`,a,this);return this.channels.push(m),m}}push(n){const{topic:a,event:l,payload:u,ref:m}=n,y=()=>{this.encode(n,w=>{var b;(b=this.conn)===null||b===void 0||b.send(w)})};this.log("push",`${a} ${l} (${m})`,u),this.isConnected()?y():this.sendBuffer.push(y)}async setAuth(n=null){this._authPromise=this._performAuth(n);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var n;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,(n=this.conn)===null||n===void 0||n.close(Ode,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout()},RC.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(n){this.heartbeatCallback=n}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let a=this.channels.find(l=>l.topic===n&&(l._isJoined()||l._isJoining()));a&&(this.log("transport",`leaving duplicate topic "${n}"`),a.unsubscribe())}_remove(n){this.channels=this.channels.filter(a=>a.topic!==n.topic)}_onConnMessage(n){this.decode(n.data,a=>{if(a.topic==="phoenix"&&a.event==="phx_reply")try{this.heartbeatCallback(a.payload.status==="ok"?"ok":"error")}catch(x){this.log("error","error in heartbeat callback",x)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:u,payload:m,ref:y}=a,w=y?`(${y})`:"",b=m.status||"";this.log("receive",`${b} ${l} ${u} ${w}`.trim(),m),this.channels.filter(x=>x._isMember(l)).forEach(x=>x._trigger(u,m,y)),this._triggerStateCallbacks("message",a)})}_clearTimer(n){var a;n==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):n==="reconnect"&&((a=this.reconnectTimer)===null||a===void 0||a.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_teardownConnection(){if(this.conn){if(this.conn.readyState===lm.open||this.conn.readyState===lm.connecting)try{this.conn.close()}catch(n){this.log("error","Error closing connection",n)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(n=>n.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(a=>{this.log("error","error waiting for auth on connect",a),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{a.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(n){var a;this._setConnectionState("disconnected"),this.log("transport","close",n),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout(),this._triggerStateCallbacks("close",n)}_onConnError(n){this._setConnectionState("disconnected"),this.log("transport",`${n}`),this._triggerChanError(),this._triggerStateCallbacks("error",n)}_triggerChanError(){this.channels.forEach(n=>n._trigger(Cc.error))}_appendParams(n,a){if(Object.keys(a).length===0)return n;const l=n.match(/\?/)?"&":"?",u=new URLSearchParams(a);return`${n}${l}${u}`}_workerObjectUrl(n){let a;if(n)a=n;else{const l=new Blob([Wde],{type:"application/javascript"});a=URL.createObjectURL(l)}return a}_setConnectionState(n,a=!1){this._connectionState=n,n==="connecting"?this._wasManualDisconnect=!1:n==="disconnecting"&&(this._wasManualDisconnect=a)}async _performAuth(n=null){let a;n?a=n:this.accessToken?a=await this.accessToken():a=this.accessTokenValue,this.accessTokenValue!=a&&(this.accessTokenValue=a,this.channels.forEach(l=>{const u={access_token:a,version:Ade};a&&l.updateJoinPayload(u),l.joinedOnce&&l._isJoined()&&l._push(Cc.access_token,{access_token:a})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(n="general"){this.setAuth().catch(a=>{this.log("error",`error setting auth in ${n}`,a)})}_triggerStateCallbacks(n,a){try{this.stateChangeCallbacks[n].forEach(l=>{try{l(a)}catch(u){this.log("error",`error in ${n} callback`,u)}})}catch(l){this.log("error",`error triggering ${n} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new gK(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},RC.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(n){var a,l,u,m,y,w,b,x,T,N,O,P;switch(this.transport=(a=n==null?void 0:n.transport)!==null&&a!==void 0?a:null,this.timeout=(l=n==null?void 0:n.timeout)!==null&&l!==void 0?l:pP,this.heartbeatIntervalMs=(u=n==null?void 0:n.heartbeatIntervalMs)!==null&&u!==void 0?u:RC.HEARTBEAT_INTERVAL,this.worker=(m=n==null?void 0:n.worker)!==null&&m!==void 0?m:!1,this.accessToken=(y=n==null?void 0:n.accessToken)!==null&&y!==void 0?y:null,this.heartbeatCallback=(w=n==null?void 0:n.heartbeatCallback)!==null&&w!==void 0?w:hk,this.vsn=(b=n==null?void 0:n.vsn)!==null&&b!==void 0?b:bW,n!=null&&n.params&&(this.params=n.params),n!=null&&n.logger&&(this.logger=n.logger),(n!=null&&n.logLevel||n!=null&&n.log_level)&&(this.logLevel=n.logLevel||n.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(x=n==null?void 0:n.reconnectAfterMs)!==null&&x!==void 0?x:(F=>Vde[F-1]||Bde),this.vsn){case mK:this.encode=(T=n==null?void 0:n.encode)!==null&&T!==void 0?T:((F,z)=>z(JSON.stringify(F))),this.decode=(N=n==null?void 0:n.decode)!==null&&N!==void 0?N:((F,z)=>z(JSON.parse(F)));break;case Ide:this.encode=(O=n==null?void 0:n.encode)!==null&&O!==void 0?O:this.serializer.encode.bind(this.serializer),this.decode=(P=n==null?void 0:n.decode)!==null&&P!==void 0?P:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=n==null?void 0:n.workerUrl}}}class AD extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}}function ks(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Gde extends AD{constructor(n,a,l){super(n),this.name="StorageApiError",this.status=a,this.statusCode=l}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class gP extends AD{constructor(n,a){super(n),this.name="StorageUnknownError",this.originalError=a}}const ID=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),Hde=()=>Response,_P=i=>{if(Array.isArray(i))return i.map(a=>_P(a));if(typeof i=="function"||i!==Object(i))return i;const n={};return Object.entries(i).forEach(([a,l])=>{const u=a.replace(/([-_][a-z])/gi,m=>m.toUpperCase().replace(/[-_]/g,""));n[u]=_P(l)}),n},Kde=i=>{if(typeof i!="object"||i===null)return!1;const n=Object.getPrototypeOf(i);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},pk=i=>{var n;return i.msg||i.message||i.error_description||(typeof i.error=="string"?i.error:(n=i.error)===null||n===void 0?void 0:n.message)||JSON.stringify(i)},zde=(i,n,a)=>rr(void 0,void 0,void 0,function*(){const l=yield Hde();i instanceof l&&!(a!=null&&a.noResolveJson)?i.json().then(u=>{const m=i.status||500,y=(u==null?void 0:u.statusCode)||m+"";n(new Gde(pk(u),m,y))}).catch(u=>{n(new gP(pk(u),u))}):n(new gP(pk(i),i))}),$de=(i,n,a,l)=>{const u={method:i,headers:(n==null?void 0:n.headers)||{}};return i==="GET"||!l?u:(Kde(l)?(u.headers=Object.assign({"Content-Type":"application/json"},n==null?void 0:n.headers),u.body=JSON.stringify(l)):u.body=l,n!=null&&n.duplex&&(u.duplex=n.duplex),Object.assign(Object.assign({},u),a))};function rb(i,n,a,l,u,m){return rr(this,void 0,void 0,function*(){return new Promise((y,w)=>{i(a,$de(n,l,u,m)).then(b=>{if(!b.ok)throw b;return l!=null&&l.noResolveJson?b:b.json()}).then(b=>y(b)).catch(b=>zde(b,w,l))})})}function Dw(i,n,a,l){return rr(this,void 0,void 0,function*(){return rb(i,"GET",n,a,l)})}function wl(i,n,a,l,u){return rr(this,void 0,void 0,function*(){return rb(i,"POST",n,l,u,a)})}function yP(i,n,a,l,u){return rr(this,void 0,void 0,function*(){return rb(i,"PUT",n,l,u,a)})}function Yde(i,n,a,l){return rr(this,void 0,void 0,function*(){return rb(i,"HEAD",n,Object.assign(Object.assign({},a),{noResolveJson:!0}),l)})}function OD(i,n,a,l,u){return rr(this,void 0,void 0,function*(){return rb(i,"DELETE",n,l,u,a)})}class Xde{constructor(n,a){this.downloadFn=n,this.shouldThrowOnError=a}then(n,a){return this.execute().then(n,a)}execute(){return rr(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}}var vK;class Jde{constructor(n,a){this.downloadFn=n,this.shouldThrowOnError=a,this[vK]="BlobDownloadBuilder",this.promise=null}asStream(){return new Xde(this.downloadFn,this.shouldThrowOnError)}then(n,a){return this.getPromise().then(n,a)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return rr(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}}vK=Symbol.toStringTag;const Qde={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},CW={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Zde{constructor(n,a={},l,u){this.shouldThrowOnError=!1,this.url=n,this.headers=a,this.bucketId=l,this.fetch=ID(u)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(n,a,l,u){return rr(this,void 0,void 0,function*(){try{let m;const y=Object.assign(Object.assign({},CW),u);let w=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(y.upsert)});const b=y.metadata;typeof Blob<"u"&&l instanceof Blob?(m=new FormData,m.append("cacheControl",y.cacheControl),b&&m.append("metadata",this.encodeMetadata(b)),m.append("",l)):typeof FormData<"u"&&l instanceof FormData?(m=l,m.has("cacheControl")||m.append("cacheControl",y.cacheControl),b&&!m.has("metadata")&&m.append("metadata",this.encodeMetadata(b))):(m=l,w["cache-control"]=`max-age=${y.cacheControl}`,w["content-type"]=y.contentType,b&&(w["x-metadata"]=this.toBase64(this.encodeMetadata(b))),(typeof ReadableStream<"u"&&m instanceof ReadableStream||m&&typeof m=="object"&&"pipe"in m&&typeof m.pipe=="function")&&!y.duplex&&(y.duplex="half")),u!=null&&u.headers&&(w=Object.assign(Object.assign({},w),u.headers));const x=this._removeEmptyFolders(a),T=this._getFinalPath(x),N=yield(n=="PUT"?yP:wl)(this.fetch,`${this.url}/object/${T}`,m,Object.assign({headers:w},y!=null&&y.duplex?{duplex:y.duplex}:{}));return{data:{path:x,id:N.Id,fullPath:N.Key},error:null}}catch(m){if(this.shouldThrowOnError)throw m;if(ks(m))return{data:null,error:m};throw m}})}upload(n,a,l){return rr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,a,l)})}uploadToSignedUrl(n,a,l,u){return rr(this,void 0,void 0,function*(){const m=this._removeEmptyFolders(n),y=this._getFinalPath(m),w=new URL(this.url+`/object/upload/sign/${y}`);w.searchParams.set("token",a);try{let b;const x=Object.assign({upsert:CW.upsert},u),T=Object.assign(Object.assign({},this.headers),{"x-upsert":String(x.upsert)});typeof Blob<"u"&&l instanceof Blob?(b=new FormData,b.append("cacheControl",x.cacheControl),b.append("",l)):typeof FormData<"u"&&l instanceof FormData?(b=l,b.append("cacheControl",x.cacheControl)):(b=l,T["cache-control"]=`max-age=${x.cacheControl}`,T["content-type"]=x.contentType);const N=yield yP(this.fetch,w.toString(),b,{headers:T});return{data:{path:m,fullPath:N.Key},error:null}}catch(b){if(this.shouldThrowOnError)throw b;if(ks(b))return{data:null,error:b};throw b}})}createSignedUploadUrl(n,a){return rr(this,void 0,void 0,function*(){try{let l=this._getFinalPath(n);const u=Object.assign({},this.headers);a!=null&&a.upsert&&(u["x-upsert"]="true");const m=yield wl(this.fetch,`${this.url}/object/upload/sign/${l}`,{},{headers:u}),y=new URL(this.url+m.url),w=y.searchParams.get("token");if(!w)throw new AD("No token returned by API");return{data:{signedUrl:y.toString(),path:n,token:w},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ks(l))return{data:null,error:l};throw l}})}update(n,a,l){return rr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,a,l)})}move(n,a,l){return rr(this,void 0,void 0,function*(){try{return{data:yield wl(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:a,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ks(u))return{data:null,error:u};throw u}})}copy(n,a,l){return rr(this,void 0,void 0,function*(){try{return{data:{path:(yield wl(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:a,destinationBucket:l==null?void 0:l.destinationBucket},{headers:this.headers})).Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ks(u))return{data:null,error:u};throw u}})}createSignedUrl(n,a,l){return rr(this,void 0,void 0,function*(){try{let u=this._getFinalPath(n),m=yield wl(this.fetch,`${this.url}/object/sign/${u}`,Object.assign({expiresIn:a},l!=null&&l.transform?{transform:l.transform}:{}),{headers:this.headers});const y=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return m={signedUrl:encodeURI(`${this.url}${m.signedURL}${y}`)},{data:m,error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ks(u))return{data:null,error:u};throw u}})}createSignedUrls(n,a,l){return rr(this,void 0,void 0,function*(){try{const u=yield wl(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:a,paths:n},{headers:this.headers}),m=l!=null&&l.download?`&download=${l.download===!0?"":l.download}`:"";return{data:u.map(y=>Object.assign(Object.assign({},y),{signedUrl:y.signedURL?encodeURI(`${this.url}${y.signedURL}${m}`):null})),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ks(u))return{data:null,error:u};throw u}})}download(n,a){const u=typeof(a==null?void 0:a.transform)<"u"?"render/image/authenticated":"object",m=this.transformOptsToQueryString((a==null?void 0:a.transform)||{}),y=m?`?${m}`:"",w=this._getFinalPath(n),b=()=>Dw(this.fetch,`${this.url}/${u}/${w}${y}`,{headers:this.headers,noResolveJson:!0});return new Jde(b,this.shouldThrowOnError)}info(n){return rr(this,void 0,void 0,function*(){const a=this._getFinalPath(n);try{const l=yield Dw(this.fetch,`${this.url}/object/info/${a}`,{headers:this.headers});return{data:_P(l),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ks(l))return{data:null,error:l};throw l}})}exists(n){return rr(this,void 0,void 0,function*(){const a=this._getFinalPath(n);try{return yield Yde(this.fetch,`${this.url}/object/${a}`,{headers:this.headers}),{data:!0,error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ks(l)&&l instanceof gP){const u=l.originalError;if([400,404].includes(u==null?void 0:u.status))return{data:!1,error:l}}throw l}})}getPublicUrl(n,a){const l=this._getFinalPath(n),u=[],m=a!=null&&a.download?`download=${a.download===!0?"":a.download}`:"";m!==""&&u.push(m);const w=typeof(a==null?void 0:a.transform)<"u"?"render/image":"object",b=this.transformOptsToQueryString((a==null?void 0:a.transform)||{});b!==""&&u.push(b);let x=u.join("&");return x!==""&&(x=`?${x}`),{data:{publicUrl:encodeURI(`${this.url}/${w}/public/${l}${x}`)}}}remove(n){return rr(this,void 0,void 0,function*(){try{return{data:yield OD(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}list(n,a,l){return rr(this,void 0,void 0,function*(){try{const u=Object.assign(Object.assign(Object.assign({},Qde),a),{prefix:n||""});return{data:yield wl(this.fetch,`${this.url}/object/list/${this.bucketId}`,u,{headers:this.headers},l),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ks(u))return{data:null,error:u};throw u}})}listV2(n,a){return rr(this,void 0,void 0,function*(){try{const l=Object.assign({},n);return{data:yield wl(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,l,{headers:this.headers},a),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ks(l))return{data:null,error:l};throw l}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const a=[];return n.width&&a.push(`width=${n.width}`),n.height&&a.push(`height=${n.height}`),n.resize&&a.push(`resize=${n.resize}`),n.format&&a.push(`format=${n.format}`),n.quality&&a.push(`quality=${n.quality}`),a.join("&")}}const EK="2.81.1",wK={"X-Client-Info":`storage-js/${EK}`};class eue{constructor(n,a={},l,u){this.shouldThrowOnError=!1;const m=new URL(n);u!=null&&u.useNewHostname&&/supabase\.(co|in|red)$/.test(m.hostname)&&!m.hostname.includes("storage.supabase.")&&(m.hostname=m.hostname.replace("supabase.","storage.supabase.")),this.url=m.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wK),a),this.fetch=ID(l)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(n){return rr(this,void 0,void 0,function*(){try{const a=this.listBucketOptionsToQueryString(n);return{data:yield Dw(this.fetch,`${this.url}/bucket${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}getBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:yield Dw(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}createBucket(n){return rr(this,arguments,void 0,function*(a,l={public:!1}){try{return{data:yield wl(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:l.type,public:l.public,file_size_limit:l.fileSizeLimit,allowed_mime_types:l.allowedMimeTypes},{headers:this.headers}),error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(ks(u))return{data:null,error:u};throw u}})}updateBucket(n,a){return rr(this,void 0,void 0,function*(){try{return{data:yield yP(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:a.public,file_size_limit:a.fileSizeLimit,allowed_mime_types:a.allowedMimeTypes},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ks(l))return{data:null,error:l};throw l}})}emptyBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:yield wl(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}deleteBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:yield OD(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}listBucketOptionsToQueryString(n){const a={};return n&&("limit"in n&&(a.limit=String(n.limit)),"offset"in n&&(a.offset=String(n.offset)),n.search&&(a.search=n.search),n.sortColumn&&(a.sortColumn=n.sortColumn),n.sortOrder&&(a.sortOrder=n.sortOrder)),Object.keys(a).length>0?"?"+new URLSearchParams(a).toString():""}}class tue{constructor(n,a={},l){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},wK),a),this.fetch=ID(l)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:yield wl(this.fetch,`${this.url}/bucket`,{name:n},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}listBuckets(n){return rr(this,void 0,void 0,function*(){try{const a=new URLSearchParams;(n==null?void 0:n.limit)!==void 0&&a.set("limit",n.limit.toString()),(n==null?void 0:n.offset)!==void 0&&a.set("offset",n.offset.toString()),n!=null&&n.sortColumn&&a.set("sortColumn",n.sortColumn),n!=null&&n.sortOrder&&a.set("sortOrder",n.sortOrder),n!=null&&n.search&&a.set("search",n.search);const l=a.toString(),u=l?`${this.url}/bucket?${l}`:`${this.url}/bucket`;return{data:yield Dw(this.fetch,u,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}deleteBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:yield OD(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ks(a))return{data:null,error:a};throw a}})}}const kD={"X-Client-Info":`storage-js/${EK}`,"Content-Type":"application/json"};class bK extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Mo(i){return typeof i=="object"&&i!==null&&"__isStorageVectorsError"in i}class fk extends bK{constructor(n,a,l){super(n),this.name="StorageVectorsApiError",this.status=a,this.statusCode=l}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class rue extends bK{constructor(n,a){super(n),this.name="StorageVectorsUnknownError",this.originalError=a}}var RW;(function(i){i.InternalError="InternalError",i.S3VectorConflictException="S3VectorConflictException",i.S3VectorNotFoundException="S3VectorNotFoundException",i.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",i.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",i.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(RW||(RW={}));const PD=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),nue=i=>{if(typeof i!="object"||i===null)return!1;const n=Object.getPrototypeOf(i);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},NW=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),sue=(i,n,a)=>rr(void 0,void 0,void 0,function*(){if(i&&typeof i=="object"&&"status"in i&&"ok"in i&&typeof i.status=="number"&&!(a!=null&&a.noResolveJson)){const u=i.status||500,m=i;if(typeof m.json=="function")m.json().then(y=>{const w=(y==null?void 0:y.statusCode)||(y==null?void 0:y.code)||u+"";n(new fk(NW(y),u,w))}).catch(()=>{const y=u+"",w=m.statusText||`HTTP ${u} error`;n(new fk(w,u,y))});else{const y=u+"",w=m.statusText||`HTTP ${u} error`;n(new fk(w,u,y))}}else n(new rue(NW(i),i))}),iue=(i,n,a,l)=>{const u={method:i,headers:(n==null?void 0:n.headers)||{}};return l?(nue(l)?(u.headers=Object.assign({"Content-Type":"application/json"},n==null?void 0:n.headers),u.body=JSON.stringify(l)):u.body=l,Object.assign(Object.assign({},u),a)):u};function aue(i,n,a,l,u,m){return rr(this,void 0,void 0,function*(){return new Promise((y,w)=>{i(a,iue(n,l,u,m)).then(b=>{if(!b.ok)throw b;if(l!=null&&l.noResolveJson)return b;const x=b.headers.get("content-type");return!x||!x.includes("application/json")?{}:b.json()}).then(b=>y(b)).catch(b=>sue(b,w,l))})})}function Uo(i,n,a,l,u){return rr(this,void 0,void 0,function*(){return aue(i,"POST",n,l,u,a)})}class oue{constructor(n,a={},l){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},kD),a),this.fetch=PD(l)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(n){return rr(this,void 0,void 0,function*(){try{return{data:(yield Uo(this.fetch,`${this.url}/CreateIndex`,n,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}getIndex(n,a){return rr(this,void 0,void 0,function*(){try{return{data:yield Uo(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:n,indexName:a},{headers:this.headers}),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Mo(l))return{data:null,error:l};throw l}})}listIndexes(n){return rr(this,void 0,void 0,function*(){try{return{data:yield Uo(this.fetch,`${this.url}/ListIndexes`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}deleteIndex(n,a){return rr(this,void 0,void 0,function*(){try{return{data:(yield Uo(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:n,indexName:a},{headers:this.headers}))||{},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Mo(l))return{data:null,error:l};throw l}})}}class cue{constructor(n,a={},l){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},kD),a),this.fetch=PD(l)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(n){return rr(this,void 0,void 0,function*(){try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Uo(this.fetch,`${this.url}/PutVectors`,n,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}getVectors(n){return rr(this,void 0,void 0,function*(){try{return{data:yield Uo(this.fetch,`${this.url}/GetVectors`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}listVectors(n){return rr(this,void 0,void 0,function*(){try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:yield Uo(this.fetch,`${this.url}/ListVectors`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}queryVectors(n){return rr(this,void 0,void 0,function*(){try{return{data:yield Uo(this.fetch,`${this.url}/QueryVectors`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}deleteVectors(n){return rr(this,void 0,void 0,function*(){try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Uo(this.fetch,`${this.url}/DeleteVectors`,n,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}}class lue{constructor(n,a={},l){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},kD),a),this.fetch=PD(l)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:(yield Uo(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}getBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:yield Uo(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:n},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}listBuckets(){return rr(this,arguments,void 0,function*(n={}){try{return{data:yield Uo(this.fetch,`${this.url}/ListVectorBuckets`,n,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}deleteBucket(n){return rr(this,void 0,void 0,function*(){try{return{data:(yield Uo(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Mo(a))return{data:null,error:a};throw a}})}}class due extends lue{constructor(n,a={}){super(n,a.headers||{},a.fetch)}from(n){return new uue(this.url,this.headers,n,this.fetch)}}class uue extends oue{constructor(n,a,l,u){super(n,a,u),this.vectorBucketName=l}createIndex(n){const a=Object.create(null,{createIndex:{get:()=>super.createIndex}});return rr(this,void 0,void 0,function*(){return a.createIndex.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const n=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return rr(this,arguments,void 0,function*(a={}){return n.listIndexes.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName}))})}getIndex(n){const a=Object.create(null,{getIndex:{get:()=>super.getIndex}});return rr(this,void 0,void 0,function*(){return a.getIndex.call(this,this.vectorBucketName,n)})}deleteIndex(n){const a=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return rr(this,void 0,void 0,function*(){return a.deleteIndex.call(this,this.vectorBucketName,n)})}index(n){return new hue(this.url,this.headers,this.vectorBucketName,n,this.fetch)}}class hue extends cue{constructor(n,a,l,u,m){super(n,a,m),this.vectorBucketName=l,this.indexName=u}putVectors(n){const a=Object.create(null,{putVectors:{get:()=>super.putVectors}});return rr(this,void 0,void 0,function*(){return a.putVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(n){const a=Object.create(null,{getVectors:{get:()=>super.getVectors}});return rr(this,void 0,void 0,function*(){return a.getVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const n=Object.create(null,{listVectors:{get:()=>super.listVectors}});return rr(this,arguments,void 0,function*(a={}){return n.listVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(n){const a=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return rr(this,void 0,void 0,function*(){return a.queryVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(n){const a=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return rr(this,void 0,void 0,function*(){return a.deleteVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class pue extends eue{constructor(n,a={},l,u){super(n,a,l,u)}from(n){return new Zde(this.url,this.headers,n,this.fetch)}get vectors(){return new due(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new tue(this.url+"/iceberg",this.headers,this.fetch)}}const fue="2.81.1";let gw="";typeof Deno<"u"?gw="deno":typeof document<"u"?gw="web":typeof navigator<"u"&&navigator.product==="ReactNative"?gw="react-native":gw="node";const mue={"X-Client-Info":`supabase-js-${gw}/${fue}`},gue={headers:mue},_ue={schema:"public"},yue={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},vue={},Eue=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),wue=()=>Headers,bue=(i,n,a)=>{const l=Eue(a),u=wue();return async(m,y)=>{var w;const b=(w=await n())!==null&&w!==void 0?w:i;let x=new u(y==null?void 0:y.headers);return x.has("apikey")||x.set("apikey",i),x.has("Authorization")||x.set("Authorization",`Bearer ${b}`),l(m,Object.assign(Object.assign({},y),{headers:x}))}};function Sue(i){return i.endsWith("/")?i:i+"/"}function xue(i,n){var a,l;const{db:u,auth:m,realtime:y,global:w}=i,{db:b,auth:x,realtime:T,global:N}=n,O={db:Object.assign(Object.assign({},b),u),auth:Object.assign(Object.assign({},x),m),realtime:Object.assign(Object.assign({},T),y),storage:{},global:Object.assign(Object.assign(Object.assign({},N),w),{headers:Object.assign(Object.assign({},(a=N==null?void 0:N.headers)!==null&&a!==void 0?a:{}),(l=w==null?void 0:w.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return i.accessToken?O.accessToken=i.accessToken:delete O.accessToken,O}function Tue(i){const n=i==null?void 0:i.trim();if(!n)throw new Error("supabaseUrl is required.");if(!n.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Sue(n))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const SK="2.81.1",oy=30*1e3,vP=3,mk=vP*oy,Cue="http://localhost:9999",Rue="supabase.auth.token",Nue={"X-Client-Info":`gotrue-js/${SK}`},EP="X-Supabase-Api-Version",xK={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Aue=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Iue=600*1e3;class jw extends Error{constructor(n,a,l){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=a,this.code=l}}function lr(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class Oue extends jw{constructor(n,a,l){super(n,a,l),this.name="AuthApiError",this.status=a,this.code=l}}function kue(i){return lr(i)&&i.name==="AuthApiError"}class um extends jw{constructor(n,a){super(n),this.name="AuthUnknownError",this.originalError=a}}class Ep extends jw{constructor(n,a,l,u){super(n,l,u),this.name=a,this.status=l}}class yl extends Ep{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Pue(i){return lr(i)&&i.name==="AuthSessionMissingError"}class ey extends Ep{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class NC extends Ep{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}}class AC extends Ep{constructor(n,a=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Due(i){return lr(i)&&i.name==="AuthImplicitGrantRedirectError"}class AW extends Ep{constructor(n,a=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class wP extends Ep{constructor(n,a){super(n,"AuthRetryableFetchError",a,void 0)}}function gk(i){return lr(i)&&i.name==="AuthRetryableFetchError"}class IW extends Ep{constructor(n,a,l){super(n,"AuthWeakPasswordError",a,"weak_password"),this.reasons=l}}class bP extends Ep{constructor(n){super(n,"AuthInvalidJwtError",400,"invalid_jwt")}}const dR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),OW=` 	
\r=`.split(""),jue=(()=>{const i=new Array(128);for(let n=0;n<i.length;n+=1)i[n]=-1;for(let n=0;n<OW.length;n+=1)i[OW[n].charCodeAt(0)]=-2;for(let n=0;n<dR.length;n+=1)i[dR[n].charCodeAt(0)]=n;return i})();function kW(i,n,a){if(i!==null)for(n.queue=n.queue<<8|i,n.queuedBits+=8;n.queuedBits>=6;){const l=n.queue>>n.queuedBits-6&63;a(dR[l]),n.queuedBits-=6}else if(n.queuedBits>0)for(n.queue=n.queue<<6-n.queuedBits,n.queuedBits=6;n.queuedBits>=6;){const l=n.queue>>n.queuedBits-6&63;a(dR[l]),n.queuedBits-=6}}function TK(i,n,a){const l=jue[i];if(l>-1)for(n.queue=n.queue<<6|l,n.queuedBits+=6;n.queuedBits>=8;)a(n.queue>>n.queuedBits-8&255),n.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function PW(i){const n=[],a=y=>{n.push(String.fromCodePoint(y))},l={utf8seq:0,codepoint:0},u={queue:0,queuedBits:0},m=y=>{Uue(y,l,a)};for(let y=0;y<i.length;y+=1)TK(i.charCodeAt(y),u,m);return n.join("")}function Lue(i,n){if(i<=127){n(i);return}else if(i<=2047){n(192|i>>6),n(128|i&63);return}else if(i<=65535){n(224|i>>12),n(128|i>>6&63),n(128|i&63);return}else if(i<=1114111){n(240|i>>18),n(128|i>>12&63),n(128|i>>6&63),n(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function Mue(i,n){for(let a=0;a<i.length;a+=1){let l=i.charCodeAt(a);if(l>55295&&l<=56319){const u=(l-55296)*1024&65535;l=(i.charCodeAt(a+1)-56320&65535|u)+65536,a+=1}Lue(l,n)}}function Uue(i,n,a){if(n.utf8seq===0){if(i<=127){a(i);return}for(let l=1;l<6;l+=1)if((i>>7-l&1)===0){n.utf8seq=l;break}if(n.utf8seq===2)n.codepoint=i&31;else if(n.utf8seq===3)n.codepoint=i&15;else if(n.utf8seq===4)n.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");n.utf8seq-=1}else if(n.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");n.codepoint=n.codepoint<<6|i&63,n.utf8seq-=1,n.utf8seq===0&&a(n.codepoint)}}function vy(i){const n=[],a={queue:0,queuedBits:0},l=u=>{n.push(u)};for(let u=0;u<i.length;u+=1)TK(i.charCodeAt(u),a,l);return new Uint8Array(n)}function Fue(i){const n=[];return Mue(i,a=>n.push(a)),new Uint8Array(n)}function pm(i){const n=[],a={queue:0,queuedBits:0},l=u=>{n.push(u)};return i.forEach(u=>kW(u,a,l)),kW(null,a,l),n.join("")}function Vue(i){return Math.round(Date.now()/1e3)+i}function Bue(){return Symbol("auth-callback")}const $i=()=>typeof window<"u"&&typeof document<"u",tm={tested:!1,writable:!1},CK=()=>{if(!$i())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(tm.tested)return tm.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),tm.tested=!0,tm.writable=!0}catch{tm.tested=!0,tm.writable=!1}return tm.writable};function Wue(i){const n={},a=new URL(i);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((u,m)=>{n[m]=u})}catch{}return a.searchParams.forEach((l,u)=>{n[u]=l}),n}const RK=i=>i?(...n)=>i(...n):(...n)=>fetch(...n),que=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",cy=async(i,n,a)=>{await i.setItem(n,JSON.stringify(a))},rm=async(i,n)=>{const a=await i.getItem(n);if(!a)return null;try{return JSON.parse(a)}catch{return a}},zh=async(i,n)=>{await i.removeItem(n)};class AR{constructor(){this.promise=new AR.promiseConstructor((n,a)=>{this.resolve=n,this.reject=a})}}AR.promiseConstructor=Promise;function _k(i){const n=i.split(".");if(n.length!==3)throw new bP("Invalid JWT structure");for(let l=0;l<n.length;l++)if(!Aue.test(n[l]))throw new bP("JWT not in base64url format");return{header:JSON.parse(PW(n[0])),payload:JSON.parse(PW(n[1])),signature:vy(n[2]),raw:{header:n[0],payload:n[1]}}}async function Gue(i){return await new Promise(n=>{setTimeout(()=>n(null),i)})}function Hue(i,n){return new Promise((l,u)=>{(async()=>{for(let m=0;m<1/0;m++)try{const y=await i(m);if(!n(m,null,y)){l(y);return}}catch(y){if(!n(m,y)){u(y);return}}})()})}function Kue(i){return("0"+i.toString(16)).substr(-2)}function zue(){const n=new Uint32Array(56);if(typeof crypto>"u"){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=a.length;let u="";for(let m=0;m<56;m++)u+=a.charAt(Math.floor(Math.random()*l));return u}return crypto.getRandomValues(n),Array.from(n,Kue).join("")}async function $ue(i){const a=new TextEncoder().encode(i),l=await crypto.subtle.digest("SHA-256",a),u=new Uint8Array(l);return Array.from(u).map(m=>String.fromCharCode(m)).join("")}async function Yue(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const a=await $ue(i);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ty(i,n,a=!1){const l=zue();let u=l;a&&(u+="/PASSWORD_RECOVERY"),await cy(i,`${n}-code-verifier`,u);const m=await Yue(l);return[m,l===m?"plain":"s256"]}const Xue=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Jue(i){const n=i.headers.get(EP);if(!n||!n.match(Xue))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}function Que(i){if(!i)throw new Error("Missing exp claim");const n=Math.floor(Date.now()/1e3);if(i<=n)throw new Error("JWT has expired")}function Zue(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ehe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ry(i){if(!ehe.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function yk(){const i={};return new Proxy(i,{get:(n,a)=>{if(a==="__isUserNotAvailableProxy")return!0;if(typeof a=="symbol"){const l=a.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${a}" property of the session object is not supported. Please use getUser() instead.`)},set:(n,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(n,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function the(i,n){return new Proxy(i,{get:(a,l,u)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const m=l.toString();if(m==="Symbol(Symbol.toPrimitive)"||m==="Symbol(Symbol.toStringTag)"||m==="Symbol(util.inspect.custom)"||m==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(a,l,u)}return!n.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),n.value=!0),Reflect.get(a,l,u)}})}function DW(i){return JSON.parse(JSON.stringify(i))}const im=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),rhe=[502,503,504];async function jW(i){var n;if(!que(i))throw new wP(im(i),0);if(rhe.includes(i.status))throw new wP(im(i),i.status);let a;try{a=await i.json()}catch(m){throw new um(im(m),m)}let l;const u=Jue(i);if(u&&u.getTime()>=xK["2024-01-01"].timestamp&&typeof a=="object"&&a&&typeof a.code=="string"?l=a.code:typeof a=="object"&&a&&typeof a.error_code=="string"&&(l=a.error_code),l){if(l==="weak_password")throw new IW(im(a),i.status,((n=a.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(l==="session_not_found")throw new yl}else if(typeof a=="object"&&a&&typeof a.weak_password=="object"&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((m,y)=>m&&typeof y=="string",!0))throw new IW(im(a),i.status,a.weak_password.reasons);throw new Oue(im(a),i.status||500,l)}const nhe=(i,n,a,l)=>{const u={method:i,headers:(n==null?void 0:n.headers)||{}};return i==="GET"?u:(u.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n==null?void 0:n.headers),u.body=JSON.stringify(l),Object.assign(Object.assign({},u),a))};async function Rr(i,n,a,l){var u;const m=Object.assign({},l==null?void 0:l.headers);m[EP]||(m[EP]=xK["2024-01-01"].name),l!=null&&l.jwt&&(m.Authorization=`Bearer ${l.jwt}`);const y=(u=l==null?void 0:l.query)!==null&&u!==void 0?u:{};l!=null&&l.redirectTo&&(y.redirect_to=l.redirectTo);const w=Object.keys(y).length?"?"+new URLSearchParams(y).toString():"",b=await she(i,n,a+w,{headers:m,noResolveJson:l==null?void 0:l.noResolveJson},{},l==null?void 0:l.body);return l!=null&&l.xform?l==null?void 0:l.xform(b):{data:Object.assign({},b),error:null}}async function she(i,n,a,l,u,m){const y=nhe(n,l,u,m);let w;try{w=await i(a,Object.assign({},y))}catch(b){throw console.error(b),new wP(im(b),0)}if(w.ok||await jW(w),l!=null&&l.noResolveJson)return w;try{return await w.json()}catch(b){await jW(b)}}function vl(i){var n;let a=null;ohe(i)&&(a=Object.assign({},i),i.expires_at||(a.expires_at=Vue(i.expires_in)));const l=(n=i.user)!==null&&n!==void 0?n:i;return{data:{session:a,user:l},error:null}}function LW(i){const n=vl(i);return!n.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((a,l)=>a&&typeof l=="string",!0)&&(n.data.weak_password=i.weak_password),n}function Jh(i){var n;return{data:{user:(n=i.user)!==null&&n!==void 0?n:i},error:null}}function ihe(i){return{data:i,error:null}}function ahe(i){const{action_link:n,email_otp:a,hashed_token:l,redirect_to:u,verification_type:m}=i,y=zy(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),w={action_link:n,email_otp:a,hashed_token:l,redirect_to:u,verification_type:m},b=Object.assign({},y);return{data:{properties:w,user:b},error:null}}function MW(i){return i}function ohe(i){return i.access_token&&i.refresh_token&&i.expires_in}const vk=["global","local","others"];class che{constructor({url:n="",headers:a={},fetch:l}){this.url=n,this.headers=a,this.fetch=RK(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(n,a=vk[0]){if(vk.indexOf(a)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${vk.join(", ")}`);try{return await Rr(this.fetch,"POST",`${this.url}/logout?scope=${a}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(l){if(lr(l))return{data:null,error:l};throw l}}async inviteUserByEmail(n,a={}){try{return await Rr(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:a.data},headers:this.headers,redirectTo:a.redirectTo,xform:Jh})}catch(l){if(lr(l))return{data:{user:null},error:l};throw l}}async generateLink(n){try{const{options:a}=n,l=zy(n,["options"]),u=Object.assign(Object.assign({},l),a);return"newEmail"in l&&(u.new_email=l==null?void 0:l.newEmail,delete u.newEmail),await Rr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:u,headers:this.headers,xform:ahe,redirectTo:a==null?void 0:a.redirectTo})}catch(a){if(lr(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(n){try{return await Rr(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:Jh})}catch(a){if(lr(a))return{data:{user:null},error:a};throw a}}async listUsers(n){var a,l,u,m,y,w,b;try{const x={nextPage:null,lastPage:0,total:0},T=await Rr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(a=n==null?void 0:n.page)===null||a===void 0?void 0:a.toString())!==null&&l!==void 0?l:"",per_page:(m=(u=n==null?void 0:n.perPage)===null||u===void 0?void 0:u.toString())!==null&&m!==void 0?m:""},xform:MW});if(T.error)throw T.error;const N=await T.json(),O=(y=T.headers.get("x-total-count"))!==null&&y!==void 0?y:0,P=(b=(w=T.headers.get("link"))===null||w===void 0?void 0:w.split(","))!==null&&b!==void 0?b:[];return P.length>0&&(P.forEach(F=>{const z=parseInt(F.split(";")[0].split("=")[1].substring(0,1)),V=JSON.parse(F.split(";")[1].split("=")[1]);x[`${V}Page`]=z}),x.total=parseInt(O)),{data:Object.assign(Object.assign({},N),x),error:null}}catch(x){if(lr(x))return{data:{users:[]},error:x};throw x}}async getUserById(n){ry(n);try{return await Rr(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:Jh})}catch(a){if(lr(a))return{data:{user:null},error:a};throw a}}async updateUserById(n,a){ry(n);try{return await Rr(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:a,headers:this.headers,xform:Jh})}catch(l){if(lr(l))return{data:{user:null},error:l};throw l}}async deleteUser(n,a=!1){ry(n);try{return await Rr(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:a},xform:Jh})}catch(l){if(lr(l))return{data:{user:null},error:l};throw l}}async _listFactors(n){ry(n.userId);try{const{data:a,error:l}=await Rr(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:u=>({data:{factors:u},error:null})});return{data:a,error:l}}catch(a){if(lr(a))return{data:null,error:a};throw a}}async _deleteFactor(n){ry(n.userId),ry(n.id);try{return{data:await Rr(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(a){if(lr(a))return{data:null,error:a};throw a}}async _listOAuthClients(n){var a,l,u,m,y,w,b;try{const x={nextPage:null,lastPage:0,total:0},T=await Rr(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(a=n==null?void 0:n.page)===null||a===void 0?void 0:a.toString())!==null&&l!==void 0?l:"",per_page:(m=(u=n==null?void 0:n.perPage)===null||u===void 0?void 0:u.toString())!==null&&m!==void 0?m:""},xform:MW});if(T.error)throw T.error;const N=await T.json(),O=(y=T.headers.get("x-total-count"))!==null&&y!==void 0?y:0,P=(b=(w=T.headers.get("link"))===null||w===void 0?void 0:w.split(","))!==null&&b!==void 0?b:[];return P.length>0&&(P.forEach(F=>{const z=parseInt(F.split(";")[0].split("=")[1].substring(0,1)),V=JSON.parse(F.split(";")[1].split("=")[1]);x[`${V}Page`]=z}),x.total=parseInt(O)),{data:Object.assign(Object.assign({},N),x),error:null}}catch(x){if(lr(x))return{data:{clients:[]},error:x};throw x}}async _createOAuthClient(n){try{return await Rr(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:n,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(lr(a))return{data:null,error:a};throw a}}async _getOAuthClient(n){try{return await Rr(this.fetch,"GET",`${this.url}/admin/oauth/clients/${n}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(lr(a))return{data:null,error:a};throw a}}async _updateOAuthClient(n,a){try{return await Rr(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${n}`,{body:a,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(lr(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(n){try{return await Rr(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${n}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(lr(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(n){try{return await Rr(this.fetch,"POST",`${this.url}/admin/oauth/clients/${n}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(lr(a))return{data:null,error:a};throw a}}}function UW(i={}){return{getItem:n=>i[n]||null,setItem:(n,a)=>{i[n]=a},removeItem:n=>{delete i[n]}}}const ny={debug:!!(globalThis&&CK()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class NK extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}}class lhe extends NK{}async function dhe(i,n,a){ny.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,n);const l=new globalThis.AbortController;return n>0&&setTimeout(()=>{l.abort(),ny.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async u=>{if(u){ny.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,u.name);try{return await a()}finally{ny.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,u.name)}}else{if(n===0)throw ny.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new lhe(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(ny.debug)try{const m=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(m,null,"  "))}catch(m){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",m)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await a()}}))}function uhe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function AK(i){if(!/^0x[a-fA-F0-9]{40}$/.test(i))throw new Error(`@supabase/auth-js: Address "${i}" is invalid.`);return i.toLowerCase()}function hhe(i){return parseInt(i,16)}function phe(i){const n=new TextEncoder().encode(i);return"0x"+Array.from(n,l=>l.toString(16).padStart(2,"0")).join("")}function fhe(i){var n;const{chainId:a,domain:l,expirationTime:u,issuedAt:m=new Date,nonce:y,notBefore:w,requestId:b,resources:x,scheme:T,uri:N,version:O}=i;{if(!Number.isInteger(a))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${a}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(y&&y.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${y}`);if(!N)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(O!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${O}`);if(!((n=i.statement)===null||n===void 0)&&n.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${i.statement}`)}const P=AK(i.address),F=T?`${T}://${l}`:l,z=i.statement?`${i.statement}
`:"",V=`${F} wants you to sign in with your Ethereum account:
${P}

${z}`;let W=`URI: ${N}
Version: ${O}
Chain ID: ${a}${y?`
Nonce: ${y}`:""}
Issued At: ${m.toISOString()}`;if(u&&(W+=`
Expiration Time: ${u.toISOString()}`),w&&(W+=`
Not Before: ${w.toISOString()}`),b&&(W+=`
Request ID: ${b}`),x){let te=`
Resources:`;for(const $ of x){if(!$||typeof $!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${$}`);te+=`
- ${$}`}W+=te}return`${V}
${W}`}class oi extends Error{constructor({message:n,code:a,cause:l,name:u}){var m;super(n,{cause:l}),this.__isWebAuthnError=!0,this.name=(m=u??(l instanceof Error?l.name:void 0))!==null&&m!==void 0?m:"Unknown Error",this.code=a}}class uR extends oi{constructor(n,a){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a,message:n}),this.name="WebAuthnUnknownError",this.originalError=a}}function mhe({error:i,options:n}){var a,l,u;const{publicKey:m}=n;if(!m)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(n.signal instanceof AbortSignal)return new oi({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else if(i.name==="ConstraintError"){if(((a=m.authenticatorSelection)===null||a===void 0?void 0:a.requireResidentKey)===!0)return new oi({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:i});if(n.mediation==="conditional"&&((l=m.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new oi({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:i});if(((u=m.authenticatorSelection)===null||u===void 0?void 0:u.userVerification)==="required")return new oi({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:i})}else{if(i.name==="InvalidStateError")return new oi({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:i});if(i.name==="NotAllowedError")return new oi({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="NotSupportedError")return m.pubKeyCredParams.filter(w=>w.type==="public-key").length===0?new oi({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:i}):new oi({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:i});if(i.name==="SecurityError"){const y=window.location.hostname;if(IK(y)){if(m.rp.id!==y)return new oi({message:`The RP ID "${m.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new oi({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="TypeError"){if(m.user.id.byteLength<1||m.user.id.byteLength>64)return new oi({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:i})}else if(i.name==="UnknownError")return new oi({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new oi({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}function ghe({error:i,options:n}){const{publicKey:a}=n;if(!a)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(n.signal instanceof AbortSignal)return new oi({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else{if(i.name==="NotAllowedError")return new oi({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="SecurityError"){const l=window.location.hostname;if(IK(l)){if(a.rpId!==l)return new oi({message:`The RP ID "${a.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new oi({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="UnknownError")return new oi({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new oi({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}class _he{createNewAbortSignal(){if(this.controller){const a=new Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}const n=new AbortController;return this.controller=n,n.signal}cancelCeremony(){if(this.controller){const n=new Error("Manually cancelling existing WebAuthn API call");n.name="AbortError",this.controller.abort(n),this.controller=void 0}}}const yhe=new _he;function vhe(i){if(!i)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(i);const{challenge:n,user:a,excludeCredentials:l}=i,u=zy(i,["challenge","user","excludeCredentials"]),m=vy(n).buffer,y=Object.assign(Object.assign({},a),{id:vy(a.id).buffer}),w=Object.assign(Object.assign({},u),{challenge:m,user:y});if(l&&l.length>0){w.excludeCredentials=new Array(l.length);for(let b=0;b<l.length;b++){const x=l[b];w.excludeCredentials[b]=Object.assign(Object.assign({},x),{id:vy(x.id).buffer,type:x.type||"public-key",transports:x.transports})}}return w}function Ehe(i){if(!i)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(i);const{challenge:n,allowCredentials:a}=i,l=zy(i,["challenge","allowCredentials"]),u=vy(n).buffer,m=Object.assign(Object.assign({},l),{challenge:u});if(a&&a.length>0){m.allowCredentials=new Array(a.length);for(let y=0;y<a.length;y++){const w=a[y];m.allowCredentials[y]=Object.assign(Object.assign({},w),{id:vy(w.id).buffer,type:w.type||"public-key",transports:w.transports})}}return m}function whe(i){var n;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const a=i;return{id:i.id,rawId:i.id,response:{attestationObject:pm(new Uint8Array(i.response.attestationObject)),clientDataJSON:pm(new Uint8Array(i.response.clientDataJSON))},type:"public-key",clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:(n=a.authenticatorAttachment)!==null&&n!==void 0?n:void 0}}function bhe(i){var n;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const a=i,l=i.getClientExtensionResults(),u=i.response;return{id:i.id,rawId:i.id,response:{authenticatorData:pm(new Uint8Array(u.authenticatorData)),clientDataJSON:pm(new Uint8Array(u.clientDataJSON)),signature:pm(new Uint8Array(u.signature)),userHandle:u.userHandle?pm(new Uint8Array(u.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(n=a.authenticatorAttachment)!==null&&n!==void 0?n:void 0}}function IK(i){return i==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(i)}function FW(){var i,n;return!!($i()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((i=navigator==null?void 0:navigator.credentials)===null||i===void 0?void 0:i.create)=="function"&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.get)=="function")}async function She(i){try{const n=await navigator.credentials.create(i);return n?n instanceof PublicKeyCredential?{data:n,error:null}:{data:null,error:new uR("Browser returned unexpected credential type",n)}:{data:null,error:new uR("Empty credential response",n)}}catch(n){return{data:null,error:mhe({error:n,options:i})}}}async function xhe(i){try{const n=await navigator.credentials.get(i);return n?n instanceof PublicKeyCredential?{data:n,error:null}:{data:null,error:new uR("Browser returned unexpected credential type",n)}:{data:null,error:new uR("Empty credential response",n)}}catch(n){return{data:null,error:ghe({error:n,options:i})}}}const The={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Che={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function hR(...i){const n=u=>u!==null&&typeof u=="object"&&!Array.isArray(u),a=u=>u instanceof ArrayBuffer||ArrayBuffer.isView(u),l={};for(const u of i)if(u)for(const m in u){const y=u[m];if(y!==void 0)if(Array.isArray(y))l[m]=y;else if(a(y))l[m]=y;else if(n(y)){const w=l[m];n(w)?l[m]=hR(w,y):l[m]=hR(y)}else l[m]=y}return l}function Rhe(i,n){return hR(The,i,n||{})}function Nhe(i,n){return hR(Che,i,n||{})}class Ahe{constructor(n){this.client=n,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(n){return this.client.mfa.enroll(Object.assign(Object.assign({},n),{factorType:"webauthn"}))}async _challenge({factorId:n,webauthn:a,friendlyName:l,signal:u},m){try{const{data:y,error:w}=await this.client.mfa.challenge({factorId:n,webauthn:a});if(!y)return{data:null,error:w};const b=u??yhe.createNewAbortSignal();if(y.webauthn.type==="create"){const{user:x}=y.webauthn.credential_options.publicKey;x.name||(x.name=`${x.id}:${l}`),x.displayName||(x.displayName=x.name)}switch(y.webauthn.type){case"create":{const x=Rhe(y.webauthn.credential_options.publicKey,m==null?void 0:m.create),{data:T,error:N}=await She({publicKey:x,signal:b});return T?{data:{factorId:n,challengeId:y.id,webauthn:{type:y.webauthn.type,credential_response:T}},error:null}:{data:null,error:N}}case"request":{const x=Nhe(y.webauthn.credential_options.publicKey,m==null?void 0:m.request),{data:T,error:N}=await xhe(Object.assign(Object.assign({},y.webauthn.credential_options),{publicKey:x,signal:b}));return T?{data:{factorId:n,challengeId:y.id,webauthn:{type:y.webauthn.type,credential_response:T}},error:null}:{data:null,error:N}}}}catch(y){return lr(y)?{data:null,error:y}:{data:null,error:new um("Unexpected error in challenge",y)}}}async _verify({challengeId:n,factorId:a,webauthn:l}){return this.client.mfa.verify({factorId:a,challengeId:n,webauthn:l})}async _authenticate({factorId:n,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:u}={}},m){if(!a)return{data:null,error:new jw("rpId is required for WebAuthn authentication")};try{if(!FW())return{data:null,error:new um("Browser does not support WebAuthn",null)};const{data:y,error:w}=await this.challenge({factorId:n,webauthn:{rpId:a,rpOrigins:l},signal:u},{request:m});if(!y)return{data:null,error:w};const{webauthn:b}=y;return this._verify({factorId:n,challengeId:y.challengeId,webauthn:{type:b.type,rpId:a,rpOrigins:l,credential_response:b.credential_response}})}catch(y){return lr(y)?{data:null,error:y}:{data:null,error:new um("Unexpected error in authenticate",y)}}}async _register({friendlyName:n,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:u}={}},m){if(!a)return{data:null,error:new jw("rpId is required for WebAuthn registration")};try{if(!FW())return{data:null,error:new um("Browser does not support WebAuthn",null)};const{data:y,error:w}=await this._enroll({friendlyName:n});if(!y)return await this.client.mfa.listFactors().then(T=>{var N;return(N=T.data)===null||N===void 0?void 0:N.all.find(O=>O.factor_type==="webauthn"&&O.friendly_name===n&&O.status!=="unverified")}).then(T=>T?this.client.mfa.unenroll({factorId:T==null?void 0:T.id}):void 0),{data:null,error:w};const{data:b,error:x}=await this._challenge({factorId:y.id,friendlyName:y.friendly_name,webauthn:{rpId:a,rpOrigins:l},signal:u},{create:m});return b?this._verify({factorId:y.id,challengeId:b.challengeId,webauthn:{rpId:a,rpOrigins:l,type:b.webauthn.type,credential_response:b.webauthn.credential_response}}):{data:null,error:x}}catch(y){return lr(y)?{data:null,error:y}:{data:null,error:new um("Unexpected error in register",y)}}}}uhe();const Ihe={url:Cue,storageKey:Rue,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Nue,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function VW(i,n,a){return await a()}const sy={};class Lw{get jwks(){var n,a;return(a=(n=sy[this.storageKey])===null||n===void 0?void 0:n.jwks)!==null&&a!==void 0?a:{keys:[]}}set jwks(n){sy[this.storageKey]=Object.assign(Object.assign({},sy[this.storageKey]),{jwks:n})}get jwks_cached_at(){var n,a;return(a=(n=sy[this.storageKey])===null||n===void 0?void 0:n.cachedAt)!==null&&a!==void 0?a:Number.MIN_SAFE_INTEGER}set jwks_cached_at(n){sy[this.storageKey]=Object.assign(Object.assign({},sy[this.storageKey]),{cachedAt:n})}constructor(n){var a,l,u;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const m=Object.assign(Object.assign({},Ihe),n);if(this.storageKey=m.storageKey,this.instanceID=(a=Lw.nextInstanceID[this.storageKey])!==null&&a!==void 0?a:0,Lw.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!m.debug,typeof m.debug=="function"&&(this.logger=m.debug),this.instanceID>0&&$i()){const y=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(y),this.logDebugMessages&&console.trace(y)}if(this.persistSession=m.persistSession,this.autoRefreshToken=m.autoRefreshToken,this.admin=new che({url:m.url,headers:m.headers,fetch:m.fetch}),this.url=m.url,this.headers=m.headers,this.fetch=RK(m.fetch),this.lock=m.lock||VW,this.detectSessionInUrl=m.detectSessionInUrl,this.flowType=m.flowType,this.hasCustomAuthorizationHeader=m.hasCustomAuthorizationHeader,this.throwOnError=m.throwOnError,m.lock?this.lock=m.lock:$i()&&(!((l=globalThis==null?void 0:globalThis.navigator)===null||l===void 0)&&l.locks)?this.lock=dhe:this.lock=VW,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Ahe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(m.storage?this.storage=m.storage:CK()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=UW(this.memoryStorage)),m.userStorage&&(this.userStorage=m.userStorage)):(this.memoryStorage={},this.storage=UW(this.memoryStorage)),$i()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(y){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",y)}(u=this.broadcastChannel)===null||u===void 0||u.addEventListener("message",async y=>{this._debug("received broadcast notification from other tab or client",y),await this._notifyAllSubscribers(y.data.event,y.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(n){if(this.throwOnError&&n&&n.error)throw n.error;return n}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${SK}) ${new Date().toISOString()}`}_debug(...n){return this.logDebugMessages&&this.logger(this._logPrefix(),...n),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var n;try{let a={},l="none";if($i()&&(a=Wue(window.location.href),this._isImplicitGrantCallback(a)?l="implicit":await this._isPKCECallback(a)&&(l="pkce")),$i()&&this.detectSessionInUrl&&l!=="none"){const{data:u,error:m}=await this._getSessionFromURL(a,l);if(m){if(this._debug("#_initialize()","error detecting session from URL",m),Due(m)){const b=(n=m.details)===null||n===void 0?void 0:n.code;if(b==="identity_already_exists"||b==="identity_not_found"||b==="single_identity_not_deletable")return{error:m}}return await this._removeSession(),{error:m}}const{session:y,redirectType:w}=u;return this._debug("#_initialize()","detected session in URL",y,"redirect type",w),await this._saveSession(y),setTimeout(async()=>{w==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",y):await this._notifyAllSubscribers("SIGNED_IN",y)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(a){return lr(a)?this._returnResult({error:a}):this._returnResult({error:new um("Unexpected error during initialization",a)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(n){var a,l,u;try{const m=await Rr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(a=n==null?void 0:n.options)===null||a===void 0?void 0:a.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(u=n==null?void 0:n.options)===null||u===void 0?void 0:u.captchaToken}},xform:vl}),{data:y,error:w}=m;if(w||!y)return this._returnResult({data:{user:null,session:null},error:w});const b=y.session,x=y.user;return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",b)),this._returnResult({data:{user:x,session:b},error:null})}catch(m){if(lr(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signUp(n){var a,l,u;try{let m;if("email"in n){const{email:T,password:N,options:O}=n;let P=null,F=null;this.flowType==="pkce"&&([P,F]=await ty(this.storage,this.storageKey)),m=await Rr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:O==null?void 0:O.emailRedirectTo,body:{email:T,password:N,data:(a=O==null?void 0:O.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:O==null?void 0:O.captchaToken},code_challenge:P,code_challenge_method:F},xform:vl})}else if("phone"in n){const{phone:T,password:N,options:O}=n;m=await Rr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:T,password:N,data:(l=O==null?void 0:O.data)!==null&&l!==void 0?l:{},channel:(u=O==null?void 0:O.channel)!==null&&u!==void 0?u:"sms",gotrue_meta_security:{captcha_token:O==null?void 0:O.captchaToken}},xform:vl})}else throw new NC("You must provide either an email or phone number and a password");const{data:y,error:w}=m;if(w||!y)return this._returnResult({data:{user:null,session:null},error:w});const b=y.session,x=y.user;return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",b)),this._returnResult({data:{user:x,session:b},error:null})}catch(m){if(lr(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async signInWithPassword(n){try{let a;if("email"in n){const{email:m,password:y,options:w}=n;a=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:m,password:y,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}},xform:LW})}else if("phone"in n){const{phone:m,password:y,options:w}=n;a=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:m,password:y,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}},xform:LW})}else throw new NC("You must provide either an email or phone number and a password");const{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const m=new ey;return this._returnResult({data:{user:null,session:null},error:m})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:u})}catch(a){if(lr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOAuth(n){var a,l,u,m;return await this._handleProviderSignIn(n.provider,{redirectTo:(a=n.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=n.options)===null||l===void 0?void 0:l.scopes,queryParams:(u=n.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:(m=n.options)===null||m===void 0?void 0:m.skipBrowserRedirect})}async exchangeCodeForSession(n){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(n))}async signInWithWeb3(n){const{chain:a}=n;switch(a){case"ethereum":return await this.signInWithEthereum(n);case"solana":return await this.signInWithSolana(n);default:throw new Error(`@supabase/auth-js: Unsupported chain "${a}"`)}}async signInWithEthereum(n){var a,l,u,m,y,w,b,x,T,N,O;let P,F;if("message"in n)P=n.message,F=n.signature;else{const{chain:z,wallet:V,statement:W,options:te}=n;let $;if($i())if(typeof V=="object")$=V;else{const Se=window;if("ethereum"in Se&&typeof Se.ethereum=="object"&&"request"in Se.ethereum&&typeof Se.ethereum.request=="function")$=Se.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof V!="object"||!(te!=null&&te.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=V}const Q=new URL((a=te==null?void 0:te.url)!==null&&a!==void 0?a:window.location.href),G=await $.request({method:"eth_requestAccounts"}).then(Se=>Se).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!G||G.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const se=AK(G[0]);let ie=(l=te==null?void 0:te.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!ie){const Se=await $.request({method:"eth_chainId"});ie=hhe(Se)}const ce={domain:Q.host,address:se,statement:W,uri:Q.href,version:"1",chainId:ie,nonce:(u=te==null?void 0:te.signInWithEthereum)===null||u===void 0?void 0:u.nonce,issuedAt:(y=(m=te==null?void 0:te.signInWithEthereum)===null||m===void 0?void 0:m.issuedAt)!==null&&y!==void 0?y:new Date,expirationTime:(w=te==null?void 0:te.signInWithEthereum)===null||w===void 0?void 0:w.expirationTime,notBefore:(b=te==null?void 0:te.signInWithEthereum)===null||b===void 0?void 0:b.notBefore,requestId:(x=te==null?void 0:te.signInWithEthereum)===null||x===void 0?void 0:x.requestId,resources:(T=te==null?void 0:te.signInWithEthereum)===null||T===void 0?void 0:T.resources};P=fhe(ce),F=await $.request({method:"personal_sign",params:[phe(P),se]})}try{const{data:z,error:V}=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:P,signature:F},!((N=n.options)===null||N===void 0)&&N.captchaToken?{gotrue_meta_security:{captcha_token:(O=n.options)===null||O===void 0?void 0:O.captchaToken}}:null),xform:vl});if(V)throw V;if(!z||!z.session||!z.user){const W=new ey;return this._returnResult({data:{user:null,session:null},error:W})}return z.session&&(await this._saveSession(z.session),await this._notifyAllSubscribers("SIGNED_IN",z.session)),this._returnResult({data:Object.assign({},z),error:V})}catch(z){if(lr(z))return this._returnResult({data:{user:null,session:null},error:z});throw z}}async signInWithSolana(n){var a,l,u,m,y,w,b,x,T,N,O,P;let F,z;if("message"in n)F=n.message,z=n.signature;else{const{chain:V,wallet:W,statement:te,options:$}=n;let Q;if($i())if(typeof W=="object")Q=W;else{const se=window;if("solana"in se&&typeof se.solana=="object"&&("signIn"in se.solana&&typeof se.solana.signIn=="function"||"signMessage"in se.solana&&typeof se.solana.signMessage=="function"))Q=se.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof W!="object"||!($!=null&&$.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Q=W}const G=new URL((a=$==null?void 0:$.url)!==null&&a!==void 0?a:window.location.href);if("signIn"in Q&&Q.signIn){const se=await Q.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},$==null?void 0:$.signInWithSolana),{version:"1",domain:G.host,uri:G.href}),te?{statement:te}:null));let ie;if(Array.isArray(se)&&se[0]&&typeof se[0]=="object")ie=se[0];else if(se&&typeof se=="object"&&"signedMessage"in se&&"signature"in se)ie=se;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in ie&&"signature"in ie&&(typeof ie.signedMessage=="string"||ie.signedMessage instanceof Uint8Array)&&ie.signature instanceof Uint8Array)F=typeof ie.signedMessage=="string"?ie.signedMessage:new TextDecoder().decode(ie.signedMessage),z=ie.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Q)||typeof Q.signMessage!="function"||!("publicKey"in Q)||typeof Q!="object"||!Q.publicKey||!("toBase58"in Q.publicKey)||typeof Q.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");F=[`${G.host} wants you to sign in with your Solana account:`,Q.publicKey.toBase58(),...te?["",te,""]:[""],"Version: 1",`URI: ${G.href}`,`Issued At: ${(u=(l=$==null?void 0:$.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&u!==void 0?u:new Date().toISOString()}`,...!((m=$==null?void 0:$.signInWithSolana)===null||m===void 0)&&m.notBefore?[`Not Before: ${$.signInWithSolana.notBefore}`]:[],...!((y=$==null?void 0:$.signInWithSolana)===null||y===void 0)&&y.expirationTime?[`Expiration Time: ${$.signInWithSolana.expirationTime}`]:[],...!((w=$==null?void 0:$.signInWithSolana)===null||w===void 0)&&w.chainId?[`Chain ID: ${$.signInWithSolana.chainId}`]:[],...!((b=$==null?void 0:$.signInWithSolana)===null||b===void 0)&&b.nonce?[`Nonce: ${$.signInWithSolana.nonce}`]:[],...!((x=$==null?void 0:$.signInWithSolana)===null||x===void 0)&&x.requestId?[`Request ID: ${$.signInWithSolana.requestId}`]:[],...!((N=(T=$==null?void 0:$.signInWithSolana)===null||T===void 0?void 0:T.resources)===null||N===void 0)&&N.length?["Resources",...$.signInWithSolana.resources.map(ie=>`- ${ie}`)]:[]].join(`
`);const se=await Q.signMessage(new TextEncoder().encode(F),"utf8");if(!se||!(se instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");z=se}}try{const{data:V,error:W}=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:F,signature:pm(z)},!((O=n.options)===null||O===void 0)&&O.captchaToken?{gotrue_meta_security:{captcha_token:(P=n.options)===null||P===void 0?void 0:P.captchaToken}}:null),xform:vl});if(W)throw W;if(!V||!V.session||!V.user){const te=new ey;return this._returnResult({data:{user:null,session:null},error:te})}return V.session&&(await this._saveSession(V.session),await this._notifyAllSubscribers("SIGNED_IN",V.session)),this._returnResult({data:Object.assign({},V),error:W})}catch(V){if(lr(V))return this._returnResult({data:{user:null,session:null},error:V});throw V}}async _exchangeCodeForSession(n){const a=await rm(this.storage,`${this.storageKey}-code-verifier`),[l,u]=(a??"").split("/");try{const{data:m,error:y}=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:n,code_verifier:l},xform:vl});if(await zh(this.storage,`${this.storageKey}-code-verifier`),y)throw y;if(!m||!m.session||!m.user){const w=new ey;return this._returnResult({data:{user:null,session:null,redirectType:null},error:w})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign(Object.assign({},m),{redirectType:u??null}),error:y})}catch(m){if(lr(m))return this._returnResult({data:{user:null,session:null,redirectType:null},error:m});throw m}}async signInWithIdToken(n){try{const{options:a,provider:l,token:u,access_token:m,nonce:y}=n,w=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:u,access_token:m,nonce:y,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:vl}),{data:b,error:x}=w;if(x)return this._returnResult({data:{user:null,session:null},error:x});if(!b||!b.session||!b.user){const T=new ey;return this._returnResult({data:{user:null,session:null},error:T})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:b,error:x})}catch(a){if(lr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOtp(n){var a,l,u,m,y;try{if("email"in n){const{email:w,options:b}=n;let x=null,T=null;this.flowType==="pkce"&&([x,T]=await ty(this.storage,this.storageKey));const{error:N}=await Rr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:w,data:(a=b==null?void 0:b.data)!==null&&a!==void 0?a:{},create_user:(l=b==null?void 0:b.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken},code_challenge:x,code_challenge_method:T},redirectTo:b==null?void 0:b.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:N})}if("phone"in n){const{phone:w,options:b}=n,{data:x,error:T}=await Rr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:w,data:(u=b==null?void 0:b.data)!==null&&u!==void 0?u:{},create_user:(m=b==null?void 0:b.shouldCreateUser)!==null&&m!==void 0?m:!0,gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken},channel:(y=b==null?void 0:b.channel)!==null&&y!==void 0?y:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:x==null?void 0:x.message_id},error:T})}throw new NC("You must provide either an email or phone number.")}catch(w){if(lr(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async verifyOtp(n){var a,l;try{let u,m;"options"in n&&(u=(a=n.options)===null||a===void 0?void 0:a.redirectTo,m=(l=n.options)===null||l===void 0?void 0:l.captchaToken);const{data:y,error:w}=await Rr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},n),{gotrue_meta_security:{captcha_token:m}}),redirectTo:u,xform:vl});if(w)throw w;if(!y)throw new Error("An error occurred on token verification.");const b=y.session,x=y.user;return b!=null&&b.access_token&&(await this._saveSession(b),await this._notifyAllSubscribers(n.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",b)),this._returnResult({data:{user:x,session:b},error:null})}catch(u){if(lr(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithSSO(n){var a,l,u,m,y;try{let w=null,b=null;this.flowType==="pkce"&&([w,b]=await ty(this.storage,this.storageKey));const x=await Rr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in n?{provider_id:n.providerId}:null),"domain"in n?{domain:n.domain}:null),{redirect_to:(l=(a=n.options)===null||a===void 0?void 0:a.redirectTo)!==null&&l!==void 0?l:void 0}),!((u=n==null?void 0:n.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:n.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:w,code_challenge_method:b}),headers:this.headers,xform:ihe});return!((m=x.data)===null||m===void 0)&&m.url&&$i()&&!(!((y=n.options)===null||y===void 0)&&y.skipBrowserRedirect)&&window.location.assign(x.data.url),this._returnResult(x)}catch(w){if(lr(w))return this._returnResult({data:null,error:w});throw w}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async n=>{const{data:{session:a},error:l}=n;if(l)throw l;if(!a)throw new yl;const{error:u}=await Rr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:a.access_token});return this._returnResult({data:{user:null,session:null},error:u})})}catch(n){if(lr(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async resend(n){try{const a=`${this.url}/resend`;if("email"in n){const{email:l,type:u,options:m}=n,{error:y}=await Rr(this.fetch,"POST",a,{headers:this.headers,body:{email:l,type:u,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},redirectTo:m==null?void 0:m.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:y})}else if("phone"in n){const{phone:l,type:u,options:m}=n,{data:y,error:w}=await Rr(this.fetch,"POST",a,{headers:this.headers,body:{phone:l,type:u,gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:y==null?void 0:y.message_id},error:w})}throw new NC("You must provide either an email or phone number and a type")}catch(a){if(lr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(n,a){this._debug("#_acquireLock","begin",n);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),u=(async()=>(await l,await a()))();return this.pendingInLock.push((async()=>{try{await u}catch{}})()),u}return await this.lock(`lock:${this.storageKey}`,n,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=a();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const u=[...this.pendingInLock];await Promise.all(u),this.pendingInLock.splice(0,u.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(n){this._debug("#_useSession","begin");try{const a=await this.__loadSession();return await n(a)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let n=null;const a=await rm(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",a),a!==null&&(this._isValidSession(a)?n=a:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!n)return{data:{session:null},error:null};const l=n.expires_at?n.expires_at*1e3-Date.now()<mk:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",n.expires_at),!l){if(this.userStorage){const y=await rm(this.userStorage,this.storageKey+"-user");y!=null&&y.user?n.user=y.user:n.user=yk()}if(this.storage.isServer&&n.user&&!n.user.__isUserNotAvailableProxy){const y={value:this.suppressGetSessionWarning};n.user=the(n.user,y),y.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:n},error:null}}const{data:u,error:m}=await this._callRefreshToken(n.refresh_token);return m?this._returnResult({data:{session:null},error:m}):this._returnResult({data:{session:u},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(n){return n?await this._getUser(n):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(n){try{return n?await Rr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:n,xform:Jh}):await this._useSession(async a=>{var l,u,m;const{data:y,error:w}=a;if(w)throw w;return!(!((l=y.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new yl}:await Rr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(m=(u=y.session)===null||u===void 0?void 0:u.access_token)!==null&&m!==void 0?m:void 0,xform:Jh})})}catch(a){if(lr(a))return Pue(a)&&(await this._removeSession(),await zh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:a});throw a}}async updateUser(n,a={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(n,a))}async _updateUser(n,a={}){try{return await this._useSession(async l=>{const{data:u,error:m}=l;if(m)throw m;if(!u.session)throw new yl;const y=u.session;let w=null,b=null;this.flowType==="pkce"&&n.email!=null&&([w,b]=await ty(this.storage,this.storageKey));const{data:x,error:T}=await Rr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:a==null?void 0:a.emailRedirectTo,body:Object.assign(Object.assign({},n),{code_challenge:w,code_challenge_method:b}),jwt:y.access_token,xform:Jh});if(T)throw T;return y.user=x.user,await this._saveSession(y),await this._notifyAllSubscribers("USER_UPDATED",y),this._returnResult({data:{user:y.user},error:null})})}catch(l){if(lr(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(n))}async _setSession(n){try{if(!n.access_token||!n.refresh_token)throw new yl;const a=Date.now()/1e3;let l=a,u=!0,m=null;const{payload:y}=_k(n.access_token);if(y.exp&&(l=y.exp,u=l<=a),u){const{data:w,error:b}=await this._callRefreshToken(n.refresh_token);if(b)return this._returnResult({data:{user:null,session:null},error:b});if(!w)return{data:{user:null,session:null},error:null};m=w}else{const{data:w,error:b}=await this._getUser(n.access_token);if(b)throw b;m={access_token:n.access_token,refresh_token:n.refresh_token,user:w.user,token_type:"bearer",expires_in:l-a,expires_at:l},await this._saveSession(m),await this._notifyAllSubscribers("SIGNED_IN",m)}return this._returnResult({data:{user:m.user,session:m},error:null})}catch(a){if(lr(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}}async refreshSession(n){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(n))}async _refreshSession(n){try{return await this._useSession(async a=>{var l;if(!n){const{data:y,error:w}=a;if(w)throw w;n=(l=y.session)!==null&&l!==void 0?l:void 0}if(!(n!=null&&n.refresh_token))throw new yl;const{data:u,error:m}=await this._callRefreshToken(n.refresh_token);return m?this._returnResult({data:{user:null,session:null},error:m}):u?this._returnResult({data:{user:u.user,session:u},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(a){if(lr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _getSessionFromURL(n,a){try{if(!$i())throw new AC("No browser detected.");if(n.error||n.error_description||n.error_code)throw new AC(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});switch(a){case"implicit":if(this.flowType==="pkce")throw new AW("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new AC("Not a valid implicit grant flow url.");break;default:}if(a==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!n.code)throw new AW("No code detected.");const{data:te,error:$}=await this._exchangeCodeForSession(n.code);if($)throw $;const Q=new URL(window.location.href);return Q.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Q.toString()),{data:{session:te.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:u,access_token:m,refresh_token:y,expires_in:w,expires_at:b,token_type:x}=n;if(!m||!w||!y||!x)throw new AC("No session defined in URL");const T=Math.round(Date.now()/1e3),N=parseInt(w);let O=T+N;b&&(O=parseInt(b));const P=O-T;P*1e3<=oy&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${P}s, should have been closer to ${N}s`);const F=O-N;T-F>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",F,O,T):T-F<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",F,O,T);const{data:z,error:V}=await this._getUser(m);if(V)throw V;const W={provider_token:l,provider_refresh_token:u,access_token:m,expires_in:N,expires_at:O,refresh_token:y,token_type:x,user:z.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:W,redirectType:n.type},error:null})}catch(l){if(lr(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(n){return!!(n.access_token||n.error_description)}async _isPKCECallback(n){const a=await rm(this.storage,`${this.storageKey}-code-verifier`);return!!(n.code&&a)}async signOut(n={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(n))}async _signOut({scope:n}={scope:"global"}){return await this._useSession(async a=>{var l;const{data:u,error:m}=a;if(m)return this._returnResult({error:m});const y=(l=u.session)===null||l===void 0?void 0:l.access_token;if(y){const{error:w}=await this.admin.signOut(y,n);if(w&&!(kue(w)&&(w.status===404||w.status===401||w.status===403)))return this._returnResult({error:w})}return n!=="others"&&(await this._removeSession(),await zh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(n){const a=Bue(),l={id:a,callback:n,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",a),this.stateChangeEmitters.delete(a)}};return this._debug("#onAuthStateChange()","registered callback with id",a),this.stateChangeEmitters.set(a,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(a)})))(),{data:{subscription:l}}}async _emitInitialSession(n){return await this._useSession(async a=>{var l,u;try{const{data:{session:m},error:y}=a;if(y)throw y;await((l=this.stateChangeEmitters.get(n))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",m)),this._debug("INITIAL_SESSION","callback id",n,"session",m)}catch(m){await((u=this.stateChangeEmitters.get(n))===null||u===void 0?void 0:u.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",n,"error",m),console.error(m)}})}async resetPasswordForEmail(n,a={}){let l=null,u=null;this.flowType==="pkce"&&([l,u]=await ty(this.storage,this.storageKey,!0));try{return await Rr(this.fetch,"POST",`${this.url}/recover`,{body:{email:n,code_challenge:l,code_challenge_method:u,gotrue_meta_security:{captcha_token:a.captchaToken}},headers:this.headers,redirectTo:a.redirectTo})}catch(m){if(lr(m))return this._returnResult({data:null,error:m});throw m}}async getUserIdentities(){var n;try{const{data:a,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(n=a.user.identities)!==null&&n!==void 0?n:[]},error:null})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}}async linkIdentity(n){return"token"in n?this.linkIdentityIdToken(n):this.linkIdentityOAuth(n)}async linkIdentityOAuth(n){var a;try{const{data:l,error:u}=await this._useSession(async m=>{var y,w,b,x,T;const{data:N,error:O}=m;if(O)throw O;const P=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,n.provider,{redirectTo:(y=n.options)===null||y===void 0?void 0:y.redirectTo,scopes:(w=n.options)===null||w===void 0?void 0:w.scopes,queryParams:(b=n.options)===null||b===void 0?void 0:b.queryParams,skipBrowserRedirect:!0});return await Rr(this.fetch,"GET",P,{headers:this.headers,jwt:(T=(x=N.session)===null||x===void 0?void 0:x.access_token)!==null&&T!==void 0?T:void 0})});if(u)throw u;return $i()&&!(!((a=n.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(l==null?void 0:l.url),this._returnResult({data:{provider:n.provider,url:l==null?void 0:l.url},error:null})}catch(l){if(lr(l))return this._returnResult({data:{provider:n.provider,url:null},error:l});throw l}}async linkIdentityIdToken(n){return await this._useSession(async a=>{var l;try{const{error:u,data:{session:m}}=a;if(u)throw u;const{options:y,provider:w,token:b,access_token:x,nonce:T}=n,N=await Rr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=m==null?void 0:m.access_token)!==null&&l!==void 0?l:void 0,body:{provider:w,id_token:b,access_token:x,nonce:T,link_identity:!0,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken}},xform:vl}),{data:O,error:P}=N;return P?this._returnResult({data:{user:null,session:null},error:P}):!O||!O.session||!O.user?this._returnResult({data:{user:null,session:null},error:new ey}):(O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("USER_UPDATED",O.session)),this._returnResult({data:O,error:P}))}catch(u){if(lr(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}})}async unlinkIdentity(n){try{return await this._useSession(async a=>{var l,u;const{data:m,error:y}=a;if(y)throw y;return await Rr(this.fetch,"DELETE",`${this.url}/user/identities/${n.identity_id}`,{headers:this.headers,jwt:(u=(l=m.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}}async _refreshAccessToken(n){const a=`#_refreshAccessToken(${n.substring(0,5)}...)`;this._debug(a,"begin");try{const l=Date.now();return await Hue(async u=>(u>0&&await Gue(200*Math.pow(2,u-1)),this._debug(a,"refreshing attempt",u),await Rr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:n},headers:this.headers,xform:vl})),(u,m)=>{const y=200*Math.pow(2,u);return m&&gk(m)&&Date.now()+y-l<oy})}catch(l){if(this._debug(a,"error",l),lr(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(a,"end")}}_isValidSession(n){return typeof n=="object"&&n!==null&&"access_token"in n&&"refresh_token"in n&&"expires_at"in n}async _handleProviderSignIn(n,a){const l=await this._getUrlForProvider(`${this.url}/authorize`,n,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});return this._debug("#_handleProviderSignIn()","provider",n,"options",a,"url",l),$i()&&!a.skipBrowserRedirect&&window.location.assign(l),{data:{provider:n,url:l},error:null}}async _recoverAndRefresh(){var n,a;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const u=await rm(this.storage,this.storageKey);if(u&&this.userStorage){let y=await rm(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!y&&(y={user:u.user},await cy(this.userStorage,this.storageKey+"-user",y)),u.user=(n=y==null?void 0:y.user)!==null&&n!==void 0?n:yk()}else if(u&&!u.user&&!u.user){const y=await rm(this.storage,this.storageKey+"-user");y&&(y!=null&&y.user)?(u.user=y.user,await zh(this.storage,this.storageKey+"-user"),await cy(this.storage,this.storageKey,u)):u.user=yk()}if(this._debug(l,"session from storage",u),!this._isValidSession(u)){this._debug(l,"session is not valid"),u!==null&&await this._removeSession();return}const m=((a=u.expires_at)!==null&&a!==void 0?a:1/0)*1e3-Date.now()<mk;if(this._debug(l,`session has${m?"":" not"} expired with margin of ${mk}s`),m){if(this.autoRefreshToken&&u.refresh_token){const{error:y}=await this._callRefreshToken(u.refresh_token);y&&(console.error(y),gk(y)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",y),await this._removeSession()))}}else if(u.user&&u.user.__isUserNotAvailableProxy===!0)try{const{data:y,error:w}=await this._getUser(u.access_token);!w&&(y!=null&&y.user)?(u.user=y.user,await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(y){console.error("Error getting user data:",y),this._debug(l,"error getting user data, skipping SIGNED_IN notification",y)}else await this._notifyAllSubscribers("SIGNED_IN",u)}catch(u){this._debug(l,"error",u),console.error(u);return}finally{this._debug(l,"end")}}async _callRefreshToken(n){var a,l;if(!n)throw new yl;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const u=`#_callRefreshToken(${n.substring(0,5)}...)`;this._debug(u,"begin");try{this.refreshingDeferred=new AR;const{data:m,error:y}=await this._refreshAccessToken(n);if(y)throw y;if(!m.session)throw new yl;await this._saveSession(m.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",m.session);const w={data:m.session,error:null};return this.refreshingDeferred.resolve(w),w}catch(m){if(this._debug(u,"error",m),lr(m)){const y={data:null,error:m};return gk(m)||await this._removeSession(),(a=this.refreshingDeferred)===null||a===void 0||a.resolve(y),y}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(m),m}finally{this.refreshingDeferred=null,this._debug(u,"end")}}async _notifyAllSubscribers(n,a,l=!0){const u=`#_notifyAllSubscribers(${n})`;this._debug(u,"begin",a,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:n,session:a});const m=[],y=Array.from(this.stateChangeEmitters.values()).map(async w=>{try{await w.callback(n,a)}catch(b){m.push(b)}});if(await Promise.all(y),m.length>0){for(let w=0;w<m.length;w+=1)console.error(m[w]);throw m[0]}}finally{this._debug(u,"end")}}async _saveSession(n){this._debug("#_saveSession()",n),this.suppressGetSessionWarning=!0;const a=Object.assign({},n),l=a.user&&a.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&a.user&&await cy(this.userStorage,this.storageKey+"-user",{user:a.user});const u=Object.assign({},a);delete u.user;const m=DW(u);await cy(this.storage,this.storageKey,m)}else{const u=DW(a);await cy(this.storage,this.storageKey,u)}}async _removeSession(){this._debug("#_removeSession()"),await zh(this.storage,this.storageKey),await zh(this.storage,this.storageKey+"-code-verifier"),await zh(this.storage,this.storageKey+"-user"),this.userStorage&&await zh(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const n=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{n&&$i()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",n)}catch(a){console.error("removing visibilitychange callback failed",a)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const n=setInterval(()=>this._autoRefreshTokenTick(),oy);this.autoRefreshTicker=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const n=this.autoRefreshTicker;this.autoRefreshTicker=null,n&&clearInterval(n)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const n=Date.now();try{return await this._useSession(async a=>{const{data:{session:l}}=a;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const u=Math.floor((l.expires_at*1e3-n)/oy);this._debug("#_autoRefreshTokenTick()",`access token expires in ${u} ticks, a tick lasts ${oy}ms, refresh threshold is ${vP} ticks`),u<=vP&&await this._callRefreshToken(l.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(n){if(n.isAcquireTimeout||n instanceof NK)this._debug("auto refresh token tick lock not available");else throw n}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$i()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(n){console.error("_handleVisibilityChange",n)}}async _onVisibilityChanged(n){const a=`#_onVisibilityChanged(${n})`;this._debug(a,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),n||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(a,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(n,a,l){const u=[`provider=${encodeURIComponent(a)}`];if(l!=null&&l.redirectTo&&u.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l!=null&&l.scopes&&u.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[m,y]=await ty(this.storage,this.storageKey),w=new URLSearchParams({code_challenge:`${encodeURIComponent(m)}`,code_challenge_method:`${encodeURIComponent(y)}`});u.push(w.toString())}if(l!=null&&l.queryParams){const m=new URLSearchParams(l.queryParams);u.push(m.toString())}return l!=null&&l.skipBrowserRedirect&&u.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${n}?${u.join("&")}`}async _unenroll(n){try{return await this._useSession(async a=>{var l;const{data:u,error:m}=a;return m?this._returnResult({data:null,error:m}):await Rr(this.fetch,"DELETE",`${this.url}/factors/${n.factorId}`,{headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token})})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}}async _enroll(n){try{return await this._useSession(async a=>{var l,u;const{data:m,error:y}=a;if(y)return this._returnResult({data:null,error:y});const w=Object.assign({friendly_name:n.friendlyName,factor_type:n.factorType},n.factorType==="phone"?{phone:n.phone}:n.factorType==="totp"?{issuer:n.issuer}:{}),{data:b,error:x}=await Rr(this.fetch,"POST",`${this.url}/factors`,{body:w,headers:this.headers,jwt:(l=m==null?void 0:m.session)===null||l===void 0?void 0:l.access_token});return x?this._returnResult({data:null,error:x}):(n.factorType==="totp"&&b.type==="totp"&&(!((u=b==null?void 0:b.totp)===null||u===void 0)&&u.qr_code)&&(b.totp.qr_code=`data:image/svg+xml;utf-8,${b.totp.qr_code}`),this._returnResult({data:b,error:null}))})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}}async _verify(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var l;const{data:u,error:m}=a;if(m)return this._returnResult({data:null,error:m});const y=Object.assign({challenge_id:n.challengeId},"webauthn"in n?{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_response:n.webauthn.type==="create"?whe(n.webauthn.credential_response):bhe(n.webauthn.credential_response)})}:{code:n.code}),{data:w,error:b}=await Rr(this.fetch,"POST",`${this.url}/factors/${n.factorId}/verify`,{body:y,headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token});return b?this._returnResult({data:null,error:b}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+w.expires_in},w)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",w),this._returnResult({data:w,error:b}))})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}})}async _challenge(n){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var l;const{data:u,error:m}=a;if(m)return this._returnResult({data:null,error:m});const y=await Rr(this.fetch,"POST",`${this.url}/factors/${n.factorId}/challenge`,{body:n,headers:this.headers,jwt:(l=u==null?void 0:u.session)===null||l===void 0?void 0:l.access_token});if(y.error)return y;const{data:w}=y;if(w.type!=="webauthn")return{data:w,error:null};switch(w.webauthn.type){case"create":return{data:Object.assign(Object.assign({},w),{webauthn:Object.assign(Object.assign({},w.webauthn),{credential_options:Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:vhe(w.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},w),{webauthn:Object.assign(Object.assign({},w.webauthn),{credential_options:Object.assign(Object.assign({},w.webauthn.credential_options),{publicKey:Ehe(w.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}})}async _challengeAndVerify(n){const{data:a,error:l}=await this._challenge({factorId:n.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:n.factorId,challengeId:a.id,code:n.code})}async _listFactors(){var n;const{data:{user:a},error:l}=await this.getUser();if(l)return{data:null,error:l};const u={all:[],phone:[],totp:[],webauthn:[]};for(const m of(n=a==null?void 0:a.factors)!==null&&n!==void 0?n:[])u.all.push(m),m.status==="verified"&&u[m.factor_type].push(m);return{data:u,error:null}}async _getAuthenticatorAssuranceLevel(){var n,a;const{data:{session:l},error:u}=await this.getSession();if(u)return this._returnResult({data:null,error:u});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:m}=_k(l.access_token);let y=null;m.aal&&(y=m.aal);let w=y;((a=(n=l.user.factors)===null||n===void 0?void 0:n.filter(T=>T.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(w="aal2");const x=m.amr||[];return{data:{currentLevel:y,nextLevel:w,currentAuthenticationMethods:x},error:null}}async _getAuthorizationDetails(n){try{return await this._useSession(async a=>{const{data:{session:l},error:u}=a;return u?this._returnResult({data:null,error:u}):l?await Rr(this.fetch,"GET",`${this.url}/oauth/authorizations/${n}`,{headers:this.headers,jwt:l.access_token,xform:m=>({data:m,error:null})}):this._returnResult({data:null,error:new yl})})}catch(a){if(lr(a))return this._returnResult({data:null,error:a});throw a}}async _approveAuthorization(n,a){try{return await this._useSession(async l=>{const{data:{session:u},error:m}=l;if(m)return this._returnResult({data:null,error:m});if(!u)return this._returnResult({data:null,error:new yl});const y=await Rr(this.fetch,"POST",`${this.url}/oauth/authorizations/${n}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"approve"},xform:w=>({data:w,error:null})});return y.data&&y.data.redirect_url&&$i()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(y.data.redirect_url),y})}catch(l){if(lr(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(n,a){try{return await this._useSession(async l=>{const{data:{session:u},error:m}=l;if(m)return this._returnResult({data:null,error:m});if(!u)return this._returnResult({data:null,error:new yl});const y=await Rr(this.fetch,"POST",`${this.url}/oauth/authorizations/${n}/consent`,{headers:this.headers,jwt:u.access_token,body:{action:"deny"},xform:w=>({data:w,error:null})});return y.data&&y.data.redirect_url&&$i()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(y.data.redirect_url),y})}catch(l){if(lr(l))return this._returnResult({data:null,error:l});throw l}}async fetchJwk(n,a={keys:[]}){let l=a.keys.find(w=>w.kid===n);if(l)return l;const u=Date.now();if(l=this.jwks.keys.find(w=>w.kid===n),l&&this.jwks_cached_at+Iue>u)return l;const{data:m,error:y}=await Rr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(y)throw y;return!m.keys||m.keys.length===0||(this.jwks=m,this.jwks_cached_at=u,l=m.keys.find(w=>w.kid===n),!l)?null:l}async getClaims(n,a={}){try{let l=n;if(!l){const{data:P,error:F}=await this.getSession();if(F||!P.session)return this._returnResult({data:null,error:F});l=P.session.access_token}const{header:u,payload:m,signature:y,raw:{header:w,payload:b}}=_k(l);a!=null&&a.allowExpired||Que(m.exp);const x=!u.alg||u.alg.startsWith("HS")||!u.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(u.kid,a!=null&&a.keys?{keys:a.keys}:a==null?void 0:a.jwks);if(!x){const{error:P}=await this.getUser(l);if(P)throw P;return{data:{claims:m,header:u,signature:y},error:null}}const T=Zue(u.alg),N=await crypto.subtle.importKey("jwk",x,T,!0,["verify"]);if(!await crypto.subtle.verify(T,N,y,Fue(`${w}.${b}`)))throw new bP("Invalid JWT signature");return{data:{claims:m,header:u,signature:y},error:null}}catch(l){if(lr(l))return this._returnResult({data:null,error:l});throw l}}}Lw.nextInstanceID={};const Ohe=Lw;class khe extends Ohe{constructor(n){super(n)}}class Phe{constructor(n,a,l){var u,m,y;this.supabaseUrl=n,this.supabaseKey=a;const w=Tue(n);if(!a)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",w),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",w),this.storageUrl=new URL("storage/v1",w),this.functionsUrl=new URL("functions/v1",w);const b=`sb-${w.hostname.split(".")[0]}-auth-token`,x={db:_ue,realtime:vue,auth:Object.assign(Object.assign({},yue),{storageKey:b}),global:gue},T=xue(l??{},x);this.storageKey=(u=T.auth.storageKey)!==null&&u!==void 0?u:"",this.headers=(m=T.global.headers)!==null&&m!==void 0?m:{},T.accessToken?(this.accessToken=T.accessToken,this.auth=new Proxy({},{get:(N,O)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(O)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((y=T.auth)!==null&&y!==void 0?y:{},this.headers,T.global.fetch),this.fetch=bue(a,this._getAccessToken.bind(this),T.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},T.realtime)),this.accessToken&&this.accessToken().then(N=>this.realtime.setAuth(N)).catch(N=>console.warn("Failed to set initial Realtime auth token:",N)),this.rest=new Cde(new URL("rest/v1",w).href,{headers:this.headers,schema:T.db.schema,fetch:this.fetch}),this.storage=new pue(this.storageUrl.href,this.headers,this.fetch,l==null?void 0:l.storage),T.accessToken||this._listenForAuthEvents()}get functions(){return new bde(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,a={},l={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,a,l)}channel(n,a={config:{}}){return this.realtime.channel(n,a)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n,a;if(this.accessToken)return await this.accessToken();const{data:l}=await this.auth.getSession();return(a=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:a,detectSessionInUrl:l,storage:u,userStorage:m,storageKey:y,flowType:w,lock:b,debug:x,throwOnError:T},N,O){const P={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new khe({url:this.authUrl.href,headers:Object.assign(Object.assign({},P),N),storageKey:y,autoRefreshToken:n,persistSession:a,detectSessionInUrl:l,storage:u,userStorage:m,flowType:w,lock:b,debug:x,throwOnError:T,fetch:O,hasCustomAuthorizationHeader:Object.keys(this.headers).some(F=>F.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new qde(this.realtimeUrl.href,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,l)=>{this._handleTokenChanged(a,"CLIENT",l==null?void 0:l.access_token)})}_handleTokenChanged(n,a,l){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==l?(this.changedAccessToken=l,this.realtime.setAuth(l)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),a=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Dhe=(i,n,a)=>new Phe(i,n,a);function jhe(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const n=i.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:!1}jhe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Lhe="modulepreload",Mhe=function(i){return"/"+i},BW={},OK=function(n,a,l){let u=Promise.resolve();if(a&&a.length>0){let y=function(x){return Promise.all(x.map(T=>Promise.resolve(T).then(N=>({status:"fulfilled",value:N}),N=>({status:"rejected",reason:N}))))};document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),b=(w==null?void 0:w.nonce)||(w==null?void 0:w.getAttribute("nonce"));u=y(a.map(x=>{if(x=Mhe(x),x in BW)return;BW[x]=!0;const T=x.endsWith(".css"),N=T?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${N}`))return;const O=document.createElement("link");if(O.rel=T?"stylesheet":Lhe,T||(O.as="script"),O.crossOrigin="",O.href=x,b&&O.setAttribute("nonce",b),document.head.appendChild(O),T)return new Promise((P,F)=>{O.addEventListener("load",P),O.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${x}`)))})}))}function m(y){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=y,window.dispatchEvent(w),!w.defaultPrevented)throw y}return u.then(y=>{for(const w of y||[])w.status==="rejected"&&m(w.reason);return n().catch(m)})};function Uhe(i){i.integrations||(i.integrations={}),i.integrations.Core||(i.integrations.Core={}),i.integrations.Core.UploadFile=async({file:n,bucket:a="avatars",pathPrefix:l="uploads"})=>{var O,P,F;if(!n)throw new Error("No file provided");const u=((P=(O=(await i.auth.getUser()).data)==null?void 0:O.user)==null?void 0:P.id)||"anon",m=((F=n.name)==null?void 0:F.split(".").pop())||"jpg",y=`${l}/${u}/${Date.now()}.${m}`,w=async z=>{const{error:V}=await i.storage.from(z).upload(y,n,{contentType:n.type||"application/octet-stream",upsert:!0});if(V)throw V;const{data:W}=i.storage.from(z).getPublicUrl(y);return{file_url:W.publicUrl,bucket:z,path:y}},b=Array.from(new Set([a,"avatars","images","public"]));let x=null;for(const z of b)try{return await w(z)}catch(V){x=V;const W=((V==null?void 0:V.message)||"").toLowerCase(),te=W.includes("bucket")&&W.includes("not found");if(W.includes("row-level security")||W.includes("permission denied")||W.includes("policy")||te)continue;break}const T=((x==null?void 0:x.message)||String(x||"")).toLowerCase();throw T.includes("row-level security")||T.includes("permission denied")||T.includes("policy")?new Error(`Upload blocked by Supabase Storage RLS. Allow authenticated insert/update on storage.objects for one of [${b.join(", ")}] or make the bucket public. Details: ${(x==null?void 0:x.message)||x}`):new Error(`Storage bucket missing. Please create one of [${b.join(", ")}] in Supabase Storage. Details: ${(x==null?void 0:x.message)||x}`)},i.integrations.Core.CreateFileSignedUrl=async({bucket:n="public",path:a,expiresIn:l=3600})=>{if(!a)throw new Error("Path is required");const{data:u,error:m}=await i.storage.from(n).createSignedUrl(a,l);if(m)throw m;return{signed_url:u.signedUrl}},i.integrations.Core.UploadPrivateFile=async({file:n,bucket:a="private",pathPrefix:l="uploads"})=>{var b,x,T;if(!n)throw new Error("No file provided");const u=((x=(b=(await i.auth.getUser()).data)==null?void 0:b.user)==null?void 0:x.id)||"anon",m=((T=n.name)==null?void 0:T.split(".").pop())||"dat",y=`${l}/${u}/${Date.now()}.${m}`,{error:w}=await i.storage.from(a).upload(y,n,{contentType:n.type||"application/octet-stream",upsert:!0});if(w)throw w;return{bucket:a,path:y}},i.integrations.Core.InvokeLLM=async({prompt:n,model:a="gpt-5-nano",store:l=!1}={})=>{if(!n||n.length<1)throw new Error("Prompt is required");try{if(i&&i.functions&&i.__isConfigured){const T={input:n,model:a,store:l},N=await i.functions.invoke("openaiResponse",{body:T}),O=(N==null?void 0:N.data)||N;try{const{extractOpenAIResponse:P}=await OK(async()=>{const{extractOpenAIResponse:z}=await import("./openaiHelpers-BEWUTb4r.js");return{extractOpenAIResponse:z}},[]),F=P(O);if(F.json)return F.json;if(F.text)return{text:F.text,raw:F.raw}}catch(P){console.warn("InvokeLLM: parse helper failed",(P==null?void 0:P.message)||P)}return{raw:O}}}catch(T){console.warn("InvokeLLM: server call failed, falling back to local rules:",(T==null?void 0:T.message)||T)}const u={},m=n.toLowerCase(),y=m.match(/increase\s+(daily reward|reward)\s+to\s+(\d+)/);y&&(u.daily_reward=Number(y[2]));const w=m.match(/enable\s+([a-z\s-]+)/);w&&(u[w[1].trim().replace(/\s+/g,"_")]=!0);const b=m.match(/(entrance effect price|price)\s+(to|=)\s*(\d+)/);return b&&(u.entrance_effect_price=Number(b[3])),{text:Object.keys(u).length>0?JSON.stringify(u):`{"note":"No structured commands detected","raw":"${n.replace(/"/g,'\\"')}"}`}},i.integrations.Core.GenerateImage=async()=>({url:null}),i.integrations.Core.ExtractDataFromUploadedFile=async()=>({data:null})}const cw="https://qaffpsbiciegxxonsxzl.supabase.co",Fhe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZmZwc2JpY2llZ3h4b25zeHpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NDEyMzgsImV4cCI6MjA3ODMxNzIzOH0.Rfb4WfqYHCGwZHv8HE3OxUSZbpEFqTfAnL0K4jaFnZU",Ek="https://qaffpsbiciegxxonsxzl.functions.supabase.co";function WW(i){try{const a=new URL(i).hostname;if(!a.endsWith("supabase.co"))return null;const[u]=a.split(".");return u?`https://${u}.functions.supabase.co`:null}catch{return null}}function wk(i,n){try{if(i){const l=new URL(i),u=l.hostname,m=u.endsWith("supabase.co"),y=u.includes(".functions.");if(m&&!y){const[w]=u.split(".");return l.hostname=`${w}.functions.supabase.co`,l.toString().replace(/\/$/,"")}return i.replace(/\/$/,"")}const a=WW(n);return a||void 0}catch{const l=WW(n);return l||void 0}}let jo;{jo=Dhe(cw,Fhe,{functions:wk(Ek,cw)?{url:wk(Ek,cw)}:void 0,auth:{persistSession:!0,autoRefreshToken:!0}}),jo.__isConfigured=!0;try{jo.auth.me=async()=>{var i,n;try{const{data:a}=await jo.auth.getUser(),l=(i=a==null?void 0:a.user)==null?void 0:i.id;if(!l)return null;const{data:u,error:m}=await jo.from("profiles").select("*").eq("id",l).limit(1).single();if(m)return console.error("Error fetching profile:",m),{id:l,is_admin:!1,level:1};const y=u||{id:l,is_admin:!1,level:1};return{...y,avatar:y.avatar??y.avatar_url??((n=y.user_metadata)==null?void 0:n.avatar_url)??null}}catch{return null}},jo.auth.redirectToLogin=()=>{try{typeof window<"u"&&(window.location.href="/Login")}catch{}}}catch{}try{const i={TrollFamilyApplication:"troll_family_applications",Payout:"payouts",User:"profiles",CoinPurchase:"coin_purchases",ModerationAction:"moderation_actions",ModerationSettings:"moderation_settings",Stream:"streams",StreamGift:"stream_gifts",ChatMessage:"messages",StreamLike:"stream_likes",Notification:"notifications"},n=l=>({list:async(u=null,m=null)=>{if(!l)return[];let y=jo.from(l).select("*");u&&typeof u=="string"&&(u.startsWith("-")?y=y.order(u.slice(1),{ascending:!1}):y=y.order(u,{ascending:!0})),m&&(y=y.limit(m));const{data:w}=await y;return w||[]},filter:async(u={})=>{if(!l)return[];let m=jo.from(l).select("*");Object.entries(u||{}).forEach(([w,b])=>{m=m.eq(w,b)});const{data:y}=await m;return y||[]},update:async(u,m)=>{if(!l)return null;const{data:y}=await jo.from(l).update(m).eq("id",u).select().single();return y||null},create:async u=>{if(!l)return null;const{data:m}=await jo.from(l).insert(u).select().single();return m||null},delete:async u=>{if(!l)return null;const{data:m}=await jo.from(l).delete().eq("id",u).select().single();return m||null}}),a={};Object.entries(i).forEach(([l,u])=>{a[l]=n(u)}),jo.entities=a}catch{}try{console.info("[Supabase] URL:",cw);const i=wk(Ek,cw);i&&console.info("[Supabase] Functions URL:",i)}catch{}}const K=jo;Uhe(K);let Vhe={data:""},Bhe=i=>{if(typeof window=="object"){let n=(i?i.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return n.nonce=window.__nonce__,n.parentNode||(i||document.head).appendChild(n),n.firstChild}return i||Vhe},Whe=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,qhe=/\/\*[^]*?\*\/|  +/g,qW=/\n+/g,Qh=(i,n)=>{let a="",l="",u="";for(let m in i){let y=i[m];m[0]=="@"?m[1]=="i"?a=m+" "+y+";":l+=m[1]=="f"?Qh(y,m):m+"{"+Qh(y,m[1]=="k"?"":n)+"}":typeof y=="object"?l+=Qh(y,n?n.replace(/([^,])+/g,w=>m.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,b=>/&/.test(b)?b.replace(/&/g,w):w?w+" "+b:b)):m):y!=null&&(m=/^--/.test(m)?m:m.replace(/[A-Z]/g,"-$&").toLowerCase(),u+=Qh.p?Qh.p(m,y):m+":"+y+";")}return a+(n&&u?n+"{"+u+"}":u)+l},yu={},kK=i=>{if(typeof i=="object"){let n="";for(let a in i)n+=a+kK(i[a]);return n}return i},Ghe=(i,n,a,l,u)=>{let m=kK(i),y=yu[m]||(yu[m]=(b=>{let x=0,T=11;for(;x<b.length;)T=101*T+b.charCodeAt(x++)>>>0;return"go"+T})(m));if(!yu[y]){let b=m!==i?i:(x=>{let T,N,O=[{}];for(;T=Whe.exec(x.replace(qhe,""));)T[4]?O.shift():T[3]?(N=T[3].replace(qW," ").trim(),O.unshift(O[0][N]=O[0][N]||{})):O[0][T[1]]=T[2].replace(qW," ").trim();return O[0]})(i);yu[y]=Qh(u?{["@keyframes "+y]:b}:b,a?"":"."+y)}let w=a&&yu.g?yu.g:null;return a&&(yu.g=yu[y]),((b,x,T,N)=>{N?x.data=x.data.replace(N,b):x.data.indexOf(b)===-1&&(x.data=T?b+x.data:x.data+b)})(yu[y],n,l,w),y},Hhe=(i,n,a)=>i.reduce((l,u,m)=>{let y=n[m];if(y&&y.call){let w=y(a),b=w&&w.props&&w.props.className||/^go/.test(w)&&w;y=b?"."+b:w&&typeof w=="object"?w.props?"":Qh(w,""):w===!1?"":w}return l+u+(y??"")},"");function IR(i){let n=this||{},a=i.call?i(n.p):i;return Ghe(a.unshift?a.raw?Hhe(a,[].slice.call(arguments,1),n.p):a.reduce((l,u)=>Object.assign(l,u&&u.call?u(n.p):u),{}):a,Bhe(n.target),n.g,n.o,n.k)}let PK,SP,xP;IR.bind({g:1});let Iu=IR.bind({k:1});function Khe(i,n,a,l){Qh.p=n,PK=i,SP=a,xP=l}function wp(i,n){let a=this||{};return function(){let l=arguments;function u(m,y){let w=Object.assign({},m),b=w.className||u.className;a.p=Object.assign({theme:SP&&SP()},w),a.o=/ *go\d+/.test(b),w.className=IR.apply(a,l)+(b?" "+b:"");let x=i;return i[0]&&(x=w.as||i,delete w.as),xP&&x[0]&&xP(w),PK(x,w)}return u}}var zhe=i=>typeof i=="function",pR=(i,n)=>zhe(i)?i(n):i,$he=(()=>{let i=0;return()=>(++i).toString()})(),DK=(()=>{let i;return()=>{if(i===void 0&&typeof window<"u"){let n=matchMedia("(prefers-reduced-motion: reduce)");i=!n||n.matches}return i}})(),Yhe=20,DD="default",jK=(i,n)=>{let{toastLimit:a}=i.settings;switch(n.type){case 0:return{...i,toasts:[n.toast,...i.toasts].slice(0,a)};case 1:return{...i,toasts:i.toasts.map(y=>y.id===n.toast.id?{...y,...n.toast}:y)};case 2:let{toast:l}=n;return jK(i,{type:i.toasts.find(y=>y.id===l.id)?1:0,toast:l});case 3:let{toastId:u}=n;return{...i,toasts:i.toasts.map(y=>y.id===u||u===void 0?{...y,dismissed:!0,visible:!1}:y)};case 4:return n.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(y=>y.id!==n.toastId)};case 5:return{...i,pausedAt:n.time};case 6:let m=n.time-(i.pausedAt||0);return{...i,pausedAt:void 0,toasts:i.toasts.map(y=>({...y,pauseDuration:y.pauseDuration+m}))}}},HC=[],LK={toasts:[],pausedAt:void 0,settings:{toastLimit:Yhe}},Cd={},MK=(i,n=DD)=>{Cd[n]=jK(Cd[n]||LK,i),HC.forEach(([a,l])=>{a===n&&l(Cd[n])})},UK=i=>Object.keys(Cd).forEach(n=>MK(i,n)),Xhe=i=>Object.keys(Cd).find(n=>Cd[n].toasts.some(a=>a.id===i)),OR=(i=DD)=>n=>{MK(n,i)},Jhe={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Qhe=(i={},n=DD)=>{let[a,l]=M.useState(Cd[n]||LK),u=M.useRef(Cd[n]);M.useEffect(()=>(u.current!==Cd[n]&&l(Cd[n]),HC.push([n,l]),()=>{let y=HC.findIndex(([w])=>w===n);y>-1&&HC.splice(y,1)}),[n]);let m=a.toasts.map(y=>{var w,b,x;return{...i,...i[y.type],...y,removeDelay:y.removeDelay||((w=i[y.type])==null?void 0:w.removeDelay)||(i==null?void 0:i.removeDelay),duration:y.duration||((b=i[y.type])==null?void 0:b.duration)||(i==null?void 0:i.duration)||Jhe[y.type],style:{...i.style,...(x=i[y.type])==null?void 0:x.style,...y.style}}});return{...a,toasts:m}},Zhe=(i,n="blank",a)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:n,ariaProps:{role:"status","aria-live":"polite"},message:i,pauseDuration:0,...a,id:(a==null?void 0:a.id)||$he()}),nb=i=>(n,a)=>{let l=Zhe(n,i,a);return OR(l.toasterId||Xhe(l.id))({type:2,toast:l}),l.id},bi=(i,n)=>nb("blank")(i,n);bi.error=nb("error");bi.success=nb("success");bi.loading=nb("loading");bi.custom=nb("custom");bi.dismiss=(i,n)=>{let a={type:3,toastId:i};n?OR(n)(a):UK(a)};bi.dismissAll=i=>bi.dismiss(void 0,i);bi.remove=(i,n)=>{let a={type:4,toastId:i};n?OR(n)(a):UK(a)};bi.removeAll=i=>bi.remove(void 0,i);bi.promise=(i,n,a)=>{let l=bi.loading(n.loading,{...a,...a==null?void 0:a.loading});return typeof i=="function"&&(i=i()),i.then(u=>{let m=n.success?pR(n.success,u):void 0;return m?bi.success(m,{id:l,...a,...a==null?void 0:a.success}):bi.dismiss(l),u}).catch(u=>{let m=n.error?pR(n.error,u):void 0;m?bi.error(m,{id:l,...a,...a==null?void 0:a.error}):bi.dismiss(l)}),i};var epe=1e3,tpe=(i,n="default")=>{let{toasts:a,pausedAt:l}=Qhe(i,n),u=M.useRef(new Map).current,m=M.useCallback((N,O=epe)=>{if(u.has(N))return;let P=setTimeout(()=>{u.delete(N),y({type:4,toastId:N})},O);u.set(N,P)},[]);M.useEffect(()=>{if(l)return;let N=Date.now(),O=a.map(P=>{if(P.duration===1/0)return;let F=(P.duration||0)+P.pauseDuration-(N-P.createdAt);if(F<0){P.visible&&bi.dismiss(P.id);return}return setTimeout(()=>bi.dismiss(P.id,n),F)});return()=>{O.forEach(P=>P&&clearTimeout(P))}},[a,l,n]);let y=M.useCallback(OR(n),[n]),w=M.useCallback(()=>{y({type:5,time:Date.now()})},[y]),b=M.useCallback((N,O)=>{y({type:1,toast:{id:N,height:O}})},[y]),x=M.useCallback(()=>{l&&y({type:6,time:Date.now()})},[l,y]),T=M.useCallback((N,O)=>{let{reverseOrder:P=!1,gutter:F=8,defaultPosition:z}=O||{},V=a.filter($=>($.position||z)===(N.position||z)&&$.height),W=V.findIndex($=>$.id===N.id),te=V.filter(($,Q)=>Q<W&&$.visible).length;return V.filter($=>$.visible).slice(...P?[te+1]:[0,te]).reduce(($,Q)=>$+(Q.height||0)+F,0)},[a]);return M.useEffect(()=>{a.forEach(N=>{if(N.dismissed)m(N.id,N.removeDelay);else{let O=u.get(N.id);O&&(clearTimeout(O),u.delete(N.id))}})},[a,m]),{toasts:a,handlers:{updateHeight:b,startPause:w,endPause:x,calculateOffset:T}}},rpe=Iu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,npe=Iu`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,spe=Iu`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ipe=wp("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${rpe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${npe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${i=>i.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${spe} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,ape=Iu`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ope=wp("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${i=>i.secondary||"#e0e0e0"};
  border-right-color: ${i=>i.primary||"#616161"};
  animation: ${ape} 1s linear infinite;
`,cpe=Iu`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,lpe=Iu`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,dpe=wp("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${cpe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${lpe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${i=>i.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,upe=wp("div")`
  position: absolute;
`,hpe=wp("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,ppe=Iu`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,fpe=wp("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${ppe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,mpe=({toast:i})=>{let{icon:n,type:a,iconTheme:l}=i;return n!==void 0?typeof n=="string"?M.createElement(fpe,null,n):n:a==="blank"?null:M.createElement(hpe,null,M.createElement(ope,{...l}),a!=="loading"&&M.createElement(upe,null,a==="error"?M.createElement(ipe,{...l}):M.createElement(dpe,{...l})))},gpe=i=>`
0% {transform: translate3d(0,${i*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,_pe=i=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${i*-150}%,-1px) scale(.6); opacity:0;}
`,ype="0%{opacity:0;} 100%{opacity:1;}",vpe="0%{opacity:1;} 100%{opacity:0;}",Epe=wp("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,wpe=wp("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,bpe=(i,n)=>{let a=i.includes("top")?1:-1,[l,u]=DK()?[ype,vpe]:[gpe(a),_pe(a)];return{animation:n?`${Iu(l)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Iu(u)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Spe=M.memo(({toast:i,position:n,style:a,children:l})=>{let u=i.height?bpe(i.position||n||"top-center",i.visible):{opacity:0},m=M.createElement(mpe,{toast:i}),y=M.createElement(wpe,{...i.ariaProps},pR(i.message,i));return M.createElement(Epe,{className:i.className,style:{...u,...a,...i.style}},typeof l=="function"?l({icon:m,message:y}):M.createElement(M.Fragment,null,m,y))});Khe(M.createElement);var xpe=({id:i,className:n,style:a,onHeightUpdate:l,children:u})=>{let m=M.useCallback(y=>{if(y){let w=()=>{let b=y.getBoundingClientRect().height;l(i,b)};w(),new MutationObserver(w).observe(y,{subtree:!0,childList:!0,characterData:!0})}},[i,l]);return M.createElement("div",{ref:m,className:n,style:a},u)},Tpe=(i,n)=>{let a=i.includes("top"),l=a?{top:0}:{bottom:0},u=i.includes("center")?{justifyContent:"center"}:i.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:DK()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${n*(a?1:-1)}px)`,...l,...u}},Cpe=IR`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,IC=16,Rpe=({reverseOrder:i,position:n="top-center",toastOptions:a,gutter:l,children:u,toasterId:m,containerStyle:y,containerClassName:w})=>{let{toasts:b,handlers:x}=tpe(a,m);return M.createElement("div",{"data-rht-toaster":m||"",style:{position:"fixed",zIndex:9999,top:IC,left:IC,right:IC,bottom:IC,pointerEvents:"none",...y},className:w,onMouseEnter:x.startPause,onMouseLeave:x.endPause},b.map(T=>{let N=T.position||n,O=x.calculateOffset(T,{reverseOrder:i,gutter:l,defaultPosition:n}),P=Tpe(N,O);return M.createElement(xpe,{id:T.id,key:T.id,onHeightUpdate:x.updateHeight,className:T.visible?Cpe:"",style:P},T.type==="custom"?pR(T.message,T):u?u(T):M.createElement(Spe,{toast:T,position:N}))}))},Npe=bi;function Ape(i){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",n.appendChild(a),a.styleSheet?a.styleSheet.cssText=i:a.appendChild(document.createTextNode(i))}const Ipe=i=>{switch(i){case"success":return Ppe;case"info":return jpe;case"warning":return Dpe;case"error":return Lpe;default:return null}},Ope=Array(12).fill(0),kpe=({visible:i,className:n})=>ut.createElement("div",{className:["sonner-loading-wrapper",n].filter(Boolean).join(" "),"data-visible":i},ut.createElement("div",{className:"sonner-spinner"},Ope.map((a,l)=>ut.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${l}`})))),Ppe=ut.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ut.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Dpe=ut.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ut.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),jpe=ut.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ut.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Lpe=ut.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ut.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Mpe=ut.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ut.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ut.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Upe=()=>{const[i,n]=ut.useState(document.hidden);return ut.useEffect(()=>{const a=()=>{n(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),i};let TP=1;class Fpe{constructor(){this.subscribe=n=>(this.subscribers.push(n),()=>{const a=this.subscribers.indexOf(n);this.subscribers.splice(a,1)}),this.publish=n=>{this.subscribers.forEach(a=>a(n))},this.addToast=n=>{this.publish(n),this.toasts=[...this.toasts,n]},this.create=n=>{var a;const{message:l,...u}=n,m=typeof(n==null?void 0:n.id)=="number"||((a=n.id)==null?void 0:a.length)>0?n.id:TP++,y=this.toasts.find(b=>b.id===m),w=n.dismissible===void 0?!0:n.dismissible;return this.dismissedToasts.has(m)&&this.dismissedToasts.delete(m),y?this.toasts=this.toasts.map(b=>b.id===m?(this.publish({...b,...n,id:m,title:l}),{...b,...n,id:m,dismissible:w,title:l}):b):this.addToast({title:l,...u,dismissible:w,id:m}),m},this.dismiss=n=>(n?(this.dismissedToasts.add(n),requestAnimationFrame(()=>this.subscribers.forEach(a=>a({id:n,dismiss:!0})))):this.toasts.forEach(a=>{this.subscribers.forEach(l=>l({id:a.id,dismiss:!0}))}),n),this.message=(n,a)=>this.create({...a,message:n}),this.error=(n,a)=>this.create({...a,message:n,type:"error"}),this.success=(n,a)=>this.create({...a,type:"success",message:n}),this.info=(n,a)=>this.create({...a,type:"info",message:n}),this.warning=(n,a)=>this.create({...a,type:"warning",message:n}),this.loading=(n,a)=>this.create({...a,type:"loading",message:n}),this.promise=(n,a)=>{if(!a)return;let l;a.loading!==void 0&&(l=this.create({...a,promise:n,type:"loading",message:a.loading,description:typeof a.description!="function"?a.description:void 0}));const u=Promise.resolve(n instanceof Function?n():n);let m=l!==void 0,y;const w=u.then(async x=>{if(y=["resolve",x],ut.isValidElement(x))m=!1,this.create({id:l,type:"default",message:x});else if(Bpe(x)&&!x.ok){m=!1;const N=typeof a.error=="function"?await a.error(`HTTP error! status: ${x.status}`):a.error,O=typeof a.description=="function"?await a.description(`HTTP error! status: ${x.status}`):a.description,F=typeof N=="object"&&!ut.isValidElement(N)?N:{message:N};this.create({id:l,type:"error",description:O,...F})}else if(x instanceof Error){m=!1;const N=typeof a.error=="function"?await a.error(x):a.error,O=typeof a.description=="function"?await a.description(x):a.description,F=typeof N=="object"&&!ut.isValidElement(N)?N:{message:N};this.create({id:l,type:"error",description:O,...F})}else if(a.success!==void 0){m=!1;const N=typeof a.success=="function"?await a.success(x):a.success,O=typeof a.description=="function"?await a.description(x):a.description,F=typeof N=="object"&&!ut.isValidElement(N)?N:{message:N};this.create({id:l,type:"success",description:O,...F})}}).catch(async x=>{if(y=["reject",x],a.error!==void 0){m=!1;const T=typeof a.error=="function"?await a.error(x):a.error,N=typeof a.description=="function"?await a.description(x):a.description,P=typeof T=="object"&&!ut.isValidElement(T)?T:{message:T};this.create({id:l,type:"error",description:N,...P})}}).finally(()=>{m&&(this.dismiss(l),l=void 0),a.finally==null||a.finally.call(a)}),b=()=>new Promise((x,T)=>w.then(()=>y[0]==="reject"?T(y[1]):x(y[1])).catch(T));return typeof l!="string"&&typeof l!="number"?{unwrap:b}:Object.assign(l,{unwrap:b})},this.custom=(n,a)=>{const l=(a==null?void 0:a.id)||TP++;return this.create({jsx:n(l),id:l,...a}),l},this.getActiveToasts=()=>this.toasts.filter(n=>!this.dismissedToasts.has(n.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const io=new Fpe,Vpe=(i,n)=>{const a=(n==null?void 0:n.id)||TP++;return io.addToast({title:i,...n,id:a}),a},Bpe=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",Wpe=Vpe,qpe=()=>io.toasts,Gpe=()=>io.getActiveToasts(),pe=Object.assign(Wpe,{success:io.success,info:io.info,warning:io.warning,error:io.error,custom:io.custom,message:io.message,promise:io.promise,dismiss:io.dismiss,loading:io.loading},{getHistory:qpe,getToasts:Gpe});Ape("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function OC(i){return i.label!==void 0}const Hpe=3,Kpe="24px",zpe="16px",GW=4e3,$pe=356,Ype=14,Xpe=45,Jpe=200;function bd(...i){return i.filter(Boolean).join(" ")}function Qpe(i){const[n,a]=i.split("-"),l=[];return n&&l.push(n),a&&l.push(a),l}const Zpe=i=>{var n,a,l,u,m,y,w,b,x;const{invert:T,toast:N,unstyled:O,interacting:P,setHeights:F,visibleToasts:z,heights:V,index:W,toasts:te,expanded:$,removeToast:Q,defaultRichColors:G,closeButton:se,style:ie,cancelButtonStyle:ce,actionButtonStyle:Se,className:oe="",descriptionClassName:ve="",duration:he,position:Ze,gap:Qe,expandByDefault:me,classNames:ye,icons:ge,closeButtonAriaLabel:Ee="Close toast"}=i,[Oe,we]=ut.useState(null),[fe,De]=ut.useState(null),[je,_e]=ut.useState(!1),[Je,st]=ut.useState(!1),[vt,pt]=ut.useState(!1),[er,gt]=ut.useState(!1),[qe,Wr]=ut.useState(!1),[en,Cn]=ut.useState(0),[Lr,Le]=ut.useState(0),it=ut.useRef(N.duration||he||GW),jt=ut.useRef(null),xt=ut.useRef(null),Tr=W===0,An=W+1<=z,En=N.type,on=N.dismissible!==!1,Sr=N.className||"",js=N.descriptionClassName||"",ts=ut.useMemo(()=>V.findIndex(ar=>ar.toastId===N.id)||0,[V,N.id]),_t=ut.useMemo(()=>{var ar;return(ar=N.closeButton)!=null?ar:se},[N.closeButton,se]),wr=ut.useMemo(()=>N.duration||he||GW,[N.duration,he]),Ur=ut.useRef(0),dn=ut.useRef(0),bs=ut.useRef(0),di=ut.useRef(null),[Be,tt]=Ze.split("-"),bt=ut.useMemo(()=>V.reduce((ar,kn,qn)=>qn>=ts?ar:ar+kn.height,0),[V,ts]),ct=Upe(),Pt=N.invert||T,Ot=En==="loading";dn.current=ut.useMemo(()=>ts*Qe+bt,[ts,bt]),ut.useEffect(()=>{it.current=wr},[wr]),ut.useEffect(()=>{_e(!0)},[]),ut.useEffect(()=>{const ar=xt.current;if(ar){const kn=ar.getBoundingClientRect().height;return Le(kn),F(qn=>[{toastId:N.id,height:kn,position:N.position},...qn]),()=>F(qn=>qn.filter(Ls=>Ls.toastId!==N.id))}},[F,N.id]),ut.useLayoutEffect(()=>{if(!je)return;const ar=xt.current,kn=ar.style.height;ar.style.height="auto";const qn=ar.getBoundingClientRect().height;ar.style.height=kn,Le(qn),F(Ls=>Ls.find(hr=>hr.toastId===N.id)?Ls.map(hr=>hr.toastId===N.id?{...hr,height:qn}:hr):[{toastId:N.id,height:qn,position:N.position},...Ls])},[je,N.title,N.description,F,N.id,N.jsx,N.action,N.cancel]);const tr=ut.useCallback(()=>{st(!0),Cn(dn.current),F(ar=>ar.filter(kn=>kn.toastId!==N.id)),setTimeout(()=>{Q(N)},Jpe)},[N,Q,F,dn]);ut.useEffect(()=>{if(N.promise&&En==="loading"||N.duration===1/0||N.type==="loading")return;let ar;return $||P||ct?(()=>{if(bs.current<Ur.current){const Ls=new Date().getTime()-Ur.current;it.current=it.current-Ls}bs.current=new Date().getTime()})():(()=>{it.current!==1/0&&(Ur.current=new Date().getTime(),ar=setTimeout(()=>{N.onAutoClose==null||N.onAutoClose.call(N,N),tr()},it.current))})(),()=>clearTimeout(ar)},[$,P,N,En,ct,tr]),ut.useEffect(()=>{N.delete&&(tr(),N.onDismiss==null||N.onDismiss.call(N,N))},[tr,N.delete]);function Vo(){var ar;if(ge!=null&&ge.loading){var kn;return ut.createElement("div",{className:bd(ye==null?void 0:ye.loader,N==null||(kn=N.classNames)==null?void 0:kn.loader,"sonner-loader"),"data-visible":En==="loading"},ge.loading)}return ut.createElement(kpe,{className:bd(ye==null?void 0:ye.loader,N==null||(ar=N.classNames)==null?void 0:ar.loader),visible:En==="loading"})}const Da=N.icon||(ge==null?void 0:ge[En])||Ipe(En);var ma,Dc;return ut.createElement("li",{tabIndex:0,ref:xt,className:bd(oe,Sr,ye==null?void 0:ye.toast,N==null||(n=N.classNames)==null?void 0:n.toast,ye==null?void 0:ye.default,ye==null?void 0:ye[En],N==null||(a=N.classNames)==null?void 0:a[En]),"data-sonner-toast":"","data-rich-colors":(ma=N.richColors)!=null?ma:G,"data-styled":!(N.jsx||N.unstyled||O),"data-mounted":je,"data-promise":!!N.promise,"data-swiped":qe,"data-removed":Je,"data-visible":An,"data-y-position":Be,"data-x-position":tt,"data-index":W,"data-front":Tr,"data-swiping":vt,"data-dismissible":on,"data-type":En,"data-invert":Pt,"data-swipe-out":er,"data-swipe-direction":fe,"data-expanded":!!($||me&&je),"data-testid":N.testId,style:{"--index":W,"--toasts-before":W,"--z-index":te.length-W,"--offset":`${Je?en:dn.current}px`,"--initial-height":me?"auto":`${Lr}px`,...ie,...N.style},onDragEnd:()=>{pt(!1),we(null),di.current=null},onPointerDown:ar=>{ar.button!==2&&(Ot||!on||(jt.current=new Date,Cn(dn.current),ar.target.setPointerCapture(ar.pointerId),ar.target.tagName!=="BUTTON"&&(pt(!0),di.current={x:ar.clientX,y:ar.clientY})))},onPointerUp:()=>{var ar,kn,qn;if(er||!on)return;di.current=null;const Ls=Number(((ar=xt.current)==null?void 0:ar.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Ji=Number(((kn=xt.current)==null?void 0:kn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),hr=new Date().getTime()-((qn=jt.current)==null?void 0:qn.getTime()),Ar=Oe==="x"?Ls:Ji,ja=Math.abs(Ar)/hr;if(Math.abs(Ar)>=Xpe||ja>.11){Cn(dn.current),N.onDismiss==null||N.onDismiss.call(N,N),De(Oe==="x"?Ls>0?"right":"left":Ji>0?"down":"up"),tr(),gt(!0);return}else{var ui,Ti;(ui=xt.current)==null||ui.style.setProperty("--swipe-amount-x","0px"),(Ti=xt.current)==null||Ti.style.setProperty("--swipe-amount-y","0px")}Wr(!1),pt(!1),we(null)},onPointerMove:ar=>{var kn,qn,Ls;if(!di.current||!on||((kn=window.getSelection())==null?void 0:kn.toString().length)>0)return;const hr=ar.clientY-di.current.y,Ar=ar.clientX-di.current.x;var ja;const ui=(ja=i.swipeDirections)!=null?ja:Qpe(Ze);!Oe&&(Math.abs(Ar)>1||Math.abs(hr)>1)&&we(Math.abs(Ar)>Math.abs(hr)?"x":"y");let Ti={x:0,y:0};const jc=ga=>1/(1.5+Math.abs(ga)/20);if(Oe==="y"){if(ui.includes("top")||ui.includes("bottom"))if(ui.includes("top")&&hr<0||ui.includes("bottom")&&hr>0)Ti.y=hr;else{const ga=hr*jc(hr);Ti.y=Math.abs(ga)<Math.abs(hr)?ga:hr}}else if(Oe==="x"&&(ui.includes("left")||ui.includes("right")))if(ui.includes("left")&&Ar<0||ui.includes("right")&&Ar>0)Ti.x=Ar;else{const ga=Ar*jc(Ar);Ti.x=Math.abs(ga)<Math.abs(Ar)?ga:Ar}(Math.abs(Ti.x)>0||Math.abs(Ti.y)>0)&&Wr(!0),(qn=xt.current)==null||qn.style.setProperty("--swipe-amount-x",`${Ti.x}px`),(Ls=xt.current)==null||Ls.style.setProperty("--swipe-amount-y",`${Ti.y}px`)}},_t&&!N.jsx&&En!=="loading"?ut.createElement("button",{"aria-label":Ee,"data-disabled":Ot,"data-close-button":!0,onClick:Ot||!on?()=>{}:()=>{tr(),N.onDismiss==null||N.onDismiss.call(N,N)},className:bd(ye==null?void 0:ye.closeButton,N==null||(l=N.classNames)==null?void 0:l.closeButton)},(Dc=ge==null?void 0:ge.close)!=null?Dc:Mpe):null,(En||N.icon||N.promise)&&N.icon!==null&&((ge==null?void 0:ge[En])!==null||N.icon)?ut.createElement("div",{"data-icon":"",className:bd(ye==null?void 0:ye.icon,N==null||(u=N.classNames)==null?void 0:u.icon)},N.promise||N.type==="loading"&&!N.icon?N.icon||Vo():null,N.type!=="loading"?Da:null):null,ut.createElement("div",{"data-content":"",className:bd(ye==null?void 0:ye.content,N==null||(m=N.classNames)==null?void 0:m.content)},ut.createElement("div",{"data-title":"",className:bd(ye==null?void 0:ye.title,N==null||(y=N.classNames)==null?void 0:y.title)},N.jsx?N.jsx:typeof N.title=="function"?N.title():N.title),N.description?ut.createElement("div",{"data-description":"",className:bd(ve,js,ye==null?void 0:ye.description,N==null||(w=N.classNames)==null?void 0:w.description)},typeof N.description=="function"?N.description():N.description):null),ut.isValidElement(N.cancel)?N.cancel:N.cancel&&OC(N.cancel)?ut.createElement("button",{"data-button":!0,"data-cancel":!0,style:N.cancelButtonStyle||ce,onClick:ar=>{OC(N.cancel)&&on&&(N.cancel.onClick==null||N.cancel.onClick.call(N.cancel,ar),tr())},className:bd(ye==null?void 0:ye.cancelButton,N==null||(b=N.classNames)==null?void 0:b.cancelButton)},N.cancel.label):null,ut.isValidElement(N.action)?N.action:N.action&&OC(N.action)?ut.createElement("button",{"data-button":!0,"data-action":!0,style:N.actionButtonStyle||Se,onClick:ar=>{OC(N.action)&&(N.action.onClick==null||N.action.onClick.call(N.action,ar),!ar.defaultPrevented&&tr())},className:bd(ye==null?void 0:ye.actionButton,N==null||(x=N.classNames)==null?void 0:x.actionButton)},N.action.label):null)};function HW(){if(typeof window>"u"||typeof document>"u")return"ltr";const i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}function efe(i,n){const a={};return[i,n].forEach((l,u)=>{const m=u===1,y=m?"--mobile-offset":"--offset",w=m?zpe:Kpe;function b(x){["top","right","bottom","left"].forEach(T=>{a[`${y}-${T}`]=typeof x=="number"?`${x}px`:x})}typeof l=="number"||typeof l=="string"?b(l):typeof l=="object"?["top","right","bottom","left"].forEach(x=>{l[x]===void 0?a[`${y}-${x}`]=w:a[`${y}-${x}`]=typeof l[x]=="number"?`${l[x]}px`:l[x]}):b(w)}),a}const tfe=ut.forwardRef(function(n,a){const{id:l,invert:u,position:m="bottom-right",hotkey:y=["altKey","KeyT"],expand:w,closeButton:b,className:x,offset:T,mobileOffset:N,theme:O="light",richColors:P,duration:F,style:z,visibleToasts:V=Hpe,toastOptions:W,dir:te=HW(),gap:$=Ype,icons:Q,containerAriaLabel:G="Notifications"}=n,[se,ie]=ut.useState([]),ce=ut.useMemo(()=>l?se.filter(je=>je.toasterId===l):se.filter(je=>!je.toasterId),[se,l]),Se=ut.useMemo(()=>Array.from(new Set([m].concat(ce.filter(je=>je.position).map(je=>je.position)))),[ce,m]),[oe,ve]=ut.useState([]),[he,Ze]=ut.useState(!1),[Qe,me]=ut.useState(!1),[ye,ge]=ut.useState(O!=="system"?O:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ee=ut.useRef(null),Oe=y.join("+").replace(/Key/g,"").replace(/Digit/g,""),we=ut.useRef(null),fe=ut.useRef(!1),De=ut.useCallback(je=>{ie(_e=>{var Je;return(Je=_e.find(st=>st.id===je.id))!=null&&Je.delete||io.dismiss(je.id),_e.filter(({id:st})=>st!==je.id)})},[]);return ut.useEffect(()=>io.subscribe(je=>{if(je.dismiss){requestAnimationFrame(()=>{ie(_e=>_e.map(Je=>Je.id===je.id?{...Je,delete:!0}:Je))});return}setTimeout(()=>{rce.flushSync(()=>{ie(_e=>{const Je=_e.findIndex(st=>st.id===je.id);return Je!==-1?[..._e.slice(0,Je),{..._e[Je],...je},..._e.slice(Je+1)]:[je,..._e]})})})}),[se]),ut.useEffect(()=>{if(O!=="system"){ge(O);return}if(O==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?ge("dark"):ge("light")),typeof window>"u")return;const je=window.matchMedia("(prefers-color-scheme: dark)");try{je.addEventListener("change",({matches:_e})=>{ge(_e?"dark":"light")})}catch{je.addListener(({matches:Je})=>{try{ge(Je?"dark":"light")}catch(st){console.error(st)}})}},[O]),ut.useEffect(()=>{se.length<=1&&Ze(!1)},[se]),ut.useEffect(()=>{const je=_e=>{var Je;if(y.every(pt=>_e[pt]||_e.code===pt)){var vt;Ze(!0),(vt=Ee.current)==null||vt.focus()}_e.code==="Escape"&&(document.activeElement===Ee.current||(Je=Ee.current)!=null&&Je.contains(document.activeElement))&&Ze(!1)};return document.addEventListener("keydown",je),()=>document.removeEventListener("keydown",je)},[y]),ut.useEffect(()=>{if(Ee.current)return()=>{we.current&&(we.current.focus({preventScroll:!0}),we.current=null,fe.current=!1)}},[Ee.current]),ut.createElement("section",{ref:a,"aria-label":`${G} ${Oe}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Se.map((je,_e)=>{var Je;const[st,vt]=je.split("-");return ce.length?ut.createElement("ol",{key:je,dir:te==="auto"?HW():te,tabIndex:-1,ref:Ee,className:x,"data-sonner-toaster":!0,"data-sonner-theme":ye,"data-y-position":st,"data-x-position":vt,style:{"--front-toast-height":`${((Je=oe[0])==null?void 0:Je.height)||0}px`,"--width":`${$pe}px`,"--gap":`${$}px`,...z,...efe(T,N)},onBlur:pt=>{fe.current&&!pt.currentTarget.contains(pt.relatedTarget)&&(fe.current=!1,we.current&&(we.current.focus({preventScroll:!0}),we.current=null))},onFocus:pt=>{pt.target instanceof HTMLElement&&pt.target.dataset.dismissible==="false"||fe.current||(fe.current=!0,we.current=pt.relatedTarget)},onMouseEnter:()=>Ze(!0),onMouseMove:()=>Ze(!0),onMouseLeave:()=>{Qe||Ze(!1)},onDragEnd:()=>Ze(!1),onPointerDown:pt=>{pt.target instanceof HTMLElement&&pt.target.dataset.dismissible==="false"||me(!0)},onPointerUp:()=>me(!1)},ce.filter(pt=>!pt.position&&_e===0||pt.position===je).map((pt,er)=>{var gt,qe;return ut.createElement(Zpe,{key:pt.id,icons:Q,index:er,toast:pt,defaultRichColors:P,duration:(gt=W==null?void 0:W.duration)!=null?gt:F,className:W==null?void 0:W.className,descriptionClassName:W==null?void 0:W.descriptionClassName,invert:u,visibleToasts:V,closeButton:(qe=W==null?void 0:W.closeButton)!=null?qe:b,interacting:Qe,position:je,style:W==null?void 0:W.style,unstyled:W==null?void 0:W.unstyled,classNames:W==null?void 0:W.classNames,cancelButtonStyle:W==null?void 0:W.cancelButtonStyle,actionButtonStyle:W==null?void 0:W.actionButtonStyle,closeButtonAriaLabel:W==null?void 0:W.closeButtonAriaLabel,removeToast:De,toasts:ce.filter(Wr=>Wr.position==pt.position),heights:oe.filter(Wr=>Wr.position==pt.position),setHeights:ve,expandByDefault:w,gap:$,expanded:he,swipeDirections:n.swipeDirections})})):null}))});function wu(i,n,{checkForDefaultPrevented:a=!0}={}){return function(u){if(i==null||i(u),a===!1||!u.defaultPrevented)return n==null?void 0:n(u)}}function KW(i,n){if(typeof i=="function")return i(n);i!=null&&(i.current=n)}function FK(...i){return n=>{let a=!1;const l=i.map(u=>{const m=KW(u,n);return!a&&typeof m=="function"&&(a=!0),m});if(a)return()=>{for(let u=0;u<l.length;u++){const m=l[u];typeof m=="function"?m():KW(i[u],null)}}}}function Fm(...i){return M.useCallback(FK(...i),i)}function VK(i,n=[]){let a=[];function l(m,y){const w=M.createContext(y),b=a.length;a=[...a,y];const x=N=>{var W;const{scope:O,children:P,...F}=N,z=((W=O==null?void 0:O[i])==null?void 0:W[b])||w,V=M.useMemo(()=>F,Object.values(F));return o.jsx(z.Provider,{value:V,children:P})};x.displayName=m+"Provider";function T(N,O){var z;const P=((z=O==null?void 0:O[i])==null?void 0:z[b])||w,F=M.useContext(P);if(F)return F;if(y!==void 0)return y;throw new Error(`\`${N}\` must be used within \`${m}\``)}return[x,T]}const u=()=>{const m=a.map(y=>M.createContext(y));return function(w){const b=(w==null?void 0:w[i])||m;return M.useMemo(()=>({[`__scope${i}`]:{...w,[i]:b}}),[w,b])}};return u.scopeName=i,[l,rfe(u,...n)]}function rfe(...i){const n=i[0];if(i.length===1)return n;const a=()=>{const l=i.map(u=>({useScope:u(),scopeName:u.scopeName}));return function(m){const y=l.reduce((w,{useScope:b,scopeName:x})=>{const N=b(m)[`__scope${x}`];return{...w,...N}},{});return M.useMemo(()=>({[`__scope${n.scopeName}`]:y}),[y])}};return a.scopeName=n.scopeName,a}function nfe(i){const n=sfe(i),a=M.forwardRef((l,u)=>{const{children:m,...y}=l,w=M.Children.toArray(m),b=w.find(afe);if(b){const x=b.props.children,T=w.map(N=>N===b?M.Children.count(x)>1?M.Children.only(null):M.isValidElement(x)?x.props.children:null:N);return o.jsx(n,{...y,ref:u,children:M.isValidElement(x)?M.cloneElement(x,void 0,T):null})}return o.jsx(n,{...y,ref:u,children:m})});return a.displayName=`${i}.Slot`,a}function sfe(i){const n=M.forwardRef((a,l)=>{const{children:u,...m}=a;if(M.isValidElement(u)){const y=cfe(u),w=ofe(m,u.props);return u.type!==M.Fragment&&(w.ref=l?FK(l,y):y),M.cloneElement(u,w)}return M.Children.count(u)>1?M.Children.only(null):null});return n.displayName=`${i}.SlotClone`,n}var ife=Symbol("radix.slottable");function afe(i){return M.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===ife}function ofe(i,n){const a={...n};for(const l in n){const u=i[l],m=n[l];/^on[A-Z]/.test(l)?u&&m?a[l]=(...w)=>{const b=m(...w);return u(...w),b}:u&&(a[l]=u):l==="style"?a[l]={...u,...m}:l==="className"&&(a[l]=[u,m].filter(Boolean).join(" "))}return{...i,...a}}function cfe(i){var l,u;let n=(l=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:l.get,a=n&&"isReactWarning"in n&&n.isReactWarning;return a?i.ref:(n=(u=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:u.get,a=n&&"isReactWarning"in n&&n.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}var lfe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Vm=lfe.reduce((i,n)=>{const a=nfe(`Primitive.${n}`),l=M.forwardRef((u,m)=>{const{asChild:y,...w}=u,b=y?a:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(b,{...w,ref:m})});return l.displayName=`Primitive.${n}`,{...i,[n]:l}},{});function dfe(i,n){i&&ED.flushSync(()=>i.dispatchEvent(n))}function kR(i){const n=M.useRef(i);return M.useEffect(()=>{n.current=i}),M.useMemo(()=>(...a)=>{var l;return(l=n.current)==null?void 0:l.call(n,...a)},[])}function ufe(i,n=globalThis==null?void 0:globalThis.document){const a=kR(i);M.useEffect(()=>{const l=u=>{u.key==="Escape"&&a(u)};return n.addEventListener("keydown",l,{capture:!0}),()=>n.removeEventListener("keydown",l,{capture:!0})},[a,n])}var hfe="DismissableLayer",CP="dismissableLayer.update",pfe="dismissableLayer.pointerDownOutside",ffe="dismissableLayer.focusOutside",zW,BK=M.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),WK=M.forwardRef((i,n)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:m,onInteractOutside:y,onDismiss:w,...b}=i,x=M.useContext(BK),[T,N]=M.useState(null),O=(T==null?void 0:T.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,P]=M.useState({}),F=Fm(n,ie=>N(ie)),z=Array.from(x.layers),[V]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),W=z.indexOf(V),te=T?z.indexOf(T):-1,$=x.layersWithOutsidePointerEventsDisabled.size>0,Q=te>=W,G=_fe(ie=>{const ce=ie.target,Se=[...x.branches].some(oe=>oe.contains(ce));!Q||Se||(u==null||u(ie),y==null||y(ie),ie.defaultPrevented||w==null||w())},O),se=yfe(ie=>{const ce=ie.target;[...x.branches].some(oe=>oe.contains(ce))||(m==null||m(ie),y==null||y(ie),ie.defaultPrevented||w==null||w())},O);return ufe(ie=>{te===x.layers.size-1&&(l==null||l(ie),!ie.defaultPrevented&&w&&(ie.preventDefault(),w()))},O),M.useEffect(()=>{if(T)return a&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(zW=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(T)),x.layers.add(T),$W(),()=>{a&&x.layersWithOutsidePointerEventsDisabled.size===1&&(O.body.style.pointerEvents=zW)}},[T,O,a,x]),M.useEffect(()=>()=>{T&&(x.layers.delete(T),x.layersWithOutsidePointerEventsDisabled.delete(T),$W())},[T,x]),M.useEffect(()=>{const ie=()=>P({});return document.addEventListener(CP,ie),()=>document.removeEventListener(CP,ie)},[]),o.jsx(Vm.div,{...b,ref:F,style:{pointerEvents:$?Q?"auto":"none":void 0,...i.style},onFocusCapture:wu(i.onFocusCapture,se.onFocusCapture),onBlurCapture:wu(i.onBlurCapture,se.onBlurCapture),onPointerDownCapture:wu(i.onPointerDownCapture,G.onPointerDownCapture)})});WK.displayName=hfe;var mfe="DismissableLayerBranch",gfe=M.forwardRef((i,n)=>{const a=M.useContext(BK),l=M.useRef(null),u=Fm(n,l);return M.useEffect(()=>{const m=l.current;if(m)return a.branches.add(m),()=>{a.branches.delete(m)}},[a.branches]),o.jsx(Vm.div,{...i,ref:u})});gfe.displayName=mfe;function _fe(i,n=globalThis==null?void 0:globalThis.document){const a=kR(i),l=M.useRef(!1),u=M.useRef(()=>{});return M.useEffect(()=>{const m=w=>{if(w.target&&!l.current){let b=function(){qK(pfe,a,x,{discrete:!0})};const x={originalEvent:w};w.pointerType==="touch"?(n.removeEventListener("click",u.current),u.current=b,n.addEventListener("click",u.current,{once:!0})):b()}else n.removeEventListener("click",u.current);l.current=!1},y=window.setTimeout(()=>{n.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(y),n.removeEventListener("pointerdown",m),n.removeEventListener("click",u.current)}},[n,a]),{onPointerDownCapture:()=>l.current=!0}}function yfe(i,n=globalThis==null?void 0:globalThis.document){const a=kR(i),l=M.useRef(!1);return M.useEffect(()=>{const u=m=>{m.target&&!l.current&&qK(ffe,a,{originalEvent:m},{discrete:!1})};return n.addEventListener("focusin",u),()=>n.removeEventListener("focusin",u)},[n,a]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function $W(){const i=new CustomEvent(CP);document.dispatchEvent(i)}function qK(i,n,a,{discrete:l}){const u=a.originalEvent.target,m=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:a});n&&u.addEventListener(i,n,{once:!0}),l?dfe(u,m):u.dispatchEvent(m)}var Dm=globalThis!=null&&globalThis.document?M.useLayoutEffect:()=>{},vfe=YG[" useId ".trim().toString()]||(()=>{}),Efe=0;function wfe(i){const[n,a]=M.useState(vfe());return Dm(()=>{a(l=>l??String(Efe++))},[i]),n?`radix-${n}`:""}const bfe=["top","right","bottom","left"],gp=Math.min,Lo=Math.max,fR=Math.round,kC=Math.floor,Nd=i=>({x:i,y:i}),Sfe={left:"right",right:"left",bottom:"top",top:"bottom"},xfe={start:"end",end:"start"};function RP(i,n,a){return Lo(i,gp(n,a))}function Ou(i,n){return typeof i=="function"?i(n):i}function ku(i){return i.split("-")[0]}function Yy(i){return i.split("-")[1]}function jD(i){return i==="x"?"y":"x"}function LD(i){return i==="y"?"height":"width"}const Tfe=new Set(["top","bottom"]);function Rd(i){return Tfe.has(ku(i))?"y":"x"}function MD(i){return jD(Rd(i))}function Cfe(i,n,a){a===void 0&&(a=!1);const l=Yy(i),u=MD(i),m=LD(u);let y=u==="x"?l===(a?"end":"start")?"right":"left":l==="start"?"bottom":"top";return n.reference[m]>n.floating[m]&&(y=mR(y)),[y,mR(y)]}function Rfe(i){const n=mR(i);return[NP(i),n,NP(n)]}function NP(i){return i.replace(/start|end/g,n=>xfe[n])}const YW=["left","right"],XW=["right","left"],Nfe=["top","bottom"],Afe=["bottom","top"];function Ife(i,n,a){switch(i){case"top":case"bottom":return a?n?XW:YW:n?YW:XW;case"left":case"right":return n?Nfe:Afe;default:return[]}}function Ofe(i,n,a,l){const u=Yy(i);let m=Ife(ku(i),a==="start",l);return u&&(m=m.map(y=>y+"-"+u),n&&(m=m.concat(m.map(NP)))),m}function mR(i){return i.replace(/left|right|bottom|top/g,n=>Sfe[n])}function kfe(i){return{top:0,right:0,bottom:0,left:0,...i}}function GK(i){return typeof i!="number"?kfe(i):{top:i,right:i,bottom:i,left:i}}function gR(i){const{x:n,y:a,width:l,height:u}=i;return{width:l,height:u,top:a,left:n,right:n+l,bottom:a+u,x:n,y:a}}function JW(i,n,a){let{reference:l,floating:u}=i;const m=Rd(n),y=MD(n),w=LD(y),b=ku(n),x=m==="y",T=l.x+l.width/2-u.width/2,N=l.y+l.height/2-u.height/2,O=l[w]/2-u[w]/2;let P;switch(b){case"top":P={x:T,y:l.y-u.height};break;case"bottom":P={x:T,y:l.y+l.height};break;case"right":P={x:l.x+l.width,y:N};break;case"left":P={x:l.x-u.width,y:N};break;default:P={x:l.x,y:l.y}}switch(Yy(n)){case"start":P[y]-=O*(a&&x?-1:1);break;case"end":P[y]+=O*(a&&x?-1:1);break}return P}const Pfe=async(i,n,a)=>{const{placement:l="bottom",strategy:u="absolute",middleware:m=[],platform:y}=a,w=m.filter(Boolean),b=await(y.isRTL==null?void 0:y.isRTL(n));let x=await y.getElementRects({reference:i,floating:n,strategy:u}),{x:T,y:N}=JW(x,l,b),O=l,P={},F=0;for(let z=0;z<w.length;z++){const{name:V,fn:W}=w[z],{x:te,y:$,data:Q,reset:G}=await W({x:T,y:N,initialPlacement:l,placement:O,strategy:u,middlewareData:P,rects:x,platform:y,elements:{reference:i,floating:n}});T=te??T,N=$??N,P={...P,[V]:{...P[V],...Q}},G&&F<=50&&(F++,typeof G=="object"&&(G.placement&&(O=G.placement),G.rects&&(x=G.rects===!0?await y.getElementRects({reference:i,floating:n,strategy:u}):G.rects),{x:T,y:N}=JW(x,O,b)),z=-1)}return{x:T,y:N,placement:O,strategy:u,middlewareData:P}};async function Mw(i,n){var a;n===void 0&&(n={});const{x:l,y:u,platform:m,rects:y,elements:w,strategy:b}=i,{boundary:x="clippingAncestors",rootBoundary:T="viewport",elementContext:N="floating",altBoundary:O=!1,padding:P=0}=Ou(n,i),F=GK(P),V=w[O?N==="floating"?"reference":"floating":N],W=gR(await m.getClippingRect({element:(a=await(m.isElement==null?void 0:m.isElement(V)))==null||a?V:V.contextElement||await(m.getDocumentElement==null?void 0:m.getDocumentElement(w.floating)),boundary:x,rootBoundary:T,strategy:b})),te=N==="floating"?{x:l,y:u,width:y.floating.width,height:y.floating.height}:y.reference,$=await(m.getOffsetParent==null?void 0:m.getOffsetParent(w.floating)),Q=await(m.isElement==null?void 0:m.isElement($))?await(m.getScale==null?void 0:m.getScale($))||{x:1,y:1}:{x:1,y:1},G=gR(m.convertOffsetParentRelativeRectToViewportRelativeRect?await m.convertOffsetParentRelativeRectToViewportRelativeRect({elements:w,rect:te,offsetParent:$,strategy:b}):te);return{top:(W.top-G.top+F.top)/Q.y,bottom:(G.bottom-W.bottom+F.bottom)/Q.y,left:(W.left-G.left+F.left)/Q.x,right:(G.right-W.right+F.right)/Q.x}}const Dfe=i=>({name:"arrow",options:i,async fn(n){const{x:a,y:l,placement:u,rects:m,platform:y,elements:w,middlewareData:b}=n,{element:x,padding:T=0}=Ou(i,n)||{};if(x==null)return{};const N=GK(T),O={x:a,y:l},P=MD(u),F=LD(P),z=await y.getDimensions(x),V=P==="y",W=V?"top":"left",te=V?"bottom":"right",$=V?"clientHeight":"clientWidth",Q=m.reference[F]+m.reference[P]-O[P]-m.floating[F],G=O[P]-m.reference[P],se=await(y.getOffsetParent==null?void 0:y.getOffsetParent(x));let ie=se?se[$]:0;(!ie||!await(y.isElement==null?void 0:y.isElement(se)))&&(ie=w.floating[$]||m.floating[F]);const ce=Q/2-G/2,Se=ie/2-z[F]/2-1,oe=gp(N[W],Se),ve=gp(N[te],Se),he=oe,Ze=ie-z[F]-ve,Qe=ie/2-z[F]/2+ce,me=RP(he,Qe,Ze),ye=!b.arrow&&Yy(u)!=null&&Qe!==me&&m.reference[F]/2-(Qe<he?oe:ve)-z[F]/2<0,ge=ye?Qe<he?Qe-he:Qe-Ze:0;return{[P]:O[P]+ge,data:{[P]:me,centerOffset:Qe-me-ge,...ye&&{alignmentOffset:ge}},reset:ye}}}),jfe=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(n){var a,l;const{placement:u,middlewareData:m,rects:y,initialPlacement:w,platform:b,elements:x}=n,{mainAxis:T=!0,crossAxis:N=!0,fallbackPlacements:O,fallbackStrategy:P="bestFit",fallbackAxisSideDirection:F="none",flipAlignment:z=!0,...V}=Ou(i,n);if((a=m.arrow)!=null&&a.alignmentOffset)return{};const W=ku(u),te=Rd(w),$=ku(w)===w,Q=await(b.isRTL==null?void 0:b.isRTL(x.floating)),G=O||($||!z?[mR(w)]:Rfe(w)),se=F!=="none";!O&&se&&G.push(...Ofe(w,z,F,Q));const ie=[w,...G],ce=await Mw(n,V),Se=[];let oe=((l=m.flip)==null?void 0:l.overflows)||[];if(T&&Se.push(ce[W]),N){const Qe=Cfe(u,y,Q);Se.push(ce[Qe[0]],ce[Qe[1]])}if(oe=[...oe,{placement:u,overflows:Se}],!Se.every(Qe=>Qe<=0)){var ve,he;const Qe=(((ve=m.flip)==null?void 0:ve.index)||0)+1,me=ie[Qe];if(me&&(!(N==="alignment"?te!==Rd(me):!1)||oe.every(Ee=>Rd(Ee.placement)===te?Ee.overflows[0]>0:!0)))return{data:{index:Qe,overflows:oe},reset:{placement:me}};let ye=(he=oe.filter(ge=>ge.overflows[0]<=0).sort((ge,Ee)=>ge.overflows[1]-Ee.overflows[1])[0])==null?void 0:he.placement;if(!ye)switch(P){case"bestFit":{var Ze;const ge=(Ze=oe.filter(Ee=>{if(se){const Oe=Rd(Ee.placement);return Oe===te||Oe==="y"}return!0}).map(Ee=>[Ee.placement,Ee.overflows.filter(Oe=>Oe>0).reduce((Oe,we)=>Oe+we,0)]).sort((Ee,Oe)=>Ee[1]-Oe[1])[0])==null?void 0:Ze[0];ge&&(ye=ge);break}case"initialPlacement":ye=w;break}if(u!==ye)return{reset:{placement:ye}}}return{}}}};function QW(i,n){return{top:i.top-n.height,right:i.right-n.width,bottom:i.bottom-n.height,left:i.left-n.width}}function ZW(i){return bfe.some(n=>i[n]>=0)}const Lfe=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(n){const{rects:a}=n,{strategy:l="referenceHidden",...u}=Ou(i,n);switch(l){case"referenceHidden":{const m=await Mw(n,{...u,elementContext:"reference"}),y=QW(m,a.reference);return{data:{referenceHiddenOffsets:y,referenceHidden:ZW(y)}}}case"escaped":{const m=await Mw(n,{...u,altBoundary:!0}),y=QW(m,a.floating);return{data:{escapedOffsets:y,escaped:ZW(y)}}}default:return{}}}}},HK=new Set(["left","top"]);async function Mfe(i,n){const{placement:a,platform:l,elements:u}=i,m=await(l.isRTL==null?void 0:l.isRTL(u.floating)),y=ku(a),w=Yy(a),b=Rd(a)==="y",x=HK.has(y)?-1:1,T=m&&b?-1:1,N=Ou(n,i);let{mainAxis:O,crossAxis:P,alignmentAxis:F}=typeof N=="number"?{mainAxis:N,crossAxis:0,alignmentAxis:null}:{mainAxis:N.mainAxis||0,crossAxis:N.crossAxis||0,alignmentAxis:N.alignmentAxis};return w&&typeof F=="number"&&(P=w==="end"?F*-1:F),b?{x:P*T,y:O*x}:{x:O*x,y:P*T}}const Ufe=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(n){var a,l;const{x:u,y:m,placement:y,middlewareData:w}=n,b=await Mfe(n,i);return y===((a=w.offset)==null?void 0:a.placement)&&(l=w.arrow)!=null&&l.alignmentOffset?{}:{x:u+b.x,y:m+b.y,data:{...b,placement:y}}}}},Ffe=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(n){const{x:a,y:l,placement:u}=n,{mainAxis:m=!0,crossAxis:y=!1,limiter:w={fn:V=>{let{x:W,y:te}=V;return{x:W,y:te}}},...b}=Ou(i,n),x={x:a,y:l},T=await Mw(n,b),N=Rd(ku(u)),O=jD(N);let P=x[O],F=x[N];if(m){const V=O==="y"?"top":"left",W=O==="y"?"bottom":"right",te=P+T[V],$=P-T[W];P=RP(te,P,$)}if(y){const V=N==="y"?"top":"left",W=N==="y"?"bottom":"right",te=F+T[V],$=F-T[W];F=RP(te,F,$)}const z=w.fn({...n,[O]:P,[N]:F});return{...z,data:{x:z.x-a,y:z.y-l,enabled:{[O]:m,[N]:y}}}}}},Vfe=function(i){return i===void 0&&(i={}),{options:i,fn(n){const{x:a,y:l,placement:u,rects:m,middlewareData:y}=n,{offset:w=0,mainAxis:b=!0,crossAxis:x=!0}=Ou(i,n),T={x:a,y:l},N=Rd(u),O=jD(N);let P=T[O],F=T[N];const z=Ou(w,n),V=typeof z=="number"?{mainAxis:z,crossAxis:0}:{mainAxis:0,crossAxis:0,...z};if(b){const $=O==="y"?"height":"width",Q=m.reference[O]-m.floating[$]+V.mainAxis,G=m.reference[O]+m.reference[$]-V.mainAxis;P<Q?P=Q:P>G&&(P=G)}if(x){var W,te;const $=O==="y"?"width":"height",Q=HK.has(ku(u)),G=m.reference[N]-m.floating[$]+(Q&&((W=y.offset)==null?void 0:W[N])||0)+(Q?0:V.crossAxis),se=m.reference[N]+m.reference[$]+(Q?0:((te=y.offset)==null?void 0:te[N])||0)-(Q?V.crossAxis:0);F<G?F=G:F>se&&(F=se)}return{[O]:P,[N]:F}}}},Bfe=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(n){var a,l;const{placement:u,rects:m,platform:y,elements:w}=n,{apply:b=()=>{},...x}=Ou(i,n),T=await Mw(n,x),N=ku(u),O=Yy(u),P=Rd(u)==="y",{width:F,height:z}=m.floating;let V,W;N==="top"||N==="bottom"?(V=N,W=O===(await(y.isRTL==null?void 0:y.isRTL(w.floating))?"start":"end")?"left":"right"):(W=N,V=O==="end"?"top":"bottom");const te=z-T.top-T.bottom,$=F-T.left-T.right,Q=gp(z-T[V],te),G=gp(F-T[W],$),se=!n.middlewareData.shift;let ie=Q,ce=G;if((a=n.middlewareData.shift)!=null&&a.enabled.x&&(ce=$),(l=n.middlewareData.shift)!=null&&l.enabled.y&&(ie=te),se&&!O){const oe=Lo(T.left,0),ve=Lo(T.right,0),he=Lo(T.top,0),Ze=Lo(T.bottom,0);P?ce=F-2*(oe!==0||ve!==0?oe+ve:Lo(T.left,T.right)):ie=z-2*(he!==0||Ze!==0?he+Ze:Lo(T.top,T.bottom))}await b({...n,availableWidth:ce,availableHeight:ie});const Se=await y.getDimensions(w.floating);return F!==Se.width||z!==Se.height?{reset:{rects:!0}}:{}}}};function PR(){return typeof window<"u"}function Xy(i){return KK(i)?(i.nodeName||"").toLowerCase():"#document"}function Fo(i){var n;return(i==null||(n=i.ownerDocument)==null?void 0:n.defaultView)||window}function jd(i){var n;return(n=(KK(i)?i.ownerDocument:i.document)||window.document)==null?void 0:n.documentElement}function KK(i){return PR()?i instanceof Node||i instanceof Fo(i).Node:!1}function Cl(i){return PR()?i instanceof Element||i instanceof Fo(i).Element:!1}function Od(i){return PR()?i instanceof HTMLElement||i instanceof Fo(i).HTMLElement:!1}function eq(i){return!PR()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof Fo(i).ShadowRoot}const Wfe=new Set(["inline","contents"]);function sb(i){const{overflow:n,overflowX:a,overflowY:l,display:u}=Rl(i);return/auto|scroll|overlay|hidden|clip/.test(n+l+a)&&!Wfe.has(u)}const qfe=new Set(["table","td","th"]);function Gfe(i){return qfe.has(Xy(i))}const Hfe=[":popover-open",":modal"];function DR(i){return Hfe.some(n=>{try{return i.matches(n)}catch{return!1}})}const Kfe=["transform","translate","scale","rotate","perspective"],zfe=["transform","translate","scale","rotate","perspective","filter"],$fe=["paint","layout","strict","content"];function UD(i){const n=FD(),a=Cl(i)?Rl(i):i;return Kfe.some(l=>a[l]?a[l]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!n&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!n&&(a.filter?a.filter!=="none":!1)||zfe.some(l=>(a.willChange||"").includes(l))||$fe.some(l=>(a.contain||"").includes(l))}function Yfe(i){let n=_p(i);for(;Od(n)&&!Fy(n);){if(UD(n))return n;if(DR(n))return null;n=_p(n)}return null}function FD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Xfe=new Set(["html","body","#document"]);function Fy(i){return Xfe.has(Xy(i))}function Rl(i){return Fo(i).getComputedStyle(i)}function jR(i){return Cl(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function _p(i){if(Xy(i)==="html")return i;const n=i.assignedSlot||i.parentNode||eq(i)&&i.host||jd(i);return eq(n)?n.host:n}function zK(i){const n=_p(i);return Fy(n)?i.ownerDocument?i.ownerDocument.body:i.body:Od(n)&&sb(n)?n:zK(n)}function Uw(i,n,a){var l;n===void 0&&(n=[]),a===void 0&&(a=!0);const u=zK(i),m=u===((l=i.ownerDocument)==null?void 0:l.body),y=Fo(u);if(m){const w=AP(y);return n.concat(y,y.visualViewport||[],sb(u)?u:[],w&&a?Uw(w):[])}return n.concat(u,Uw(u,[],a))}function AP(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function $K(i){const n=Rl(i);let a=parseFloat(n.width)||0,l=parseFloat(n.height)||0;const u=Od(i),m=u?i.offsetWidth:a,y=u?i.offsetHeight:l,w=fR(a)!==m||fR(l)!==y;return w&&(a=m,l=y),{width:a,height:l,$:w}}function VD(i){return Cl(i)?i:i.contextElement}function Ey(i){const n=VD(i);if(!Od(n))return Nd(1);const a=n.getBoundingClientRect(),{width:l,height:u,$:m}=$K(n);let y=(m?fR(a.width):a.width)/l,w=(m?fR(a.height):a.height)/u;return(!y||!Number.isFinite(y))&&(y=1),(!w||!Number.isFinite(w))&&(w=1),{x:y,y:w}}const Jfe=Nd(0);function YK(i){const n=Fo(i);return!FD()||!n.visualViewport?Jfe:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function Qfe(i,n,a){return n===void 0&&(n=!1),!a||n&&a!==Fo(i)?!1:n}function jm(i,n,a,l){n===void 0&&(n=!1),a===void 0&&(a=!1);const u=i.getBoundingClientRect(),m=VD(i);let y=Nd(1);n&&(l?Cl(l)&&(y=Ey(l)):y=Ey(i));const w=Qfe(m,a,l)?YK(m):Nd(0);let b=(u.left+w.x)/y.x,x=(u.top+w.y)/y.y,T=u.width/y.x,N=u.height/y.y;if(m){const O=Fo(m),P=l&&Cl(l)?Fo(l):l;let F=O,z=AP(F);for(;z&&l&&P!==F;){const V=Ey(z),W=z.getBoundingClientRect(),te=Rl(z),$=W.left+(z.clientLeft+parseFloat(te.paddingLeft))*V.x,Q=W.top+(z.clientTop+parseFloat(te.paddingTop))*V.y;b*=V.x,x*=V.y,T*=V.x,N*=V.y,b+=$,x+=Q,F=Fo(z),z=AP(F)}}return gR({width:T,height:N,x:b,y:x})}function LR(i,n){const a=jR(i).scrollLeft;return n?n.left+a:jm(jd(i)).left+a}function XK(i,n){const a=i.getBoundingClientRect(),l=a.left+n.scrollLeft-LR(i,a),u=a.top+n.scrollTop;return{x:l,y:u}}function Zfe(i){let{elements:n,rect:a,offsetParent:l,strategy:u}=i;const m=u==="fixed",y=jd(l),w=n?DR(n.floating):!1;if(l===y||w&&m)return a;let b={scrollLeft:0,scrollTop:0},x=Nd(1);const T=Nd(0),N=Od(l);if((N||!N&&!m)&&((Xy(l)!=="body"||sb(y))&&(b=jR(l)),Od(l))){const P=jm(l);x=Ey(l),T.x=P.x+l.clientLeft,T.y=P.y+l.clientTop}const O=y&&!N&&!m?XK(y,b):Nd(0);return{width:a.width*x.x,height:a.height*x.y,x:a.x*x.x-b.scrollLeft*x.x+T.x+O.x,y:a.y*x.y-b.scrollTop*x.y+T.y+O.y}}function eme(i){return Array.from(i.getClientRects())}function tme(i){const n=jd(i),a=jR(i),l=i.ownerDocument.body,u=Lo(n.scrollWidth,n.clientWidth,l.scrollWidth,l.clientWidth),m=Lo(n.scrollHeight,n.clientHeight,l.scrollHeight,l.clientHeight);let y=-a.scrollLeft+LR(i);const w=-a.scrollTop;return Rl(l).direction==="rtl"&&(y+=Lo(n.clientWidth,l.clientWidth)-u),{width:u,height:m,x:y,y:w}}const tq=25;function rme(i,n){const a=Fo(i),l=jd(i),u=a.visualViewport;let m=l.clientWidth,y=l.clientHeight,w=0,b=0;if(u){m=u.width,y=u.height;const T=FD();(!T||T&&n==="fixed")&&(w=u.offsetLeft,b=u.offsetTop)}const x=LR(l);if(x<=0){const T=l.ownerDocument,N=T.body,O=getComputedStyle(N),P=T.compatMode==="CSS1Compat"&&parseFloat(O.marginLeft)+parseFloat(O.marginRight)||0,F=Math.abs(l.clientWidth-N.clientWidth-P);F<=tq&&(m-=F)}else x<=tq&&(m+=x);return{width:m,height:y,x:w,y:b}}const nme=new Set(["absolute","fixed"]);function sme(i,n){const a=jm(i,!0,n==="fixed"),l=a.top+i.clientTop,u=a.left+i.clientLeft,m=Od(i)?Ey(i):Nd(1),y=i.clientWidth*m.x,w=i.clientHeight*m.y,b=u*m.x,x=l*m.y;return{width:y,height:w,x:b,y:x}}function rq(i,n,a){let l;if(n==="viewport")l=rme(i,a);else if(n==="document")l=tme(jd(i));else if(Cl(n))l=sme(n,a);else{const u=YK(i);l={x:n.x-u.x,y:n.y-u.y,width:n.width,height:n.height}}return gR(l)}function JK(i,n){const a=_p(i);return a===n||!Cl(a)||Fy(a)?!1:Rl(a).position==="fixed"||JK(a,n)}function ime(i,n){const a=n.get(i);if(a)return a;let l=Uw(i,[],!1).filter(w=>Cl(w)&&Xy(w)!=="body"),u=null;const m=Rl(i).position==="fixed";let y=m?_p(i):i;for(;Cl(y)&&!Fy(y);){const w=Rl(y),b=UD(y);!b&&w.position==="fixed"&&(u=null),(m?!b&&!u:!b&&w.position==="static"&&!!u&&nme.has(u.position)||sb(y)&&!b&&JK(i,y))?l=l.filter(T=>T!==y):u=w,y=_p(y)}return n.set(i,l),l}function ame(i){let{element:n,boundary:a,rootBoundary:l,strategy:u}=i;const y=[...a==="clippingAncestors"?DR(n)?[]:ime(n,this._c):[].concat(a),l],w=y[0],b=y.reduce((x,T)=>{const N=rq(n,T,u);return x.top=Lo(N.top,x.top),x.right=gp(N.right,x.right),x.bottom=gp(N.bottom,x.bottom),x.left=Lo(N.left,x.left),x},rq(n,w,u));return{width:b.right-b.left,height:b.bottom-b.top,x:b.left,y:b.top}}function ome(i){const{width:n,height:a}=$K(i);return{width:n,height:a}}function cme(i,n,a){const l=Od(n),u=jd(n),m=a==="fixed",y=jm(i,!0,m,n);let w={scrollLeft:0,scrollTop:0};const b=Nd(0);function x(){b.x=LR(u)}if(l||!l&&!m)if((Xy(n)!=="body"||sb(u))&&(w=jR(n)),l){const P=jm(n,!0,m,n);b.x=P.x+n.clientLeft,b.y=P.y+n.clientTop}else u&&x();m&&!l&&u&&x();const T=u&&!l&&!m?XK(u,w):Nd(0),N=y.left+w.scrollLeft-b.x-T.x,O=y.top+w.scrollTop-b.y-T.y;return{x:N,y:O,width:y.width,height:y.height}}function bk(i){return Rl(i).position==="static"}function nq(i,n){if(!Od(i)||Rl(i).position==="fixed")return null;if(n)return n(i);let a=i.offsetParent;return jd(i)===a&&(a=a.ownerDocument.body),a}function QK(i,n){const a=Fo(i);if(DR(i))return a;if(!Od(i)){let u=_p(i);for(;u&&!Fy(u);){if(Cl(u)&&!bk(u))return u;u=_p(u)}return a}let l=nq(i,n);for(;l&&Gfe(l)&&bk(l);)l=nq(l,n);return l&&Fy(l)&&bk(l)&&!UD(l)?a:l||Yfe(i)||a}const lme=async function(i){const n=this.getOffsetParent||QK,a=this.getDimensions,l=await a(i.floating);return{reference:cme(i.reference,await n(i.floating),i.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function dme(i){return Rl(i).direction==="rtl"}const ume={convertOffsetParentRelativeRectToViewportRelativeRect:Zfe,getDocumentElement:jd,getClippingRect:ame,getOffsetParent:QK,getElementRects:lme,getClientRects:eme,getDimensions:ome,getScale:Ey,isElement:Cl,isRTL:dme};function ZK(i,n){return i.x===n.x&&i.y===n.y&&i.width===n.width&&i.height===n.height}function hme(i,n){let a=null,l;const u=jd(i);function m(){var w;clearTimeout(l),(w=a)==null||w.disconnect(),a=null}function y(w,b){w===void 0&&(w=!1),b===void 0&&(b=1),m();const x=i.getBoundingClientRect(),{left:T,top:N,width:O,height:P}=x;if(w||n(),!O||!P)return;const F=kC(N),z=kC(u.clientWidth-(T+O)),V=kC(u.clientHeight-(N+P)),W=kC(T),$={rootMargin:-F+"px "+-z+"px "+-V+"px "+-W+"px",threshold:Lo(0,gp(1,b))||1};let Q=!0;function G(se){const ie=se[0].intersectionRatio;if(ie!==b){if(!Q)return y();ie?y(!1,ie):l=setTimeout(()=>{y(!1,1e-7)},1e3)}ie===1&&!ZK(x,i.getBoundingClientRect())&&y(),Q=!1}try{a=new IntersectionObserver(G,{...$,root:u.ownerDocument})}catch{a=new IntersectionObserver(G,$)}a.observe(i)}return y(!0),m}function pme(i,n,a,l){l===void 0&&(l={});const{ancestorScroll:u=!0,ancestorResize:m=!0,elementResize:y=typeof ResizeObserver=="function",layoutShift:w=typeof IntersectionObserver=="function",animationFrame:b=!1}=l,x=VD(i),T=u||m?[...x?Uw(x):[],...Uw(n)]:[];T.forEach(W=>{u&&W.addEventListener("scroll",a,{passive:!0}),m&&W.addEventListener("resize",a)});const N=x&&w?hme(x,a):null;let O=-1,P=null;y&&(P=new ResizeObserver(W=>{let[te]=W;te&&te.target===x&&P&&(P.unobserve(n),cancelAnimationFrame(O),O=requestAnimationFrame(()=>{var $;($=P)==null||$.observe(n)})),a()}),x&&!b&&P.observe(x),P.observe(n));let F,z=b?jm(i):null;b&&V();function V(){const W=jm(i);z&&!ZK(z,W)&&a(),z=W,F=requestAnimationFrame(V)}return a(),()=>{var W;T.forEach(te=>{u&&te.removeEventListener("scroll",a),m&&te.removeEventListener("resize",a)}),N==null||N(),(W=P)==null||W.disconnect(),P=null,b&&cancelAnimationFrame(F)}}const fme=Ufe,mme=Ffe,gme=jfe,_me=Bfe,yme=Lfe,sq=Dfe,vme=Vfe,Eme=(i,n,a)=>{const l=new Map,u={platform:ume,...a},m={...u.platform,_c:l};return Pfe(i,n,{...u,platform:m})};var wme=typeof document<"u",bme=function(){},KC=wme?M.useLayoutEffect:bme;function _R(i,n){if(i===n)return!0;if(typeof i!=typeof n)return!1;if(typeof i=="function"&&i.toString()===n.toString())return!0;let a,l,u;if(i&&n&&typeof i=="object"){if(Array.isArray(i)){if(a=i.length,a!==n.length)return!1;for(l=a;l--!==0;)if(!_R(i[l],n[l]))return!1;return!0}if(u=Object.keys(i),a=u.length,a!==Object.keys(n).length)return!1;for(l=a;l--!==0;)if(!{}.hasOwnProperty.call(n,u[l]))return!1;for(l=a;l--!==0;){const m=u[l];if(!(m==="_owner"&&i.$$typeof)&&!_R(i[m],n[m]))return!1}return!0}return i!==i&&n!==n}function ez(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function iq(i,n){const a=ez(i);return Math.round(n*a)/a}function Sk(i){const n=M.useRef(i);return KC(()=>{n.current=i}),n}function Sme(i){i===void 0&&(i={});const{placement:n="bottom",strategy:a="absolute",middleware:l=[],platform:u,elements:{reference:m,floating:y}={},transform:w=!0,whileElementsMounted:b,open:x}=i,[T,N]=M.useState({x:0,y:0,strategy:a,placement:n,middlewareData:{},isPositioned:!1}),[O,P]=M.useState(l);_R(O,l)||P(l);const[F,z]=M.useState(null),[V,W]=M.useState(null),te=M.useCallback(Ee=>{Ee!==se.current&&(se.current=Ee,z(Ee))},[]),$=M.useCallback(Ee=>{Ee!==ie.current&&(ie.current=Ee,W(Ee))},[]),Q=m||F,G=y||V,se=M.useRef(null),ie=M.useRef(null),ce=M.useRef(T),Se=b!=null,oe=Sk(b),ve=Sk(u),he=Sk(x),Ze=M.useCallback(()=>{if(!se.current||!ie.current)return;const Ee={placement:n,strategy:a,middleware:O};ve.current&&(Ee.platform=ve.current),Eme(se.current,ie.current,Ee).then(Oe=>{const we={...Oe,isPositioned:he.current!==!1};Qe.current&&!_R(ce.current,we)&&(ce.current=we,ED.flushSync(()=>{N(we)}))})},[O,n,a,ve,he]);KC(()=>{x===!1&&ce.current.isPositioned&&(ce.current.isPositioned=!1,N(Ee=>({...Ee,isPositioned:!1})))},[x]);const Qe=M.useRef(!1);KC(()=>(Qe.current=!0,()=>{Qe.current=!1}),[]),KC(()=>{if(Q&&(se.current=Q),G&&(ie.current=G),Q&&G){if(oe.current)return oe.current(Q,G,Ze);Ze()}},[Q,G,Ze,oe,Se]);const me=M.useMemo(()=>({reference:se,floating:ie,setReference:te,setFloating:$}),[te,$]),ye=M.useMemo(()=>({reference:Q,floating:G}),[Q,G]),ge=M.useMemo(()=>{const Ee={position:a,left:0,top:0};if(!ye.floating)return Ee;const Oe=iq(ye.floating,T.x),we=iq(ye.floating,T.y);return w?{...Ee,transform:"translate("+Oe+"px, "+we+"px)",...ez(ye.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:Oe,top:we}},[a,w,ye.floating,T.x,T.y]);return M.useMemo(()=>({...T,update:Ze,refs:me,elements:ye,floatingStyles:ge}),[T,Ze,me,ye,ge])}const xme=i=>{function n(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:i,fn(a){const{element:l,padding:u}=typeof i=="function"?i(a):i;return l&&n(l)?l.current!=null?sq({element:l.current,padding:u}).fn(a):{}:l?sq({element:l,padding:u}).fn(a):{}}}},Tme=(i,n)=>({...fme(i),options:[i,n]}),Cme=(i,n)=>({...mme(i),options:[i,n]}),Rme=(i,n)=>({...vme(i),options:[i,n]}),Nme=(i,n)=>({...gme(i),options:[i,n]}),Ame=(i,n)=>({..._me(i),options:[i,n]}),Ime=(i,n)=>({...yme(i),options:[i,n]}),Ome=(i,n)=>({...xme(i),options:[i,n]});var kme="Arrow",tz=M.forwardRef((i,n)=>{const{children:a,width:l=10,height:u=5,...m}=i;return o.jsx(Vm.svg,{...m,ref:n,width:l,height:u,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?a:o.jsx("polygon",{points:"0,0 30,0 15,10"})})});tz.displayName=kme;var Pme=tz;function Dme(i){const[n,a]=M.useState(void 0);return Dm(()=>{if(i){a({width:i.offsetWidth,height:i.offsetHeight});const l=new ResizeObserver(u=>{if(!Array.isArray(u)||!u.length)return;const m=u[0];let y,w;if("borderBoxSize"in m){const b=m.borderBoxSize,x=Array.isArray(b)?b[0]:b;y=x.inlineSize,w=x.blockSize}else y=i.offsetWidth,w=i.offsetHeight;a({width:y,height:w})});return l.observe(i,{box:"border-box"}),()=>l.unobserve(i)}else a(void 0)},[i]),n}var BD="Popper",[rz,nz]=VK(BD),[jme,sz]=rz(BD),iz=i=>{const{__scopePopper:n,children:a}=i,[l,u]=M.useState(null);return o.jsx(jme,{scope:n,anchor:l,onAnchorChange:u,children:a})};iz.displayName=BD;var az="PopperAnchor",oz=M.forwardRef((i,n)=>{const{__scopePopper:a,virtualRef:l,...u}=i,m=sz(az,a),y=M.useRef(null),w=Fm(n,y),b=M.useRef(null);return M.useEffect(()=>{const x=b.current;b.current=(l==null?void 0:l.current)||y.current,x!==b.current&&m.onAnchorChange(b.current)}),l?null:o.jsx(Vm.div,{...u,ref:w})});oz.displayName=az;var WD="PopperContent",[Lme,Mme]=rz(WD),cz=M.forwardRef((i,n)=>{var vt,pt,er,gt,qe,Wr;const{__scopePopper:a,side:l="bottom",sideOffset:u=0,align:m="center",alignOffset:y=0,arrowPadding:w=0,avoidCollisions:b=!0,collisionBoundary:x=[],collisionPadding:T=0,sticky:N="partial",hideWhenDetached:O=!1,updatePositionStrategy:P="optimized",onPlaced:F,...z}=i,V=sz(WD,a),[W,te]=M.useState(null),$=Fm(n,en=>te(en)),[Q,G]=M.useState(null),se=Dme(Q),ie=(se==null?void 0:se.width)??0,ce=(se==null?void 0:se.height)??0,Se=l+(m!=="center"?"-"+m:""),oe=typeof T=="number"?T:{top:0,right:0,bottom:0,left:0,...T},ve=Array.isArray(x)?x:[x],he=ve.length>0,Ze={padding:oe,boundary:ve.filter(Fme),altBoundary:he},{refs:Qe,floatingStyles:me,placement:ye,isPositioned:ge,middlewareData:Ee}=Sme({strategy:"fixed",placement:Se,whileElementsMounted:(...en)=>pme(...en,{animationFrame:P==="always"}),elements:{reference:V.anchor},middleware:[Tme({mainAxis:u+ce,alignmentAxis:y}),b&&Cme({mainAxis:!0,crossAxis:!1,limiter:N==="partial"?Rme():void 0,...Ze}),b&&Nme({...Ze}),Ame({...Ze,apply:({elements:en,rects:Cn,availableWidth:Lr,availableHeight:Le})=>{const{width:it,height:jt}=Cn.reference,xt=en.floating.style;xt.setProperty("--radix-popper-available-width",`${Lr}px`),xt.setProperty("--radix-popper-available-height",`${Le}px`),xt.setProperty("--radix-popper-anchor-width",`${it}px`),xt.setProperty("--radix-popper-anchor-height",`${jt}px`)}}),Q&&Ome({element:Q,padding:w}),Vme({arrowWidth:ie,arrowHeight:ce}),O&&Ime({strategy:"referenceHidden",...Ze})]}),[Oe,we]=uz(ye),fe=kR(F);Dm(()=>{ge&&(fe==null||fe())},[ge,fe]);const De=(vt=Ee.arrow)==null?void 0:vt.x,je=(pt=Ee.arrow)==null?void 0:pt.y,_e=((er=Ee.arrow)==null?void 0:er.centerOffset)!==0,[Je,st]=M.useState();return Dm(()=>{W&&st(window.getComputedStyle(W).zIndex)},[W]),o.jsx("div",{ref:Qe.setFloating,"data-radix-popper-content-wrapper":"",style:{...me,transform:ge?me.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Je,"--radix-popper-transform-origin":[(gt=Ee.transformOrigin)==null?void 0:gt.x,(qe=Ee.transformOrigin)==null?void 0:qe.y].join(" "),...((Wr=Ee.hide)==null?void 0:Wr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:o.jsx(Lme,{scope:a,placedSide:Oe,onArrowChange:G,arrowX:De,arrowY:je,shouldHideArrow:_e,children:o.jsx(Vm.div,{"data-side":Oe,"data-align":we,...z,ref:$,style:{...z.style,animation:ge?void 0:"none"}})})})});cz.displayName=WD;var lz="PopperArrow",Ume={top:"bottom",right:"left",bottom:"top",left:"right"},dz=M.forwardRef(function(n,a){const{__scopePopper:l,...u}=n,m=Mme(lz,l),y=Ume[m.placedSide];return o.jsx("span",{ref:m.onArrowChange,style:{position:"absolute",left:m.arrowX,top:m.arrowY,[y]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[m.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[m.placedSide],visibility:m.shouldHideArrow?"hidden":void 0},children:o.jsx(Pme,{...u,ref:a,style:{...u.style,display:"block"}})})});dz.displayName=lz;function Fme(i){return i!==null}var Vme=i=>({name:"transformOrigin",options:i,fn(n){var V,W,te;const{placement:a,rects:l,middlewareData:u}=n,y=((V=u.arrow)==null?void 0:V.centerOffset)!==0,w=y?0:i.arrowWidth,b=y?0:i.arrowHeight,[x,T]=uz(a),N={start:"0%",center:"50%",end:"100%"}[T],O=(((W=u.arrow)==null?void 0:W.x)??0)+w/2,P=(((te=u.arrow)==null?void 0:te.y)??0)+b/2;let F="",z="";return x==="bottom"?(F=y?N:`${O}px`,z=`${-b}px`):x==="top"?(F=y?N:`${O}px`,z=`${l.floating.height+b}px`):x==="right"?(F=`${-b}px`,z=y?N:`${P}px`):x==="left"&&(F=`${l.floating.width+b}px`,z=y?N:`${P}px`),{data:{x:F,y:z}}}});function uz(i){const[n,a="center"]=i.split("-");return[n,a]}var Bme=iz,Wme=oz,qme=cz,Gme=dz;function Hme(i,n){return M.useReducer((a,l)=>n[a][l]??a,i)}var hz=i=>{const{present:n,children:a}=i,l=Kme(n),u=typeof a=="function"?a({present:l.isPresent}):M.Children.only(a),m=Fm(l.ref,zme(u));return typeof a=="function"||l.isPresent?M.cloneElement(u,{ref:m}):null};hz.displayName="Presence";function Kme(i){const[n,a]=M.useState(),l=M.useRef(null),u=M.useRef(i),m=M.useRef("none"),y=i?"mounted":"unmounted",[w,b]=Hme(y,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return M.useEffect(()=>{const x=PC(l.current);m.current=w==="mounted"?x:"none"},[w]),Dm(()=>{const x=l.current,T=u.current;if(T!==i){const O=m.current,P=PC(x);i?b("MOUNT"):P==="none"||(x==null?void 0:x.display)==="none"?b("UNMOUNT"):b(T&&O!==P?"ANIMATION_OUT":"UNMOUNT"),u.current=i}},[i,b]),Dm(()=>{if(n){let x;const T=n.ownerDocument.defaultView??window,N=P=>{const z=PC(l.current).includes(CSS.escape(P.animationName));if(P.target===n&&z&&(b("ANIMATION_END"),!u.current)){const V=n.style.animationFillMode;n.style.animationFillMode="forwards",x=T.setTimeout(()=>{n.style.animationFillMode==="forwards"&&(n.style.animationFillMode=V)})}},O=P=>{P.target===n&&(m.current=PC(l.current))};return n.addEventListener("animationstart",O),n.addEventListener("animationcancel",N),n.addEventListener("animationend",N),()=>{T.clearTimeout(x),n.removeEventListener("animationstart",O),n.removeEventListener("animationcancel",N),n.removeEventListener("animationend",N)}}else b("ANIMATION_END")},[n,b]),{isPresent:["mounted","unmountSuspended"].includes(w),ref:M.useCallback(x=>{l.current=x?getComputedStyle(x):null,a(x)},[])}}function PC(i){return(i==null?void 0:i.animationName)||"none"}function zme(i){var l,u;let n=(l=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:l.get,a=n&&"isReactWarning"in n&&n.isReactWarning;return a?i.ref:(n=(u=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:u.get,a=n&&"isReactWarning"in n&&n.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}var $me=Symbol("radix.slottable");function Yme(i){const n=({children:a})=>o.jsx(o.Fragment,{children:a});return n.displayName=`${i}.Slottable`,n.__radixId=$me,n}var Xme=YG[" useInsertionEffect ".trim().toString()]||Dm;function Jme({prop:i,defaultProp:n,onChange:a=()=>{},caller:l}){const[u,m,y]=Qme({defaultProp:n,onChange:a}),w=i!==void 0,b=w?i:u;{const T=M.useRef(i!==void 0);M.useEffect(()=>{const N=T.current;N!==w&&console.warn(`${l} is changing from ${N?"controlled":"uncontrolled"} to ${w?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),T.current=w},[w,l])}const x=M.useCallback(T=>{var N;if(w){const O=Zme(T)?T(i):T;O!==i&&((N=y.current)==null||N.call(y,O))}else m(T)},[w,i,m,y]);return[b,x]}function Qme({defaultProp:i,onChange:n}){const[a,l]=M.useState(i),u=M.useRef(a),m=M.useRef(n);return Xme(()=>{m.current=n},[n]),M.useEffect(()=>{var y;u.current!==a&&((y=m.current)==null||y.call(m,a),u.current=a)},[a,u]),[a,l,m]}function Zme(i){return typeof i=="function"}var ege=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),tge="VisuallyHidden",pz=M.forwardRef((i,n)=>o.jsx(Vm.span,{...i,ref:n,style:{...ege,...i.style}}));pz.displayName=tge;var rge=pz,[MR]=VK("Tooltip",[nz]),UR=nz(),fz="TooltipProvider",nge=700,IP="tooltip.open",[sge,qD]=MR(fz),mz=i=>{const{__scopeTooltip:n,delayDuration:a=nge,skipDelayDuration:l=300,disableHoverableContent:u=!1,children:m}=i,y=M.useRef(!0),w=M.useRef(!1),b=M.useRef(0);return M.useEffect(()=>{const x=b.current;return()=>window.clearTimeout(x)},[]),o.jsx(sge,{scope:n,isOpenDelayedRef:y,delayDuration:a,onOpen:M.useCallback(()=>{window.clearTimeout(b.current),y.current=!1},[]),onClose:M.useCallback(()=>{window.clearTimeout(b.current),b.current=window.setTimeout(()=>y.current=!0,l)},[l]),isPointerInTransitRef:w,onPointerInTransitChange:M.useCallback(x=>{w.current=x},[]),disableHoverableContent:u,children:m})};mz.displayName=fz;var Fw="Tooltip",[ige,FR]=MR(Fw),gz=i=>{const{__scopeTooltip:n,children:a,open:l,defaultOpen:u,onOpenChange:m,disableHoverableContent:y,delayDuration:w}=i,b=qD(Fw,i.__scopeTooltip),x=UR(n),[T,N]=M.useState(null),O=wfe(),P=M.useRef(0),F=y??b.disableHoverableContent,z=w??b.delayDuration,V=M.useRef(!1),[W,te]=Jme({prop:l,defaultProp:u??!1,onChange:ie=>{ie?(b.onOpen(),document.dispatchEvent(new CustomEvent(IP))):b.onClose(),m==null||m(ie)},caller:Fw}),$=M.useMemo(()=>W?V.current?"delayed-open":"instant-open":"closed",[W]),Q=M.useCallback(()=>{window.clearTimeout(P.current),P.current=0,V.current=!1,te(!0)},[te]),G=M.useCallback(()=>{window.clearTimeout(P.current),P.current=0,te(!1)},[te]),se=M.useCallback(()=>{window.clearTimeout(P.current),P.current=window.setTimeout(()=>{V.current=!0,te(!0),P.current=0},z)},[z,te]);return M.useEffect(()=>()=>{P.current&&(window.clearTimeout(P.current),P.current=0)},[]),o.jsx(Bme,{...x,children:o.jsx(ige,{scope:n,contentId:O,open:W,stateAttribute:$,trigger:T,onTriggerChange:N,onTriggerEnter:M.useCallback(()=>{b.isOpenDelayedRef.current?se():Q()},[b.isOpenDelayedRef,se,Q]),onTriggerLeave:M.useCallback(()=>{F?G():(window.clearTimeout(P.current),P.current=0)},[G,F]),onOpen:Q,onClose:G,disableHoverableContent:F,children:a})})};gz.displayName=Fw;var OP="TooltipTrigger",_z=M.forwardRef((i,n)=>{const{__scopeTooltip:a,...l}=i,u=FR(OP,a),m=qD(OP,a),y=UR(a),w=M.useRef(null),b=Fm(n,w,u.onTriggerChange),x=M.useRef(!1),T=M.useRef(!1),N=M.useCallback(()=>x.current=!1,[]);return M.useEffect(()=>()=>document.removeEventListener("pointerup",N),[N]),o.jsx(Wme,{asChild:!0,...y,children:o.jsx(Vm.button,{"aria-describedby":u.open?u.contentId:void 0,"data-state":u.stateAttribute,...l,ref:b,onPointerMove:wu(i.onPointerMove,O=>{O.pointerType!=="touch"&&!T.current&&!m.isPointerInTransitRef.current&&(u.onTriggerEnter(),T.current=!0)}),onPointerLeave:wu(i.onPointerLeave,()=>{u.onTriggerLeave(),T.current=!1}),onPointerDown:wu(i.onPointerDown,()=>{u.open&&u.onClose(),x.current=!0,document.addEventListener("pointerup",N,{once:!0})}),onFocus:wu(i.onFocus,()=>{x.current||u.onOpen()}),onBlur:wu(i.onBlur,u.onClose),onClick:wu(i.onClick,u.onClose)})})});_z.displayName=OP;var age="TooltipPortal",[ySe,oge]=MR(age,{forceMount:void 0}),Vy="TooltipContent",yz=M.forwardRef((i,n)=>{const a=oge(Vy,i.__scopeTooltip),{forceMount:l=a.forceMount,side:u="top",...m}=i,y=FR(Vy,i.__scopeTooltip);return o.jsx(hz,{present:l||y.open,children:y.disableHoverableContent?o.jsx(vz,{side:u,...m,ref:n}):o.jsx(cge,{side:u,...m,ref:n})})}),cge=M.forwardRef((i,n)=>{const a=FR(Vy,i.__scopeTooltip),l=qD(Vy,i.__scopeTooltip),u=M.useRef(null),m=Fm(n,u),[y,w]=M.useState(null),{trigger:b,onClose:x}=a,T=u.current,{onPointerInTransitChange:N}=l,O=M.useCallback(()=>{w(null),N(!1)},[N]),P=M.useCallback((F,z)=>{const V=F.currentTarget,W={x:F.clientX,y:F.clientY},te=pge(W,V.getBoundingClientRect()),$=fge(W,te),Q=mge(z.getBoundingClientRect()),G=_ge([...$,...Q]);w(G),N(!0)},[N]);return M.useEffect(()=>()=>O(),[O]),M.useEffect(()=>{if(b&&T){const F=V=>P(V,T),z=V=>P(V,b);return b.addEventListener("pointerleave",F),T.addEventListener("pointerleave",z),()=>{b.removeEventListener("pointerleave",F),T.removeEventListener("pointerleave",z)}}},[b,T,P,O]),M.useEffect(()=>{if(y){const F=z=>{const V=z.target,W={x:z.clientX,y:z.clientY},te=(b==null?void 0:b.contains(V))||(T==null?void 0:T.contains(V)),$=!gge(W,y);te?O():$&&(O(),x())};return document.addEventListener("pointermove",F),()=>document.removeEventListener("pointermove",F)}},[b,T,y,x,O]),o.jsx(vz,{...i,ref:m})}),[lge,dge]=MR(Fw,{isInside:!1}),uge=Yme("TooltipContent"),vz=M.forwardRef((i,n)=>{const{__scopeTooltip:a,children:l,"aria-label":u,onEscapeKeyDown:m,onPointerDownOutside:y,...w}=i,b=FR(Vy,a),x=UR(a),{onClose:T}=b;return M.useEffect(()=>(document.addEventListener(IP,T),()=>document.removeEventListener(IP,T)),[T]),M.useEffect(()=>{if(b.trigger){const N=O=>{const P=O.target;P!=null&&P.contains(b.trigger)&&T()};return window.addEventListener("scroll",N,{capture:!0}),()=>window.removeEventListener("scroll",N,{capture:!0})}},[b.trigger,T]),o.jsx(WK,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:m,onPointerDownOutside:y,onFocusOutside:N=>N.preventDefault(),onDismiss:T,children:o.jsxs(qme,{"data-state":b.stateAttribute,...x,...w,ref:n,style:{...w.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[o.jsx(uge,{children:l}),o.jsx(lge,{scope:a,isInside:!0,children:o.jsx(rge,{id:b.contentId,role:"tooltip",children:u||l})})]})})});yz.displayName=Vy;var Ez="TooltipArrow",hge=M.forwardRef((i,n)=>{const{__scopeTooltip:a,...l}=i,u=UR(a);return dge(Ez,a).isInside?null:o.jsx(Gme,{...u,...l,ref:n})});hge.displayName=Ez;function pge(i,n){const a=Math.abs(n.top-i.y),l=Math.abs(n.bottom-i.y),u=Math.abs(n.right-i.x),m=Math.abs(n.left-i.x);switch(Math.min(a,l,u,m)){case m:return"left";case u:return"right";case a:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function fge(i,n,a=5){const l=[];switch(n){case"top":l.push({x:i.x-a,y:i.y+a},{x:i.x+a,y:i.y+a});break;case"bottom":l.push({x:i.x-a,y:i.y-a},{x:i.x+a,y:i.y-a});break;case"left":l.push({x:i.x+a,y:i.y-a},{x:i.x+a,y:i.y+a});break;case"right":l.push({x:i.x-a,y:i.y-a},{x:i.x-a,y:i.y+a});break}return l}function mge(i){const{top:n,right:a,bottom:l,left:u}=i;return[{x:u,y:n},{x:a,y:n},{x:a,y:l},{x:u,y:l}]}function gge(i,n){const{x:a,y:l}=i;let u=!1;for(let m=0,y=n.length-1;m<n.length;y=m++){const w=n[m],b=n[y],x=w.x,T=w.y,N=b.x,O=b.y;T>l!=O>l&&a<(N-x)*(l-T)/(O-T)+x&&(u=!u)}return u}function _ge(i){const n=i.slice();return n.sort((a,l)=>a.x<l.x?-1:a.x>l.x?1:a.y<l.y?-1:a.y>l.y?1:0),yge(n)}function yge(i){if(i.length<=1)return i.slice();const n=[];for(let l=0;l<i.length;l++){const u=i[l];for(;n.length>=2;){const m=n[n.length-1],y=n[n.length-2];if((m.x-y.x)*(u.y-y.y)>=(m.y-y.y)*(u.x-y.x))n.pop();else break}n.push(u)}n.pop();const a=[];for(let l=i.length-1;l>=0;l--){const u=i[l];for(;a.length>=2;){const m=a[a.length-1],y=a[a.length-2];if((m.x-y.x)*(u.y-y.y)>=(m.y-y.y)*(u.x-y.x))a.pop();else break}a.push(u)}return a.pop(),n.length===1&&a.length===1&&n[0].x===a[0].x&&n[0].y===a[0].y?n:n.concat(a)}var vge=mz,Ege=gz,wge=_z,wz=yz;function bz(...i){return i.filter(Boolean).join(" ")}function aq(i,n="USD"){try{const a=Number(i)||0;return new Intl.NumberFormat(void 0,{style:"currency",currency:n}).format(a)}catch{return`$${Number(i)||0}`}}const bge=vge,Sge=Ege,xge=wge,Sz=M.forwardRef(({className:i,sideOffset:n=4,...a},l)=>o.jsx(wz,{ref:l,sideOffset:n,className:bz("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...a}));Sz.displayName=wz.displayName;const VR=({badges:i=[],size:n="sm"})=>{if(!i||i.length===0)return null;const a={OG:{name:"OG",color:"bg-gradient-to-r from-yellow-400 to-orange-500",icon:"",tooltip:"Original Gangster - Joined before Dec 31, 2025"},TROLL_OFFICER:{name:"Troll Officer",color:"bg-gradient-to-r from-blue-500 to-purple-600",icon:"",tooltip:"Troll Officer - Community Moderator"},VIP:{name:"VIP",color:"bg-gradient-to-r from-purple-500 to-pink-500",icon:"",tooltip:"Very Important Player"},STREAMER:{name:"Streamer",color:"bg-gradient-to-r from-red-500 to-pink-500",icon:"",tooltip:"Content Creator"}},l={sm:"px-2 py-1 text-xs",md:"px-3 py-1.5 text-sm",lg:"px-4 py-2 text-base"};return o.jsx(bge,{children:o.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(u=>{const m=a[u]||{name:u,color:"bg-gray-600",icon:"",tooltip:u};return o.jsxs(Sge,{children:[o.jsx(xge,{asChild:!0,children:o.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full ${m.color} text-white font-semibold ${l[n]} cursor-pointer hover:scale-105 transition-transform`,children:[o.jsx("span",{children:m.icon}),o.jsx("span",{children:m.name})]})}),o.jsx(Sz,{children:o.jsx("p",{children:m.tooltip})})]},u)})})})};function Tge({user:i}){var ce,Se,oe,ve,he,Ze,Qe,me;const n=Pc(),{openMobile:a,setOpenMobile:l}=MH(),[u,m]=M.useState({main:!0,discover:!0,monetization:!0,profile:!0,admin:!0});M.useEffect(()=>{i&&console.log(" Layout User Debug:",{role:i.role,is_admin:i.is_admin,username:i.username,full_name:i.full_name,user_metadata:i.user_metadata,raw_user:i,pathname:n.pathname,homePath:Or("Home"),isHomePage:n.pathname===Or("Home"),shouldShowSidebar:i&&i.id})},[i,n.pathname]);const[y,w]=M.useState(null),b=vn(),{data:x=0}=mt({queryKey:["unreadNotifications",i==null?void 0:i.id],queryFn:async()=>{if(!i)return 0;const{data:ye=[],error:ge}=await K.from("notifications").select("id, is_read, created_at").eq("user_id",i.id).eq("is_read",!1);return ge?0:ye.length||0},enabled:!!i,refetchInterval:3e4,initialData:0,staleTime:2e4,refetchOnWindowFocus:!1});M.useEffect(()=>{if(!i)return;const ye=K.channel(`notifications:${i.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"notifications",filter:`user_id=eq.${i.id}`},ge=>{b.invalidateQueries({queryKey:["unreadNotifications",i.id]})}).subscribe();return()=>{ye.unsubscribe()}},[i==null?void 0:i.id,b]);const{data:T=0}=mt({queryKey:["unreadMessages",i==null?void 0:i.id],queryFn:async()=>{if(!i)return 0;const{data:ye=[],error:ge}=await K.from("conversations").select("unread_count_p1, unread_count_p2, participant1_id, participant2_id").or(`participant1_id.eq.${i.id},participant2_id.eq.${i.id}`);return ge?0:ye.reduce((Oe,we)=>we.participant1_id===i.id?Oe+(we.unread_count_p1||0):Oe+(we.unread_count_p2||0),0)},enabled:!!i,refetchInterval:3e4,initialData:0,staleTime:2e4,retry:!1,refetchOnWindowFocus:!1}),{data:N=[]}=mt({queryKey:["recentGifts",i==null?void 0:i.id],queryFn:async()=>{if(!i)return[];try{const{data:ye=[],error:ge}=await K.from("stream_gifts").select("*").eq("recipient_id",i.id).order("created_date",{ascending:!1}).limit(3);return ge?[]:ye}catch{return[]}},enabled:!!i,refetchInterval:3e4,initialData:[],staleTime:2e4,retry:!1,refetchOnWindowFocus:!1}),{data:O=!1}=mt({queryKey:["isTrollFamily",i==null?void 0:i.id],queryFn:async()=>{if(!(i!=null&&i.id))return!1;const{data:ye,error:ge}=await K.from("profiles").select("is_troll_family").eq("id",i.id).single();return ge?!1:(ye==null?void 0:ye.is_troll_family)||!1},enabled:!!(i!=null&&i.id),staleTime:6e4,refetchOnWindowFocus:!1});M.useEffect(()=>{if(N.length>0){const ye=N[0];(!y||ye.id!==y.id)&&(w(ye),Npe.success(` ${ye.sender_name} sent you ${ye.gift_emoji} ${ye.gift_name}!`,{duration:5e3}),b.invalidateQueries(["currentUser"]),b.refetchQueries(["currentUser"],{force:!0}))}},[N,y,b]);const P=()=>{l(!1)},F=ye=>{m(ge=>({...ge,[ye]:!ge[ye]}))},z=ye=>ye>=1&&ye<=9?{tier:1,color:"from-gray-500 to-slate-500"}:ye>=10&&ye<=19?{tier:2,color:"from-blue-500 to-cyan-500"}:ye>=20&&ye<=29?{tier:3,color:"from-purple-500 to-pink-500"}:ye>=30?{tier:4,color:"from-yellow-500 to-orange-500"}:{tier:1,color:"from-gray-500 to-slate-500"},V=(i==null?void 0:i.level)||1,W=z(V),te=[{title:"Home",url:Or("Home"),icon:IH},{title:"Following",url:Or("Following"),icon:Ru},{title:"Messages",url:Or("Messages"),icon:Um,badge:T},{title:"Notifications",url:Or("Notifications"),icon:Am,badge:x}],$=[{title:"Trending",url:Or("Trending"),icon:kw}],Q=[{title:"Store",url:Or("Store"),icon:lW},{title:"Earnings",url:Or("Earnings"),icon:Es}],G=[{title:"My Profile",url:Or("Profile"),icon:Pa}],se=[{title:"Admin Dashboard",url:Or("Admin"),icon:xi},{title:"Troll Family Lounge",url:"/TFam",icon:jn},...O?[]:[{title:"Troll Family App",url:Or("TrollFamilyApplication"),icon:jn}]],ie=ye=>ye.map(ge=>o.jsx(pde,{className:"mb-1",children:o.jsx(fde,{asChild:!0,className:`hover:bg-purple-500/20 transition-all duration-200 rounded-xl ${n.pathname===ge.url?"bg-purple-500/30 text-white":"bg-black text-gray-300 hover:text-white"}`,children:o.jsxs(gy,{to:ge.url,onClick:Ee=>{P(),ge.title==="Notifications"&&(console.log(" Immediately clearing notification count from",x,"to 0"),b.setQueryData(["unreadNotifications",i==null?void 0:i.id],0),b.invalidateQueries({queryKey:["unreadNotifications",i==null?void 0:i.id]}))},className:"flex items-center gap-3 px-4 py-3 relative",children:[o.jsx(ge.icon,{className:"w-5 h-5"}),o.jsx("span",{className:"font-medium",children:ge.title}),ge.badge>0&&o.jsx(wt,{className:"ml-auto bg-red-500 text-white h-5 min-w-[20px] flex items-center justify-center px-1.5",children:ge.badge>99?"99+":ge.badge})]})})},ge.title));return o.jsxs(o.Fragment,{children:[a&&o.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 md:hidden",onClick:()=>l(!1)}),o.jsxs(lde,{"data-sidebar":!0,className:`border-r w-64 md:w-72 shrink-0 ${a?"fixed z-50 inset-y-0 left-0 md:static md:block":"hidden md:block"}`,children:[o.jsx(dde,{className:"border-b p-6",style:{borderColor:"var(--border)"},children:o.jsxs("div",{className:"flex flex-col gap-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center shadow-lg shadow-emerald-500/30",children:o.jsx("span",{className:"text-xl font-bold text-white",children:"T"})}),o.jsx("div",{className:"flex flex-col",children:o.jsxs("span",{className:"font-bold text-lg",children:[o.jsx("span",{className:"text-emerald-400",children:"Troll"}),o.jsx("span",{className:"text-cyan-400",children:"City"})]})})]}),o.jsx(gy,{to:Or("GoLive"),onClick:P,children:o.jsxs(ke,{className:"w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600",children:[o.jsx(Si,{className:"w-4 h-4 mr-2"}),"Go Live"]})})]})}),o.jsxs(hde,{className:"p-3",children:[o.jsx(Sc,{open:u.main,onOpenChange:()=>F("main"),children:o.jsxs(em,{children:[o.jsx(xc,{className:"w-full",children:o.jsxs(iw,{className:"flex items-center justify-between text-gray-400 hover:text-white cursor-pointer px-2 py-2",children:[o.jsx("span",{className:"text-sm font-semibold",children:"Main"}),o.jsx(bc,{className:`w-4 h-4 transition-transform ${u.main?"rotate-180":""}`})]})}),o.jsx(Tc,{children:o.jsx(aw,{children:o.jsx(ow,{children:ie(te)})})})]})}),o.jsx(Sc,{open:u.discover,onOpenChange:()=>F("discover"),children:o.jsxs(em,{children:[o.jsx(xc,{className:"w-full",children:o.jsxs(iw,{className:"flex items-center justify-between text-gray-400 hover:text-white cursor-pointer px-2 py-2",children:[o.jsx("span",{className:"text-sm font-semibold",children:"Discover"}),o.jsx(bc,{className:`w-4 h-4 transition-transform ${u.discover?"rotate-180":""}`})]})}),o.jsx(Tc,{children:o.jsx(aw,{children:o.jsx(ow,{children:ie($)})})})]})}),o.jsx(Sc,{open:u.monetization,onOpenChange:()=>F("monetization"),children:o.jsxs(em,{children:[o.jsx(xc,{className:"w-full",children:o.jsxs(iw,{className:"flex items-center justify-between text-gray-400 hover:text-white cursor-pointer px-2 py-2",children:[o.jsx("span",{className:"text-sm font-semibold",children:"Earn"}),o.jsx(bc,{className:`w-4 h-4 transition-transform ${u.monetization?"rotate-180":""}`})]})}),o.jsx(Tc,{children:o.jsx(aw,{children:o.jsx(ow,{children:ie(Q)})})})]})}),o.jsx(Sc,{open:u.profile,onOpenChange:()=>F("profile"),children:o.jsxs(em,{children:[o.jsx(xc,{className:"w-full",children:o.jsxs(iw,{className:"flex items-center justify-between text-gray-400 hover:text-white cursor-pointer px-2 py-2",children:[o.jsx("span",{className:"text-sm font-semibold",children:"Profile & Settings"}),o.jsx(bc,{className:`w-4 h-4 transition-transform ${u.profile?"rotate-180":""}`})]})}),o.jsx(Tc,{children:o.jsx(aw,{children:o.jsx(ow,{children:ie(G)})})})]})}),o.jsx(Sc,{open:u.admin,onOpenChange:()=>F("admin"),children:o.jsxs(em,{children:[o.jsx(xc,{className:"w-full",children:o.jsxs(iw,{className:"flex items-center justify-between text-gray-400 hover:text-white cursor-pointer px-2 py-2",children:[o.jsx("span",{className:"text-sm font-semibold",children:i&&(i.role==="admin"||i.is_admin||((ce=i.user_metadata)==null?void 0:ce.role)==="admin")?"Admin":"Opportunities"}),o.jsx(bc,{className:`w-4 h-4 transition-transform ${u.admin?"rotate-180":""}`})]})}),o.jsx(Tc,{children:o.jsx(aw,{children:o.jsx(ow,{children:i&&(i.role==="admin"||i.is_admin||((Se=i.user_metadata)==null?void 0:Se.role)==="admin")?ie(se):ie(se.filter(ye=>ye.title.includes("App")||ye.title.includes("Banned Users")))})})})]})}),i&&o.jsxs(o.Fragment,{children:[o.jsx(em,{className:"mt-4",children:o.jsx(gy,{to:Or("Store"),onClick:P,children:o.jsxs("div",{className:"px-4 py-3 rounded-xl cursor-pointer hover:bg-yellow-500/10 transition-all",style:{background:"rgba(234, 179, 8, 0.1)"},children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-sm text-gray-400",children:"My Coins"}),o.jsx(ni,{className:"w-4 h-4 text-yellow-400"})]}),o.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:(i.coins||0).toLocaleString()}),o.jsxs("div",{className:"text-xs text-yellow-600 mt-1 flex items-center gap-1",children:[o.jsx(lW,{className:"w-3 h-3"}),"Buy More"]})]})})}),o.jsx(em,{className:"mt-4",children:o.jsxs("div",{className:"px-4 py-3 rounded-xl",style:{background:"rgba(168, 85, 247, 0.1)"},children:[o.jsx("div",{className:"flex items-center justify-between mb-2",children:o.jsx("span",{className:"text-sm text-gray-400",children:"Level & Tier"})}),o.jsxs("div",{children:[o.jsx("div",{className:`text-2xl font-bold bg-gradient-to-r ${W.color} bg-clip-text text-transparent`,children:V}),o.jsxs(wt,{className:`bg-gradient-to-r ${W.color} border-0 text-white text-xs`,children:["Tier ",W.tier]})]})]})})]})]}),o.jsx(ude,{className:"border-t p-4",style:{borderColor:"var(--border)"},children:i?o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.avatar?o.jsx("img",{src:i.avatar,alt:i.username||i.full_name,className:"w-10 h-10 rounded-full object-cover"}):o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold text-sm",children:((ve=(oe=i.username||i.full_name)==null?void 0:oe[0])==null?void 0:ve.toUpperCase())||"U"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("p",{className:"font-medium text-sm truncate text-gray-200",children:["@",i.username||((he=i.user_metadata)==null?void 0:he.user_name)||"NoUsername"]}),o.jsx(VR,{user:i,size:"sm"})]}),o.jsx("p",{className:"text-xs text-gray-400 truncate",children:i.email||((Ze=i.user_metadata)==null?void 0:Ze.email)||""}),o.jsxs("p",{className:"text-xs text-gray-400 truncate",children:["Level ",V,"  Status: ",i.is_banned?"Banned":i.role==="admin"||i.is_admin||((Qe=i.user_metadata)==null?void 0:Qe.role)==="admin"?"Admin":i.is_troll_officer||(me=i.user_metadata)!=null&&me.is_troll_officer?"Troll Officer":i.is_og?"OG":"Member"]})]})]}),o.jsx(ke,{onClick:()=>K.auth.signOut(),variant:"outline",className:"w-full border-red-500/50 text-red-400 hover:bg-red-500/10",size:"sm",children:"Logout"})]}):o.jsxs("div",{className:"flex items-center justify-between gap-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center shadow-lg shadow-emerald-500/30",children:o.jsx("span",{className:"text-xl font-bold text-white",children:"T"})}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("p",{className:"font-semibold text-sm text-white",children:"Welcome"}),o.jsx("p",{className:"text-xs text-gray-400",children:"Log in to personalize TrollCity"})]})]}),o.jsx(ke,{onClick:()=>K.auth.redirectToLogin(),size:"sm",className:"bg-emerald-500 hover:bg-emerald-600 text-black",children:"Login"})]})})]})]})}function Cge({children:i}){vn();const n=Wn(),a=Pc(),{data:l,isLoading:u}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:{user:w}}=await K.auth.getUser();if(!w)return null;const[{data:b},{data:x}]=await Promise.all([K.from("profiles").select("*").eq("id",w.id).single(),K.auth.me()]);return{...w,...x,...b}},retry:!1,refetchInterval:6e4,staleTime:3e4,refetchOnWindowFocus:!1}),{data:m}=mt({queryKey:["authSession"],queryFn:async()=>{const{data:w}=await K.auth.getUser();return(w==null?void 0:w.user)||null},retry:!1,staleTime:3e4,refetchOnWindowFocus:!1});M.useEffect(()=>{const w=async()=>{if(!l)return;const x=Or("PaymentRequired"),T=window.location.hash.replace("#/","");if(l.is_banned){T!=="PaymentRequired"&&n(x);return}if(l.is_kicked){T!=="PaymentRequired"&&n(x);return}try{(await K.entities.KickPayment.filter({user_id:l.id,payment_status:"pending"})).length>0&&T!=="PaymentRequired"&&n(x)}catch(N){console.warn("Kick status check skipped:",N.message)}};w();const b=setInterval(w,12e4);return()=>clearInterval(b)},[l,n]),M.useEffect(()=>{typeof navigator<"u"&&"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(()=>console.log(" PWA Service Worker registered")).catch(b=>console.warn(" Service Worker registration failed:",(b==null?void 0:b.message)||b))},[]);const y=l&&l.id||m&&m.id;return console.log(" Sidebar Visibility Debug:",{pathname:a.pathname,user:l?{id:l.id,username:l.username}:null,isLoggedIn:y}),o.jsxs(cde,{children:[o.jsx("style",{children:`
        :root {
          --background: #0a0a0f;
          --foreground: #f5f5f7;
          --primary: #ff0844;
          --primary-hover: #cc0636;
          --accent-cyan: #00ff88;
          --accent-pink: #ff0844;
          --card-bg: #1a0f14;
          --border: #3a1a24;
        }

        body {
          touch-action: pan-x pan-y;
          background: linear-gradient(135deg, #0a0a0f 0%, #1a0514 25%, #0f0a0f 50%, #14050f 75%, #0a0a0f 100%);
          background-attachment: fixed;
          color: var(--foreground);
          overscroll-behavior: none;
        }

        input, select, textarea, button {
          font-size: 16px !important;
        }

        html, body {
          width: 100%;
          overflow-x: hidden;
          overflow-y: auto;
        }

        @media (max-width: 768px) {
          .min-h-screen {
            min-height: 100vh;
            min-height: 100dvh;
          }
        }

        .neon-troll {
          color: #00ff88;
          text-shadow:
            0 0 10px #00ff88,
            0 0 20px #00ff88,
            0 0 30px #00ff88,
            0 0 40px #00ff88;
          animation: neon-pulse 2s ease-in-out infinite;
        }

        .neon-red {
          color: #ff0844;
          text-shadow:
            0 0 10px #ff0844,
            0 0 20px #ff0844,
            0 0 30px #ff0844,
            0 0 40px #ff0844;
          animation: neon-pulse 2s ease-in-out infinite;
        }

        @keyframes neon-pulse {
          0%, 100% {
            text-shadow:
              0 0 10px currentColor,
              0 0 20px currentColor,
              0 0 30px currentColor,
              0 0 40px currentColor;
          }
          50% {
            text-shadow:
              0 0 15px currentColor,
              0 0 30px currentColor,
              0 0 45px currentColor,
              0 0 60px currentColor,
              0 0 75px currentColor;
          }
        }

        .logo-glow {
          filter: drop-shadow(0 0 10px rgba(0, 255, 136, 0.7)) drop-shadow(0 0 20px rgba(255, 8, 68, 0.5));
        }

        .neon-border-green {
          border-color: #00ff88;
          box-shadow: 0 0 10px rgba(0, 255, 136, 0.5), inset 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .neon-border-red {
          border-color: #ff0844;
          box-shadow: 0 0 10px rgba(255, 8, 68, 0.5), inset 0 0 10px rgba(255, 8, 68, 0.2);
        }

        [data-sidebar] {
          background: linear-gradient(180deg, #1a0f14 0%, #0f0a0f 50%, #0a0f14 100%);
          border-right: 2px solid rgba(0, 255, 136, 0.3);
        }

        .bg-card {
          background: linear-gradient(135deg, rgba(26, 15, 20, 0.9) 0%, rgba(15, 10, 15, 0.9) 100%);
          border: 1px solid rgba(0, 255, 136, 0.2);
        }
      `}),o.jsxs("div",{className:"min-h-screen flex w-full",children:[y&&o.jsx(Tge,{user:l||m}),o.jsxs("main",{className:"flex-1 flex flex-col overflow-y-auto",children:[o.jsx("header",{className:"border-b px-6 py-4 md:hidden neon-border-green",style:{background:"linear-gradient(90deg, rgba(26, 15, 20, 0.95) 0%, rgba(15, 26, 15, 0.95) 100%)"},children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(mde,{className:"hover:bg-[#00ff88]/10 p-2 rounded-lg transition-colors duration-200"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 flex items-center justify-center shadow-lg shadow-emerald-500/30",children:o.jsx("span",{className:"text-lg font-bold text-white",children:"T"})}),o.jsxs("span",{className:"font-bold",children:[o.jsx("span",{className:"text-emerald-400",children:"Troll"}),o.jsx("span",{className:"text-cyan-400",children:"City"})]})]})]})}),o.jsx("div",{className:"flex-1",children:i}),o.jsx("footer",{className:"border-t px-6 py-4 text-center neon-border-red",style:{background:"linear-gradient(90deg, rgba(26, 15, 20, 0.95) 0%, rgba(26, 10, 15, 0.95) 100%)"},children:o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs("p",{className:"text-xs text-gray-400",children:[" ",new Date().getFullYear()," ",o.jsx("span",{className:"neon-troll font-semibold",children:"Troll"}),o.jsx("span",{className:"neon-red font-semibold",children:"City"}),". All Rights Reserved."]}),o.jsx("p",{className:"text-xs text-red-400 font-semibold",children:" Copyright Infringement is a Crime. Unauthorized use of content is strictly prohibited."}),o.jsx("p",{className:"text-xs text-gray-500",children:"All content on this platform is protected by copyright law."})]})})]})]}),o.jsx(tfe,{richColors:!0,theme:"dark",position:"top-right"}),o.jsx(Rpe,{position:"top-right"})]})}const Rge={"01-01":{name:"New Year's Day",theme:"new-year",colors:["#FFD700","#FF6B6B","#4ECDC4"]},"02-14":{name:"Valentine's Day",theme:"valentine",colors:["#FF6B6B","#FF8E8E","#FFB3B3"]},"03-17":{name:"St. Patrick's Day",theme:"st-patrick",colors:["#4CAF50","#8BC34A","#CDDC39"]},"04-01":{name:"April Fool's Day",theme:"april-fool",colors:["#FF9800","#FFC107","#FFEB3B"]},"05-01":{name:"May Day",theme:"may-day",colors:["#FF69B4","#FFB6C1","#FFC0CB"]},"06-19":{name:"Juneteenth",theme:"juneteenth",colors:["#000000","#FF0000","#00FF00"]},"07-04":{name:"Independence Day",theme:"independence",colors:["#B22222","#FFFFFF","#4169E1"]},"09-02":{name:"Labor Day",theme:"labor-day",colors:["#8B4513","#A0522D","#CD853F"]},"10-31":{name:"Halloween",theme:"halloween",colors:["#FF6B35","#1A1A1A","#8B4513"]},"11-11":{name:"Veterans Day",theme:"veterans",colors:["#B22222","#FFFFFF","#4169E1"]},"11-28":{name:"Thanksgiving",theme:"thanksgiving",colors:["#8B4513","#D2691E","#FF8C00"]},"12-25":{name:"Christmas",theme:"christmas",colors:["#DC143C","#228B22","#FFD700"]},"12-31":{name:"New Year's Eve",theme:"new-year-eve",colors:["#4B0082","#FFD700","#FF1493"]}},Nge=({children:i})=>{const[n,a]=M.useState(null),[l,u]=M.useState(!1),[m,y]=M.useState(!1);M.useEffect(()=>{const x=()=>{const N=new Date,O=(N.getMonth()+1).toString().padStart(2,"0"),P=N.getDate().toString().padStart(2,"0"),F=`${O}-${P}`,z=Rge[F];if(z){a(z);const V=`holiday_celebration_${F}`;!localStorage.getItem(V)&&!m&&(u(!0),y(!0),localStorage.setItem(V,"true"),setTimeout(()=>{u(!1)},5e3))}else a(null),y(!1)};x();const T=setInterval(x,36e5);return()=>clearInterval(T)},[m]);const w=()=>{if(!n)return{};const[x,T,N]=n.colors;return{"--holiday-primary":x,"--holiday-secondary":T,"--holiday-accent":N}},b=()=>n?`holiday-theme-${n.theme}`:"";return o.jsxs("div",{className:`holiday-theme-container ${b()}`,style:w(),children:[i,n&&o.jsx("div",{className:"holiday-indicator",children:o.jsxs("span",{className:"holiday-badge",children:[" ",n.name," "]})}),l&&n&&o.jsxs("div",{className:"holiday-celebration-overlay",onClick:()=>u(!1),children:[o.jsxs("div",{className:"holiday-celebration-content",onClick:x=>x.stopPropagation(),children:[o.jsxs("h2",{className:"holiday-title",children:[" Happy ",n.name,"! "]}),o.jsx("p",{className:"holiday-message",children:"Enjoy the special holiday theme!"}),o.jsx("button",{className:"holiday-close-btn",onClick:()=>u(!1),children:"Continue to App"})]}),o.jsx("div",{className:"holiday-particles",children:[...Array(30)].map((x,T)=>o.jsx("div",{className:"holiday-particle",style:{left:`${Math.random()*100}%`,animationDelay:`${Math.random()*3}s`,animationDuration:`${3+Math.random()*2}s`,backgroundColor:n.colors[Math.floor(Math.random()*n.colors.length)],width:`${8+Math.random()*12}px`,height:`${8+Math.random()*12}px`}},T))})]}),o.jsx("style",{jsx:!0,children:`
        .holiday-theme-container {
          position: relative;
          min-height: 100vh;
        }
        
        .holiday-celebration-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.8);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          animation: fadeIn 0.5s ease-in-out;
        }
        
        .holiday-celebration-content {
          text-align: center;
          background: linear-gradient(135deg, var(--holiday-primary), var(--holiday-secondary));
          padding: 2rem;
          border-radius: 1rem;
          box-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
          animation: celebrationPulse 2s ease-in-out infinite;
        }
        
        .holiday-title {
          color: white;
          font-size: 2rem;
          font-weight: bold;
          margin-bottom: 0.5rem;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .holiday-message {
          color: white;
          font-size: 1.2rem;
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .holiday-particles {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          pointer-events: none;
        }
        
        .holiday-particle {
          position: absolute;
          width: 10px;
          height: 10px;
          border-radius: 50%;
          animation: floatUp 5s ease-in-out infinite;
          opacity: 0;
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes celebrationPulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }
        
        @keyframes floatUp {
          0% {
            transform: translateY(100vh) scale(0);
            opacity: 0;
          }
          10% {
            opacity: 1;
          }
          90% {
            opacity: 1;
          }
          100% {
            transform: translateY(-100vh) scale(1.5);
            opacity: 0;
          }
        }
        
        /* Holiday-specific themes */
        .holiday-theme-christmas {
          background: linear-gradient(135deg, #DC143C, #228B22, #FFD700);
        }
        
        .holiday-theme-halloween {
          background: linear-gradient(135deg, #FF6B35, #1A1A1A, #8B4513);
        }
        
        .holiday-theme-valentine {
          background: linear-gradient(135deg, #FF6B6B, #FF8E8E, #FFB3B3);
        }
        
        .holiday-theme-independence {
          background: linear-gradient(135deg, #B22222, #FFFFFF, #4169E1);
        }
        
        .holiday-theme-new-year {
          background: linear-gradient(135deg, #FFD700, #FF6B6B, #4ECDC4);
        }
        
        .holiday-theme-st-patrick {
          background: linear-gradient(135deg, #4CAF50, #8BC34A, #CDDC39);
        }
        
        .holiday-theme-thanksgiving {
          background: linear-gradient(135deg, #8B4513, #D2691E, #FF8C00);
        }
        
        .holiday-theme-april-fool {
          background: linear-gradient(135deg, #FF9800, #FFC107, #FFEB3B);
        }
        
        .holiday-theme-new-year-eve {
          background: linear-gradient(135deg, #4B0082, #FFD700, #FF1493);
        }
        
        /* Holiday indicator badge */
        .holiday-indicator {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1000;
          animation: holidaySlideIn 0.5s ease-out;
        }
        
        .holiday-badge {
          background: linear-gradient(135deg, var(--holiday-primary), var(--holiday-secondary));
          color: white;
          padding: 8px 16px;
          border-radius: 20px;
          font-weight: bold;
          font-size: 14px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          backdrop-filter: blur(10px);
          border: 2px solid rgba(255, 255, 255, 0.2);
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .holiday-close-btn {
          background: rgba(255, 255, 255, 0.2);
          color: white;
          border: 2px solid rgba(255, 255, 255, 0.3);
          padding: 8px 16px;
          border-radius: 8px;
          font-weight: bold;
          cursor: pointer;
          margin-top: 16px;
          transition: all 0.3s ease;
          backdrop-filter: blur(10px);
        }
        
        .holiday-close-btn:hover {
          background: rgba(255, 255, 255, 0.3);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        @keyframes holidaySlideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `})]})};function Fe({className:i="",children:n,...a}){return o.jsx("div",{className:`rounded-2xl border border-[#2a2a3a] bg-[#0f0f15] ${i}`,...a,children:n})}function ao({className:i="",children:n,...a}){return o.jsx("div",{className:`p-4 border-b border-[#2a2a3a] ${i}`,...a,children:n})}function oo({className:i="",children:n,...a}){return o.jsx("h3",{className:`text-lg font-semibold ${i}`,...a,children:n})}function pa({className:i="",children:n,...a}){return o.jsx("div",{className:`p-4 ${i}`,...a,children:n})}function Age({count:i=40}){const n=M.useMemo(()=>Array.from({length:i}).map(()=>{const a=Math.random()*100,l=Math.random()*100,u=-20+Math.random()*40,m=2+Math.random()*3,y=80+Math.random()*160,w=Math.random()*2.5,b=1.6+Math.random()*3.2,x=Math.random()>.5?"rgba(255,255,255,0.9)":"rgba(0, 242, 255, 0.9)";return{left:a,top:l,rotate:u,width:m,length:y,delay:w,duration:b,colorStop:x}}),[i]);return o.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none z-40",children:[o.jsx("style",{children:`
        @keyframes lightningFlash {
          0% { opacity: 0; filter: blur(0px); }
          5% { opacity: 0.9; filter: blur(0.5px); }
          10% { opacity: 0.3; filter: blur(1px); }
          15% { opacity: 1; filter: blur(0.2px); }
          25% { opacity: 0; filter: blur(0px); }
          100% { opacity: 0; filter: blur(0px); }
        }
        @keyframes ambientGlow {
          0% { opacity: 0.05; }
          50% { opacity: 0.12; }
          100% { opacity: 0.05; }
        }
      `}),o.jsx("div",{className:"absolute inset-0",style:{background:"radial-gradient(60vh 60vh at 10% 10%, rgba(0, 242, 255, 0.10), transparent 60%),radial-gradient(50vh 50vh at 85% 30%, rgba(255,255,255,0.06), transparent 60%)",mixBlendMode:"screen",animation:"ambientGlow 6s ease-in-out infinite"}}),n.map((a,l)=>o.jsx("div",{className:"absolute",style:{left:`${a.left}%`,top:`${a.top}%`,transform:`rotate(${a.rotate}deg)`,width:`${a.length}px`,height:`${a.width}px`,background:`linear-gradient(90deg, ${a.colorStop}, rgba(255,255,255,0) 60%)`,boxShadow:`0 0 12px ${a.colorStop}`,opacity:0,animation:`lightningFlash ${a.duration}s ${a.delay}s ease-in-out infinite`}},l))]})}function oq({pageName:i,fieldName:n="content",defaultText:a=""}){const{data:l,isLoading:u}=mt({queryKey:["adminContent",i,n],queryFn:async()=>{if(!K.__isConfigured)return a;try{const{data:m,error:y}=await K.rpc("get_admin_content",{page_name_param:i,field_name_param:n});if(!y&&typeof m=="string"&&m.length>0)return m}catch{}try{const{data:m}=await K.from("admin_content").select("content").eq("page_name",i).eq("field_name",n).eq("is_active",!0).order("updated_at",{ascending:!1}).limit(1),y=Array.isArray(m)?m[0]:null;return(y==null?void 0:y.content)||a}catch{return a}},staleTime:6e4});return u?o.jsx("span",{children:a}):o.jsx("span",{children:l||a})}const Ige=()=>{const i=Wn(),{data:n=[],isLoading:a}=mt({queryKey:["topTrollers"],queryFn:async()=>{const{data:l,error:u}=await K.from("profiles").select("id, username, avatar_url, coins, follower_count, is_troll_officer, troll_family_name").order("coins",{ascending:!1}).limit(10);return u?(console.warn("Failed to fetch top trollers:",u),[]):(l||[]).map((m,y)=>({...m,rank:y+1}))},refetchInterval:3e4});return a?o.jsxs(Fe,{className:"bg-[#1a1a2e] border-purple-500/30 p-6",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx(dp,{className:"w-6 h-6 text-yellow-500"}),o.jsx("h2",{className:"text-xl font-bold text-white",children:"Top Trollers"})]}),o.jsx("p",{className:"text-gray-400",children:"Loading..."})]}):o.jsxs(Fe,{className:"bg-[#1a1a2e] border-purple-500/30 p-6",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(dp,{className:"w-6 h-6 text-yellow-500"}),o.jsx("h2",{className:"text-xl font-bold text-white",children:" Top Trollers"})]}),o.jsx("div",{className:"space-y-3",children:n.length===0?o.jsx("p",{className:"text-gray-400 text-center py-6",children:"No users yet"}):n.map((l,u)=>{const m=u===0?"":u===1?"":u===2?"":`#${u+1}`;return o.jsx("div",{onClick:()=>i(`/PublicProfile?userId=${l.id}`),className:"group relative bg-[#0f0f1a] hover:bg-purple-500/20 rounded-lg p-4 cursor-pointer transition-all duration-200 border border-purple-500/20 hover:border-purple-500/60",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"text-2xl font-bold text-yellow-500 w-8 text-center",children:m}),o.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-600 overflow-hidden flex items-center justify-center flex-shrink-0",children:l.avatar_url?o.jsx("img",{src:l.avatar_url,alt:l.username,className:"w-full h-full object-cover"}):o.jsx("span",{className:"text-xl",children:""})}),o.jsxs("div",{className:"flex-grow min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("p",{className:"font-bold text-white truncate",children:l.username}),l.is_troll_officer&&o.jsx(wt,{className:"bg-purple-600/80 text-white text-xs",children:"Officer"}),l.troll_family_name&&o.jsx(wt,{className:"bg-blue-600/80 text-white text-xs",children:l.troll_family_name})]}),o.jsxs("p",{className:"text-xs text-gray-400 truncate",children:["@",l.username]})]}),o.jsx("div",{className:"flex items-center gap-4 flex-shrink-0",children:o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"flex items-center gap-1 text-purple-400 font-bold",children:[o.jsx(ni,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm",children:(l.coins||0).toLocaleString()})]}),o.jsxs("div",{className:"flex items-center gap-1 text-blue-400 text-xs",children:[o.jsx(jn,{className:"w-3 h-3"}),o.jsx("span",{children:(l.follower_count||0).toLocaleString()})]})]})})]})},l.id)})}),o.jsx("button",{onClick:()=>i("/Trending"),className:"w-full mt-4 py-2 px-4 bg-purple-600/30 hover:bg-purple-600/50 text-purple-300 font-semibold rounded-lg transition-colors duration-200",children:"View All "})]})};async function Oge(){try{const{data:i,error:n}=await K.rpc("get_current_high_paying_broadcasters");if(n)throw n;return(Array.isArray(i)?i:[]).map(l=>({id:l.user_id||l.id,username:l.username,avatar:l.avatar_url||l.avatar,monthly_spending:Math.round((l.total_spent??0)/100)}))}catch(i){return console.error("Error getting high-paying broadcasters:",i),[]}}async function ib(){var i,n,a;try{const{data:l}=await K.auth.getUser(),u=(i=l==null?void 0:l.user)==null?void 0:i.id;if(!u)return null;const{data:m,error:y}=await K.from("profiles").select("*").eq("id",u).limit(1).single();if(y)return null;const w=m||null;return w?{...w,avatar:w.avatar??w.avatar_url??((n=w.user_metadata)==null?void 0:n.avatar_url)??((a=w.user_metadata)==null?void 0:a.avatar)??null}:null}catch{return null}}async function xz(){var i;try{const{data:n}=await K.auth.getUser(),a=n==null?void 0:n.user;if(!a)return null;const{data:l}=await K.from("profiles").select("*").eq("id",a.id).single();if(l)return l;const u=((i=a.email)==null?void 0:i.split("@")[0])||`user_${a.id.slice(0,8)}`,{data:m,error:y}=await K.from("profiles").insert({id:a.id,email:a.email,username:u,full_name:u,role:"user",is_admin:!1,is_troll_officer:!1,is_troller:!1,is_broadcaster:!1,level:1,coins:0,free_coins:0,purchased_coins:0,created_at:new Date().toISOString()}).select().single();return y?(console.error("Error creating user profile:",y),null):(console.log("Created new user profile:",m),m)}catch(n){return console.error("Error ensuring user profile:",n),null}}function kP(){const i=Wn(),[n,a]=M.useState("all"),{data:l}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me(),retry:!1,staleTime:5e3,refetchInterval:1e4,refetchOnWindowFocus:!0});M.useEffect(()=>{l!=null&&l.id&&xz().then(N=>{N&&console.log("User profile ensured:",N.username)}).catch(N=>{console.error("Error ensuring user profile:",N)})},[l==null?void 0:l.id]);const{data:u=[],isLoading:m}=mt({queryKey:["liveStreams"],queryFn:async()=>{try{const{data:N=[],error:O}=await K.from("streams").select("id,title,thumbnail,category,viewer_count,streamer_id,streamer_name,streamer_avatar,last_heartbeat,created_at,is_live").eq("is_live",!0).order("created_at",{ascending:!1}).limit(1e3);if(O)throw O;const P=Date.now(),F=60*1e3,z=N.filter(W=>{if(!W.last_heartbeat)return!1;const te=new Date(W.last_heartbeat).getTime(),$=P-te;return $>F?(console.log(` Filtering out stale stream: ${W.title} (${Math.floor($/1e3)}s ago)`),!1):!0});let V=z;if(l){V=z.filter(W=>W.streamer_id!==l.id);try{const W=Array.from(new Set(V.map(te=>te.streamer_id).filter(Boolean)));if(W.length>0){const{data:te=[]}=await K.from("user_stream_bans").select("streamer_id").in("streamer_id",W).eq("user_id",l.id).eq("is_active",!0),$=new Set((te||[]).map(Q=>String(Q.streamer_id)));V=V.filter(Q=>!$.has(String(Q.streamer_id)))}}catch(W){console.warn("Failed to fetch user stream bans",(W==null?void 0:W.message)||W)}}else V=z;return console.log(` Live streams: ${N.length} found, ${z.length} active, ${V.length} visible`),V}catch(N){return console.error("Failed to load streams:",N),[]}},refetchInterval:5e3,retry:1,initialData:[],staleTime:3e3}),{data:y=[],isLoading:w}=mt({queryKey:["newUsers"],queryFn:async()=>{try{const{data:N=[],error:O}=await K.from("profiles").select("*").order("created_at",{ascending:!1}).limit(12);if(O)throw O;return N}catch(N){return console.error("Failed to load new users:",N),[]}},initialData:[],staleTime:5e3,refetchInterval:1e4,refetchOnWindowFocus:!0}),{data:b=[],isLoading:x}=mt({queryKey:["highPayingBroadcasters"],queryFn:async()=>{try{return await Oge()}catch(N){return console.error("Failed to load high-paying broadcasters:",N),[]}},initialData:[],staleTime:3e4,refetchInterval:6e4,refetchOnWindowFocus:!0}),T=n==="all"?u:u.filter(N=>N.category===n);return o.jsxs("main",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] py-10 px-4 relative",children:[o.jsx(Age,{count:80}),o.jsxs("header",{className:"w-full max-w-6xl mx-auto flex flex-col sm:flex-row justify-between items-center mb-10",children:[o.jsxs("h1",{className:"text-4xl font-extrabold tracking-tight mb-4 sm:mb-0",children:[o.jsx("span",{className:"text-[#00ff88]",children:"Troll"}),o.jsx("span",{className:"text-[#ff0844]",children:"City"})]}),o.jsx("p",{className:"text-gray-400 text-center sm:text-right max-w-md",children:"Dive into the live chaos  streams, games, and moments that only Troll City can bring."})]}),o.jsx("section",{className:"w-full max-w-6xl mx-auto mb-10",children:o.jsx("div",{className:"relative rounded-xl overflow-hidden bg-black/50",children:o.jsx("div",{className:"w-full h-72 bg-gradient-to-br from-purple-900/80 to-pink-900/80 flex items-center justify-center",children:o.jsxs("div",{className:"text-center text-white p-8",children:[o.jsx(dp,{className:"w-16 h-16 mx-auto mb-4 text-yellow-400"}),o.jsx("h2",{className:"text-3xl sm:text-4xl font-extrabold mb-2",children:o.jsx(oq,{pageName:"Home",fieldName:"hero_title",defaultText:"MAI Introduces Troll City"})}),o.jsx("p",{className:"text-gray-300 mb-4",children:o.jsx(oq,{pageName:"Home",fieldName:"hero_subtitle",defaultText:"A new line of reinventions. Join the live experience, send gifts, and be a part of the chaos."})})]})})})}),o.jsxs("div",{className:"w-full max-w-6xl mx-auto space-y-10",children:[o.jsxs("section",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),o.jsx("h2",{className:"text-2xl font-semibold text-white",children:" Live Now"}),o.jsxs(wt,{className:"bg-red-500 text-white",children:[T.length," Live"]}),o.jsx(wt,{className:"bg-green-500 text-white text-xs",children:"Auto-updating"})]}),m?o.jsx("p",{className:"text-gray-400 animate-pulse",children:"Loading streams..."}):T.length===0?o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-12 text-center",children:[o.jsx(Si,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500 text-lg",children:n==="all"?"No one's live right now. Be the first to go live!":`No ${n} streams live right now.`}),o.jsxs(ke,{onClick:()=>i(Or("GoLive")),className:"mt-4 bg-gradient-to-r from-red-500 to-pink-500",children:[o.jsx(Si,{className:"w-4 h-4 mr-2"}),"Go Live Now"]})]}):o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:T.map(N=>{var P,F;const O=N.last_heartbeat?Math.floor((Date.now()-new Date(N.last_heartbeat).getTime())/1e3):null;return o.jsx("div",{onClick:()=>i(Or("StreamViewer")+`?id=${N.id}`),className:"cursor-pointer group",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] overflow-hidden hover:border-red-500 transition-all group-hover:scale-105",children:[o.jsxs("div",{className:"relative aspect-video",children:[N.thumbnail?o.jsx("img",{src:N.thumbnail,alt:N.title,className:"w-full h-full object-cover"}):o.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-900/50 to-pink-900/50 flex items-center justify-center",children:o.jsx(Si,{className:"w-12 h-12 text-white/50"})}),o.jsxs("div",{className:"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded flex items-center gap-1 text-xs font-bold",children:[o.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),"LIVE"]}),o.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded flex items-center gap-1 text-xs",children:[o.jsx(Mm,{className:"w-3 h-3"}),N.viewer_count||0]}),O!==null&&O<60&&o.jsxs("div",{className:"absolute bottom-2 right-2 bg-green-500/80 text-white px-2 py-0.5 rounded text-xs",children:["Active ",O,"s ago"]}),o.jsx("div",{className:"absolute bottom-2 left-2",children:o.jsx(wt,{className:"bg-purple-500/90 text-white text-xs",children:N.category})})]}),o.jsxs("div",{className:"p-3",children:[o.jsx("h3",{className:"text-white font-semibold truncate mb-1",children:N.title}),o.jsxs("div",{className:"flex items-center gap-2",children:[N.streamer_avatar?o.jsx("img",{src:N.streamer_avatar,alt:N.streamer_name,className:"w-6 h-6 rounded-full"}):o.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:o.jsx("span",{className:"text-white text-xs font-bold",children:(F=(P=N.streamer_name)==null?void 0:P[0])==null?void 0:F.toUpperCase()})}),o.jsxs("p",{className:"text-gray-400 text-sm truncate",children:["@",N.streamer_name]})]})]})]})},N.id)})})]}),b&&b.length>0&&o.jsxs("section",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(dp,{className:"w-6 h-6 text-yellow-400"}),o.jsx("h2",{className:"text-2xl font-semibold text-white",children:" High-Paying Trollers"}),o.jsxs(wt,{className:"bg-yellow-500 text-black",children:[b.length," VIP"]})]}),o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:b.map(N=>{var O,P,F;return o.jsx("div",{onClick:()=>i(Or("PublicProfile")+`?userId=${N.id}`),className:"cursor-pointer group relative",children:o.jsxs(Fe,{className:"bg-gradient-to-br from-yellow-900/20 to-yellow-600/20 border-yellow-500/50 overflow-hidden hover:border-yellow-400 transition-all group-hover:scale-105 relative",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-400/20 via-yellow-300/30 to-yellow-400/20 animate-pulse opacity-50"}),o.jsx("div",{className:"absolute -top-1 -right-1 w-8 h-8 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full flex items-center justify-center animate-bounce",children:o.jsx(Pce,{className:"w-4 h-4 text-white"})}),o.jsx("div",{className:"relative p-4",children:o.jsxs("div",{className:"flex flex-col items-center gap-3",children:[N.avatar?o.jsx("img",{src:N.avatar,alt:N.username,className:"w-20 h-20 rounded-full object-cover border-4 border-yellow-400 shadow-lg"}):o.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center border-4 border-yellow-300 shadow-lg",children:o.jsx("span",{className:"text-white text-2xl font-bold",children:(P=(O=N.username)==null?void 0:O[0])==null?void 0:P.toUpperCase()})}),o.jsxs("div",{className:"text-center",children:[o.jsxs("p",{className:"text-white font-bold text-lg truncate",children:["@",N.username]}),o.jsxs("p",{className:"text-yellow-400 text-sm font-semibold",children:["$",((F=N.monthly_spending)==null?void 0:F.toLocaleString())||0," this month"]}),o.jsx(wt,{className:"bg-yellow-500 text-black text-xs mt-1",children:" High Roller"})]})]})})]})},N.id)})})]}),o.jsx("section",{children:o.jsx(Ige,{})}),o.jsxs("section",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(jn,{className:"w-6 h-6 text-cyan-400"}),o.jsx("h2",{className:"text-2xl font-semibold text-white",children:" New Trollerz"}),o.jsxs(wt,{className:"bg-cyan-500 text-white",children:[y.length," Members"]})]}),w?o.jsx("p",{className:"text-gray-400 animate-pulse",children:"Loading new trollerz..."}):y.length===0?o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-12 text-center",children:[o.jsx(Pa,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500 text-lg",children:"No new members yet."})]}):o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:y.map(N=>{var O,P;return o.jsx("div",{onClick:()=>i(Or("PublicProfile")+`?userId=${N.id}`),className:"cursor-pointer group",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4 hover:border-cyan-500 transition-all group-hover:scale-105",children:o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[N.avatar?o.jsx("img",{src:N.avatar,alt:N.username||N.full_name,className:"w-16 h-16 rounded-full object-cover"}):o.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:o.jsx("span",{className:"text-white text-xl font-bold",children:(P=(O=N.username||N.full_name)==null?void 0:O[0])==null?void 0:P.toUpperCase()})}),o.jsxs("div",{className:"text-center w-full",children:[o.jsxs("p",{className:"text-white text-sm font-semibold truncate",children:["@",N.username||N.full_name]}),o.jsxs(wt,{className:"bg-purple-500 text-white text-xs mt-1",children:["Lv ",N.level||1]})]})]})})},N.id)})})]})]}),o.jsx("footer",{className:"w-full mt-16 py-6 bg-transparent",children:o.jsxs("div",{className:"w-full max-w-6xl mx-auto text-center text-gray-400 text-sm",children:[o.jsxs("p",{children:[" ",new Date().getFullYear()," MAI Corporation. All rights reserved."]}),o.jsxs("p",{className:"mt-1",children:[o.jsx("a",{href:"/Employment",className:"underline mr-4",children:"Employment"}),o.jsx("a",{href:"/ContactUs",className:"underline",children:"Contact Us"})]}),o.jsxs("p",{className:"mt-2",children:["Contact: ",o.jsx("a",{className:"underline",href:"mailto:trollcity2025@gmail.com",children:"trollcity2025@gmail.com"})]})]})})]})}async function BR(){try{const{data:i,error:n}=await K.from("earnings_config").select("*").eq("id",1).single();if(n)throw n;return i}catch(i){return{square_account_active:!1,square_application_id:null,square_location_id:null,transaction_fee_percentage:2.9,transaction_fee_fixed_cents:30,_fallback:!0,_error:(i==null?void 0:i.message)||String(i)}}}function cq(i,n=2.9,a=30){const u=Math.round(i*n/100)+a,m=i-u;return{grossAmount:i,feeAmount:u,netAmount:Math.max(m,0)}}async function GD(i){var w;const{amount:n,currency:a="USD",sourceId:l,description:u,userId:m,metadata:y={}}=i;try{const b=await BR();if(!b.square_account_active||!b.square_application_id||b.square_application_id==="sandbox-sq0idb-YOUR_SANDBOX_APP_ID"){console.warn("Square integration not fully configured, using test mode");const{feeAmount:z,netAmount:V}=cq(n,b.transaction_fee_percentage||2.9,b.transaction_fee_fixed_cents||30);return{success:!0,transactionId:`test_${Date.now()}`,paymentId:`test_payment_${Date.now()}`,amountCharged:n,feeApplied:z,netReceived:V,raw:{test:!0,message:"Square integration in test mode"}}}const{feeAmount:x,netAmount:T}=cq(n,b.transaction_fee_percentage,b.transaction_fee_fixed_cents),N={amount:n,currency:a,sourceId:l,description:u,userId:m,metadata:y,idempotency_key:y==null?void 0:y.idempotency_key},{data:O,error:P}=await K.functions.invoke("processSquarePayment",{body:N});if(P)throw P;const F=O;return{success:!0,transactionId:(F==null?void 0:F.transactionId)||null,paymentId:(F==null?void 0:F.paymentId)||null,amountCharged:n,feeApplied:(F==null?void 0:F.feeAmount)??x,netReceived:(F==null?void 0:F.netAmount)??T,raw:F}}catch(b){throw console.error("Square payment error:",b),(w=b.message)!=null&&w.includes("Square integration is not active")?new Error("Payment processing is temporarily unavailable. Please contact support or try again later."):b}}async function HD(){try{const i=await BR();if(!i||!i.square_account_active)return{success:!1,error:"Square integration is not active",details:i!=null&&i._fallback?"earnings_config missing; run migrations":"Enable Square in earnings_config"};const a=["square_application_id","square_location_id"].filter(l=>!i[l]);return a.length?{success:!1,error:"Missing Square configuration",details:`Missing: ${a.join(", ")}`}:{success:!0,message:"Square config present",details:"Application ID and Location ID are set; account active",timestamp:new Date().toISOString()}}catch(i){return console.error("Square connection test error:",i),{success:!1,error:(i==null?void 0:i.message)||String(i),details:"Unexpected error during configuration test"}}}async function KD(i){try{if(!i||typeof i!="string")throw new Error(`Invalid userId: expected string UUID, got ${typeof i}: ${JSON.stringify(i)}`);if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(i))throw new Error(`Invalid UUID format: ${i}`);const{data:a,error:l}=await K.from("profiles").select("apple_pay_id, google_wallet_id, chime_id, cashapp_id").eq("id",i).single();if(l)throw l;return{applePay:(a==null?void 0:a.apple_pay_id)||null,googleWallet:(a==null?void 0:a.google_wallet_id)||null,chime:(a==null?void 0:a.chime_id)||null,cashApp:(a==null?void 0:a.cashapp_id)||null}}catch(n){throw console.error("Error fetching user payment methods:",n),n}}async function kge(i,n,a,l,u,m,y,w){try{if(!i||typeof i!="string")throw new Error(`Invalid userId: expected string, got ${typeof i}: ${JSON.stringify(i)}`);const b=await KD(i),T={apple_pay:"applePay",google_wallet:"googleWallet",chime:"chime",cashapp:"cashApp"}[n],N=b[T];if(!N||N!==a)throw new Error(`No saved ${n} payment method found. Please set up your payment method in profile first.`);const O=Math.round(parseFloat(l)*100);try{const{data:P,error:F}=await K.functions.invoke("processUserPaymentMethod",{body:{userId:i,method:n,methodId:a,amount:O,currency:u||"USD",description:m,coinAmount:y,idempotency_key:w||`${i}-${Date.now()}-${O}`}});if(F)throw F;return P}catch(P){return console.warn("Edge Function not available, falling back to regular Square payment:",P),await GD({amount:O,currency:u||"USD",sourceId:a,description:m,userId:i,metadata:{idempotency_key:w||`${i}-${Date.now()}-${O}`}})}}catch(b){throw console.error("Error processing user payment method:",b),b}}async function Pge(i){try{const n=await KD(i);return{applePay:!!n.applePay,googleWallet:!!n.googleWallet,chime:!!n.chime,cashApp:!!n.cashApp}}catch(n){return console.error("Error checking available payment methods:",n),{applePay:!1,googleWallet:!1,chime:!1,cashApp:!1}}}function Zt({className:i="",...n}){return o.jsx("input",{className:`bg-[#0a0a0f] border border-[#2a2a3a] text-white rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-600 ${i}`,...n})}function jr({children:i,className:n="",htmlFor:a}){return o.jsx("label",{htmlFor:a,className:`text-gray-300 text-sm ${n}`,children:i})}async function zD(i,n,a={}){if(!i)throw new Error("creditCoins: missing userId");if(n=Number(n)||0,n<=0)throw new Error("creditCoins: amount must be > 0");const l=new Date().toISOString(),u={user_id:i,amount:n,type:"credit",reason:a.reason||a.source||"credit",source:a.source||null,reference_id:a.reference||null,created_date:l},{error:m}=await K.from("coin_transactions").insert(u);if(m)throw console.warn("creditCoins: failed to insert transaction",m.message||m),m;const{data:y,error:w}=await K.from("profiles").select("coins, purchased_coins").eq("id",i).single();if(w)throw console.warn("creditCoins: failed to fetch profile",w.message||w),w;const b=((y==null?void 0:y.coins)||0)+n,x=((y==null?void 0:y.purchased_coins)||0)+n,{error:T}=await K.from("profiles").update({coins:b,purchased_coins:x,updated_date:l}).eq("id",i);if(T)throw console.warn("creditCoins: failed to update profile",T.message||T),T;return{userId:i,newCoins:b,newPurchased:x}}async function WR(i,n,a={}){if(!i)throw new Error("debitCoins: missing userId");if(n=Number(n)||0,n<=0)throw new Error("debitCoins: amount must be > 0");const l=new Date().toISOString(),{data:u,error:m}=await K.from("profiles").select("coins, free_coins, purchased_coins").eq("id",i).single();if(m)throw console.warn("debitCoins: failed to fetch profile",m.message||m),m;if(((u==null?void 0:u.coins)||0)<n)throw new Error("Insufficient coins");const w={user_id:i,amount:n,type:"debit",reason:a.reason||a.source||"debit",source:a.source||null,reference_id:a.reference||null,created_date:l},{error:b}=await K.from("coin_transactions").insert(w);if(b)throw console.warn("debitCoins: failed to insert transaction",b.message||b),b;const x=((u==null?void 0:u.coins)||0)-n,T=((u==null?void 0:u.purchased_coins)||0)-Math.min((u==null?void 0:u.purchased_coins)||0,n),{error:N}=await K.from("profiles").update({coins:x,purchased_coins:T,updated_date:l}).eq("id",i);if(N)throw console.warn("debitCoins: failed to update profile",N.message||N),N;return{userId:i,newCoins:x,newPurchased:T}}async function $D(i,n,a={}){if(!i)throw new Error("debitPurchasedCoinsWithNegative: missing userId");if(n=Number(n)||0,n<=0)throw new Error("debitPurchasedCoinsWithNegative: amount must be > 0");const l=new Date().toISOString(),{data:u,error:m}=await K.from("profiles").select("coins, purchased_coins, free_coins").eq("id",i).single();if(m)throw m;const y=Number((u==null?void 0:u.purchased_coins)||0);if(Number((u==null?void 0:u.free_coins)||0),y<1e3){console.log(`User ${i} has ${y} purchased coins (< 1000), allowing negative balance`);const w={user_id:i,amount:n,type:"debit",reason:a.reason||a.source||"debit_purchased_negative",source:a.source||"purchased_negative",reference_id:a.reference||null,created_date:l};try{await K.from("coin_transactions").insert(w)}catch{}const b=y-n,x=Number((u==null?void 0:u.coins)||0)-n,{error:T}=await K.from("profiles").update({coins:x,purchased_coins:b,updated_date:l}).eq("id",i);if(T)throw T;return{userId:i,newCoins:x,newPurchased:b,wentNegative:!0,needsStoreRedirect:y<1e3&&b<0}}else return await Tz(i,n,a)}async function Tz(i,n,a={}){if(!i)throw new Error("debitPurchasedCoins: missing userId");if(n=Number(n)||0,n<=0)throw new Error("debitPurchasedCoins: amount must be > 0");const l=new Date().toISOString(),{data:u,error:m}=await K.from("profiles").select("coins, purchased_coins").eq("id",i).single();if(m)throw m;const y=Number((u==null?void 0:u.purchased_coins)||0);if(y<n)throw new Error("Insufficient purchased coins");const w={user_id:i,amount:n,type:"debit",reason:a.reason||a.source||"debit_purchased",source:a.source||"purchased",reference_id:a.reference||null,created_date:l};try{await K.from("coin_transactions").insert(w)}catch{}const b=y-n,x=Number((u==null?void 0:u.coins)||0)-n,{error:T}=await K.from("profiles").update({coins:x,purchased_coins:b,updated_date:l}).eq("id",i);if(T)throw T;return{userId:i,newCoins:x,newPurchased:b}}async function PP(i,n,a={}){if(!i)throw new Error("creditFreeCoins: missing userId");if(n=Number(n)||0,n<=0)throw new Error("creditFreeCoins: amount must be > 0");const l=new Date().toISOString(),u={user_id:i,amount:n,type:"credit",reason:a.reason||"free",source:a.source||"free",reference_id:a.reference||null,created_date:l};try{await K.from("coin_transactions").insert(u)}catch{}const{data:m,error:y}=await K.from("profiles").select("coins, free_coins").eq("id",i).single();if(y)throw y;const w=((m==null?void 0:m.coins)||0)+n,b=((m==null?void 0:m.free_coins)||0)+n,{error:x}=await K.from("profiles").update({coins:w,free_coins:b,updated_date:l}).eq("id",i);if(x)throw x;return{userId:i,newCoins:w,free_coins:b}}const YD=M.createContext({});function XD(i){const n=M.useRef(null);return n.current===null&&(n.current=i()),n.current}const JD=typeof window<"u",Cz=JD?M.useLayoutEffect:M.useEffect,qR=M.createContext(null);function QD(i,n){i.indexOf(n)===-1&&i.push(n)}function ZD(i,n){const a=i.indexOf(n);a>-1&&i.splice(a,1)}const Pu=(i,n,a)=>a>n?n:a<i?i:a;let e2=()=>{};const Du={},Rz=i=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(i);function Nz(i){return typeof i=="object"&&i!==null}const Az=i=>/^0[^.\s]+$/u.test(i);function t2(i){let n;return()=>(n===void 0&&(n=i()),n)}const kc=i=>i,Dge=(i,n)=>a=>n(i(a)),ab=(...i)=>i.reduce(Dge),Vw=(i,n,a)=>{const l=n-i;return l===0?1:(a-i)/l};class r2{constructor(){this.subscriptions=[]}add(n){return QD(this.subscriptions,n),()=>ZD(this.subscriptions,n)}notify(n,a,l){const u=this.subscriptions.length;if(u)if(u===1)this.subscriptions[0](n,a,l);else for(let m=0;m<u;m++){const y=this.subscriptions[m];y&&y(n,a,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ad=i=>i*1e3,Ac=i=>i/1e3;function Iz(i,n){return n?i*(1e3/n):0}const Oz=(i,n,a)=>(((1-3*a+3*n)*i+(3*a-6*n))*i+3*n)*i,jge=1e-7,Lge=12;function Mge(i,n,a,l,u){let m,y,w=0;do y=n+(a-n)/2,m=Oz(y,l,u)-i,m>0?a=y:n=y;while(Math.abs(m)>jge&&++w<Lge);return y}function ob(i,n,a,l){if(i===n&&a===l)return kc;const u=m=>Mge(m,0,1,i,a);return m=>m===0||m===1?m:Oz(u(m),n,l)}const kz=i=>n=>n<=.5?i(2*n)/2:(2-i(2*(1-n)))/2,Pz=i=>n=>1-i(1-n),Dz=ob(.33,1.53,.69,.99),n2=Pz(Dz),jz=kz(n2),Lz=i=>(i*=2)<1?.5*n2(i):.5*(2-Math.pow(2,-10*(i-1))),s2=i=>1-Math.sin(Math.acos(i)),Mz=Pz(s2),Uz=kz(s2),Uge=ob(.42,0,1,1),Fge=ob(0,0,.58,1),Fz=ob(.42,0,.58,1),Vge=i=>Array.isArray(i)&&typeof i[0]!="number",Vz=i=>Array.isArray(i)&&typeof i[0]=="number",Bge={linear:kc,easeIn:Uge,easeInOut:Fz,easeOut:Fge,circIn:s2,circInOut:Uz,circOut:Mz,backIn:n2,backInOut:jz,backOut:Dz,anticipate:Lz},Wge=i=>typeof i=="string",lq=i=>{if(Vz(i)){e2(i.length===4);const[n,a,l,u]=i;return ob(n,a,l,u)}else if(Wge(i))return Bge[i];return i},DC=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function qge(i,n){let a=new Set,l=new Set,u=!1,m=!1;const y=new WeakSet;let w={delta:0,timestamp:0,isProcessing:!1};function b(T){y.has(T)&&(x.schedule(T),i()),T(w)}const x={schedule:(T,N=!1,O=!1)=>{const F=O&&u?a:l;return N&&y.add(T),F.has(T)||F.add(T),T},cancel:T=>{l.delete(T),y.delete(T)},process:T=>{if(w=T,u){m=!0;return}u=!0,[a,l]=[l,a],a.forEach(b),a.clear(),u=!1,m&&(m=!1,x.process(T))}};return x}const Gge=40;function Bz(i,n){let a=!1,l=!0;const u={delta:0,timestamp:0,isProcessing:!1},m=()=>a=!0,y=DC.reduce(($,Q)=>($[Q]=qge(m),$),{}),{setup:w,read:b,resolveKeyframes:x,preUpdate:T,update:N,preRender:O,render:P,postRender:F}=y,z=()=>{const $=Du.useManualTiming?u.timestamp:performance.now();a=!1,Du.useManualTiming||(u.delta=l?1e3/60:Math.max(Math.min($-u.timestamp,Gge),1)),u.timestamp=$,u.isProcessing=!0,w.process(u),b.process(u),x.process(u),T.process(u),N.process(u),O.process(u),P.process(u),F.process(u),u.isProcessing=!1,a&&n&&(l=!1,i(z))},V=()=>{a=!0,l=!0,u.isProcessing||i(z)};return{schedule:DC.reduce(($,Q)=>{const G=y[Q];return $[Q]=(se,ie=!1,ce=!1)=>(a||V(),G.schedule(se,ie,ce)),$},{}),cancel:$=>{for(let Q=0;Q<DC.length;Q++)y[DC[Q]].cancel($)},state:u,steps:y}}const{schedule:ws,cancel:yp,state:Yi,steps:xk}=Bz(typeof requestAnimationFrame<"u"?requestAnimationFrame:kc,!0);let zC;function Hge(){zC=void 0}const ho={now:()=>(zC===void 0&&ho.set(Yi.isProcessing||Du.useManualTiming?Yi.timestamp:performance.now()),zC),set:i=>{zC=i,queueMicrotask(Hge)}},Wz=i=>n=>typeof n=="string"&&n.startsWith(i),i2=Wz("--"),Kge=Wz("var(--"),a2=i=>Kge(i)?zge.test(i.split("/*")[0].trim()):!1,zge=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Jy={test:i=>typeof i=="number",parse:parseFloat,transform:i=>i},Bw={...Jy,transform:i=>Pu(0,1,i)},jC={...Jy,default:1},bw=i=>Math.round(i*1e5)/1e5,o2=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function $ge(i){return i==null}const Yge=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,c2=(i,n)=>a=>!!(typeof a=="string"&&Yge.test(a)&&a.startsWith(i)||n&&!$ge(a)&&Object.prototype.hasOwnProperty.call(a,n)),qz=(i,n,a)=>l=>{if(typeof l!="string")return l;const[u,m,y,w]=l.match(o2);return{[i]:parseFloat(u),[n]:parseFloat(m),[a]:parseFloat(y),alpha:w!==void 0?parseFloat(w):1}},Xge=i=>Pu(0,255,i),Tk={...Jy,transform:i=>Math.round(Xge(i))},fm={test:c2("rgb","red"),parse:qz("red","green","blue"),transform:({red:i,green:n,blue:a,alpha:l=1})=>"rgba("+Tk.transform(i)+", "+Tk.transform(n)+", "+Tk.transform(a)+", "+bw(Bw.transform(l))+")"};function Jge(i){let n="",a="",l="",u="";return i.length>5?(n=i.substring(1,3),a=i.substring(3,5),l=i.substring(5,7),u=i.substring(7,9)):(n=i.substring(1,2),a=i.substring(2,3),l=i.substring(3,4),u=i.substring(4,5),n+=n,a+=a,l+=l,u+=u),{red:parseInt(n,16),green:parseInt(a,16),blue:parseInt(l,16),alpha:u?parseInt(u,16)/255:1}}const DP={test:c2("#"),parse:Jge,transform:fm.transform},cb=i=>({test:n=>typeof n=="string"&&n.endsWith(i)&&n.split(" ").length===1,parse:parseFloat,transform:n=>`${n}${i}`}),Xh=cb("deg"),Id=cb("%"),Nr=cb("px"),Qge=cb("vh"),Zge=cb("vw"),dq={...Id,parse:i=>Id.parse(i)/100,transform:i=>Id.transform(i*100)},dy={test:c2("hsl","hue"),parse:qz("hue","saturation","lightness"),transform:({hue:i,saturation:n,lightness:a,alpha:l=1})=>"hsla("+Math.round(i)+", "+Id.transform(bw(n))+", "+Id.transform(bw(a))+", "+bw(Bw.transform(l))+")"},ci={test:i=>fm.test(i)||DP.test(i)||dy.test(i),parse:i=>fm.test(i)?fm.parse(i):dy.test(i)?dy.parse(i):DP.parse(i),transform:i=>typeof i=="string"?i:i.hasOwnProperty("red")?fm.transform(i):dy.transform(i),getAnimatableNone:i=>{const n=ci.parse(i);return n.alpha=0,ci.transform(n)}},e_e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function t_e(i){var n,a;return isNaN(i)&&typeof i=="string"&&(((n=i.match(o2))==null?void 0:n.length)||0)+(((a=i.match(e_e))==null?void 0:a.length)||0)>0}const Gz="number",Hz="color",r_e="var",n_e="var(",uq="${}",s_e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ww(i){const n=i.toString(),a=[],l={color:[],number:[],var:[]},u=[];let m=0;const w=n.replace(s_e,b=>(ci.test(b)?(l.color.push(m),u.push(Hz),a.push(ci.parse(b))):b.startsWith(n_e)?(l.var.push(m),u.push(r_e),a.push(b)):(l.number.push(m),u.push(Gz),a.push(parseFloat(b))),++m,uq)).split(uq);return{values:a,split:w,indexes:l,types:u}}function Kz(i){return Ww(i).values}function zz(i){const{split:n,types:a}=Ww(i),l=n.length;return u=>{let m="";for(let y=0;y<l;y++)if(m+=n[y],u[y]!==void 0){const w=a[y];w===Gz?m+=bw(u[y]):w===Hz?m+=ci.transform(u[y]):m+=u[y]}return m}}const i_e=i=>typeof i=="number"?0:ci.test(i)?ci.getAnimatableNone(i):i;function a_e(i){const n=Kz(i);return zz(i)(n.map(i_e))}const vp={test:t_e,parse:Kz,createTransformer:zz,getAnimatableNone:a_e};function Ck(i,n,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?i+(n-i)*6*a:a<1/2?n:a<2/3?i+(n-i)*(2/3-a)*6:i}function o_e({hue:i,saturation:n,lightness:a,alpha:l}){i/=360,n/=100,a/=100;let u=0,m=0,y=0;if(!n)u=m=y=a;else{const w=a<.5?a*(1+n):a+n-a*n,b=2*a-w;u=Ck(b,w,i+1/3),m=Ck(b,w,i),y=Ck(b,w,i-1/3)}return{red:Math.round(u*255),green:Math.round(m*255),blue:Math.round(y*255),alpha:l}}function yR(i,n){return a=>a>0?n:i}const Ps=(i,n,a)=>i+(n-i)*a,Rk=(i,n,a)=>{const l=i*i,u=a*(n*n-l)+l;return u<0?0:Math.sqrt(u)},c_e=[DP,fm,dy],l_e=i=>c_e.find(n=>n.test(i));function hq(i){const n=l_e(i);if(!n)return!1;let a=n.parse(i);return n===dy&&(a=o_e(a)),a}const pq=(i,n)=>{const a=hq(i),l=hq(n);if(!a||!l)return yR(i,n);const u={...a};return m=>(u.red=Rk(a.red,l.red,m),u.green=Rk(a.green,l.green,m),u.blue=Rk(a.blue,l.blue,m),u.alpha=Ps(a.alpha,l.alpha,m),fm.transform(u))},jP=new Set(["none","hidden"]);function d_e(i,n){return jP.has(i)?a=>a<=0?i:n:a=>a>=1?n:i}function u_e(i,n){return a=>Ps(i,n,a)}function l2(i){return typeof i=="number"?u_e:typeof i=="string"?a2(i)?yR:ci.test(i)?pq:f_e:Array.isArray(i)?$z:typeof i=="object"?ci.test(i)?pq:h_e:yR}function $z(i,n){const a=[...i],l=a.length,u=i.map((m,y)=>l2(m)(m,n[y]));return m=>{for(let y=0;y<l;y++)a[y]=u[y](m);return a}}function h_e(i,n){const a={...i,...n},l={};for(const u in a)i[u]!==void 0&&n[u]!==void 0&&(l[u]=l2(i[u])(i[u],n[u]));return u=>{for(const m in l)a[m]=l[m](u);return a}}function p_e(i,n){const a=[],l={color:0,var:0,number:0};for(let u=0;u<n.values.length;u++){const m=n.types[u],y=i.indexes[m][l[m]],w=i.values[y]??0;a[u]=w,l[m]++}return a}const f_e=(i,n)=>{const a=vp.createTransformer(n),l=Ww(i),u=Ww(n);return l.indexes.var.length===u.indexes.var.length&&l.indexes.color.length===u.indexes.color.length&&l.indexes.number.length>=u.indexes.number.length?jP.has(i)&&!u.values.length||jP.has(n)&&!l.values.length?d_e(i,n):ab($z(p_e(l,u),u.values),a):yR(i,n)};function Yz(i,n,a){return typeof i=="number"&&typeof n=="number"&&typeof a=="number"?Ps(i,n,a):l2(i)(i,n)}const m_e=i=>{const n=({timestamp:a})=>i(a);return{start:(a=!0)=>ws.update(n,a),stop:()=>yp(n),now:()=>Yi.isProcessing?Yi.timestamp:ho.now()}},Xz=(i,n,a=10)=>{let l="";const u=Math.max(Math.round(n/a),2);for(let m=0;m<u;m++)l+=Math.round(i(m/(u-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},vR=2e4;function d2(i){let n=0;const a=50;let l=i.next(n);for(;!l.done&&n<vR;)n+=a,l=i.next(n);return n>=vR?1/0:n}function g_e(i,n=100,a){const l=a({...i,keyframes:[0,n]}),u=Math.min(d2(l),vR);return{type:"keyframes",ease:m=>l.next(u*m).value/n,duration:Ac(u)}}const __e=5;function Jz(i,n,a){const l=Math.max(n-__e,0);return Iz(a-i(l),n-l)}const Hs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Nk=.001;function y_e({duration:i=Hs.duration,bounce:n=Hs.bounce,velocity:a=Hs.velocity,mass:l=Hs.mass}){let u,m,y=1-n;y=Pu(Hs.minDamping,Hs.maxDamping,y),i=Pu(Hs.minDuration,Hs.maxDuration,Ac(i)),y<1?(u=x=>{const T=x*y,N=T*i,O=T-a,P=LP(x,y),F=Math.exp(-N);return Nk-O/P*F},m=x=>{const N=x*y*i,O=N*a+a,P=Math.pow(y,2)*Math.pow(x,2)*i,F=Math.exp(-N),z=LP(Math.pow(x,2),y);return(-u(x)+Nk>0?-1:1)*((O-P)*F)/z}):(u=x=>{const T=Math.exp(-x*i),N=(x-a)*i+1;return-Nk+T*N},m=x=>{const T=Math.exp(-x*i),N=(a-x)*(i*i);return T*N});const w=5/i,b=E_e(u,m,w);if(i=Ad(i),isNaN(b))return{stiffness:Hs.stiffness,damping:Hs.damping,duration:i};{const x=Math.pow(b,2)*l;return{stiffness:x,damping:y*2*Math.sqrt(l*x),duration:i}}}const v_e=12;function E_e(i,n,a){let l=a;for(let u=1;u<v_e;u++)l=l-i(l)/n(l);return l}function LP(i,n){return i*Math.sqrt(1-n*n)}const w_e=["duration","bounce"],b_e=["stiffness","damping","mass"];function fq(i,n){return n.some(a=>i[a]!==void 0)}function S_e(i){let n={velocity:Hs.velocity,stiffness:Hs.stiffness,damping:Hs.damping,mass:Hs.mass,isResolvedFromDuration:!1,...i};if(!fq(i,b_e)&&fq(i,w_e))if(i.visualDuration){const a=i.visualDuration,l=2*Math.PI/(a*1.2),u=l*l,m=2*Pu(.05,1,1-(i.bounce||0))*Math.sqrt(u);n={...n,mass:Hs.mass,stiffness:u,damping:m}}else{const a=y_e(i);n={...n,...a,mass:Hs.mass},n.isResolvedFromDuration=!0}return n}function ER(i=Hs.visualDuration,n=Hs.bounce){const a=typeof i!="object"?{visualDuration:i,keyframes:[0,1],bounce:n}:i;let{restSpeed:l,restDelta:u}=a;const m=a.keyframes[0],y=a.keyframes[a.keyframes.length-1],w={done:!1,value:m},{stiffness:b,damping:x,mass:T,duration:N,velocity:O,isResolvedFromDuration:P}=S_e({...a,velocity:-Ac(a.velocity||0)}),F=O||0,z=x/(2*Math.sqrt(b*T)),V=y-m,W=Ac(Math.sqrt(b/T)),te=Math.abs(V)<5;l||(l=te?Hs.restSpeed.granular:Hs.restSpeed.default),u||(u=te?Hs.restDelta.granular:Hs.restDelta.default);let $;if(z<1){const G=LP(W,z);$=se=>{const ie=Math.exp(-z*W*se);return y-ie*((F+z*W*V)/G*Math.sin(G*se)+V*Math.cos(G*se))}}else if(z===1)$=G=>y-Math.exp(-W*G)*(V+(F+W*V)*G);else{const G=W*Math.sqrt(z*z-1);$=se=>{const ie=Math.exp(-z*W*se),ce=Math.min(G*se,300);return y-ie*((F+z*W*V)*Math.sinh(ce)+G*V*Math.cosh(ce))/G}}const Q={calculatedDuration:P&&N||null,next:G=>{const se=$(G);if(P)w.done=G>=N;else{let ie=G===0?F:0;z<1&&(ie=G===0?Ad(F):Jz($,G,se));const ce=Math.abs(ie)<=l,Se=Math.abs(y-se)<=u;w.done=ce&&Se}return w.value=w.done?y:se,w},toString:()=>{const G=Math.min(d2(Q),vR),se=Xz(ie=>Q.next(G*ie).value,G,30);return G+"ms "+se},toTransition:()=>{}};return Q}ER.applyToOptions=i=>{const n=g_e(i,100,ER);return i.ease=n.ease,i.duration=Ad(n.duration),i.type="keyframes",i};function MP({keyframes:i,velocity:n=0,power:a=.8,timeConstant:l=325,bounceDamping:u=10,bounceStiffness:m=500,modifyTarget:y,min:w,max:b,restDelta:x=.5,restSpeed:T}){const N=i[0],O={done:!1,value:N},P=ce=>w!==void 0&&ce<w||b!==void 0&&ce>b,F=ce=>w===void 0?b:b===void 0||Math.abs(w-ce)<Math.abs(b-ce)?w:b;let z=a*n;const V=N+z,W=y===void 0?V:y(V);W!==V&&(z=W-N);const te=ce=>-z*Math.exp(-ce/l),$=ce=>W+te(ce),Q=ce=>{const Se=te(ce),oe=$(ce);O.done=Math.abs(Se)<=x,O.value=O.done?W:oe};let G,se;const ie=ce=>{P(O.value)&&(G=ce,se=ER({keyframes:[O.value,F(O.value)],velocity:Jz($,ce,O.value),damping:u,stiffness:m,restDelta:x,restSpeed:T}))};return ie(0),{calculatedDuration:null,next:ce=>{let Se=!1;return!se&&G===void 0&&(Se=!0,Q(ce),ie(ce)),G!==void 0&&ce>=G?se.next(ce-G):(!Se&&Q(ce),O)}}}function x_e(i,n,a){const l=[],u=a||Du.mix||Yz,m=i.length-1;for(let y=0;y<m;y++){let w=u(i[y],i[y+1]);if(n){const b=Array.isArray(n)?n[y]||kc:n;w=ab(b,w)}l.push(w)}return l}function T_e(i,n,{clamp:a=!0,ease:l,mixer:u}={}){const m=i.length;if(e2(m===n.length),m===1)return()=>n[0];if(m===2&&n[0]===n[1])return()=>n[1];const y=i[0]===i[1];i[0]>i[m-1]&&(i=[...i].reverse(),n=[...n].reverse());const w=x_e(n,l,u),b=w.length,x=T=>{if(y&&T<i[0])return n[0];let N=0;if(b>1)for(;N<i.length-2&&!(T<i[N+1]);N++);const O=Vw(i[N],i[N+1],T);return w[N](O)};return a?T=>x(Pu(i[0],i[m-1],T)):x}function C_e(i,n){const a=i[i.length-1];for(let l=1;l<=n;l++){const u=Vw(0,n,l);i.push(Ps(a,1,u))}}function R_e(i){const n=[0];return C_e(n,i.length-1),n}function N_e(i,n){return i.map(a=>a*n)}function A_e(i,n){return i.map(()=>n||Fz).splice(0,i.length-1)}function Sw({duration:i=300,keyframes:n,times:a,ease:l="easeInOut"}){const u=Vge(l)?l.map(lq):lq(l),m={done:!1,value:n[0]},y=N_e(a&&a.length===n.length?a:R_e(n),i),w=T_e(y,n,{ease:Array.isArray(u)?u:A_e(n,u)});return{calculatedDuration:i,next:b=>(m.value=w(b),m.done=b>=i,m)}}const I_e=i=>i!==null;function u2(i,{repeat:n,repeatType:a="loop"},l,u=1){const m=i.filter(I_e),w=u<0||n&&a!=="loop"&&n%2===1?0:m.length-1;return!w||l===void 0?m[w]:l}const O_e={decay:MP,inertia:MP,tween:Sw,keyframes:Sw,spring:ER};function Qz(i){typeof i.type=="string"&&(i.type=O_e[i.type])}class h2{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(n=>{this.resolve=n})}notifyFinished(){this.resolve()}then(n,a){return this.finished.then(n,a)}}const k_e=i=>i/100;class p2 extends h2{constructor(n){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var l,u;const{motionValue:a}=this.options;a&&a.updatedAt!==ho.now()&&this.tick(ho.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(u=(l=this.options).onStop)==null||u.call(l))},this.options=n,this.initAnimation(),this.play(),n.autoplay===!1&&this.pause()}initAnimation(){const{options:n}=this;Qz(n);const{type:a=Sw,repeat:l=0,repeatDelay:u=0,repeatType:m,velocity:y=0}=n;let{keyframes:w}=n;const b=a||Sw;b!==Sw&&typeof w[0]!="number"&&(this.mixKeyframes=ab(k_e,Yz(w[0],w[1])),w=[0,100]);const x=b({...n,keyframes:w});m==="mirror"&&(this.mirroredGenerator=b({...n,keyframes:[...w].reverse(),velocity:-y})),x.calculatedDuration===null&&(x.calculatedDuration=d2(x));const{calculatedDuration:T}=x;this.calculatedDuration=T,this.resolvedDuration=T+u,this.totalDuration=this.resolvedDuration*(l+1)-u,this.generator=x}updateTime(n){const a=Math.round(n-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=a}tick(n,a=!1){const{generator:l,totalDuration:u,mixKeyframes:m,mirroredGenerator:y,resolvedDuration:w,calculatedDuration:b}=this;if(this.startTime===null)return l.next(0);const{delay:x=0,keyframes:T,repeat:N,repeatType:O,repeatDelay:P,type:F,onUpdate:z,finalKeyframe:V}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,n):this.speed<0&&(this.startTime=Math.min(n-u/this.speed,this.startTime)),a?this.currentTime=n:this.updateTime(n);const W=this.currentTime-x*(this.playbackSpeed>=0?1:-1),te=this.playbackSpeed>=0?W<0:W>u;this.currentTime=Math.max(W,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let $=this.currentTime,Q=l;if(N){const ce=Math.min(this.currentTime,u)/w;let Se=Math.floor(ce),oe=ce%1;!oe&&ce>=1&&(oe=1),oe===1&&Se--,Se=Math.min(Se,N+1),!!(Se%2)&&(O==="reverse"?(oe=1-oe,P&&(oe-=P/w)):O==="mirror"&&(Q=y)),$=Pu(0,1,oe)*w}const G=te?{done:!1,value:T[0]}:Q.next($);m&&(G.value=m(G.value));let{done:se}=G;!te&&b!==null&&(se=this.playbackSpeed>=0?this.currentTime>=u:this.currentTime<=0);const ie=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&se);return ie&&F!==MP&&(G.value=u2(T,this.options,V,this.speed)),z&&z(G.value),ie&&this.finish(),G}then(n,a){return this.finished.then(n,a)}get duration(){return Ac(this.calculatedDuration)}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+Ac(n)}get time(){return Ac(this.currentTime)}set time(n){var a;n=Ad(n),this.currentTime=n,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=n:this.driver&&(this.startTime=this.driver.now()-n/this.playbackSpeed),(a=this.driver)==null||a.start(!1)}get speed(){return this.playbackSpeed}set speed(n){this.updateTime(ho.now());const a=this.playbackSpeed!==n;this.playbackSpeed=n,a&&(this.time=Ac(this.currentTime))}play(){var u,m;if(this.isStopped)return;const{driver:n=m_e,startTime:a}=this.options;this.driver||(this.driver=n(y=>this.tick(y))),(m=(u=this.options).onPlay)==null||m.call(u);const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=a??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ho.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var n,a;this.notifyFinished(),this.teardown(),this.state="finished",(a=(n=this.options).onComplete)==null||a.call(n)}cancel(){var n,a;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(a=(n=this.options).onCancel)==null||a.call(n)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(n){return this.startTime=0,this.tick(n,!0)}attachTimeline(n){var a;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(a=this.driver)==null||a.stop(),n.observe(this)}}function P_e(i){for(let n=1;n<i.length;n++)i[n]??(i[n]=i[n-1])}const mm=i=>i*180/Math.PI,UP=i=>{const n=mm(Math.atan2(i[1],i[0]));return FP(n)},D_e={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:i=>(Math.abs(i[0])+Math.abs(i[3]))/2,rotate:UP,rotateZ:UP,skewX:i=>mm(Math.atan(i[1])),skewY:i=>mm(Math.atan(i[2])),skew:i=>(Math.abs(i[1])+Math.abs(i[2]))/2},FP=i=>(i=i%360,i<0&&(i+=360),i),mq=UP,gq=i=>Math.sqrt(i[0]*i[0]+i[1]*i[1]),_q=i=>Math.sqrt(i[4]*i[4]+i[5]*i[5]),j_e={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:gq,scaleY:_q,scale:i=>(gq(i)+_q(i))/2,rotateX:i=>FP(mm(Math.atan2(i[6],i[5]))),rotateY:i=>FP(mm(Math.atan2(-i[2],i[0]))),rotateZ:mq,rotate:mq,skewX:i=>mm(Math.atan(i[4])),skewY:i=>mm(Math.atan(i[1])),skew:i=>(Math.abs(i[1])+Math.abs(i[4]))/2};function VP(i){return i.includes("scale")?1:0}function BP(i,n){if(!i||i==="none")return VP(n);const a=i.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,u;if(a)l=j_e,u=a;else{const w=i.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=D_e,u=w}if(!u)return VP(n);const m=l[n],y=u[1].split(",").map(M_e);return typeof m=="function"?m(y):y[m]}const L_e=(i,n)=>{const{transform:a="none"}=getComputedStyle(i);return BP(a,n)};function M_e(i){return parseFloat(i.trim())}const Qy=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Zy=new Set(Qy),yq=i=>i===Jy||i===Nr,U_e=new Set(["x","y","z"]),F_e=Qy.filter(i=>!U_e.has(i));function V_e(i){const n=[];return F_e.forEach(a=>{const l=i.getValue(a);l!==void 0&&(n.push([a,l.get()]),l.set(a.startsWith("scale")?1:0))}),n}const Im={width:({x:i},{paddingLeft:n="0",paddingRight:a="0"})=>i.max-i.min-parseFloat(n)-parseFloat(a),height:({y:i},{paddingTop:n="0",paddingBottom:a="0"})=>i.max-i.min-parseFloat(n)-parseFloat(a),top:(i,{top:n})=>parseFloat(n),left:(i,{left:n})=>parseFloat(n),bottom:({y:i},{top:n})=>parseFloat(n)+(i.max-i.min),right:({x:i},{left:n})=>parseFloat(n)+(i.max-i.min),x:(i,{transform:n})=>BP(n,"x"),y:(i,{transform:n})=>BP(n,"y")};Im.translateX=Im.x;Im.translateY=Im.y;const Om=new Set;let WP=!1,qP=!1,GP=!1;function Zz(){if(qP){const i=Array.from(Om).filter(l=>l.needsMeasurement),n=new Set(i.map(l=>l.element)),a=new Map;n.forEach(l=>{const u=V_e(l);u.length&&(a.set(l,u),l.render())}),i.forEach(l=>l.measureInitialState()),n.forEach(l=>{l.render();const u=a.get(l);u&&u.forEach(([m,y])=>{var w;(w=l.getValue(m))==null||w.set(y)})}),i.forEach(l=>l.measureEndState()),i.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}qP=!1,WP=!1,Om.forEach(i=>i.complete(GP)),Om.clear()}function e$(){Om.forEach(i=>{i.readKeyframes(),i.needsMeasurement&&(qP=!0)})}function B_e(){GP=!0,e$(),Zz(),GP=!1}class f2{constructor(n,a,l,u,m,y=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...n],this.onComplete=a,this.name=l,this.motionValue=u,this.element=m,this.isAsync=y}scheduleResolve(){this.state="scheduled",this.isAsync?(Om.add(this),WP||(WP=!0,ws.read(e$),ws.resolveKeyframes(Zz))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:n,name:a,element:l,motionValue:u}=this;if(n[0]===null){const m=u==null?void 0:u.get(),y=n[n.length-1];if(m!==void 0)n[0]=m;else if(l&&a){const w=l.readValue(a,y);w!=null&&(n[0]=w)}n[0]===void 0&&(n[0]=y),u&&m===void 0&&u.set(n[0])}P_e(n)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(n=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,n),Om.delete(this)}cancel(){this.state==="scheduled"&&(Om.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const W_e=i=>i.startsWith("--");function q_e(i,n,a){W_e(n)?i.style.setProperty(n,a):i.style[n]=a}const G_e=t2(()=>window.ScrollTimeline!==void 0),H_e={};function K_e(i,n){const a=t2(i);return()=>H_e[n]??a()}const t$=K_e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),_w=([i,n,a,l])=>`cubic-bezier(${i}, ${n}, ${a}, ${l})`,vq={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:_w([0,.65,.55,1]),circOut:_w([.55,0,1,.45]),backIn:_w([.31,.01,.66,-.59]),backOut:_w([.33,1.53,.69,.99])};function r$(i,n){if(i)return typeof i=="function"?t$()?Xz(i,n):"ease-out":Vz(i)?_w(i):Array.isArray(i)?i.map(a=>r$(a,n)||vq.easeOut):vq[i]}function z_e(i,n,a,{delay:l=0,duration:u=300,repeat:m=0,repeatType:y="loop",ease:w="easeOut",times:b}={},x=void 0){const T={[n]:a};b&&(T.offset=b);const N=r$(w,u);Array.isArray(N)&&(T.easing=N);const O={delay:l,duration:u,easing:Array.isArray(N)?"linear":N,fill:"both",iterations:m+1,direction:y==="reverse"?"alternate":"normal"};return x&&(O.pseudoElement=x),i.animate(T,O)}function n$(i){return typeof i=="function"&&"applyToOptions"in i}function $_e({type:i,...n}){return n$(i)&&t$()?i.applyToOptions(n):(n.duration??(n.duration=300),n.ease??(n.ease="easeOut"),n)}class Y_e extends h2{constructor(n){if(super(),this.finishedTime=null,this.isStopped=!1,!n)return;const{element:a,name:l,keyframes:u,pseudoElement:m,allowFlatten:y=!1,finalKeyframe:w,onComplete:b}=n;this.isPseudoElement=!!m,this.allowFlatten=y,this.options=n,e2(typeof n.type!="string");const x=$_e(n);this.animation=z_e(a,l,u,x,m),x.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!m){const T=u2(u,this.options,w,this.speed);this.updateMotionValue?this.updateMotionValue(T):q_e(a,l,T),this.animation.cancel()}b==null||b(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var n,a;(a=(n=this.animation).finish)==null||a.call(n)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:n}=this;n==="idle"||n==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,a;this.isPseudoElement||(a=(n=this.animation).commitStyles)==null||a.call(n)}get duration(){var a,l;const n=((l=(a=this.animation.effect)==null?void 0:a.getComputedTiming)==null?void 0:l.call(a).duration)||0;return Ac(Number(n))}get iterationDuration(){const{delay:n=0}=this.options||{};return this.duration+Ac(n)}get time(){return Ac(Number(this.animation.currentTime)||0)}set time(n){this.finishedTime=null,this.animation.currentTime=Ad(n)}get speed(){return this.animation.playbackRate}set speed(n){n<0&&(this.finishedTime=null),this.animation.playbackRate=n}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(n){this.animation.startTime=n}attachTimeline({timeline:n,observe:a}){var l;return this.allowFlatten&&((l=this.animation.effect)==null||l.updateTiming({easing:"linear"})),this.animation.onfinish=null,n&&G_e()?(this.animation.timeline=n,kc):a(this)}}const s$={anticipate:Lz,backInOut:jz,circInOut:Uz};function X_e(i){return i in s$}function J_e(i){typeof i.ease=="string"&&X_e(i.ease)&&(i.ease=s$[i.ease])}const Eq=10;class Q_e extends Y_e{constructor(n){J_e(n),Qz(n),super(n),n.startTime&&(this.startTime=n.startTime),this.options=n}updateMotionValue(n){const{motionValue:a,onUpdate:l,onComplete:u,element:m,...y}=this.options;if(!a)return;if(n!==void 0){a.set(n);return}const w=new p2({...y,autoplay:!1}),b=Ad(this.finishedTime??this.time);a.setWithVelocity(w.sample(b-Eq).value,w.sample(b).value,Eq),w.stop()}}const wq=(i,n)=>n==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(vp.test(i)||i==="0")&&!i.startsWith("url("));function Z_e(i){const n=i[0];if(i.length===1)return!0;for(let a=0;a<i.length;a++)if(i[a]!==n)return!0}function eye(i,n,a,l){const u=i[0];if(u===null)return!1;if(n==="display"||n==="visibility")return!0;const m=i[i.length-1],y=wq(u,n),w=wq(m,n);return!y||!w?!1:Z_e(i)||(a==="spring"||n$(a))&&l}function HP(i){i.duration=0,i.type="keyframes"}const tye=new Set(["opacity","clipPath","filter","transform"]),rye=t2(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function nye(i){var T;const{motionValue:n,name:a,repeatDelay:l,repeatType:u,damping:m,type:y}=i;if(!(((T=n==null?void 0:n.owner)==null?void 0:T.current)instanceof HTMLElement))return!1;const{onUpdate:b,transformTemplate:x}=n.owner.getProps();return rye()&&a&&tye.has(a)&&(a!=="transform"||!x)&&!b&&!l&&u!=="mirror"&&m!==0&&y!=="inertia"}const sye=40;class iye extends h2{constructor({autoplay:n=!0,delay:a=0,type:l="keyframes",repeat:u=0,repeatDelay:m=0,repeatType:y="loop",keyframes:w,name:b,motionValue:x,element:T,...N}){var F;super(),this.stop=()=>{var z,V;this._animation&&(this._animation.stop(),(z=this.stopTimeline)==null||z.call(this)),(V=this.keyframeResolver)==null||V.cancel()},this.createdAt=ho.now();const O={autoplay:n,delay:a,type:l,repeat:u,repeatDelay:m,repeatType:y,name:b,motionValue:x,element:T,...N},P=(T==null?void 0:T.KeyframeResolver)||f2;this.keyframeResolver=new P(w,(z,V,W)=>this.onKeyframesResolved(z,V,O,!W),b,x,T),(F=this.keyframeResolver)==null||F.scheduleResolve()}onKeyframesResolved(n,a,l,u){this.keyframeResolver=void 0;const{name:m,type:y,velocity:w,delay:b,isHandoff:x,onUpdate:T}=l;this.resolvedAt=ho.now(),eye(n,m,y,w)||((Du.instantAnimations||!b)&&(T==null||T(u2(n,l,a))),n[0]=n[n.length-1],HP(l),l.repeat=0);const O={startTime:u?this.resolvedAt?this.resolvedAt-this.createdAt>sye?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:a,...l,keyframes:n},P=!x&&nye(O)?new Q_e({...O,element:O.motionValue.owner.current}):new p2(O);P.finished.then(()=>this.notifyFinished()).catch(kc),this.pendingTimeline&&(this.stopTimeline=P.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=P}get finished(){return this._animation?this.animation.finished:this._finished}then(n,a){return this.finished.finally(n).then(()=>{})}get animation(){var n;return this._animation||((n=this.keyframeResolver)==null||n.resume(),B_e()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(n){this.animation.time=n}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(n){this.animation.speed=n}get startTime(){return this.animation.startTime}attachTimeline(n){return this._animation?this.stopTimeline=this.animation.attachTimeline(n):this.pendingTimeline=n,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var n;this._animation&&this.animation.cancel(),(n=this.keyframeResolver)==null||n.cancel()}}const aye=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function oye(i){const n=aye.exec(i);if(!n)return[,];const[,a,l,u]=n;return[`--${a??l}`,u]}function i$(i,n,a=1){const[l,u]=oye(i);if(!l)return;const m=window.getComputedStyle(n).getPropertyValue(l);if(m){const y=m.trim();return Rz(y)?parseFloat(y):y}return a2(u)?i$(u,n,a+1):u}function m2(i,n){return(i==null?void 0:i[n])??(i==null?void 0:i.default)??i}const a$=new Set(["width","height","top","left","right","bottom",...Qy]),cye={test:i=>i==="auto",parse:i=>i},o$=i=>n=>n.test(i),c$=[Jy,Nr,Id,Xh,Zge,Qge,cye],bq=i=>c$.find(o$(i));function lye(i){return typeof i=="number"?i===0:i!==null?i==="none"||i==="0"||Az(i):!0}const dye=new Set(["brightness","contrast","saturate","opacity"]);function uye(i){const[n,a]=i.slice(0,-1).split("(");if(n==="drop-shadow")return i;const[l]=a.match(o2)||[];if(!l)return i;const u=a.replace(l,"");let m=dye.has(n)?1:0;return l!==a&&(m*=100),n+"("+m+u+")"}const hye=/\b([a-z-]*)\(.*?\)/gu,KP={...vp,getAnimatableNone:i=>{const n=i.match(hye);return n?n.map(uye).join(" "):i}},Sq={...Jy,transform:Math.round},pye={rotate:Xh,rotateX:Xh,rotateY:Xh,rotateZ:Xh,scale:jC,scaleX:jC,scaleY:jC,scaleZ:jC,skew:Xh,skewX:Xh,skewY:Xh,distance:Nr,translateX:Nr,translateY:Nr,translateZ:Nr,x:Nr,y:Nr,z:Nr,perspective:Nr,transformPerspective:Nr,opacity:Bw,originX:dq,originY:dq,originZ:Nr},g2={borderWidth:Nr,borderTopWidth:Nr,borderRightWidth:Nr,borderBottomWidth:Nr,borderLeftWidth:Nr,borderRadius:Nr,radius:Nr,borderTopLeftRadius:Nr,borderTopRightRadius:Nr,borderBottomRightRadius:Nr,borderBottomLeftRadius:Nr,width:Nr,maxWidth:Nr,height:Nr,maxHeight:Nr,top:Nr,right:Nr,bottom:Nr,left:Nr,padding:Nr,paddingTop:Nr,paddingRight:Nr,paddingBottom:Nr,paddingLeft:Nr,margin:Nr,marginTop:Nr,marginRight:Nr,marginBottom:Nr,marginLeft:Nr,backgroundPositionX:Nr,backgroundPositionY:Nr,...pye,zIndex:Sq,fillOpacity:Bw,strokeOpacity:Bw,numOctaves:Sq},fye={...g2,color:ci,backgroundColor:ci,outlineColor:ci,fill:ci,stroke:ci,borderColor:ci,borderTopColor:ci,borderRightColor:ci,borderBottomColor:ci,borderLeftColor:ci,filter:KP,WebkitFilter:KP},l$=i=>fye[i];function d$(i,n){let a=l$(i);return a!==KP&&(a=vp),a.getAnimatableNone?a.getAnimatableNone(n):void 0}const mye=new Set(["auto","none","0"]);function gye(i,n,a){let l=0,u;for(;l<i.length&&!u;){const m=i[l];typeof m=="string"&&!mye.has(m)&&Ww(m).values.length&&(u=i[l]),l++}if(u&&a)for(const m of n)i[m]=d$(a,u)}class _ye extends f2{constructor(n,a,l,u,m){super(n,a,l,u,m,!0)}readKeyframes(){const{unresolvedKeyframes:n,element:a,name:l}=this;if(!a||!a.current)return;super.readKeyframes();for(let b=0;b<n.length;b++){let x=n[b];if(typeof x=="string"&&(x=x.trim(),a2(x))){const T=i$(x,a.current);T!==void 0&&(n[b]=T),b===n.length-1&&(this.finalKeyframe=x)}}if(this.resolveNoneKeyframes(),!a$.has(l)||n.length!==2)return;const[u,m]=n,y=bq(u),w=bq(m);if(y!==w)if(yq(y)&&yq(w))for(let b=0;b<n.length;b++){const x=n[b];typeof x=="string"&&(n[b]=parseFloat(x))}else Im[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:n,name:a}=this,l=[];for(let u=0;u<n.length;u++)(n[u]===null||lye(n[u]))&&l.push(u);l.length&&gye(n,l,a)}measureInitialState(){const{element:n,unresolvedKeyframes:a,name:l}=this;if(!n||!n.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Im[l](n.measureViewportBox(),window.getComputedStyle(n.current)),a[0]=this.measuredOrigin;const u=a[a.length-1];u!==void 0&&n.getValue(l,u).jump(u,!1)}measureEndState(){var w;const{element:n,name:a,unresolvedKeyframes:l}=this;if(!n||!n.current)return;const u=n.getValue(a);u&&u.jump(this.measuredOrigin,!1);const m=l.length-1,y=l[m];l[m]=Im[a](n.measureViewportBox(),window.getComputedStyle(n.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),(w=this.removedTransforms)!=null&&w.length&&this.removedTransforms.forEach(([b,x])=>{n.getValue(b).set(x)}),this.resolveNoneKeyframes()}}function yye(i,n,a){if(i instanceof EventTarget)return[i];if(typeof i=="string"){let l=document;const u=(a==null?void 0:a[i])??l.querySelectorAll(i);return u?Array.from(u):[]}return Array.from(i)}const u$=(i,n)=>n&&typeof i=="number"?n.transform(i):i;function h$(i){return Nz(i)&&"offsetHeight"in i}const xq=30,vye=i=>!isNaN(parseFloat(i));class Eye{constructor(n,a={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{var m;const u=ho.now();if(this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&((m=this.events.change)==null||m.notify(this.current),this.dependents))for(const y of this.dependents)y.dirty()},this.hasAnimated=!1,this.setCurrent(n),this.owner=a.owner}setCurrent(n){this.current=n,this.updatedAt=ho.now(),this.canTrackVelocity===null&&n!==void 0&&(this.canTrackVelocity=vye(this.current))}setPrevFrameValue(n=this.current){this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt}onChange(n){return this.on("change",n)}on(n,a){this.events[n]||(this.events[n]=new r2);const l=this.events[n].add(a);return n==="change"?()=>{l(),ws.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const n in this.events)this.events[n].clear()}attach(n,a){this.passiveEffect=n,this.stopPassiveEffect=a}set(n){this.passiveEffect?this.passiveEffect(n,this.updateAndNotify):this.updateAndNotify(n)}setWithVelocity(n,a,l){this.set(a),this.prev=void 0,this.prevFrameValue=n,this.prevUpdatedAt=this.updatedAt-l}jump(n,a=!0){this.updateAndNotify(n),this.prev=n,this.prevUpdatedAt=this.prevFrameValue=void 0,a&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var n;(n=this.events.change)==null||n.notify(this.current)}addDependent(n){this.dependents||(this.dependents=new Set),this.dependents.add(n)}removeDependent(n){this.dependents&&this.dependents.delete(n)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const n=ho.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||n-this.updatedAt>xq)return 0;const a=Math.min(this.updatedAt-this.prevUpdatedAt,xq);return Iz(parseFloat(this.current)-parseFloat(this.prevFrameValue),a)}start(n){return this.stop(),new Promise(a=>{this.hasAnimated=!0,this.animation=n(a),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var n,a;(n=this.dependents)==null||n.clear(),(a=this.events.destroy)==null||a.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function By(i,n){return new Eye(i,n)}const{schedule:_2}=Bz(queueMicrotask,!1),El={x:!1,y:!1};function p$(){return El.x||El.y}function wye(i){return i==="x"||i==="y"?El[i]?null:(El[i]=!0,()=>{El[i]=!1}):El.x||El.y?null:(El.x=El.y=!0,()=>{El.x=El.y=!1})}function f$(i,n){const a=yye(i),l=new AbortController,u={passive:!0,...n,signal:l.signal};return[a,u,()=>l.abort()]}function Tq(i){return!(i.pointerType==="touch"||p$())}function bye(i,n,a={}){const[l,u,m]=f$(i,a),y=w=>{if(!Tq(w))return;const{target:b}=w,x=n(b,w);if(typeof x!="function"||!b)return;const T=N=>{Tq(N)&&(x(N),b.removeEventListener("pointerleave",T))};b.addEventListener("pointerleave",T,u)};return l.forEach(w=>{w.addEventListener("pointerenter",y,u)}),m}const m$=(i,n)=>n?i===n?!0:m$(i,n.parentElement):!1,y2=i=>i.pointerType==="mouse"?typeof i.button!="number"||i.button<=0:i.isPrimary!==!1,Sye=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function xye(i){return Sye.has(i.tagName)||i.tabIndex!==-1}const $C=new WeakSet;function Cq(i){return n=>{n.key==="Enter"&&i(n)}}function Ak(i,n){i.dispatchEvent(new PointerEvent("pointer"+n,{isPrimary:!0,bubbles:!0}))}const Tye=(i,n)=>{const a=i.currentTarget;if(!a)return;const l=Cq(()=>{if($C.has(a))return;Ak(a,"down");const u=Cq(()=>{Ak(a,"up")}),m=()=>Ak(a,"cancel");a.addEventListener("keyup",u,n),a.addEventListener("blur",m,n)});a.addEventListener("keydown",l,n),a.addEventListener("blur",()=>a.removeEventListener("keydown",l),n)};function Rq(i){return y2(i)&&!p$()}function Cye(i,n,a={}){const[l,u,m]=f$(i,a),y=w=>{const b=w.currentTarget;if(!Rq(w))return;$C.add(b);const x=n(b,w),T=(P,F)=>{window.removeEventListener("pointerup",N),window.removeEventListener("pointercancel",O),$C.has(b)&&$C.delete(b),Rq(P)&&typeof x=="function"&&x(P,{success:F})},N=P=>{T(P,b===window||b===document||a.useGlobalTarget||m$(b,P.target))},O=P=>{T(P,!1)};window.addEventListener("pointerup",N,u),window.addEventListener("pointercancel",O,u)};return l.forEach(w=>{(a.useGlobalTarget?window:w).addEventListener("pointerdown",y,u),h$(w)&&(w.addEventListener("focus",x=>Tye(x,u)),!xye(w)&&!w.hasAttribute("tabindex")&&(w.tabIndex=0))}),m}function g$(i){return Nz(i)&&"ownerSVGElement"in i}function Rye(i){return g$(i)&&i.tagName==="svg"}const fa=i=>!!(i&&i.getVelocity),Nye=[...c$,ci,vp],Aye=i=>Nye.find(o$(i)),v2=M.createContext({transformPagePoint:i=>i,isStatic:!1,reducedMotion:"never"});function Nq(i,n){if(typeof i=="function")return i(n);i!=null&&(i.current=n)}function Iye(...i){return n=>{let a=!1;const l=i.map(u=>{const m=Nq(u,n);return!a&&typeof m=="function"&&(a=!0),m});if(a)return()=>{for(let u=0;u<l.length;u++){const m=l[u];typeof m=="function"?m():Nq(i[u],null)}}}}function Oye(...i){return M.useCallback(Iye(...i),i)}class kye extends M.Component{getSnapshotBeforeUpdate(n){const a=this.props.childRef.current;if(a&&n.isPresent&&!this.props.isPresent){const l=a.offsetParent,u=h$(l)&&l.offsetWidth||0,m=this.props.sizeRef.current;m.height=a.offsetHeight||0,m.width=a.offsetWidth||0,m.top=a.offsetTop,m.left=a.offsetLeft,m.right=u-m.width-m.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Pye({children:i,isPresent:n,anchorX:a,root:l}){const u=M.useId(),m=M.useRef(null),y=M.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:w}=M.useContext(v2),b=Oye(m,i==null?void 0:i.ref);return M.useInsertionEffect(()=>{const{width:x,height:T,top:N,left:O,right:P}=y.current;if(n||!m.current||!x||!T)return;const F=a==="left"?`left: ${O}`:`right: ${P}`;m.current.dataset.motionPopId=u;const z=document.createElement("style");w&&(z.nonce=w);const V=l??document.head;return V.appendChild(z),z.sheet&&z.sheet.insertRule(`
          [data-motion-pop-id="${u}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${T}px !important;
            ${F}px !important;
            top: ${N}px !important;
          }
        `),()=>{V.contains(z)&&V.removeChild(z)}},[n]),o.jsx(kye,{isPresent:n,childRef:m,sizeRef:y,children:M.cloneElement(i,{ref:b})})}const Dye=({children:i,initial:n,isPresent:a,onExitComplete:l,custom:u,presenceAffectsLayout:m,mode:y,anchorX:w,root:b})=>{const x=XD(jye),T=M.useId();let N=!0,O=M.useMemo(()=>(N=!1,{id:T,initial:n,isPresent:a,custom:u,onExitComplete:P=>{x.set(P,!0);for(const F of x.values())if(!F)return;l&&l()},register:P=>(x.set(P,!1),()=>x.delete(P))}),[a,x,l]);return m&&N&&(O={...O}),M.useMemo(()=>{x.forEach((P,F)=>x.set(F,!1))},[a]),M.useEffect(()=>{!a&&!x.size&&l&&l()},[a]),y==="popLayout"&&(i=o.jsx(Pye,{isPresent:a,anchorX:w,root:b,children:i})),o.jsx(qR.Provider,{value:O,children:i})};function jye(){return new Map}function _$(i=!0){const n=M.useContext(qR);if(n===null)return[!0,null];const{isPresent:a,onExitComplete:l,register:u}=n,m=M.useId();M.useEffect(()=>{if(i)return u(m)},[i]);const y=M.useCallback(()=>i&&l&&l(m),[m,l,i]);return!a&&l?[!1,y]:[!0]}const LC=i=>i.key||"";function Aq(i){const n=[];return M.Children.forEach(i,a=>{M.isValidElement(a)&&n.push(a)}),n}const E2=({children:i,custom:n,initial:a=!0,onExitComplete:l,presenceAffectsLayout:u=!0,mode:m="sync",propagate:y=!1,anchorX:w="left",root:b})=>{const[x,T]=_$(y),N=M.useMemo(()=>Aq(i),[i]),O=y&&!x?[]:N.map(LC),P=M.useRef(!0),F=M.useRef(N),z=XD(()=>new Map),[V,W]=M.useState(N),[te,$]=M.useState(N);Cz(()=>{P.current=!1,F.current=N;for(let se=0;se<te.length;se++){const ie=LC(te[se]);O.includes(ie)?z.delete(ie):z.get(ie)!==!0&&z.set(ie,!1)}},[te,O.length,O.join("-")]);const Q=[];if(N!==V){let se=[...N];for(let ie=0;ie<te.length;ie++){const ce=te[ie],Se=LC(ce);O.includes(Se)||(se.splice(ie,0,ce),Q.push(ce))}return m==="wait"&&Q.length&&(se=Q),$(Aq(se)),W(N),null}const{forceRender:G}=M.useContext(YD);return o.jsx(o.Fragment,{children:te.map(se=>{const ie=LC(se),ce=y&&!x?!1:N===te||O.includes(ie),Se=()=>{if(z.has(ie))z.set(ie,!0);else return;let oe=!0;z.forEach(ve=>{ve||(oe=!1)}),oe&&(G==null||G(),$(F.current),y&&(T==null||T()),l&&l())};return o.jsx(Dye,{isPresent:ce,initial:!P.current||a?void 0:!1,custom:n,presenceAffectsLayout:u,mode:m,root:b,onExitComplete:ce?void 0:Se,anchorX:w,children:se},ie)})})},y$=M.createContext({strict:!1}),Iq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Wy={};for(const i in Iq)Wy[i]={isEnabled:n=>Iq[i].some(a=>!!n[a])};function Lye(i){for(const n in i)Wy[n]={...Wy[n],...i[n]}}const Mye=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function wR(i){return i.startsWith("while")||i.startsWith("drag")&&i!=="draggable"||i.startsWith("layout")||i.startsWith("onTap")||i.startsWith("onPan")||i.startsWith("onLayout")||Mye.has(i)}let v$=i=>!wR(i);function Uye(i){typeof i=="function"&&(v$=n=>n.startsWith("on")?!wR(n):i(n))}try{Uye(require("@emotion/is-prop-valid").default)}catch{}function Fye(i,n,a){const l={};for(const u in i)u==="values"&&typeof i.values=="object"||(v$(u)||a===!0&&wR(u)||!n&&!wR(u)||i.draggable&&u.startsWith("onDrag"))&&(l[u]=i[u]);return l}const GR=M.createContext({});function HR(i){return i!==null&&typeof i=="object"&&typeof i.start=="function"}function qw(i){return typeof i=="string"||Array.isArray(i)}const w2=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],b2=["initial",...w2];function KR(i){return HR(i.animate)||b2.some(n=>qw(i[n]))}function E$(i){return!!(KR(i)||i.variants)}function Vye(i,n){if(KR(i)){const{initial:a,animate:l}=i;return{initial:a===!1||qw(a)?a:void 0,animate:qw(l)?l:void 0}}return i.inherit!==!1?n:{}}function Bye(i){const{initial:n,animate:a}=Vye(i,M.useContext(GR));return M.useMemo(()=>({initial:n,animate:a}),[Oq(n),Oq(a)])}function Oq(i){return Array.isArray(i)?i.join(" "):i}const Gw={};function Wye(i){for(const n in i)Gw[n]=i[n],i2(n)&&(Gw[n].isCSSVariable=!0)}function w$(i,{layout:n,layoutId:a}){return Zy.has(i)||i.startsWith("origin")||(n||a!==void 0)&&(!!Gw[i]||i==="opacity")}const qye={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Gye=Qy.length;function Hye(i,n,a){let l="",u=!0;for(let m=0;m<Gye;m++){const y=Qy[m],w=i[y];if(w===void 0)continue;let b=!0;if(typeof w=="number"?b=w===(y.startsWith("scale")?1:0):b=parseFloat(w)===0,!b||a){const x=u$(w,g2[y]);if(!b){u=!1;const T=qye[y]||y;l+=`${T}(${x}) `}a&&(n[y]=x)}}return l=l.trim(),a?l=a(n,u?"":l):u&&(l="none"),l}function S2(i,n,a){const{style:l,vars:u,transformOrigin:m}=i;let y=!1,w=!1;for(const b in n){const x=n[b];if(Zy.has(b)){y=!0;continue}else if(i2(b)){u[b]=x;continue}else{const T=u$(x,g2[b]);b.startsWith("origin")?(w=!0,m[b]=T):l[b]=T}}if(n.transform||(y||a?l.transform=Hye(n,i.transform,a):l.transform&&(l.transform="none")),w){const{originX:b="50%",originY:x="50%",originZ:T=0}=m;l.transformOrigin=`${b} ${x} ${T}`}}const x2=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function b$(i,n,a){for(const l in n)!fa(n[l])&&!w$(l,a)&&(i[l]=n[l])}function Kye({transformTemplate:i},n){return M.useMemo(()=>{const a=x2();return S2(a,n,i),Object.assign({},a.vars,a.style)},[n])}function zye(i,n){const a=i.style||{},l={};return b$(l,a,i),Object.assign(l,Kye(i,n)),l}function $ye(i,n){const a={},l=zye(i,n);return i.drag&&i.dragListener!==!1&&(a.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=i.drag===!0?"none":`pan-${i.drag==="x"?"y":"x"}`),i.tabIndex===void 0&&(i.onTap||i.onTapStart||i.whileTap)&&(a.tabIndex=0),a.style=l,a}const Yye={offset:"stroke-dashoffset",array:"stroke-dasharray"},Xye={offset:"strokeDashoffset",array:"strokeDasharray"};function Jye(i,n,a=1,l=0,u=!0){i.pathLength=1;const m=u?Yye:Xye;i[m.offset]=Nr.transform(-l);const y=Nr.transform(n),w=Nr.transform(a);i[m.array]=`${y} ${w}`}function S$(i,{attrX:n,attrY:a,attrScale:l,pathLength:u,pathSpacing:m=1,pathOffset:y=0,...w},b,x,T){if(S2(i,w,x),b){i.style.viewBox&&(i.attrs.viewBox=i.style.viewBox);return}i.attrs=i.style,i.style={};const{attrs:N,style:O}=i;N.transform&&(O.transform=N.transform,delete N.transform),(O.transform||N.transformOrigin)&&(O.transformOrigin=N.transformOrigin??"50% 50%",delete N.transformOrigin),O.transform&&(O.transformBox=(T==null?void 0:T.transformBox)??"fill-box",delete N.transformBox),n!==void 0&&(N.x=n),a!==void 0&&(N.y=a),l!==void 0&&(N.scale=l),u!==void 0&&Jye(N,u,m,y,!1)}const x$=()=>({...x2(),attrs:{}}),T$=i=>typeof i=="string"&&i.toLowerCase()==="svg";function Qye(i,n,a,l){const u=M.useMemo(()=>{const m=x$();return S$(m,n,T$(l),i.transformTemplate,i.style),{...m.attrs,style:{...m.style}}},[n]);if(i.style){const m={};b$(m,i.style,i),u.style={...m,...u.style}}return u}const Zye=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function T2(i){return typeof i!="string"||i.includes("-")?!1:!!(Zye.indexOf(i)>-1||/[A-Z]/u.test(i))}function e0e(i,n,a,{latestValues:l},u,m=!1){const w=(T2(i)?Qye:$ye)(n,l,u,i),b=Fye(n,typeof i=="string",m),x=i!==M.Fragment?{...b,...w,ref:a}:{},{children:T}=n,N=M.useMemo(()=>fa(T)?T.get():T,[T]);return M.createElement(i,{...x,children:N})}function kq(i){const n=[{},{}];return i==null||i.values.forEach((a,l)=>{n[0][l]=a.get(),n[1][l]=a.getVelocity()}),n}function C2(i,n,a,l){if(typeof n=="function"){const[u,m]=kq(l);n=n(a!==void 0?a:i.custom,u,m)}if(typeof n=="string"&&(n=i.variants&&i.variants[n]),typeof n=="function"){const[u,m]=kq(l);n=n(a!==void 0?a:i.custom,u,m)}return n}function YC(i){return fa(i)?i.get():i}function t0e({scrapeMotionValuesFromProps:i,createRenderState:n},a,l,u){return{latestValues:r0e(a,l,u,i),renderState:n()}}function r0e(i,n,a,l){const u={},m=l(i,{});for(const O in m)u[O]=YC(m[O]);let{initial:y,animate:w}=i;const b=KR(i),x=E$(i);n&&x&&!b&&i.inherit!==!1&&(y===void 0&&(y=n.initial),w===void 0&&(w=n.animate));let T=a?a.initial===!1:!1;T=T||y===!1;const N=T?w:y;if(N&&typeof N!="boolean"&&!HR(N)){const O=Array.isArray(N)?N:[N];for(let P=0;P<O.length;P++){const F=C2(i,O[P]);if(F){const{transitionEnd:z,transition:V,...W}=F;for(const te in W){let $=W[te];if(Array.isArray($)){const Q=T?$.length-1:0;$=$[Q]}$!==null&&(u[te]=$)}for(const te in z)u[te]=z[te]}}}return u}const C$=i=>(n,a)=>{const l=M.useContext(GR),u=M.useContext(qR),m=()=>t0e(i,n,l,u);return a?m():XD(m)};function R2(i,n,a){var m;const{style:l}=i,u={};for(const y in l)(fa(l[y])||n.style&&fa(n.style[y])||w$(y,i)||((m=a==null?void 0:a.getValue(y))==null?void 0:m.liveStyle)!==void 0)&&(u[y]=l[y]);return u}const n0e=C$({scrapeMotionValuesFromProps:R2,createRenderState:x2});function R$(i,n,a){const l=R2(i,n,a);for(const u in i)if(fa(i[u])||fa(n[u])){const m=Qy.indexOf(u)!==-1?"attr"+u.charAt(0).toUpperCase()+u.substring(1):u;l[m]=i[u]}return l}const s0e=C$({scrapeMotionValuesFromProps:R$,createRenderState:x$}),i0e=Symbol.for("motionComponentSymbol");function uy(i){return i&&typeof i=="object"&&Object.prototype.hasOwnProperty.call(i,"current")}function a0e(i,n,a){return M.useCallback(l=>{l&&i.onMount&&i.onMount(l),n&&(l?n.mount(l):n.unmount()),a&&(typeof a=="function"?a(l):uy(a)&&(a.current=l))},[n])}const N2=i=>i.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),o0e="framerAppearId",N$="data-"+N2(o0e),A$=M.createContext({});function c0e(i,n,a,l,u){var z,V;const{visualElement:m}=M.useContext(GR),y=M.useContext(y$),w=M.useContext(qR),b=M.useContext(v2).reducedMotion,x=M.useRef(null);l=l||y.renderer,!x.current&&l&&(x.current=l(i,{visualState:n,parent:m,props:a,presenceContext:w,blockInitialAnimation:w?w.initial===!1:!1,reducedMotionConfig:b}));const T=x.current,N=M.useContext(A$);T&&!T.projection&&u&&(T.type==="html"||T.type==="svg")&&l0e(x.current,a,u,N);const O=M.useRef(!1);M.useInsertionEffect(()=>{T&&O.current&&T.update(a,w)});const P=a[N$],F=M.useRef(!!P&&!((z=window.MotionHandoffIsComplete)!=null&&z.call(window,P))&&((V=window.MotionHasOptimisedAnimation)==null?void 0:V.call(window,P)));return Cz(()=>{T&&(O.current=!0,window.MotionIsMounted=!0,T.updateFeatures(),T.scheduleRenderMicrotask(),F.current&&T.animationState&&T.animationState.animateChanges())}),M.useEffect(()=>{T&&(!F.current&&T.animationState&&T.animationState.animateChanges(),F.current&&(queueMicrotask(()=>{var W;(W=window.MotionHandoffMarkAsComplete)==null||W.call(window,P)}),F.current=!1),T.enteringChildren=void 0)}),T}function l0e(i,n,a,l){const{layoutId:u,layout:m,drag:y,dragConstraints:w,layoutScroll:b,layoutRoot:x,layoutCrossfade:T}=n;i.projection=new a(i.latestValues,n["data-framer-portal-id"]?void 0:I$(i.parent)),i.projection.setOptions({layoutId:u,layout:m,alwaysMeasureLayout:!!y||w&&uy(w),visualElement:i,animationType:typeof m=="string"?m:"both",initialPromotionConfig:l,crossfade:T,layoutScroll:b,layoutRoot:x})}function I$(i){if(i)return i.options.allowProjection!==!1?i.projection:I$(i.parent)}function Ik(i,{forwardMotionProps:n=!1}={},a,l){a&&Lye(a);const u=T2(i)?s0e:n0e;function m(w,b){let x;const T={...M.useContext(v2),...w,layoutId:d0e(w)},{isStatic:N}=T,O=Bye(w),P=u(w,N);if(!N&&JD){u0e();const F=h0e(T);x=F.MeasureLayout,O.visualElement=c0e(i,P,T,l,F.ProjectionNode)}return o.jsxs(GR.Provider,{value:O,children:[x&&O.visualElement?o.jsx(x,{visualElement:O.visualElement,...T}):null,e0e(i,w,a0e(P,O.visualElement,b),P,N,n)]})}m.displayName=`motion.${typeof i=="string"?i:`create(${i.displayName??i.name??""})`}`;const y=M.forwardRef(m);return y[i0e]=i,y}function d0e({layoutId:i}){const n=M.useContext(YD).id;return n&&i!==void 0?n+"-"+i:i}function u0e(i,n){M.useContext(y$).strict}function h0e(i){const{drag:n,layout:a}=Wy;if(!n&&!a)return{};const l={...n,...a};return{MeasureLayout:n!=null&&n.isEnabled(i)||a!=null&&a.isEnabled(i)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function p0e(i,n){if(typeof Proxy>"u")return Ik;const a=new Map,l=(m,y)=>Ik(m,y,i,n),u=(m,y)=>l(m,y);return new Proxy(u,{get:(m,y)=>y==="create"?l:(a.has(y)||a.set(y,Ik(y,void 0,i,n)),a.get(y))})}function O$({top:i,left:n,right:a,bottom:l}){return{x:{min:n,max:a},y:{min:i,max:l}}}function f0e({x:i,y:n}){return{top:n.min,right:i.max,bottom:n.max,left:i.min}}function m0e(i,n){if(!n)return i;const a=n({x:i.left,y:i.top}),l=n({x:i.right,y:i.bottom});return{top:a.y,left:a.x,bottom:l.y,right:l.x}}function Ok(i){return i===void 0||i===1}function zP({scale:i,scaleX:n,scaleY:a}){return!Ok(i)||!Ok(n)||!Ok(a)}function am(i){return zP(i)||k$(i)||i.z||i.rotate||i.rotateX||i.rotateY||i.skewX||i.skewY}function k$(i){return Pq(i.x)||Pq(i.y)}function Pq(i){return i&&i!=="0%"}function bR(i,n,a){const l=i-a,u=n*l;return a+u}function Dq(i,n,a,l,u){return u!==void 0&&(i=bR(i,u,l)),bR(i,a,l)+n}function $P(i,n=0,a=1,l,u){i.min=Dq(i.min,n,a,l,u),i.max=Dq(i.max,n,a,l,u)}function P$(i,{x:n,y:a}){$P(i.x,n.translate,n.scale,n.originPoint),$P(i.y,a.translate,a.scale,a.originPoint)}const jq=.999999999999,Lq=1.0000000000001;function g0e(i,n,a,l=!1){const u=a.length;if(!u)return;n.x=n.y=1;let m,y;for(let w=0;w<u;w++){m=a[w],y=m.projectionDelta;const{visualElement:b}=m.options;b&&b.props.style&&b.props.style.display==="contents"||(l&&m.options.layoutScroll&&m.scroll&&m!==m.root&&py(i,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),y&&(n.x*=y.x.scale,n.y*=y.y.scale,P$(i,y)),l&&am(m.latestValues)&&py(i,m.latestValues))}n.x<Lq&&n.x>jq&&(n.x=1),n.y<Lq&&n.y>jq&&(n.y=1)}function hy(i,n){i.min=i.min+n,i.max=i.max+n}function Mq(i,n,a,l,u=.5){const m=Ps(i.min,i.max,u);$P(i,n,a,m,l)}function py(i,n){Mq(i.x,n.x,n.scaleX,n.scale,n.originX),Mq(i.y,n.y,n.scaleY,n.scale,n.originY)}function D$(i,n){return O$(m0e(i.getBoundingClientRect(),n))}function _0e(i,n,a){const l=D$(i,a),{scroll:u}=n;return u&&(hy(l.x,u.offset.x),hy(l.y,u.offset.y)),l}const Uq=()=>({translate:0,scale:1,origin:0,originPoint:0}),fy=()=>({x:Uq(),y:Uq()}),Fq=()=>({min:0,max:0}),ri=()=>({x:Fq(),y:Fq()}),YP={current:null},j$={current:!1};function y0e(){if(j$.current=!0,!!JD)if(window.matchMedia){const i=window.matchMedia("(prefers-reduced-motion)"),n=()=>YP.current=i.matches;i.addEventListener("change",n),n()}else YP.current=!1}const v0e=new WeakMap;function E0e(i,n,a){for(const l in n){const u=n[l],m=a[l];if(fa(u))i.addValue(l,u);else if(fa(m))i.addValue(l,By(u,{owner:i}));else if(m!==u)if(i.hasValue(l)){const y=i.getValue(l);y.liveStyle===!0?y.jump(u):y.hasAnimated||y.set(u)}else{const y=i.getStaticValue(l);i.addValue(l,By(y!==void 0?y:u,{owner:i}))}}for(const l in a)n[l]===void 0&&i.removeValue(l);return n}const Vq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class w0e{scrapeMotionValuesFromProps(n,a,l){return{}}constructor({parent:n,props:a,presenceContext:l,reducedMotionConfig:u,blockInitialAnimation:m,visualState:y},w={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=f2,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const O=ho.now();this.renderScheduledAt<O&&(this.renderScheduledAt=O,ws.render(this.render,!1,!0))};const{latestValues:b,renderState:x}=y;this.latestValues=b,this.baseTarget={...b},this.initialValues=a.initial?{...b}:{},this.renderState=x,this.parent=n,this.props=a,this.presenceContext=l,this.depth=n?n.depth+1:0,this.reducedMotionConfig=u,this.options=w,this.blockInitialAnimation=!!m,this.isControllingVariants=KR(a),this.isVariantNode=E$(a),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(n&&n.current);const{willChange:T,...N}=this.scrapeMotionValuesFromProps(a,{},this);for(const O in N){const P=N[O];b[O]!==void 0&&fa(P)&&P.set(b[O])}}mount(n){var a;this.current=n,v0e.set(n,this),this.projection&&!this.projection.instance&&this.projection.mount(n),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,u)=>this.bindToMotionValue(u,l)),j$.current||y0e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:YP.current,(a=this.parent)==null||a.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var n;this.projection&&this.projection.unmount(),yp(this.notifyUpdate),yp(this.render),this.valueSubscriptions.forEach(a=>a()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(n=this.parent)==null||n.removeChild(this);for(const a in this.events)this.events[a].clear();for(const a in this.features){const l=this.features[a];l&&(l.unmount(),l.isMounted=!1)}this.current=null}addChild(n){this.children.add(n),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(n)}removeChild(n){this.children.delete(n),this.enteringChildren&&this.enteringChildren.delete(n)}bindToMotionValue(n,a){this.valueSubscriptions.has(n)&&this.valueSubscriptions.get(n)();const l=Zy.has(n);l&&this.onBindTransform&&this.onBindTransform();const u=a.on("change",y=>{this.latestValues[n]=y,this.props.onUpdate&&ws.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let m;window.MotionCheckAppearSync&&(m=window.MotionCheckAppearSync(this,n,a)),this.valueSubscriptions.set(n,()=>{u(),m&&m(),a.owner&&a.stop()})}sortNodePosition(n){return!this.current||!this.sortInstanceNodePosition||this.type!==n.type?0:this.sortInstanceNodePosition(this.current,n.current)}updateFeatures(){let n="animation";for(n in Wy){const a=Wy[n];if(!a)continue;const{isEnabled:l,Feature:u}=a;if(!this.features[n]&&u&&l(this.props)&&(this.features[n]=new u(this)),this.features[n]){const m=this.features[n];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ri()}getStaticValue(n){return this.latestValues[n]}setStaticValue(n,a){this.latestValues[n]=a}update(n,a){(n.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=n,this.prevPresenceContext=this.presenceContext,this.presenceContext=a;for(let l=0;l<Vq.length;l++){const u=Vq[l];this.propEventSubscriptions[u]&&(this.propEventSubscriptions[u](),delete this.propEventSubscriptions[u]);const m="on"+u,y=n[m];y&&(this.propEventSubscriptions[u]=this.on(u,y))}this.prevMotionValues=E0e(this,this.scrapeMotionValuesFromProps(n,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(n){return this.props.variants?this.props.variants[n]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(n){const a=this.getClosestVariantNode();if(a)return a.variantChildren&&a.variantChildren.add(n),()=>a.variantChildren.delete(n)}addValue(n,a){const l=this.values.get(n);a!==l&&(l&&this.removeValue(n),this.bindToMotionValue(n,a),this.values.set(n,a),this.latestValues[n]=a.get())}removeValue(n){this.values.delete(n);const a=this.valueSubscriptions.get(n);a&&(a(),this.valueSubscriptions.delete(n)),delete this.latestValues[n],this.removeValueFromRenderState(n,this.renderState)}hasValue(n){return this.values.has(n)}getValue(n,a){if(this.props.values&&this.props.values[n])return this.props.values[n];let l=this.values.get(n);return l===void 0&&a!==void 0&&(l=By(a===null?void 0:a,{owner:this}),this.addValue(n,l)),l}readValue(n,a){let l=this.latestValues[n]!==void 0||!this.current?this.latestValues[n]:this.getBaseTargetFromProps(this.props,n)??this.readValueFromInstance(this.current,n,this.options);return l!=null&&(typeof l=="string"&&(Rz(l)||Az(l))?l=parseFloat(l):!Aye(l)&&vp.test(a)&&(l=d$(n,a)),this.setBaseTarget(n,fa(l)?l.get():l)),fa(l)?l.get():l}setBaseTarget(n,a){this.baseTarget[n]=a}getBaseTarget(n){var m;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const y=C2(this.props,a,(m=this.presenceContext)==null?void 0:m.custom);y&&(l=y[n])}if(a&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,n);return u!==void 0&&!fa(u)?u:this.initialValues[n]!==void 0&&l===void 0?void 0:this.baseTarget[n]}on(n,a){return this.events[n]||(this.events[n]=new r2),this.events[n].add(a)}notify(n,...a){this.events[n]&&this.events[n].notify(...a)}scheduleRenderMicrotask(){_2.render(this.render)}}class L$ extends w0e{constructor(){super(...arguments),this.KeyframeResolver=_ye}sortInstanceNodePosition(n,a){return n.compareDocumentPosition(a)&2?1:-1}getBaseTargetFromProps(n,a){return n.style?n.style[a]:void 0}removeValueFromRenderState(n,{vars:a,style:l}){delete a[n],delete l[n]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:n}=this.props;fa(n)&&(this.childSubscription=n.on("change",a=>{this.current&&(this.current.textContent=`${a}`)}))}}function M$(i,{style:n,vars:a},l,u){const m=i.style;let y;for(y in n)m[y]=n[y];u==null||u.applyProjectionStyles(m,l);for(y in a)m.setProperty(y,a[y])}function b0e(i){return window.getComputedStyle(i)}class S0e extends L${constructor(){super(...arguments),this.type="html",this.renderInstance=M$}readValueFromInstance(n,a){var l;if(Zy.has(a))return(l=this.projection)!=null&&l.isProjecting?VP(a):L_e(n,a);{const u=b0e(n),m=(i2(a)?u.getPropertyValue(a):u[a])||0;return typeof m=="string"?m.trim():m}}measureInstanceViewportBox(n,{transformPagePoint:a}){return D$(n,a)}build(n,a,l){S2(n,a,l.transformTemplate)}scrapeMotionValuesFromProps(n,a,l){return R2(n,a,l)}}const U$=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function x0e(i,n,a,l){M$(i,n,void 0,l);for(const u in n.attrs)i.setAttribute(U$.has(u)?u:N2(u),n.attrs[u])}class T0e extends L${constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ri}getBaseTargetFromProps(n,a){return n[a]}readValueFromInstance(n,a){if(Zy.has(a)){const l=l$(a);return l&&l.default||0}return a=U$.has(a)?a:N2(a),n.getAttribute(a)}scrapeMotionValuesFromProps(n,a,l){return R$(n,a,l)}build(n,a,l){S$(n,a,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(n,a,l,u){x0e(n,a,l,u)}mount(n){this.isSVGTag=T$(n.tagName),super.mount(n)}}const C0e=(i,n)=>T2(i)?new T0e(n):new S0e(n,{allowProjection:i!==M.Fragment});function wy(i,n,a){const l=i.getProps();return C2(l,n,a!==void 0?a:l.custom,i)}const XP=i=>Array.isArray(i);function R0e(i,n,a){i.hasValue(n)?i.getValue(n).set(a):i.addValue(n,By(a))}function N0e(i){return XP(i)?i[i.length-1]||0:i}function A0e(i,n){const a=wy(i,n);let{transitionEnd:l={},transition:u={},...m}=a||{};m={...m,...l};for(const y in m){const w=N0e(m[y]);R0e(i,y,w)}}function I0e(i){return!!(fa(i)&&i.add)}function JP(i,n){const a=i.getValue("willChange");if(I0e(a))return a.add(n);if(!a&&Du.WillChange){const l=new Du.WillChange("auto");i.addValue("willChange",l),l.add(n)}}function F$(i){return i.props[N$]}const O0e=i=>i!==null;function k0e(i,{repeat:n,repeatType:a="loop"},l){const u=i.filter(O0e),m=n&&a!=="loop"&&n%2===1?0:u.length-1;return u[m]}const P0e={type:"spring",stiffness:500,damping:25,restSpeed:10},D0e=i=>({type:"spring",stiffness:550,damping:i===0?2*Math.sqrt(550):30,restSpeed:10}),j0e={type:"keyframes",duration:.8},L0e={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},M0e=(i,{keyframes:n})=>n.length>2?j0e:Zy.has(i)?i.startsWith("scale")?D0e(n[1]):P0e:L0e;function U0e({when:i,delay:n,delayChildren:a,staggerChildren:l,staggerDirection:u,repeat:m,repeatType:y,repeatDelay:w,from:b,elapsed:x,...T}){return!!Object.keys(T).length}const A2=(i,n,a,l={},u,m)=>y=>{const w=m2(l,i)||{},b=w.delay||l.delay||0;let{elapsed:x=0}=l;x=x-Ad(b);const T={keyframes:Array.isArray(a)?a:[null,a],ease:"easeOut",velocity:n.getVelocity(),...w,delay:-x,onUpdate:O=>{n.set(O),w.onUpdate&&w.onUpdate(O)},onComplete:()=>{y(),w.onComplete&&w.onComplete()},name:i,motionValue:n,element:m?void 0:u};U0e(w)||Object.assign(T,M0e(i,T)),T.duration&&(T.duration=Ad(T.duration)),T.repeatDelay&&(T.repeatDelay=Ad(T.repeatDelay)),T.from!==void 0&&(T.keyframes[0]=T.from);let N=!1;if((T.type===!1||T.duration===0&&!T.repeatDelay)&&(HP(T),T.delay===0&&(N=!0)),(Du.instantAnimations||Du.skipAnimations)&&(N=!0,HP(T),T.delay=0),T.allowFlatten=!w.type&&!w.ease,N&&!m&&n.get()!==void 0){const O=k0e(T.keyframes,w);if(O!==void 0){ws.update(()=>{T.onUpdate(O),T.onComplete()});return}}return w.isSync?new p2(T):new iye(T)};function F0e({protectedKeys:i,needsAnimating:n},a){const l=i.hasOwnProperty(a)&&n[a]!==!0;return n[a]=!1,l}function V$(i,n,{delay:a=0,transitionOverride:l,type:u}={}){let{transition:m=i.getDefaultTransition(),transitionEnd:y,...w}=n;l&&(m=l);const b=[],x=u&&i.animationState&&i.animationState.getState()[u];for(const T in w){const N=i.getValue(T,i.latestValues[T]??null),O=w[T];if(O===void 0||x&&F0e(x,T))continue;const P={delay:a,...m2(m||{},T)},F=N.get();if(F!==void 0&&!N.isAnimating&&!Array.isArray(O)&&O===F&&!P.velocity)continue;let z=!1;if(window.MotionHandoffAnimation){const W=F$(i);if(W){const te=window.MotionHandoffAnimation(W,T,ws);te!==null&&(P.startTime=te,z=!0)}}JP(i,T),N.start(A2(T,N,O,i.shouldReduceMotion&&a$.has(T)?{type:!1}:P,i,z));const V=N.animation;V&&b.push(V)}return y&&Promise.all(b).then(()=>{ws.update(()=>{y&&A0e(i,y)})}),b}function B$(i,n,a,l=0,u=1){const m=Array.from(i).sort((x,T)=>x.sortNodePosition(T)).indexOf(n),y=i.size,w=(y-1)*l;return typeof a=="function"?a(m,y):u===1?m*l:w-m*l}function QP(i,n,a={}){var b;const l=wy(i,n,a.type==="exit"?(b=i.presenceContext)==null?void 0:b.custom:void 0);let{transition:u=i.getDefaultTransition()||{}}=l||{};a.transitionOverride&&(u=a.transitionOverride);const m=l?()=>Promise.all(V$(i,l,a)):()=>Promise.resolve(),y=i.variantChildren&&i.variantChildren.size?(x=0)=>{const{delayChildren:T=0,staggerChildren:N,staggerDirection:O}=u;return V0e(i,n,x,T,N,O,a)}:()=>Promise.resolve(),{when:w}=u;if(w){const[x,T]=w==="beforeChildren"?[m,y]:[y,m];return x().then(()=>T())}else return Promise.all([m(),y(a.delay)])}function V0e(i,n,a=0,l=0,u=0,m=1,y){const w=[];for(const b of i.variantChildren)b.notify("AnimationStart",n),w.push(QP(b,n,{...y,delay:a+(typeof l=="function"?0:l)+B$(i.variantChildren,b,l,u,m)}).then(()=>b.notify("AnimationComplete",n)));return Promise.all(w)}function B0e(i,n,a={}){i.notify("AnimationStart",n);let l;if(Array.isArray(n)){const u=n.map(m=>QP(i,m,a));l=Promise.all(u)}else if(typeof n=="string")l=QP(i,n,a);else{const u=typeof n=="function"?wy(i,n,a.custom):n;l=Promise.all(V$(i,u,a))}return l.then(()=>{i.notify("AnimationComplete",n)})}function W$(i,n){if(!Array.isArray(n))return!1;const a=n.length;if(a!==i.length)return!1;for(let l=0;l<a;l++)if(n[l]!==i[l])return!1;return!0}const W0e=b2.length;function q$(i){if(!i)return;if(!i.isControllingVariants){const a=i.parent?q$(i.parent)||{}:{};return i.props.initial!==void 0&&(a.initial=i.props.initial),a}const n={};for(let a=0;a<W0e;a++){const l=b2[a],u=i.props[l];(qw(u)||u===!1)&&(n[l]=u)}return n}const q0e=[...w2].reverse(),G0e=w2.length;function H0e(i){return n=>Promise.all(n.map(({animation:a,options:l})=>B0e(i,a,l)))}function K0e(i){let n=H0e(i),a=Bq(),l=!0;const u=b=>(x,T)=>{var O;const N=wy(i,T,b==="exit"?(O=i.presenceContext)==null?void 0:O.custom:void 0);if(N){const{transition:P,transitionEnd:F,...z}=N;x={...x,...z,...F}}return x};function m(b){n=b(i)}function y(b){const{props:x}=i,T=q$(i.parent)||{},N=[],O=new Set;let P={},F=1/0;for(let V=0;V<G0e;V++){const W=q0e[V],te=a[W],$=x[W]!==void 0?x[W]:T[W],Q=qw($),G=W===b?te.isActive:null;G===!1&&(F=V);let se=$===T[W]&&$!==x[W]&&Q;if(se&&l&&i.manuallyAnimateOnMount&&(se=!1),te.protectedKeys={...P},!te.isActive&&G===null||!$&&!te.prevProp||HR($)||typeof $=="boolean")continue;const ie=z0e(te.prevProp,$);let ce=ie||W===b&&te.isActive&&!se&&Q||V>F&&Q,Se=!1;const oe=Array.isArray($)?$:[$];let ve=oe.reduce(u(W),{});G===!1&&(ve={});const{prevResolvedValues:he={}}=te,Ze={...he,...ve},Qe=ge=>{ce=!0,O.has(ge)&&(Se=!0,O.delete(ge)),te.needsAnimating[ge]=!0;const Ee=i.getValue(ge);Ee&&(Ee.liveStyle=!1)};for(const ge in Ze){const Ee=ve[ge],Oe=he[ge];if(P.hasOwnProperty(ge))continue;let we=!1;XP(Ee)&&XP(Oe)?we=!W$(Ee,Oe):we=Ee!==Oe,we?Ee!=null?Qe(ge):O.add(ge):Ee!==void 0&&O.has(ge)?Qe(ge):te.protectedKeys[ge]=!0}te.prevProp=$,te.prevResolvedValues=ve,te.isActive&&(P={...P,...ve}),l&&i.blockInitialAnimation&&(ce=!1);const me=se&&ie;ce&&(!me||Se)&&N.push(...oe.map(ge=>{const Ee={type:W};if(typeof ge=="string"&&l&&!me&&i.manuallyAnimateOnMount&&i.parent){const{parent:Oe}=i,we=wy(Oe,ge);if(Oe.enteringChildren&&we){const{delayChildren:fe}=we.transition||{};Ee.delay=B$(Oe.enteringChildren,i,fe)}}return{animation:ge,options:Ee}}))}if(O.size){const V={};if(typeof x.initial!="boolean"){const W=wy(i,Array.isArray(x.initial)?x.initial[0]:x.initial);W&&W.transition&&(V.transition=W.transition)}O.forEach(W=>{const te=i.getBaseTarget(W),$=i.getValue(W);$&&($.liveStyle=!0),V[W]=te??null}),N.push({animation:V})}let z=!!N.length;return l&&(x.initial===!1||x.initial===x.animate)&&!i.manuallyAnimateOnMount&&(z=!1),l=!1,z?n(N):Promise.resolve()}function w(b,x){var N;if(a[b].isActive===x)return Promise.resolve();(N=i.variantChildren)==null||N.forEach(O=>{var P;return(P=O.animationState)==null?void 0:P.setActive(b,x)}),a[b].isActive=x;const T=y(b);for(const O in a)a[O].protectedKeys={};return T}return{animateChanges:y,setActive:w,setAnimateFunction:m,getState:()=>a,reset:()=>{a=Bq()}}}function z0e(i,n){return typeof n=="string"?n!==i:Array.isArray(n)?!W$(n,i):!1}function nm(i=!1){return{isActive:i,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Bq(){return{animate:nm(!0),whileInView:nm(),whileHover:nm(),whileTap:nm(),whileDrag:nm(),whileFocus:nm(),exit:nm()}}class bp{constructor(n){this.isMounted=!1,this.node=n}update(){}}class $0e extends bp{constructor(n){super(n),n.animationState||(n.animationState=K0e(n))}updateAnimationControlsSubscription(){const{animate:n}=this.node.getProps();HR(n)&&(this.unmountControls=n.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:n}=this.node.getProps(),{animate:a}=this.node.prevProps||{};n!==a&&this.updateAnimationControlsSubscription()}unmount(){var n;this.node.animationState.reset(),(n=this.unmountControls)==null||n.call(this)}}let Y0e=0;class X0e extends bp{constructor(){super(...arguments),this.id=Y0e++}update(){if(!this.node.presenceContext)return;const{isPresent:n,onExitComplete:a}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||n===l)return;const u=this.node.animationState.setActive("exit",!n);a&&!n&&u.then(()=>{a(this.id)})}mount(){const{register:n,onExitComplete:a}=this.node.presenceContext||{};a&&a(this.id),n&&(this.unmount=n(this.id))}unmount(){}}const J0e={animation:{Feature:$0e},exit:{Feature:X0e}};function Hw(i,n,a,l={passive:!0}){return i.addEventListener(n,a,l),()=>i.removeEventListener(n,a)}function lb(i){return{point:{x:i.pageX,y:i.pageY}}}const Q0e=i=>n=>y2(n)&&i(n,lb(n));function xw(i,n,a,l){return Hw(i,n,Q0e(a),l)}const G$=1e-4,Z0e=1-G$,eve=1+G$,H$=.01,tve=0-H$,rve=0+H$;function ka(i){return i.max-i.min}function nve(i,n,a){return Math.abs(i-n)<=a}function Wq(i,n,a,l=.5){i.origin=l,i.originPoint=Ps(n.min,n.max,i.origin),i.scale=ka(a)/ka(n),i.translate=Ps(a.min,a.max,i.origin)-i.originPoint,(i.scale>=Z0e&&i.scale<=eve||isNaN(i.scale))&&(i.scale=1),(i.translate>=tve&&i.translate<=rve||isNaN(i.translate))&&(i.translate=0)}function Tw(i,n,a,l){Wq(i.x,n.x,a.x,l?l.originX:void 0),Wq(i.y,n.y,a.y,l?l.originY:void 0)}function qq(i,n,a){i.min=a.min+n.min,i.max=i.min+ka(n)}function sve(i,n,a){qq(i.x,n.x,a.x),qq(i.y,n.y,a.y)}function Gq(i,n,a){i.min=n.min-a.min,i.max=i.min+ka(n)}function Cw(i,n,a){Gq(i.x,n.x,a.x),Gq(i.y,n.y,a.y)}function vc(i){return[i("x"),i("y")]}const K$=({current:i})=>i?i.ownerDocument.defaultView:null,Hq=(i,n)=>Math.abs(i-n);function ive(i,n){const a=Hq(i.x,n.x),l=Hq(i.y,n.y);return Math.sqrt(a**2+l**2)}class z${constructor(n,a,{transformPagePoint:l,contextWindow:u=window,dragSnapToOrigin:m=!1,distanceThreshold:y=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const O=Pk(this.lastMoveEventInfo,this.history),P=this.startEvent!==null,F=ive(O.offset,{x:0,y:0})>=this.distanceThreshold;if(!P&&!F)return;const{point:z}=O,{timestamp:V}=Yi;this.history.push({...z,timestamp:V});const{onStart:W,onMove:te}=this.handlers;P||(W&&W(this.lastMoveEvent,O),this.startEvent=this.lastMoveEvent),te&&te(this.lastMoveEvent,O)},this.handlePointerMove=(O,P)=>{this.lastMoveEvent=O,this.lastMoveEventInfo=kk(P,this.transformPagePoint),ws.update(this.updatePoint,!0)},this.handlePointerUp=(O,P)=>{this.end();const{onEnd:F,onSessionEnd:z,resumeAnimation:V}=this.handlers;if(this.dragSnapToOrigin&&V&&V(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const W=Pk(O.type==="pointercancel"?this.lastMoveEventInfo:kk(P,this.transformPagePoint),this.history);this.startEvent&&F&&F(O,W),z&&z(O,W)},!y2(n))return;this.dragSnapToOrigin=m,this.handlers=a,this.transformPagePoint=l,this.distanceThreshold=y,this.contextWindow=u||window;const w=lb(n),b=kk(w,this.transformPagePoint),{point:x}=b,{timestamp:T}=Yi;this.history=[{...x,timestamp:T}];const{onSessionStart:N}=a;N&&N(n,Pk(b,this.history)),this.removeListeners=ab(xw(this.contextWindow,"pointermove",this.handlePointerMove),xw(this.contextWindow,"pointerup",this.handlePointerUp),xw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(n){this.handlers=n}end(){this.removeListeners&&this.removeListeners(),yp(this.updatePoint)}}function kk(i,n){return n?{point:n(i.point)}:i}function Kq(i,n){return{x:i.x-n.x,y:i.y-n.y}}function Pk({point:i},n){return{point:i,delta:Kq(i,$$(n)),offset:Kq(i,ave(n)),velocity:ove(n,.1)}}function ave(i){return i[0]}function $$(i){return i[i.length-1]}function ove(i,n){if(i.length<2)return{x:0,y:0};let a=i.length-1,l=null;const u=$$(i);for(;a>=0&&(l=i[a],!(u.timestamp-l.timestamp>Ad(n)));)a--;if(!l)return{x:0,y:0};const m=Ac(u.timestamp-l.timestamp);if(m===0)return{x:0,y:0};const y={x:(u.x-l.x)/m,y:(u.y-l.y)/m};return y.x===1/0&&(y.x=0),y.y===1/0&&(y.y=0),y}function cve(i,{min:n,max:a},l){return n!==void 0&&i<n?i=l?Ps(n,i,l.min):Math.max(i,n):a!==void 0&&i>a&&(i=l?Ps(a,i,l.max):Math.min(i,a)),i}function zq(i,n,a){return{min:n!==void 0?i.min+n:void 0,max:a!==void 0?i.max+a-(i.max-i.min):void 0}}function lve(i,{top:n,left:a,bottom:l,right:u}){return{x:zq(i.x,a,u),y:zq(i.y,n,l)}}function $q(i,n){let a=n.min-i.min,l=n.max-i.max;return n.max-n.min<i.max-i.min&&([a,l]=[l,a]),{min:a,max:l}}function dve(i,n){return{x:$q(i.x,n.x),y:$q(i.y,n.y)}}function uve(i,n){let a=.5;const l=ka(i),u=ka(n);return u>l?a=Vw(n.min,n.max-l,i.min):l>u&&(a=Vw(i.min,i.max-u,n.min)),Pu(0,1,a)}function hve(i,n){const a={};return n.min!==void 0&&(a.min=n.min-i.min),n.max!==void 0&&(a.max=n.max-i.min),a}const ZP=.35;function pve(i=ZP){return i===!1?i=0:i===!0&&(i=ZP),{x:Yq(i,"left","right"),y:Yq(i,"top","bottom")}}function Yq(i,n,a){return{min:Xq(i,n),max:Xq(i,a)}}function Xq(i,n){return typeof i=="number"?i:i[n]||0}const fve=new WeakMap;class mve{constructor(n){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ri(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=n}start(n,{snapToCursor:a=!1,distanceThreshold:l}={}){const{presenceContext:u}=this.visualElement;if(u&&u.isPresent===!1)return;const m=N=>{const{dragSnapToOrigin:O}=this.getProps();O?this.pauseAnimation():this.stopAnimation(),a&&this.snapToCursor(lb(N).point)},y=(N,O)=>{const{drag:P,dragPropagation:F,onDragStart:z}=this.getProps();if(P&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=wye(P),!this.openDragLock))return;this.latestPointerEvent=N,this.latestPanInfo=O,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),vc(W=>{let te=this.getAxisMotionValue(W).get()||0;if(Id.test(te)){const{projection:$}=this.visualElement;if($&&$.layout){const Q=$.layout.layoutBox[W];Q&&(te=ka(Q)*(parseFloat(te)/100))}}this.originPoint[W]=te}),z&&ws.postRender(()=>z(N,O)),JP(this.visualElement,"transform");const{animationState:V}=this.visualElement;V&&V.setActive("whileDrag",!0)},w=(N,O)=>{this.latestPointerEvent=N,this.latestPanInfo=O;const{dragPropagation:P,dragDirectionLock:F,onDirectionLock:z,onDrag:V}=this.getProps();if(!P&&!this.openDragLock)return;const{offset:W}=O;if(F&&this.currentDirection===null){this.currentDirection=gve(W),this.currentDirection!==null&&z&&z(this.currentDirection);return}this.updateAxis("x",O.point,W),this.updateAxis("y",O.point,W),this.visualElement.render(),V&&V(N,O)},b=(N,O)=>{this.latestPointerEvent=N,this.latestPanInfo=O,this.stop(N,O),this.latestPointerEvent=null,this.latestPanInfo=null},x=()=>vc(N=>{var O;return this.getAnimationState(N)==="paused"&&((O=this.getAxisMotionValue(N).animation)==null?void 0:O.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new z$(n,{onSessionStart:m,onStart:y,onMove:w,onSessionEnd:b,resumeAnimation:x},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,distanceThreshold:l,contextWindow:K$(this.visualElement)})}stop(n,a){const l=n||this.latestPointerEvent,u=a||this.latestPanInfo,m=this.isDragging;if(this.cancel(),!m||!u||!l)return;const{velocity:y}=u;this.startAnimation(y);const{onDragEnd:w}=this.getProps();w&&ws.postRender(()=>w(l,u))}cancel(){this.isDragging=!1;const{projection:n,animationState:a}=this.visualElement;n&&(n.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),a&&a.setActive("whileDrag",!1)}updateAxis(n,a,l){const{drag:u}=this.getProps();if(!l||!MC(n,u,this.currentDirection))return;const m=this.getAxisMotionValue(n);let y=this.originPoint[n]+l[n];this.constraints&&this.constraints[n]&&(y=cve(y,this.constraints[n],this.elastic[n])),m.set(y)}resolveConstraints(){var m;const{dragConstraints:n,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(m=this.visualElement.projection)==null?void 0:m.layout,u=this.constraints;n&&uy(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&l?this.constraints=lve(l.layoutBox,n):this.constraints=!1,this.elastic=pve(a),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&vc(y=>{this.constraints!==!1&&this.getAxisMotionValue(y)&&(this.constraints[y]=hve(l.layoutBox[y],this.constraints[y]))})}resolveRefConstraints(){const{dragConstraints:n,onMeasureDragConstraints:a}=this.getProps();if(!n||!uy(n))return!1;const l=n.current,{projection:u}=this.visualElement;if(!u||!u.layout)return!1;const m=_0e(l,u.root,this.visualElement.getTransformPagePoint());let y=dve(u.layout.layoutBox,m);if(a){const w=a(f0e(y));this.hasMutatedConstraints=!!w,w&&(y=O$(w))}return y}startAnimation(n){const{drag:a,dragMomentum:l,dragElastic:u,dragTransition:m,dragSnapToOrigin:y,onDragTransitionEnd:w}=this.getProps(),b=this.constraints||{},x=vc(T=>{if(!MC(T,a,this.currentDirection))return;let N=b&&b[T]||{};y&&(N={min:0,max:0});const O=u?200:1e6,P=u?40:1e7,F={type:"inertia",velocity:l?n[T]:0,bounceStiffness:O,bounceDamping:P,timeConstant:750,restDelta:1,restSpeed:10,...m,...N};return this.startAxisValueAnimation(T,F)});return Promise.all(x).then(w)}startAxisValueAnimation(n,a){const l=this.getAxisMotionValue(n);return JP(this.visualElement,n),l.start(A2(n,l,0,a,this.visualElement,!1))}stopAnimation(){vc(n=>this.getAxisMotionValue(n).stop())}pauseAnimation(){vc(n=>{var a;return(a=this.getAxisMotionValue(n).animation)==null?void 0:a.pause()})}getAnimationState(n){var a;return(a=this.getAxisMotionValue(n).animation)==null?void 0:a.state}getAxisMotionValue(n){const a=`_drag${n.toUpperCase()}`,l=this.visualElement.getProps(),u=l[a];return u||this.visualElement.getValue(n,(l.initial?l.initial[n]:void 0)||0)}snapToCursor(n){vc(a=>{const{drag:l}=this.getProps();if(!MC(a,l,this.currentDirection))return;const{projection:u}=this.visualElement,m=this.getAxisMotionValue(a);if(u&&u.layout){const{min:y,max:w}=u.layout.layoutBox[a];m.set(n[a]-Ps(y,w,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:n,dragConstraints:a}=this.getProps(),{projection:l}=this.visualElement;if(!uy(a)||!l||!this.constraints)return;this.stopAnimation();const u={x:0,y:0};vc(y=>{const w=this.getAxisMotionValue(y);if(w&&this.constraints!==!1){const b=w.get();u[y]=uve({min:b,max:b},this.constraints[y])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),vc(y=>{if(!MC(y,n,null))return;const w=this.getAxisMotionValue(y),{min:b,max:x}=this.constraints[y];w.set(Ps(b,x,u[y]))})}addListeners(){if(!this.visualElement.current)return;fve.set(this.visualElement,this);const n=this.visualElement.current,a=xw(n,"pointerdown",b=>{const{drag:x,dragListener:T=!0}=this.getProps();x&&T&&this.start(b)}),l=()=>{const{dragConstraints:b}=this.getProps();uy(b)&&b.current&&(this.constraints=this.resolveRefConstraints())},{projection:u}=this.visualElement,m=u.addEventListener("measure",l);u&&!u.layout&&(u.root&&u.root.updateScroll(),u.updateLayout()),ws.read(l);const y=Hw(window,"resize",()=>this.scalePositionWithinConstraints()),w=u.addEventListener("didUpdate",(({delta:b,hasLayoutChanged:x})=>{this.isDragging&&x&&(vc(T=>{const N=this.getAxisMotionValue(T);N&&(this.originPoint[T]+=b[T].translate,N.set(N.get()+b[T].translate))}),this.visualElement.render())}));return()=>{y(),a(),m(),w&&w()}}getProps(){const n=this.visualElement.getProps(),{drag:a=!1,dragDirectionLock:l=!1,dragPropagation:u=!1,dragConstraints:m=!1,dragElastic:y=ZP,dragMomentum:w=!0}=n;return{...n,drag:a,dragDirectionLock:l,dragPropagation:u,dragConstraints:m,dragElastic:y,dragMomentum:w}}}function MC(i,n,a){return(n===!0||n===i)&&(a===null||a===i)}function gve(i,n=10){let a=null;return Math.abs(i.y)>n?a="y":Math.abs(i.x)>n&&(a="x"),a}class _ve extends bp{constructor(n){super(n),this.removeGroupControls=kc,this.removeListeners=kc,this.controls=new mve(n)}mount(){const{dragControls:n}=this.node.getProps();n&&(this.removeGroupControls=n.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||kc}unmount(){this.removeGroupControls(),this.removeListeners()}}const Jq=i=>(n,a)=>{i&&ws.postRender(()=>i(n,a))};class yve extends bp{constructor(){super(...arguments),this.removePointerDownListener=kc}onPointerDown(n){this.session=new z$(n,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:K$(this.node)})}createPanHandlers(){const{onPanSessionStart:n,onPanStart:a,onPan:l,onPanEnd:u}=this.node.getProps();return{onSessionStart:Jq(n),onStart:Jq(a),onMove:l,onEnd:(m,y)=>{delete this.session,u&&ws.postRender(()=>u(m,y))}}}mount(){this.removePointerDownListener=xw(this.node.current,"pointerdown",n=>this.onPointerDown(n))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const XC={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Qq(i,n){return n.max===n.min?0:i/(n.max-n.min)*100}const lw={correct:(i,n)=>{if(!n.target)return i;if(typeof i=="string")if(Nr.test(i))i=parseFloat(i);else return i;const a=Qq(i,n.target.x),l=Qq(i,n.target.y);return`${a}% ${l}%`}},vve={correct:(i,{treeScale:n,projectionDelta:a})=>{const l=i,u=vp.parse(i);if(u.length>5)return l;const m=vp.createTransformer(i),y=typeof u[0]!="number"?1:0,w=a.x.scale*n.x,b=a.y.scale*n.y;u[0+y]/=w,u[1+y]/=b;const x=Ps(w,b,.5);return typeof u[2+y]=="number"&&(u[2+y]/=x),typeof u[3+y]=="number"&&(u[3+y]/=x),m(u)}};let Dk=!1;class Eve extends M.Component{componentDidMount(){const{visualElement:n,layoutGroup:a,switchLayoutGroup:l,layoutId:u}=this.props,{projection:m}=n;Wye(wve),m&&(a.group&&a.group.add(m),l&&l.register&&u&&l.register(m),Dk&&m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),XC.hasEverUpdated=!0}getSnapshotBeforeUpdate(n){const{layoutDependency:a,visualElement:l,drag:u,isPresent:m}=this.props,{projection:y}=l;return y&&(y.isPresent=m,Dk=!0,u||n.layoutDependency!==a||a===void 0||n.isPresent!==m?y.willUpdate():this.safeToRemove(),n.isPresent!==m&&(m?y.promote():y.relegate()||ws.postRender(()=>{const w=y.getStack();(!w||!w.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:n}=this.props.visualElement;n&&(n.root.didUpdate(),_2.postRender(()=>{!n.currentAnimation&&n.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:n,layoutGroup:a,switchLayoutGroup:l}=this.props,{projection:u}=n;Dk=!0,u&&(u.scheduleCheckAfterUnmount(),a&&a.group&&a.group.remove(u),l&&l.deregister&&l.deregister(u))}safeToRemove(){const{safeToRemove:n}=this.props;n&&n()}render(){return null}}function Y$(i){const[n,a]=_$(),l=M.useContext(YD);return o.jsx(Eve,{...i,layoutGroup:l,switchLayoutGroup:M.useContext(A$),isPresent:n,safeToRemove:a})}const wve={borderRadius:{...lw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:lw,borderTopRightRadius:lw,borderBottomLeftRadius:lw,borderBottomRightRadius:lw,boxShadow:vve};function bve(i,n,a){const l=fa(i)?i:By(i);return l.start(A2("",l,n,a)),l.animation}const Sve=(i,n)=>i.depth-n.depth;class xve{constructor(){this.children=[],this.isDirty=!1}add(n){QD(this.children,n),this.isDirty=!0}remove(n){ZD(this.children,n),this.isDirty=!0}forEach(n){this.isDirty&&this.children.sort(Sve),this.isDirty=!1,this.children.forEach(n)}}function Tve(i,n){const a=ho.now(),l=({timestamp:u})=>{const m=u-a;m>=n&&(yp(l),i(m-n))};return ws.setup(l,!0),()=>yp(l)}const X$=["TopLeft","TopRight","BottomLeft","BottomRight"],Cve=X$.length,Zq=i=>typeof i=="string"?parseFloat(i):i,eG=i=>typeof i=="number"||Nr.test(i);function Rve(i,n,a,l,u,m){u?(i.opacity=Ps(0,a.opacity??1,Nve(l)),i.opacityExit=Ps(n.opacity??1,0,Ave(l))):m&&(i.opacity=Ps(n.opacity??1,a.opacity??1,l));for(let y=0;y<Cve;y++){const w=`border${X$[y]}Radius`;let b=tG(n,w),x=tG(a,w);if(b===void 0&&x===void 0)continue;b||(b=0),x||(x=0),b===0||x===0||eG(b)===eG(x)?(i[w]=Math.max(Ps(Zq(b),Zq(x),l),0),(Id.test(x)||Id.test(b))&&(i[w]+="%")):i[w]=x}(n.rotate||a.rotate)&&(i.rotate=Ps(n.rotate||0,a.rotate||0,l))}function tG(i,n){return i[n]!==void 0?i[n]:i.borderRadius}const Nve=J$(0,.5,Mz),Ave=J$(.5,.95,kc);function J$(i,n,a){return l=>l<i?0:l>n?1:a(Vw(i,n,l))}function rG(i,n){i.min=n.min,i.max=n.max}function yc(i,n){rG(i.x,n.x),rG(i.y,n.y)}function nG(i,n){i.translate=n.translate,i.scale=n.scale,i.originPoint=n.originPoint,i.origin=n.origin}function sG(i,n,a,l,u){return i-=n,i=bR(i,1/a,l),u!==void 0&&(i=bR(i,1/u,l)),i}function Ive(i,n=0,a=1,l=.5,u,m=i,y=i){if(Id.test(n)&&(n=parseFloat(n),n=Ps(y.min,y.max,n/100)-y.min),typeof n!="number")return;let w=Ps(m.min,m.max,l);i===m&&(w-=n),i.min=sG(i.min,n,a,w,u),i.max=sG(i.max,n,a,w,u)}function iG(i,n,[a,l,u],m,y){Ive(i,n[a],n[l],n[u],n.scale,m,y)}const Ove=["x","scaleX","originX"],kve=["y","scaleY","originY"];function aG(i,n,a,l){iG(i.x,n,Ove,a?a.x:void 0,l?l.x:void 0),iG(i.y,n,kve,a?a.y:void 0,l?l.y:void 0)}function oG(i){return i.translate===0&&i.scale===1}function Q$(i){return oG(i.x)&&oG(i.y)}function cG(i,n){return i.min===n.min&&i.max===n.max}function Pve(i,n){return cG(i.x,n.x)&&cG(i.y,n.y)}function lG(i,n){return Math.round(i.min)===Math.round(n.min)&&Math.round(i.max)===Math.round(n.max)}function Z$(i,n){return lG(i.x,n.x)&&lG(i.y,n.y)}function dG(i){return ka(i.x)/ka(i.y)}function uG(i,n){return i.translate===n.translate&&i.scale===n.scale&&i.originPoint===n.originPoint}class Dve{constructor(){this.members=[]}add(n){QD(this.members,n),n.scheduleRender()}remove(n){if(ZD(this.members,n),n===this.prevLead&&(this.prevLead=void 0),n===this.lead){const a=this.members[this.members.length-1];a&&this.promote(a)}}relegate(n){const a=this.members.findIndex(u=>n===u);if(a===0)return!1;let l;for(let u=a;u>=0;u--){const m=this.members[u];if(m.isPresent!==!1){l=m;break}}return l?(this.promote(l),!0):!1}promote(n,a){const l=this.lead;if(n!==l&&(this.prevLead=l,this.lead=n,n.show(),l)){l.instance&&l.scheduleRender(),n.scheduleRender(),n.resumeFrom=l,a&&(n.resumeFrom.preserveOpacity=!0),l.snapshot&&(n.snapshot=l.snapshot,n.snapshot.latestValues=l.animationValues||l.latestValues),n.root&&n.root.isUpdating&&(n.isLayoutDirty=!0);const{crossfade:u}=n.options;u===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(n=>{const{options:a,resumingFrom:l}=n;a.onExitComplete&&a.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(n=>{n.instance&&n.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function jve(i,n,a){let l="";const u=i.x.translate/n.x,m=i.y.translate/n.y,y=(a==null?void 0:a.z)||0;if((u||m||y)&&(l=`translate3d(${u}px, ${m}px, ${y}px) `),(n.x!==1||n.y!==1)&&(l+=`scale(${1/n.x}, ${1/n.y}) `),a){const{transformPerspective:x,rotate:T,rotateX:N,rotateY:O,skewX:P,skewY:F}=a;x&&(l=`perspective(${x}px) ${l}`),T&&(l+=`rotate(${T}deg) `),N&&(l+=`rotateX(${N}deg) `),O&&(l+=`rotateY(${O}deg) `),P&&(l+=`skewX(${P}deg) `),F&&(l+=`skewY(${F}deg) `)}const w=i.x.scale*n.x,b=i.y.scale*n.y;return(w!==1||b!==1)&&(l+=`scale(${w}, ${b})`),l||"none"}const jk=["","X","Y","Z"],Lve=1e3;let Mve=0;function Lk(i,n,a,l){const{latestValues:u}=n;u[i]&&(a[i]=u[i],n.setStaticValue(i,0),l&&(l[i]=0))}function eY(i){if(i.hasCheckedOptimisedAppear=!0,i.root===i)return;const{visualElement:n}=i.options;if(!n)return;const a=F$(n);if(window.MotionHasOptimisedAnimation(a,"transform")){const{layout:u,layoutId:m}=i.options;window.MotionCancelOptimisedAnimation(a,"transform",ws,!(u||m))}const{parent:l}=i;l&&!l.hasCheckedOptimisedAppear&&eY(l)}function tY({attachResizeListener:i,defaultParent:n,measureScroll:a,checkIsScrollRoot:l,resetTransform:u}){return class{constructor(y={},w=n==null?void 0:n()){this.id=Mve++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Vve),this.nodes.forEach(Gve),this.nodes.forEach(Hve),this.nodes.forEach(Bve)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=y,this.root=w?w.root||w:this,this.path=w?[...w.path,w]:[],this.parent=w,this.depth=w?w.depth+1:0;for(let b=0;b<this.path.length;b++)this.path[b].shouldResetTransform=!0;this.root===this&&(this.nodes=new xve)}addEventListener(y,w){return this.eventHandlers.has(y)||this.eventHandlers.set(y,new r2),this.eventHandlers.get(y).add(w)}notifyListeners(y,...w){const b=this.eventHandlers.get(y);b&&b.notify(...w)}hasListeners(y){return this.eventHandlers.has(y)}mount(y){if(this.instance)return;this.isSVG=g$(y)&&!Rye(y),this.instance=y;const{layoutId:w,layout:b,visualElement:x}=this.options;if(x&&!x.current&&x.mount(y),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(b||w)&&(this.isLayoutDirty=!0),i){let T,N=0;const O=()=>this.root.updateBlockedByResize=!1;ws.read(()=>{N=window.innerWidth}),i(y,()=>{const P=window.innerWidth;P!==N&&(N=P,this.root.updateBlockedByResize=!0,T&&T(),T=Tve(O,250),XC.hasAnimatedSinceResize&&(XC.hasAnimatedSinceResize=!1,this.nodes.forEach(fG)))})}w&&this.root.registerSharedNode(w,this),this.options.animate!==!1&&x&&(w||b)&&this.addEventListener("didUpdate",({delta:T,hasLayoutChanged:N,hasRelativeLayoutChanged:O,layout:P})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||x.getDefaultTransition()||Xve,{onLayoutAnimationStart:z,onLayoutAnimationComplete:V}=x.getProps(),W=!this.targetLayout||!Z$(this.targetLayout,P),te=!N&&O;if(this.options.layoutRoot||this.resumeFrom||te||N&&(W||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const $={...m2(F,"layout"),onPlay:z,onComplete:V};(x.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($),this.setAnimationOrigin(T,te)}else N||fG(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=P})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const y=this.getStack();y&&y.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),yp(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Kve),this.animationId++)}getTransformTemplate(){const{visualElement:y}=this.options;return y&&y.getProps().transformTemplate}willUpdate(y=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&eY(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let T=0;T<this.path.length;T++){const N=this.path[T];N.shouldResetTransform=!0,N.updateScroll("snapshot"),N.options.layoutRoot&&N.willUpdate(!1)}const{layoutId:w,layout:b}=this.options;if(w===void 0&&!b)return;const x=this.getTransformTemplate();this.prevTransformTemplateValue=x?x(this.latestValues,""):void 0,this.updateSnapshot(),y&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(hG);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(pG);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(qve),this.nodes.forEach(Uve),this.nodes.forEach(Fve)):this.nodes.forEach(pG),this.clearAllSnapshots();const w=ho.now();Yi.delta=Pu(0,1e3/60,w-Yi.timestamp),Yi.timestamp=w,Yi.isProcessing=!0,xk.update.process(Yi),xk.preRender.process(Yi),xk.render.process(Yi),Yi.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,_2.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Wve),this.sharedNodes.forEach(zve)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ws.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ws.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ka(this.snapshot.measuredBox.x)&&!ka(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let b=0;b<this.path.length;b++)this.path[b].updateScroll();const y=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ri(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:w}=this.options;w&&w.notify("LayoutMeasure",this.layout.layoutBox,y?y.layoutBox:void 0)}updateScroll(y="measure"){let w=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===y&&(w=!1),w&&this.instance){const b=l(this.instance);this.scroll={animationId:this.root.animationId,phase:y,isRoot:b,offset:a(this.instance),wasRoot:this.scroll?this.scroll.isRoot:b}}}resetTransform(){if(!u)return;const y=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,w=this.projectionDelta&&!Q$(this.projectionDelta),b=this.getTransformTemplate(),x=b?b(this.latestValues,""):void 0,T=x!==this.prevTransformTemplateValue;y&&this.instance&&(w||am(this.latestValues)||T)&&(u(this.instance,x),this.shouldResetTransform=!1,this.scheduleRender())}measure(y=!0){const w=this.measurePageBox();let b=this.removeElementScroll(w);return y&&(b=this.removeTransform(b)),Jve(b),{animationId:this.root.animationId,measuredBox:w,layoutBox:b,latestValues:{},source:this.id}}measurePageBox(){var x;const{visualElement:y}=this.options;if(!y)return ri();const w=y.measureViewportBox();if(!(((x=this.scroll)==null?void 0:x.wasRoot)||this.path.some(Qve))){const{scroll:T}=this.root;T&&(hy(w.x,T.offset.x),hy(w.y,T.offset.y))}return w}removeElementScroll(y){var b;const w=ri();if(yc(w,y),(b=this.scroll)!=null&&b.wasRoot)return w;for(let x=0;x<this.path.length;x++){const T=this.path[x],{scroll:N,options:O}=T;T!==this.root&&N&&O.layoutScroll&&(N.wasRoot&&yc(w,y),hy(w.x,N.offset.x),hy(w.y,N.offset.y))}return w}applyTransform(y,w=!1){const b=ri();yc(b,y);for(let x=0;x<this.path.length;x++){const T=this.path[x];!w&&T.options.layoutScroll&&T.scroll&&T!==T.root&&py(b,{x:-T.scroll.offset.x,y:-T.scroll.offset.y}),am(T.latestValues)&&py(b,T.latestValues)}return am(this.latestValues)&&py(b,this.latestValues),b}removeTransform(y){const w=ri();yc(w,y);for(let b=0;b<this.path.length;b++){const x=this.path[b];if(!x.instance||!am(x.latestValues))continue;zP(x.latestValues)&&x.updateSnapshot();const T=ri(),N=x.measurePageBox();yc(T,N),aG(w,x.latestValues,x.snapshot?x.snapshot.layoutBox:void 0,T)}return am(this.latestValues)&&aG(w,this.latestValues),w}setTargetDelta(y){this.targetDelta=y,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(y){this.options={...this.options,...y,crossfade:y.crossfade!==void 0?y.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Yi.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(y=!1){var O;const w=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=w.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=w.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=w.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==w;if(!(y||b&&this.isSharedProjectionDirty||this.isProjectionDirty||(O=this.parent)!=null&&O.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:T,layoutId:N}=this.options;if(!(!this.layout||!(T||N))){if(this.resolvedRelativeTargetAt=Yi.timestamp,!this.targetDelta&&!this.relativeTarget){const P=this.getClosestProjectingParent();P&&P.layout&&this.animationProgress!==1?(this.relativeParent=P,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ri(),this.relativeTargetOrigin=ri(),Cw(this.relativeTargetOrigin,this.layout.layoutBox,P.layout.layoutBox),yc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ri(),this.targetWithTransforms=ri()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),sve(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):yc(this.target,this.layout.layoutBox),P$(this.target,this.targetDelta)):yc(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const P=this.getClosestProjectingParent();P&&!!P.resumingFrom==!!this.resumingFrom&&!P.options.layoutScroll&&P.target&&this.animationProgress!==1?(this.relativeParent=P,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ri(),this.relativeTargetOrigin=ri(),Cw(this.relativeTargetOrigin,this.target,P.target),yc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||zP(this.parent.latestValues)||k$(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var F;const y=this.getLead(),w=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||(F=this.parent)!=null&&F.isProjectionDirty)&&(b=!1),w&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Yi.timestamp&&(b=!1),b)return;const{layout:x,layoutId:T}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(x||T))return;yc(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,O=this.treeScale.y;g0e(this.layoutCorrected,this.treeScale,this.path,w),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=ri());const{target:P}=y;if(!P){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(nG(this.prevProjectionDelta.x,this.projectionDelta.x),nG(this.prevProjectionDelta.y,this.projectionDelta.y)),Tw(this.projectionDelta,this.layoutCorrected,P,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==O||!uG(this.projectionDelta.x,this.prevProjectionDelta.x)||!uG(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",P))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(y=!0){var w;if((w=this.options.visualElement)==null||w.scheduleRender(),y){const b=this.getStack();b&&b.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=fy(),this.projectionDelta=fy(),this.projectionDeltaWithTransform=fy()}setAnimationOrigin(y,w=!1){const b=this.snapshot,x=b?b.latestValues:{},T={...this.latestValues},N=fy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!w;const O=ri(),P=b?b.source:void 0,F=this.layout?this.layout.source:void 0,z=P!==F,V=this.getStack(),W=!V||V.members.length<=1,te=!!(z&&!W&&this.options.crossfade===!0&&!this.path.some(Yve));this.animationProgress=0;let $;this.mixTargetDelta=Q=>{const G=Q/1e3;mG(N.x,y.x,G),mG(N.y,y.y,G),this.setTargetDelta(N),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Cw(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$ve(this.relativeTarget,this.relativeTargetOrigin,O,G),$&&Pve(this.relativeTarget,$)&&(this.isProjectionDirty=!1),$||($=ri()),yc($,this.relativeTarget)),z&&(this.animationValues=T,Rve(T,x,this.latestValues,G,te,W)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=G},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(y){var w,b,x;this.notifyListeners("animationStart"),(w=this.currentAnimation)==null||w.stop(),(x=(b=this.resumingFrom)==null?void 0:b.currentAnimation)==null||x.stop(),this.pendingAnimation&&(yp(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ws.update(()=>{XC.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=By(0)),this.currentAnimation=bve(this.motionValue,[0,1e3],{...y,velocity:0,isSync:!0,onUpdate:T=>{this.mixTargetDelta(T),y.onUpdate&&y.onUpdate(T)},onStop:()=>{},onComplete:()=>{y.onComplete&&y.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const y=this.getStack();y&&y.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Lve),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const y=this.getLead();let{targetWithTransforms:w,target:b,layout:x,latestValues:T}=y;if(!(!w||!b||!x)){if(this!==y&&this.layout&&x&&rY(this.options.animationType,this.layout.layoutBox,x.layoutBox)){b=this.target||ri();const N=ka(this.layout.layoutBox.x);b.x.min=y.target.x.min,b.x.max=b.x.min+N;const O=ka(this.layout.layoutBox.y);b.y.min=y.target.y.min,b.y.max=b.y.min+O}yc(w,b),py(w,T),Tw(this.projectionDeltaWithTransform,this.layoutCorrected,w,T)}}registerSharedNode(y,w){this.sharedNodes.has(y)||this.sharedNodes.set(y,new Dve),this.sharedNodes.get(y).add(w);const x=w.options.initialPromotionConfig;w.promote({transition:x?x.transition:void 0,preserveFollowOpacity:x&&x.shouldPreserveFollowOpacity?x.shouldPreserveFollowOpacity(w):void 0})}isLead(){const y=this.getStack();return y?y.lead===this:!0}getLead(){var w;const{layoutId:y}=this.options;return y?((w=this.getStack())==null?void 0:w.lead)||this:this}getPrevLead(){var w;const{layoutId:y}=this.options;return y?(w=this.getStack())==null?void 0:w.prevLead:void 0}getStack(){const{layoutId:y}=this.options;if(y)return this.root.sharedNodes.get(y)}promote({needsReset:y,transition:w,preserveFollowOpacity:b}={}){const x=this.getStack();x&&x.promote(this,b),y&&(this.projectionDelta=void 0,this.needsReset=!0),w&&this.setOptions({transition:w})}relegate(){const y=this.getStack();return y?y.relegate(this):!1}resetSkewAndRotation(){const{visualElement:y}=this.options;if(!y)return;let w=!1;const{latestValues:b}=y;if((b.z||b.rotate||b.rotateX||b.rotateY||b.rotateZ||b.skewX||b.skewY)&&(w=!0),!w)return;const x={};b.z&&Lk("z",y,x,this.animationValues);for(let T=0;T<jk.length;T++)Lk(`rotate${jk[T]}`,y,x,this.animationValues),Lk(`skew${jk[T]}`,y,x,this.animationValues);y.render();for(const T in x)y.setStaticValue(T,x[T]),this.animationValues&&(this.animationValues[T]=x[T]);y.scheduleRender()}applyProjectionStyles(y,w){if(!this.instance||this.isSVG)return;if(!this.isVisible){y.visibility="hidden";return}const b=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,y.visibility="",y.opacity="",y.pointerEvents=YC(w==null?void 0:w.pointerEvents)||"",y.transform=b?b(this.latestValues,""):"none";return}const x=this.getLead();if(!this.projectionDelta||!this.layout||!x.target){this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=YC(w==null?void 0:w.pointerEvents)||""),this.hasProjected&&!am(this.latestValues)&&(y.transform=b?b({},""):"none",this.hasProjected=!1);return}y.visibility="";const T=x.animationValues||x.latestValues;this.applyTransformsToTarget();let N=jve(this.projectionDeltaWithTransform,this.treeScale,T);b&&(N=b(T,N)),y.transform=N;const{x:O,y:P}=this.projectionDelta;y.transformOrigin=`${O.origin*100}% ${P.origin*100}% 0`,x.animationValues?y.opacity=x===this?T.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:T.opacityExit:y.opacity=x===this?T.opacity!==void 0?T.opacity:"":T.opacityExit!==void 0?T.opacityExit:0;for(const F in Gw){if(T[F]===void 0)continue;const{correct:z,applyTo:V,isCSSVariable:W}=Gw[F],te=N==="none"?T[F]:z(T[F],x);if(V){const $=V.length;for(let Q=0;Q<$;Q++)y[V[Q]]=te}else W?this.options.visualElement.renderState.vars[F]=te:y[F]=te}this.options.layoutId&&(y.pointerEvents=x===this?YC(w==null?void 0:w.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(y=>{var w;return(w=y.currentAnimation)==null?void 0:w.stop()}),this.root.nodes.forEach(hG),this.root.sharedNodes.clear()}}}function Uve(i){i.updateLayout()}function Fve(i){var a;const n=((a=i.resumeFrom)==null?void 0:a.snapshot)||i.snapshot;if(i.isLead()&&i.layout&&n&&i.hasListeners("didUpdate")){const{layoutBox:l,measuredBox:u}=i.layout,{animationType:m}=i.options,y=n.source!==i.layout.source;m==="size"?vc(N=>{const O=y?n.measuredBox[N]:n.layoutBox[N],P=ka(O);O.min=l[N].min,O.max=O.min+P}):rY(m,n.layoutBox,l)&&vc(N=>{const O=y?n.measuredBox[N]:n.layoutBox[N],P=ka(l[N]);O.max=O.min+P,i.relativeTarget&&!i.currentAnimation&&(i.isProjectionDirty=!0,i.relativeTarget[N].max=i.relativeTarget[N].min+P)});const w=fy();Tw(w,l,n.layoutBox);const b=fy();y?Tw(b,i.applyTransform(u,!0),n.measuredBox):Tw(b,l,n.layoutBox);const x=!Q$(w);let T=!1;if(!i.resumeFrom){const N=i.getClosestProjectingParent();if(N&&!N.resumeFrom){const{snapshot:O,layout:P}=N;if(O&&P){const F=ri();Cw(F,n.layoutBox,O.layoutBox);const z=ri();Cw(z,l,P.layoutBox),Z$(F,z)||(T=!0),N.options.layoutRoot&&(i.relativeTarget=z,i.relativeTargetOrigin=F,i.relativeParent=N)}}}i.notifyListeners("didUpdate",{layout:l,snapshot:n,delta:b,layoutDelta:w,hasLayoutChanged:x,hasRelativeLayoutChanged:T})}else if(i.isLead()){const{onExitComplete:l}=i.options;l&&l()}i.options.transition=void 0}function Vve(i){i.parent&&(i.isProjecting()||(i.isProjectionDirty=i.parent.isProjectionDirty),i.isSharedProjectionDirty||(i.isSharedProjectionDirty=!!(i.isProjectionDirty||i.parent.isProjectionDirty||i.parent.isSharedProjectionDirty)),i.isTransformDirty||(i.isTransformDirty=i.parent.isTransformDirty))}function Bve(i){i.isProjectionDirty=i.isSharedProjectionDirty=i.isTransformDirty=!1}function Wve(i){i.clearSnapshot()}function hG(i){i.clearMeasurements()}function pG(i){i.isLayoutDirty=!1}function qve(i){const{visualElement:n}=i.options;n&&n.getProps().onBeforeLayoutMeasure&&n.notify("BeforeLayoutMeasure"),i.resetTransform()}function fG(i){i.finishAnimation(),i.targetDelta=i.relativeTarget=i.target=void 0,i.isProjectionDirty=!0}function Gve(i){i.resolveTargetDelta()}function Hve(i){i.calcProjection()}function Kve(i){i.resetSkewAndRotation()}function zve(i){i.removeLeadSnapshot()}function mG(i,n,a){i.translate=Ps(n.translate,0,a),i.scale=Ps(n.scale,1,a),i.origin=n.origin,i.originPoint=n.originPoint}function gG(i,n,a,l){i.min=Ps(n.min,a.min,l),i.max=Ps(n.max,a.max,l)}function $ve(i,n,a,l){gG(i.x,n.x,a.x,l),gG(i.y,n.y,a.y,l)}function Yve(i){return i.animationValues&&i.animationValues.opacityExit!==void 0}const Xve={duration:.45,ease:[.4,0,.1,1]},_G=i=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(i),yG=_G("applewebkit/")&&!_G("chrome/")?Math.round:kc;function vG(i){i.min=yG(i.min),i.max=yG(i.max)}function Jve(i){vG(i.x),vG(i.y)}function rY(i,n,a){return i==="position"||i==="preserve-aspect"&&!nve(dG(n),dG(a),.2)}function Qve(i){var n;return i!==i.root&&((n=i.scroll)==null?void 0:n.wasRoot)}const Zve=tY({attachResizeListener:(i,n)=>Hw(i,"resize",n),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Mk={current:void 0},nY=tY({measureScroll:i=>({x:i.scrollLeft,y:i.scrollTop}),defaultParent:()=>{if(!Mk.current){const i=new Zve({});i.mount(window),i.setOptions({layoutScroll:!0}),Mk.current=i}return Mk.current},resetTransform:(i,n)=>{i.style.transform=n!==void 0?n:"none"},checkIsScrollRoot:i=>window.getComputedStyle(i).position==="fixed"}),eEe={pan:{Feature:yve},drag:{Feature:_ve,ProjectionNode:nY,MeasureLayout:Y$}};function EG(i,n,a){const{props:l}=i;i.animationState&&l.whileHover&&i.animationState.setActive("whileHover",a==="Start");const u="onHover"+a,m=l[u];m&&ws.postRender(()=>m(n,lb(n)))}class tEe extends bp{mount(){const{current:n}=this.node;n&&(this.unmount=bye(n,(a,l)=>(EG(this.node,l,"Start"),u=>EG(this.node,u,"End"))))}unmount(){}}class rEe extends bp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let n=!1;try{n=this.node.current.matches(":focus-visible")}catch{n=!0}!n||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ab(Hw(this.node.current,"focus",()=>this.onFocus()),Hw(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function wG(i,n,a){const{props:l}=i;if(i.current instanceof HTMLButtonElement&&i.current.disabled)return;i.animationState&&l.whileTap&&i.animationState.setActive("whileTap",a==="Start");const u="onTap"+(a==="End"?"":a),m=l[u];m&&ws.postRender(()=>m(n,lb(n)))}class nEe extends bp{mount(){const{current:n}=this.node;n&&(this.unmount=Cye(n,(a,l)=>(wG(this.node,l,"Start"),(u,{success:m})=>wG(this.node,u,m?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const eD=new WeakMap,Uk=new WeakMap,sEe=i=>{const n=eD.get(i.target);n&&n(i)},iEe=i=>{i.forEach(sEe)};function aEe({root:i,...n}){const a=i||document;Uk.has(a)||Uk.set(a,{});const l=Uk.get(a),u=JSON.stringify(n);return l[u]||(l[u]=new IntersectionObserver(iEe,{root:i,...n})),l[u]}function oEe(i,n,a){const l=aEe(n);return eD.set(i,a),l.observe(i),()=>{eD.delete(i),l.unobserve(i)}}const cEe={some:0,all:1};class lEe extends bp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:n={}}=this.node.getProps(),{root:a,margin:l,amount:u="some",once:m}=n,y={root:a?a.current:void 0,rootMargin:l,threshold:typeof u=="number"?u:cEe[u]},w=b=>{const{isIntersecting:x}=b;if(this.isInView===x||(this.isInView=x,m&&!x&&this.hasEnteredView))return;x&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",x);const{onViewportEnter:T,onViewportLeave:N}=this.node.getProps(),O=x?T:N;O&&O(b)};return oEe(this.node.current,y,w)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:n,prevProps:a}=this.node;["amount","margin","root"].some(dEe(n,a))&&this.startObserver()}unmount(){}}function dEe({viewport:i={}},{viewport:n={}}={}){return a=>i[a]!==n[a]}const uEe={inView:{Feature:lEe},tap:{Feature:nEe},focus:{Feature:rEe},hover:{Feature:tEe}},hEe={layout:{ProjectionNode:nY,MeasureLayout:Y$}},pEe={...J0e,...uEe,...eEe,...hEe},Xi=p0e(pEe,C0e);function gm({open:i,onOpenChange:n,children:a}){const[l,u]=ut.useState(!!i);ut.useEffect(()=>{typeof i=="boolean"&&u(i)},[i]);const m=()=>{u(!1),n&&n(!1)};return l?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",onClick:m,children:o.jsx("div",{className:"bg-[#0a0a0f] border border-[#2a2a3a] rounded-2xl p-4",onClick:y=>y.stopPropagation(),children:a})}):null}function _m({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function ym({children:i,className:n=""}){return o.jsx("div",{className:`mb-2 ${n}`,children:i})}function vm({children:i,className:n=""}){return o.jsx("h3",{className:`text-white font-bold ${n}`,children:i})}function my({children:i,className:n=""}){return o.jsx("p",{className:`text-gray-400 text-sm ${n}`,children:i})}function fEe({children:i,className:n="",onClick:a}){return o.jsx("button",{className:n,onClick:a,children:i})}function mEe({children:i,className:n=""}){return o.jsx("div",{className:`mt-4 flex justify-end gap-2 ${n}`,children:i})}const I2=ut.createContext({value:void 0,setValue:()=>{}});function db({value:i,onValueChange:n,children:a,className:l=""}){const[u,m]=ut.useState(i);ut.useEffect(()=>m(i),[i]);const y=w=>{m(w),n&&n(w)};return o.jsx(I2.Provider,{value:{value:u,setValue:y},children:o.jsx("div",{className:l,children:a})})}function ub({children:i,className:n=""}){return o.jsx("div",{className:n,children:i})}function es({value:i,children:n,className:a="",asChild:l=!1}){const{value:u,setValue:m}=ut.useContext(I2),b={className:`${`px-3 py-1 text-sm rounded ${u===i?"bg-cyan-600 text-white":"bg-[#0a0a0f] border border-[#2a2a3a] text-gray-300"}`} ${a}`,onClick:()=>m(i)};return l?ut.cloneElement(n,b):o.jsx("button",{...b,children:n})}function Gs({value:i,children:n,className:a=""}){const{value:l}=ut.useContext(I2);return o.jsx("div",{className:a,style:{display:l===i?"block":"none"},children:n})}function Al(i){const n=Object.prototype.toString.call(i);return i instanceof Date||typeof i=="object"&&n==="[object Date]"?new i.constructor(+i):typeof i=="number"||n==="[object Number]"||typeof i=="string"||n==="[object String]"?new Date(i):new Date(NaN)}function Lm(i,n){return i instanceof Date?new i.constructor(n):new Date(n)}const sY=6048e5,gEe=864e5;let _Ee={};function zR(){return _Ee}function Kw(i,n){var w,b,x,T;const a=zR(),l=(n==null?void 0:n.weekStartsOn)??((b=(w=n==null?void 0:n.locale)==null?void 0:w.options)==null?void 0:b.weekStartsOn)??a.weekStartsOn??((T=(x=a.locale)==null?void 0:x.options)==null?void 0:T.weekStartsOn)??0,u=Al(i),m=u.getDay(),y=(m<l?7:0)+m-l;return u.setDate(u.getDate()-y),u.setHours(0,0,0,0),u}function SR(i){return Kw(i,{weekStartsOn:1})}function iY(i){const n=Al(i),a=n.getFullYear(),l=Lm(i,0);l.setFullYear(a+1,0,4),l.setHours(0,0,0,0);const u=SR(l),m=Lm(i,0);m.setFullYear(a,0,4),m.setHours(0,0,0,0);const y=SR(m);return n.getTime()>=u.getTime()?a+1:n.getTime()>=y.getTime()?a:a-1}function bG(i){const n=Al(i);return n.setHours(0,0,0,0),n}function SG(i){const n=Al(i),a=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return a.setUTCFullYear(n.getFullYear()),+i-+a}function yEe(i,n){const a=bG(i),l=bG(n),u=+a-SG(a),m=+l-SG(l);return Math.round((u-m)/gEe)}function vEe(i){const n=iY(i),a=Lm(i,0);return a.setFullYear(n,0,4),a.setHours(0,0,0,0),SR(a)}function EEe(i){return i instanceof Date||typeof i=="object"&&Object.prototype.toString.call(i)==="[object Date]"}function wEe(i){if(!EEe(i)&&typeof i!="number")return!1;const n=Al(i);return!isNaN(Number(n))}function bEe(i){const n=Al(i),a=Lm(i,0);return a.setFullYear(n.getFullYear(),0,1),a.setHours(0,0,0,0),a}const SEe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},xEe=(i,n,a)=>{let l;const u=SEe[i];return typeof u=="string"?l=u:n===1?l=u.one:l=u.other.replace("{{count}}",n.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+l:l+" ago":l};function Fk(i){return(n={})=>{const a=n.width?String(n.width):i.defaultWidth;return i.formats[a]||i.formats[i.defaultWidth]}}const TEe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},CEe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},REe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},NEe={date:Fk({formats:TEe,defaultWidth:"full"}),time:Fk({formats:CEe,defaultWidth:"full"}),dateTime:Fk({formats:REe,defaultWidth:"full"})},AEe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},IEe=(i,n,a,l)=>AEe[i];function dw(i){return(n,a)=>{const l=a!=null&&a.context?String(a.context):"standalone";let u;if(l==="formatting"&&i.formattingValues){const y=i.defaultFormattingWidth||i.defaultWidth,w=a!=null&&a.width?String(a.width):y;u=i.formattingValues[w]||i.formattingValues[y]}else{const y=i.defaultWidth,w=a!=null&&a.width?String(a.width):i.defaultWidth;u=i.values[w]||i.values[y]}const m=i.argumentCallback?i.argumentCallback(n):n;return u[m]}}const OEe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},kEe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},PEe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},DEe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},jEe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},LEe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},MEe=(i,n)=>{const a=Number(i),l=a%100;if(l>20||l<10)switch(l%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},UEe={ordinalNumber:MEe,era:dw({values:OEe,defaultWidth:"wide"}),quarter:dw({values:kEe,defaultWidth:"wide",argumentCallback:i=>i-1}),month:dw({values:PEe,defaultWidth:"wide"}),day:dw({values:DEe,defaultWidth:"wide"}),dayPeriod:dw({values:jEe,defaultWidth:"wide",formattingValues:LEe,defaultFormattingWidth:"wide"})};function uw(i){return(n,a={})=>{const l=a.width,u=l&&i.matchPatterns[l]||i.matchPatterns[i.defaultMatchWidth],m=n.match(u);if(!m)return null;const y=m[0],w=l&&i.parsePatterns[l]||i.parsePatterns[i.defaultParseWidth],b=Array.isArray(w)?VEe(w,N=>N.test(y)):FEe(w,N=>N.test(y));let x;x=i.valueCallback?i.valueCallback(b):b,x=a.valueCallback?a.valueCallback(x):x;const T=n.slice(y.length);return{value:x,rest:T}}}function FEe(i,n){for(const a in i)if(Object.prototype.hasOwnProperty.call(i,a)&&n(i[a]))return a}function VEe(i,n){for(let a=0;a<i.length;a++)if(n(i[a]))return a}function BEe(i){return(n,a={})=>{const l=n.match(i.matchPattern);if(!l)return null;const u=l[0],m=n.match(i.parsePattern);if(!m)return null;let y=i.valueCallback?i.valueCallback(m[0]):m[0];y=a.valueCallback?a.valueCallback(y):y;const w=n.slice(u.length);return{value:y,rest:w}}}const WEe=/^(\d+)(th|st|nd|rd)?/i,qEe=/\d+/i,GEe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},HEe={any:[/^b/i,/^(a|c)/i]},KEe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},zEe={any:[/1/i,/2/i,/3/i,/4/i]},$Ee={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},YEe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},XEe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},JEe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},QEe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ZEe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},ewe={ordinalNumber:BEe({matchPattern:WEe,parsePattern:qEe,valueCallback:i=>parseInt(i,10)}),era:uw({matchPatterns:GEe,defaultMatchWidth:"wide",parsePatterns:HEe,defaultParseWidth:"any"}),quarter:uw({matchPatterns:KEe,defaultMatchWidth:"wide",parsePatterns:zEe,defaultParseWidth:"any",valueCallback:i=>i+1}),month:uw({matchPatterns:$Ee,defaultMatchWidth:"wide",parsePatterns:YEe,defaultParseWidth:"any"}),day:uw({matchPatterns:XEe,defaultMatchWidth:"wide",parsePatterns:JEe,defaultParseWidth:"any"}),dayPeriod:uw({matchPatterns:QEe,defaultMatchWidth:"any",parsePatterns:ZEe,defaultParseWidth:"any"})},twe={code:"en-US",formatDistance:xEe,formatLong:NEe,formatRelative:IEe,localize:UEe,match:ewe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function rwe(i){const n=Al(i);return yEe(n,bEe(n))+1}function nwe(i){const n=Al(i),a=+SR(n)-+vEe(n);return Math.round(a/sY)+1}function aY(i,n){var T,N,O,P;const a=Al(i),l=a.getFullYear(),u=zR(),m=(n==null?void 0:n.firstWeekContainsDate)??((N=(T=n==null?void 0:n.locale)==null?void 0:T.options)==null?void 0:N.firstWeekContainsDate)??u.firstWeekContainsDate??((P=(O=u.locale)==null?void 0:O.options)==null?void 0:P.firstWeekContainsDate)??1,y=Lm(i,0);y.setFullYear(l+1,0,m),y.setHours(0,0,0,0);const w=Kw(y,n),b=Lm(i,0);b.setFullYear(l,0,m),b.setHours(0,0,0,0);const x=Kw(b,n);return a.getTime()>=w.getTime()?l+1:a.getTime()>=x.getTime()?l:l-1}function swe(i,n){var w,b,x,T;const a=zR(),l=(n==null?void 0:n.firstWeekContainsDate)??((b=(w=n==null?void 0:n.locale)==null?void 0:w.options)==null?void 0:b.firstWeekContainsDate)??a.firstWeekContainsDate??((T=(x=a.locale)==null?void 0:x.options)==null?void 0:T.firstWeekContainsDate)??1,u=aY(i,n),m=Lm(i,0);return m.setFullYear(u,0,l),m.setHours(0,0,0,0),Kw(m,n)}function iwe(i,n){const a=Al(i),l=+Kw(a,n)-+swe(a,n);return Math.round(l/sY)+1}function Bn(i,n){const a=i<0?"-":"",l=Math.abs(i).toString().padStart(n,"0");return a+l}const $h={y(i,n){const a=i.getFullYear(),l=a>0?a:1-a;return Bn(n==="yy"?l%100:l,n.length)},M(i,n){const a=i.getMonth();return n==="M"?String(a+1):Bn(a+1,2)},d(i,n){return Bn(i.getDate(),n.length)},a(i,n){const a=i.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(i,n){return Bn(i.getHours()%12||12,n.length)},H(i,n){return Bn(i.getHours(),n.length)},m(i,n){return Bn(i.getMinutes(),n.length)},s(i,n){return Bn(i.getSeconds(),n.length)},S(i,n){const a=n.length,l=i.getMilliseconds(),u=Math.trunc(l*Math.pow(10,a-3));return Bn(u,n.length)}},iy={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},xG={G:function(i,n,a){const l=i.getFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return a.era(l,{width:"abbreviated"});case"GGGGG":return a.era(l,{width:"narrow"});case"GGGG":default:return a.era(l,{width:"wide"})}},y:function(i,n,a){if(n==="yo"){const l=i.getFullYear(),u=l>0?l:1-l;return a.ordinalNumber(u,{unit:"year"})}return $h.y(i,n)},Y:function(i,n,a,l){const u=aY(i,l),m=u>0?u:1-u;if(n==="YY"){const y=m%100;return Bn(y,2)}return n==="Yo"?a.ordinalNumber(m,{unit:"year"}):Bn(m,n.length)},R:function(i,n){const a=iY(i);return Bn(a,n.length)},u:function(i,n){const a=i.getFullYear();return Bn(a,n.length)},Q:function(i,n,a){const l=Math.ceil((i.getMonth()+1)/3);switch(n){case"Q":return String(l);case"QQ":return Bn(l,2);case"Qo":return a.ordinalNumber(l,{unit:"quarter"});case"QQQ":return a.quarter(l,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(l,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(l,{width:"wide",context:"formatting"})}},q:function(i,n,a){const l=Math.ceil((i.getMonth()+1)/3);switch(n){case"q":return String(l);case"qq":return Bn(l,2);case"qo":return a.ordinalNumber(l,{unit:"quarter"});case"qqq":return a.quarter(l,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(l,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(l,{width:"wide",context:"standalone"})}},M:function(i,n,a){const l=i.getMonth();switch(n){case"M":case"MM":return $h.M(i,n);case"Mo":return a.ordinalNumber(l+1,{unit:"month"});case"MMM":return a.month(l,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(l,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(l,{width:"wide",context:"formatting"})}},L:function(i,n,a){const l=i.getMonth();switch(n){case"L":return String(l+1);case"LL":return Bn(l+1,2);case"Lo":return a.ordinalNumber(l+1,{unit:"month"});case"LLL":return a.month(l,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(l,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(l,{width:"wide",context:"standalone"})}},w:function(i,n,a,l){const u=iwe(i,l);return n==="wo"?a.ordinalNumber(u,{unit:"week"}):Bn(u,n.length)},I:function(i,n,a){const l=nwe(i);return n==="Io"?a.ordinalNumber(l,{unit:"week"}):Bn(l,n.length)},d:function(i,n,a){return n==="do"?a.ordinalNumber(i.getDate(),{unit:"date"}):$h.d(i,n)},D:function(i,n,a){const l=rwe(i);return n==="Do"?a.ordinalNumber(l,{unit:"dayOfYear"}):Bn(l,n.length)},E:function(i,n,a){const l=i.getDay();switch(n){case"E":case"EE":case"EEE":return a.day(l,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(l,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(l,{width:"short",context:"formatting"});case"EEEE":default:return a.day(l,{width:"wide",context:"formatting"})}},e:function(i,n,a,l){const u=i.getDay(),m=(u-l.weekStartsOn+8)%7||7;switch(n){case"e":return String(m);case"ee":return Bn(m,2);case"eo":return a.ordinalNumber(m,{unit:"day"});case"eee":return a.day(u,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(u,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(u,{width:"short",context:"formatting"});case"eeee":default:return a.day(u,{width:"wide",context:"formatting"})}},c:function(i,n,a,l){const u=i.getDay(),m=(u-l.weekStartsOn+8)%7||7;switch(n){case"c":return String(m);case"cc":return Bn(m,n.length);case"co":return a.ordinalNumber(m,{unit:"day"});case"ccc":return a.day(u,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(u,{width:"narrow",context:"standalone"});case"cccccc":return a.day(u,{width:"short",context:"standalone"});case"cccc":default:return a.day(u,{width:"wide",context:"standalone"})}},i:function(i,n,a){const l=i.getDay(),u=l===0?7:l;switch(n){case"i":return String(u);case"ii":return Bn(u,n.length);case"io":return a.ordinalNumber(u,{unit:"day"});case"iii":return a.day(l,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(l,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(l,{width:"short",context:"formatting"});case"iiii":default:return a.day(l,{width:"wide",context:"formatting"})}},a:function(i,n,a){const u=i.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(u,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(u,{width:"wide",context:"formatting"})}},b:function(i,n,a){const l=i.getHours();let u;switch(l===12?u=iy.noon:l===0?u=iy.midnight:u=l/12>=1?"pm":"am",n){case"b":case"bb":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(u,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(u,{width:"wide",context:"formatting"})}},B:function(i,n,a){const l=i.getHours();let u;switch(l>=17?u=iy.evening:l>=12?u=iy.afternoon:l>=4?u=iy.morning:u=iy.night,n){case"B":case"BB":case"BBB":return a.dayPeriod(u,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(u,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(u,{width:"wide",context:"formatting"})}},h:function(i,n,a){if(n==="ho"){let l=i.getHours()%12;return l===0&&(l=12),a.ordinalNumber(l,{unit:"hour"})}return $h.h(i,n)},H:function(i,n,a){return n==="Ho"?a.ordinalNumber(i.getHours(),{unit:"hour"}):$h.H(i,n)},K:function(i,n,a){const l=i.getHours()%12;return n==="Ko"?a.ordinalNumber(l,{unit:"hour"}):Bn(l,n.length)},k:function(i,n,a){let l=i.getHours();return l===0&&(l=24),n==="ko"?a.ordinalNumber(l,{unit:"hour"}):Bn(l,n.length)},m:function(i,n,a){return n==="mo"?a.ordinalNumber(i.getMinutes(),{unit:"minute"}):$h.m(i,n)},s:function(i,n,a){return n==="so"?a.ordinalNumber(i.getSeconds(),{unit:"second"}):$h.s(i,n)},S:function(i,n){return $h.S(i,n)},X:function(i,n,a){const l=i.getTimezoneOffset();if(l===0)return"Z";switch(n){case"X":return CG(l);case"XXXX":case"XX":return om(l);case"XXXXX":case"XXX":default:return om(l,":")}},x:function(i,n,a){const l=i.getTimezoneOffset();switch(n){case"x":return CG(l);case"xxxx":case"xx":return om(l);case"xxxxx":case"xxx":default:return om(l,":")}},O:function(i,n,a){const l=i.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+TG(l,":");case"OOOO":default:return"GMT"+om(l,":")}},z:function(i,n,a){const l=i.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+TG(l,":");case"zzzz":default:return"GMT"+om(l,":")}},t:function(i,n,a){const l=Math.trunc(i.getTime()/1e3);return Bn(l,n.length)},T:function(i,n,a){const l=i.getTime();return Bn(l,n.length)}};function TG(i,n=""){const a=i>0?"-":"+",l=Math.abs(i),u=Math.trunc(l/60),m=l%60;return m===0?a+String(u):a+String(u)+n+Bn(m,2)}function CG(i,n){return i%60===0?(i>0?"-":"+")+Bn(Math.abs(i)/60,2):om(i,n)}function om(i,n=""){const a=i>0?"-":"+",l=Math.abs(i),u=Bn(Math.trunc(l/60),2),m=Bn(l%60,2);return a+u+n+m}const RG=(i,n)=>{switch(i){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},oY=(i,n)=>{switch(i){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},awe=(i,n)=>{const a=i.match(/(P+)(p+)?/)||[],l=a[1],u=a[2];if(!u)return RG(i,n);let m;switch(l){case"P":m=n.dateTime({width:"short"});break;case"PP":m=n.dateTime({width:"medium"});break;case"PPP":m=n.dateTime({width:"long"});break;case"PPPP":default:m=n.dateTime({width:"full"});break}return m.replace("{{date}}",RG(l,n)).replace("{{time}}",oY(u,n))},owe={p:oY,P:awe},cwe=/^D+$/,lwe=/^Y+$/,dwe=["D","DD","YY","YYYY"];function uwe(i){return cwe.test(i)}function hwe(i){return lwe.test(i)}function pwe(i,n,a){const l=fwe(i,n,a);if(console.warn(l),dwe.includes(i))throw new RangeError(l)}function fwe(i,n,a){const l=i[0]==="Y"?"years":"days of the month";return`Use \`${i.toLowerCase()}\` instead of \`${i}\` (in \`${n}\`) for formatting ${l} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const mwe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,gwe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,_we=/^'([^]*?)'?$/,ywe=/''/g,vwe=/[a-zA-Z]/;function hp(i,n,a){var T,N,O,P;const l=zR(),u=l.locale??twe,m=l.firstWeekContainsDate??((N=(T=l.locale)==null?void 0:T.options)==null?void 0:N.firstWeekContainsDate)??1,y=l.weekStartsOn??((P=(O=l.locale)==null?void 0:O.options)==null?void 0:P.weekStartsOn)??0,w=Al(i);if(!wEe(w))throw new RangeError("Invalid time value");let b=n.match(gwe).map(F=>{const z=F[0];if(z==="p"||z==="P"){const V=owe[z];return V(F,u.formatLong)}return F}).join("").match(mwe).map(F=>{if(F==="''")return{isToken:!1,value:"'"};const z=F[0];if(z==="'")return{isToken:!1,value:Ewe(F)};if(xG[z])return{isToken:!0,value:F};if(z.match(vwe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+z+"`");return{isToken:!1,value:F}});u.localize.preprocessor&&(b=u.localize.preprocessor(w,b));const x={firstWeekContainsDate:m,weekStartsOn:y,locale:u};return b.map(F=>{if(!F.isToken)return F.value;const z=F.value;(hwe(z)||uwe(z))&&pwe(z,n,String(i));const V=xG[z[0]];return V(w,z,u.localize,x)}).join("")}function Ewe(i){const n=i.match(_we);return n?n[1].replace(ywe,"'"):i}const Nl=M.forwardRef(({className:i,...n},a)=>o.jsx("textarea",{className:bz("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:a,...n}));Nl.displayName="Textarea";const cY=({pageName:i,currentContent:n,onSave:a,fieldName:l="content"})=>{const[u,m]=M.useState(!1),[y,w]=M.useState(n),[b,x]=M.useState(!1),{data:T}=mt({queryKey:["userProfile","admin-check"],queryFn:async()=>{const{data:{user:F}}=await K.auth.getUser();if(!F)return null;const{data:z,error:V}=await K.from("profiles").select("id, username, is_admin, role").eq("id",F.id).single();if(V)throw V;return z},enabled:!!n});if(!((T==null?void 0:T.is_admin)||(T==null?void 0:T.role)==="admin"))return null;const O=async()=>{if(!y.trim()){pe.error("Content cannot be empty");return}x(!0);try{await a(y),pe.success(` ${i} updated successfully!`),m(!1)}catch(F){console.error(`Error updating ${i}:`,F),pe.error(`Failed to update ${i}: ${F.message}`)}finally{x(!1)}},P=()=>{w(n),m(!1)};return u?o.jsx(Fe,{className:"mb-4 bg-blue-500/10 border-blue-500/30 p-4",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("h3",{className:"text-blue-400 font-semibold",children:["Edit ",i]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{onClick:P,size:"sm",variant:"outline",className:"border-gray-500 text-gray-400",children:[o.jsx(Oc,{className:"w-3 h-3 mr-1"}),"Cancel"]}),o.jsx(ke,{onClick:O,size:"sm",disabled:b,className:"bg-blue-600 hover:bg-blue-700",children:b?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin mr-1"}),"Saving..."]}):o.jsxs(o.Fragment,{children:[o.jsx(RR,{className:"w-3 h-3 mr-1"}),"Save Changes"]})})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-sm text-gray-400",children:"Content"}),o.jsx(Nl,{value:y,onChange:F=>w(F.target.value),className:"bg-gray-900 border-gray-700 text-white min-h-[200px]",placeholder:`Enter ${i} content...`})]}),o.jsxs("div",{className:"text-xs text-gray-500",children:[o.jsx("p",{children:" Changes will be visible to all users immediately"}),o.jsx("p",{children:" Use Markdown formatting for better styling"}),o.jsx("p",{children:" Preview changes before saving"})]})]})}):o.jsx(Fe,{className:"mb-4 bg-yellow-500/10 border-yellow-500/30 p-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(fp,{className:"w-4 h-4 text-yellow-400"}),o.jsxs("span",{className:"text-yellow-400 text-sm font-medium",children:["Admin Mode: Edit ",i]})]}),o.jsxs(ke,{onClick:()=>m(!0),size:"sm",variant:"outline",className:"border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",children:[o.jsx(cP,{className:"w-3 h-3 mr-1"}),"Edit"]})]})})};async function wwe(i,n="content"){try{const{data:a,error:l}=await K.rpc("get_admin_content",{page_name_param:i,field_name_param:n});return l?(console.warn(`No admin content found for ${i}.${n}`),""):a||""}catch(a){return console.error(`Error getting admin content for ${i}.${n}:`,a),""}}async function bwe(i,n,a="content"){try{const{error:l}=await K.from("admin_content").update({is_active:!1}).eq("page_name",i).eq("field_name",a).eq("is_active",!0);if(l)throw console.error("Error deactivating old content:",l),l;const{data:{user:u}}=await K.auth.getUser();if(!u)throw new Error("User not authenticated");const{error:m}=await K.from("admin_content").insert({page_name:i,field_name:a,content:n,updated_by:u.id,is_active:!0});if(m)throw console.error("Error inserting new content:",m),m;return!0}catch(l){throw console.error(`Error updating admin content for ${i}.${a}:`,l),l}}function lY(){const i=vn(),[n,a]=M.useState(""),[l,u]=M.useState(!1),[m,y]=M.useState(null),[w,b]=M.useState(""),[x,T]=M.useState(""),[N,O]=M.useState(""),[P,F]=M.useState(""),[z,V]=M.useState(""),{data:W}=mt({queryKey:["user"],queryFn:async()=>{const{data:{user:me}}=await K.auth.getUser();if(!me)return null;const{data:ye}=await K.from("profiles").select("*, purchased_coins, free_coins").eq("id",me.id).single();return ye}}),{data:te}=mt({queryKey:["userPaymentMethods",W==null?void 0:W.id],queryFn:async()=>{if(!(W!=null&&W.id))return null;const me=await KD(W.id);return console.log("User payment methods loaded:",me),me},enabled:!!(W!=null&&W.id)}),{data:$}=mt({queryKey:["availablePaymentMethods",W==null?void 0:W.id],queryFn:async()=>{if(!(W!=null&&W.id))return null;const me=await Pge(W.id);return console.log("Available payment methods:",me),me},enabled:!!(W!=null&&W.id)}),{isLoading:Q}=mt({queryKey:["adminContent","Store"],queryFn:async()=>{const me=await wwe("Store","header_content");return V(me||""),me}}),{data:G=[]}=mt({queryKey:["coinPackages"],queryFn:async()=>{const{data:me,error:ye}=await K.from("coin_packages").select("*").order("price",{ascending:!0});return ye?(console.error("Error fetching coin packages:",ye),[]):me||[]}}),{data:se=[]}=mt({queryKey:["purchaseHistory",W==null?void 0:W.id],queryFn:async()=>{if(!(W!=null&&W.id))return[];const{data:me,error:ye}=await K.from("coin_purchases").select("*").eq("user_id",W.id).order("created_date",{ascending:!1}).limit(10);return ye?(console.error("Error fetching purchase history:",ye),[]):(me||[]).map(ge=>({...ge,type:"coins",date:ge.created_date}))},enabled:!!(W!=null&&W.id)}),ie=M.useMemo(()=>{const me=parseFloat(n);return isNaN(me)||me===0?0:Math.floor(Ze(me))},[n]),ce=M.useMemo(()=>{const me=parseFloat(n);return isNaN(me)||me===0?0:Math.floor(Ze(me)/me)},[n]),Se=Wt({mutationFn:async({packageData:me,paymentMethod:ye})=>{if(!(W!=null&&W.id))throw new Error("User not authenticated");const ge=Math.round(me.price*100),Ee=`${W.id}-${me.id}-${Date.now()}`;let Oe;if(ye&&te){const fe={apple_pay:"applePay",google_wallet:"googleWallet",chime:"chime",cashapp:"cashApp"}[ye],De=te[fe];if(De)Oe=await kge(W.id,ye,De,ge,"usd",`Purchase of ${me.coins} Troll Coins`,me.coins,Ee);else{pe.error(`No saved ${ye} payment method found`);return}}else if(w&&w!=="new_card")Oe=await GD(w,ge,"usd",`Purchase of ${me.coins+(me.bonus||0)} Troll Coins`);else{pe.error("Please select a payment method");return}if(Oe.success)return await zD(W.id,me.coins,"purchase"),await K.from("coin_purchases").insert({user_id:W.id,coin_amount:me.coins,usd_amount:me.price,status:"completed",square_charge_id:Oe.transactionId,package_id:me.id,created_date:new Date().toISOString()}),Oe;throw new Error(Oe.error||"Payment failed")},onSuccess:()=>{i.invalidateQueries(["user"]),i.invalidateQueries(["purchaseHistory"]),pe.success("Purchase successful! Coins have been added to your account."),u(!1),y(null),b(""),T(""),O(""),F("")},onError:me=>{pe.error(me.message||"Purchase failed")}}),oe=me=>{console.log("Opening payment dialog:",{pkg:me,userPaymentMethods:te,availableMethods:$,selectedMethod:w}),y(me),u(!0)},ve=()=>{const me=parseFloat(n);if(isNaN(me)||me<.1){pe.error("Please enter a valid amount (minimum $0.10)");return}y({id:"custom",coins:ie,bonus:0,price:me,emoji:"",name:"Custom Amount",description:"Custom coin purchase"}),u(!0)},he=()=>{if(m){if(console.log("Purchase confirmation:",{selectedMethod:w,userPaymentMethods:te,availableMethods:$,selectedPackage:m}),w==="new_card"&&(!x||!N||!P)){pe.error("Please fill in all card details");return}Se.mutate({packageData:m,paymentMethod:w==="new_card"?null:w})}};function Ze(me){return Math.floor(me*160)}const Qe=async me=>{if(!W){pe.error("Please login to purchase entrance effects");return}if(W.coins<me.price){pe.error("Insufficient coins");return}try{await WR(W.id,me.price,"entrance_effect_purchase"),await K.from("user_entrance_effects").insert({user_id:W.id,effect_name:me.name,animation_type:me.animation,price:me.price,is_active:!1,created_date:new Date().toISOString()}),pe.success(`Successfully purchased ${me.name}!`),i.invalidateQueries(["user"])}catch(ye){pe.error("Failed to purchase entrance effect"),console.error("Entrance effect purchase error:",ye)}};return o.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] p-6 md:p-8",children:[o.jsx("style",{children:".neon-troll { color: #00ff88; text-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88; }"}),o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsx("div",{className:"flex flex-col items-center justify-center text-center gap-2 mb-8",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{children:[o.jsxs("h1",{className:"text-5xl md:text-6xl font-extrabold",children:[o.jsx("span",{className:"neon-troll",children:"Troll"})," ",o.jsx("span",{className:"text-yellow-400",children:"Store"})]}),o.jsx("p",{className:"text-base text-gray-400 mt-2",children:" Purchased Troll Coins have REAL VALUE and can be cashed out by streamers"})]}),o.jsx(cY,{pageName:"Store Header",currentContent:z,onSave:async me=>{await bwe("Store",me,"header_content"),V(me)},fieldName:"header_content"}),z&&!Q&&o.jsx("div",{className:"mb-8 p-4 bg-gradient-to-r from-purple-900/20 to-pink-900/20 border border-purple-500/30 rounded-lg",children:o.jsx("div",{className:"text-white prose prose-invert max-w-none",dangerouslySetInnerHTML:{__html:z.replace(/\n/g,"<br />")}})})]})}),o.jsxs(db,{defaultValue:"coins",className:"space-y-8",children:[o.jsxs(ub,{className:"bg-[#1a1a24] border-[#2a2a3a] p-1",children:[o.jsxs(es,{value:"coins",className:"data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[o.jsx(ni,{className:"w-4 h-4 mr-2"}),"Coin Packages"]}),o.jsxs(es,{value:"effects",className:"data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[o.jsx(lP,{className:"w-4 h-4 mr-2"}),"Entrance Effects"]})]}),o.jsx(Gs,{value:"coins",children:o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{id:"coins-section",children:[o.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[o.jsx(ni,{className:"w-6 h-6 text-yellow-400"}),"Purchase Troll Coins"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:G.map(me=>o.jsx(Xi.div,{whileHover:{scale:1.05,y:-5},transition:{type:"spring",stiffness:300},children:o.jsxs(Fe,{className:`relative overflow-hidden cursor-pointer transition-all duration-300 ${me.popular?"bg-gradient-to-br from-purple-900/50 to-pink-900/50 border-2 border-purple-500 shadow-xl shadow-purple-500/30":"bg-[#1a1a24] border-[#2a2a3a] hover:border-purple-500/50"}`,children:[me.popular&&o.jsx("div",{className:"absolute top-0 right-0 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-1 text-xs font-bold rounded-bl-lg",children:"MOST POPULAR"}),o.jsx("div",{className:"p-6",children:o.jsxs("div",{className:"text-center mb-4",children:[o.jsx("div",{className:"text-6xl mb-3",children:me.emoji}),o.jsxs("div",{className:"text-4xl font-bold text-yellow-400 mb-2 flex items-center justify-center gap-2",children:[o.jsx(ni,{className:"w-8 h-8"})," ",me.coins.toLocaleString()]}),o.jsxs("div",{className:"text-2xl font-bold text-white mt-2",children:["$",me.price.toFixed(2)]}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[Math.floor(me.coins/me.price)," Troll Coins per $1"]}),o.jsxs(ke,{type:"button",onClick:()=>oe(me),className:`w-full mt-4 ${me.popular?"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700":"bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700"}`,children:[o.jsx(dW,{className:"w-4 h-4 mr-2"}),"Purchase Now"]})]})})]})},me.id))})]}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:"Custom Amount - Buy Any Amount You Want!"}),o.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-6",children:o.jsxs("p",{className:"text-blue-300 text-sm",children:[" ",o.jsx("strong",{children:"No maximum limit!"})," Buy exactly the amount you need, from $0.10 to any amount you want."]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-400 mb-2 block",children:"Enter Amount (USD)"}),o.jsx(Zt,{type:"number",placeholder:"0.10",min:"0.10",step:"0.01",value:n,onChange:me=>a(me.target.value),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white text-2xl py-6"}),o.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Minimum $0.10 - no maximum limit!"})]}),o.jsxs(Fe,{className:"bg-[#0a0a0f] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"You'll Receive:"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex justify-between text-yellow-400 text-2xl",children:[o.jsx("span",{className:"font-bold",children:"Total:"}),o.jsxs("span",{className:"font-bold flex items-center gap-2",children:[o.jsx(ni,{className:"w-6 h-6"}),ie.toLocaleString()]})]}),o.jsxs("div",{className:"text-center text-sm text-gray-400",children:[ce," Troll Coins per $1"]})]}),o.jsxs("div",{className:"mt-6 bg-green-500/10 border border-green-500/30 rounded-lg p-4",children:[o.jsx("p",{className:"text-green-300 text-sm font-bold mb-2",children:" These are PAID Troll Coins"}),o.jsx("p",{className:"text-green-200 text-xs",children:" Have real cash value ($0.00625 per coin)"}),o.jsx("p",{className:"text-green-200 text-xs",children:" Can be used for EVERYTHING (gifts, messages, etc)"}),o.jsx("p",{className:"text-green-200 text-xs",children:" Streamers can cash them out for real money"})]}),o.jsxs(ke,{type:"button",onClick:ve,disabled:!n||parseFloat(n)<.1,className:"w-full mt-6 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 py-6 text-lg font-bold",children:[o.jsx(_y,{className:"w-5 h-5 mr-2"}),"Purchase ",ie.toLocaleString()," Troll Coins"]})]})]})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Available Gifts"}),o.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-4",children:[{emoji:"",name:"Rose",coin_value:1},{emoji:"",name:"Gift",coin_value:5},{emoji:"",name:"Diamond",coin_value:10},{emoji:"",name:"Crown",coin_value:25},{emoji:"",name:"Fire",coin_value:50},{emoji:"",name:"Lightning",coin_value:100}].map(me=>o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4 text-center",children:[o.jsx("div",{className:"text-4xl mb-2",children:me.emoji}),o.jsx("p",{className:"text-white text-sm font-semibold",children:me.name}),o.jsxs("div",{className:"flex items-center justify-center gap-1 mt-1",children:[o.jsx(ni,{className:"w-3 h-3 text-yellow-400"}),o.jsx("span",{className:"text-yellow-400 text-xs",children:me.coin_value})]})]},me.name))})]})]})}),o.jsx(Gs,{value:"effects",children:o.jsx("div",{className:"space-y-8",children:o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[o.jsx(lP,{className:"w-6 h-6 text-purple-400"}),"Entrance Effects"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{id:1,name:"Royal Entrance",description:"Make a grand entrance with golden sparkles",animation:"sparkle",price:500,rarity:"epic"},{id:2,name:"Fireworks",description:"Enter with explosive fireworks display",animation:"fireworks",price:1e3,rarity:"legendary"},{id:3,name:"Rainbow Trail",description:"Leave a colorful rainbow trail as you enter",animation:"rainbow",price:300,rarity:"rare"},{id:4,name:"Neon Glow",description:"Enter with a bright neon glow effect",animation:"neon",price:200,rarity:"common"},{id:5,name:"Confetti Blast",description:"Celebrate your entrance with confetti",animation:"confetti",price:400,rarity:"rare"},{id:6,name:"Lightning Strike",description:"Make a shocking entrance with lightning",animation:"lightning",price:750,rarity:"epic"}].map(me=>o.jsx(Xi.div,{whileHover:{scale:1.05,y:-5},transition:{type:"spring",stiffness:300},children:o.jsxs(Fe,{className:"relative overflow-hidden cursor-pointer transition-all duration-300 bg-[#1a1a24] border-[#2a2a3a] hover:border-purple-500/50",children:[o.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${RARITY_COLORS[me.rarity]} opacity-10`}),o.jsxs("div",{className:"p-6 relative z-10",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-lg font-bold text-white",children:me.name}),o.jsx(wt,{className:`bg-gradient-to-r ${RARITY_COLORS[me.rarity]} text-white border-0`,children:me.rarity.toUpperCase()})]}),o.jsx("p",{className:"text-gray-400 text-sm mb-4",children:me.description}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(ni,{className:"w-4 h-4 text-yellow-400"}),o.jsx("span",{className:"text-yellow-400 font-semibold",children:me.price.toLocaleString()})]}),o.jsx(ke,{onClick:()=>Qe(me),disabled:!W||W.coins<me.price,className:"bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Purchase"})]})]})]})},me.id))})]})})})]}),o.jsx(Fe,{className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border-blue-500 p-4 mb-6",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(_y,{className:"w-5 h-5 text-blue-400 flex-shrink-0"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-base font-bold text-white",children:" Secure Payment"}),o.jsx("p",{className:"text-sm text-blue-200",children:"Pay using your saved payment methods or enter a new card"})]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[o.jsxs(Fe,{className:"bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border-yellow-500/50 p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Total Balance"}),o.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:((W==null?void 0:W.coins)||0).toLocaleString()})]}),o.jsx(ni,{className:"w-12 h-12 text-yellow-400/50"})]}),o.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-2 mt-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-xs text-gray-300",children:"Total Value:"}),o.jsxs("span",{className:"text-lg font-bold text-green-400",children:["$",(((W==null?void 0:W.coins)||0)*.00625).toFixed(2)]})]})})]}),o.jsxs(Fe,{className:"bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-green-500/50 p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Troll Coins"}),o.jsx("p",{className:"text-3xl font-bold text-green-400",children:((W==null?void 0:W.purchased_coins)||0).toLocaleString()})]}),o.jsx("div",{className:"text-2xl",children:""})]}),o.jsx("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-2 mt-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-xs text-gray-300",children:"Value:"}),o.jsxs("span",{className:"text-lg font-bold text-purple-400",children:["$",(((W==null?void 0:W.purchased_coins)||0)*.00625).toFixed(2)]})]})}),o.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Real value  Can spend"})]}),o.jsxs(Fe,{className:"bg-gradient-to-br from-red-500/20 to-pink-500/20 border-red-500/50 p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Free Coins"}),o.jsx("p",{className:"text-3xl font-bold text-red-400",children:((W==null?void 0:W.free_coins)||0).toLocaleString()})]}),o.jsx(Oc,{className:"w-12 h-12 text-red-400/50"})]}),o.jsx("div",{className:"bg-gray-500/10 border border-gray-500/30 rounded-lg p-2 mt-3",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-xs text-gray-300",children:"Value:"}),o.jsx("span",{className:"text-lg font-bold text-gray-400",children:"$0.00"})]})}),o.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"No cash value  Can spend"})]})]}),o.jsxs("div",{className:"space-y-2",id:"history-section",children:[o.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-2",children:[o.jsx(Es,{className:"w-6 h-6 text-green-400"}),"Purchase History"]}),se.length===0?o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-12 text-center",children:[o.jsx(dW,{className:"w-16 h-16 text-gray-700 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500 text-lg",children:"No purchases yet"}),o.jsx("p",{className:"text-gray-600 text-sm mt-2",children:"Your purchase history will appear here"})]}):o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("div",{className:"space-y-3",children:se.map(me=>o.jsx(Xi.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"bg-[#0a0a0f] rounded-lg p-4 border border-[#2a2a3a]",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-full flex items-center justify-center",children:o.jsx(ni,{className:"w-6 h-6 text-white"})}),o.jsxs("div",{children:[o.jsxs("p",{className:"text-white font-bold text-lg",children:[(me.coin_amount||0).toLocaleString()," Coins"]}),o.jsx("p",{className:"text-gray-400 text-sm",children:me.package_type||"Troll Coin Package"}),o.jsx("p",{className:"text-gray-500 text-xs mt-1",children:hp(new Date(me.date||me.created_date),"MMM d, yyyy h:mm a")})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-green-400 font-bold text-xl",children:aq(me.usd_amount)}),o.jsxs(wt,{className:me.status==="completed"?"bg-green-500":me.status==="pending"?"bg-yellow-500":"bg-red-500",children:[me.status==="completed"&&o.jsx(Ui,{className:"w-3 h-3 mr-1"}),me.status]}),o.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Square"})]})]})},me.id||`${me.type}-${me.effect_id||""}`))}),o.jsxs("div",{className:"mt-6 pt-6 border-t border-[#2a2a3a] grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-gradient-to-br from-yellow-500/20 to-orange-500/20 border border-yellow-500/50 rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Total Spent"}),o.jsx("p",{className:"text-3xl font-bold text-green-400",children:aq(se.filter(me=>me.status==="completed").reduce((me,ye)=>me+(Number(ye.usd_amount)||0),0))})]}),o.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/50 rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Total Coins Bought"}),o.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:se.filter(me=>me.status==="completed").reduce((me,ye)=>me+ye.coin_amount,0).toLocaleString()})]})]})]})]}),o.jsx(gm,{open:l,onOpenChange:u,children:o.jsxs(_m,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(ym,{children:[o.jsx(vm,{className:"text-white text-2xl",children:"Confirm Purchase"}),o.jsx(my,{className:"text-gray-400",children:"Select your payment method to complete the purchase"})]}),m&&o.jsxs("div",{className:"space-y-6 my-4",children:[o.jsx("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:o.jsxs("div",{className:"text-center mb-3",children:[o.jsx("div",{className:"text-4xl mb-2",children:m.emoji}),o.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:[(m.coins+(m.bonus||0)).toLocaleString()," Troll Coins"]}),o.jsxs("div",{className:"text-xl text-white mt-1",children:["$",m.price.toFixed(2)]}),m.isTest&&o.jsxs("div",{className:"mt-3 bg-green-500/20 border border-green-500/30 rounded-lg p-3",children:[o.jsxs("p",{className:"text-green-300 text-sm",children:[" ",o.jsx("strong",{children:"Test Payment - Full Refund"})]}),o.jsx("p",{className:"text-green-200 text-xs mt-1",children:"This $0.01 will be refunded to your account within 24 hours"})]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(($==null?void 0:$.applePay)||(te==null?void 0:te.applePay))&&o.jsxs("div",{className:`p-4 rounded-lg border ${w==="apple_pay"?"border-blue-500 bg-blue-500/10":"border-[#2a2a3a] bg-[#0a0a0f]"}`,onClick:()=>b("apple_pay"),role:"button",children:[o.jsx("div",{className:"text-white font-semibold mb-2",children:"Apple Pay"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Use saved Apple Pay"}),w==="apple_pay"&&o.jsx("div",{className:"mt-2 text-green-400 text-sm",children:" Selected"})]}),(($==null?void 0:$.googleWallet)||(te==null?void 0:te.googleWallet))&&o.jsxs("div",{className:`p-4 rounded-lg border ${w==="google_wallet"?"border-blue-500 bg-blue-500/10":"border-[#2a2a3a] bg-[#0a0a0f]"}`,onClick:()=>b("google_wallet"),role:"button",children:[o.jsx("div",{className:"text-white font-semibold mb-2",children:"Google Wallet"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Use saved Google Wallet"}),w==="google_wallet"&&o.jsx("div",{className:"mt-2 text-green-400 text-sm",children:" Selected"})]}),(($==null?void 0:$.chime)||(te==null?void 0:te.chime))&&o.jsxs("div",{className:`p-4 rounded-lg border ${w==="chime"?"border-green-600 bg-green-600/10":"border-[#2a2a3a] bg-[#0a0a0f]"}`,onClick:()=>b("chime"),role:"button",children:[o.jsx("div",{className:"text-white font-semibold mb-2",children:"Chime"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Use saved Chime account"}),w==="chime"&&o.jsx("div",{className:"mt-2 text-green-400 text-sm",children:" Selected"})]}),(($==null?void 0:$.cashApp)||(te==null?void 0:te.cashApp))&&o.jsxs("div",{className:`p-4 rounded-lg border ${w==="cashapp"?"border-green-600 bg-green-600/10":"border-[#2a2a3a] bg-[#0a0a0f]"}`,onClick:()=>b("cashapp"),role:"button",children:[o.jsx("div",{className:"text-white font-semibold mb-2",children:"Cash App"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Use saved Cash App account"}),w==="cashapp"&&o.jsx("div",{className:"mt-2 text-green-400 text-sm",children:" Selected"})]}),o.jsxs("div",{className:`p-4 rounded-lg border ${w==="new_card"?"border-blue-500 bg-blue-500/10":"border-[#2a2a3a] bg-[#0a0a0f]"}`,onClick:()=>b("new_card"),role:"button",children:[o.jsx("div",{className:"text-white font-semibold mb-2",children:" New Card"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Enter new card details"}),w==="new_card"&&o.jsx("div",{className:"mt-2 text-green-400 text-sm",children:" Selected"})]})]}),w==="new_card"&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx(jr,{className:"text-white",children:"Card Number"}),o.jsx(Zt,{placeholder:"1234 5678 9012 3456",value:x,onChange:me=>T(me.target.value),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx(jr,{className:"text-white",children:"Expiry"}),o.jsx(Zt,{placeholder:"MM/YY",value:N,onChange:me=>O(me.target.value),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx(jr,{className:"text-white",children:"CVV"}),o.jsx(Zt,{placeholder:"123",value:P,onChange:me=>F(me.target.value),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]})]})]}),o.jsxs("div",{className:"flex gap-3 pt-4",children:[o.jsx(ke,{type:"button",variant:"outline",onClick:()=>u(!1),className:"flex-1 bg-transparent border-[#2a2a3a] text-white hover:bg-[#2a2a3a]",children:"Cancel"}),o.jsx(ke,{type:"button",onClick:he,disabled:!w||Se.isPending,className:"flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700",children:Se.isPending?o.jsxs(o.Fragment,{children:[o.jsx(yy,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):o.jsxs(o.Fragment,{children:[o.jsx(_y,{className:"w-4 h-4 mr-2"}),"Confirm Purchase"]})})]})]})]})})]})]})}function tD({username:i,userId:n,children:a,isInLive:l=!1}){const[u,m]=M.useState(!1),[y,w]=M.useState(""),[b,x]=M.useState("24"),[T,N]=M.useState(null),O=vn(),{data:P}=mt({queryKey:["isAdmin"],queryFn:async()=>{const{data:{user:se}}=await K.auth.getUser();if(!se)return!1;const{data:ie}=await K.from("profiles").select("is_admin, role").eq("id",se.id).single();return(ie==null?void 0:ie.is_admin)===!0||(ie==null?void 0:ie.role)==="admin"},enabled:u}),{data:F}=mt({queryKey:["targetIsAdmin",n],queryFn:async()=>{const{data:se}=await K.from("profiles").select("is_admin, role").eq("id",n).single();return(se==null?void 0:se.is_admin)===!0||(se==null?void 0:se.role)==="admin"},enabled:u&&n}),z=Wt({mutationFn:async({targetUserId:se,reason:ie,duration:ce})=>{const{data:{user:Se}}=await K.auth.getUser();if(!Se)throw new Error("Not authenticated");const{data:oe}=await K.from("profiles").select("is_admin, role").eq("id",se).single();if((oe==null?void 0:oe.is_admin)===!0||(oe==null?void 0:oe.role)==="admin")throw new Error("Cannot block admin users");const ve=new Date;ve.setHours(ve.getHours()+parseInt(ce));const{error:he}=await K.from("blocked_users").insert({user_id:se,blocked_by:Se.id,reason:ie||"Admin block",expires_at:ve.toISOString(),is_active:!0});if(he)throw he;return se},onSuccess:se=>{pe.success(`User blocked for ${b} hours`),O.invalidateQueries(["user",se]),O.invalidateQueries(["blockedUsers"]),m(!1),w("")},onError:se=>{pe.error(`Failed to block user: ${se.message}`)}}),V=Wt({mutationFn:async({targetUserId:se,reason:ie,duration:ce})=>{const{data:{user:Se}}=await K.auth.getUser();if(!Se)throw new Error("Not authenticated");const{data:oe}=await K.from("profiles").select("is_admin, role").eq("id",se).single(),ve=new Date;ve.setHours(ve.getHours()+parseInt(ce));const{error:he}=await K.from("moderation_actions").insert({user_id:se,action_type:"silence",reason:ie||"Admin silence",moderator_id:Se.id,expires_at:ve.toISOString(),is_active:!0});if(he)throw he;return se},onSuccess:se=>{pe.success(`User silenced for ${b} hours`),O.invalidateQueries(["user",se]),m(!1),w("")},onError:se=>{pe.error(`Failed to silence user: ${se.message}`)}}),W=Wt({mutationFn:async({targetUserId:se,reason:ie})=>{const{data:{user:ce}}=await K.auth.getUser();if(!ce)throw new Error("Not authenticated");const{data:Se}=await K.from("profiles").select("is_admin, role").eq("id",se).single();if((Se==null?void 0:Se.is_admin)===!0||(Se==null?void 0:Se.role)==="admin")throw new Error("Cannot ban admin users");const{error:oe}=await K.from("banned_users").insert({user_id:se,banned_by:ce.id,reason:ie||"Admin ban",is_active:!0});if(oe)throw oe;return se},onSuccess:se=>{pe.success("User permanently banned"),O.invalidateQueries(["user",se]),O.invalidateQueries(["bannedUsers"]),m(!1),w("")},onError:se=>{pe.error(`Failed to ban user: ${se.message}`)}}),te=Wt({mutationFn:async({targetUserId:se,reason:ie})=>{const{data:{user:ce}}=await K.auth.getUser();if(!ce)throw new Error("Not authenticated");if(l){const{error:Se}=await K.rpc("perform_permanent_kick",{broadcaster_id:ce.id,target_user_id:se,stream_id:null,coin_cost:0});if(Se)throw Se}else{const{error:Se}=await K.from("kicked_users").insert({user_id:se,kicked_by:ce.id,reason:ie||"Admin kick",is_active:!0});if(Se)throw Se}return se},onSuccess:se=>{pe.success("User kicked successfully"),O.invalidateQueries(["user",se]),O.invalidateQueries(["kickedUsers"]),m(!1),w("")},onError:se=>{pe.error(`Failed to kick user: ${se.message}`)}}),$=se=>{if(N(se),se==="kick"||se==="ban"){if(F){pe.error("Cannot kick/ban admin users. Use silence instead.");return}confirm(`Are you sure you want to ${se} this user?`)&&(se==="kick"?te.mutate({targetUserId:n,reason:y}):se==="ban"&&W.mutate({targetUserId:n,reason:y}))}else N(se==="silence"?"silence":"block")},Q=()=>{if(!y.trim()){pe.error("Please provide a reason for silencing");return}V.mutate({targetUserId:n,reason:y,duration:b})},G=()=>{if(!y.trim()){pe.error("Please provide a reason for blocking");return}z.mutate({targetUserId:n,reason:y,duration:b})};return P?o.jsxs(gm,{open:u,onOpenChange:m,children:[o.jsx(fEe,{asChild:!0,children:a}),o.jsxs(_m,{className:"sm:max-w-md bg-[#111118] border-[#222] text-white",children:[o.jsxs(ym,{children:[o.jsxs(vm,{className:"flex items-center gap-2",children:[o.jsx(Ic,{className:"w-5 h-5 text-yellow-400"}),"Admin Actions for @",i]}),o.jsx(my,{className:"text-gray-400",children:"Choose an administrative action for this user. These actions are logged and cannot be undone without admin privileges."})]}),o.jsxs("div",{className:"grid gap-3 py-4",children:[F&&o.jsxs("div",{className:"bg-yellow-900/50 border border-yellow-600 rounded-lg p-3 mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-yellow-300",children:[o.jsx(Ic,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:"Admin User Protected"})]}),o.jsx("p",{className:"text-xs text-yellow-200 mt-1",children:"This user is an admin and cannot be kicked or banned. Use silence instead."})]}),o.jsxs(ke,{onClick:()=>$("kick"),variant:"destructive",className:"justify-start",disabled:te.isLoading||F,children:[o.jsx(jH,{className:"w-4 h-4 mr-2"}),"Kick User",o.jsx("span",{className:"text-xs text-gray-300 ml-auto",children:l?"Remove from stream":"Remove from platform"})]}),o.jsxs(ke,{onClick:()=>$("silence"),variant:"outline",className:"justify-start border-orange-600 text-orange-400 hover:bg-orange-600 hover:text-white",disabled:V.isLoading,children:[o.jsx(mp,{className:"w-4 h-4 mr-2"}),"Silence User",o.jsx("span",{className:"text-xs text-gray-300 ml-auto",children:"Mute temporarily"})]}),o.jsxs(ke,{onClick:()=>$("block"),variant:"destructive",className:"justify-start",disabled:z.isLoading||F,children:[o.jsx(uo,{className:"w-4 h-4 mr-2"}),"Block User",o.jsx("span",{className:"text-xs text-gray-300 ml-auto",children:"Temporary restriction"})]}),o.jsxs(ke,{onClick:()=>$("ban"),variant:"destructive",className:"justify-start bg-red-600 hover:bg-red-700",disabled:W.isLoading||F,children:[o.jsx(pce,{className:"w-4 h-4 mr-2"}),"Ban User Permanently",o.jsx("span",{className:"text-xs text-gray-300 ml-auto",children:"Permanent restriction"})]})]}),T==="block"&&o.jsxs("div",{className:"space-y-4 border-t border-[#222] pt-4",children:[o.jsxs("div",{className:"grid gap-2",children:[o.jsx(jr,{htmlFor:"duration",children:"Block Duration (hours)"}),o.jsx(Zt,{id:"duration",type:"number",value:b,onChange:se=>x(se.target.value),min:"1",max:"8760",className:"bg-[#1a1a24] border-[#333] text-white"})]}),o.jsxs("div",{className:"grid gap-2",children:[o.jsx(jr,{htmlFor:"reason",children:"Reason (required)"}),o.jsx(Zt,{id:"reason",value:y,onChange:se=>w(se.target.value),placeholder:"Enter reason for block...",className:"bg-[#1a1a24] border-[#333] text-white"})]}),o.jsx(ke,{onClick:G,disabled:z.isLoading||!y.trim(),className:"w-full",children:z.isLoading?"Blocking...":"Confirm Block"})]}),T==="silence"&&o.jsxs("div",{className:"space-y-4 border-t border-[#222] pt-4",children:[o.jsxs("div",{className:"grid gap-2",children:[o.jsx(jr,{htmlFor:"duration",children:"Silence Duration (hours)"}),o.jsx(Zt,{id:"duration",type:"number",value:b,onChange:se=>x(se.target.value),min:"1",max:"8760",className:"bg-[#1a1a24] border-[#333] text-white"})]}),o.jsxs("div",{className:"grid gap-2",children:[o.jsx(jr,{htmlFor:"reason",children:"Reason (required)"}),o.jsx(Zt,{id:"reason",value:y,onChange:se=>w(se.target.value),placeholder:"Enter reason for silence...",className:"bg-[#1a1a24] border-[#333] text-white"})]}),o.jsx(ke,{onClick:Q,disabled:V.isLoading||!y.trim(),className:"w-full bg-orange-600 hover:bg-orange-700",children:V.isLoading?"Silencing...":"Confirm Silence"})]}),o.jsx(mEe,{className:"text-xs text-gray-500",children:"All admin actions are logged and monitored"})]})]}):a}class Swe{constructor(){this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1,this.startTime=null,this.streamId=null,this.incidentId=null}async startRecording(n,a,l={}){try{this.streamId=n,this.incidentId=a;const u=document.querySelector(`video[data-stream-id="${n}"]`);if(!u)return console.warn("Video element not found for stream:",n),!1;const m=document.createElement("canvas"),y=m.getContext("2d");m.width=u.videoWidth||640,m.height=u.videoHeight||480;const w=m.captureStream(30);if(u.srcObject&&u.srcObject.getAudioTracks){const T=u.srcObject.getAudioTracks();T.length>0&&T.forEach(N=>w.addTrack(N))}const b={mimeType:"video/webm;codecs=vp8,opus",videoBitsPerSecond:25e5,audioBitsPerSecond:128e3};this.mediaRecorder=new MediaRecorder(w,b),this.recordedChunks=[],this.startTime=Date.now(),this.isRecording=!0;const x=()=>{if(this.isRecording){try{y.drawImage(u,0,0,m.width,m.height)}catch(T){console.warn("Error capturing video frame:",T)}this.isRecording&&requestAnimationFrame(x)}};return this.mediaRecorder.ondataavailable=T=>{T.data.size>0&&this.recordedChunks.push(T.data)},this.mediaRecorder.onstop=async()=>{try{const T=new Blob(this.recordedChunks,{type:"video/webm"});await this.uploadRecording(T)}catch(T){console.error("Error processing recording:",T)}w.getTracks().forEach(T=>T.stop()),m.remove()},this.mediaRecorder.start(1e3),x(),console.log(`Started safety recording for incident ${a}, stream ${n}`),!0}catch(u){return console.error("Error starting video recording:",u),!1}}stopRecording(){if(!this.mediaRecorder||!this.isRecording){console.warn("No active recording to stop");return}this.isRecording=!1,this.mediaRecorder.stop();const n=this.startTime?(Date.now()-this.startTime)/1e3:0;console.log(`Stopped safety recording after ${n.toFixed(1)} seconds`)}async uploadRecording(n){try{if(!this.incidentId){console.error("No incident ID for upload");return}const l=`safety-recordings/${`safety-incident-${this.incidentId}-${Date.now()}.webm`}`,{data:u,error:m}=await K.storage.from("safety-videos").upload(l,n,{cacheControl:"3600",upsert:!1});if(m){console.error("Error uploading recording:",m);return}const{data:{publicUrl:y}}=K.storage.from("safety-videos").getPublicUrl(l);return await K.from("safety_incidents").update({video_clip_url:y,video_clip_path:l,recording_duration:this.startTime?(Date.now()-this.startTime)/1e3:0}).eq("id",this.incidentId),console.log(`Uploaded safety recording: ${y}`),y}catch(a){return console.error("Error uploading recording:",a),null}}getStatus(){return{isRecording:this.isRecording,startTime:this.startTime,duration:this.startTime?(Date.now()-this.startTime)/1e3:0,streamId:this.streamId,incidentId:this.incidentId}}cleanup(){this.isRecording&&this.stopRecording(),this.mediaRecorder=null,this.recordedChunks=[],this.streamId=null,this.incidentId=null,this.startTime=null}}const dY=new Swe;typeof window<"u"&&window.addEventListener("beforeunload",()=>{dY.cleanup()});class xwe{constructor(){this.keywords=[],this.isInitialized=!1}async initialize(){try{const{data:n,error:a}=await K.from("safety_keywords").select("*").eq("is_active",!0).order("severity_level",{ascending:!1});return a?(console.error("Error loading safety keywords:",a),!1):(this.keywords=n||[],this.isInitialized=!0,console.log(`Safety monitor initialized with ${this.keywords.length} keywords`),!0)}catch(n){return console.error("Error initializing safety monitor:",n),!1}}scanText(n,a=null,l=null,u={}){if(!this.isInitialized||!n)return{incidents:[],isSafe:!0};const m=[],y=n.toLowerCase();for(const w of this.keywords)if(y.includes(w.keyword.toLowerCase())){const b={keyword:w.keyword,severity:w.severity_level,category:w.category,description:w.description,context:this.extractContext(n,w.keyword),userId:a,streamId:l,timestamp:new Date().toISOString(),metadata:u};m.push(b),w.severity_level>=4&&this.createIncident(b)}return{incidents:m,isSafe:m.length===0,highestSeverity:Math.max(...m.map(w=>w.severity),0)}}extractContext(n,a){const l=n.toLowerCase().indexOf(a.toLowerCase());if(l===-1)return n;const u=Math.max(0,l-50),m=Math.min(n.length,l+a.length+50);return n.substring(u,m)}async createIncident(n){var a,l,u;try{const m={user_id:n.userId,stream_id:n.streamId,detected_keyword_id:(a=this.keywords.find(b=>b.keyword===n.keyword))==null?void 0:a.id,incident_type:"keyword_detected",severity_level:n.severity,context_text:n.context,is_emergency:n.severity>=5,ip_address:(l=n.metadata)==null?void 0:l.ipAddress,user_agent:(u=n.metadata)==null?void 0:u.userAgent,created_at:n.timestamp},{data:y,error:w}=await K.from("safety_incidents").insert(m).select().single();return w?(console.error("Error creating safety incident:",w),null):(n.severity>=5&&this.triggerEmergencyAlert(y),y)}catch(m){return console.error("Error creating safety incident:",m),null}}async triggerEmergencyAlert(n){try{const a=await this.getUserLocation(n.user_id);a&&await K.from("safety_incidents").update({location_latitude:a.latitude,location_longitude:a.longitude,location_accuracy:a.accuracy}).eq("id",n.id),n.severity_level>=5&&n.stream_id&&await dY.startRecording(n.stream_id,n.id),await this.notifySafetyTeam(n,a),n.severity_level>=5&&await this.notifyPolice(n,a)}catch(a){console.error("Error triggering emergency alert:",a)}}async getUserLocation(n){try{const{data:a}=await K.from("user_location_consent").select("*").eq("user_id",n).eq("has_consented",!0).single();return null}catch(a){return console.error("Error getting user location:",a),null}}async notifySafetyTeam(n,a=null){try{const{data:l}=await K.from("auth.users").select("id, email, raw_user_meta_data").or("role.eq.troll_officer,role.eq.admin");if(!l||l.length===0){console.warn("No safety team members found");return}const u=l.map(m=>{var y;return{incident_id:n.id,notified_user_id:m.id,notification_type:((y=m.raw_user_meta_data)==null?void 0:y.role)==="admin"?"admin":"troll_officer",notification_method:"dashboard",message_content:` SAFETY ALERT: ${n.severity_level===5?"EMERGENCY":"HIGH RISK"} incident detected. User mentioned "${n.context_text}". ${a?`Location: ${a.latitude}, ${a.longitude}`:"No location available"}.`,is_sent:!0,sent_at:new Date().toISOString()}});await K.from("safety_notifications").insert(u),console.log(`Notified ${l.length} safety team members`)}catch(l){console.error("Error notifying safety team:",l)}}async notifyPolice(n,a){try{const{data:l,error:u}=await K.functions.invoke("notifyPolice",{body:{incidentId:n.id}});if(u){console.error("Error calling notifyPolice function:",u);return}console.log(`Police notification sent for incident ${n.id}:`,l)}catch(l){console.error("Error notifying police:",l)}}async startVideoRecording(n,a){console.log(`Starting video recording for stream ${n}, incident ${a}`)}async stopVideoRecording(n,a,l){try{await K.from("safety_incidents").update({video_clip_url:a,video_clip_path:l}).eq("id",n),console.log(`Video saved for incident ${n}`)}catch(u){console.error("Error saving video recording:",u)}}}const uY=new xwe;uY.initialize().then(i=>{i?console.log("Safety monitor ready"):console.warn("Safety monitor failed to initialize")});const Twe=async(i,n,a)=>{try{const l=new Date(Date.now()-864e5).toISOString(),{data:u,error:m}=await K.from("user_kicks").select("*").eq("user_id",i).gte("created_at",l).order("created_at",{ascending:!1});if(m){console.warn("Failed to check recent kicks:",m);return}const y=u.filter(w=>w.kicked_by==="trae_ai_system");if(y.length>=2){console.log(`Auto-banning user ${i} for repeated AI-detected offenses (${y.length} in 24h)`);const{data:w,error:b}=await K.from("streams").select("streamer_id").eq("id",n).single();if(b||!w){console.warn("Failed to get streamer ID for ban:",b);return}const{error:x}=await K.from("user_stream_bans").insert({user_id:i,streamer_id:w.streamer_id,reason:`TRAE.AI: Repeated safety violations (${a.category}) - ${y.length+1} offenses in 24h`,banned_by:"trae_ai_system",is_active:!0,created_date:new Date().toISOString()});if(x){console.warn("Failed to create auto-ban:",x);return}await K.from("stream_viewers").delete().eq("stream_id",n).eq("user_id",i),await K.from("moderation_actions").insert({stream_id:n,user_id:i,action_type:"user_banned",reason:`TRAE.AI auto-ban: Repeated safety violations (${a.category})`,status:"completed",flagged_by:"trae_ai_system",ai_severity:a.severity}),console.log(`User ${i} auto-banned for repeated offenses`)}}catch(l){console.error("Error checking repeated offenses:",l)}};function hY({stream:i,user:n,canModerate:a,isStreamer:l}){const u=Wn(),m=i==null?void 0:i.id,y=vn(),[w,b]=M.useState(""),{data:x=[]}=mt({queryKey:["streamBans",i==null?void 0:i.id],queryFn:async()=>{if(!(i!=null&&i.streamer_id))return[];const{data:G,error:se}=await K.from("user_stream_bans").select("*").eq("streamer_id",i.streamer_id).eq("is_active",!0);return se?(console.warn("Failed to fetch stream bans:",se.message),[]):G||[]},enabled:!!(i!=null&&i.streamer_id),refetchInterval:5e3}),T=G=>(Wt({mutationFn:async se=>{if(!m)throw new Error("Missing stream id");const{data:ie}=await K.auth.getUser(),ce=(ie==null?void 0:ie.user)||null;if(!ce)throw new Error("Not authenticated");if(ce.id!==((i==null?void 0:i.streamer_id)||(i==null?void 0:i.broadcaster_id)))throw new Error("Only the broadcaster can unkick");const{error:Se}=await K.from("user_stream_bans").update({is_active:!1,removed_date:new Date().toISOString()}).eq("streamer_id",ce.id).eq("user_id",se).eq("is_active",!0);if(Se)throw Se;return se},onSuccess:()=>{y.invalidateQueries(["streamBans",i==null?void 0:i.id]),pe.success("User unbanned from this stream")},onError:se=>{console.error("Unkick failed",se),pe.error((se==null?void 0:se.message)||"Failed to unkick user")}}),G?Array.isArray(x)&&x.some(se=>String(se.user_id)===String(G)&&se.is_active):!1),{data:N=[],isLoading:O}=mt({queryKey:["streamChat",m],queryFn:async()=>{if(!m)return[];const{data:G,error:se}=await K.from("chat_messages").select("*").eq("stream_id",m).is("deleted",null).order("created_at",{ascending:!1}).limit(100);if(se)throw se;return G||[]},enabled:!!m,refetchInterval:3e3}),P=Wt({mutationFn:async G=>{if(!m||!n)throw new Error("Missing stream or user");const se={stream_id:m,user_id:n.id,username:n.username||n.full_name||"Anon",message_type:"text",message:G},{error:ie}=await K.from("chat_messages").insert(se);if(ie)throw ie;return se},onSuccess:()=>{b(""),y.invalidateQueries(["streamChat",m])},onError:G=>{console.error("send message failed",G),pe.error("Failed to send message")}}),F=Wt({mutationFn:async G=>{const{error:se}=await K.from("chat_messages").update({deleted:!0,deleted_at:new Date().toISOString()}).eq("id",G);if(se)throw se;return G},onSuccess:()=>{y.invalidateQueries(["streamChat",m]),pe.success("Message deleted")},onError:G=>{console.error("delete message failed",G),pe.error("Failed to delete message")}}),z=Wt({mutationFn:async G=>{if(!m)throw new Error("Missing stream id");const{data:se}=await K.auth.getUser(),ie=(se==null?void 0:se.user)||null;if(!ie)throw new Error("Not authenticated");if(ie.id!==((i==null?void 0:i.streamer_id)||(i==null?void 0:i.broadcaster_id)))throw new Error("Only the broadcaster can perform a permanent kick");const{error:ce}=await K.rpc("perform_permanent_kick",{broadcaster_id:ie.id,target_user_id:G,stream_id:m||null,coin_cost:500});if(ce)throw ce;return{targetUserId:G}},onSuccess:async()=>{y.invalidateQueries(["streamChat",m]),y.invalidateQueries(["viewerStreamBans",m]),y.invalidateQueries(["streamByIdOrStreamer",m]),y.invalidateQueries(["streamBans",i==null?void 0:i.id]),y.invalidateQueries(["currentUser"]),pe.success(" Permanent kick applied  user removed from this broadcast until you unkick them")},onError:G=>{console.error("Permanent kick failed",G),pe.error((G==null?void 0:G.message)||"Failed to apply permanent kick  ensure you have 500 purchased coins")}}),V=G=>{confirm("Delete this message?")&&F.mutate(G)},W=G=>{G&&u(`${Or("PublicProfile")}?username=${encodeURIComponent(G)}`)},te=async()=>{var se,ie,ce,Se;if(!w.trim())return;if(n!=null&&n.chat_disabled){pe.error("Your chat has been disabled by moderators");return}const G=uY.scanText(w.trim(),n==null?void 0:n.id,m,{source:"chat",timestamp:new Date().toISOString(),ipAddress:null,userAgent:navigator.userAgent});if(!G.isSafe&&G.highestSeverity>=4){pe.error(" SAFETY ALERT: Your message contains concerning content and has been flagged for immediate review."),b("");return}try{const oe=await K.functions.invoke("openaiResponse",{body:{prompt:`You are TRAE.AI, an advanced safety monitoring system. Analyze this chat message for safety threats including suicide threats, self-harm, violence threats, or serious safety concerns.

Message: "${w.trim()}"

Respond with JSON format only:
{
  "action": "approved|delete|emergency",
  "reason": "brief explanation",
  "severity": 1-5,
  "category": "general|suicide_threat|self_harm|violence_threat|emergency"
}

Rules:
- "emergency" for suicide threats, violence threats, or immediate danger (severity 4-5)
- "delete" for inappropriate content, harassment, or rule violations (severity 2-3)  
- "approved" for safe content (severity 1)
- Always prioritize user safety and mental health`,model:"gpt-4o",max_tokens:150}});let ve;try{ve=JSON.parse(((Se=(ce=(ie=(se=oe==null?void 0:oe.data)==null?void 0:se.choices)==null?void 0:ie[0])==null?void 0:ce.message)==null?void 0:Se.content)||'{"action":"approved","reason":"parse_error","severity":1,"category":"general"}')}catch{ve={action:"approved",reason:"parse_error",severity:1,category:"general"}}if(ve.action==="emergency"||ve.severity>=4){pe.error(" EMERGENCY: Message blocked for safety concerns. Help is being contacted.");try{await K.from("safety_incidents").insert({user_id:n==null?void 0:n.id,stream_id:m,incident_type:"ai_detected_threat",severity_level:ve.severity,context_text:w.trim(),is_emergency:!0,threat_category:ve.category,ai_reason:ve.reason,created_at:new Date().toISOString()}),ve.severity>=4&&(await K.from("stream_viewers").delete().eq("stream_id",m).eq("user_id",n==null?void 0:n.id),await K.from("user_kicks").insert({user_id:n==null?void 0:n.id,stream_id:m,reason:`AI detected ${ve.category} - ${ve.reason}`,kicked_by:"trae_ai_system",created_at:new Date().toISOString()}),await Twe(n==null?void 0:n.id,m,ve))}catch(he){console.error("Failed to create safety incident:",he)}b("");return}if(ve.action==="delete"){pe.error(` Message blocked: ${ve.reason}`);try{await K.from("moderation_actions").insert({stream_id:m,user_id:n==null?void 0:n.id,action_type:"message_blocked",reason:`TRAE.AI: ${ve.reason}`,message_content:w.trim(),status:"ai_blocked",flagged_by:"trae_ai_system",ai_severity:ve.severity})}catch(he){console.warn("Failed to log moderation action",he)}b("");return}P.mutate(w.trim())}catch(oe){console.error("AI moderation error",oe),pe.warning(" Moderation check skipped, message sent"),P.mutate(w.trim())}},$=G=>{G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),te())},Q=n==null?void 0:n.chat_disabled;return o.jsxs("div",{className:"flex flex-col h-full min-h-0",children:[o.jsx("div",{className:"flex-1 overflow-y-auto p-3 bg-[#07070a]",children:O?o.jsx("div",{className:"text-gray-500",children:"Loading chat"}):N.length===0?o.jsx("div",{className:"text-gray-500",children:"No messages yet"}):o.jsx("div",{className:"flex flex-col-reverse gap-2",children:N.map(G=>o.jsxs("div",{className:"text-sm flex items-start justify-between gap-2 group hover:bg-[#1a1a24] p-1 rounded transition-colors",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx(tD,{username:G.username,userId:G.user_id,isInLive:!0,children:o.jsxs("button",{type:"button",onClick:()=>W(G.username),className:"text-white hover:text-blue-400 hover:underline font-semibold cursor-pointer mr-2 transition-colors flex items-center gap-1",children:[G.username,o.jsx(VR,{user:G,size:"xs"})]})}),o.jsx("span",{className:"text-gray-300 break-words",children:G.message})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[((n==null?void 0:n.id)===G.user_id||a)&&o.jsx("button",{type:"button",onClick:()=>V(G.id),className:"opacity-0 group-hover:opacity-100 transition-opacity text-red-400 hover:text-red-500 flex-shrink-0",title:"Delete message",children:o.jsx(up,{className:"w-4 h-4"})}),l&&G.user_id&&G.user_id!==(n==null?void 0:n.id)&&(T(G.user_id)?o.jsx("button",{type:"button",onClick:()=>{confirm("Unkick this user from your broadcast? They will be allowed to rejoin. Proceed?")&&unkickMutation.mutate(G.user_id)},className:"opacity-0 group-hover:opacity-100 transition-opacity text-green-400 hover:text-green-500 flex-shrink-0",title:"Unkick user",children:o.jsx(uW,{className:"w-4 h-4 rotate-180"})}):o.jsx("button",{type:"button",onClick:()=>{confirm("Permanently kick this user from your broadcast for 1000 paid coins? They will remain kicked until you unkick them. Proceed?")&&z.mutate(G.user_id)},className:"opacity-0 group-hover:opacity-100 transition-opacity text-yellow-400 hover:text-yellow-500 flex-shrink-0",title:"Permanent Kick (1000 paid coins)",children:o.jsx(uW,{className:"w-4 h-4"})}))]})]},G.id))})}),o.jsx("div",{className:"p-3 border-t border-[#222] bg-[#040405] sticky bottom-0 z-10",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:Q?o.jsx("div",{className:"text-red-400 text-sm p-3 bg-red-900/20 rounded",children:" Your chat has been disabled by moderators."}):o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Zt,{value:w,onChange:G=>b(G.target.value),onKeyDown:$,placeholder:"Say something (Enter to send, Shift+Enter for newline)",className:"flex-1"}),o.jsx(ke,{type:"button",onClick:te,disabled:!w.trim(),className:"flex-none",children:"Send"})]})})]})}var JC={exports:{}},Cwe=JC.exports,NG;function Rwe(){return NG||(NG=1,(function(i,n){(function(a,l){i.exports=l()})(Cwe,(function(){function a(e,t){return t.forEach((function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach((function(s){if(s!=="default"&&!(s in e)){var c=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(e,s,c.get?c:{enumerable:!0,get:function(){return r[s]}})}}))})),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof tk<"u"?tk:typeof self<"u"?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var m=function(e){try{return!!e()}catch{return!0}},y=!m((function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")})),w=y,b=Function.prototype,x=b.call,T=w&&b.bind.bind(x,x),N=w?T:function(e){return function(){return x.apply(e,arguments)}},O=N({}.isPrototypeOf),P=function(e){return e&&e.Math===Math&&e},F=P(typeof globalThis=="object"&&globalThis)||P(typeof window=="object"&&window)||P(typeof self=="object"&&self)||P(typeof l=="object"&&l)||P(typeof l=="object"&&l)||(function(){return this})()||Function("return this")(),z=y,V=Function.prototype,W=V.apply,te=V.call,$=typeof Reflect=="object"&&Reflect.apply||(z?te.bind(W):function(){return te.apply(W,arguments)}),Q=N,G=Q({}.toString),se=Q("".slice),ie=function(e){return se(G(e),8,-1)},ce=ie,Se=N,oe=function(e){if(ce(e)==="Function")return Se(e)},ve=typeof document=="object"&&document.all,he=ve===void 0&&ve!==void 0?function(e){return typeof e=="function"||e===ve}:function(e){return typeof e=="function"},Ze={},Qe=!m((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),me=y,ye=Function.prototype.call,ge=me?ye.bind(ye):function(){return ye.apply(ye,arguments)},Ee={},Oe={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,fe=we&&!Oe.call({1:2},1);Ee.f=fe?function(e){var t=we(this,e);return!!t&&t.enumerable}:Oe;var De,je,_e=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Je=m,st=ie,vt=Object,pt=N("".split),er=Je((function(){return!vt("z").propertyIsEnumerable(0)}))?function(e){return st(e)==="String"?pt(e,""):vt(e)}:vt,gt=function(e){return e==null},qe=gt,Wr=TypeError,en=function(e){if(qe(e))throw new Wr("Can't call method on "+e);return e},Cn=er,Lr=en,Le=function(e){return Cn(Lr(e))},it=he,jt=function(e){return typeof e=="object"?e!==null:it(e)},xt={},Tr=xt,An=F,En=he,on=function(e){return En(e)?e:void 0},Sr=function(e,t){return arguments.length<2?on(Tr[e])||on(An[e]):Tr[e]&&Tr[e][t]||An[e]&&An[e][t]},js=F.navigator,ts=js&&js.userAgent,_t=ts?String(ts):"",wr=F,Ur=_t,dn=wr.process,bs=wr.Deno,di=dn&&dn.versions||bs&&bs.version,Be=di&&di.v8;Be&&(je=(De=Be.split("."))[0]>0&&De[0]<4?1:+(De[0]+De[1])),!je&&Ur&&(!(De=Ur.match(/Edge\/(\d+)/))||De[1]>=74)&&(De=Ur.match(/Chrome\/(\d+)/))&&(je=+De[1]);var tt=je,bt=tt,ct=m,Pt=F.String,Ot=!!Object.getOwnPropertySymbols&&!ct((function(){var e=Symbol("symbol detection");return!Pt(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&bt&&bt<41})),tr=Ot&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Vo=Sr,Da=he,ma=O,Dc=Object,ar=tr?function(e){return typeof e=="symbol"}:function(e){var t=Vo("Symbol");return Da(t)&&ma(t.prototype,Dc(e))},kn=String,qn=function(e){try{return kn(e)}catch{return"Object"}},Ls=he,Ji=qn,hr=TypeError,Ar=function(e){if(Ls(e))return e;throw new hr(Ji(e)+" is not a function")},ja=Ar,ui=gt,Ti=function(e,t){var r=e[t];return ui(r)?void 0:ja(r)},jc=ge,ga=he,ju=jt,t0=TypeError,pb={exports:{}},fb=F,XR=Object.defineProperty,Ld=F,mb=function(e,t){try{XR(fb,e,{value:t,configurable:!0,writable:!0})}catch{fb[e]=t}return t},r0="__core-js_shared__",gb=pb.exports=Ld[r0]||mb(r0,{});(gb.versions||(gb.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Bm=pb.exports,n0=Bm,Md=function(e,t){return n0[e]||(n0[e]=t||{})},_b=en,JR=Object,Bo=function(e){return JR(_b(e))},Ss=Bo,QR=N({}.hasOwnProperty),us=Object.hasOwn||function(e,t){return QR(Ss(e),t)},yb=N,Wm=0,ZR=Math.random(),vb=yb(1 .toString),Lu=function(e){return"Symbol("+(e===void 0?"":e)+")_"+vb(++Wm+ZR,36)},Wo=Md,Eb=us,po=Lu,eN=Ot,tN=tr,Mu=F.Symbol,Uu=Wo("wks"),qm=tN?Mu.for||Mu:Mu&&Mu.withoutSetter||po,wn=function(e){return Eb(Uu,e)||(Uu[e]=eN&&Eb(Mu,e)?Mu[e]:qm("Symbol."+e)),Uu[e]},Gm=ge,wb=jt,bb=ar,s0=Ti,Sb=function(e,t){var r,s;if(ga(r=e.toString)&&!ju(s=jc(r,e))||ga(r=e.valueOf)&&!ju(s=jc(r,e)))return s;throw new t0("Can't convert object to primitive value")},i0=TypeError,Sp=wn("toPrimitive"),rN=function(e,t){if(!wb(e)||bb(e))return e;var r,s=s0(e,Sp);if(s){if(r=Gm(s,e,t),!wb(r)||bb(r))return r;throw new i0("Can't convert object to primitive value")}return Sb(e)},a0=ar,bn=function(e){var t=rN(e,"string");return a0(t)?t:t+""},o0=jt,Hm=F.document,c0=o0(Hm)&&o0(Hm.createElement),Km=function(e){return c0?Hm.createElement(e):{}},xb=Km,l0=!Qe&&!m((function(){return Object.defineProperty(xb("div"),"a",{get:function(){return 7}}).a!==7})),d0=Qe,zm=ge,Il=Ee,Ol=_e,kl=Le,xp=bn,Tp=us,Pl=l0,Tb=Object.getOwnPropertyDescriptor;Ze.f=d0?Tb:function(e,t){if(e=kl(e),t=xp(t),Pl)try{return Tb(e,t)}catch{}if(Tp(e,t))return Ol(!zm(Il.f,e,t),e[t])};var Cb=m,Cp=he,nN=/#|\.prototype\./,Fu=function(e,t){var r=Rb[$m(e)];return r===Rp||r!==sN&&(Cp(t)?Cb(t):!!t)},$m=Fu.normalize=function(e){return String(e).replace(nN,".").toLowerCase()},Rb=Fu.data={},sN=Fu.NATIVE="N",Rp=Fu.POLYFILL="P",Vu=Fu,Bu=Ar,Ym=y,iN=oe(oe.bind),Dl=function(e,t){return Bu(e),t===void 0?e:Ym?iN(e,t):function(){return e.apply(t,arguments)}},Qi={},Np=Qe&&m((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),u0=jt,Nb=String,jl=TypeError,hi=function(e){if(u0(e))return e;throw new jl(Nb(e)+" is not an object")},Xm=Qe,Ab=l0,Jm=Np,Ud=hi,h0=bn,_a=TypeError,Ll=Object.defineProperty,p0=Object.getOwnPropertyDescriptor,Fd="enumerable",f0="configurable",Ap="writable";Qi.f=Xm?Jm?function(e,t,r){if(Ud(e),t=h0(t),Ud(r),typeof e=="function"&&t==="prototype"&&"value"in r&&Ap in r&&!r[Ap]){var s=p0(e,t);s&&s[Ap]&&(e[t]=r.value,r={configurable:f0 in r?r[f0]:s[f0],enumerable:Fd in r?r[Fd]:s[Fd],writable:!1})}return Ll(e,t,r)}:Ll:function(e,t,r){if(Ud(e),t=h0(t),Ud(r),Ab)try{return Ll(e,t,r)}catch{}if("get"in r||"set"in r)throw new _a("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var m0=Qi,Ip=_e,qo=Qe?function(e,t,r){return m0.f(e,t,Ip(1,r))}:function(e,t,r){return e[t]=r,e},Wu=F,aN=$,oN=oe,cN=he,g0=Ze.f,lN=Vu,qu=xt,dN=Dl,Gu=qo,Ib=us,Ob=function(e){var t=function(r,s,c){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,s)}return new e(r,s,c)}return aN(e,this,arguments)};return t.prototype=e.prototype,t},kr=function(e,t){var r,s,c,d,h,f,g,v,E,C=e.target,R=e.global,A=e.stat,B=e.proto,L=R?Wu:A?Wu[C]:Wu[C]&&Wu[C].prototype,U=R?qu:qu[C]||Gu(qu,C,{})[C],X=U.prototype;for(d in t)s=!(r=lN(R?d:C+(A?".":"#")+d,e.forced))&&L&&Ib(L,d),f=U[d],s&&(g=e.dontCallGetSet?(E=g0(L,d))&&E.value:L[d]),h=s&&g?g:t[d],(r||B||typeof f!=typeof h)&&(v=e.bind&&s?dN(h,Wu):e.wrap&&s?Ob(h):B&&cN(h)?oN(h):h,(e.sham||h&&h.sham||f&&f.sham)&&Gu(v,"sham",!0),Gu(U,d,v),B&&(Ib(qu,c=C+"Prototype")||Gu(qu,c,{}),Gu(qu[c],d,h),e.real&&X&&(r||!X[d])&&Gu(X,d,h)))},uN=Math.ceil,hN=Math.floor,pN=Math.trunc||function(e){var t=+e;return(t>0?hN:uN)(t)},_0=pN,y0=function(e){var t=+e;return t!=t||t===0?0:_0(t)},fN=y0,mN=Math.max,kb=Math.min,v0=function(e,t){var r=fN(e);return r<0?mN(r+t,0):kb(r,t)},gN=y0,_N=Math.min,Pb=function(e){var t=gN(e);return t>0?_N(t,9007199254740991):0},yN=Pb,Ml=function(e){return yN(e.length)},vN=Le,E0=v0,Op=Ml,Db=function(e){return function(t,r,s){var c=vN(t),d=Op(c);if(d===0)return!e&&-1;var h,f=E0(s,d);if(e&&r!=r){for(;d>f;)if((h=c[f++])!=h)return!0}else for(;d>f;f++)if((e||f in c)&&c[f]===r)return e||f||0;return!e&&-1}},Qm={includes:Db(!0),indexOf:Db(!1)},jb=Qm.includes;kr({target:"Array",proto:!0,forced:m((function(){return!Array(1).includes()}))},{includes:function(e){return jb(this,e,arguments.length>1?arguments[1]:void 0)}});var Lb=F,Mb=xt,ya=function(e,t){var r=Mb[e+"Prototype"],s=r&&r[t];if(s)return s;var c=Lb[e],d=c&&c.prototype;return d&&d[t]},Hu=ya("Array","includes"),EN=jt,wN=ie,bN=wn("match"),w0=function(e){var t;return EN(e)&&((t=e[bN])!==void 0?!!t:wN(e)==="RegExp")},Ub=w0,kp=TypeError,Ku={};Ku[wn("toStringTag")]="z";var b0=String(Ku)==="[object z]",Zm=b0,SN=he,Pp=ie,S0=wn("toStringTag"),x0=Object,Fb=Pp((function(){return arguments})())==="Arguments",Lc=Zm?Pp:function(e){var t,r,s;return e===void 0?"Undefined":e===null?"Null":typeof(r=(function(c,d){try{return c[d]}catch{}})(t=x0(e),S0))=="string"?r:Fb?Pp(t):(s=Pp(t))==="Object"&&SN(t.callee)?"Arguments":s},Vb=Lc,xN=String,Zi=function(e){if(Vb(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return xN(e)},TN=wn("match"),CN=kr,RN=function(e){if(Ub(e))throw new kp("The method doesn't accept regular expressions");return e},fo=en,zu=Zi,Bb=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[TN]=!1,"/./"[e](t)}catch{}}return!1},Wb=N("".indexOf);CN({target:"String",proto:!0,forced:!Bb("includes")},{includes:function(e){return!!~Wb(zu(fo(this)),zu(RN(e)),arguments.length>1?arguments[1]:void 0)}});var qb=ya("String","includes"),T0=O,C0=Hu,NN=qb,R0=Array.prototype,Ul=String.prototype,N0=function(e){var t=e.includes;return e===R0||T0(R0,e)&&t===R0.includes?C0:typeof e=="string"||e===Ul||T0(Ul,e)&&t===Ul.includes?NN:t},$e=u(N0),A0=Ar,Gb=Bo,eg=er,$u=Ml,tg=TypeError,I0="Reduce of empty array with no initial value",rg=function(e){return function(t,r,s,c){var d=Gb(t),h=eg(d),f=$u(d);if(A0(r),f===0&&s<2)throw new tg(I0);var g=e?f-1:0,v=e?-1:1;if(s<2)for(;;){if(g in h){c=h[g],g+=v;break}if(g+=v,e?g<0:f<=g)throw new tg(I0)}for(;e?g>=0:f>g;g+=v)g in h&&(c=r(c,h[g],g,d));return c}},Hb={left:rg(!1)},Kb=m,Dp=function(e,t){var r=[][e];return!!r&&Kb((function(){r.call(null,t||function(){return 1},1)}))},Yu=F,zb=_t,$b=ie,mo=function(e){return zb.slice(0,e.length)===e},jp=mo("Bun/")?"BUN":mo("Cloudflare-Workers")?"CLOUDFLARE":mo("Deno/")?"DENO":mo("Node.js/")?"NODE":Yu.Bun&&typeof Bun.version=="string"?"BUN":Yu.Deno&&typeof Deno.version=="object"?"DENO":$b(Yu.process)==="process"?"NODE":Yu.window&&Yu.document?"BROWSER":"REST",Xu=jp==="NODE",AN=Hb.left;kr({target:"Array",proto:!0,forced:!Xu&&tt>79&&tt<83||!Dp("reduce")},{reduce:function(e){var t=arguments.length;return AN(this,e,t,t>1?arguments[1]:void 0)}});var IN=ya("Array","reduce"),Lp=O,ON=IN,ng=Array.prototype,Yb=function(e){var t=e.reduce;return e===ng||Lp(ng,e)&&t===ng.reduce?ON:t},Gn=Yb,ea=u(Gn),sg=ie,Mc=Array.isArray||function(e){return sg(e)==="Array"},Xb=kr,O0=Mc,Mp=N([].reverse),Up=[1,2];Xb({target:"Array",proto:!0,forced:String(Up)===String(Up.reverse())},{reverse:function(){return O0(this)&&(this.length=this.length),Mp(this)}});var Ju=ya("Array","reverse"),Jb=O,kN=Ju,k0=Array.prototype,Qb=function(e){var t=e.reverse;return e===k0||Jb(k0,e)&&t===k0.reverse?kN:t},Fp=Qb,Vp=u(Fp),P0=Lu,ig=Md("keys"),Qu=function(e){return ig[e]||(ig[e]=P0(e))},D0=!m((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),PN=us,Zb=he,DN=Bo,jN=D0,ag=Qu("IE_PROTO"),Go=Object,eS=Go.prototype,Fl=jN?Go.getPrototypeOf:function(e){var t=DN(e);if(PN(t,ag))return t[ag];var r=t.constructor;return Zb(r)&&t instanceof r?r.prototype:t instanceof Go?eS:null},Ho=N,Bp=Ar,Uc=jt,j0=function(e){return Uc(e)||e===null},LN=String,MN=TypeError,Vd=function(e,t,r){try{return Ho(Bp(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},Wp=jt,Zu=en,og=function(e){if(j0(e))return e;throw new MN("Can't set "+LN(e)+" as a prototype")},L0=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,r={};try{(e=Vd(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(s,c){return Zu(s),og(c),Wp(s)&&(t?e(s,c):s.__proto__=c),s}})():void 0),Fc={},go={},Mn=us,Hn=Le,Vl=Qm.indexOf,Ci=go,Fi=N([].push),Bl=function(e,t){var r,s=Hn(e),c=0,d=[];for(r in s)!Mn(Ci,r)&&Mn(s,r)&&Fi(d,r);for(;t.length>c;)Mn(s,r=t[c++])&&(~Vl(d,r)||Fi(d,r));return d},Wl=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ta=Bl,cg=Wl.concat("length","prototype");Fc.f=Object.getOwnPropertyNames||function(e){return ta(e,cg)};var eh={};eh.f=Object.getOwnPropertySymbols;var tS=Sr,lg=Fc,rS=eh,Vc=hi,dg=N([].concat),M0=tS("Reflect","ownKeys")||function(e){var t=lg.f(Vc(e)),r=rS.f;return r?dg(t,r(e)):t},U0=us,UN=M0,ql=Ze,th=Qi,Gl={},ug=Bl,hg=Wl,Vi=Object.keys||function(e){return ug(e,hg)},La=Qe,Bd=Np,Bc=Qi,Wc=hi,Wd=Le,nS=Vi;Gl.f=La&&!Bd?Object.defineProperties:function(e,t){Wc(e);for(var r,s=Wd(t),c=nS(t),d=c.length,h=0;d>h;)Bc.f(e,r=c[h++],s[r]);return e};var rh,pg=Sr("document","documentElement"),va=hi,Ea=Gl,Yn=Wl,_o=go,sS=pg,iS=Km,qp="prototype",Gp="script",F0=Qu("IE_PROTO"),nh=function(){},V0=function(e){return"<"+Gp+">"+e+"</"+Gp+">"},qd=function(e){e.write(V0("")),e.close();var t=e.parentWindow.Object;return e=null,t},sh=function(){try{rh=new ActiveXObject("htmlfile")}catch{}var e,t,r;sh=typeof document<"u"?document.domain&&rh?qd(rh):(t=iS("iframe"),r="java"+Gp+":",t.style.display="none",sS.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(V0("document.F=Object")),e.close(),e.F):qd(rh);for(var s=Yn.length;s--;)delete sh[qp][Yn[s]];return sh()};_o[F0]=!0;var Hp=Object.create||function(e,t){var r;return e!==null?(nh[qp]=va(e),r=new nh,nh[qp]=null,r[F0]=e):r=sh(),t===void 0?r:Ea.f(r,t)},Kp=jt,fg=qo,B0=Error,aS=N("".replace),ih=String(new B0("zxcasd").stack),W0=/\n\s*at [^:]*:[^\n]*/,mg=W0.test(ih),gg=_e,ah=!m((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",gg(1,7)),e.stack!==7)})),q0=qo,G0=function(e,t){if(mg&&typeof e=="string"&&!B0.prepareStackTrace)for(;t--;)e=aS(e,W0,"");return e},H0=ah,_g=Error.captureStackTrace,yo={},Ma=yo,Gd=wn("iterator"),K0=Array.prototype,z0=function(e){return e!==void 0&&(Ma.Array===e||K0[Gd]===e)},qc=Lc,Gc=Ti,$0=gt,oS=yo,Hc=wn("iterator"),vo=function(e){if(!$0(e))return Gc(e,Hc)||Gc(e,"@@iterator")||oS[qc(e)]},yg=ge,cS=Ar,vg=hi,lS=qn,zp=vo,Ko=TypeError,Hd=function(e,t){var r=arguments.length<2?zp(e):t;if(cS(r))return vg(yg(r,e));throw new Ko(lS(e)+" is not iterable")},$p=ge,Hl=hi,Y0=Ti,Kd=function(e,t,r){var s,c;Hl(e);try{if(!(s=Y0(e,"return"))){if(t==="throw")throw r;return r}s=$p(s,e)}catch(d){c=!0,s=d}if(t==="throw")throw r;if(c)throw s;return Hl(s),r},dS=Dl,X0=ge,as=hi,Eg=qn,J0=z0,Q0=Ml,Yp=O,Z0=Hd,zd=vo,rs=Kd,Ks=TypeError,xs=function(e,t){this.stopped=e,this.result=t},Xp=xs.prototype,Kc=function(e,t,r){var s,c,d,h,f,g,v,E=r&&r.that,C=!(!r||!r.AS_ENTRIES),R=!(!r||!r.IS_RECORD),A=!(!r||!r.IS_ITERATOR),B=!(!r||!r.INTERRUPTED),L=dS(t,E),U=function(Y){return s&&rs(s,"normal",Y),new xs(!0,Y)},X=function(Y){return C?(as(Y),B?L(Y[0],Y[1],U):L(Y[0],Y[1])):B?L(Y,U):L(Y)};if(R)s=e.iterator;else if(A)s=e;else{if(!(c=zd(e)))throw new Ks(Eg(e)+" is not iterable");if(J0(c)){for(d=0,h=Q0(e);h>d;d++)if((f=X(e[d]))&&Yp(Xp,f))return f;return new xs(!1)}s=Z0(e,c)}for(g=R?e.next:s.next;!(v=X0(g,s)).done;){try{f=X(v.value)}catch(Y){rs(s,"throw",Y)}if(typeof f=="object"&&f&&Yp(Xp,f))return f}return new xs(!1)},Jp=Zi,FN=kr,Ri=O,ev=Fl,oh=L0,tv=function(e,t,r){for(var s=UN(t),c=th.f,d=ql.f,h=0;h<s.length;h++){var f=s[h];U0(e,f)||r&&U0(r,f)||c(e,f,d(t,f))}},Eo=Hp,ra=qo,$d=_e,rv=function(e,t){Kp(t)&&"cause"in t&&fg(e,"cause",t.cause)},nv=function(e,t,r,s){H0&&(_g?_g(e,t):q0(e,"stack",G0(r,s)))},uS=Kc,hS=function(e,t){return e===void 0?arguments.length<2?"":t:Jp(e)},pS=wn("toStringTag"),Qp=Error,fS=[].push,Yd=function(e,t){var r,s=Ri(wg,this);oh?r=oh(new Qp,s?ev(this):wg):(r=s?this:Eo(wg),ra(r,pS,"Error")),t!==void 0&&ra(r,"message",hS(t)),nv(r,Yd,r.stack,1),arguments.length>2&&rv(r,arguments[2]);var c=[];return uS(e,fS,{that:c}),ra(r,"errors",c),r};oh?oh(Yd,Qp):tv(Yd,Qp,{name:!0});var wg=Yd.prototype=Eo(Qp.prototype,{constructor:$d(1,Yd),message:$d(1,""),name:$d(1,"AggregateError")});FN({global:!0},{AggregateError:Yd});var Zp,zc,ef,bg=he,tf=F.WeakMap,mS=bg(tf)&&/native code/.test(String(tf)),Sg=F,gS=jt,_S=qo,xg=us,Tg=Bm,sv=Qu,yS=go,iv="Object already initialized",Cg=Sg.TypeError,VN=Sg.WeakMap;if(mS||Tg.state){var wo=Tg.state||(Tg.state=new VN);wo.get=wo.get,wo.has=wo.has,wo.set=wo.set,Zp=function(e,t){if(wo.has(e))throw new Cg(iv);return t.facade=e,wo.set(e,t),t},zc=function(e){return wo.get(e)||{}},ef=function(e){return wo.has(e)}}else{var ch=sv("state");yS[ch]=!0,Zp=function(e,t){if(xg(e,ch))throw new Cg(iv);return t.facade=e,_S(e,ch,t),t},zc=function(e){return xg(e,ch)?e[ch]:{}},ef=function(e){return xg(e,ch)}}var Xd,av,ov,Kl={set:Zp,get:zc,has:ef,enforce:function(e){return ef(e)?zc(e):Zp(e,{})},getterFor:function(e){return function(t){var r;if(!gS(t)||(r=zc(t)).type!==e)throw new Cg("Incompatible receiver, "+e+" required");return r}}},lh=Qe,BN=us,vS=Function.prototype,WN=lh&&Object.getOwnPropertyDescriptor,Ua=BN(vS,"name"),Rg={PROPER:Ua&&(function(){}).name==="something",CONFIGURABLE:Ua&&(!lh||lh&&WN(vS,"name").configurable)},Ng=qo,$c=function(e,t,r,s){return s&&s.enumerable?e[t]=r:Ng(e,t,r),e},ES=m,wS=he,cv=jt,dh=Hp,Ag=Fl,lv=$c,dv=wn("iterator"),uv=!1;[].keys&&("next"in(ov=[].keys())?(av=Ag(Ag(ov)))!==Object.prototype&&(Xd=av):uv=!0);var bS=!cv(Xd)||ES((function(){var e={};return Xd[dv].call(e)!==e}));wS((Xd=bS?{}:dh(Xd))[dv])||lv(Xd,dv,(function(){return this}));var hv={IteratorPrototype:Xd,BUGGY_SAFARI_ITERATORS:uv},SS=Lc,xS=b0?{}.toString:function(){return"[object "+SS(this)+"]"},qN=b0,na=Qi.f,Bi=qo,TS=us,CS=xS,pv=wn("toStringTag"),zo=function(e,t,r,s){var c=r?e:e&&e.prototype;c&&(TS(c,pv)||na(c,pv,{configurable:!0,value:t}),s&&!qN&&Bi(c,"toString",CS))},RS=hv.IteratorPrototype,fv=Hp,NS=_e,mv=zo,AS=yo,IS=function(){return this},rf=function(e,t,r,s){var c=t+" Iterator";return e.prototype=fv(RS,{next:NS(+!s,r)}),mv(e,c,!1,!0),AS[c]=IS,e},gv=kr,OS=ge,_v=Rg,Ig=rf,GN=Fl,kS=zo,Og=$c,yv=yo,kg=hv,Yc=_v.PROPER,Pg=kg.BUGGY_SAFARI_ITERATORS,Dg=wn("iterator"),jg="keys",nf="values",vv="entries",sf=function(){return this},pi=function(e,t,r,s,c,d,h){Ig(r,t,s);var f,g,v,E=function(X){if(X===c&&L)return L;if(!Pg&&X&&X in A)return A[X];switch(X){case jg:case nf:case vv:return function(){return new r(this,X)}}return function(){return new r(this)}},C=t+" Iterator",R=!1,A=e.prototype,B=A[Dg]||A["@@iterator"]||c&&A[c],L=!Pg&&B||E(c),U=t==="Array"&&A.entries||B;if(U&&(f=GN(U.call(new e)))!==Object.prototype&&f.next&&(kS(f,C,!0,!0),yv[C]=sf),Yc&&c===nf&&B&&B.name!==nf&&(R=!0,L=function(){return OS(B,this)}),c)if(g={values:E(nf),keys:d?L:E(jg),entries:E(vv)},h)for(v in g)(Pg||R||!(v in A))&&Og(A,v,g[v]);else gv({target:t,proto:!0,forced:Pg||R},g);return h&&A[Dg]!==L&&Og(A,Dg,L,{}),yv[t]=L,g},Lg=function(e,t){return{value:e,done:t}},HN=Le,af=yo,fi=Kl;Qi.f;var KN=pi,Ht=Lg,Jd="Array Iterator",Ev=fi.set,PS=fi.getterFor(Jd);KN(Array,"Array",(function(e,t){Ev(this,{type:Jd,target:HN(e),index:0,kind:t})}),(function(){var e=PS(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,Ht(void 0,!0);switch(e.kind){case"keys":return Ht(r,!1);case"values":return Ht(t[r],!1)}return Ht([r,t[r]],!1)}),"values"),af.Arguments=af.Array;var zN=Qi,zl=function(e,t,r){return zN.f(e,t,r)},Mg=Sr,wv=zl,DS=Qe,bv=wn("species"),jS=O,Sv=TypeError,of=function(e,t){if(jS(t,e))return e;throw new Sv("Incorrect invocation")},mi=he,wa=Bm,$l=N(Function.toString);mi(wa.inspectSource)||(wa.inspectSource=function(e){return $l(e)});var xv=wa.inspectSource,LS=N,bo=m,Tv=he,$o=Lc,$N=xv,Cv=function(){},Rv=Sr("Reflect","construct"),Ug=/^\s*(?:class|function)\b/,MS=LS(Ug.exec),YN=!Ug.test(Cv),Yl=function(e){if(!Tv(e))return!1;try{return Rv(Cv,[],e),!0}catch{return!1}},Fg=function(e){if(!Tv(e))return!1;switch($o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return YN||!!MS(Ug,$N(e))}catch{return!0}};Fg.sham=!0;var Ni,Yr,zs,hs,Ms=!Rv||bo((function(){var e;return Yl(Yl.call)||!Yl(Object)||!Yl((function(){e=!0}))||e}))?Fg:Yl,ba=Ms,uh=qn,$s=TypeError,hh=hi,Qd=function(e){if(ba(e))return e;throw new $s(uh(e)+" is not a constructor")},Vg=gt,Nv=wn("species"),Zd=function(e,t){var r,s=hh(e).constructor;return s===void 0||Vg(r=hh(s)[Nv])?t:Qd(r)},Ts=N([].slice),Av=TypeError,Fa=function(e,t){if(e<t)throw new Av("Not enough arguments");return e},Yo=/(?:ipad|iphone|ipod).*applewebkit/i.test(_t),Ai=F,Iv=$,Xl=Dl,cf=he,Jl=us,lf=m,ph=pg,Ov=Ts,df=Km,Bg=Fa,Wi=Yo,Ql=Xu,Sa=Ai.setImmediate,Ii=Ai.clearImmediate,US=Ai.process,uf=Ai.Dispatch,kv=Ai.Function,FS=Ai.MessageChannel,Zl=Ai.String,Wg=0,eu={},ed="onreadystatechange";lf((function(){Ni=Ai.location}));var hf=function(e){if(Jl(eu,e)){var t=eu[e];delete eu[e],t()}},Xc=function(e){return function(){hf(e)}},Pv=function(e){hf(e.data)},Dv=function(e){Ai.postMessage(Zl(e),Ni.protocol+"//"+Ni.host)};Sa&&Ii||(Sa=function(e){Bg(arguments.length,1);var t=cf(e)?e:kv(e),r=Ov(arguments,1);return eu[++Wg]=function(){Iv(t,void 0,r)},Yr(Wg),Wg},Ii=function(e){delete eu[e]},Ql?Yr=function(e){US.nextTick(Xc(e))}:uf&&uf.now?Yr=function(e){uf.now(Xc(e))}:FS&&!Wi?(hs=(zs=new FS).port2,zs.port1.onmessage=Pv,Yr=Xl(hs.postMessage,hs)):Ai.addEventListener&&cf(Ai.postMessage)&&!Ai.importScripts&&Ni&&Ni.protocol!=="file:"&&!lf(Dv)?(Yr=Dv,Ai.addEventListener("message",Pv,!1)):Yr=ed in df("script")?function(e){ph.appendChild(df("script"))[ed]=function(){ph.removeChild(this),hf(e)}}:function(e){setTimeout(Xc(e),0)});var fh={set:Sa,clear:Ii},pf=F,XN=Qe,JN=Object.getOwnPropertyDescriptor,jv=function(e){if(!XN)return pf[e];var t=JN(pf,e);return t&&t.value},Lv=function(){this.head=null,this.tail=null};Lv.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Va,Mv,td,qg,os,VS=Lv,BS=/ipad|iphone|ipod/i.test(_t)&&typeof Pebble<"u",QN=/web0s(?!.*chrome)/i.test(_t),mh=F,WS=jv,Uv=Dl,Fv=fh.set,Ba=VS,Vv=Yo,ZN=BS,rd=QN,gh=Xu,nd=mh.MutationObserver||mh.WebKitMutationObserver,ff=mh.document,Gg=mh.process,_h=mh.Promise,Bv=WS("queueMicrotask");if(!Bv){var yh=new Ba,Hg=function(){var e,t;for(gh&&(e=Gg.domain)&&e.exit();t=yh.get();)try{t()}catch(r){throw yh.head&&Va(),r}e&&e.enter()};Vv||gh||rd||!nd||!ff?!ZN&&_h&&_h.resolve?((qg=_h.resolve(void 0)).constructor=_h,os=Uv(qg.then,qg),Va=function(){os(Hg)}):gh?Va=function(){Gg.nextTick(Hg)}:(Fv=Uv(Fv,mh),Va=function(){Fv(Hg)}):(Mv=!0,td=ff.createTextNode(""),new nd(Hg).observe(td,{characterData:!0}),Va=function(){td.data=Mv=!Mv}),Bv=function(e){yh.head||Va(),yh.add(e)}}var Wv=Bv,tu=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Xo=F.Promise,Kg=F,vh=Xo,qv=he,eA=Vu,qS=xv,Gv=wn,mf=jp,gf=tt,_f=vh&&vh.prototype,GS=Gv("species"),HS=qv(Kg.PromiseRejectionEvent),zg=eA("Promise",(function(){var e=qS(vh),t=e!==String(vh);if(!t&&gf===66||!_f.catch||!_f.finally)return!0;if(!gf||gf<51||!/native code/.test(e)){var r=new vh((function(c){c(1)})),s=function(c){c((function(){}),(function(){}))};if((r.constructor={})[GS]=s,!(r.then((function(){}))instanceof s))return!0}return!(t||mf!=="BROWSER"&&mf!=="DENO"||HS)})),yf={CONSTRUCTOR:zg,REJECTION_EVENT:HS},sa={},KS=Ar,$g=TypeError,p=function(e){var t,r;this.promise=new e((function(s,c){if(t!==void 0||r!==void 0)throw new $g("Bad Promise constructor");t=s,r=c})),this.resolve=KS(t),this.reject=KS(r)};sa.f=function(e){return new p(e)};var _,S,I=kr,j=Xu,q=F,ae=ge,Te=$c,Ie=zo,et=function(e){var t=Mg(e);DS&&t&&!t[bv]&&wv(t,bv,{configurable:!0,get:function(){return this}})},Et=Ar,St=he,yt=jt,qt=of,$t=Zd,Xt=fh.set,cs=Wv,Ge=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},Pe=tu,Ye=VS,Rt=Kl,Jt=Xo,dr=yf,ur=sa,_r="Promise",Ys=dr.CONSTRUCTOR,gn=dr.REJECTION_EVENT,Jo=Rt.getterFor(_r),tA=Rt.set,d9=Jt&&Jt.prototype,Hv=Jt,rA=d9,L2=q.TypeError,nA=q.document,sA=q.process,iA=ur.f,u9=iA,h9=!!(nA&&nA.createEvent&&q.dispatchEvent),M2="unhandledrejection",U2=function(e){var t;return!(!yt(e)||!St(t=e.then))&&t},F2=function(e,t){var r,s,c,d=t.value,h=t.state===1,f=h?e.ok:e.fail,g=e.resolve,v=e.reject,E=e.domain;try{f?(h||(t.rejection===2&&f9(t),t.rejection=1),f===!0?r=d:(E&&E.enter(),r=f(d),E&&(E.exit(),c=!0)),r===e.promise?v(new L2("Promise-chain cycle")):(s=U2(r))?ae(s,r,g,v):g(r)):v(d)}catch(C){E&&!c&&E.exit(),v(C)}},V2=function(e,t){e.notified||(e.notified=!0,cs((function(){for(var r,s=e.reactions;r=s.get();)F2(r,e);e.notified=!1,t&&!e.rejection&&p9(e)})))},B2=function(e,t,r){var s,c;h9?((s=nA.createEvent("Event")).promise=t,s.reason=r,s.initEvent(e,!1,!0),q.dispatchEvent(s)):s={promise:t,reason:r},!gn&&(c=q["on"+e])?c(s):e===M2&&Ge("Unhandled promise rejection",r)},p9=function(e){ae(Xt,q,(function(){var t,r=e.facade,s=e.value;if(W2(e)&&(t=Pe((function(){j?sA.emit("unhandledRejection",s,r):B2(M2,r,s)})),e.rejection=j||W2(e)?2:1,t.error))throw t.value}))},W2=function(e){return e.rejection!==1&&!e.parent},f9=function(e){ae(Xt,q,(function(){var t=e.facade;j?sA.emit("rejectionHandled",t):B2("rejectionhandled",t,e.value)}))},Yg=function(e,t,r){return function(s){e(t,s,r)}},Xg=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,V2(e,!0))},aA=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new L2("Promise can't be resolved itself");var s=U2(t);s?cs((function(){var c={done:!1};try{ae(s,t,Yg(aA,c,e),Yg(Xg,c,e))}catch(d){Xg(c,d,e)}})):(e.value=t,e.state=1,V2(e,!1))}catch(c){Xg({done:!1},c,e)}}};Ys&&(rA=(Hv=function(e){qt(this,rA),Et(e),ae(_,this);var t=Jo(this);try{e(Yg(aA,t),Yg(Xg,t))}catch(r){Xg(t,r)}}).prototype,(_=function(e){tA(this,{type:_r,done:!1,notified:!1,parent:!1,reactions:new Ye,rejection:!1,state:0,value:null})}).prototype=Te(rA,"then",(function(e,t){var r=Jo(this),s=iA($t(this,Hv));return r.parent=!0,s.ok=!St(e)||e,s.fail=St(t)&&t,s.domain=j?sA.domain:void 0,r.state===0?r.reactions.add(s):cs((function(){F2(s,r)})),s.promise})),S=function(){var e=new _,t=Jo(e);this.promise=e,this.resolve=Yg(aA,t),this.reject=Yg(Xg,t)},ur.f=iA=function(e){return e===Hv||e===void 0?new S(e):u9(e)}),I({global:!0,wrap:!0,forced:Ys},{Promise:Hv}),Ie(Hv,_r,!1,!0),et(_r);var q2=wn("iterator"),G2=!1;try{var m9=0,H2={next:function(){return{done:!!m9++}},return:function(){G2=!0}};H2[q2]=function(){return this},Array.from(H2,(function(){throw 2}))}catch{}var g9=Xo,_9=function(e,t){try{if(!t&&!G2)return!1}catch{return!1}var r=!1;try{var s={};s[q2]=function(){return{next:function(){return{done:r=!0}}}},e(s)}catch{}return r},zS=yf.CONSTRUCTOR||!_9((function(e){g9.all(e).then(void 0,(function(){}))})),y9=ge,v9=Ar,E9=sa,w9=tu,b9=Kc;kr({target:"Promise",stat:!0,forced:zS},{all:function(e){var t=this,r=E9.f(t),s=r.resolve,c=r.reject,d=w9((function(){var h=v9(t.resolve),f=[],g=0,v=1;b9(e,(function(E){var C=g++,R=!1;v++,y9(h,t,E).then((function(A){R||(R=!0,f[C]=A,--v||s(f))}),c)})),--v||s(f)}));return d.error&&c(d.value),r.promise}});var S9=kr,x9=yf.CONSTRUCTOR;Xo&&Xo.prototype,S9({target:"Promise",proto:!0,forced:x9,real:!0},{catch:function(e){return this.then(void 0,e)}});var T9=ge,C9=Ar,R9=sa,N9=tu,A9=Kc;kr({target:"Promise",stat:!0,forced:zS},{race:function(e){var t=this,r=R9.f(t),s=r.reject,c=N9((function(){var d=C9(t.resolve);A9(e,(function(h){T9(d,t,h).then(r.resolve,s)}))}));return c.error&&s(c.value),r.promise}});var I9=sa;kr({target:"Promise",stat:!0,forced:yf.CONSTRUCTOR},{reject:function(e){var t=I9.f(this);return(0,t.reject)(e),t.promise}});var O9=hi,k9=jt,P9=sa,K2=function(e,t){if(O9(e),k9(t)&&t.constructor===e)return t;var r=P9.f(e);return(0,r.resolve)(t),r.promise},D9=kr,j9=Xo,L9=yf.CONSTRUCTOR,M9=K2,U9=Sr("Promise"),F9=!L9;D9({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return M9(F9&&this===U9?j9:this,e)}});var V9=ge,B9=Ar,W9=sa,q9=tu,G9=Kc;kr({target:"Promise",stat:!0,forced:zS},{allSettled:function(e){var t=this,r=W9.f(t),s=r.resolve,c=r.reject,d=q9((function(){var h=B9(t.resolve),f=[],g=0,v=1;G9(e,(function(E){var C=g++,R=!1;v++,V9(h,t,E).then((function(A){R||(R=!0,f[C]={status:"fulfilled",value:A},--v||s(f))}),(function(A){R||(R=!0,f[C]={status:"rejected",reason:A},--v||s(f))}))})),--v||s(f)}));return d.error&&c(d.value),r.promise}});var H9=ge,K9=Ar,z9=Sr,$9=sa,Y9=tu,X9=Kc,z2="No one promise resolved";kr({target:"Promise",stat:!0,forced:zS},{any:function(e){var t=this,r=z9("AggregateError"),s=$9.f(t),c=s.resolve,d=s.reject,h=Y9((function(){var f=K9(t.resolve),g=[],v=0,E=1,C=!1;X9(e,(function(R){var A=v++,B=!1;E++,H9(f,t,R).then((function(L){B||C||(C=!0,c(L))}),(function(L){B||C||(B=!0,g[A]=L,--E||d(new r(g,z2)))}))})),--E||d(new r(g,z2))}));return h.error&&d(h.value),s.promise}});var J9=kr,Q9=$,Z9=Ts,e7=sa,t7=Ar,$2=tu,oA=F.Promise,Y2=!1;J9({target:"Promise",stat:!0,forced:!oA||!oA.try||$2((function(){oA.try((function(e){Y2=e===8}),8)})).error||!Y2},{try:function(e){var t=arguments.length>1?Z9(arguments,1):[],r=e7.f(this),s=$2((function(){return Q9(t7(e),void 0,t)}));return(s.error?r.reject:r.resolve)(s.value),r.promise}});var r7=sa;kr({target:"Promise",stat:!0},{withResolvers:function(){var e=r7.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var n7=kr,cA=Xo,s7=m,i7=Sr,a7=he,o7=Zd,X2=K2,c7=cA&&cA.prototype;n7({target:"Promise",proto:!0,real:!0,forced:!!cA&&s7((function(){c7.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o7(this,i7("Promise")),r=a7(e);return this.then(r?function(s){return X2(t,e()).then((function(){return s}))}:e,r?function(s){return X2(t,e()).then((function(){throw s}))}:e)}});var lA=N,l7=y0,d7=Zi,u7=en,h7=lA("".charAt),J2=lA("".charCodeAt),p7=lA("".slice),Q2=function(e){return function(t,r){var s,c,d=d7(u7(t)),h=l7(r),f=d.length;return h<0||h>=f?e?"":void 0:(s=J2(d,h))<55296||s>56319||h+1===f||(c=J2(d,h+1))<56320||c>57343?e?h7(d,h):s:e?p7(d,h,h+2):c-56320+(s-55296<<10)+65536}},dA={codeAt:Q2(!1),charAt:Q2(!0)},f7=dA.charAt,m7=Zi,Z2=Kl,g7=pi,ej=Lg,tj="String Iterator",_7=Z2.set,y7=Z2.getterFor(tj);g7(String,"String",(function(e){_7(this,{type:tj,string:m7(e),index:0})}),(function(){var e,t=y7(this),r=t.string,s=t.index;return s>=r.length?ej(void 0,!0):(e=f7(r,s),t.index+=e.length,ej(e,!1))}));var v7=xt.Promise,E7={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},w7=F,b7=zo,rj=yo;for(var uA in E7)b7(w7[uA],uA),rj[uA]=rj.Array;var nj=v7,nt=u(nj),S7=ya("Array","values"),x7=Lc,T7=us,C7=O,R7=S7,hA=Array.prototype,N7={DOMTokenList:!0,NodeList:!0},A7=function(e){var t=e.values;return e===hA||C7(hA,e)&&t===hA.values||T7(N7,x7(e))?R7:t},xa=u(A7),sj=qn,I7=TypeError,ij=Ts,O7=Math.floor,pA=function(e,t){var r=e.length;if(r<8)for(var s,c,d=1;d<r;){for(c=d,s=e[d];c&&t(e[c-1],s)>0;)e[c]=e[--c];c!==d++&&(e[c]=s)}else for(var h=O7(r/2),f=pA(ij(e,0,h),t),g=pA(ij(e,h),t),v=f.length,E=g.length,C=0,R=0;C<v||R<E;)e[C+R]=C<v&&R<E?t(f[C],g[R])<=0?f[C++]:g[R++]:C<v?f[C++]:g[R++];return e},aj=pA,oj=_t.match(/firefox\/(\d+)/i),k7=!!oj&&+oj[1],P7=/MSIE|Trident/.test(_t),cj=_t.match(/AppleWebKit\/(\d+)\./),D7=!!cj&&+cj[1],j7=kr,lj=N,L7=Ar,M7=Bo,dj=Ml,U7=function(e,t){if(!delete e[t])throw new I7("Cannot delete property "+sj(t)+" of "+sj(e))},uj=Zi,fA=m,F7=aj,V7=Dp,hj=k7,B7=P7,pj=tt,fj=D7,Eh=[],mj=lj(Eh.sort),W7=lj(Eh.push),q7=fA((function(){Eh.sort(void 0)})),G7=fA((function(){Eh.sort(null)})),H7=V7("sort"),gj=!fA((function(){if(pj)return pj<70;if(!(hj&&hj>3)){if(B7)return!0;if(fj)return fj<603;var e,t,r,s,c="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(s=0;s<47;s++)Eh.push({k:t+s,v:r})}for(Eh.sort((function(d,h){return h.v-d.v})),s=0;s<Eh.length;s++)t=Eh[s].k.charAt(0),c.charAt(c.length-1)!==t&&(c+=t);return c!=="DGBEFHACIJK"}}));j7({target:"Array",proto:!0,forced:q7||!G7||!H7||!gj},{sort:function(e){e!==void 0&&L7(e);var t=M7(this);if(gj)return e===void 0?mj(t):mj(t,e);var r,s,c=[],d=dj(t);for(s=0;s<d;s++)s in t&&W7(c,t[s]);for(F7(c,(function(h){return function(f,g){return g===void 0?-1:f===void 0?1:h!==void 0?+h(f,g)||0:uj(f)>uj(g)?1:-1}})(e)),r=dj(c),s=0;s<r;)t[s]=c[s++];for(;s<d;)U7(t,s++);return t}});var K7=ya("Array","sort"),z7=O,$7=K7,mA=Array.prototype,Y7=function(e){var t=e.sort;return e===mA||z7(mA,e)&&t===mA.sort?$7:t},vf=u(Y7),X7=kr,J7=N,Q7=v0,Z7=RangeError,_j=String.fromCharCode,yj=String.fromCodePoint,eX=J7([].join);X7({target:"String",stat:!0,forced:!!yj&&yj.length!==1},{fromCodePoint:function(e){for(var t,r=[],s=arguments.length,c=0;s>c;){if(t=+arguments[c++],Q7(t,1114111)!==t)throw new Z7(t+" is not a valid code point");r[c]=t<65536?_j(t):_j(55296+((t-=65536)>>10),t%1024+56320)}return eX(r,"")}});var tX=m,rX=wn("iterator"),$S=!tX((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),s="";return e.pathname="c%20d",t.forEach((function(c,d){t.delete("b"),s+=d+c})),r.delete("a",2),r.delete("b",void 0),!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[rX]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||s!=="a1c3"||new URL("https://x",void 0).host!=="x"})),nX=$c,gA=kr,vj=F,_A=jv,sX=Sr,YS=ge,Jc=N,Kv=Qe,Ej=$S,wj=$c,iX=zl,aX=function(e,t,r){for(var s in t)r&&r.unsafe&&e[s]?e[s]=t[s]:nX(e,s,t[s],r);return e},oX=zo,cX=rf,yA=Kl,bj=of,vA=he,lX=us,dX=Dl,uX=Lc,hX=hi,Sj=jt,Ta=Zi,pX=Hp,xj=_e,Tj=Hd,fX=vo,XS=Lg,Jg=Fa,mX=aj,gX=wn("iterator"),Qg="URLSearchParams",Cj=Qg+"Iterator",Rj=yA.set,Qo=yA.getterFor(Qg),_X=yA.getterFor(Cj),Nj=_A("fetch"),JS=_A("Request"),zv=_A("Headers"),EA=JS&&JS.prototype,Aj=zv&&zv.prototype,yX=vj.TypeError,vX=vj.encodeURIComponent,EX=String.fromCharCode,wX=sX("String","fromCodePoint"),bX=parseInt,QS=Jc("".charAt),Ij=Jc([].join),wh=Jc([].push),Oj=Jc("".replace),SX=Jc([].shift),kj=Jc([].splice),Pj=Jc("".split),Dj=Jc("".slice),xX=Jc(/./.exec),TX=/\+/g,CX=/^[0-9a-f]+$/i,jj=function(e,t){var r=Dj(e,t,t+2);return xX(CX,r)?bX(r,16):NaN},RX=function(e){for(var t=0,r=128;r>0&&(e&r)!=0;r>>=1)t++;return t},NX=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},Lj=function(e){for(var t=(e=Oj(e,TX," ")).length,r="",s=0;s<t;){var c=QS(e,s);if(c==="%"){if(QS(e,s+1)==="%"||s+3>t){r+="%",s++;continue}var d=jj(e,s+1);if(d!=d){r+=c,s++;continue}s+=2;var h=RX(d);if(h===0)c=EX(d);else{if(h===1||h>4){r+="",s++;continue}for(var f=[d],g=1;g<h&&!(++s+3>t||QS(e,s)!=="%");){var v=jj(e,s+1);if(v!=v){s+=3;break}if(v>191||v<128)break;wh(f,v),s+=2,g++}if(f.length!==h){r+="";continue}var E=NX(f);E===null?r+="":c=wX(E)}}r+=c,s++}return r},AX=/[!'()~]|%20/g,IX={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},OX=function(e){return IX[e]},Mj=function(e){return Oj(vX(e),AX,OX)},wA=cX((function(e,t){Rj(this,{type:Cj,target:Qo(e).entries,index:0,kind:t})}),Qg,(function(){var e=_X(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,XS(void 0,!0);var s=t[r];switch(e.kind){case"keys":return XS(s.key,!1);case"values":return XS(s.value,!1)}return XS([s.key,s.value],!1)}),!0),Uj=function(e){this.entries=[],this.url=null,e!==void 0&&(Sj(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?QS(e,0)==="?"?Dj(e,1):e:Ta(e)))};Uj.prototype={type:Qg,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,s,c,d,h,f,g=this.entries,v=fX(e);if(v)for(r=(t=Tj(e,v)).next;!(s=YS(r,t)).done;){if(d=(c=Tj(hX(s.value))).next,(h=YS(d,c)).done||(f=YS(d,c)).done||!YS(d,c).done)throw new yX("Expected sequence with length 2");wh(g,{key:Ta(h.value),value:Ta(f.value)})}else for(var E in e)lX(e,E)&&wh(g,{key:E,value:Ta(e[E])})},parseQuery:function(e){if(e)for(var t,r,s=this.entries,c=Pj(e,"&"),d=0;d<c.length;)(t=c[d++]).length&&(r=Pj(t,"="),wh(s,{key:Lj(SX(r)),value:Lj(Ij(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],s=0;s<t.length;)e=t[s++],wh(r,Mj(e.key)+"="+Mj(e.value));return Ij(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ZS=function(){bj(this,Zg);var e=Rj(this,new Uj(arguments.length>0?arguments[0]:void 0));Kv||(this.size=e.entries.length)},Zg=ZS.prototype;if(aX(Zg,{append:function(e,t){var r=Qo(this);Jg(arguments.length,2),wh(r.entries,{key:Ta(e),value:Ta(t)}),Kv||this.length++,r.updateURL()},delete:function(e){for(var t=Qo(this),r=Jg(arguments.length,1),s=t.entries,c=Ta(e),d=r<2?void 0:arguments[1],h=d===void 0?d:Ta(d),f=0;f<s.length;){var g=s[f];if(g.key!==c||h!==void 0&&g.value!==h)f++;else if(kj(s,f,1),h!==void 0)break}Kv||(this.size=s.length),t.updateURL()},get:function(e){var t=Qo(this).entries;Jg(arguments.length,1);for(var r=Ta(e),s=0;s<t.length;s++)if(t[s].key===r)return t[s].value;return null},getAll:function(e){var t=Qo(this).entries;Jg(arguments.length,1);for(var r=Ta(e),s=[],c=0;c<t.length;c++)t[c].key===r&&wh(s,t[c].value);return s},has:function(e){for(var t=Qo(this).entries,r=Jg(arguments.length,1),s=Ta(e),c=r<2?void 0:arguments[1],d=c===void 0?c:Ta(c),h=0;h<t.length;){var f=t[h++];if(f.key===s&&(d===void 0||f.value===d))return!0}return!1},set:function(e,t){var r=Qo(this);Jg(arguments.length,1);for(var s,c=r.entries,d=!1,h=Ta(e),f=Ta(t),g=0;g<c.length;g++)(s=c[g]).key===h&&(d?kj(c,g--,1):(d=!0,s.value=f));d||wh(c,{key:h,value:f}),Kv||(this.size=c.length),r.updateURL()},sort:function(){var e=Qo(this);mX(e.entries,(function(t,r){return t.key>r.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=Qo(this).entries,s=dX(e,arguments.length>1?arguments[1]:void 0),c=0;c<r.length;)s((t=r[c++]).value,t.key,this)},keys:function(){return new wA(this,"keys")},values:function(){return new wA(this,"values")},entries:function(){return new wA(this,"entries")}},{enumerable:!0}),wj(Zg,gX,Zg.entries,{}),wj(Zg,"toString",(function(){return Qo(this).serialize()}),{enumerable:!0}),Kv&&iX(Zg,"size",{get:function(){return Qo(this).entries.length},configurable:!0,enumerable:!0}),oX(ZS,Qg),gA({global:!0,forced:!Ej},{URLSearchParams:ZS}),!Ej&&vA(zv)){var kX=Jc(Aj.has),PX=Jc(Aj.set),Fj=function(e){if(Sj(e)){var t,r=e.body;if(uX(r)===Qg)return t=e.headers?new zv(e.headers):new zv,kX(t,"content-type")||PX(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),pX(e,{body:xj(0,Ta(r)),headers:xj(0,t)})}return e};if(vA(Nj)&&gA({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Nj(e,arguments.length>1?Fj(arguments[1]):{})}}),vA(JS)){var bA=function(e){return bj(this,EA),new JS(e,arguments.length>1?Fj(arguments[1]):{})};EA.constructor=bA,bA.prototype=EA,gA({global:!0,dontCallGetSet:!0,forced:!0},{Request:bA})}}var Zo,DX={URLSearchParams:ZS,getState:Qo},jX=xt.URLSearchParams,Vj=Qe,LX=N,MX=ge,UX=m,SA=Vi,FX=eh,VX=Ee,BX=Bo,WX=er,e_=Object.assign,Bj=Object.defineProperty,qX=LX([].concat),GX=!e_||UX((function(){if(Vj&&e_({b:1},e_(Bj({},"a",{enumerable:!0,get:function(){Bj(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol("assign detection"),s="abcdefghijklmnopqrst";return e[r]=7,s.split("").forEach((function(c){t[c]=c})),e_({},e)[r]!==7||SA(e_({},t)).join("")!==s}))?function(e,t){for(var r=BX(e),s=arguments.length,c=1,d=FX.f,h=VX.f;s>c;)for(var f,g=WX(arguments[c++]),v=d?qX(SA(g),d(g)):SA(g),E=v.length,C=0;E>C;)f=v[C++],Vj&&!MX(h,g,f)||(r[f]=g[f]);return r}:e_,HX=hi,KX=Kd,zX=Qe,$X=Qi,YX=_e,xA=function(e,t,r){zX?$X.f(e,t,YX(0,r)):e[t]=r},XX=Dl,JX=ge,QX=Bo,ZX=function(e,t,r,s){try{return s?t(HX(r)[0],r[1]):t(r)}catch(c){KX(e,"throw",c)}},eJ=z0,tJ=Ms,rJ=Ml,Wj=xA,nJ=Hd,sJ=vo,qj=Array,Ef=N,TA=2147483647,iJ=/[^\0-\u007E]/,Gj=/[.\u3002\uFF0E\uFF61]/g,Hj="Overflow: input needs wider integers to process",Kj=RangeError,aJ=Ef(Gj.exec),t_=Math.floor,CA=String.fromCharCode,zj=Ef("".charCodeAt),$j=Ef([].join),bh=Ef([].push),oJ=Ef("".replace),cJ=Ef("".split),lJ=Ef("".toLowerCase),Yj=function(e){return e+22+75*(e<26)},dJ=function(e,t,r){var s=0;for(e=r?t_(e/700):e>>1,e+=t_(e/t);e>455;)e=t_(e/35),s+=36;return t_(s+36*e/(e+38))},uJ=function(e){var t=[];e=(function(X){for(var Y=[],ee=0,ue=X.length;ee<ue;){var de=zj(X,ee++);if(de>=55296&&de<=56319&&ee<ue){var ne=zj(X,ee++);(64512&ne)==56320?bh(Y,((1023&de)<<10)+(1023&ne)+65536):(bh(Y,de),ee--)}else bh(Y,de)}return Y})(e);var r,s,c=e.length,d=128,h=0,f=72;for(r=0;r<e.length;r++)(s=e[r])<128&&bh(t,CA(s));var g=t.length,v=g;for(g&&bh(t,"-");v<c;){var E=TA;for(r=0;r<e.length;r++)(s=e[r])>=d&&s<E&&(E=s);var C=v+1;if(E-d>t_((TA-h)/C))throw new Kj(Hj);for(h+=(E-d)*C,d=E,r=0;r<e.length;r++){if((s=e[r])<d&&++h>TA)throw new Kj(Hj);if(s===d){for(var R=h,A=36;;){var B=A<=f?1:A>=f+26?26:A-f;if(R<B)break;var L=R-B,U=36-B;bh(t,CA(Yj(B+L%U))),R=t_(L/U),A+=36}bh(t,CA(Yj(R))),f=dJ(h,C,v===g),h=0,v++}}h++,d++}return $j(t,"")},hJ=kr,RA=Qe,pJ=$S,NA=F,Xj=Dl,ec=N,ex=$c,tc=zl,fJ=of,AA=us,IA=GX,r_=function(e){var t=QX(e),r=tJ(this),s=arguments.length,c=s>1?arguments[1]:void 0,d=c!==void 0;d&&(c=XX(c,s>2?arguments[2]:void 0));var h,f,g,v,E,C,R=sJ(t),A=0;if(!R||this===qj&&eJ(R))for(h=rJ(t),f=r?new this(h):qj(h);h>A;A++)C=d?c(t[A],A):t[A],Wj(f,A,C);else for(f=r?new this:[],E=(v=nJ(t,R)).next;!(g=JX(E,v)).done;A++)C=d?ZX(v,c,[g.value,A],!0):g.value,Wj(f,A,C);return f.length=A,f},Qc=Ts,mJ=dA.codeAt,gJ=function(e){var t,r,s=[],c=cJ(oJ(lJ(e),Gj,"."),".");for(t=0;t<c.length;t++)r=c[t],bh(s,aJ(iJ,r)?"xn--"+uJ(r):r);return $j(s,".")},ru=Zi,_J=zo,yJ=Fa,Jj=DX,Qj=Kl,vJ=Qj.set,tx=Qj.getterFor("URL"),EJ=Jj.URLSearchParams,wJ=Jj.getState,$v=NA.URL,OA=NA.TypeError,rx=NA.parseInt,bJ=Math.floor,Zj=Math.pow,rc=ec("".charAt),Zc=ec(/./.exec),Yv=ec([].join),SJ=ec(1 .toString),xJ=ec([].pop),n_=ec([].push),kA=ec("".replace),TJ=ec([].shift),CJ=ec("".split),Xv=ec("".slice),nx=ec("".toLowerCase),RJ=ec([].unshift),PA="Invalid scheme",wf="Invalid host",eL="Invalid port",tL=/[a-z]/i,NJ=/[\d+-.a-z]/i,DA=/\d/,AJ=/^0x/i,IJ=/^[0-7]+$/,OJ=/^\d+$/,rL=/^[\da-f]+$/i,kJ=/[\0\t\n\r #%/:<>?@[\\\]^|]/,PJ=/[\0\t\n\r #/:<>?@[\\\]^|]/,DJ=/^[\u0000-\u0020]+/,jJ=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,LJ=/[\t\n\r]/g,Jv=function(e){var t,r,s,c;if(typeof e=="number"){for(t=[],r=0;r<4;r++)RJ(t,e%256),e=bJ(e/256);return Yv(t,".")}if(typeof e=="object"){for(t="",s=(function(d){for(var h=null,f=1,g=null,v=0,E=0;E<8;E++)d[E]!==0?(v>f&&(h=g,f=v),g=null,v=0):(g===null&&(g=E),++v);return v>f?g:h})(e),r=0;r<8;r++)c&&e[r]===0||(c&&(c=!1),s===r?(t+=r?":":"::",c=!0):(t+=SJ(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},sx={},nL=IA({},sx,{" ":1,'"':1,"<":1,">":1,"`":1}),sL=IA({},nL,{"#":1,"?":1,"{":1,"}":1}),jA=IA({},sL,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Sh=function(e,t){var r=mJ(e,0);return r>32&&r<127&&!AA(t,e)?e:encodeURIComponent(e)},ix={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Qv=function(e,t){var r;return e.length===2&&Zc(tL,rc(e,0))&&((r=rc(e,1))===":"||!t&&r==="|")},iL=function(e){var t;return e.length>1&&Qv(Xv(e,0,2))&&(e.length===2||(t=rc(e,2))==="/"||t==="\\"||t==="?"||t==="#")},MJ=function(e){return e==="."||nx(e)==="%2e"},LA={},aL={},MA={},oL={},cL={},UA={},lL={},dL={},ax={},ox={},FA={},VA={},BA={},WA={},uL={},qA={},s_={},sd={},hL={},bf={},nu={},GA=function(e,t,r){var s,c,d,h=ru(e);if(t){if(c=this.parse(h))throw new OA(c);this.searchParams=null}else{if(r!==void 0&&(s=new GA(r,!0)),c=this.parse(h,null,s))throw new OA(c);(d=wJ(new EJ)).bindURL(this),this.searchParams=d}};GA.prototype={type:"URL",parse:function(e,t,r){var s,c,d,h,f,g=this,v=t||LA,E=0,C="",R=!1,A=!1,B=!1;for(e=ru(e),t||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,e=kA(e,DJ,""),e=kA(e,jJ,"$1")),e=kA(e,LJ,""),s=r_(e);E<=s.length;){switch(c=s[E],v){case LA:if(!c||!Zc(tL,c)){if(t)return PA;v=MA;continue}C+=nx(c),v=aL;break;case aL:if(c&&(Zc(NJ,c)||c==="+"||c==="-"||c==="."))C+=nx(c);else{if(c!==":"){if(t)return PA;C="",v=MA,E=0;continue}if(t&&(g.isSpecial()!==AA(ix,C)||C==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=C,t)return void(g.isSpecial()&&ix[g.scheme]===g.port&&(g.port=null));C="",g.scheme==="file"?v=WA:g.isSpecial()&&r&&r.scheme===g.scheme?v=oL:g.isSpecial()?v=dL:s[E+1]==="/"?(v=cL,E++):(g.cannotBeABaseURL=!0,n_(g.path,""),v=hL)}break;case MA:if(!r||r.cannotBeABaseURL&&c!=="#")return PA;if(r.cannotBeABaseURL&&c==="#"){g.scheme=r.scheme,g.path=Qc(r.path),g.query=r.query,g.fragment="",g.cannotBeABaseURL=!0,v=nu;break}v=r.scheme==="file"?WA:UA;continue;case oL:if(c!=="/"||s[E+1]!=="/"){v=UA;continue}v=ax,E++;break;case cL:if(c==="/"){v=ox;break}v=sd;continue;case UA:if(g.scheme=r.scheme,c===Zo)g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Qc(r.path),g.query=r.query;else if(c==="/"||c==="\\"&&g.isSpecial())v=lL;else if(c==="?")g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Qc(r.path),g.query="",v=bf;else{if(c!=="#"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Qc(r.path),g.path.length--,v=sd;continue}g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,g.path=Qc(r.path),g.query=r.query,g.fragment="",v=nu}break;case lL:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=r.username,g.password=r.password,g.host=r.host,g.port=r.port,v=sd;continue}v=ox}else v=ax;break;case dL:if(v=ax,c!=="/"||rc(C,E+1)!=="/")continue;E++;break;case ax:if(c!=="/"&&c!=="\\"){v=ox;continue}break;case ox:if(c==="@"){R&&(C="%40"+C),R=!0,d=r_(C);for(var L=0;L<d.length;L++){var U=d[L];if(U!==":"||B){var X=Sh(U,jA);B?g.password+=X:g.username+=X}else B=!0}C=""}else if(c===Zo||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(R&&C==="")return"Invalid authority";E-=r_(C).length+1,C="",v=FA}else C+=c;break;case FA:case VA:if(t&&g.scheme==="file"){v=qA;continue}if(c!==":"||A){if(c===Zo||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&C==="")return wf;if(t&&C===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(C))return h;if(C="",v=s_,t)return;continue}c==="["?A=!0:c==="]"&&(A=!1),C+=c}else{if(C==="")return wf;if(h=g.parseHost(C))return h;if(C="",v=BA,t===VA)return}break;case BA:if(!Zc(DA,c)){if(c===Zo||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||t){if(C!==""){var Y=rx(C,10);if(Y>65535)return eL;g.port=g.isSpecial()&&Y===ix[g.scheme]?null:Y,C=""}if(t)return;v=s_;continue}return eL}C+=c;break;case WA:if(g.scheme="file",c==="/"||c==="\\")v=uL;else{if(!r||r.scheme!=="file"){v=sd;continue}switch(c){case Zo:g.host=r.host,g.path=Qc(r.path),g.query=r.query;break;case"?":g.host=r.host,g.path=Qc(r.path),g.query="",v=bf;break;case"#":g.host=r.host,g.path=Qc(r.path),g.query=r.query,g.fragment="",v=nu;break;default:iL(Yv(Qc(s,E),""))||(g.host=r.host,g.path=Qc(r.path),g.shortenPath()),v=sd;continue}}break;case uL:if(c==="/"||c==="\\"){v=qA;break}r&&r.scheme==="file"&&!iL(Yv(Qc(s,E),""))&&(Qv(r.path[0],!0)?n_(g.path,r.path[0]):g.host=r.host),v=sd;continue;case qA:if(c===Zo||c==="/"||c==="\\"||c==="?"||c==="#"){if(!t&&Qv(C))v=sd;else if(C===""){if(g.host="",t)return;v=s_}else{if(h=g.parseHost(C))return h;if(g.host==="localhost"&&(g.host=""),t)return;C="",v=s_}continue}C+=c;break;case s_:if(g.isSpecial()){if(v=sd,c!=="/"&&c!=="\\")continue}else if(t||c!=="?")if(t||c!=="#"){if(c!==Zo&&(v=sd,c!=="/"))continue}else g.fragment="",v=nu;else g.query="",v=bf;break;case sd:if(c===Zo||c==="/"||c==="\\"&&g.isSpecial()||!t&&(c==="?"||c==="#")){if((f=nx(f=C))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||n_(g.path,"")):MJ(C)?c==="/"||c==="\\"&&g.isSpecial()||n_(g.path,""):(g.scheme==="file"&&!g.path.length&&Qv(C)&&(g.host&&(g.host=""),C=rc(C,0)+":"),n_(g.path,C)),C="",g.scheme==="file"&&(c===Zo||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)TJ(g.path);c==="?"?(g.query="",v=bf):c==="#"&&(g.fragment="",v=nu)}else C+=Sh(c,sL);break;case hL:c==="?"?(g.query="",v=bf):c==="#"?(g.fragment="",v=nu):c!==Zo&&(g.path[0]+=Sh(c,sx));break;case bf:t||c!=="#"?c!==Zo&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Sh(c,sx)):(g.fragment="",v=nu);break;case nu:c!==Zo&&(g.fragment+=Sh(c,nL))}E++}},parseHost:function(e){var t,r,s;if(rc(e,0)==="["){if(rc(e,e.length-1)!=="]"||(t=(function(c){var d,h,f,g,v,E,C,R=[0,0,0,0,0,0,0,0],A=0,B=null,L=0,U=function(){return rc(c,L)};if(U()===":"){if(rc(c,1)!==":")return;L+=2,B=++A}for(;U();){if(A===8)return;if(U()!==":"){for(d=h=0;h<4&&Zc(rL,U());)d=16*d+rx(U(),16),L++,h++;if(U()==="."){if(h===0||(L-=h,A>6))return;for(f=0;U();){if(g=null,f>0){if(!(U()==="."&&f<4))return;L++}if(!Zc(DA,U()))return;for(;Zc(DA,U());){if(v=rx(U(),10),g===null)g=v;else{if(g===0)return;g=10*g+v}if(g>255)return;L++}R[A]=256*R[A]+g,++f!=2&&f!==4||A++}if(f!==4)return;break}if(U()===":"){if(L++,!U())return}else if(U())return;R[A++]=d}else{if(B!==null)return;L++,B=++A}}if(B!==null)for(E=A-B,A=7;A!==0&&E>0;)C=R[A],R[A--]=R[B+E-1],R[B+--E]=C;else if(A!==8)return;return R})(Xv(e,1,-1)),!t))return wf;this.host=t}else if(this.isSpecial()){if(e=gJ(e),Zc(kJ,e)||(t=(function(c){var d,h,f,g,v,E,C,R=CJ(c,".");if(R.length&&R[R.length-1]===""&&R.length--,(d=R.length)>4)return c;for(h=[],f=0;f<d;f++){if((g=R[f])==="")return c;if(v=10,g.length>1&&rc(g,0)==="0"&&(v=Zc(AJ,g)?16:8,g=Xv(g,v===8?1:2)),g==="")E=0;else{if(!Zc(v===10?OJ:v===8?IJ:rL,g))return c;E=rx(g,v)}n_(h,E)}for(f=0;f<d;f++)if(E=h[f],f===d-1){if(E>=Zj(256,5-d))return null}else if(E>255)return null;for(C=xJ(h),f=0;f<h.length;f++)C+=h[f]*Zj(256,3-f);return C})(e),t===null))return wf;this.host=t}else{if(Zc(PJ,e))return wf;for(t="",r=r_(e),s=0;s<r.length;s++)t+=Sh(r[s],sx);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return AA(ix,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Qv(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,s=e.password,c=e.host,d=e.port,h=e.path,f=e.query,g=e.fragment,v=t+":";return c!==null?(v+="//",e.includesCredentials()&&(v+=r+(s?":"+s:"")+"@"),v+=Jv(c),d!==null&&(v+=":"+d)):t==="file"&&(v+="//"),v+=e.cannotBeABaseURL?h[0]:h.length?"/"+Yv(h,"/"):"",f!==null&&(v+="?"+f),g!==null&&(v+="#"+g),v},setHref:function(e){var t=this.parse(e);if(t)throw new OA(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new i_(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+Jv(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ru(e)+":",LA)},getUsername:function(){return this.username},setUsername:function(e){var t=r_(ru(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Sh(t[r],jA)}},getPassword:function(){return this.password},setPassword:function(e){var t=r_(ru(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Sh(t[r],jA)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?Jv(e):Jv(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,FA)},getHostname:function(){var e=this.host;return e===null?"":Jv(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,VA)},getPort:function(){var e=this.port;return e===null?"":ru(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ru(e))===""?this.port=null:this.parse(e,BA))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Yv(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,s_))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ru(e))===""?this.query=null:(rc(e,0)==="?"&&(e=Xv(e,1)),this.query="",this.parse(e,bf)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ru(e))!==""?(rc(e,0)==="#"&&(e=Xv(e,1)),this.fragment="",this.parse(e,nu)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var i_=function(e){var t=fJ(this,Ca),r=yJ(arguments.length,1)>1?arguments[1]:void 0,s=vJ(t,new GA(e,!1,r));RA||(t.href=s.serialize(),t.origin=s.getOrigin(),t.protocol=s.getProtocol(),t.username=s.getUsername(),t.password=s.getPassword(),t.host=s.getHost(),t.hostname=s.getHostname(),t.port=s.getPort(),t.pathname=s.getPathname(),t.search=s.getSearch(),t.searchParams=s.getSearchParams(),t.hash=s.getHash())},Ca=i_.prototype,nc=function(e,t){return{get:function(){return tx(this)[e]()},set:t&&function(r){return tx(this)[t](r)},configurable:!0,enumerable:!0}};if(RA&&(tc(Ca,"href",nc("serialize","setHref")),tc(Ca,"origin",nc("getOrigin")),tc(Ca,"protocol",nc("getProtocol","setProtocol")),tc(Ca,"username",nc("getUsername","setUsername")),tc(Ca,"password",nc("getPassword","setPassword")),tc(Ca,"host",nc("getHost","setHost")),tc(Ca,"hostname",nc("getHostname","setHostname")),tc(Ca,"port",nc("getPort","setPort")),tc(Ca,"pathname",nc("getPathname","setPathname")),tc(Ca,"search",nc("getSearch","setSearch")),tc(Ca,"searchParams",nc("getSearchParams")),tc(Ca,"hash",nc("getHash","setHash"))),ex(Ca,"toJSON",(function(){return tx(this).serialize()}),{enumerable:!0}),ex(Ca,"toString",(function(){return tx(this).serialize()}),{enumerable:!0}),$v){var pL=$v.createObjectURL,fL=$v.revokeObjectURL;pL&&ex(i_,"createObjectURL",Xj(pL,$v)),fL&&ex(i_,"revokeObjectURL",Xj(fL,$v))}_J(i_,"URL"),hJ({global:!0,forced:!pJ,sham:!RA},{URL:i_});var UJ=kr,mL=m,FJ=Fa,gL=Zi,VJ=$S,HA=Sr("URL"),BJ=VJ&&mL((function(){HA.canParse()})),WJ=mL((function(){return HA.canParse.length!==1}));UJ({target:"URL",stat:!0,forced:!BJ||WJ},{canParse:function(e){var t=FJ(arguments.length,1),r=gL(e),s=t<2||arguments[1]===void 0?void 0:gL(arguments[1]);try{return!!new HA(r,s)}catch{return!1}}});var qJ=kr,GJ=Fa,_L=Zi,HJ=$S,KJ=Sr("URL");qJ({target:"URL",stat:!0,forced:!HJ},{parse:function(e){var t=GJ(arguments.length,1),r=_L(e),s=t<2||arguments[1]===void 0?void 0:_L(arguments[1]);try{return new KJ(r,s)}catch{return null}}});var cx=u(xt.URL);let yL=!0,vL=!0;function lx(e,t,r){const s=e.match(t);return s&&s.length>=r&&parseInt(s[r],10)}function Sf(e,t,r){if(!e.RTCPeerConnection)return;const s=e.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,f){if(h!==t)return c.apply(this,arguments);const g=v=>{const E=r(v);E&&(f.handleEvent?f.handleEvent(E):f(E))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,g),c.apply(this,[h,g])};const d=s.removeEventListener;s.removeEventListener=function(h,f){if(h!==t||!this._eventMap||!this._eventMap[t])return d.apply(this,arguments);if(!this._eventMap[t].has(f))return d.apply(this,arguments);const g=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,g])},Object.defineProperty(s,"on"+t,{get(){return this["_on"+t]},set(h){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),h&&this.addEventListener(t,this["_on"+t]=h)},enumerable:!0,configurable:!0})}function zJ(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(yL=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function $J(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(vL=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function EL(){if(typeof window=="object"){if(yL)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function KA(e,t){vL&&console.warn(e+" is deprecated, please use "+t+" instead.")}function wL(e){return Object.prototype.toString.call(e)==="[object Object]"}function bL(e){var t;return wL(e)?ea(t=Object.keys(e)).call(t,(function(r,s){const c=wL(e[s]),d=c?bL(e[s]):e[s],h=c&&!Object.keys(d).length;return d===void 0||h?r:Object.assign(r,{[s]:d})}),{}):e}function zA(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((s=>{s.endsWith("Id")?zA(e,e.get(t[s]),r):s.endsWith("Ids")&&t[s].forEach((c=>{zA(e,e.get(c),r)}))})))}function SL(e,t,r){const s=r?"outbound-rtp":"inbound-rtp",c=new Map;if(t===null)return c;const d=[];return e.forEach((h=>{h.type==="track"&&h.trackIdentifier===t.id&&d.push(h)})),d.forEach((h=>{e.forEach((f=>{f.type===s&&f.trackId===h.id&&zA(e,f,c)}))})),c}const xL=EL;function TL(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const s=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const f={};return Object.keys(h).forEach((g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const v=typeof h[g]=="object"?h[g]:{ideal:h[g]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const E=function(C,R){return C?C+R.charAt(0).toUpperCase()+R.slice(1):R==="deviceId"?"sourceId":R};if(v.ideal!==void 0){f.optional=f.optional||[];let C={};typeof v.ideal=="number"?(C[E("min",g)]=v.ideal,f.optional.push(C),C={},C[E("max",g)]=v.ideal,f.optional.push(C)):(C[E("",g)]=v.ideal,f.optional.push(C))}v.exact!==void 0&&typeof v.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[E("",g)]=v.exact):["min","max"].forEach((C=>{v[C]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[E(C,g)]=v[C])}))})),h.advanced&&(f.optional=(f.optional||[]).concat(h.advanced)),f},c=function(h,f){if(t.version>=61)return f(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(v,E,C){E in v&&!(C in v)&&(v[C]=v[E],delete v[E])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const v=t.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||v)){let E;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?E=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(E=["front"]),E)return r.mediaDevices.enumerateDevices().then((C=>{C=C.filter((A=>A.kind==="videoinput"));let R=C.find((A=>E.some((B=>{var L;return $e(L=A.label.toLowerCase()).call(L,B)}))));return!R&&C.length&&$e(E).call(E,"back")&&(R=C[C.length-1]),R&&(h.video.deviceId=g.exact?{exact:R.deviceId}:{ideal:R.deviceId}),h.video=s(h.video),xL("chrome: "+JSON.stringify(h)),f(h)}))}h.video=s(h.video)}return xL("chrome: "+JSON.stringify(h)),f(h)},d=function(h){return t.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(h,f,g){c(h,(v=>{r.webkitGetUserMedia(v,f,(E=>{g&&g(d(E))}))}))}).bind(r),r.mediaDevices.getUserMedia){const h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(f){return c(f,(g=>h(g).then((v=>{if(g.audio&&!v.getAudioTracks().length||g.video&&!v.getVideoTracks().length)throw v.getTracks().forEach((E=>{E.stop()})),new DOMException("","NotFoundError");return v}),(v=>nt.reject(d(v))))))}}}function CL(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function RL(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",(s=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===s.track.id)):{track:s.track};const d=new Event("track");d.track=s.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)})),r.stream.getTracks().forEach((s=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===s.id)):{track:s};const d=new Event("track");d.track=s,d.receiver=c,d.transceiver={receiver:c},d.streams=[r.stream],this.dispatchEvent(d)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Sf(e,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function NL(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,f){let g=c.apply(this,arguments);return g||(g=t(this,h),this._senders.push(g)),g};const d=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const f=this._senders.indexOf(h);f!==-1&&this._senders.splice(f,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],r.apply(this,[c]),c.getTracks().forEach((d=>{this._senders.push(t(this,d))}))};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach((d=>{const h=this._senders.find((f=>f.track===d));h&&this._senders.splice(this._senders.indexOf(h),1)}))}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach((s=>s._pc=this)),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function AL(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);const d=function(f){const g={};return f.result().forEach((v=>{const E={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach((C=>{E[C]=v.stat(C)})),g[E.id]=E})),g},h=function(f){return new Map(Object.keys(f).map((g=>[g,f[g]])))};if(arguments.length>=2){const f=function(g){s(h(d(g)))};return t.apply(this,[f,r])}return new nt(((f,g)=>{t.apply(this,[function(v){f(h(d(v)))},g])})).then(s,c)}}function IL(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=r.apply(this,[]);return c.forEach((d=>d._pc=this)),c});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then((d=>SL(d,c.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach((c=>c._pc=this)),s}),Sf(e,"track",(s=>(s.receiver._pc=s.srcElement,s))),e.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then((c=>SL(c,s.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const r=arguments[0];let s,c,d;return this.getSenders().forEach((h=>{h.track===r&&(s?d=!0:s=h)})),this.getReceivers().forEach((h=>(h.track===r&&(c?d=!0:c=h),h.track===r))),d||s&&c?nt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():nt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function OL(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((d=>this._shimmedLocalStreams[d][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const f=t.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(f)===-1&&this._shimmedLocalStreams[h.id].push(f):this._shimmedLocalStreams[h.id]=[h,f],f};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach((g=>{if(this.getSenders().find((E=>E.track===g)))throw new DOMException("Track already exists.","InvalidAccessError")}));const h=this.getSenders();r.apply(this,arguments);const f=this.getSenders().filter((g=>h.indexOf(g)===-1));this._shimmedLocalStreams[d.id]=[d].concat(f)};const s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach((h=>{const f=this._shimmedLocalStreams[h].indexOf(d);f!==-1&&this._shimmedLocalStreams[h].splice(f,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]})),c.apply(this,arguments)}}function kL(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return OL(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const g=r.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map((v=>this._reverseStreams[v.id]))};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach((v=>{if(this.getSenders().find((C=>C.track===v)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[g.id]){const v=new e.MediaStream(g.getTracks());this._streams[g.id]=v,this._reverseStreams[v.id]=g,g=v}s.apply(this,[g])};const c=e.RTCPeerConnection.prototype.removeStream;function d(g,v){let E=v.sdp;return Object.keys(g._reverseStreams||[]).forEach((C=>{const R=g._reverseStreams[C],A=g._streams[R.id];E=E.replace(new RegExp(A.id,"g"),R.id)})),new RTCSessionDescription({type:v.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},e.RTCPeerConnection.prototype.addTrack=function(g,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find((A=>A===g)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((A=>A.track===g)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[v.id];if(R)R.addTrack(g),nt.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const A=new e.MediaStream([g]);this._streams[v.id]=A,this._reverseStreams[A.id]=v,this.addStream(A)}return this.getSenders().find((A=>A.track===g))},["createOffer","createAnswer"].forEach((function(g){const v=e.RTCPeerConnection.prototype[g],E={[g](){const C=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[R=>{const A=d(this,R);C[0].apply(null,[A])},R=>{C[1]&&C[1].apply(null,R)},arguments[2]]):v.apply(this,arguments).then((R=>d(this,R)))}};e.RTCPeerConnection.prototype[g]=E[g]}));const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(g,v){let E=v.sdp;return Object.keys(g._reverseStreams||[]).forEach((C=>{const R=g._reverseStreams[C],A=g._streams[R.id];E=E.replace(new RegExp(R.id,"g"),A.id)})),new RTCSessionDescription({type:v.type,sdp:E})})(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const g=f.get.apply(this);return g.type===""?g:d(this,g)}}),e.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach((E=>{this._streams[E].getTracks().find((C=>g.track===C))&&(v=this._streams[E])})),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function $A(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(r){const s=e.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=c[r]}))}function PL(e,t){Sf(e,"negotiationneeded",(r=>{const s=r.target;if(!(t.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")||s.signalingState==="stable")return r}))}var DL=Object.freeze({__proto__:null,fixNegotiationNeeded:PL,shimAddTrackRemoveTrack:kL,shimAddTrackRemoveTrackWithNative:OL,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((s=>{const c=r.video&&r.video.width,d=r.video&&r.video.height,h=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:h||3}},c&&(r.video.mandatory.maxWidth=c),d&&(r.video.mandatory.maxHeight=d),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:NL,shimGetStats:AL,shimGetUserMedia:TL,shimMediaStream:CL,shimOnTrack:RL,shimPeerConnection:$A,shimSenderReceiverGetStats:IL});function jL(e,t){const r=e&&e.navigator,s=e&&e.MediaStreamTrack;if(r.getUserMedia=function(c,d,h){KA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(c).then(d,h)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const c=function(h,f,g){f in h&&!(g in h)&&(h[g]=h[f],delete h[f])},d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const f=h.apply(this,arguments);return c(f,"mozAutoGainControl","autoGainControl"),c(f,"mozNoiseSuppression","noiseSuppression"),f}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),c(f,"autoGainControl","mozAutoGainControl"),c(f,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[f])}}}}function LL(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function YA(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(c){const d=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return s.apply(this,[c||null]).then((f=>{if(t.version<53&&!d)try{f.forEach((g=>{g.type=r[g.type]||g.type}))}catch(g){if(g.name!=="TypeError")throw g;f.forEach(((v,E)=>{f.set(E,Object.assign({},v,{type:r[v.type]||v.type}))}))}return f})).then(d,h)}}function ML(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach((c=>c._pc=this)),s});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):nt.resolve(new Map)}}function UL(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=t.apply(this,[]);return r.forEach((s=>s._pc=this)),r}),Sf(e,"track",(r=>(r.receiver._pc=r.srcElement,r))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function FL(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){KA("removeStream","removeTrack"),this.getSenders().forEach((r=>{var s;r.track&&$e(s=t.getTracks()).call(s,r.track)&&this.removeTrack(r)}))})}function VL(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function BL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach((d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const c=t.apply(this,arguments);if(s){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=r,d.sendEncodings=r,this.setParametersPromises.push(d.setParameters(h).then((()=>{delete d.sendEncodings})).catch((()=>{delete d.sendEncodings}))))}return c})}function WL(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function qL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?nt.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function GL(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?nt.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var HL=Object.freeze({__proto__:null,shimAddTransceiver:BL,shimCreateAnswer:GL,shimCreateOffer:qL,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,nt.reject(s)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:WL,shimGetUserMedia:jL,shimOnTrack:LL,shimPeerConnection:YA,shimRTCDataChannel:VL,shimReceiverGetStats:UL,shimRemoveStream:FL,shimSenderGetStats:ML});function KL(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var s;this._localStreams||(this._localStreams=[]),$e(s=this._localStreams).call(s,r)||this._localStreams.push(r),r.getAudioTracks().forEach((c=>t.call(this,c,r))),r.getVideoTracks().forEach((c=>t.call(this,c,r)))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];return c&&c.forEach((h=>{var f;this._localStreams?$e(f=this._localStreams).call(f,h)||this._localStreams.push(h):this._localStreams=[h]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const s=t.getTracks();this.getSenders().forEach((c=>{$e(s).call(s,c.track)&&this.removeTrack(c)}))})}}function zL(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach((c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),$e(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach((c=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(c)>=0)return;r._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,r.dispatchEvent(d)}))}),t.apply(r,arguments)}}}function $L(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,s=t.createAnswer,c=t.setLocalDescription,d=t.setRemoteDescription,h=t.addIceCandidate;t.createOffer=function(g,v){const E=arguments.length>=2?arguments[2]:arguments[0],C=r.apply(this,[E]);return v?(C.then(g,v),nt.resolve()):C},t.createAnswer=function(g,v){const E=arguments.length>=2?arguments[2]:arguments[0],C=s.apply(this,[E]);return v?(C.then(g,v),nt.resolve()):C};let f=function(g,v,E){const C=c.apply(this,[g]);return E?(C.then(v,E),nt.resolve()):C};t.setLocalDescription=f,f=function(g,v,E){const C=d.apply(this,[g]);return E?(C.then(v,E),nt.resolve()):C},t.setRemoteDescription=f,f=function(g,v,E){const C=h.apply(this,[g]);return E?(C.then(v,E),nt.resolve()):C},t.addIceCandidate=f}function YL(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const r=t.mediaDevices,s=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=c=>s(XL(c))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,s,c){t.mediaDevices.getUserMedia(r).then(s,c)}).bind(t))}function XL(e){return e&&e.video!==void 0?Object.assign({},e,{video:bL(e.video)}):e}function JL(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const c=[];for(let d=0;d<r.iceServers.length;d++){let h=r.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(KA("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(r.iceServers[d])}r.iceServers=c}return new t(r,s)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function QL(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ZL(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find((d=>d.receiver.track.kind==="audio"));r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio!==!0||s||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const c=this.getTransceivers().find((d=>d.receiver.track.kind==="video"));r.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):r.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function eM(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var tM=Object.freeze({__proto__:null,shimAudioContext:eM,shimCallbacksAPI:$L,shimConstraints:XL,shimCreateOfferLegacy:ZL,shimGetUserMedia:YL,shimLocalStreamsAPI:KL,shimRTCIceServerUrls:JL,shimRemoteStreamsAPI:zL,shimTrackEventTransceiver:QL}),rM=`	
\v\f\r \u2028\u2029\uFEFF`,YJ=en,XJ=Zi,XA=rM,nM=N("".replace),JJ=RegExp("^["+XA+"]+"),QJ=RegExp("(^|[^"+XA+"])["+XA+"]+$"),ZJ=function(e){return function(t){var r=XJ(YJ(t));return 1&e&&(r=nM(r,JJ,"")),2&e&&(r=nM(r,QJ,"$1")),r}},eQ={trim:ZJ(3)},tQ=Rg.PROPER,rQ=m,sM=rM,nQ=eQ.trim;kr({target:"String",proto:!0,forced:(function(e){return rQ((function(){return!!sM[e]()||""[e]()!==""||tQ&&sM[e].name!==e}))})("trim")},{trim:function(){return nQ(this)}});var sQ=ya("String","trim"),iQ=O,aQ=sQ,JA=String.prototype,oQ=function(e){var t=e.trim;return typeof e=="string"||e===JA||iQ(JA,e)&&t===JA.trim?aQ:t},gi=u(oQ),iM={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map((s=>s.trim()))},t.splitSections=function(r){return r.split(`
m=`).map(((s,c)=>(c>0?"m="+s:s).trim()+`\r
`))},t.getDescription=function(r){const s=t.splitSections(r);return s&&s[0]},t.getMediaSections=function(r){const s=t.splitSections(r);return s.shift(),s},t.matchPrefix=function(r,s){return t.splitLines(r).filter((c=>c.indexOf(s)===0))},t.parseCandidate=function(r){let s;s=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let d=8;d<s.length;d+=2)switch(s[d]){case"raddr":c.relatedAddress=s[d+1];break;case"rport":c.relatedPort=parseInt(s[d+1],10);break;case"tcptype":c.tcpType=s[d+1];break;case"ufrag":c.ufrag=s[d+1],c.usernameFragment=s[d+1];break;default:c[s[d]]===void 0&&(c[s[d]]=s[d+1])}return c},t.writeCandidate=function(r){const s=[];s.push(r.foundation);const c=r.component;c==="rtp"?s.push(1):c==="rtcp"?s.push(2):s.push(c),s.push(r.protocol.toUpperCase()),s.push(r.priority),s.push(r.address||r.ip),s.push(r.port);const d=r.type;return s.push("typ"),s.push(d),d!=="host"&&r.relatedAddress&&r.relatedPort&&(s.push("raddr"),s.push(r.relatedAddress),s.push("rport"),s.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(s.push("ufrag"),s.push(r.usernameFragment||r.ufrag)),"candidate:"+s.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let s=r.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=s.length===3?parseInt(s[2],10):1,c.numChannels=c.channels,c},t.writeRtpMap=function(r){let s=r.payloadType;r.preferredPayloadType!==void 0&&(s=r.preferredPayloadType);const c=r.channels||r.numChannels||1;return"a=rtpmap:"+s+" "+r.name+"/"+r.clockRate+(c!==1?"/"+c:"")+`\r
`},t.parseExtmap=function(r){const s=r.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){const s={};let c;const d=r.substring(r.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),s[c[0].trim()]=c[1];return s},t.writeFmtp=function(r){let s="",c=r.payloadType;if(r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const d=[];Object.keys(r.parameters).forEach((h=>{r.parameters[h]!==void 0?d.push(h+"="+r.parameters[h]):d.push(h)})),s+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return s},t.parseRtcpFb=function(r){const s=r.substring(r.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},t.writeRtcpFb=function(r){let s="",c=r.payloadType;return r.preferredPayloadType!==void 0&&(c=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach((d=>{s+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`})),s},t.parseSsrcMedia=function(r){const s=r.indexOf(" "),c={ssrc:parseInt(r.substring(7,s),10)},d=r.indexOf(":",s);return d>-1?(c.attribute=r.substring(s+1,d),c.value=r.substring(d+1)):c.attribute=r.substring(s+1),c},t.parseSsrcGroup=function(r){const s=r.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map((c=>parseInt(c,10)))}},t.getMid=function(r){const s=t.matchPrefix(r,"a=mid:")[0];if(s)return s.substring(6)},t.parseFingerprint=function(r){const s=r.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},t.getDtlsParameters=function(r,s){return{role:"auto",fingerprints:t.matchPrefix(r+s,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,s){let c="a=setup:"+s+`\r
`;return r.fingerprints.forEach((d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`})),c},t.parseCryptoLine=function(r){const s=r.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const s=r.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,s){return t.matchPrefix(r+s,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,s){const c=t.matchPrefix(r+s,"a=ice-ufrag:")[0],d=t.matchPrefix(r+s,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},t.writeIceParameters=function(r){let s="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(s+=`a=ice-lite\r
`),s},t.parseRtpParameters=function(r){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=t.splitLines(r)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const f=c[h],g=t.matchPrefix(r,"a=rtpmap:"+f+" ")[0];if(g){const v=t.parseRtpMap(g),E=t.matchPrefix(r,"a=fmtp:"+f+" ");switch(v.parameters=E.length?t.parseFmtp(E[0]):{},v.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),s.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(v.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach((h=>{s.headerExtensions.push(t.parseExtmap(h))}));const d=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return s.codecs.forEach((h=>{d.forEach((f=>{h.rtcpFeedback.find((g=>g.type===f.type&&g.parameter===f.parameter))||h.rtcpFeedback.push(f)}))})),s},t.writeRtpDescription=function(r,s){let c="";c+="m="+r+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map((h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType)).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach((h=>{c+=t.writeRtpMap(h),c+=t.writeFmtp(h),c+=t.writeRtcpFb(h)}));let d=0;return s.codecs.forEach((h=>{h.maxptime>d&&(d=h.maxptime)})),d>0&&(c+="a=maxptime:"+d+`\r
`),s.headerExtensions&&s.headerExtensions.forEach((h=>{c+=t.writeExtmap(h)})),c},t.parseRtpEncodingParameters=function(r){const s=[],c=t.parseRtpParameters(r),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,f=t.matchPrefix(r,"a=ssrc:").map((R=>t.parseSsrcMedia(R))).filter((R=>R.attribute==="cname")),g=f.length>0&&f[0].ssrc;let v;const E=t.matchPrefix(r,"a=ssrc-group:FID").map((R=>R.substring(17).split(" ").map((A=>parseInt(A,10)))));E.length>0&&E[0].length>1&&E[0][0]===g&&(v=E[0][1]),c.codecs.forEach((R=>{if(R.name.toUpperCase()==="RTX"&&R.parameters.apt){let A={ssrc:g,codecPayloadType:parseInt(R.parameters.apt,10)};g&&v&&(A.rtx={ssrc:v}),s.push(A),d&&(A=JSON.parse(JSON.stringify(A)),A.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},s.push(A))}})),s.length===0&&g&&s.push({ssrc:g});let C=t.matchPrefix(r,"b=");return C.length&&(C=C[0].indexOf("b=TIAS:")===0?parseInt(C[0].substring(7),10):C[0].indexOf("b=AS:")===0?1e3*parseInt(C[0].substring(5),10)*.95-16e3:void 0,s.forEach((R=>{R.maxBitrate=C}))),s},t.parseRtcpParameters=function(r){const s={},c=t.matchPrefix(r,"a=ssrc:").map((f=>t.parseSsrcMedia(f))).filter((f=>f.attribute==="cname"))[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const d=t.matchPrefix(r,"a=rtcp-rsize");s.reducedSize=d.length>0,s.compound=d.length===0;const h=t.matchPrefix(r,"a=rtcp-mux");return s.mux=h.length>0,s},t.writeRtcpParameters=function(r){let s="";return r.reducedSize&&(s+=`a=rtcp-rsize\r
`),r.mux&&(s+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(s+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),s},t.parseMsid=function(r){let s;const c=t.matchPrefix(r,"a=msid:");if(c.length===1)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const d=t.matchPrefix(r,"a=ssrc:").map((h=>t.parseSsrcMedia(h))).filter((h=>h.attribute==="msid"));return d.length>0?(s=d[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},t.parseSctpDescription=function(r){const s=t.parseMLine(r),c=t.matchPrefix(r,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=t.matchPrefix(r,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:d};const f=t.matchPrefix(r,"a=sctpmap:");if(f.length>0){const g=f[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},t.writeSctpDescription=function(r,s){let c=[];return c=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&c.push("a=max-message-size:"+s.maxMessageSize+`\r
`),c.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,s,c){let d;const h=s!==void 0?s:2;return d=r||t.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,s){const c=t.splitLines(r);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return s?t.getDirection(s):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){const s=t.splitLines(r)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},t.parseOLine=function(r){const s=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const s=t.splitLines(r);for(let c=0;c<s.length;c++)if(s[c].length<2||s[c].charAt(1)!=="=")return!1;return!0},e.exports=t})(iM);var aM=iM.exports,a_=u(aM),cQ=a({__proto__:null,default:a_},[aM]);function dx(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){const s=new t(r),c=a_.parseCandidate(r.candidate),d=Object.assign(s,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,Sf(e,"icecandidate",(r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r)))}function QA(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Sf(e,"icecandidate",(t=>{if(t.candidate){const r=a_.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t}))}function ux(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const r=function(f){if(!f||!f.sdp)return!1;const g=a_.splitSections(f.sdp);return g.shift(),g.some((v=>{const E=a_.parseMLine(v);return E&&E.kind==="application"&&E.protocol.indexOf("SCTP")!==-1}))},s=function(f){const g=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const v=parseInt(g[1],10);return v!=v?-1:v},c=function(f){let g=65536;return t.browser==="firefox"&&(g=t.version<57?f===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),g},d=function(f,g){let v=65536;t.browser==="firefox"&&t.version===57&&(v=65535);const E=a_.matchPrefix(f.sdp,"a=max-message-size:");return E.length>0?v=parseInt(E[0].substr(19),10):t.browser==="firefox"&&g!==-1&&(v=2147483637),v},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const f=s(arguments[0]),g=c(f),v=d(arguments[0],f);let E;E=g===0&&v===0?Number.POSITIVE_INFINITY:g===0||v===0?Math.max(g,v):Math.min(g,v);const C={};Object.defineProperty(C,"maxMessageSize",{get:()=>E}),this._sctp=C}return h.apply(this,arguments)}}function hx(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(s,c){const d=s.send;s.send=function(){const h=arguments[0],f=h.length||h.size||h.byteLength;if(s.readyState==="open"&&c.sctp&&f>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const s=r.apply(this,arguments);return t(s,this),s},Sf(e,"datachannel",(s=>(t(s.channel,s.target),s)))}function ZA(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((r=>{const s=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}}))}function eI(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=s.sdp.split(`
`).filter((d=>gi(d).call(d)!=="a=extmap-allow-mixed")).join(`
`);e.RTCSessionDescription&&s instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return r.apply(this,arguments)}}function px(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?nt.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),nt.resolve())})}function fx(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return r.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||s.type!=="offer"&&s.type!=="answer"?r.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((c=>r.apply(this,[c])))})}var lQ=Object.freeze({__proto__:null,removeExtmapAllowMixed:eI,shimAddIceCandidateNullOrEmpty:px,shimConnectionState:ZA,shimMaxMessageSize:ux,shimParameterlessSetLocalDescription:fx,shimRTCIceCandidate:dx,shimRTCIceCandidateRelayProtocol:QA,shimSendThrowTypeError:hx});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const r=EL,s=(function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:f}=d;if(f.mozGetUserMedia)h.browser="firefox",h.version=lx(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=lx(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=lx(f.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h})(e),c={browserDetails:s,commonShim:lQ,extractVersion:lx,disableLog:zJ,disableWarnings:$J,sdp:cQ};switch(s.browser){case"chrome":if(!DL||!$A||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(s.version===null)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=DL,px(e,s),fx(e),TL(e,s),CL(e),$A(e,s),RL(e),kL(e,s),NL(e),AL(e),IL(e),PL(e,s),dx(e),QA(e),ZA(e),ux(e,s),hx(e),eI(e,s);break;case"firefox":if(!HL||!YA||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=HL,px(e,s),fx(e),jL(e,s),YA(e,s),LL(e),FL(e),ML(e),UL(e),VL(e),BL(e),WL(e),qL(e),GL(e),dx(e),ZA(e),ux(e,s),hx(e);break;case"safari":if(!tM||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=tM,px(e,s),fx(e),JL(e),ZL(e),$L(e),KL(e),zL(e),QL(e),YL(e),eM(e),dx(e),QA(e),ux(e,s),hx(e),eI(e,s);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var tI=F;kr({global:!0,forced:tI.globalThis!==tI},{globalThis:tI});var oM=u(F),rI={exports:{}};(function(e,t){(function(r,s){var c="function",d="undefined",h="object",f="string",g="major",v="model",E="name",C="type",R="vendor",A="version",B="architecture",L="console",U="mobile",X="tablet",Y="smarttv",ee="wearable",ue="embedded",de="Amazon",ne="Apple",be="ASUS",Ae="BlackBerry",Ue="Browser",He="Chrome",Yt="Firefox",Qt="Google",Lt="Huawei",Ir="LG",xr="Microsoft",ti="Motorola",Me="Opera",Xe="Samsung",lt="Sharp",Ve="Sony",D="Xiaomi",re="Zebra",le="Facebook",ze="Chromium OS",Gt="Mac OS",Xr=" Browser",Qn=function($n){for(var Zn={},nn=0;nn<$n.length;nn++)Zn[$n[nn].toUpperCase()]=$n[nn];return Zn},Po=function($n,Zn){return typeof $n===f&&_c(Zn).indexOf(_c($n))!==-1},_c=function($n){return $n.toLowerCase()},rw=function($n,Zn){if(typeof $n===f)return $n=$n.replace(/^\s\s*/,""),typeof Zn===d?$n:$n.substring(0,500)},Jf=function($n,Zn){for(var nn,ua,ml,Dn,_u,gr,gl=0;gl<Zn.length&&!_u;){var Qf=Zn[gl],wd=Zn[gl+1];for(nn=ua=0;nn<Qf.length&&!_u&&Qf[nn];)if(_u=Qf[nn++].exec($n))for(ml=0;ml<wd.length;ml++)gr=_u[++ua],typeof(Dn=wd[ml])===h&&Dn.length>0?Dn.length===2?typeof Dn[1]==c?this[Dn[0]]=Dn[1].call(this,gr):this[Dn[0]]=Dn[1]:Dn.length===3?typeof Dn[1]!==c||Dn[1].exec&&Dn[1].test?this[Dn[0]]=gr?gr.replace(Dn[1],Dn[2]):s:this[Dn[0]]=gr?Dn[1].call(this,gr,Dn[2]):s:Dn.length===4&&(this[Dn[0]]=gr?Dn[3].call(this,gr.replace(Dn[1],Dn[2])):s):this[Dn]=gr||s;gl+=2}},Z_=function($n,Zn){for(var nn in Zn)if(typeof Zn[nn]===h&&Zn[nn].length>0){for(var ua=0;ua<Zn[nn].length;ua++)if(Po(Zn[nn][ua],$n))return nn==="?"?s:nn}else if(Po(Zn[nn],$n))return nn==="?"?s:nn;return Zn.hasOwnProperty("*")?Zn["*"]:$n},fC={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},mC={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,A],[/opios[\/ ]+([\w\.]+)/i],[A,[E,Me+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[A,[E,Me+" GX"]],[/\bopr\/([\w\.]+)/i],[A,[E,Me]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[A,[E,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[A,[E,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[E,A],[/quark(?:pc)?\/([-\w\.]+)/i],[A,[E,"Quark"]],[/\bddg\/([\w\.]+)/i],[A,[E,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[E,"UC"+Ue]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[A,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[E,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[A,[E,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[A,[E,"Smart Lenovo "+Ue]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+Ue],A],[/\bfocus\/([\w\.]+)/i],[A,[E,Yt+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[E,Me+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[E,Me+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[E,"MIUI"+Xr]],[/fxios\/([\w\.-]+)/i],[A,[E,Yt]],[/\bqihoobrowser\/?([\w\.]*)/i],[A,[E,"360"]],[/\b(qq)\/([\w\.]+)/i],[[E,/(.+)/,"$1Browser"],A],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1"+Xr],A],[/samsungbrowser\/([\w\.]+)/i],[A,[E,Xe+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[A,[E,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[E,"Sogou Mobile"],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[E,A],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[E],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[A,E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,le],A],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[E,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[E,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[A,[E,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[E,He+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,He+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[E,"Android "+Ue]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[A,Z_,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],A],[/(wolvic|librewolf)\/([\w\.]+)/i],[E,A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[E,Yt+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[E,[A,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[E,[A,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[B,"amd64"]],[/(ia32(?=;))/i],[[B,_c]],[/((?:i[346]|x)86)[;\)]/i],[[B,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[B,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[B,"armhf"]],[/windows (ce|mobile); ppc;/i],[[B,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[B,/ower/,"",_c]],[/(sun4\w)[;\)]/i],[[B,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[B,_c]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[R,Xe],[C,X]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[v,[R,Xe],[C,U]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[v,[R,ne],[C,U]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[R,ne],[C,X]],[/(macintosh);/i],[v,[R,ne]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[R,lt],[C,U]],[/(?:honor)([-\w ]+)[;\)]/i],[v,[R,"Honor"],[C,U]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[R,Lt],[C,X]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[R,Lt],[C,U]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[v,/_/g," "],[R,D],[C,U]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[R,D],[C,X]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[R,"OPPO"],[C,U]],[/\b(opd2\d{3}a?) bui/i],[v,[R,"OPPO"],[C,X]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[R,"Vivo"],[C,U]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[v,[R,"Realme"],[C,U]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[R,ti],[C,U]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[R,ti],[C,X]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[R,Ir],[C,X]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[R,Ir],[C,U]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[R,"Lenovo"],[C,X]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[R,"Nokia"],[C,U]],[/(pixel c)\b/i],[v,[R,Qt],[C,X]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[R,Qt],[C,U]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[R,Ve],[C,U]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[R,Ve],[C,X]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[R,"OnePlus"],[C,U]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[R,de],[C,X]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[R,de],[C,U]],[/(playbook);[-\w\),; ]+(rim)/i],[v,R,[C,X]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[R,Ae],[C,U]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[R,be],[C,X]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[R,be],[C,U]],[/(nexus 9)/i],[v,[R,"HTC"],[C,X]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[R,[v,/_/g," "],[C,U]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[v,[R,"TCL"],[C,X]],[/(itel) ((\w+))/i],[[R,_c],v,[C,Z_,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[R,"Acer"],[C,X]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[R,"Meizu"],[C,U]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[v,[R,"Ulefone"],[C,U]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[v,[R,"Energizer"],[C,U]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[v,[R,"Cat"],[C,U]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[v,[R,"Smartfren"],[C,U]],[/droid.+; (a(?:015|06[35]|142p?))/i],[v,[R,"Nothing"],[C,U]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[R,v,[C,U]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[R,v,[C,X]],[/(surface duo)/i],[v,[R,xr],[C,X]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[R,"Fairphone"],[C,U]],[/(u304aa)/i],[v,[R,"AT&T"],[C,U]],[/\bsie-(\w*)/i],[v,[R,"Siemens"],[C,U]],[/\b(rct\w+) b/i],[v,[R,"RCA"],[C,X]],[/\b(venue[\d ]{2,7}) b/i],[v,[R,"Dell"],[C,X]],[/\b(q(?:mv|ta)\w+) b/i],[v,[R,"Verizon"],[C,X]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[R,"Barnes & Noble"],[C,X]],[/\b(tm\d{3}\w+) b/i],[v,[R,"NuVision"],[C,X]],[/\b(k88) b/i],[v,[R,"ZTE"],[C,X]],[/\b(nx\d{3}j) b/i],[v,[R,"ZTE"],[C,U]],[/\b(gen\d{3}) b.+49h/i],[v,[R,"Swiss"],[C,U]],[/\b(zur\d{3}) b/i],[v,[R,"Swiss"],[C,X]],[/\b((zeki)?tb.*\b) b/i],[v,[R,"Zeki"],[C,X]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[R,"Dragon Touch"],v,[C,X]],[/\b(ns-?\w{0,9}) b/i],[v,[R,"Insignia"],[C,X]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[R,"NextBook"],[C,X]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[R,"Voice"],v,[C,U]],[/\b(lvtel\-)?(v1[12]) b/i],[[R,"LvTel"],v,[C,U]],[/\b(ph-1) /i],[v,[R,"Essential"],[C,U]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[R,"Envizen"],[C,X]],[/\b(trio[-\w\. ]+) b/i],[v,[R,"MachSpeed"],[C,X]],[/\btu_(1491) b/i],[v,[R,"Rotor"],[C,X]],[/(shield[\w ]+) b/i],[v,[R,"Nvidia"],[C,X]],[/(sprint) (\w+)/i],[R,v,[C,U]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[R,xr],[C,U]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[R,re],[C,X]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[R,re],[C,U]],[/smart-tv.+(samsung)/i],[R,[C,Y]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[R,Xe],[C,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[R,Ir],[C,Y]],[/(apple) ?tv/i],[R,[v,ne+" TV"],[C,Y]],[/crkey/i],[[v,He+"cast"],[R,Qt],[C,Y]],[/droid.+aft(\w+)( bui|\))/i],[v,[R,de],[C,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[R,lt],[C,Y]],[/(bravia[\w ]+)( bui|\))/i],[v,[R,Ve],[C,Y]],[/(mitv-\w{5}) bui/i],[v,[R,D],[C,Y]],[/Hbbtv.*(technisat) (.*);/i],[R,v,[C,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[R,rw],[v,rw],[C,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[C,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[R,v,[C,L]],[/droid.+; (shield) bui/i],[v,[R,"Nvidia"],[C,L]],[/(playstation [345portablevi]+)/i],[v,[R,Ve],[C,L]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[R,xr],[C,L]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[v,[R,Xe],[C,ee]],[/((pebble))app/i],[R,v,[C,ee]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[R,ne],[C,ee]],[/droid.+; (glass) \d/i],[v,[R,Qt],[C,ee]],[/droid.+; (wt63?0{2,3})\)/i],[v,[R,re],[C,ee]],[/droid.+; (glass) \d/i],[v,[R,Qt],[C,ee]],[/(pico) (4|neo3(?: link|pro)?)/i],[R,v,[C,ee]],[/; (quest( \d| pro)?)/i],[v,[R,le],[C,ee]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[R,[C,ue]],[/(aeobc)\b/i],[v,[R,de],[C,ue]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[v,[C,U]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[C,X]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[C,X]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[C,U]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[R,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[E,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[E,A],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[E,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,A],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[E,[A,Z_,fC]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,Z_,fC],[E,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,Gt],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,A],[/\(bb(10);/i],[A,[E,Ae]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[E,Yt+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[E,He+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,ze],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,A],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[E,A]]},Do=function($n,Zn){if(typeof $n===h&&(Zn=$n,$n=s),!(this instanceof Do))return new Do($n,Zn).getResult();var nn=typeof r!==d&&r.navigator?r.navigator:s,ua=$n||(nn&&nn.userAgent?nn.userAgent:""),ml=nn&&nn.userAgentData?nn.userAgentData:s,Dn=Zn?(function(gr,gl){var Qf={};for(var wd in gr)gl[wd]&&gl[wd].length%2==0?Qf[wd]=gl[wd].concat(gr[wd]):Qf[wd]=gr[wd];return Qf})(mC,Zn):mC,_u=nn&&nn.userAgent==ua;return this.getBrowser=function(){var gr={};return gr[E]=s,gr[A]=s,Jf.call(gr,ua,Dn.browser),gr[g]=(function(gl){return typeof gl===f?gl.replace(/[^\d\.]/g,"").split(".")[0]:s})(gr[A]),_u&&nn&&nn.brave&&typeof nn.brave.isBrave==c&&(gr[E]="Brave"),gr},this.getCPU=function(){var gr={};return gr[B]=s,Jf.call(gr,ua,Dn.cpu),gr},this.getDevice=function(){var gr={};return gr[R]=s,gr[v]=s,gr[C]=s,Jf.call(gr,ua,Dn.device),_u&&!gr[C]&&ml&&ml.mobile&&(gr[C]=U),_u&&gr[v]=="Macintosh"&&nn&&typeof nn.standalone!==d&&nn.maxTouchPoints&&nn.maxTouchPoints>2&&(gr[v]="iPad",gr[C]=X),gr},this.getEngine=function(){var gr={};return gr[E]=s,gr[A]=s,Jf.call(gr,ua,Dn.engine),gr},this.getOS=function(){var gr={};return gr[E]=s,gr[A]=s,Jf.call(gr,ua,Dn.os),_u&&!gr[E]&&ml&&ml.platform&&ml.platform!="Unknown"&&(gr[E]=ml.platform.replace(/chrome os/i,ze).replace(/macos/i,Gt)),gr},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ua},this.setUA=function(gr){return ua=typeof gr===f&&gr.length>500?rw(gr,500):gr,this},this.setUA(ua),this};Do.VERSION="0.7.40",Do.BROWSER=Qn([E,A,g]),Do.CPU=Qn([B]),Do.DEVICE=Qn([v,R,C,L,U,Y,X,ee,ue]),Do.ENGINE=Do.OS=Qn([E,A]),e.exports&&(t=e.exports=Do),t.UAParser=Do;var gu=typeof r!==d&&(r.jQuery||r.Zepto);if(gu&&!gu.ua){var gC=new Do;gu.ua=gC.getResult(),gu.ua.get=function(){return gC.getUA()},gu.ua.set=function($n){gC.setUA($n);var Zn=gC.getResult();for(var nn in Zn)gu.ua[nn]=Zn[nn]}}})(typeof window=="object"?window:l)})(rI,rI.exports);var dQ=u(rI.exports),cM=fh.clear;kr({global:!0,bind:!0,forced:F.clearImmediate!==cM},{clearImmediate:cM});var lM=F,uQ=$,hQ=he,pQ=jp,fQ=_t,mQ=Ts,gQ=Fa,_Q=lM.Function,yQ=/MSIE .\./.test(fQ)||pQ==="BUN"&&(function(){var e=lM.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),vQ=kr,dM=F,uM=fh.set,EQ=function(e,t){var r=1;return yQ?function(s,c){var d=gQ(arguments.length,1)>r,h=hQ(s)?s:_Q(s),f=d?mQ(arguments,r):[],g=d?function(){uQ(h,this,f)}:h;return e(g)}:e},hM=dM.setImmediate?EQ(uM):uM;vQ({global:!0,bind:!0,forced:dM.setImmediate!==hM},{setImmediate:hM});var pM=u(xt.setImmediate),wQ=F,bQ=Wv,SQ=Ar,xQ=Fa,TQ=Qe;kr({global:!0,dontCallGetSet:!0,forced:m((function(){return TQ&&Object.getOwnPropertyDescriptor(wQ,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(e){xQ(arguments.length,1),bQ(SQ(e))}});var fM=u(xt.queueMicrotask);function mM(e,t){return function(){return e.apply(t,arguments)}}const{toString:CQ}=Object.prototype,{getPrototypeOf:nI}=Object,{iterator:mx,toStringTag:gM}=Symbol,gx=(sI=Object.create(null),e=>{const t=CQ.call(e);return sI[t]||(sI[t]=t.slice(8,-1).toLowerCase())});var sI;const el=e=>(e=e.toLowerCase(),t=>gx(t)===e),_x=e=>t=>typeof t===e,{isArray:o_}=Array,Zv=_x("undefined"),_M=el("ArrayBuffer"),RQ=_x("string"),Wa=_x("function"),yM=_x("number"),yx=e=>e!==null&&typeof e=="object",vx=e=>{if(gx(e)!=="object")return!1;const t=nI(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||gM in e||mx in e)},NQ=el("Date"),AQ=el("File"),IQ=el("Blob"),OQ=el("FileList"),kQ=el("URLSearchParams"),[PQ,DQ,jQ,LQ]=["ReadableStream","Request","Response","Headers"].map(el);function eE(e,t){let r,s,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),o_(e))for(r=0,s=e.length;r<s;r++)t.call(null,e[r],r,e);else{const d=c?Object.getOwnPropertyNames(e):Object.keys(e),h=d.length;let f;for(r=0;r<h;r++)f=d[r],t.call(null,e[f],f,e)}}function vM(e,t){t=t.toLowerCase();const r=Object.keys(e);let s,c=r.length;for(;c-- >0;)if(s=r[c],t===s.toLowerCase())return s;return null}const xf=oM!==void 0?oM:typeof self<"u"?self:typeof window<"u"?window:tk,EM=e=>!Zv(e)&&e!==xf,MQ=(iI=typeof Uint8Array<"u"&&nI(Uint8Array),e=>iI&&e instanceof iI);var iI;const UQ=el("HTMLFormElement"),wM=(e=>{let{hasOwnProperty:t}=e;return(r,s)=>t.call(r,s)})(Object.prototype),FQ=el("RegExp"),bM=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),s={};eE(r,((c,d)=>{let h;(h=t(c,d,e))!==!1&&(s[d]=h||c)})),Object.defineProperties(e,s)},VQ=el("AsyncFunction"),SM=(xM=typeof pM=="function",TM=Wa(xf.postMessage),xM?pM:TM?(aI="axios@".concat(Math.random()),Ex=[],xf.addEventListener("message",(e=>{let{source:t,data:r}=e;t===xf&&r===aI&&Ex.length&&Ex.shift()()}),!1),e=>{Ex.push(e),xf.postMessage(aI,"*")}):e=>setTimeout(e));var xM,TM,aI,Ex;const BQ=fM!==void 0?fM.bind(xf):typeof process<"u"&&process.nextTick||SM;var rt={isArray:o_,isArrayBuffer:_M,isBuffer:function(e){return e!==null&&!Zv(e)&&e.constructor!==null&&!Zv(e.constructor)&&Wa(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Wa(e.append)&&((t=gx(e))==="formdata"||t==="object"&&Wa(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&_M(e.buffer),t},isString:RQ,isNumber:yM,isBoolean:e=>e===!0||e===!1,isObject:yx,isPlainObject:vx,isReadableStream:PQ,isRequest:DQ,isResponse:jQ,isHeaders:LQ,isUndefined:Zv,isDate:NQ,isFile:AQ,isBlob:IQ,isRegExp:FQ,isFunction:Wa,isStream:e=>yx(e)&&Wa(e.pipe),isURLSearchParams:kQ,isTypedArray:MQ,isFileList:OQ,forEach:eE,merge:function e(){const{caseless:t}=EM(this)&&this||{},r={},s=(c,d)=>{const h=t&&vM(r,d)||d;vx(r[h])&&vx(c)?r[h]=e(r[h],c):vx(c)?r[h]=e({},c):o_(c)?r[h]=c.slice():r[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&eE(arguments[c],s);return r},extend:function(e,t,r){let{allOwnKeys:s}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return eE(t,((c,d)=>{r&&Wa(c)?e[d]=mM(c,r):e[d]=c}),{allOwnKeys:s}),e},trim:e=>gi(e)?gi(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,s)=>{e.prototype=Object.create(t.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,s)=>{let c,d,h;const f={};if(t=t||{},e==null)return t;do{for(c=Object.getOwnPropertyNames(e),d=c.length;d-- >0;)h=c[d],s&&!s(h,e,t)||f[h]||(t[h]=e[h],f[h]=!0);e=r!==!1&&nI(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:gx,kindOfTest:el,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;const s=e.indexOf(t,r);return s!==-1&&s===r},toArray:e=>{if(!e)return null;if(o_(e))return e;let t=e.length;if(!yM(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[mx]).call(e);let s;for(;(s=r.next())&&!s.done;){const c=s.value;t.call(e,c[0],c[1])}},matchAll:(e,t)=>{let r;const s=[];for(;(r=e.exec(t))!==null;)s.push(r);return s},isHTMLForm:UQ,hasOwnProperty:wM,hasOwnProp:wM,reduceDescriptors:bM,freezeMethods:e=>{bM(e,((t,r)=>{if(Wa(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const s=e[r];Wa(s)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},s=c=>{c.forEach((d=>{r[d]=!0}))};return o_(e)?s(e):s(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,r,s){return r.toUpperCase()+s})),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:vM,global:xf,isContextDefined:EM,isSpecCompliantForm:function(e){return!!(e&&Wa(e.append)&&e[gM]==="FormData"&&e[mx])},toJSONObject:e=>{const t=new Array(10),r=(s,c)=>{if(yx(s)){if(t.indexOf(s)>=0)return;if(!("toJSON"in s)){t[c]=s;const d=o_(s)?[]:{};return eE(s,((h,f)=>{const g=r(h,c+1);!Zv(g)&&(d[f]=g)})),t[c]=void 0,d}}return s};return r(e,0)},isAsyncFn:VQ,isThenable:e=>e&&(yx(e)||Wa(e))&&Wa(e.then)&&Wa(e.catch),setImmediate:SM,asap:BQ,isIterable:e=>e!=null&&Wa(e[mx])};function qr(e,t,r,s,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),s&&(this.request=s),c&&(this.response=c,this.status=c.status?c.status:null)}rt.inherits(qr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:rt.toJSONObject(this.config),code:this.code,status:this.status}}});const CM=qr.prototype,RM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{RM[e]={value:e}})),Object.defineProperties(qr,RM),Object.defineProperty(CM,"isAxiosError",{value:!0}),qr.from=(e,t,r,s,c,d)=>{const h=Object.create(CM);return rt.toFlatObject(e,h,(function(f){return f!==Error.prototype}),(f=>f!=="isAxiosError")),qr.call(h,e.message,t,r,s,c),h.cause=e,h.name=e.name,d&&Object.assign(h,d),h};function oI(e){return rt.isPlainObject(e)||rt.isArray(e)}function NM(e){return rt.endsWith(e,"[]")?e.slice(0,-2):e}function AM(e,t,r){return e?e.concat(t).map((function(s,c){return s=NM(s),!r&&c?"["+s+"]":s})).join(r?".":""):t}const WQ=rt.toFlatObject(rt,{},null,(function(e){return/^is[A-Z]/.test(e)}));function wx(e,t,r){if(!rt.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const s=(r=rt.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(R,A){return!rt.isUndefined(A[R])}))).metaTokens,c=r.visitor||v,d=r.dots,h=r.indexes,f=(r.Blob||typeof Blob<"u"&&Blob)&&rt.isSpecCompliantForm(t);if(!rt.isFunction(c))throw new TypeError("visitor must be a function");function g(R){if(R===null)return"";if(rt.isDate(R))return R.toISOString();if(!f&&rt.isBlob(R))throw new qr("Blob is not supported. Use a Buffer instead.");return rt.isArrayBuffer(R)||rt.isTypedArray(R)?f&&typeof Blob=="function"?new Blob([R]):Buffer.from(R):R}function v(R,A,B){let L=R;if(R&&!B&&typeof R=="object"){if(rt.endsWith(A,"{}"))A=s?A:A.slice(0,-2),R=JSON.stringify(R);else if(rt.isArray(R)&&(function(U){return rt.isArray(U)&&!U.some(oI)})(R)||(rt.isFileList(R)||rt.endsWith(A,"[]"))&&(L=rt.toArray(R)))return A=NM(A),L.forEach((function(U,X){!rt.isUndefined(U)&&U!==null&&t.append(h===!0?AM([A],X,d):h===null?A:A+"[]",g(U))})),!1}return!!oI(R)||(t.append(AM(B,A,d),g(R)),!1)}const E=[],C=Object.assign(WQ,{defaultVisitor:v,convertValue:g,isVisitable:oI});if(!rt.isObject(e))throw new TypeError("data must be an object");return(function R(A,B){if(!rt.isUndefined(A)){if(E.indexOf(A)!==-1)throw Error("Circular reference detected in "+B.join("."));E.push(A),rt.forEach(A,(function(L,U){(!(rt.isUndefined(L)||L===null)&&c.call(t,L,rt.isString(U)?gi(U).call(U):U,B,C))===!0&&R(L,B?B.concat(U):[U])})),E.pop()}})(e),t}function IM(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(r){return t[r]}))}function cI(e,t){this._pairs=[],e&&wx(e,this,t)}const OM=cI.prototype;function qQ(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function kM(e,t,r){if(!t)return e;const s=r&&r.encode||qQ;rt.isFunction(r)&&(r={serialize:r});const c=r&&r.serialize;let d;if(d=c?c(t,r):rt.isURLSearchParams(t)?t.toString():new cI(t,r).toString(s),d){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+d}return e}OM.append=function(e,t){this._pairs.push([e,t])},OM.toString=function(e){const t=e?function(r){return e.call(this,r,IM)}:IM;return this._pairs.map((function(r){return t(r[0])+"="+t(r[1])}),"").join("&")};var PM=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){rt.forEach(this.handlers,(function(t){t!==null&&e(t)}))}},DM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},jM={exports:{}},GQ=kr,HQ=Qe,LM=Qi.f;GQ({target:"Object",stat:!0,forced:Object.defineProperty!==LM,sham:!HQ},{defineProperty:LM});var MM=xt.Object,KQ=jM.exports=function(e,t,r){return MM.defineProperty(e,t,r)};MM.defineProperty.sham&&(KQ.sham=!0);var UM=u(jM.exports),zQ=TypeError,FM=Mc,$Q=Ms,YQ=jt,XQ=wn("species"),VM=Array,JQ=function(e){var t;return FM(e)&&(t=e.constructor,($Q(t)&&(t===VM||FM(t.prototype))||YQ(t)&&(t=t[XQ])===null)&&(t=void 0)),t===void 0?VM:t},BM=function(e,t){return new(JQ(e))(t===0?0:t)},QQ=m,ZQ=tt,eZ=wn("species"),WM=function(e){return ZQ>=51||!QQ((function(){var t=[];return(t.constructor={})[eZ]=function(){return{foo:1}},t[e](Boolean).foo!==1}))},tZ=kr,rZ=m,nZ=Mc,sZ=jt,iZ=Bo,aZ=Ml,qM=function(e){if(e>9007199254740991)throw zQ("Maximum allowed index exceeded");return e},GM=xA,oZ=BM,cZ=WM,lZ=tt,HM=wn("isConcatSpreadable"),dZ=lZ>=51||!rZ((function(){var e=[];return e[HM]=!1,e.concat()[0]!==e})),uZ=function(e){if(!sZ(e))return!1;var t=e[HM];return t!==void 0?!!t:nZ(e)};tZ({target:"Array",proto:!0,forced:!dZ||!cZ("concat")},{concat:function(e){var t,r,s,c,d,h=iZ(this),f=oZ(h,0),g=0;for(t=-1,s=arguments.length;t<s;t++)if(uZ(d=t===-1?h:arguments[t]))for(c=aZ(d),qM(g+c),r=0;r<c;r++,g++)r in d&&GM(f,g,d[r]);else qM(g+1),GM(f,g++,d);return f.length=g,f}});var KM={},hZ=ie,pZ=Le,zM=Fc.f,fZ=Ts,$M=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];KM.f=function(e){return $M&&hZ(e)==="Window"?(function(t){try{return zM(t)}catch{return fZ($M)}})(e):zM(pZ(e))};var c_={},mZ=wn;c_.f=mZ;var YM=xt,gZ=us,_Z=c_,yZ=Qi.f,Cs=function(e){var t=YM.Symbol||(YM.Symbol={});gZ(t,e)||yZ(t,e,{value:_Z.f(e)})},vZ=ge,EZ=Sr,wZ=wn,bZ=$c,XM=function(){var e=EZ("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,s=wZ("toPrimitive");t&&!t[s]&&bZ(t,s,(function(c){return vZ(r,this)}),{})},SZ=Dl,xZ=er,TZ=Bo,CZ=Ml,RZ=BM,JM=N([].push),NZ=function(e){var t=e===1,r=e===2,s=e===3,c=e===4,d=e===6,h=e===7,f=e===5||d;return function(g,v,E,C){for(var R,A,B=TZ(g),L=xZ(B),U=CZ(L),X=SZ(v,E),Y=0,ee=C||RZ,ue=t?ee(g,U):r||h?ee(g,0):void 0;U>Y;Y++)if((f||Y in L)&&(A=X(R=L[Y],Y,B),e))if(t)ue[Y]=A;else if(A)switch(e){case 3:return!0;case 5:return R;case 6:return Y;case 2:JM(ue,R)}else switch(e){case 4:return!1;case 7:JM(ue,R)}return d?-1:s||c?c:ue}},QM={forEach:NZ(0)},bx=kr,tE=F,lI=ge,AZ=N,l_=Qe,d_=Ot,IZ=m,Oi=us,OZ=O,dI=hi,Sx=Le,uI=bn,kZ=Zi,hI=_e,u_=Hp,ZM=Vi,PZ=Fc,eU=KM,DZ=eh,tU=Ze,rU=Qi,jZ=Gl,nU=Ee,sU=$c,LZ=zl,pI=Md,iU=go,aU=Lu,MZ=wn,UZ=c_,FZ=Cs,VZ=XM,BZ=zo,oU=Kl,xx=QM.forEach,qa=Qu("hidden"),Tx="Symbol",rE="prototype",WZ=oU.set,cU=oU.getterFor(Tx),tl=Object[rE],Tf=tE.Symbol,Cx=Tf&&Tf[rE],qZ=tE.RangeError,GZ=tE.TypeError,fI=tE.QObject,lU=tU.f,Cf=rU.f,dU=eU.f,HZ=nU.f,uU=AZ([].push),su=pI("symbols"),nE=pI("op-symbols"),KZ=pI("wks"),mI=!fI||!fI[rE]||!fI[rE].findChild,hU=function(e,t,r){var s=lU(tl,t);s&&delete tl[t],Cf(e,t,r),s&&e!==tl&&Cf(tl,t,s)},gI=l_&&IZ((function(){return u_(Cf({},"a",{get:function(){return Cf(this,"a",{value:7}).a}})).a!==7}))?hU:Cf,_I=function(e,t){var r=su[e]=u_(Cx);return WZ(r,{type:Tx,tag:e,description:t}),l_||(r.description=t),r},Rx=function(e,t,r){e===tl&&Rx(nE,t,r),dI(e);var s=uI(t);return dI(r),Oi(su,s)?(r.enumerable?(Oi(e,qa)&&e[qa][s]&&(e[qa][s]=!1),r=u_(r,{enumerable:hI(0,!1)})):(Oi(e,qa)||Cf(e,qa,hI(1,u_(null))),e[qa][s]=!0),gI(e,s,r)):Cf(e,s,r)},yI=function(e,t){dI(e);var r=Sx(t),s=ZM(r).concat(gU(r));return xx(s,(function(c){l_&&!lI(pU,r,c)||Rx(e,c,r[c])})),e},pU=function(e){var t=uI(e),r=lI(HZ,this,t);return!(this===tl&&Oi(su,t)&&!Oi(nE,t))&&(!(r||!Oi(this,t)||!Oi(su,t)||Oi(this,qa)&&this[qa][t])||r)},fU=function(e,t){var r=Sx(e),s=uI(t);if(r!==tl||!Oi(su,s)||Oi(nE,s)){var c=lU(r,s);return!c||!Oi(su,s)||Oi(r,qa)&&r[qa][s]||(c.enumerable=!0),c}},mU=function(e){var t=dU(Sx(e)),r=[];return xx(t,(function(s){Oi(su,s)||Oi(iU,s)||uU(r,s)})),r},gU=function(e){var t=e===tl,r=dU(t?nE:Sx(e)),s=[];return xx(r,(function(c){!Oi(su,c)||t&&!Oi(tl,c)||uU(s,su[c])})),s};d_||(Tf=function(){if(OZ(Cx,this))throw new GZ("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?kZ(arguments[0]):void 0,t=aU(e),r=function(s){var c=this===void 0?tE:this;c===tl&&lI(r,nE,s),Oi(c,qa)&&Oi(c[qa],t)&&(c[qa][t]=!1);var d=hI(1,s);try{gI(c,t,d)}catch(h){if(!(h instanceof qZ))throw h;hU(c,t,d)}};return l_&&mI&&gI(tl,t,{configurable:!0,set:r}),_I(t,e)},sU(Cx=Tf[rE],"toString",(function(){return cU(this).tag})),sU(Tf,"withoutSetter",(function(e){return _I(aU(e),e)})),nU.f=pU,rU.f=Rx,jZ.f=yI,tU.f=fU,PZ.f=eU.f=mU,DZ.f=gU,UZ.f=function(e){return _I(MZ(e),e)},l_&&LZ(Cx,"description",{configurable:!0,get:function(){return cU(this).description}})),bx({global:!0,wrap:!0,forced:!d_,sham:!d_},{Symbol:Tf}),xx(ZM(KZ),(function(e){FZ(e)})),bx({target:Tx,stat:!0,forced:!d_},{useSetter:function(){mI=!0},useSimple:function(){mI=!1}}),bx({target:"Object",stat:!0,forced:!d_,sham:!l_},{create:function(e,t){return t===void 0?u_(e):yI(u_(e),t)},defineProperty:Rx,defineProperties:yI,getOwnPropertyDescriptor:fU}),bx({target:"Object",stat:!0,forced:!d_},{getOwnPropertyNames:mU}),VZ(),BZ(Tf,Tx),iU[qa]=!0;var _U=Ot&&!!Symbol.for&&!!Symbol.keyFor,zZ=kr,$Z=Sr,YZ=us,XZ=Zi,yU=Md,JZ=_U,vI=yU("string-to-symbol-registry"),QZ=yU("symbol-to-string-registry");zZ({target:"Symbol",stat:!0,forced:!JZ},{for:function(e){var t=XZ(e);if(YZ(vI,t))return vI[t];var r=$Z("Symbol")(t);return vI[t]=r,QZ[r]=t,r}});var ZZ=kr,eee=us,tee=ar,ree=qn,nee=_U,vU=Md("symbol-to-string-registry");ZZ({target:"Symbol",stat:!0,forced:!nee},{keyFor:function(e){if(!tee(e))throw new TypeError(ree(e)+" is not a symbol");if(eee(vU,e))return vU[e]}});var EU=Mc,see=he,wU=ie,iee=Zi,bU=N([].push),aee=kr,SU=Sr,xU=$,oee=ge,sE=N,TU=m,CU=he,RU=ar,NU=Ts,cee=function(e){if(see(e))return e;if(EU(e)){for(var t=e.length,r=[],s=0;s<t;s++){var c=e[s];typeof c=="string"?bU(r,c):typeof c!="number"&&wU(c)!=="Number"&&wU(c)!=="String"||bU(r,iee(c))}var d=r.length,h=!0;return function(f,g){if(h)return h=!1,g;if(EU(this))return g;for(var v=0;v<d;v++)if(r[v]===f)return g}}},lee=Ot,dee=String,xh=SU("JSON","stringify"),Nx=sE(/./.exec),AU=sE("".charAt),uee=sE("".charCodeAt),hee=sE("".replace),pee=sE(1 .toString),fee=/[\uD800-\uDFFF]/g,IU=/^[\uD800-\uDBFF]$/,OU=/^[\uDC00-\uDFFF]$/,kU=!lee||TU((function(){var e=SU("Symbol")("stringify detection");return xh([e])!=="[null]"||xh({a:e})!=="{}"||xh(Object(e))!=="{}"})),PU=TU((function(){return xh("\uDF06\uD834")!=='"\\udf06\\ud834"'||xh("\uDEAD")!=='"\\udead"'})),mee=function(e,t){var r=NU(arguments),s=cee(t);if(CU(s)||e!==void 0&&!RU(e))return r[1]=function(c,d){if(CU(s)&&(d=oee(s,this,dee(c),d)),!RU(d))return d},xU(xh,null,r)},gee=function(e,t,r){var s=AU(r,t-1),c=AU(r,t+1);return Nx(IU,e)&&!Nx(OU,c)||Nx(OU,e)&&!Nx(IU,s)?"\\u"+pee(uee(e,0),16):e};xh&&aee({target:"JSON",stat:!0,forced:kU||PU},{stringify:function(e,t,r){var s=NU(arguments),c=xU(kU?mee:xh,null,s);return PU&&typeof c=="string"?hee(c,fee,gee):c}});var DU=eh,_ee=Bo;kr({target:"Object",stat:!0,forced:!Ot||m((function(){DU.f(1)}))},{getOwnPropertySymbols:function(e){var t=DU.f;return t?t(_ee(e)):[]}}),Cs("asyncIterator"),Cs("hasInstance"),Cs("isConcatSpreadable"),Cs("iterator"),Cs("match"),Cs("matchAll"),Cs("replace"),Cs("search"),Cs("species"),Cs("split");var yee=XM;Cs("toPrimitive"),yee();var vee=Sr,Eee=zo;Cs("toStringTag"),Eee(vee("Symbol"),"Symbol"),Cs("unscopables"),zo(F.JSON,"JSON",!0);var wee=xt.Symbol,bee=wn,See=Qi.f,jU=bee("metadata"),LU=Function.prototype;LU[jU]===void 0&&See(LU,jU,{value:null}),Cs("asyncDispose"),Cs("dispose"),Cs("metadata");var xee=wee,Tee=N,EI=Sr("Symbol"),Cee=EI.keyFor,Ree=Tee(EI.prototype.valueOf),MU=EI.isRegisteredSymbol||function(e){try{return Cee(Ree(e))!==void 0}catch{return!1}};kr({target:"Symbol",stat:!0},{isRegisteredSymbol:MU});for(var Nee=Md,UU=Sr,Aee=N,Iee=ar,Oee=wn,Ax=UU("Symbol"),FU=Ax.isWellKnownSymbol,VU=UU("Object","getOwnPropertyNames"),kee=Aee(Ax.prototype.valueOf),BU=Nee("wks"),wI=0,WU=VU(Ax),Pee=WU.length;wI<Pee;wI++)try{var qU=WU[wI];Iee(Ax[qU])&&Oee(qU)}catch{}var GU=function(e){if(FU&&FU(e))return!0;try{for(var t=kee(e),r=0,s=VU(BU),c=s.length;r<c;r++)if(BU[s[r]]==t)return!0}catch{}return!1};kr({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:GU}),Cs("customMatcher"),Cs("observable"),kr({target:"Symbol",stat:!0},{isRegistered:MU}),kr({target:"Symbol",stat:!0,forced:!0},{isWellKnown:GU}),Cs("matcher"),Cs("metadataKey"),Cs("patternMatch"),Cs("replaceAll");var h_=u(xee),HU=u(c_.f("iterator"));function iE(e){return iE=typeof h_=="function"&&typeof HU=="symbol"?function(t){return typeof t}:function(t){return t&&typeof h_=="function"&&t.constructor===h_&&t!==h_.prototype?"symbol":typeof t},iE(e)}var Dee=u(c_.f("toPrimitive"));function jee(e){var t=(function(r,s){if(iE(r)!="object"||!r)return r;var c=r[Dee];if(c!==void 0){var d=c.call(r,s);if(iE(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(r)})(e,"string");return iE(t)=="symbol"?t:t+""}function H(e,t,r){return(t=jee(t))in e?UM(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var KU=u(jX),Lee={isBrowser:!0,classes:{URLSearchParams:KU!==void 0?KU:cI,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const bI=typeof window<"u"&&typeof document<"u",SI=typeof navigator=="object"&&navigator||void 0,Mee=bI&&(!SI||["ReactNative","NativeScript","NS"].indexOf(SI.product)<0),Uee=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Fee=bI&&window.location.href||"http://localhost";function zU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function $U(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zU(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zU(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}var ia=$U($U({},Object.freeze({__proto__:null,hasBrowserEnv:bI,hasStandardBrowserEnv:Mee,hasStandardBrowserWebWorkerEnv:Uee,navigator:SI,origin:Fee})),Lee),Vee=hi,Bee=ge,Wee=us,qee=O,Gee=function(){var e=Vee(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},YU=RegExp.prototype,XU=function(e){var t=e.flags;return t!==void 0||"flags"in YU||Wee(e,"flags")||!qee(YU,e)?t:Bee(Gee,e)},Hee=dA.charAt,JU=ge,Kee=hi,zee=he,$ee=ie,Yee=/./.exec,Xee=TypeError,Jee=kr,QU=ge,ZU=oe,Qee=rf,Ix=Lg,e4=en,t4=Pb,aE=Zi,Zee=hi,ete=jt,tte=ie,rte=w0,r4=XU,nte=Ti,ste=m,ite=Zd,ate=function(e,t,r){return t+(r?Hee(e,t).length:1)},ote=function(e,t){var r=e.exec;if(zee(r)){var s=JU(r,e,t);return s!==null&&Kee(s),s}if($ee(e)==="RegExp")return JU(Yee,e,t);throw new Xee("RegExp#exec called on incompatible receiver")},n4=Kl,cte=wn("matchAll"),s4="RegExp String",i4=s4+" Iterator",lte=n4.set,dte=n4.getterFor(i4),ute=TypeError,xI=ZU("".indexOf),Ox=ZU("".matchAll),TI=!!Ox&&!ste((function(){Ox("a",/./)})),hte=Qee((function(e,t,r,s){lte(this,{type:i4,regexp:e,string:t,global:r,unicode:s,done:!1})}),s4,(function(){var e=dte(this);if(e.done)return Ix(void 0,!0);var t=e.regexp,r=e.string,s=ote(t,r);return s===null?(e.done=!0,Ix(void 0,!0)):e.global?(aE(s[0])===""&&(t.lastIndex=ate(r,t4(t.lastIndex),e.unicode)),Ix(s,!1)):(e.done=!0,Ix(s,!1))})),a4=function(e){var t,r,s,c=Zee(this),d=aE(e),h=ite(c,RegExp),f=aE(r4(c));return t=new h(h===RegExp?c.source:c,f),r=!!~xI(f,"g"),s=!!~xI(f,"u"),t.lastIndex=t4(c.lastIndex),new hte(t,d,r,s)};Jee({target:"String",proto:!0,forced:TI},{matchAll:function(e){var t,r,s,c,d=e4(this);if(ete(e)){if(rte(e)&&(t=aE(e4(r4(e))),!~xI(t,"g")))throw new ute("`.matchAll` does not allow non-global regexes");if(TI)return Ox(d,e);if((s=nte(e,cte))===void 0&&tte(e)==="RegExp"&&(s=a4),s)return QU(s,e,d)}else if(TI)return Ox(d,e);return r=aE(d),c=new RegExp(e,"g"),QU(a4,c,r)}});var pte=ya("String","matchAll"),fte=O,mte=pte,CI=String.prototype,gte=function(e){var t=e.matchAll;return typeof e=="string"||e===CI||fte(CI,e)&&t===CI.matchAll?mte:t},_te=u(gte);function o4(e){function t(r,s,c,d){let h=r[d++];if(h==="__proto__")return!0;const f=Number.isFinite(+h),g=d>=r.length;return h=!h&&rt.isArray(c)?c.length:h,g?(rt.hasOwnProp(c,h)?c[h]=[c[h],s]:c[h]=s,!f):(c[h]&&rt.isObject(c[h])||(c[h]=[]),t(r,s,c[h],d)&&rt.isArray(c[h])&&(c[h]=(function(v){const E={},C=Object.keys(v);let R;const A=C.length;let B;for(R=0;R<A;R++)B=C[R],E[B]=v[B];return E})(c[h])),!f)}if(rt.isFormData(e)&&rt.isFunction(e.entries)){const r={};return rt.forEachEntry(e,((s,c)=>{t((function(d){return _te(rt).call(rt,/\w+|\[(\w*)]/g,d).map((h=>h[0]==="[]"?"":h[1]||h[0]))})(s),c,r,0)})),r}return null}const RI={transitional:DM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",s=r.indexOf("application/json")>-1,c=rt.isObject(e);if(c&&rt.isHTMLForm(e)&&(e=new FormData(e)),rt.isFormData(e))return s?JSON.stringify(o4(e)):e;if(rt.isArrayBuffer(e)||rt.isBuffer(e)||rt.isStream(e)||rt.isFile(e)||rt.isBlob(e)||rt.isReadableStream(e))return e;if(rt.isArrayBufferView(e))return e.buffer;if(rt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(c){if(r.indexOf("application/x-www-form-urlencoded")>-1)return(function(h,f){return wx(h,new ia.classes.URLSearchParams,Object.assign({visitor:function(g,v,E,C){return ia.isNode&&rt.isBuffer(g)?(this.append(v,g.toString("base64")),!1):C.defaultVisitor.apply(this,arguments)}},f))})(e,this.formSerializer).toString();if((d=rt.isFileList(e))||r.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return wx(d?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||s?(t.setContentType("application/json",!1),(function(h,f,g){if(rt.isString(h))try{return(f||JSON.parse)(h),gi(rt).call(rt,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(h)})(e)):e}],transformResponse:[function(e){const t=this.transitional||RI.transitional,r=t&&t.forcedJSONParsing,s=this.responseType==="json";if(rt.isResponse(e)||rt.isReadableStream(e))return e;if(e&&rt.isString(e)&&(r&&!this.responseType||s)){const c=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(d){if(c)throw d.name==="SyntaxError"?qr.from(d,qr.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ia.classes.FormData,Blob:ia.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};rt.forEach(["delete","get","head","post","put","patch"],(e=>{RI.headers[e]={}}));var NI=RI;const yte=rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),c4=Symbol("internals");function oE(e){var t;return e&&gi(t=String(e)).call(t).toLowerCase()}function kx(e){return e===!1||e==null?e:rt.isArray(e)?e.map(kx):String(e)}function AI(e,t,r,s,c){return rt.isFunction(s)?s.call(this,t,r):(c&&(t=r),rt.isString(t)?rt.isString(s)?t.indexOf(s)!==-1:rt.isRegExp(s)?s.test(t):void 0:void 0)}class Px{constructor(t){t&&this.set(t)}set(t,r,s){const c=this;function d(g,v,E){const C=oE(v);if(!C)throw new Error("header name must be a non-empty string");const R=rt.findKey(c,C);(!R||c[R]===void 0||E===!0||E===void 0&&c[R]!==!1)&&(c[R||v]=kx(g))}const h=(g,v)=>rt.forEach(g,((E,C)=>d(E,C,v)));if(rt.isPlainObject(t)||t instanceof this.constructor)h(t,r);else if(rt.isString(t)&&(t=gi(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(gi(f=t).call(f)))h((g=>{const v={};let E,C,R;return g&&g.split(`
`).forEach((function(A){var B,L;R=A.indexOf(":"),E=gi(B=A.substring(0,R)).call(B).toLowerCase(),C=gi(L=A.substring(R+1)).call(L),!E||v[E]&&yte[E]||(E==="set-cookie"?v[E]?v[E].push(C):v[E]=[C]:v[E]=v[E]?v[E]+", "+C:C)})),v})(t),r);else if(rt.isObject(t)&&rt.isIterable(t)){let g,v,E={};for(const C of t){if(!rt.isArray(C))throw TypeError("Object iterator must return a key-value pair");E[v=C[0]]=(g=E[v])?rt.isArray(g)?[...g,C[1]]:[g,C[1]]:C[1]}h(E,r)}else t!=null&&d(r,t,s);var f;return this}get(t,r){if(t=oE(t)){const s=rt.findKey(this,t);if(s){const c=this[s];if(!r)return c;if(r===!0)return(function(d){const h=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=f.exec(d);)h[g[1]]=g[2];return h})(c);if(rt.isFunction(r))return r.call(this,c,s);if(rt.isRegExp(r))return r.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=oE(t)){const s=rt.findKey(this,t);return!(!s||this[s]===void 0||r&&!AI(0,this[s],s,r))}return!1}delete(t,r){const s=this;let c=!1;function d(h){if(h=oE(h)){const f=rt.findKey(s,h);!f||r&&!AI(0,s[f],f,r)||(delete s[f],c=!0)}}return rt.isArray(t)?t.forEach(d):d(t),c}clear(t){const r=Object.keys(this);let s=r.length,c=!1;for(;s--;){const d=r[s];t&&!AI(0,this[d],d,t,!0)||(delete this[d],c=!0)}return c}normalize(t){const r=this,s={};return rt.forEach(this,((c,d)=>{var h;const f=rt.findKey(s,d);if(f)return r[f]=kx(c),void delete r[d];const g=t?(function(v){return gi(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,((E,C,R)=>C.toUpperCase()+R))})(d):gi(h=String(d)).call(h);g!==d&&delete r[d],r[g]=kx(c),s[g]=!0})),this}concat(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return this.constructor.concat(this,...r)}toJSON(t){const r=Object.create(null);return rt.forEach(this,((s,c)=>{s!=null&&s!==!1&&(r[c]=t&&rt.isArray(s)?s.join(", "):s)})),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[r,s]=t;return r+": "+s})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const r=new this(t);for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];return c.forEach((h=>r.set(h))),r}static accessor(t){const r=(this[c4]=this[c4]={accessors:{}}).accessors,s=this.prototype;function c(d){const h=oE(d);r[h]||((function(f,g){const v=rt.toCamelCase(" "+g);["get","set","has"].forEach((E=>{Object.defineProperty(f,E+v,{value:function(C,R,A){return this[E].call(this,g,C,R,A)},configurable:!0})}))})(s,d),r[h]=!0)}return rt.isArray(t)?t.forEach(c):c(t),this}}Px.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),rt.reduceDescriptors(Px.prototype,((e,t)=>{let{value:r}=e,s=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(c){this[s]=c}}})),rt.freezeMethods(Px);var rl=Px;function II(e,t){const r=this||NI,s=t||r,c=rl.from(s.headers);let d=s.data;return rt.forEach(e,(function(h){d=h.call(r,d,c.normalize(),t?t.status:void 0)})),c.normalize(),d}function l4(e){return!(!e||!e.__CANCEL__)}function p_(e,t,r){qr.call(this,e??"canceled",qr.ERR_CANCELED,t,r),this.name="CanceledError"}function d4(e,t,r){const s=r.config.validateStatus;r.status&&s&&!s(r.status)?t(new qr("Request failed with status code "+r.status,[qr.ERR_BAD_REQUEST,qr.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}rt.inherits(p_,qr,{__CANCEL__:!0});const Dx=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=0;const c=(function(d,h){d=d||10;const f=new Array(d),g=new Array(d);let v,E=0,C=0;return h=h!==void 0?h:1e3,function(R){const A=Date.now(),B=g[C];v||(v=A),f[E]=R,g[E]=A;let L=C,U=0;for(;L!==E;)U+=f[L++],L%=d;if(E=(E+1)%d,E===C&&(C=(C+1)%d),A-v<h)return;const X=B&&A-B;return X?Math.round(1e3*U/X):void 0}})(50,250);return(function(d,h){let f,g,v=0,E=1e3/h;const C=function(R){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),f=null,g&&(clearTimeout(g),g=null),d.apply(null,R)};return[function(){const R=Date.now(),A=R-v;for(var B=arguments.length,L=new Array(B),U=0;U<B;U++)L[U]=arguments[U];A>=E?C(L,R):(f=L,g||(g=setTimeout((()=>{g=null,C(f)}),E-A)))},()=>f&&C(f)]})((d=>{const h=d.loaded,f=d.lengthComputable?d.total:void 0,g=h-s,v=c(g);s=h,e({loaded:h,total:f,progress:f?h/f:void 0,bytes:g,rate:v||void 0,estimated:v&&f&&h<=f?(f-h)/v:void 0,event:d,lengthComputable:f!=null,[t?"download":"upload"]:!0})}),r)},u4=(e,t)=>{const r=e!=null;return[s=>t[0]({lengthComputable:r,total:e,loaded:s}),t[1]]},h4=e=>function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return rt.asap((()=>e(...r)))};var vte=ia.hasStandardBrowserEnv?((e,t)=>r=>(r=new cx(r,ia.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new cx(ia.origin),ia.navigator&&/(msie|trident)/i.test(ia.navigator.userAgent)):()=>!0,Ete=ia.hasStandardBrowserEnv?{write(e,t,r,s,c,d){const h=[e+"="+encodeURIComponent(t)];rt.isNumber(r)&&h.push("expires="+new Date(r).toGMTString()),rt.isString(s)&&h.push("path="+s),rt.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function p4(e,t,r){let s=!(function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)})(t);return e&&(s||r==0)?(function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c})(e,t):t}function f4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}const m4=e=>e instanceof rl?(function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?f4(Object(s),!0).forEach((function(c){H(t,c,s[c])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f4(Object(s)).forEach((function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))}))}return t})({},e):e;function Rf(e,t){t=t||{};const r={};function s(v,E,C,R){return rt.isPlainObject(v)&&rt.isPlainObject(E)?rt.merge.call({caseless:R},v,E):rt.isPlainObject(E)?rt.merge({},E):rt.isArray(E)?E.slice():E}function c(v,E,C,R){return rt.isUndefined(E)?rt.isUndefined(v)?void 0:s(void 0,v,0,R):s(v,E,0,R)}function d(v,E){if(!rt.isUndefined(E))return s(void 0,E)}function h(v,E){return rt.isUndefined(E)?rt.isUndefined(v)?void 0:s(void 0,v):s(void 0,E)}function f(v,E,C){return C in t?s(v,E):C in e?s(void 0,v):void 0}const g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:f,headers:(v,E,C)=>c(m4(v),m4(E),0,!0)};return rt.forEach(Object.keys(Object.assign({},e,t)),(function(v){const E=g[v]||c,C=E(e[v],t[v],v);rt.isUndefined(C)&&E!==f||(r[v]=C)})),r}var g4=e=>{const t=Rf({},e);let r,{data:s,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:f,auth:g}=t;if(t.headers=f=rl.from(f),t.url=kM(p4(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),g&&f.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),rt.isFormData(s)){if(ia.hasStandardBrowserEnv||ia.hasStandardBrowserWebWorkerEnv)f.setContentType(void 0);else if((r=f.getContentType())!==!1){const[v,...E]=r?r.split(";").map((C=>gi(C).call(C))).filter(Boolean):[];f.setContentType([v||"multipart/form-data",...E].join("; "))}}if(ia.hasStandardBrowserEnv&&(c&&rt.isFunction(c)&&(c=c(t)),c||c!==!1&&vte(t.url))){const v=d&&h&&Ete.read(h);v&&f.set(d,v)}return t},wte=typeof XMLHttpRequest<"u"&&function(e){return new nt((function(t,r){const s=g4(e);let c=s.data;const d=rl.from(s.headers).normalize();let h,f,g,v,E,{responseType:C,onUploadProgress:R,onDownloadProgress:A}=s;function B(){v&&v(),E&&E(),s.cancelToken&&s.cancelToken.unsubscribe(h),s.signal&&s.signal.removeEventListener("abort",h)}let L=new XMLHttpRequest;function U(){if(!L)return;const Y=rl.from("getAllResponseHeaders"in L&&L.getAllResponseHeaders());d4((function(ee){t(ee),B()}),(function(ee){r(ee),B()}),{data:C&&C!=="text"&&C!=="json"?L.response:L.responseText,status:L.status,statusText:L.statusText,headers:Y,config:e,request:L}),L=null}L.open(s.method.toUpperCase(),s.url,!0),L.timeout=s.timeout,"onloadend"in L?L.onloadend=U:L.onreadystatechange=function(){L&&L.readyState===4&&(L.status!==0||L.responseURL&&L.responseURL.indexOf("file:")===0)&&setTimeout(U)},L.onabort=function(){L&&(r(new qr("Request aborted",qr.ECONNABORTED,e,L)),L=null)},L.onerror=function(){r(new qr("Network Error",qr.ERR_NETWORK,e,L)),L=null},L.ontimeout=function(){let Y=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const ee=s.transitional||DM;s.timeoutErrorMessage&&(Y=s.timeoutErrorMessage),r(new qr(Y,ee.clarifyTimeoutError?qr.ETIMEDOUT:qr.ECONNABORTED,e,L)),L=null},c===void 0&&d.setContentType(null),"setRequestHeader"in L&&rt.forEach(d.toJSON(),(function(Y,ee){L.setRequestHeader(ee,Y)})),rt.isUndefined(s.withCredentials)||(L.withCredentials=!!s.withCredentials),C&&C!=="json"&&(L.responseType=s.responseType),A&&([g,E]=Dx(A,!0),L.addEventListener("progress",g)),R&&L.upload&&([f,v]=Dx(R),L.upload.addEventListener("progress",f),L.upload.addEventListener("loadend",v)),(s.cancelToken||s.signal)&&(h=Y=>{L&&(r(!Y||Y.type?new p_(null,e,L):Y),L.abort(),L=null)},s.cancelToken&&s.cancelToken.subscribe(h),s.signal&&(s.signal.aborted?h():s.signal.addEventListener("abort",h)));const X=(function(Y){const ee=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return ee&&ee[1]||""})(s.url);X&&ia.protocols.indexOf(X)===-1?r(new qr("Unsupported protocol "+X+":",qr.ERR_BAD_REQUEST,e)):L.send(c||null)}))},bte=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let s,c=new AbortController;const d=function(v){if(!s){s=!0,f();const E=v instanceof Error?v:this.reason;c.abort(E instanceof qr?E:new p_(E instanceof Error?E.message:E))}};let h=t&&setTimeout((()=>{h=null,d(new qr("timeout ".concat(t," of ms exceeded"),qr.ETIMEDOUT))}),t);const f=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach((v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)})),e=null)};e.forEach((v=>v.addEventListener("abort",d)));const{signal:g}=c;return g.unsubscribe=()=>rt.asap(f),g}},OI=u(nj),_4=c_.f("asyncIterator"),Ste=u(_4);function kI(e,t){this.v=e,this.k=t}function So(e){return function(){return new cE(e.apply(this,arguments))}}function cE(e){var t,r;function s(d,h){try{var f=e[d](h),g=f.value,v=g instanceof kI;OI.resolve(v?g.v:g).then((function(E){if(v){var C=d==="return"?"return":"next";if(!g.k||E.done)return s(C,E);E=e[C](E).value}c(f.done?"return":"normal",E)}),(function(E){s("throw",E)}))}catch(E){c("throw",E)}}function c(d,h){switch(d){case"return":t.resolve({value:h,done:!0});break;case"throw":t.reject(h);break;default:t.resolve({value:h,done:!1})}(t=t.next)?s(t.key,t.arg):r=null}this._invoke=function(d,h){return new OI((function(f,g){var v={key:d,arg:h,resolve:f,reject:g,next:null};r?r=r.next=v:(t=r=v,s(d,h))}))},typeof e.return!="function"&&(this.return=void 0)}function yr(e){return new kI(e,0)}function jx(e){var t={},r=!1;function s(c,d){return r=!0,d=new OI((function(h){h(e[c](d))})),{done:!1,value:new kI(d,1)}}return t[h_!==void 0&&HU||"@@iterator"]=function(){return this},t.next=function(c){return r?(r=!1,c):s("next",c)},typeof e.throw=="function"&&(t.throw=function(c){if(r)throw r=!1,c;return s("throw",c)}),typeof e.return=="function"&&(t.return=function(c){return r?(r=!1,c):s("return",c)}),t}cE.prototype[typeof h_=="function"&&Ste||"@@asyncIterator"]=function(){return this},cE.prototype.next=function(e){return this._invoke("next",e)},cE.prototype.throw=function(e){return this._invoke("throw",e)},cE.prototype.return=function(e){return this._invoke("return",e)};var PI=u(_4);function DI(e){var t,r,s,c=2;for(typeof Symbol<"u"&&(r=PI,s=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new Lx(t.call(e));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Lx(e){function t(r){if(Object(r)!==r)return nt.reject(new TypeError(r+" is not an object."));var s=r.done;return nt.resolve(r.value).then((function(c){return{value:c,done:s}}))}return Lx=function(r){this.s=r,this.n=r.next},Lx.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var s=this.s.return;return s===void 0?nt.resolve({value:r,done:!0}):t(s.apply(this.s,arguments))},throw:function(r){var s=this.s.return;return s===void 0?nt.reject(r):t(s.apply(this.s,arguments))}},new Lx(e)}const xte=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let s,c=0;for(;c<r;)s=c+t,yield e.slice(c,s),c=s},Tte=(function(){var e=So((function*(t,r){var s,c=!1,d=!1;try{for(var h,f=DI(Cte(t));c=!(h=yield yr(f.next())).done;c=!1){const g=h.value;yield*jx(DI(xte(g,r)))}}catch(g){d=!0,s=g}finally{try{c&&f.return!=null&&(yield yr(f.return()))}finally{if(d)throw s}}}));return function(t,r){return e.apply(this,arguments)}})(),Cte=(function(){var e=So((function*(t){if(t[PI])return void(yield*jx(DI(t)));const r=t.getReader();try{for(;;){const{done:s,value:c}=yield yr(r.read());if(s)break;yield c}}finally{yield yr(r.cancel())}}));return function(t){return e.apply(this,arguments)}})(),y4=(e,t,r,s)=>{const c=Tte(e,t);let d,h=0,f=g=>{d||(d=!0,s&&s(g))};return new ReadableStream({async pull(g){try{const{done:v,value:E}=await c.next();if(v)return f(),void g.close();let C=E.byteLength;if(r){let R=h+=C;r(R)}g.enqueue(new Uint8Array(E))}catch(v){throw f(v),v}},cancel:g=>(f(g),c.return())},{highWaterMark:2})};function v4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function E4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v4(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v4(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const Mx=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",w4=Mx&&typeof ReadableStream=="function",Rte=Mx&&(typeof TextEncoder=="function"?(b4=new TextEncoder,e=>b4.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var b4;const S4=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return!!e(...r)}catch{return!1}},Nte=w4&&S4((()=>{let e=!1;const t=new Request(ia.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),jI=w4&&S4((()=>rt.isReadableStream(new Response("").body))),Ux={stream:jI&&(e=>e.body)};var x4;Mx&&(x4=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Ux[e]&&(Ux[e]=rt.isFunction(x4[e])?t=>t[e]():(t,r)=>{throw new qr("Response type '".concat(e,"' is not supported"),qr.ERR_NOT_SUPPORT,r)})})));const Ate=async(e,t)=>{const r=rt.toFiniteNumber(e.getContentLength());return r??(async s=>s==null?0:rt.isBlob(s)?s.size:rt.isSpecCompliantForm(s)?(await new Request(ia.origin,{method:"POST",body:s}).arrayBuffer()).byteLength:rt.isArrayBufferView(s)||rt.isArrayBuffer(s)?s.byteLength:(rt.isURLSearchParams(s)&&(s+=""),rt.isString(s)?(await Rte(s)).byteLength:void 0))(t)};var Ite=Mx&&(async e=>{let{url:t,method:r,data:s,signal:c,cancelToken:d,timeout:h,onDownloadProgress:f,onUploadProgress:g,responseType:v,headers:E,withCredentials:C="same-origin",fetchOptions:R}=g4(e);v=v?(v+"").toLowerCase():"text";let A,B=bte([c,d&&d.toAbortSignal()],h);const L=B&&B.unsubscribe&&(()=>{B.unsubscribe()});let U;try{if(g&&Nte&&r!=="get"&&r!=="head"&&(U=await Ate(E,s))!==0){let de,ne=new Request(t,{method:"POST",body:s,duplex:"half"});if(rt.isFormData(s)&&(de=ne.headers.get("content-type"))&&E.setContentType(de),ne.body){const[be,Ae]=u4(U,Dx(h4(g)));s=y4(ne.body,65536,be,Ae)}}rt.isString(C)||(C=C?"include":"omit");const X="credentials"in Request.prototype;A=new Request(t,E4(E4({},R),{},{signal:B,method:r.toUpperCase(),headers:E.normalize().toJSON(),body:s,duplex:"half",credentials:X?C:void 0}));let Y=await fetch(A);const ee=jI&&(v==="stream"||v==="response");if(jI&&(f||ee&&L)){const de={};["status","statusText","headers"].forEach((Ue=>{de[Ue]=Y[Ue]}));const ne=rt.toFiniteNumber(Y.headers.get("content-length")),[be,Ae]=f&&u4(ne,Dx(h4(f),!0))||[];Y=new Response(y4(Y.body,65536,be,(()=>{Ae&&Ae(),L&&L()})),de)}v=v||"text";let ue=await Ux[rt.findKey(Ux,v)||"text"](Y,e);return!ee&&L&&L(),await new nt(((de,ne)=>{d4(de,ne,{data:ue,headers:rl.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:A})}))}catch(X){throw L&&L(),X&&X.name==="TypeError"&&/Load failed|fetch/i.test(X.message)?Object.assign(new qr("Network Error",qr.ERR_NETWORK,e,A),{cause:X.cause||X}):qr.from(X,X&&X.code,e,A)}});const LI={http:null,xhr:wte,fetch:Ite};rt.forEach(LI,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));const T4=e=>"- ".concat(e),Ote=e=>rt.isFunction(e)||e===null||e===!1;var C4={getAdapter:e=>{e=rt.isArray(e)?e:[e];const{length:t}=e;let r,s;const c={};for(let d=0;d<t;d++){let h;if(r=e[d],s=r,!Ote(r)&&(s=LI[(h=String(r)).toLowerCase()],s===void 0))throw new qr("Unknown adapter '".concat(h,"'"));if(s)break;c[h||"#"+d]=s}if(!s){const d=Object.entries(c).map((h=>{let[f,g]=h;return"adapter ".concat(f," ")+(g===!1?"is not supported by the environment":"is not available in the build")}));throw new qr("There is no suitable adapter to dispatch the request "+(t?d.length>1?`since :
`+d.map(T4).join(`
`):" "+T4(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return s},adapters:LI};function MI(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new p_(null,e)}function R4(e){return MI(e),e.headers=rl.from(e.headers),e.data=II.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),C4.getAdapter(e.adapter||NI.adapter)(e).then((function(t){return MI(e),t.data=II.call(e,e.transformResponse,t),t.headers=rl.from(t.headers),t}),(function(t){return l4(t)||(MI(e),t&&t.response&&(t.response.data=II.call(e,e.transformResponse,t.response),t.response.headers=rl.from(t.response.headers))),nt.reject(t)}))}const N4="1.9.0",Fx={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Fx[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const A4={};Fx.transitional=function(e,t,r){function s(c,d){return"[Axios v"+N4+"] Transitional option '"+c+"'"+d+(r?". "+r:"")}return(c,d,h)=>{if(e===!1)throw new qr(s(d," has been removed"+(t?" in "+t:"")),qr.ERR_DEPRECATED);return t&&!A4[d]&&(A4[d]=!0,console.warn(s(d," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(c,d,h)}},Fx.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var Vx={assertOptions:function(e,t,r){if(typeof e!="object")throw new qr("options must be an object",qr.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let c=s.length;for(;c-- >0;){const d=s[c],h=t[d];if(h){const f=e[d],g=f===void 0||h(f,d,e);if(g!==!0)throw new qr("option "+d+" must be "+g,qr.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new qr("Unknown option "+d,qr.ERR_BAD_OPTION)}},validators:Fx};const id=Vx.validators;let Bx=class{constructor(e){this.defaults=e||{},this.interceptors={request:new PM,response:new PM}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const c=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?c&&!String(r.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+c):r.stack=c}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Rf(this.defaults,t);const{transitional:r,paramsSerializer:s,headers:c}=t;r!==void 0&&Vx.assertOptions(r,{silentJSONParsing:id.transitional(id.boolean),forcedJSONParsing:id.transitional(id.boolean),clarifyTimeoutError:id.transitional(id.boolean)},!1),s!=null&&(rt.isFunction(s)?t.paramsSerializer={serialize:s}:Vx.assertOptions(s,{encode:id.function,serialize:id.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Vx.assertOptions(t,{baseUrl:id.spelling("baseURL"),withXsrfToken:id.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let d=c&&rt.merge(c.common,c[t.method]);c&&rt.forEach(["delete","get","head","post","put","patch","common"],(A=>{delete c[A]})),t.headers=rl.concat(d,c);const h=[];let f=!0;this.interceptors.request.forEach((function(A){typeof A.runWhen=="function"&&A.runWhen(t)===!1||(f=f&&A.synchronous,h.unshift(A.fulfilled,A.rejected))}));const g=[];let v;this.interceptors.response.forEach((function(A){g.push(A.fulfilled,A.rejected)}));let E,C=0;if(!f){const A=[R4.bind(this),void 0];for(A.unshift.apply(A,h),A.push.apply(A,g),E=A.length,v=nt.resolve(t);C<E;)v=v.then(A[C++],A[C++]);return v}E=h.length;let R=t;for(C=0;C<E;){const A=h[C++],B=h[C++];try{R=A(R)}catch(L){B.call(this,L);break}}try{v=R4.call(this,R)}catch(A){return nt.reject(A)}for(C=0,E=g.length;C<E;)v=v.then(g[C++],g[C++]);return v}getUri(e){return kM(p4((e=Rf(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};rt.forEach(["delete","get","head","options"],(function(e){Bx.prototype[e]=function(t,r){return this.request(Rf(r||{},{method:e,url:t,data:(r||{}).data}))}})),rt.forEach(["post","put","patch"],(function(e){function t(r){return function(s,c,d){return this.request(Rf(d||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}Bx.prototype[e]=t(),Bx.prototype[e+"Form"]=t(!0)}));var Wx=Bx;class UI{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new nt((function(c){r=c}));const s=this;this.promise.then((c=>{if(!s._listeners)return;let d=s._listeners.length;for(;d-- >0;)s._listeners[d](c);s._listeners=null})),this.promise.then=c=>{let d;const h=new nt((f=>{s.subscribe(f),d=f})).then(c);return h.cancel=function(){s.unsubscribe(d)},h},t((function(c,d,h){s.reason||(s.reason=new p_(c,d,h),r(s.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=s=>{t.abort(s)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new UI((function(s){t=s})),cancel:t}}}var kte=UI;const FI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(FI).forEach((e=>{let[t,r]=e;FI[r]=t}));var Pte=FI;const si=(function e(t){const r=new Wx(t),s=mM(Wx.prototype.request,r);return rt.extend(s,Wx.prototype,r,{allOwnKeys:!0}),rt.extend(s,r,null,{allOwnKeys:!0}),s.create=function(c){return e(Rf(t,c))},s})(NI);si.Axios=Wx,si.CanceledError=p_,si.CancelToken=kte,si.isCancel=l4,si.VERSION=N4,si.toFormData=wx,si.AxiosError=qr,si.Cancel=si.CanceledError,si.all=function(e){return nt.all(e)},si.spread=function(e){return function(t){return e.apply(null,t)}},si.isAxiosError=function(e){return rt.isObject(e)&&e.isAxiosError===!0},si.mergeConfig=Rf,si.AxiosHeaders=rl,si.formToJSON=e=>o4(rt.isHTMLForm(e)?new FormData(e):e),si.getAdapter=C4.getAdapter,si.HttpStatusCode=Pte,si.default=si;var qi=si;const Dte=()=>{};function lE(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Dte};return e.promise=new nt(((t,r)=>{e.resolve=s=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(s),e.value=s)},e.reject=s=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(s))}})),e}const qx=new Map,Gx=new Map,ad=new Map;let ls=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),br=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({});const I4=new dQ;let nl=I4.getResult(),VI=null;function fr(e){if(!VI){nl=I4.getResult();const t=(function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return br.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return br.CHROME;case"Safari":case"Mobile Safari":return br.SAFARI;case"Edge":return br.EDGE;case"Firefox":return br.FIREFOX;case"QQ":case"QQBrowser":return br.QQ;case"Opera":return br.OPERA;case"WeChat":return br.WECHAT;default:return f.browser.name||""}})(nl),r=O4(nl),s=(function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""})(nl),c=nl.os.version,d=O4(nl,!1),h=nl.device.type;if(!(t&&r&&s&&c))return{name:t,version:r,os:s,osVersion:c,browserVersion:d,deviceType:h};VI={name:t,version:r,os:s,osVersion:c,browserVersion:d,deviceType:h}}return VI}function O4(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function Hx(){return fr().os}function k4(){const e=fr();return"".concat(e.os," ").concat(e.osVersion)}function Kx(){const e=fr();return!!(nl.engine.name==="WebKit"&&e.os===ls.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==br.SAFARI||ii()&&e.name!==br.SAFARI)}function iu(){return fr().name===br.CHROME}function Us(){return fr().name===br.SAFARI}function P4(){const e=fr();if(e.name!==br.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function D4(){return fr().name===br.EDGE}function Sn(){return fr().name===br.FIREFOX}function ii(){return fr().os===ls.IOS}function f_(e){const t=fr();return!(t.name!==br.CHROME||!t.osVersion)&&Number(t.version)>=e}function j4(e){const t=fr();return!(t.name!==br.CHROME||!t.osVersion)&&Number(t.version)<e}function BI(e,t,r){const s=fr();return!(s.name!==e||!s.osVersion)&&(r?Number(s.version)>=t&&Number(s.version)<=r:Number(s.version)===t)}function WI(e){const t=fr();return!(t.name!==br.EDGE||!t.osVersion)&&Number(t.version)>=e}function qI(e){const t=fr();return!(t.name!==br.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function L4(e){const t=fr();return!(t.name!==br.SAFARI||!t.osVersion)&&Number(t.version)>=e}function M4(e,t,r){const s=fr();if(s.os!==ls.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])>t||Number(c[0])>e:t?Number(c[0])===e&&Number(c[1])>=t||Number(c[0])>e:Number(c[0])>=e}function U4(e,t,r){const s=fr();if(s.os!==ls.IOS||!s.osVersion)return!1;const c=s.osVersion.split(".");return t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e}function GI(e,t,r){const s=fr();if(s.name!==br.SAFARI||!s.osVersion||!s.browserVersion)return!1;const c=s.browserVersion.split(".");return r?t&&Number(c[0])===e&&Number(c[1])<t||Number(c[0])<e:t?Number(c[0])===e&&Number(c[1])<=t||Number(c[0])<e:Number(c[0])<=e}function HI(e){const t=fr();return!(t.name!==br.OPERA||!t.osVersion)&&Number(t.version)>=e}function F4(){const e=fr();if(e.os!==ls.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function m_(){const e=fr();if(e.os!==ls.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function KI(){const e=fr();if(e.os!==ls.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function V4(){const e=fr();if(e.os!==ls.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function sc(){return Us()&&navigator.maxTouchPoints>0}function B4(){return fr().name===br.WECHAT}function W4(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function zI(){const e=Hx();return(function(){const{deviceType:t}=fr();return t==="mobile"||t==="tablet"})()||e===ls.ANDROID||e===ls.IOS||e===ls.HARMONY_OS}function au(){const e=fr();return e.name!==br.EDGE&&e.name!==br.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function zx(){return Hx()===ls.ANDROID}function dE(){const e=fr();return zx()&&(e.name===br.CHROME||e.name===br.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ut(e,t,r){return(t=(function(s){var c=(function(d,h){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var g=f.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(s);return typeof c=="symbol"?c:c+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function Ke(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q4(Object(r),!0).forEach((function(s){Ut(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q4(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}let J=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),Ne=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),Ut(this,"code",void 0),Ut(this,"message",void 0),Ut(this,"data",void 0),Ut(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function sl(e,t){if(typeof e!="boolean")throw new Ne(J.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ns(e,t,r){if(!$e(r).call(r,e))throw new Ne(J.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Gr(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>s||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(c){return typeof c=="number"&&c%1==0})(e))throw new Ne(J.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(s,"]. integer only"))}function $I(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ne(J.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Gr(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Gr(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Gr(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Gr(e.ideal,"".concat(t,".ideal"),1,1/0)}else Gr(e,t,1,1/0)}function Rs(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ne(J.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!G4(e,r,s,c))throw new Ne(J.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function ou(e,t){if(!Array.isArray(e))throw new Ne(J.INVALID_PARAMS,"".concat(t," should be an array"))}function xn(e){return e==null}function G4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,s=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!s||(function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0})(e))}var uE=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(uE||{}),YI=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(YI||{});const H4=new class{constructor(){Ut(this,"_clientSize",null),Ut(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),Ut(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),Ut(this,"getStyle",(e=>window.getComputedStyle(e,null))),Ut(this,"checkCssVisibleProperty",(e=>{var t;let r=!0;const s=this.getStyle(e),{display:c,visibility:d,opacity:h,filter:f}=s;return(c==="none"||$e(t=["hidden","collapse"]).call(t,d)||Number(h)<.1)&&(r=!1),!!r&&(f&&f.split(" ").filter((g=>{var v;const E=g.split("(")[0];return $e(v=["brightness","blur","opacity"]).call(v,E)})).map((g=>{const[v,E]=g.split(/\(|\)/);return[v,Number(E.match(/^[0-9\.]+/))]})).forEach((g=>{const[v,E]=g;switch(v){case"brightness":(E<.1||E>3)&&(r=!1);break;case"blur":E>3&&(r=!1);break;case"opacity":E<.1&&(r=!1)}})),r)})),Ut(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let r=!0,s=!0;const c=h=>t(h);let d=e;for(;d&&s;)c(d)||(r=!1,s=!1),d=d.parentElement,d||(s=!1);return r})),Ut(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),Ut(this,"getSizeAboutClient",(e=>{const{width:t,height:r,left:s,right:c,top:d,bottom:h}=e.getBoundingClientRect(),f=this.getClientWidth(),g=this.getClientHeight();return{width:t,height:r,left:s,right:c,top:d,bottom:h,clientWidth:f,clientHeight:g,clientMin:Math.min(f,g)}})),Ut(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)})),Ut(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),Ut(this,"checkCoverForAPoint",((e,t,r)=>{const s=this.elementFromPoint(e,t);return s!==null&&s!==r})),Ut(this,"getPointPositionList",(()=>{const{width:e,height:t,left:r,top:s}=this._clientSize,c=e/6,d=t/6,h=[],f=10**6;for(let g=0;g<5;g++)for(let v=0;v<5;v++){const E=(r*f+(g===0?.1:g===4?(c*g*f-1e5)/f:c*g)*f)/f,C=(s*f+(v===0?.1:v===4?(d*v*f-1e5)/f:d*v)*f)/f;h.push({x:E,y:C})}return[...h]})),Ut(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((t=>!!t)).length>6)),Ut(this,"checkSizeIsVisible",((e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10))),Ut(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:r,bottom:s,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let f,g,v,E;if(e<0)f=0;else{if(!(e<d))return!1;f=e}if(t<0)return!1;if(g=t<d?t:d,r<0)v=0;else{if(!(r<c))return!1;v=r}if(s<0)return!1;E=s<c?s:c;const C=g-f,R=E-v;return this.checkSizeIsVisible(C,R,h)})),Ut(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),Ut(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(uE.COVERED);{const t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(uE.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(uE.SIZE)}}return this.returnHiddenResult(uE.STYLE)}return this.returnHiddenResult(YI.UNMOUNTED)}return this.returnHiddenResult(YI.INVALID_HTML_ELEMENT)})),Ut(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))))}};function XI(e){return new TextEncoder().encode(e)}const K4=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},JI=async e=>(function(t,r){let s="";return new Uint8Array(t).forEach((c=>{s+=c.toString(r).padStart(2,"0")})),s})(await crypto.subtle.digest("SHA-256",XI(e)),16);class _n{constructor(){Ut(this,"_events",{}),Ut(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((r=>r.listener)):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],c=this._indexOfListener(s,r);c!==-1&&s.splice(c,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map((h=>h));for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];for(let h=0;h<r.length;h+=1){const f=r[h];f.once&&this.off(t,f.listener),f.listener.apply(this,c||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),c=1;c<r;c++)s[c-1]=arguments[c];[...this._events[t]||[]].forEach((d=>{d.once&&this.off(t,d.listener);try{d.listener.apply(this,s)}catch(h){console.error("safeEmit event:".concat(t," error ").concat(h==null?void 0:h.toString()))}}))}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}}let hE=null;function z4(){if(hE)return hE;if(window.electron)return hE=window.electron;if(!window.require)return null;try{return hE=window.require("electron"),hE}catch{return null}}let In=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),un=(function(e){return e.TRACER="tracer",e})({});function $4(e){return Gr(e.timeout,"config.timeout",0,1e5),Gr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Gr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Gr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let jte=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),Pr=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function pE(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((t=>{if(!t.urls)throw Error()}))}catch{return!1}return!0}function Y4(e){return Rs(e.turnServerURL,"turnServerURL"),Rs(e.username,"username"),Rs(e.password,"password"),e.udpport&&Gr(e.udpport,"udpport",1,99999,!0),e.forceturn&&sl(e.forceturn,"forceturn"),e.security&&sl(e.security,"security"),e.tcpport&&Gr(e.tcpport,"tcpport",1,99999,!0),!0}function QI(e){return e.level!==void 0&&ns(e.level,"level",[1,2,3]),e.delay!==void 0&&Gr(e.delay,"delay",0,3e3,!0),!0}let ir=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),Fs=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),Ra=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),g_=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function Vs(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return e.getListeners(t).length===0?nt.reject(new Ne(J.UNEXPECTED_ERROR,"can not emit promise")):new nt(((d,h)=>{e.emit(t,...s,d,h)}))}function Kr(e,t){if(e.getListeners(t).length===0)return nt.resolve();for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return Vs(e,t,...s)}function Ga(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return fE(e,t,...s)}function fE(e,t){let r=null,s=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(e.emit(t,...d,(f=>{r=f}),(f=>{s=f})),s!==null)throw s;if(r===null)throw new Ne(J.UNEXPECTED_ERROR,"handler is not sync");return r}const Un=new class extends _n{set networkState(e){this.emit(g_.NETWORK_STATE_CHANGE,e,this._networkState),e===Ra.ONLINE?this.emit(g_.ONLINE):e===Ra.OFFLINE&&(this.onlineWaiter=new nt((t=>{this.once(g_.ONLINE,(()=>{this.onlineWaiter=void 0,t(Ra.ONLINE)}))})),this.emit(g_.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ra.ONLINE}constructor(){super(),Ut(this,"_moduleName","network-indicator"),Ut(this,"_networkState",Ra.ONLINE),Ut(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=Ra.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=Ra.OFFLINE}))}};function $x(e,t){const r=e.indexOf(t);r!==-1&&e.splice(r,1)}function __(e){const t=[];return e.forEach((r=>{t.indexOf(r)===-1&&t.push(r)})),t}function Yx(e){nt!==void 0?nt.resolve().then(e):setTimeout(e,0)}function hn(e){return JSON.parse(JSON.stringify(e))}function Nf(e){try{return hn(e)}catch{return e}}const X4={};function Th(e,t){X4[t]||(X4[t]=!0,e())}function Af(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let s=0;s<t.length;s+=1)r[s]=t.charCodeAt(s);return r}function Ch(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function J4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const s=new Uint8Array(t);s.set(r),r=s}return r}function Q4(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=ea(t).call(t,((h,f)=>h+f.length),0),c=new Uint8Array(new ArrayBuffer(s));let d=0;return t.forEach((h=>{c.set(h,d),d+=h.length})),c}function od(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Z4(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((r=>{t+=typeof r=="string"?od(r):r.size})),t+138}function Lte(e){const t=new Ne(J.TIMEOUT,"timeout");return new nt(((r,s)=>{window.setTimeout((()=>s(t)),e)}))}function Ns(e){return new nt((t=>{window.setTimeout(t,e)}))}function zr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+zr(e-r.length,"")}function If(){return zr(32,"").toUpperCase()}const Xx=()=>{},e3=new class{constructor(){Ut(this,"fnMap",new Map)}throttleByKey(e,t,r,s){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(t)){const f=this.fnMap.get(t);if(f.threshold!==r){f.fn(...f.args),clearTimeout(f.timer);const g=window.setTimeout((()=>{const v=this.fnMap.get(t);v&&v.fn(...v.args),this.fnMap.delete(t)}),r);this.fnMap.set(t,{fn:e,threshold:r,timer:g,args:d,skipFn:s})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(t,Ke(Ke({},f),{},{fn:e,args:d,skipFn:s}))}else{const f=window.setTimeout((()=>{const g=this.fnMap.get(t);g&&g.fn(...g.args),this.fnMap.delete(t)}),r);this.fnMap.set(t,{fn:e,threshold:r,timer:f,args:d,skipFn:s})}}},t3=e3.throttleByKey.bind(e3);function r3(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function ZI(e,t){if(!r3(e)||!r3(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let s=0;s<t.length;s++)r[s]=ZI(e[s],t[s]);return r}{const r=Ke({},e);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(Object.prototype.hasOwnProperty.call(e,s)?r[s]=ZI(e[s],t[s]):r[s]=t[s]);return r}}function n3(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let s=0;for(;e>0&&(r[s]=255&e,e>>=8,s++,s!==t););return r}function y_(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function eO(e){return ea(e).call(e,((t,r)=>t+r),0)}function s3(e){const t="0123456789abcdef";function r(ee){let ue,de="";for(ue=0;ue<=3;ue++)de+=t.charAt(ee>>8*ue+4&15)+t.charAt(ee>>8*ue&15);return de}function s(ee,ue){const de=(65535&ee)+(65535&ue);return(ee>>16)+(ue>>16)+(de>>16)<<16|65535&de}function c(ee,ue,de,ne,be,Ae){return s((function(Ue,He){return Ue<<He|Ue>>>32-He})(s(s(ue,ee),s(ne,Ae)),be),de)}function d(ee,ue,de,ne,be,Ae,Ue){return c(ue&de|~ue&ne,ee,ue,be,Ae,Ue)}function h(ee,ue,de,ne,be,Ae,Ue){return c(ue&ne|de&~ne,ee,ue,be,Ae,Ue)}function f(ee,ue,de,ne,be,Ae,Ue){return c(ue^de^ne,ee,ue,be,Ae,Ue)}function g(ee,ue,de,ne,be,Ae,Ue){return c(de^(ue|~ne),ee,ue,be,Ae,Ue)}const v=(function(ee){let ue;const de=1+(ee.length+8>>6),ne=new Array(16*de);for(ue=0;ue<16*de;ue++)ne[ue]=0;for(ue=0;ue<ee.length;ue++)ne[ue>>2]|=ee.charCodeAt(ue)<<ue%4*8;return ne[ue>>2]|=128<<ue%4*8,ne[16*de-2]=8*ee.length,ne})(e);let E,C,R,A,B,L=1732584193,U=-271733879,X=-1732584194,Y=271733878;for(E=0;E<v.length;E+=16)C=L,R=U,A=X,B=Y,L=d(L,U,X,Y,v[E+0],7,-680876936),Y=d(Y,L,U,X,v[E+1],12,-389564586),X=d(X,Y,L,U,v[E+2],17,606105819),U=d(U,X,Y,L,v[E+3],22,-1044525330),L=d(L,U,X,Y,v[E+4],7,-176418897),Y=d(Y,L,U,X,v[E+5],12,1200080426),X=d(X,Y,L,U,v[E+6],17,-1473231341),U=d(U,X,Y,L,v[E+7],22,-45705983),L=d(L,U,X,Y,v[E+8],7,1770035416),Y=d(Y,L,U,X,v[E+9],12,-1958414417),X=d(X,Y,L,U,v[E+10],17,-42063),U=d(U,X,Y,L,v[E+11],22,-1990404162),L=d(L,U,X,Y,v[E+12],7,1804603682),Y=d(Y,L,U,X,v[E+13],12,-40341101),X=d(X,Y,L,U,v[E+14],17,-1502002290),U=d(U,X,Y,L,v[E+15],22,1236535329),L=h(L,U,X,Y,v[E+1],5,-165796510),Y=h(Y,L,U,X,v[E+6],9,-1069501632),X=h(X,Y,L,U,v[E+11],14,643717713),U=h(U,X,Y,L,v[E+0],20,-373897302),L=h(L,U,X,Y,v[E+5],5,-701558691),Y=h(Y,L,U,X,v[E+10],9,38016083),X=h(X,Y,L,U,v[E+15],14,-660478335),U=h(U,X,Y,L,v[E+4],20,-405537848),L=h(L,U,X,Y,v[E+9],5,568446438),Y=h(Y,L,U,X,v[E+14],9,-1019803690),X=h(X,Y,L,U,v[E+3],14,-187363961),U=h(U,X,Y,L,v[E+8],20,1163531501),L=h(L,U,X,Y,v[E+13],5,-1444681467),Y=h(Y,L,U,X,v[E+2],9,-51403784),X=h(X,Y,L,U,v[E+7],14,1735328473),U=h(U,X,Y,L,v[E+12],20,-1926607734),L=f(L,U,X,Y,v[E+5],4,-378558),Y=f(Y,L,U,X,v[E+8],11,-2022574463),X=f(X,Y,L,U,v[E+11],16,1839030562),U=f(U,X,Y,L,v[E+14],23,-35309556),L=f(L,U,X,Y,v[E+1],4,-1530992060),Y=f(Y,L,U,X,v[E+4],11,1272893353),X=f(X,Y,L,U,v[E+7],16,-155497632),U=f(U,X,Y,L,v[E+10],23,-1094730640),L=f(L,U,X,Y,v[E+13],4,681279174),Y=f(Y,L,U,X,v[E+0],11,-358537222),X=f(X,Y,L,U,v[E+3],16,-722521979),U=f(U,X,Y,L,v[E+6],23,76029189),L=f(L,U,X,Y,v[E+9],4,-640364487),Y=f(Y,L,U,X,v[E+12],11,-421815835),X=f(X,Y,L,U,v[E+15],16,530742520),U=f(U,X,Y,L,v[E+2],23,-995338651),L=g(L,U,X,Y,v[E+0],6,-198630844),Y=g(Y,L,U,X,v[E+7],10,1126891415),X=g(X,Y,L,U,v[E+14],15,-1416354905),U=g(U,X,Y,L,v[E+5],21,-57434055),L=g(L,U,X,Y,v[E+12],6,1700485571),Y=g(Y,L,U,X,v[E+3],10,-1894986606),X=g(X,Y,L,U,v[E+10],15,-1051523),U=g(U,X,Y,L,v[E+1],21,-2054922799),L=g(L,U,X,Y,v[E+8],6,1873313359),Y=g(Y,L,U,X,v[E+15],10,-30611744),X=g(X,Y,L,U,v[E+6],15,-1560198380),U=g(U,X,Y,L,v[E+13],21,1309151649),L=g(L,U,X,Y,v[E+4],6,-145523070),Y=g(Y,L,U,X,v[E+11],10,-1120210379),X=g(X,Y,L,U,v[E+2],15,718787259),U=g(U,X,Y,L,v[E+9],21,-343485551),L=s(L,C),U=s(U,R),X=s(X,A),Y=s(Y,B);return r(L)+r(U)+r(X)+r(Y)}let Mte=1,i3=console,Xs=class{static setLogger(e){i3=e}constructor(e,t){Ut(this,"id",void 0),Ut(this,"lockingPromise",nt.resolve()),Ut(this,"locks",0),Ut(this,"name",""),Ut(this,"lockId",void 0),this.lockId=Mte++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");i3.debug("".concat(r," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new nt((c=>{t=()=>{this.locks-=1,this.logger("unlocked",e),c()}})),s=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>r)),s}};function v_(e,t){return function(r,s,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[t];if(!h)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const f=await h.lock("From ".concat(e,".").concat(s));try{for(var g=arguments.length,v=new Array(g),E=0;E<g;E++)v[E]=arguments[E];return await d.apply(this,v)}finally{f()}},c}}const Kn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function tO(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function il(e,t,r,s){const c=Object.assign({},Kn,s);let d=c.timeout;const h=async()=>{await(function(v){return new nt((E=>{window.setTimeout(E,v)}))})(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let f=!1;const g=new nt((async(v,E)=>{t=t||(()=>!1),r=r||(()=>!0);for(let C=0;C<c.maxRetryCount;C+=1){if(f)return E(new Ne(J.OPERATION_ABORTED));try{const R=await e();if(!t(R,C)||C+1===c.maxRetryCount)return v(R);await h()}catch(R){if(!r(R,C)||C+1===c.maxRetryCount)return E(R);await h()}}}));return g.cancel=()=>f=!0,g}let Jx,a3=class{constructor(e){Ut(this,"input",[]),Ut(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ea(e=this.input).call(e,((t,r)=>t+r))/this.input.length}},Qx=0,rO=0;function nO(e,t,r,s){return new nt(((c,d)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),Qx+=od(t.data)):r&&(t.data.size?Qx+=t.data.size:t.data instanceof FormData?Qx+=Z4(t.data):Qx+=od(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,qi.request(t).then((h=>{typeof h.data=="string"?rO+=od(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?rO+=h.data.byteLength:rO+=od(JSON.stringify(h.data)),c(h.data)})).catch((h=>{qi.isCancel(h)?d(new Ne(J.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Ne(J.NETWORK_TIMEOUT,h.message)):h.response?d(new Ne(J.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Ne(J.NETWORK_ERROR,h.message))}))}))}async function Ute(e,t){const r=new Blob([t.data],{type:"buffer"});return await nO(e,Ke(Ke({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const o3=()=>window.isSecureContext!==void 0;function ic(e){if(Array.isArray(e))return e.map((r=>r));if(!c3(e))return e;const t={};for(const r in e){const s=e[r];c3(s)||Array.isArray(s)?t[r]=ic(s):t[r]=s}return t}function c3(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let sO=class{constructor(e){Ut(this,"input",[]),Ut(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const cd={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},mE={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:cd,remoteCandidate:cd},updateInterval:0},l3={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},d3={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},u3={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},h3={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let iO=class{constructor(e,t){Ut(this,"onFirstVideoReceived",void 0),Ut(this,"onFirstVideoDecoded",void 0),Ut(this,"onFirstAudioReceived",void 0),Ut(this,"onFirstVideoDecodedTimeout",void 0),Ut(this,"onFirstAudioDecoded",void 0),Ut(this,"onSelectedLocalCandidateChanged",void 0),Ut(this,"onSelectedRemoteCandidateChanged",void 0),Ut(this,"videoIsReady",!1),Ut(this,"videoIsReady2",{}),Ut(this,"pc",void 0),Ut(this,"options",void 0),Ut(this,"intervalTimer",void 0),Ut(this,"stats",ic(mE)),Ut(this,"isFirstVideoReceived",{}),Ut(this,"isFirstVideoDecoded",{}),Ut(this,"isFirstAudioReceived",{}),Ut(this,"isFirstAudioDecoded",{}),Ut(this,"isFirstVideoDecodedTimeout",{}),Ut(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new nt((e=>{e({local:Ke({},cd),remote:Ke({},cd)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,c=0,d=0,h=0;for(const f of r)e[f].forEach(((g,v)=>{if(!this.lossRateWindowStats[t-1][f][v]||!this.lossRateWindowStats[0][f][v])return;const E=this.lossRateWindowStats[t-1][f][v].packets-this.lossRateWindowStats[0][f][v].packets,C=this.lossRateWindowStats[t-1][f][v].packetsLost-this.lossRateWindowStats[0][f][v].packetsLost;f==="videoSend"||f==="audioSend"?(s+=E,d+=C):(c+=E,h+=C),Number.isNaN(E)||Number.isNaN(E)?g.packetLostRate=0:g.packetLostRate=E<=0||C<=0?0:C/(E+C)}));e.sendPacketLossRate=s<=0||d<=0?0:d/(s+d),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Fte=class extends iO{constructor(){super(...arguments),Ut(this,"_stats",mE),Ut(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=ic(mE);const r=t.filter((c=>c.type==="ssrc"));this.processSSRCStats(r);const s=t.find((c=>c.type==="VideoBwe"));s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((t=>{var r;const s=$e(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(s?"send":"recv")){case"video_send":{const c=ic(d3);c.codec=t.googCodecName,c.adaptionChangeReason="none",t.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(t.googAvgEncodeMs),c.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},c.firsCount=Number(t.googFirReceived),c.nacksCount=Number(t.googNacksReceived),c.plisCount=Number(t.googPlisReceived),c.frameCount=Number(t.framesEncoded),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=ic(l3),d=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(c.codec=t.googCodecName,c.targetDelayMs=Number(t.googTargetDelayMs),c.renderDelayMs=Number(t.googRenderDelayMs),c.currentDelayMs=Number(t.googCurrentDelayMs),c.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),c.decodeMs=Number(t.googDecodeMs),c.maxDecodeMs=Number(t.googMaxDecodeMs),c.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},c.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},c.decodeFrameRate=Number(t.googFrameRateDecoded),c.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},c.jitterBufferMs=Number(t.googJitterBufferMs),c.firsCount=Number(t.googFirsSent),c.nacksCount=Number(t.googNacksSent),c.plisCount=Number(t.googPlisSent),c.framesDecodeCount=Number(t.framesDecoded),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,f=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=f,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ke({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=ic(h3);c.codec=t.googCodecName,c.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,c.decodingCNG=Number(t.googDecodingCNG),c.decodingCTN=Number(t.googDecodingCTN),c.decodingCTSG=Number(t.googDecodingCTSG),c.decodingNormal=Number(t.googDecodingNormal),c.decodingPLC=Number(t.googDecodingPLC),c.decodingPLCCNG=Number(t.googDecodingPLCCNG),c.expandRate=Number(t.googExpandRate),c.accelerateRate=Number(t.googAccelerateRate),c.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),c.speechExpandRate=Number(t.googSpeechExpandRate),c.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),c.jitterBufferMs=Number(t.googJitterBufferMs),c.jitterMs=Number(t.googJitterReceived),c.bytes=Number(t.bytesReceived),c.packets=Number(t.packetsReceived),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),c.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=ic(u3);c.codec=t.googCodecName,c.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,c.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(t.bytesSent),c.packets=Number(t.packetsSent),c.packetsLost=Number(t.packetsLost),c.ssrc=Number(t.ssrc),c.rttMs=Number(t.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}}))}_getStats(){return new nt(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((r=>{const s={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach((c=>{s[c]=r.stat(c)})),t.push(s)})),t}},gE=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),Zx=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),aO=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),Ha=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var E_=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(E_||{});function _E(e,t,r,s){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:E_.kNone;if(!t)return;const d=Number(t[r]);if(typeof d!="number")return;const h=Number(t[s]);if(typeof h!="number")return;if(!e)return h?d/h*c:void 0;const f=Number(e[r]);if(typeof f!="number")return;const g=Number(e[s]);if(typeof g!="number")return;const v=h-g;return v?(d-f)/v*c:void 0}let p3=class extends iO{constructor(){super(...arguments),Ut(this,"_stats",mE),Ut(this,"report",void 0),Ut(this,"lastDecodeVideoReceiverStats",new Map),Ut(this,"lastVideoFramesRecv",new Map),Ut(this,"lastVideoFramesSent",new Map),Ut(this,"lastVideoFramesDecode",new Map),Ut(this,"lastVideoFramesOutput",new Map),Ut(this,"lastVideoJBDelay",new Map),Ut(this,"lastAudioJBDelay",new Map),Ut(this,"mediaBytesSent",new Map),Ut(this,"mediaBytesRetransmit",new Map),Ut(this,"mediaBytesTargetEncode",new Map),Ut(this,"lastDecodeAudioReceiverStats",new Map),Ut(this,"lastAudioConcealment",new Map),Ut(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ic(mE),this.report.forEach((e=>{switch(e.type){case Ha.OUTBOUND:case Ha.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,s=!t&&!("frameWidth"in e);e.type===Ha.OUTBOUND?t==="audio"||s?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===Ha.INBOUND&&(t==="audio"||s?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case Ha.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case Ha.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Ke({},cd),remote:Ke({},cd)};return e.forEach((r=>{let s;if(r.type===Ha.TRANSPORT&&(s=e.get(r.selectedCandidatePairId)),r.type===Ha.CANDIDATE_PAIR&&r.selected&&(s=r),s){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(s.localCandidateId){const d=e.get(s.localCandidateId);d&&c(t.local,d)}if(s.remoteCandidateId){const d=e.get(s.remoteCandidateId);d&&c(t.remote,d)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===Ha.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===Ha.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===Ha.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ke({},t),Ke({},this.stats.selectedCandidatePair.localCandidate)),e.type===Ha.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ke({},t),Ke({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((s=>s.ssrc===e.ssrc));t||(t=ic(h3),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=_E(r,t,"totalProcessingDelay","jitterBufferEmittedCount",E_.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,r,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Ke({},t))}calculateAudioFreeze(e,t,r){const s=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&s!=null){const c=s.lts,d=r.timestamp,h=d-c;if(h<=0)return;const f=e.concealedSamples-t.concealedSamples-0,g=s.nonSilent+f,v=e.totalSamplesReceived-t.totalSamplesReceived;if(v<=0)return;const E=80*v/h,C=200*v/h,R=h/v;let A=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,g>E&&(s.plc80>0?(e.freezeSamples80+=f,e.freezeMs80+=Math.round(f*R)):(e.freezeSamples80+=g,e.freezeMs80+=Math.round(g*R)),A=s.plc80+1);let B=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,g>C&&(s.plc200>0?(e.freezeSamples200+=f,e.freezeMs200+=Math.round(f*R)):(e.freezeSamples200+=g,e.freezeMs200+=Math.round(g*R)),B=s.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:f,lts:d,plc80:A,plc200:B})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:r.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((h=>h.ssrc===e.ssrc));t||(t=ic(l3),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),s=this.lastVideoFramesDecode.get(t.ssrc),c=this.lastVideoFramesOutput.get(t.ssrc),d=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const h=t.decodedFrame?t.decodedFrame.width:0,f=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,h,f),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const h=r.stats,f=d-r.lts;t.framesDecodeFreezeTime=h.framesDecodeFreezeTime,t.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&f>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=f,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<h.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=_E(r==null?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=_E(r==null?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",E_.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=_E(r==null?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",E_.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=_E(r==null?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",E_.kMillisecondsFromSeconds),s&&d-s.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-s.count)/((d-s.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:t.decodeFrameRate})):s?t.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:d,rate:0}),t.framesDroppedCount&&e.framesReceived&&(c&&d-c.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:Math.max(t.outputFrameRate,0)})):c?t.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Ke({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((s=>s.ssrc===e.ssrc));t||(t=ic(d3),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const s=new sO(10);s.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,s)}if(e.retransmittedBytesSent!==void 0){const s=this.mediaBytesRetransmit.get(e.ssrc);if(s)s.add(e.retransmittedBytesSent);else{const c=new sO(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const s=this.mediaBytesTargetEncode.get(e.ssrc);if(s)s.add(e.totalEncodedBytesTarget);else{const c=new sO(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const s=this.lastEncoderMs.get(e.ssrc);if(!s||s.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-s.lastFrameCount,d=e.totalEncodeTime-s.lastEncoderTime;t.avgEncodeMs=1e3*d/c}}if(e.framesEncoded&&e.qpSum){const s=this.lastEncoderMs.get(e.ssrc);!s||s.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-s.lastQpSum)/(e.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const s=this.findRemoteStatsId(e.ssrc,Ha.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((r=>r.ssrc===e.ssrc));if(t||(t=ic(u3),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,Ha.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;const s=Array.from(xa(r=this.report).call(r)).find((c=>c.type===t&&c.ssrc===e));return s?s.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var s,c,d,h;const f=t?this.report.get(t):void 0,g=(s=f==null?void 0:f.framesSent)!==null&&s!==void 0?s:e.framesSent;if(typeof g!="number")return;let v=(c=f==null?void 0:f.frameWidth)!==null&&c!==void 0?c:e.frameWidth,E=(d=f==null?void 0:f.frameHeight)!==null&&d!==void 0?d:e.frameHeight,C=(h=f==null?void 0:f.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof v=="number"&&typeof E=="number"||(v=0,E=0),C==null){const R=Date.now(),A=this.lastVideoFramesSent.get(r.ssrc);A&&R-A.lts>=800?(C=Math.round((g-A.count)/((R-A.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:R,rate:C})):A?C=A.rate:this.lastVideoFramesSent.set(r.ssrc,{count:g,lts:R,rate:0})}r.sentFrame={width:v,height:E,frameRate:Math.max(0,C)}}processVideoTrackReceiverStats(e,t,r){var s,c,d,h,f;const g=t?this.report.get(t):void 0,v=(s=g==null?void 0:g.framesReceived)!==null&&s!==void 0?s:e.framesReceived,E=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:e.frameWidth,C=(d=g==null?void 0:g.frameHeight)!==null&&d!==void 0?d:e.frameHeight,R=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,A=(f=g==null?void 0:g.jitterBufferEmittedCount)!==null&&f!==void 0?f:e.jitterBufferEmittedCount;if(typeof v=="number"){const B=this.lastVideoFramesRecv.get(r.ssrc),L=Date.now();r.framesReceivedCount=v;let U=0;B&&L-B.lts>=800?(U=Math.round((v-B.count)/((L-B.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:L,rate:U})):B?U=B.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:v,lts:L,rate:0}),r.receivedFrame={width:E||0,height:C||0,frameRate:U||0},r.decodedFrame={width:E||0,height:C||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:E||0,height:C||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(R&&A){const B=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let L=B.jitterBufferMs;const U=A-B.jitterBufferEmittedCount;U>0&&(L=1e3*(R-B.jitterBufferDelay)/U),r.jitterBufferMs=L,r.currentDelayMs=Math.round(L),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:A,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var s,c,d,h;const f=t?this.report.get(t):void 0,g=(s=(c=f==null?void 0:f.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&s!==void 0?s:0,v=(d=(h=f==null?void 0:f.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;r.aecReturnLoss=g,r.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(e,t,r){var s,c,d,h,f,g,v,E,C;const R=t?this.report.get(t):void 0,A=(s=R==null?void 0:R.removedSamplesForAcceleration)!==null&&s!==void 0?s:e.removedSamplesForAcceleration,B=(c=R==null?void 0:R.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,L=(d=R==null?void 0:R.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,U=(h=R==null?void 0:R.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,X=(f=R==null?void 0:R.audioLevel)!==null&&f!==void 0?f:e==null?void 0:e.audioLevel,Y=(g=R==null?void 0:R.totalSamplesDuration)!==null&&g!==void 0?g:e==null?void 0:e.totalSamplesDuration,ee=(v=R==null?void 0:R.concealedSamples)!==null&&v!==void 0?v:e.concealedSamples,ue=(E=R==null?void 0:R.silentConcealedSamples)!==null&&E!==void 0?E:e.silentConcealedSamples,de=(C=R==null?void 0:R.concealmentEvents)!==null&&C!==void 0?C:e.concealmentEvents;if(typeof B=="number"&&(r.totalSamplesReceived=B),typeof ue=="number"&&(r.silentConcealedSamples=ue),typeof de=="number"&&(r.concealmentEvents=de),typeof ee=="number"&&(r.concealedSamples=ee),A&&B&&(r.accelerateRate=A/B),L&&U){const be=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ae=be.jitterBufferMs;const Ue=U-be.jitterBufferEmittedCount;Ue>0&&(Ae=1e3*(L-be.jitterBufferDelay)/Ue),r.jitterBufferMs=Math.round(Ae),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:L,jitterBufferEmittedCount:U,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=X;let ne=1920;Y&&B&&(ne=B/Y/50,r.receivedFrames=Math.round(B/ne)),ee&&(r.droppedFrames=Math.round(ee/ne))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach((c=>{e+=c.diffMean()})),this.mediaBytesRetransmit.forEach((c=>{t=t===null?c.diffMean():t+c.diffMean()})),this.mediaBytesTargetEncode.forEach((c=>{r=r===null?c.diffMean():r+c.diffMean()}));const s=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},Vte=class extends iO{updateStats(){return nt.resolve()}};function oO(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=(function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null})();return d?d<76?new Fte(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new p3(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c}):(function(h){if(!window.RTCStatsReport)return!1;const f=h.getStats();return!!(f instanceof nt||(function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"})(f))})(e)?new p3(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new Vte(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:c})}const f3="websdk_ng_install_id";function cO(){try{if(Z("INSTALL_ID"))return Z("INSTALL_ID");let e=window.localStorage.getItem(f3);return e||(e=If(),window.localStorage.setItem(f3,e)),Vr("INSTALL_ID",e),e}catch{return}}const xo=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],s=t[2];return"".concat(r,".").concat(s)}return"4.0.0.999"})("4.24.0"),lO=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let Of=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({});const Bs=(function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const s=r.join(""),c=[];for(let f=0;f<6;f++)c.push("1");const d=c.join(""),h={};return h[e]=s,h[t]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Bs;const eT={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},dO={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},uO="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",hO={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},cn=Ke(Ke(Ke(Ke({},hO),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:dO,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},eT),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Vr(e,t,r){var s,c,d;$e(s=Object.keys(cn)).call(s,e)&&(!r&&$e(c=Object.keys(al)).call(c,e)||(cn[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(cn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(d=!!t,cn.USE_NEW_NETWORK_CONFIG=d,d&&(cn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],cn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],cn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],cn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],cn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",cn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",cn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(cn.ENABLE_INSTANT_VIDEO=!0,cn.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(cn.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(cn.NEW_TURN_MODE||(cn.NEW_TURN_MODE=4))))}function Z(e){return cn[e]}lO||(cn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],cn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],cn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],cn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],cn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],cn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],cn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",cn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",cn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",cn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",cn.AREAS=["NORTH_AMERICA","OVERSEA"]);let m3=(function(e){return e[e.REALTIME=1]="REALTIME",e})({});const al={};var Ft=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(Ft||{});let yE=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const g3=128,Bte=96,_3=1e3,w_=10;let Wte=0;var y3=(()=>{var e={8:(s,c,d)=>{d.r(c),d.d(c,{Parser:()=>Ue,Printer:()=>Ir,parse:()=>Xe,print:()=>lt});const h=`
`,f="".concat("\r").concat(h),g=" ";let v;function E(Ve){return Ve>="0"&&Ve<="9"}function C(Ve){return Ve>="!"&&Ve<="~"}function R(Ve){return C(Ve)||Ve>=""&&Ve<=""}function A(Ve){return Ve==="!"||Ve>="#"&&Ve<="'"||Ve>="*"&&Ve<="+"||Ve>="-"&&Ve<="."||Ve>="0"&&Ve<="9"||Ve>="A"&&Ve<="Z"||Ve>="^"&&Ve<="~"}function B(Ve){return Ve>="1"&&Ve<="9"}function L(Ve){return Ve>="A"&&Ve<="Z"||Ve>="a"&&Ve<="z"}function U(Ve){return Ve==="d"||Ve==="h"||Ve==="m"||Ve==="s"}function X(Ve){return Ve>""&&Ve<"	"||Ve>"\v"&&Ve<"\f"||Ve>""&&Ve<""}function Y(Ve){return L(Ve)||E(Ve)||Ve==="+"||Ve==="/"}function ee(Ve){return E(Ve)||L(Ve)||Ve==="+"||Ve==="/"||Ve==="-"||Ve==="_"}function ue(Ve){return L(Ve)||E(Ve)||Ve==="+"||Ve==="/"}function de(Ve,D){var re=Object.keys(Ve);if(Object.getOwnPropertySymbols){var le=Object.getOwnPropertySymbols(Ve);D&&(le=le.filter((function(ze){return Object.getOwnPropertyDescriptor(Ve,ze).enumerable}))),re.push.apply(re,le)}return re}function ne(Ve){for(var D=1;D<arguments.length;D++){var re=arguments[D]!=null?arguments[D]:{};D%2?de(Object(re),!0).forEach((function(le){be(Ve,le,re[le])})):Object.getOwnPropertyDescriptors?Object.defineProperties(Ve,Object.getOwnPropertyDescriptors(re)):de(Object(re)).forEach((function(le){Object.defineProperty(Ve,le,Object.getOwnPropertyDescriptor(re,le))}))}return Ve}function be(Ve,D,re){return D in Ve?Object.defineProperty(Ve,D,{value:re,enumerable:!0,configurable:!0,writable:!0}):Ve[D]=re,Ve}(function(Ve){Ve.VERSION="v",Ve.ORIGIN="o",Ve.SESSION_NAME="s",Ve.INFORMATION="i",Ve.URI="u",Ve.EMAIL="e",Ve.PHONE="p",Ve.CONNECTION="c",Ve.BANDWIDTH="b",Ve.TIME="t",Ve.REPEAT="r",Ve.ZONE_ADJUSTMENTS="z",Ve.KEY="k",Ve.ATTRIBUTE="a",Ve.MEDIA="m"})(v||(v={}));class Ae{consumeText(D,re){let le=re;for(;le<D.length;){const ze=D[le];if(ze==="\0"||ze==="\r"||ze===h)break;le+=1}if(le-re==0)throw new Error("Invalid text, at ".concat(D));return le}consumeUnicastAddress(D,re,le){return this.consumeTill(D,re,g)}consumeOneOrMore(D,re,le){let ze=re;for(;le(D[ze]);)ze++;if(ze-re==0)throw new Error("Invalid rule at ".concat(re,"."));return ze}consumeSpace(D,re){if(D[re]===g)return re+1;throw new Error("Invalid space at ".concat(re,"."))}consumeIP4Address(D,re){let le=re;for(let ze=0;ze<4;ze++)if(le=this.consumeDecimalUChar(D,le),ze!==3){if(D[le]!==".")throw new Error("Invalid IP4 address.");le++}return le}consumeDecimalUChar(D,re){let le=re;for(let Gt=0;Gt<3&&E(D[le]);Gt++,le++);if(le-re==0)throw new Error("Invalid decimal uchar.");const ze=parseInt(D.slice(re,le));if(ze>=0&&ze<=255)return le;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,re){let le=this.consumeHexpart(D,re);return D[le]===":"&&(le+=1,le=this.consumeIP4Address(D,le)),le}consumeHexpart(D,re){let le=re;if(D[le]===":"&&D[le+1]===":"){le+=2;try{le=this.consumeHexseq(D,le)}catch{}return le}if(le=this.consumeHexseq(D,le),D[le]===":"&&D[le+1]===":"){le+=2;try{le=this.consumeHexseq(D,le)}catch{}return le}return le}consumeHexseq(D,re){let le=re;for(;le=this.consumeHex4(D,le),D[le]===":"&&D[le+1]!==":";)le+=1;return le}consumeHex4(D,re){let le=0;for(;le<4;le++)if(!((ze=D[re+le])>="0"&&ze<="9"||ze>="a"&&ze<="f"||ze>="A"&&ze<="F")){if(le===0)throw new Error("Invalid hex 4");break}var ze;return re+le}consumeFQDN(D,re){let le=re;for(;E(D[le])||L(D[le])||D[le]==="-"||D[le]===".";)le+=1;if(le-re<4)throw new Error("Invalid FQDN");return le}consumeExtnAddr(D,re){return this.consumeOneOrMore(D,re,R)}consumeMulticastAddress(D,re,le){switch(le){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,re);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,re);default:try{return this.consumeFQDN(D,re)}catch{return this.consumeExtnAddr(D,re)}}}consumeIP6MulticastAddress(D,re){const le=this.consumeHexpart(D,re);return D[le]==="/"?this.consumeInteger(D,le+1):le}consumeIP4MulticastAddress(D,re){let le=re+3;const ze=D.slice(re,le),Gt=parseInt(ze);if(Gt<224||Gt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Xr=0;Xr<3;Xr++){if(D[le]!==".")throw new Error("Invalid IP4 multicast address.");le+=1,le=this.consumeDecimalUChar(D,le)}return D[le]==="/"&&(le+=1),le=this.consumeTTL(D,le),D[le]==="/"&&(le=this.consumeInteger(D,le)),le}consumeInteger(D,re){if(!B(D[re]))throw new Error("Invalid integer.");for(re+=1;E(D[re]);)re+=1;return re}consumeTTL(D,re){if(D[re]==="0")return re+1;if(!B(D[re]))throw new Error("Invalid TTL.");re+=1;for(let le=0;le<2&&E(D[re]);le++)re+=1;return re}consumeToken(D,re){return this.consumeOneOrMore(D,re,A)}consumeTime(D,re){let le=re;if(D[le]==="0")return le+1;for(B(D[le])&&(le+=1);E(D[le]);)le++;if(le-re<10)throw new Error("Invalid time");return le}consumeAddress(D,re){return this.consumeTill(D,re,g)}consumeTypedTime(D,re){let le=re;return le=this.consumeOneOrMore(D,le,E),U(D[le])?le+1:le}consumeRepeatInterval(D,re){if(!B(D[re]))throw new Error("Invalid repeat interval");for(re+=1;E(D[re]);)re+=1;return U(D[re])&&(re+=1),re}consumePort(D,re){return this.consumeOneOrMore(D,re,E)}consume(D,re,le){for(let ze=0;ze<le.length;ze++){if(re+ze>=D.length)throw new Error("consume exceeding value length");if(D[re+ze]!==le[ze])throw new Error("consume ".concat(le," failed at ").concat(ze))}return re+le.length}consumeTill(D,re,le){let ze=re;for(;ze<D.length&&(typeof le!="string"||D[ze]!==le)&&(typeof le!="function"||!le(D[ze]));)ze++;return ze}}class Ue extends Ae{constructor(){super(),be(this,"records",[]),be(this,"currentLine",0)}parse(D){const re=this.probeEOL(D);this.records=D.split(re).filter((gu=>!!gi(gu).call(gu))).map(this.parseLine),this.currentLine=0;const le=this.parseVersion(),ze=this.parseOrigin(),Gt=this.parseSessionName(),Xr=this.parseInformation(),Qn=this.parseUri(),Po=this.parseEmail(),_c=this.parsePhone(),rw=this.parseConnection(),Jf=this.parseBandWidth(),Z_=this.parseTimeFields(),fC=this.parseKey(),mC=this.parseSessionAttribute(),Do=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:le,origin:ze,sessionName:Gt,information:Xr,uri:Qn,emails:Po,phones:_c,connection:rw,bandwidths:Jf,timeFields:Z_,key:fC,attributes:mC,mediaDescriptions:Do}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let re=0;re<D.length;re++)if(D[re]===h)return D[re-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(D,re){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const le=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:le,value:D.slice(2),line:re,cur:0}}parseSessionAttribute(){const D=new Yt;for(;this.currentLine<this.records.length;){const re=this.getCurrentRecord();if(re.type!==v.ATTRIBUTE)break;const le={attField:this.extractOneOrMore(re,(ze=>A(ze)&&ze!==":")),_cur:0};re.value[re.cur]===":"&&(re.cur+=1,le.attValue=this.extractOneOrMore(re,X)),D.parse(le),this.currentLine++}return D.digest()}parseMediaAttributes(D){const re=new Qt(D);for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==v.ATTRIBUTE)break;const ze={attField:this.extractOneOrMore(le,(Gt=>A(Gt)&&Gt!==":")),_cur:0};le.value[le.cur]===":"&&(le.cur+=1,ze.attValue=this.extractOneOrMore(le,X)),re.parse(ze),this.currentLine++}return re.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===v.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===v.ZONE_ADJUSTMENTS){const re=[];for(;;)try{const le=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let ze=!1;D.value[D.cur]==="-"&&(ze=!0,D.cur+=1);const Gt=this.extract(D,this.consumeTypedTime);re.push({time:le,typedTime:Gt,back:ze})}catch{break}if(re.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,re}return[]}parseRepeat(){const D=[];for(;;){const re=this.getCurrentRecord();if(re.type!==v.REPEAT)break;{const le=this.extract(re,this.consumeRepeatInterval),ze=this.parseTypedTime(re);D.push({repeatInterval:le,typedTimes:ze}),this.currentLine++}}return D}parseTypedTime(D){const re=[];for(;;)try{this.consumeSpaceForRecord(D),re.push(this.extract(D,this.consumeTypedTime))}catch{break}if(re.length===0)throw new Error("Invalid typed time.");return re}parseTime(){const D=this.getCurrentRecord(),re=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const le=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:re,stopTime:le}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const re=this.getCurrentRecord();if(re.type!==v.BANDWIDTH)break;{const le=this.extractOneOrMore(re,A);if(re.value[re.cur]!==":")throw new Error("Invalid bandwidth field.");re.cur++;const ze=this.extractOneOrMore(re,E);D.push({bwtype:le,bandwidth:ze}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==v.VERSION)throw new Error("first sdp record must be version");const re=D.value.slice(0,this.consumeOneOrMore(D.value,0,E));if(re.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,re}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const re=this.extractOneOrMore(D,R);this.consumeSpaceForRecord(D);const le=this.extractOneOrMore(D,E);this.consumeSpaceForRecord(D);const ze=this.extractOneOrMore(D,E);this.consumeSpaceForRecord(D);const Gt=this.extractOneOrMore(D,A);this.consumeSpaceForRecord(D);const Xr=this.extractOneOrMore(D,A);this.consumeSpaceForRecord(D);const Qn=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:re,sessId:le,sessVersion:ze,nettype:Gt,addrtype:Xr,unicastAddress:Qn}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===v.SESSION_NAME){const re=this.extract(D,this.consumeText);return this.currentLine++,re}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==v.INFORMATION)return;const re=this.extract(D,this.consumeText);return this.currentLine++,re}parseUri(){const D=this.getCurrentRecord();if(D.type===v.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const re=this.getCurrentRecord();if(re.type!==v.EMAIL)break;D.push(re.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const re=this.getCurrentRecord();if(re.type!==v.PHONE)break;D.push(re.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===v.CONNECTION){const re=this.extractOneOrMore(D,A);this.consumeSpaceForRecord(D);const le=this.extractOneOrMore(D,A);this.consumeSpaceForRecord(D);const ze=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:re,addrtype:le,address:ze}}}parseMedia(){const D=this.getCurrentRecord(),re=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let le=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,le+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const ze=[];for(ze.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,ze.push(this.extract(D,this.consumeToken));if(ze.length===0)throw new Error("Invalid proto");const Gt=this.parseFmt(D);return this.currentLine++,{mediaType:re,port:le,protos:ze,fmts:Gt}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===v.TIME;){const re=this.parseTime(),le=this.parseRepeat(),ze=this.parseZone();D.push({time:re,repeats:le,zones:ze})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const re=this.parseMedia(),le=this.parseInformation(),ze=this.parseConnections(),Gt=this.parseBandWidth(),Xr=this.parseKey(),Qn=this.parseMediaAttributes(re);D.push({media:re,information:le,connections:ze,bandwidths:Gt,key:Xr,attributes:Qn})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const re=[];for(;;)try{this.consumeSpaceForRecord(D),re.push(this.extract(D,this.consumeToken))}catch{break}if(re.length===0)throw new Error("Invalid fmts");return re}extract(D,re){for(var le=arguments.length,ze=new Array(le>2?le-2:0),Gt=2;Gt<le;Gt++)ze[Gt-2]=arguments[Gt];const Xr=re.call(this,D.value,D.cur,...ze),Qn=D.value.slice(D.cur,Xr);return D.cur=Xr,Qn}extractOneOrMore(D,re){const le=this.consumeOneOrMore(D.value,D.cur,re),ze=D.value.slice(D.cur,le);return D.cur=le,ze}consumeSpaceForRecord(D){if(D.value[D.cur]!==g)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class He extends Ae{constructor(){super(...arguments),be(this,"attributes",void 0),be(this,"digested",!1)}extractOneOrMore(D,re,le){const ze=this.consumeOneOrMore(D.attValue,D._cur,re),Gt=D.attValue.slice(D._cur,ze),[Xr,Qn]=le||[];if(typeof Xr=="number"&&Gt.length<Xr)throw new Error("error in length, should be more or equal than ".concat(Xr," characters."));if(typeof Qn=="number"&&Gt.length>Qn)throw new Error("error in length, should be less or equal than ".concat(Qn," characters."));return D._cur=ze,Gt}consumeAttributeSpace(D){if(D.attValue[D._cur]!==g)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,re){if(!D.attValue)throw new Error("Nothing to extract from attValue.");for(var le=arguments.length,ze=new Array(le>2?le-2:0),Gt=2;Gt<le;Gt++)ze[Gt-2]=arguments[Gt];const Xr=re.call(this,D.attValue,D._cur,...ze),Qn=D.attValue.slice(D._cur,Xr);return D._cur=Xr,Qn}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,re){if(!D.attValue)throw new Error;for(let le=0;le<re.length;le++)if(re[le]!==D.attValue[D._cur+le])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,Y,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,Y,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const re=[];for(;!this.atEnd(D);){re.push(this.extractOneOrMore(D,Y));try{this.consumeAttributeSpace(D)}catch(le){if(this.atEnd(D))break;throw le}}this.attributes.iceOptions=re}parseFingerprint(D){const re=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const le=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:re,fingerprint:le})}parseExtmap(D){const re=this.extractOneOrMore(D,E);let le;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),le=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeTill,g),Gt=ne(ne({entry:parseInt(re,10)},le&&{direction:le}),{},{extensionName:ze});this.peekChar(D)===g&&(this.consumeAttributeSpace(D),Gt.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(Gt)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const re=this.extract(D,this.consumeTill);if(re!=="active"&&re!=="passive"&&re!=="actpass"&&re!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=re}}class Yt extends He{constructor(){super(...arguments),be(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(re){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),re}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const re=this.extract(D,this.consumeToken),le=[];for(;!this.atEnd(D)&&this.peekChar(D)===g;)this.consumeAttributeSpace(D),le.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:re,identificationTag:le})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,ee)}parseIdentity(D){const re=this.extractOneOrMore(D,ue),le=[];for(;!this.atEnd(D)&&this.peekChar(D)===g;){this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const Gt=this.extractOneOrMore(D,(Xr=>Xr!==g&&X(Xr)));le.push({name:ze,value:Gt})}this.attributes.identities.push({assertionValue:re,extensions:le})}parseMsidSemantic(D){this.peekChar(D)===g&&this.consumeAttributeSpace(D);const re={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),re.applyForAll=!0;break}{const le=this.extract(D,this.consumeTill,g);re.identifierList.push(le)}}this.attributes.msidSemantic=re}}class Qt extends He{constructor(D){super(),be(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(re){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),re}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const re=this.extractOneOrMore(D,Y,[1,32]);this.consumeAttributeSpace(D);const le=this.extractOneOrMore(D,E,[1,5]);this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const Gt=this.extractOneOrMore(D,E,[1,10]);this.consumeAttributeSpace(D);const Xr=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Qn=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const Po={foundation:re,componentId:le,transport:ze,priority:Gt,connectionAddress:Xr,port:Qn,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),Po.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),Po.relPort=this.extract(D,this.consumePort));this.peekChar(D)===g;){this.consumeAttributeSpace(D);const _c=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),Po.extension[_c]=this.extractOneOrMore(D,C)}this.attributes.candidates.push(Po)}parseRemoteCandidate(D){const re=[];for(;;){const le=this.extractOneOrMore(D,E,[1,5]);this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const Gt=this.extract(D,this.consumePort);re.push({componentId:le,connectionAddress:ze,port:Gt});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(re)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const re=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const le=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const ze={encodingName:le,clockRate:this.extractOneOrMore(D,E)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),ze.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const Gt=this.attributes.payloads.find((Xr=>Xr.payloadType===parseInt(re,10)));Gt?Gt.rtpMap=ze:this.attributes.payloads.push({payloadType:parseInt(re,10),rtpMap:ze,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const re=this.extractOneOrMore(D,E);this.consumeAttributeSpace(D);const le=this.extract(D,this.consumeTill,":");let ze;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),ze=this.extract(D,this.consumeTill));const Gt=this.attributes.ssrcs.find((Xr=>Xr.ssrcId===parseInt(re,10)));Gt?Gt.attributes[le]=ze:this.attributes.ssrcs.push({ssrcId:parseInt(re,10),attributes:{[le]:ze}})}parseFmtp(D){const re=this.extract(D,this.consumeTill,g);this.consumeAttributeSpace(D);const le=this.extract(D,this.consumeTill),ze={};le.split(";").forEach((Xr=>{let[Qn,Po]=Xr.split("=");Qn=gi(Qn).call(Qn);const _c=typeof Po=="string"?gi(Po).call(Po):null;typeof Qn=="string"&&Qn.length>0&&(ze[Qn]=_c)}));const Gt=this.attributes.payloads.find((Xr=>Xr.payloadType===parseInt(re,10)));Gt?Gt.fmtp={parameters:ze}:this.attributes.payloads.push({payloadType:parseInt(re,10),rtcpFeedbacks:[],fmtp:{parameters:ze}})}parseFmtParameters(D){const re={},le=this.extract(D,this.consumeTill,"=");D._cur++;const ze=this.extract(D,this.consumeTill,";");for(re[le]=ze;D.attValue[D._cur]===";";){const Gt=this.extract(D,this.consumeTill,"=");D._cur++;const Xr=this.extract(D,this.consumeTill,";");re[Gt]=Xr}return re}parseRtcpFb(D){let re="";re=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,g),this.consumeAttributeSpace(D);const le=this.extract(D,this.consumeTill,g);let ze;if(le==="trr-int")ze={type:le,interval:this.extract(D,this.consumeTill)};else{const Gt={type:le};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),Gt.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===g&&(Gt.additional=this.extract(D,this.consumeTill))),ze=Gt}if(re==="*")this.attributes.rtcpFeedbackWildcards.push(ze);else{const Gt=this.attributes.payloads.find((Xr=>Xr.payloadType===parseInt(re,10)));Gt?Gt.rtcpFeedbacks.push(ze):this.attributes.payloads.push({payloadType:parseInt(re,10),rtcpFeedbacks:[ze]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const re={port:this.extract(D,this.consumePort)};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),re.netType=this.extractOneOrMore(D,A),this.consumeAttributeSpace(D),re.addressType=this.extractOneOrMore(D,A),this.consumeAttributeSpace(D),re.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=re}parseMsid(D){const re={id:this.extractOneOrMore(D,A,[1,64])};this.peekChar(D)===g&&(this.consumeAttributeSpace(D),re.appdata=this.extractOneOrMore(D,A,[1,64])),this.attributes.msids.push(re)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const re=this.extractOneOrMore(D,(ze=>L(ze)||E(ze)||ze==="_"||ze==="-"));this.consumeAttributeSpace(D);const le={id:re,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===g){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const ze=[];for(;;){const Gt=this.extract(D,this.consumeToken);ze.push(Gt);try{this.extract(D,this.consume,",")}catch{break}}le.payloads=ze,this.peekChar(D)===g&&this.extract(D,this.consume,g)}for(;;){const ze=this.extract(D,this.consumeToken);switch(ze){case"depend":{const Gt={type:ze,rids:this.extract(D,this.consume,"=").split(",")};le.params.push(Gt);break}default:{const Gt={type:ze};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),Gt.val=this.extract(D,this.consumeTill,";")),le.params.push(Gt)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(le)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,E,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,E,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const re=this.extract(D,this.consumeToken),le=[];for(;;)try{this.consumeAttributeSpace(D);const ze=this.extract(D,this.consumeInteger);le.push(parseInt(ze,10))}catch{break}this.attributes.ssrcGroups.push({semantic:re,ssrcIds:le})}}function Lt(Ve,D,re){return D in Ve?Object.defineProperty(Ve,D,{value:re,enumerable:!0,configurable:!0,writable:!0}):Ve[D]=re,Ve}class Ir{constructor(){Lt(this,"eol",f)}print(D,re){let le="";return re&&(this.eol=re),le+=this.printVersion(D.version),le+=this.printOrigin(D.origin),le+=this.printSessionName(D.sessionName),le+=this.printInformation(D.information),le+=this.printUri(D.uri),le+=this.printEmail(D.emails),le+=this.printPhone(D.phones),le+=this.printConnection(D.connection),le+=this.printBandwidth(D.bandwidths),le+=this.printTimeFields(D.timeFields),le+=this.printKey(D.key),le+=this.printSessionAttributes(D.attributes),le+=this.printMediaDescription(D.mediaDescriptions),le}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let re="";for(const le of D)re+="e=".concat(le).concat(this.eol);return re}printPhone(D){let re="";for(const le of D)re+="e=".concat(le).concat(this.eol);return re}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let re="";for(const le of D)re+="b=".concat(le.bwtype,":").concat(le.bandwidth).concat(this.eol);return re}printTimeFields(D){let re="";for(const le of D){re+="t=".concat(le.time.startTime," ").concat(le.time.startTime).concat(this.eol);for(const ze of le.repeats)re+="r=".concat(ze.repeatInterval," ").concat(ze.typedTimes.join(" ")).concat(this.eol);le.zoneAdjustments&&(re+="z=",re+="z=".concat(le.zoneAdjustments.map((ze=>"".concat(ze.time," ").concat(ze.back?"-":""," ").concat(ze.typedTime))).join(" ")).concat(this.eol),re+=this.eol)}return re}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let re="";for(const le of D)re+="a=".concat(le.attField).concat(le.attValue?":".concat(le.attValue):"").concat(this.eol);return re}printMediaDescription(D){let re="";for(const le of D)re+=this.printMedia(le.media),re+=this.printInformation(le.information),re+=this.printConnections(le.connections),re+=this.printBandwidth(le.bandwidths),re+=this.printKey(le.key),re+=this.printMediaAttributes(le);return re}printConnections(D){let re="";for(const le of D)re+=this.printConnection(le);return re}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new ti(this.eol).print(D)}printMediaAttributes(D){return new Me(this.eol).print(D)}}class xr{constructor(D){Lt(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(g)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map((re=>"a=fingerprint:".concat(re.hashFunction).concat(g).concat(re.fingerprint))).join(this.eol)+this.eol:""}printExtmap(D){return D.map((re=>"a=extmap:".concat(re.entry).concat(re.direction?"/".concat(re.direction):"").concat(g).concat(re.extensionName).concat(re.extensionAttributes?"".concat(g).concat(re.extensionAttributes):"").concat(this.eol))).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map((re=>"a=".concat(re.attField).concat(re.attValue?":".concat(re.attValue):"").concat(this.eol))).join("")}}class ti extends xr{print(D){let re="";return re+=this.printGroups(D.groups),re+=this.printMsidSemantic(D.msidSemantic),re+=this.printIceLite(D.iceLite),re+=this.printIceUfrag(D.iceUfrag),re+=this.printIcePwd(D.icePwd),re+=this.printIceOptions(D.iceOptions),re+=this.printFingerprints(D.fingerprints),re+=this.printSetup(D.setup),re+=this.printTlsId(D.tlsId),re+=this.printIdentity(D.identities),re+=this.printExtmap(D.extmaps),re+=this.printUnrecognized(D.unrecognized),re}printGroups(D){let re="";return D.length>0&&(re+=D.map((le=>"a=group:".concat(le.semantic).concat(le.identificationTag.map((ze=>"".concat(g).concat(ze))).join("")).concat(this.eol))).join("")),re}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map((re=>"a=identity:".concat(re.assertionValue).concat(re.extensions.map((le=>"".concat(g).concat(le.name).concat(le.value?"=".concat(le.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let re="a=msid-semantic:".concat(D.semantic);return D.applyForAll?re+="".concat(g,"*"):D.identifierList.length>0&&(re+=D.identifierList.map((le=>"".concat(g).concat(le)))),re+this.eol}}class Me extends xr{print(D){const re=D.attributes;let le="";return le+=this.printRTCP(re.rtcp),le+=this.printIceUfrag(re.iceUfrag),le+=this.printIcePwd(re.icePwd),le+=this.printIceOptions(re.iceOptions),le+=this.printCandidates(re.candidates),le+=this.printRemoteCandidatesList(re.remoteCandidatesList),le+=this.printEndOfCandidates(re.endOfCandidates),le+=this.printFingerprints(re.fingerprints),le+=this.printSetup(re.setup),le+=this.printMid(re.mid),le+=this.printExtmap(re.extmaps),le+=this.printRTPRelated(re),le+=this.printPtime(re.ptime),le+=this.printMaxPtime(re.maxPtime),le+=this.printDirection(re.direction),le+=this.printSSRCGroups(re.ssrcGroups),le+=this.printSSRC(re.ssrcs),le+=this.printRTCPMux(re.rtcpMux),le+=this.printRTCPMuxOnly(re.rtcpMuxOnly),le+=this.printRTCPRsize(re.rtcpRsize),le+=this.printMSId(re.msids),le+=this.printImageattr(re.imageattr),le+=this.printRid(re.rids),le+=this.printSimulcast(re.simulcast),le+=this.printSCTPPort(re.sctpPort),le+=this.printMaxMessageSize(re.maxMessageSize),le+=this.printUnrecognized(re.unrecognized),le}printCandidates(D){return D.map((re=>"a=candidate:".concat(re.foundation).concat(g).concat(re.componentId).concat(g).concat(re.transport).concat(g).concat(re.priority).concat(g).concat(re.connectionAddress).concat(g).concat(re.port).concat(g,"typ").concat(g).concat(re.type).concat(re.relAddr?"".concat(g,"raddr").concat(g).concat(re.relAddr):"").concat(re.relPort?"".concat(g,"rport").concat(g).concat(re.relPort):"").concat(Object.keys(re.extension).map((le=>"".concat(g).concat(le).concat(g).concat(re.extension[le]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(D){return D.map((re=>"a=remote-candidates:".concat(re.join(g)).concat(this.eol))).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const re=D.payloads;let le="";le+=D.rtcpFeedbackWildcards.map((ze=>this.printRTCPFeedback("*",ze))).join("");for(const ze of re)le+=this.printRtpMap(ze.payloadType,ze.rtpMap),le+=this.printFmtp(ze.payloadType,ze.fmtp),le+=ze.rtcpFeedbacks.map((Gt=>this.printRTCPFeedback(ze.payloadType,Gt))).join("");return le}printFmtp(D,re){if(!re)return"";const le=Object.keys(re.parameters);return le.length===1&&re.parameters[le[0]]===null?"a=fmtp:".concat(D).concat(g).concat(le[0]).concat(this.eol):"a=fmtp:".concat(D).concat(g).concat(Object.keys(re.parameters).map((ze=>"".concat(ze,"=").concat(re.parameters[ze]))).join(";")).concat(this.eol)}printRtpMap(D,re){return re?"a=rtpmap:".concat(D).concat(g).concat(re.encodingName,"/").concat(re.clockRate).concat(re.encodingParameters?"/".concat(re.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,re){let le="a=rtcp-fb:".concat(D).concat(g),ze=re;return ze.type==="trr-int"?le+="ttr-int".concat(g).concat(ze.interval):(le+="".concat(ze.type),ze.parameter&&(le+="".concat(g).concat(ze.parameter),ze.additional&&(le+="".concat(g).concat(ze.additional)))),le+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map((re=>Object.keys(re.attributes).map((le=>"a=ssrc:".concat(re.ssrcId.toString(10)).concat(g).concat(le).concat(re.attributes[le]?":".concat(re.attributes[le]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let re="a=rtcp:".concat(D.port);return D.netType&&(re+="".concat(g).concat(D.netType)),D.addressType&&(re+="".concat(g).concat(D.addressType)),D.address&&(re+="".concat(g).concat(D.address)),re+this.eol}printMSId(D){return D.map((re=>"a=msid:".concat(re.id).concat(re.appdata?"".concat(g).concat(re.appdata):"").concat(this.eol))).join("")}printImageattr(D){return D.map((re=>"a=imageattr:".concat(re).concat(this.eol))).join("")}printRid(D){return D.map((re=>{let le="a=rid:".concat(re.id).concat(g).concat(re.direction);return re.payloads&&(le+="".concat(g,"pt=").concat(re.payloads.join(","))),re.params.length>0&&(le+="".concat(g).concat(re.params.map((ze=>ze.type==="depend"?"depend=".concat(ze.rids.join(",")):"".concat(ze.type,"=").concat(ze.val))).join(";"))),le+this.eol})).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map((re=>"a=ssrc-group:".concat(re.semantic).concat(re.ssrcIds.map((le=>"".concat(g).concat(le.toString(10)))).join("")).concat(this.eol))).join("")}}function Xe(Ve){return new Ue().parse(Ve)}function lt(Ve,D){return new Ir().print(Ve,D)}}},t={};function r(s){if(t[s])return t[s].exports;var c=t[s]={exports:{}};return e[s](c,c.exports,r),c.exports}return r.d=(s,c)=>{for(var d in c)r.o(c,d)&&!r.o(s,d)&&Object.defineProperty(s,d,{enumerable:!0,get:c[d]})},r.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),r.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r(8)})();function aa(e){return y3.parse(e)}function Rh(e,t){return y3.print(e,t)}var qte=ya("Array","keys"),Gte=Lc,Hte=us,Kte=O,zte=qte,pO=Array.prototype,$te={DOMTokenList:!0,NodeList:!0},Yte=function(e){var t=e.keys;return e===pO||Kte(pO,e)&&t===pO.keys||Hte($te,Gte(e))?zte:t},oa=u(Yte);function Tn(e,t,r){return(t=(function(s){var c=(function(d,h){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var g=f.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(s);return typeof c=="symbol"?c:c+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function zt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v3(Object(r),!0).forEach((function(s){Tn(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v3(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const E3=new class extends _n{constructor(){super(...arguments),Tn(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Xte{constructor(t){Tn(this,"logger",void 0),Tn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function fO(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function w3(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const To={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},tT=Date.now(),vE=e=>{for(const t in To)if(Object.prototype.hasOwnProperty.call(To,t)&&To[t]===e)return t;return"DEFAULT"},k=new class{constructor(){Tn(this,"proxyServerURL",void 0),Tn(this,"logLevel",To.DEBUG),Tn(this,"uploadState","collecting"),Tn(this,"uploadLogWaitingList",[]),Tn(this,"uploadLogUploadingList",[]),Tn(this,"uploadErrorCount",0),Tn(this,"currentLogID",0),Tn(this,"url",void 0),Tn(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=[To.DEBUG].concat(t);this.log.apply(this,s)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=[To.INFO].concat(t);this.log.apply(this,s)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=[To.WARNING].concat(t);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=[To.ERROR].concat(t);this.log.apply(this,s)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=[To.DEBUG].concat(t);this.uploadLog.apply(this,s)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Vr("UPLOAD_LOG",!0)}disableLogUpload(){Vr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Xte(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-tT<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-tT);const s=Math.max(0,Math.min(4,t[0]));if(t[0]=fO()+" Agora-SDK [".concat(vE(s),"]:"),this.appendLogToWaitingList(s,...t),s<this.logLevel)return;const c=fO()+" %cAgora-SDK [".concat(vE(s),"]:");let d=[];if(!Z("USE_NEW_LOG"))switch(s){case To.DEBUG:d=[c,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,d);break;case To.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,d);break;case To.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,d);break;case To.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-tT<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-tT);const s=Math.max(0,Math.min(4,t[0]));t[0]=fO()+" Agora-SDK [".concat(vE(s),"]:"),this.appendLogToWaitingList(s,...t)}appendLogToWaitingList(e){if(!Z("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];Array.isArray(r[0])?r[0][0]=w3()+" Agora-SDK [".concat(vE(e),"]:"):r[0]=w3()+" Agora-SDK [".concat(vE(e),"]:");let c="";r.forEach((d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")})),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:xo,process_id:Z("PROCESS_ID"),payload:JSON.stringify(e)};return il((async()=>{const r=await qi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Z("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Z("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){const s=new Error("unexpected upload log response");throw s.response=r,s}}),(()=>(this.uploadLogUploadingList=[],!1)),(r=>{const s={status:-1,message:r.message,errorRange:e.map((c=>c.log_item_id))};return r.response?(s.status=r.response.status,s.data=r.response.data,s.headers=r.response.headers):r.request&&(s.status=r.request.status),E3.reportLogUploadError(s),!0}),{timeout:Z("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Z("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Z("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),Z("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),Z("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),Z("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var b3;function Jte(e){return Rs(e.reportId,"params.reportId",0,100,!1),Rs(e.category,"params.category",0,100,!1),Rs(e.event,"params.event",0,100,!1),Rs(e.label,"params.label",0,100,!1),Gr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(b3={}).FREE="free",b3.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});const Qte={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ss=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),ln=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Zte=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function It(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,s){const c=s.value;if(typeof c=="function"){const d=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);s.value=function(){for(var h,f=arguments.length,g=new Array(f),v=0;v<f;v++)g[v]=arguments[v];let E=g;if(e.argsMap)try{E=e.argsMap(this,...g)}catch(R){k.warning(R),E=[]}try{JSON.stringify(E)}catch{k.warning("arguments for method ".concat(d,".").concat(String(r)," not serializable for apiInvoke.")),E=[]}const C=(e.report||ft).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(r)),options:E,tag:un.TRACER,reportResult:e.reportResult},e.throttleTime);try{const R=c.apply(this,g);return R instanceof nt?R.then((A=>(C.onSuccess(e.reportResult&&A),A))).catch((A=>{throw C.onError(A),A})):(C.onSuccess(e.reportResult&&R),R)}catch(R){throw C.onError(R),R}}}return s}}const ft=new class{constructor(){Tn(this,"baseInfoMap",new Map),Tn(this,"proxyServer",void 0),Tn(this,"eventUploadTimer",void 0),Tn(this,"setSessionIdTimer",void 0),Tn(this,"url",void 0),Tn(this,"sids",new Set),Tn(this,"backupUrl",void 0),Tn(this,"_appId",void 0),Tn(this,"_aid",0),Tn(this,"keyEventUploadPendingItems",[]),Tn(this,"normalEventUploadPendingItems",[]),Tn(this,"apiInvokeUploadPendingItems",[]),Tn(this,"apiInvokeCount",0),Tn(this,"apiInvokeLoggedCount",0),Tn(this,"ltsList",[]),Tn(this,"lastSendNormalEventTime",Date.now()),Tn(this,"customReportCounterTimer",void 0),Tn(this,"customReportCount",0),Tn(this,"extApiInvoke",(async e=>{for(const t of e){const r=zt(zt({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:un.TRACER});this.sendApiInvoke(r)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Z("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Z("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(t=>{let[r,s]=t;return r+s})),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const s=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!Z("SHOW_REPORT_INVOKER_LOG"),h=!!Z("SHOW_REPORT_USER_INVOKER_LOG"),f=d||h&&t.id;f&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function v(A,B){if(f){let L="[apiInvoke-".concat(g,"]");if(t.id&&(L+="[".concat(t.id,"]")),t.name&&(L+="[".concat(t.name,"]"),t.name===In.JOIN))return k.info("".concat(L," ").concat(A));k.info("".concat(L," ").concat(A),A==="start"?t.options:B||"")}}const E=()=>({tag:t.tag,invokeId:c,sid:e,name:t.name,apiInvokeTime:s,options:t.options,states:t.states||null});v("start");let C=!1;Ns(t.timeout).then((()=>{C||(this.sendApiInvoke(zt(zt({},E()),{},{error:J.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))}));const R=new Ne(J.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:A=>{const B=()=>{if(C)throw R;return C=!0,this.sendApiInvoke(zt(zt({},E()),{},{success:!0},t.reportResult&&{result:A})),v("onSuccess"),A};return r?t3(B,t.name+"Success",r,(()=>C=!0)):B()},onError:A=>{const B=()=>{if(C)throw A;C=!0,this.sendApiInvoke(zt(zt({},E()),{},{success:!1,error:A})),v("onFailure",A.toString())};return r?t3(B,t.name+"Error",r,(()=>C=!0)):B()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const r=Date.now(),s=this.createBaseInfo(e,r);s.cname=t.cname;const c=Object.assign({},{willUploadConsoleLog:Z("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:lO?"global":"oversea",areas:Z("AREAS")&&Z("AREAS").join(",")},t.extend),{stringUid:d,channelProfile:h,channelMode:f,isABTestSuccess:g,lsid:v,clientRole:E}=t,C=Date.now(),R=zt(zt({},s),{},{eventType:ss.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:uO,lts:C,elapse:C-r,extend:JSON.stringify(c),mode:t.mode,process:Z("PROCESS_ID"),appType:Z("APP_TYPE"),success:!0,version:xo,stringUid:d,channelProfile:h,channelMode:f,isABTestSuccess:g,lsid:v,clientType:$e(A=window.navigator.userAgent).call(A,"AgoraWebView")?42:20,clientRole:E,serviceId:Z("PROCESS_ID"),extensionID:Z("PLUGIN_INFO").join(",")||""});var A;this.send({type:ln.SESSION,data:R},!0)}joinChooseServer(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{role:t.role,eventType:ss.JOIN_CHOOSE_SERVER,lts:c,eventElapse:t.elapse||c-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:c-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:ln.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{eventType:ss.REQ_USER_ACCOUNT,lts:c,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||c-r.startTime,eventElapse:c-t.lts,extend:JSON.stringify(t.extend)});this.send({type:ln.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info;t.vid&&(s.vid=t.vid),s.uid=t.uid,s.cid=t.cid;const c=Date.now(),{firstSuccess:d,addr:h,isProxy:f}=t,g=c-r.startTime,v=zt(zt({},s),{},{eventType:ss.JOIN_GATEWAY,lts:c,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:g,eventElapse:c-t.lts,firstSuccess:d,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:cO(),isABTestSuccess:t.isABTestSuccess?1:0}),E=v.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=c),d)this.send({type:ln.JOIN_GATEWAY,data:v},!0);else{let C;if(h)if(f){const A=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),B=h.match(/p=[0-9]{1,6}/g);C={isSuccess:E,gatewayIp:A&&A.length?A[0].split("=")[1].replace(/-/g,"."):"",port:B&&B.length?B[0].split("=")[1]:"",isProxy:f?1:0}}else{const A=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),B=h.match(/(:|p=)[0-9]{1,6}/g);C={isSuccess:E,gatewayIp:A&&A.length?A[0].split("//")[1].replace(/-/g,"."):"",port:B&&B.length?B[0].split(/:|p=/g)[1]:"",isProxy:f?1:0}}else C={isSuccess:E,gatewayIp:"",port:"",isProxy:f?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const R=Object.assign({},v,C,{eventType:ss.REJOIN_GATEWAY});this.send({type:ln.RE_JOIN_GATEWAY,data:R},!0)}}joinChannelTimeout(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=Date.now(),c=zt(zt({},r.info),{},{lts:s,timeout:t,elapse:s-r.startTime});this.send({type:ln.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{eventType:ss.PUBLISH,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:ln.PUBLISH,data:d},!0)}subscribe(e,t,r){const s=this.baseInfoMap.get(e);if(!s)return;const c=s.info,d=Date.now(),h=zt(zt({},c),{},{eventType:ss.SUBSCRIBE,lts:d,eventElapse:t.eventElapse,elapse:d-s.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?h.peerSuid=t.peerid:h.peer=t.peerid,this.send({type:ln.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var t;const r=[...oa(t=this.baseInfoMap).call(t)],s=r.length?r[0]:"UnableToGetSid",c=this.baseInfoMap.get(s);if(!c)return;const d=c.info,h=Date.now(),f=zt(zt({},d),{},{eventType:ss.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:ln.WS_COMPRESSOR_INIT,data:f},!0)}firstXLAPeerFirstVideoFrame(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=t.peerPubStatusMs-(r.lastJoinSuccessTime||c),h=zt(zt({},s),{},{elapse:c-r.startTime,eventType:ss.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>d?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:ln.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(e,t,r,s){const c=this.baseInfoMap.get(e);if(!c)return;const d=c.info,h=Date.now(),f=zt(zt(zt({},d),s),{},{elapse:h-c.startTime,eventType:t,lts:h,firstDecodeFrame:Math.max((s.firstFrame||h)-c.startTime,0),apEnd:Math.max(s.apEnd-c.startTime,0),apStart:Math.max(s.apStart-c.startTime,0),joinGwEnd:Math.max(s.joinGwEnd-c.startTime,0),joinGwStart:Math.max(s.joinGwStart-c.startTime,0),pcEnd:Math.max(s.pcEnd-c.startTime,0),pcStart:Math.max(s.pcStart-c.startTime,0),subscriberEnd:Math.max(s.subscriberEnd-c.startTime,0),subscriberStart:Math.max(s.subscriberStart-c.startTime,0),videoAddNotify:Math.max(s.videoAddNotify-c.startTime,0)});this.send({type:r,data:f},!0)}firstRemoteFrame(e,t,r,s){const c=this.baseInfoMap.get(e);if(!c)return;const d=c.info,h=Date.now(),f=zt(zt(zt({},d),s),{},{elapse:h-c.startTime,eventType:t,lts:h});this.send({type:r,data:f},!0)}abTest(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt(zt({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-r.startTime,eventType:ss.AB_TEST,lts:c});this.send({type:ln.AB_TEST,data:d},!0)}pcStats(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt(zt({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),elapse:c-r.startTime,eventType:ss.PC_STATS,lts:c,preallocation:t.preallocation?1:0});this.send({type:ln.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(e,t){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt(zt({},s),t),{},{vid:s.vid===void 0?0:Number(s.vid),eventType:ss.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:ln.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(e,t,r,s){const c=this.baseInfoMap.get(e);if(!c)return;const d=c.info,h=Date.now(),f=zt(zt(zt({},d),s),{},{eventType:t,lts:h});this.send({type:r,data:f},!0)}streamSwitch(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{eventType:ss.STREAM_SWITCH,lts:c,isDual:t.isdual,elapse:c-r.startTime,success:t.succ});this.send({type:ln.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{eventType:ss.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ln.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{eventType:ss.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-t.lts,elapse:c-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ln.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(e){this.proxyServer=e,e?k.debug("reportProxyServerurl: ".concat(e)):k.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt({},s),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:c,elapse:c-r.startTime,joinChannelSuccessElapse:c-(r.lastJoinSuccessTime||c),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:ln.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now();(function(d,h,f){const g=d[h];if(!g||typeof g!="string")return[d];d[h]="";const v=od(JSON.stringify(d));let E=0;const C=[];let R=0;for(let A=0;A<g.length;A++)R+=g.charCodeAt(A)<=127?1:3,R<=f-v||(C[C.length]=Ke(Ke({},d),{},{[h]:g.substring(E,A)}),E=A,R=g.charCodeAt(A)<=127?1:3);return E!==g.length-1&&(C[C.length]=Ke(Ke({},d),{},{[h]:g.substring(E)})),C})(zt(zt(zt({},s),t),{},{elapse:c-r.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach((d=>this.send({type:ln.WORKER_EVENT,data:d},!0)))}apworkerEvent(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt(zt({},s),t),{},{elapse:c-r.startTime,lts:c});this.send({type:ln.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt(zt({},s),t),{},{elapse:c-r.startTime,lts:c,extend:t.extend||void 0});this.send({type:ln.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(e,t){const r=this.baseInfoMap.get(e);if(!r)return;const s=r.info,c=Date.now(),d=zt(zt(zt({},s),t),{},{elapse:c-r.startTime,lts:c});this.send({type:ln.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Z("CUSTOM_REPORT_LIMIT"))throw new Ne(J.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const r=Date.now(),s=t.map((c=>({type:ln.USER_ANALYTICS,data:zt(zt({sid:e},c),{},{lts:r})})));try{Z("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(s):await this.postDataToStatsCollector(s)}catch(c){throw k.error("send custom report message failed",c.toString()),new Ne(J.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const t=Z("NOT_REPORT_EVENT");if(e.tag&&$e(t)&&$e(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:s,uid:c,cid:d}=r.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ne){const{code:g,message:v}=e.error;h=g||v||e.error.toString()}else h=e.error.toString();const f={invokeId:e.invokeId,sid:e.sid,cname:s,cid:d,uid:c,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:ln.API_INVOKE,data:f},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find((r=>r!==null));t&&e.forEach((r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const r=[],s=[];for(;e.length;){const d=e.shift();r.length<20?r.push(d):s.push(d)}e.push(...s);for(const d of[...r]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),vf(c=this.ltsList).call(c,((h,f)=>h-f)))}return t||(this.lastSendNormalEventTime=Date.now()),Z("ENABLE_EVENT_REPORT")&&r.length&&(Z("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((d=>h=>{Z("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>Z("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Z("NORMAL_EVENT_QUEUE_CAPACITY")),k.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){Un.networkState===Ra.OFFLINE&&await nt.race([Un.onlineWaiter,Ns(2*Kn.maxRetryTimeout)]);const t=c=>{let d=new Uint8Array;return c.forEach((h=>{const f=XI(JSON.stringify(h.data)),g=new ArrayBuffer(5),v=(C=>{let R=0;return Object.entries(ln).forEach((A=>{let[B,L]=A;L===C.type&&(R=Zte[B])})),R})(h),E=new DataView(g);E.setUint16(0,f.byteLength,!0),E.setUint8(2,255&v),E.setUint8(3,v>>>8&255),E.setUint8(4,v>>>16&255),d=K4(d,new Uint8Array(g)),d=K4(d,f)})),d},r="event";let s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let c=0;c<2;c+=1){c===1&&(s=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(Z("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await nO(s,{timeout:1e4,data:t(e),headers:zt(zt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=(f=>{const g=f&&f.data.sid&&this.baseInfoMap.get(f.data.sid);return g&&g.info.vid&&+g.info.vid||0})(e[0]),s=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((f=>JSON.stringify(f))),vid:r,aid:s};Un.networkState===Ra.OFFLINE&&await nt.race([Un.onlineWaiter,Ns(2*Kn.maxRetryTimeout)]);const d=t?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(Z("EVENT_REPORT_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(d));for(let f=0;f<2;f+=1){f===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Z("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(Z("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Z("STATS_COLLECTOR_PORT")).concat(d)));try{t?await Ute(h,{timeout:1e4,data:c}):await nO(h,{timeout:1e4,data:c})}catch(g){if(f===1)throw g;continue}return}}createBaseInfo(e,t){const r=Object.assign({},Qte);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){const r=performance.getEntriesByName(e),s=r[r.length-1];s&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:s,tag:un.TRACER}).onSuccess()}};E3.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Un.networkState,ft.reportApiInvoke(null,{name:"logUploadError",options:e,tag:un.TRACER}).onSuccess("logUploadError")}));class Ce extends Ne{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Tn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,k)}throw(){super.throw(k)}}const As={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function vr(){return As}function S3(){return"setSinkId"in HTMLAudioElement.prototype&&(!Z("RESTRICTION_SET_PLAYBACK_DEVICE")||(iu()||D4())&&!zI())}function rT(){return!As.supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&au()}function mO(e){return!(Sn()||j4(87)||rT()||!Z("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||Z("FORCE_DISABLE_AUTO_SUB")))}function x3(e){return!!Z("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||Z("FORCE_DISABLE_AUTO_SUB"))}let Is=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function b_(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function Er(e,t,r,s,c){return{width:e,height:t,frameRate:r,bitrateMin:s,bitrateMax:c}}function ac(e,t,r,s,c){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:s,bitrateMax:c}}function gO(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const ere={"90p":Er(160,90),"90p_1":Er(160,90),"120p":Er(160,120,15,30,65),"120p_1":Er(160,120,15,30,65),"120p_3":Er(120,120,15,30,50),"120p_4":Er(212,120),"180p":Er(320,180,15,30,140),"180p_1":Er(320,180,15,30,140),"180p_3":Er(180,180,15,30,100),"180p_4":Er(240,180,15,30,120),"240p":Er(320,240,15,40,200),"240p_1":Er(320,240,15,40,200),"240p_3":Er(240,240,15,40,140),"240p_4":Er(424,240,15,40,220),"360p":Er(640,360,15,80,400),"360p_1":Er(640,360,15,80,400),"360p_3":Er(360,360,15,80,260),"360p_4":Er(640,360,30,80,600),"360p_6":Er(360,360,30,80,400),"360p_7":Er(480,360,15,80,320),"360p_8":Er(480,360,30,80,490),"360p_9":Er(640,360,15,80,800),"360p_10":Er(640,360,24,80,800),"360p_11":Er(640,360,24,80,1e3),"480p":Er(640,480,15,100,500),"480p_1":Er(640,480,15,100,500),"480p_2":Er(640,480,30,100,1e3),"480p_3":Er(480,480,15,100,400),"480p_4":Er(640,480,30,100,750),"480p_6":Er(480,480,30,100,600),"480p_8":Er(848,480,15,100,610),"480p_9":Er(848,480,30,100,930),"480p_10":Er(640,480,10,100,400),"720p":Er(1280,720,15,120,1130),"720p_auto":Er(1280,720,30,900,3e3),"720p_1":Er(1280,720,15,120,1130),"720p_2":Er(1280,720,30,120,2e3),"720p_3":Er(1280,720,30,120,1710),"720p_5":Er(960,720,15,120,910),"720p_6":Er(960,720,30,120,1380),"1080p":Er(1920,1080,15,120,2080),"1080p_1":Er(1920,1080,15,120,2080),"1080p_2":Er(1920,1080,30,120,3e3),"1080p_3":Er(1920,1080,30,120,3150),"1080p_5":Er(1920,1080,60,120,4780),"1440p":Er(2560,1440,30,120,4850),"1440p_1":Er(2560,1440,30,120,4850),"1440p_2":Er(2560,1440,60,120,7350),"4k":Er(3840,2160,30,120,8910),"4k_1":Er(3840,2160,30,120,8910),"4k_3":Er(3840,2160,60,120,13500)},tre={"480p":ac(640,480,5),"480p_1":ac(640,480,5),"480p_2":ac(640,480,30),"480p_3":ac(640,480,15),"720p":ac(1280,720,5),"720p_auto":Er(1280,720,30,900,3e3),"720p_1":ac(1280,720,5),"720p_2":ac(1280,720,30),"720p_3":ac(1280,720,15),"1080p":ac(1920,1080,5),"1080p_1":ac(1920,1080,5),"1080p_2":ac(1920,1080,30),"1080p_3":ac(1920,1080,15)},rre={"1SL1TL":gO(1,1),"3SL3TL":gO(3,3),"2SL3TL":gO(2,3)};function oc(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},ere[e]):e}function _O(e){return typeof e=="string"?Object.assign({},tre[e]):e}function nT(e){return typeof e=="string"?Object.assign({},rre[e]):e}const nre={speech_low_quality:b_(16e3,!1),speech_standard:b_(32e3,!1,18),music_standard:b_(48e3,!1),standard_stereo:b_(48e3,!0,56),high_quality:b_(48e3,!1,128),high_quality_stereo:b_(48e3,!0,192)};function sT(e){return typeof e=="string"?Object.assign({},nre[e]):e}const S_=[];function T3(e){return ns(e,"mediaSource",["screen","window","application"]),!0}let dt=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),Hr=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),x_=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),sre=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),ire=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),kf=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),T_=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),Co=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),C_=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),Ka=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const yO={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},vO={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},C3={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},are={uplinkNetworkQuality:0,downlinkNetworkQuality:0},R3={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ki=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),za=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),EE=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),Pf=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),Js=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),ld=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({});const EO={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let iT=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function pr(e,t,r,s,c){var d,h,f={};return Object.keys(s).forEach((function(g){f[g]=s[g]})),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=ea(d=Vp(h=r.slice()).call(h)).call(d,(function(g,v){return v(e,t,g)||g}),f),c&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(c):void 0,f.initializer=void 0),f.initializer===void 0?(Object.defineProperty(e,t,f),null):f}function xe(e,t,r){return(t=(function(s){var c=(function(d,h){if(typeof d!="object"||!d)return d;var f=d[Symbol.toPrimitive];if(f!==void 0){var g=f.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(s);return typeof c=="symbol"?c:c+""})(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function Qr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N3(Object(r),!0).forEach((function(s){xe(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N3(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}class A3 extends _n{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(kf.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),xe(this,"trackMediaType",void 0),xe(this,"_ID",void 0),xe(this,"_rtpTransceiver",void 0),xe(this,"_lowRtpTransceiver",void 0),xe(this,"_hints",[]),xe(this,"_isClosed",!1),xe(this,"_originMediaStreamTrack",void 0),xe(this,"mediaStreamTrack",void 0),xe(this,"_external",{}),this._ID=r||zr(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(s){$e(S_).call(S_,s)||S_.push(s)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Th((()=>{var r;ft.reportApiInvoke(null,{name:In.GET_MEDIA_STREAM_TRACK,options:[],tag:un.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===x_.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){const r=S_.indexOf(t);r!==-1&&S_.splice(r,1)})(this),this.emit(T_.CLOSED),this.removeAllListeners(kf.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===x_.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(kf.TRANSCEIVER_UPDATED,t,r)}}class R_ extends A3{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),xe(this,"_enabled",!0),xe(this,"_muted",!1),xe(this,"_isExternalTrack",!1),xe(this,"_isClosed",!1),xe(this,"_enabledMutex",void 0),xe(this,"processor",void 0),xe(this,"_processorContext",void 0),xe(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Xs("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,k.debug("[".concat(this.getTrackId(),"] close")),this.emit(dt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=s,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,dt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(T_.TRACK_ENDED)}stateCheck(t,r){if(k.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),sl(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new Ne(J.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",k);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new Ne(J.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",k)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():nt.resolve([])}}const I3=window.AudioContext||window.webkitAudioContext;let $a=null;const Br=new class extends _n{constructor(){super(...arguments),xe(this,"prevState",void 0),xe(this,"curState",void 0),xe(this,"currentTime",void 0),xe(this,"currentTimeStuckAt",void 0),xe(this,"interruptDetectorTrack",void 0),xe(this,"onLocalAudioTrackMute",(()=>{k.info("ios15-interruption-start"),this.emit(Is.IOS_15_16_INTERRUPTION_START)})),xe(this,"onLocalAudioTrackUnmute",(async()=>{k.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?k.info("ios15-interruption-end-canceled"):($a&&await $a.suspend(),this.emit(Is.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){k.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){k.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function N_(){if(!$a){if((function(){if(!I3)return void k.error("your browser is not support web audio");k.info("create audio context");const e=Qr({},Z("WEBAUDIO_INIT_OPTIONS"));k.debug("audio context init option:",JSON.stringify(e)),$a=new I3(e),Br.curState=$a.state,$a.onstatechange=()=>{Br.prevState=Br.curState,Br.curState=$a?$a.state:void 0;const{prevState:t,curState:r}=Br,s=r==="running",c=r==="interrupted",d=t==="running",h=t==="suspended",f=t==="interrupted",g=fr().osVersion;(ii()||sc())&&d&&c&&(k.info("ios".concat(g,"-interruption-start")),Br.emit(Is.IOS_INTERRUPTION_START)),(ii()||sc())&&(h||f)&&s&&(k.info("ios".concat(g,"-interruption-end")),Br.emit(Is.IOS_INTERRUPTION_END)),t!==r&&Br.emit(Is.STATE_CHANGE,r,t)},setInterval((()=>{var t;const r=(t=$a)===null||t===void 0?void 0:t.currentTime;Br.currentTime!==r?(Br.currentTimeStuckAt&&(k.debug("AudioContext current time resume at ".concat(r)),Br.currentTimeStuckAt=void 0),Br.currentTime=r):(r!==Br.currentTimeStuckAt&&(ft.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:un.TRACER}).onSuccess(),k.warning("AudioContext current time stuck at ".concat(r))),Br.currentTimeStuckAt=r)}),5e3),(async function(t){const r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let s,c=!1,d=!1,h=!1;function f(L){t.state==="running"?g(!1):ii()||sc()?t.state==="suspended"&&(g(!0),L&&t.resume().then(v,v)):t.state!=="closed"&&(g(!0),L&&t.resume().then(v,v))}function g(L){if(c!==L){c=L;for(let U=0,X=r;U<X.length;U+=1){const Y=X[U];L?window.addEventListener(Y,E,{capture:!0,passive:!0}):window.removeEventListener(Y,E,{capture:!0,passive:!0})}}}function v(){f(!1)}function E(){f(!0)}function C(L){if(!h)if(s.paused)if(L){let U;R(!1),h=!0;try{U=s.play(),U?U.then(A,A):(s.addEventListener("playing",A),s.addEventListener("abort",A),s.addEventListener("error",A))}catch{A()}}else R(!0);else R(!1)}function R(L){if(d!==L){d=L;for(let U=0,X=r;U<X.length;U++){const Y=X[U];L?window.addEventListener(Y,B,{capture:!0,passive:!0}):window.removeEventListener(Y,B,{capture:!0,passive:!0})}}}function A(){s.removeEventListener("playing",A),s.removeEventListener("abort",A),s.removeEventListener("error",A),h=!1,C(!1)}function B(){C(!0)}if(ii()){const L=t.createMediaStreamDestination(),U=document.createElement("div");U.innerHTML="<audio x-webkit-airplay='deny'></audio>",s=U.children.item(0),s.controls=!1,s.disableRemotePlayback=!0,s.preload="auto",s.srcObject=L.stream,C(!0)}Br.on(Is.STATE_CHANGE,(function(){f(!0)})),f(!1)})($a)})(),!$a)throw new Ne(J.NOT_SUPPORTED,"can not create audio context");return $a}return $a}function Df(e){if((function(){if(wO!==null)return wO;const s=N_(),c=s.createBufferSource(),d=s.createGain(),h=s.createGain();c.connect(d),c.connect(h),c.disconnect(d);let f=!1;try{c.disconnect(d)}catch{f=!0}return c.disconnect(),wO=f,f})())return;const t=e.connect,r=e.disconnect;e.connect=(s,c,d)=>{var h;return e._inputNodes||(e._inputNodes=[]),$e(h=e._inputNodes).call(h,s)||(s instanceof AudioNode?(e._inputNodes.push(s),t.call(e,s,c,d)):t.call(e,s,c)),e},e.disconnect=(s,c,d)=>{r.call(e),s?$x(e._inputNodes,s):e._inputNodes=[];for(const h of e._inputNodes)t.call(e,h)}}let wO=null;function bO(e,t){let r=!1;const s=1/t;if(Z("DISABLE_WEBAUDIO")){const c=window.setInterval((()=>{r?window.clearInterval(c):e(performance.now()/1e3)}),1e3*s)}else{const c=N_();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(r)return void(d=null);const f=c.createOscillator();f.onended=h,f.connect(d),f.start(0),f.stop(c.currentTime+s),e(c.currentTime)};h()}return()=>{r=!0}}class O3{constructor(){xe(this,"context",void 0),xe(this,"analyserNode",void 0),xe(this,"sourceNode",void 0),this.context=N_(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ii()||sc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<t.length;++c)t[c]=s[c]/128-1}const r=ea(t).call(t,((s,c)=>s+c*c),0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{k.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class k3 extends _n{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var s;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),xe(this,"outputNode",void 0),xe(this,"outputTrack",void 0),xe(this,"isPlayed",!1),xe(this,"sourceNode",void 0),xe(this,"context",void 0),xe(this,"audioBufferNode",void 0),xe(this,"destNode",void 0),xe(this,"audioOutputLevel",0),xe(this,"volumeLevelAnalyser",void 0),xe(this,"_processedNode",void 0),xe(this,"playNode",void 0),xe(this,"isDestroyed",!1),xe(this,"onNoAudioInput",void 0),xe(this,"isNoAudioInput",!1),xe(this,"_noAudioInputCount",0),this.context=N_(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Df(this.outputNode),this.volumeLevelAnalyser=new O3}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(Ka.ON_AUDIO_BUFFER,(function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const d=s.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return s.inputBuffer})(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!vr().webAudioMediaStreamDest)throw new Ne(J.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Yx((()=>{Br.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ii()||sc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const r=this.volumeLevelAnalyser.getAnalyserNode();let s;r.getFloatTimeDomainData?(s=new Float32Array(r.fftSize),r.getFloatTimeDomainData(s)):(s=new Uint8Array(r.fftSize),r.getByteTimeDomainData(s));let c=!1;for(let d=0;d<s.length;d++)s[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Ns(200),await this.checkHasAudioInput(t?t+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class P3 extends k3{get isFreeze(){return!1}constructor(t,r,s){var c;if(super(),xe(this,"sourceNode",void 0),xe(this,"track",void 0),xe(this,"clonedTrack",void 0),xe(this,"audioElement",void 0),xe(this,"isCurrentTrackCloned",!1),xe(this,"isRemoteTrack",!1),xe(this,"originVolumeLevelAnalyser",void 0),xe(this,"rebuildWebAudio",(async()=>{if(k.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void k.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>k.info("resume success"))),k.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),Df(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Df(this.outputNode),this.emit(Ka.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new Ne(J.UNEXPECTED_ERROR);this.track=t;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(d),Df(this.sourceNode),s){const f=s.clone();f.enabled=!0,this.clonedTrack=f,k.debug("create an unmuted track ".concat(f.id," from the original track ").concat(s.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([f]));Df(g),this.originVolumeLevelAnalyser=new O3,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=fr();r&&h.os===ls.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Br.on(Is.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),Df(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Ka.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Br.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),k.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([r]));Df(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function D3(e,t,r){const s=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:s(t.height,1080),maxWidth:s(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(c.video.mandatory.maxFrameRate=t.frameRate.max,c.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(c.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function ore(e,t){const r=await j3(e.mediaSource),{sourceId:s,audio:c}=await(function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new nt(((f,g)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const C=document.createElement("div");C.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",C.setAttribute("style","height: 12%;");const R=document.createElement("div");R.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const A=document.createElement("div");A.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const B=document.createElement("button");B.innerHTML="cancel",B.setAttribute("style","width: 85px;"),B.onclick=()=>{document.body.removeChild(X);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",g(Y)};let L=h;const U=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const ee=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),ee.innerText="Share audio",Y.checked=L,Y.onchange=()=>{L=Y.checked},U.appendChild(Y),U.appendChild(ee)}A.appendChild(U),A.appendChild(B),E.appendChild(C),E.appendChild(R),E.appendChild(A);const X=document.createElement("div");X.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),X.appendChild(v),X.appendChild(E),document.body.appendChild(X),d.map((Y=>{if(Y.id){const ee=document.createElement("div");ee.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ue=Y.thumbnail;try{const{width:de}=ue.getSize();de>1920&&(ue=ue.resize({width:1920}))}catch(de){throw de&&de.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),de}ee.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ue.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,(function(de){return"&#"+de.charCodeAt(0)+";"}))+"</span>",ee.onclick=()=>{document.body.removeChild(X),f({sourceId:Y.id,audio:L})},R.appendChild(ee)}}))}))})(r,t);return await D3(s,e,c)}async function j3(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const r=z4();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new Ne(J.ELECTRON_IS_NULL);let s=null;try{var c;s=((c=r.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{s=null}s&&s.then||(s=new nt(((d,h)=>{r.desktopCapturer.getSources({types:t},((f,g)=>{f?h(f):d(g)}))})));try{return await s}catch(d){throw new Ne(J.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const SO=new Xs("safari");let L3=!1,M3=!1;async function Ya(e,t){let r=0,s=null;for(;r<2;)try{s=await cre(e,t,r>0);break}catch(c){if(c instanceof Ne)throw k.error("[".concat(t,"] ").concat(c.toString())),c;const d=aT(c.name||c.code||c,c.message);if(d.code===J.MEDIA_OPTION_INVALID){k.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Ns(500);continue}throw k.error("[".concat(t,"] ").concat(d.toString())),d}if(!s)throw new Ne(J.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}async function cre(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ne(J.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const s=vr(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return k.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(z4())e.screen.sourceId?A_(c,await D3(e.screen.sourceId,e.screen,!!e.screenAudio)):A_(c,await ore(e.screen,!!e.screenAudio));else if(iu()&&e.screen.extensionId&&e.screen.mandatory){if(!s.getStreamFromExtension)throw new Ne(J.NOT_SUPPORTED,"This browser does not support screen sharing");k.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const R=await(h=e.screen.extensionId,f=t,new nt(((A,B)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},(L=>{if(!L||!L.streamId)return k.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),L),void B(new Ne(J.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));A(L.streamId)}))}catch(L){k.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),L.toString()),B(new Ne(J.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=R,A_(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(s.getDisplayMedia){var d;e.screen.mediaSource&&T3(e.screen.mediaSource);const R={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(d=e.screen.displaySurface)!==null&&d!==void 0?d:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:A,surfaceSwitching:B,systemAudio:L,preferCurrentTab:U}=e.screen,X={selfBrowserSurface:A,surfaceSwitching:B,systemAudio:L,preferCurrentTab:U};!A&&delete X.selfBrowserSurface,!B&&delete X.surfaceSwitching,!L&&delete X.systemAudio,!U&&delete X.preferCurrentTab,k.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:R,audio:e.screenAudio,controls:X})),A_(c,await navigator.mediaDevices.getDisplayMedia(Qr({video:R,audio:e.screenAudio},X)))}else{if(!Sn())throw k.error("[".concat(t,"] This browser does not support screenSharing")),new Ne(J.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&T3(e.screen.mediaSource);const R={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};k.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(R))),A_(c,await navigator.mediaDevices.getUserMedia(R))}}var h,f;if(!e.video&&!e.audio)return c;let g={video:e.video,audio:e.audio},v=Z("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),g=ZI(g,v)}catch{}k.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(g)),fr();let E,C=null;(Us()||ii()||Kx())&&(C=await SO.lock());try{E=await navigator.mediaDevices.getUserMedia(g)}catch(R){throw C&&C(),R}return g.audio&&(L3=!0),g.video&&(M3=!0),A_(c,E),C&&C(),c}function aT(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ne(J.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Ne(J.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Ne(J.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Ne(J.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ne(J.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Ne(J.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return k.error("getUserMedia unexpected error",e),new Ne(J.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function A_(e,t){const r=e.getVideoTracks()[0],s=e.getAudioTracks()[0],c=t.getVideoTracks()[0],d=t.getAudioTracks()[0];d&&(s&&e.removeTrack(s),e.addTrack(d)),c&&(r&&e.removeTrack(r),e.addTrack(c))}const Xa=new class extends _n{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Pf.STATE_CHANGE,e),this._state=e)}constructor(){super(),xe(this,"_state",EE.IDLE),xe(this,"isAccessMicrophonePermission",!1),xe(this,"isAccessCameraPermission",!1),xe(this,"lastAccessMicrophonePermission",!1),xe(this,"lastAccessCameraPermission",!1),xe(this,"checkdeviceMatched",!1),xe(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(Z("ENUMERATE_DEVICES_INTERVAL")||(zx()||Hx()===ls.HARMONY_OS)&&au())&&this.updateDevicesInfo()}),Z("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>k.error(e.toString())))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ne(J.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const s=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(s);let d=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;c.audio&&(d=!1),c.video&&(h=!1);let f=null,g=null,v=null;if(!r&&(d||h)){if(SO.isLocked&&(k.debug("[device manager] wait GUM lock"),(await SO.lock())(),k.debug("[device manager] GUM unlock")),L3&&(d=!1,this.isAccessMicrophonePermission=!0),M3&&(h=!1,this.isAccessCameraPermission=!0),k.debug("[device manager] check media device permissions",e,t,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(E){const C=aT(E.name||E.code||E,E.message);if(C.code===J.PERMISSION_DENIED)throw C;k.warning("getUserMedia failed in getDevices",C)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{f=await navigator.mediaDevices.getUserMedia({audio:e})}catch(E){const C=aT(E.name||E.code||E,E.message);if(C.code===J.PERMISSION_DENIED)throw C;k.warning("getUserMedia failed in getDevices",C)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:t})}catch(E){const C=aT(E.name||E.code||E,E.message);if(C.code===J.PERMISSION_DENIED)throw C;k.warning("getUserMedia failed in getDevices",C)}this.isAccessCameraPermission=!0}k.debug("[device manager] mic permission",e,"cam permission",t)}try{const E=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach((C=>C.stop())),g&&g.getTracks().forEach((C=>C.stop())),v&&v.getTracks().forEach((C=>C.stop())),f=null,g=null,v=null,E}catch(E){return f&&f.getTracks().forEach((C=>C.stop())),g&&g.getTracks().forEach((C=>C.stop())),v&&v.getTracks().forEach((C=>C.stop())),f=null,g=null,v=null,new Ne(J.ENUMERATE_DEVICES_FAILED,E.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audioinput"))}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((t=>t.kind==="videoinput"))}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audiooutput"))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((r=>{r.device.label===e&&(t=r.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((r=>r.deviceId===e));if(!t)throw new Ne(J.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=EE.INITING;try{await this.updateDevicesInfo(),this.state=EE.INITEND}catch(e){throw k.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=EE.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ne(J.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find((h=>h.kind==="audioinput"&&h.deviceId==="default")),d=e.find((h=>h.kind==="audiooutput"&&h.deviceId==="default"));c&&d?d.groupId===c.groupId?k.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):k.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):k.debug("[device-check] default input or output not found")}const s=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:t,updateAt:t,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),r.push(h)}d&&(d.updateAt=t)})),this.deviceInfoMap.forEach(((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==t&&(c.state="INACTIVE",r.push(c))})),this.state!==EE.INITEND)return s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach((c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Pf.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Pf.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Pf.PLAYOUT_DEVICE_CHANGED,c)}})),s.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),s.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((c=>c.kind==="audioinput")),r=e.filter((c=>c.kind==="videoinput")),s={audio:!1,video:!1};for(const c of t)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of r)if(c.label&&c.deviceId){s.video=!0;break}return s}};let xO=!1;const Ja=new class extends _n{constructor(){super(...arguments),xe(this,"onAutoplayFailed",void 0),xe(this,"onAudioAutoplayFailed",void 0)}};function U3(){if(fr(),!xO){const e=t=>{t.preventDefault(),xO=!1,dE()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};xO=!0,dE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),k.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ja.onAutoplayFailed?Ja.onAutoplayFailed():Ja.onAudioAutoplayFailed?k.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):k.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ja.emit("autoplay-failed")}}function F3(e,t,r,s){if(!e)return;const c=ft.getBaseInfoBySessionId(e);if(!c)return;const d=c.info,h=Date.now(),f=Qr(Qr({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:Ja.onAutoplayFailed||Ja.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:s,extend:void 0});ft.send({type:ln.AUTOPLAY_FAILED,data:f},!0)}const lre=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Gi=new class{constructor(){xe(this,"onAutoplayFailed",void 0),xe(this,"elementMap",new Map),xe(this,"elementStateMap",new Map),xe(this,"elementsNeedToResume",[]),xe(this,"sinkIdMap",new Map),xe(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[r,s]=t;const c=this.elementStateMap.get(r),d=s.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(k.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return s.pause(),void s.play();if(Br.curState==="running")return m_()?(s.pause(),void s.play()):void(c&&c==="paused"&&s.play())}}))})),xe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,r]=e;const s=r.srcObject.getAudioTracks()[0];s&&s.readyState==="live"&&(k.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())}))})),this.autoResumeAudioElement(),Br.on(Is.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Br.on(Is.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Br.on(Is.STATE_CHANGE,(()=>{ii()&&Br.prevState==="suspended"&&Br.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(s){throw new Ne(J.PERMISSION_DENIED,"can not set sink id: "+s.toString())}}play(e,t,r,s){if(this.elementMap.has(t))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,c),this.elementMap.set(t,c),this.elementStateMap.set(t,Js.INIT),this.setVolume(t,r);const d=this.sinkIdMap.get(t);if(d)try{c.setSinkId(d).catch((f=>{k.warning("[".concat(t,"] set sink id failed"),f.toString())}))}catch(f){k.warning("[".concat(t,"] set sink id failed"),f.toString())}const h=c.play();h&&h.then&&h.catch((f=>{s&&F3(s,"audio",f.message,t),k.warning("audio element play warning",f.toString()),this.elementMap.has(t)&&f.name==="NotAllowedError"&&(k.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),Yx((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),U3()})))}))}updateTrack(e,t){const r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){lre.forEach((r=>{t.addEventListener(r,(s=>{const c=this.elementStateMap.get(e),d=s.type==="pause"?"paused":s.type;if(k.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(d)),s.type==="error"){const h=t==null?void 0:t.error;h&&k.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,d)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((r=>{k.debug("Auto resume audio element success")})).catch((r=>{k.warning("Auto resume audio element failed!",r)}))})),this.elementsNeedToResume=[]};new nt((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{dE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function Rn(){return function(e,t,r){const s=r.value;return typeof s=="function"&&(r.value=function(){this._isClosed&&new Ne(J.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",k);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const f=s.apply(this,d);return f instanceof nt?new nt(((g,v)=>{f.then(g).catch(v)})):f}),r}}class V3 extends _n{constructor(t){super(),xe(this,"name","VideoProcessorDestination"),xe(this,"ID","0"),xe(this,"_source",void 0),xe(this,"videoContext",void 0),xe(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ne(J.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ne(J.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ki.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ki.ON_TRACK,void 0)}}class B3 extends _n{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),xe(this,"constraintsMap",new Map),xe(this,"statsRegistry",[]),xe(this,"usageRegistry",[]),xe(this,"trackId",void 0),xe(this,"direction",void 0),xe(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await Vs(this,za.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var s;return k.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),Kr(this,za.REQUEST_UPDATE_CONSTRAINTS,Array.from(xa(s=this.constraintsMap).call(s)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return k.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Kr(this,za.REQUEST_UPDATE_CONSTRAINTS,Array.from(xa(r=this.constraintsMap).call(r)))}registerStats(t,r,s){this.statsRegistry.find((c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:s})}unregisterStats(t,r){const s=this.statsRegistry.findIndex((c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r));s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();t.push({processorID:r,processorName:s,type:c,stats:h})}catch(h){k.error(new Ne(J.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find((s=>s.processorID===t.ID&&s.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex((s=>s.processorID===t.ID&&s.processorName===t.name));r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let s=r();s instanceof nt&&(s=await s),t.push(Qr(Qr({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return t}getDirection(){return this.direction}}class W3 extends _n{constructor(t){super(),xe(this,"name","AudioProcessorDestination"),xe(this,"ID","0"),xe(this,"inputTrack",void 0),xe(this,"inputNode",void 0),xe(this,"audioProcessorContext",void 0),xe(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ne(J.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ne(J.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ki.ON_TRACK,void 0),this.emit(ki.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ki.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ki.ON_NODE,this.inputNode))}}class q3 extends _n{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,s){super(),xe(this,"constraintsMap",new Map),xe(this,"statsRegistry",[]),xe(this,"audioContext",void 0),xe(this,"trackId",void 0),xe(this,"direction",void 0),xe(this,"usageRegistry",[]),xe(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=s}async getConstraints(){return Vs(this,za.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var s;return k.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),Kr(this,za.REQUEST_UPDATE_CONSTRAINTS,Array.from(xa(s=this.constraintsMap).call(s)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Kr(this,za.REQUEST_UPDATE_CONSTRAINTS,Array.from(xa(r=this.constraintsMap).call(r)))}registerStats(t,r,s){this.statsRegistry.find((c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:s})}unregisterStats(t,r){const s=this.statsRegistry.findIndex((c=>c.processorID===t.ID&&c.processorName===t.name&&c.type===r));s!==-1&&this.statsRegistry.splice(s,1)}gatherStats(){const t=[];for(const{processorID:r,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();t.push({processorID:r,processorName:s,type:c,stats:h})}catch(h){k.error(new Ne(J.UNEXPECTED_ERROR,h.message))}return t}registerUsage(t,r){this.usageRegistry.find((s=>s.processorID===t.ID&&s.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){const r=this.usageRegistry.findIndex((s=>s.processorID===t.ID&&s.processorName===t.name));r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:r}of this.usageRegistry)try{let s=r();s instanceof nt&&(s=await s),t.push(Qr(Qr({},s),{},{direction:this.direction}))}catch(s){k.error("gather extension usage error",s)}return t}getDirection(){return this.direction}}class TO extends _n{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),xe(this,"context",void 0),xe(this,"processSourceNode",void 0),xe(this,"outputTrack",void 0),xe(this,"processedNode",void 0),xe(this,"clonedTrack",void 0),xe(this,"outputNode",void 0),this.outputNode=new dre}setVolume(){}createOutputTrack(){throw new Ne(J.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class dre{disconnect(){}connect(){}}function G3(e){return new nt(((t,r)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=ii()?"canplay":"playing";c.addEventListener(d,(()=>{const h=c.videoWidth,f=c.videoHeight;!h&&Sn()||(s=!0,c.srcObject=null,c.remove(),t([h,f]))})),c.srcObject=new MediaStream([e]),c.play().catch(Xx),setTimeout((()=>{s||(c.srcObject=null,c.remove(),t([c.videoWidth,c.videoHeight]))}),4e3)}))}function oT(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const r=oc(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!W4()&&r.frameRate&&(t.frameRate=r.frameRate),D4()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Sn()&&(t.frameRate={ideal:30,max:30}),t}function H3(e){const t={};return W4()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,iu()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function K3(e){const t=H3(e);if(e.encoderConfig){const r=sT(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),zx()&&(t.sampleRate=void 0),t}const ure=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:r,width:s,height:c}=e.getMediaStreamTrackSettings();let{frameRate:d=r,width:h=s,height:f=c}=t;if(!d||!h||!f)return;h=y_(h),f=y_(f),d=y_(d);const{max:g,min:v}=(function(A,B,L){const U=200*Math.pow(L/15,.6)*Math.pow(A*B/640/360,.75);return{min:Math.floor(U),max:Math.floor(4*U)}})(h,f,d),{bitrateMax:E,bitrateMin:C}=t||{};E||k.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(f,", fps: ").concat(d,"] => [brMax: ").concat(E,", brMin: ").concat(C,"]"));const{maxFramerate:R}=Z("ENCODER_CONFIG_LIMIT");return R&&typeof R=="number"&&(d=Math.min(d,R)),{frameRate:d,bitrateMax:E||g,bitrateMin:C||v,scaleResolutionDownBy:1,scale:0}},z3=async(e,t,r)=>await(async(s,c,d)=>{const h=(function(v){const E=[];for(let C=0;C<v.length;C+=2)E.push(parseInt(v.slice(C,C+2),16));return Uint8Array.from(E)})(s3(""+c+d)).slice(0,16),f=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},g,s))})(e.buffer,t,r),CO=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new nt(((r,s)=>{t.toBlob((async c=>{if(t.remove(),c){const d=await $3(c);r({buffer:d,width:t.width,height:t.height})}else s(new Ne(J.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},$3=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var Y3,X3,J3,Q3,Z3,eF,tF,rF,nF,sF,iF,aF,oF,cF,lF,dF,uF,hF,yn,pF,fF,mF,gF,_F,yF,dd,vF,EF,wF,bF,SF,xF,TF,CF,RF,NF,AF,IF,OF,Ws;let Nn=(Y3=It({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),X3=It({argsMap:(e,t)=>[e.getTrackId(),t]}),J3=Rn(),Q3=v_("LocalAudioTrack","_enabledMutex"),Z3=It({argsMap:(e,t)=>[e.getTrackId(),t]}),eF=Rn(),tF=v_("LocalAudioTrack","_enabledMutex"),rF=It({argsMap:(e,t)=>[e.getTrackId(),t]}),nF=Rn(),sF=Rn(),iF=Rn(),aF=It({argsMap:e=>[e.getTrackId()]}),oF=Rn(),cF=It({argsMap:e=>[e.getTrackId()]}),lF=Rn(),dF=It({argsMap:e=>[e.getTrackId()]}),uF=It({argsMap:(e,t)=>[e.getTrackId(),t.name]}),hF=It({argsMap:e=>[e.getTrackId()]}),pr((yn=class extends R_{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Gi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,s){super(e,r),xe(this,"trackMediaType",C_.AUDIO),xe(this,"_encoderConfig",void 0),xe(this,"_trackSource",void 0),xe(this,"metadata",[]),xe(this,"_enabled",!0),xe(this,"_volume",100),xe(this,"_useAudioElement",!0),xe(this,"_bypassWebAudio",!1),xe(this,"processor",void 0),xe(this,"_processorContext",void 0),xe(this,"_processorDestination",void 0),xe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!s,this._trackSource=new TO,Z("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Z("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Us()&&!$a?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){Gr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Gi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void k.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Kr(this,dt.NEED_REPLACE_TRACK,this).then((()=>{k.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((r=>{k.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!S3())throw new Ne(J.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Gi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await Kr(this,dt.NEED_ENABLE_TRACK,this),k.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(s){throw r||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await Kr(this,dt.NEED_DISABLE_TRACK,this)}catch(s){throw r||(this._enabled=!0),k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Kr(this,dt.NEED_MUTE_TRACK,this):await Kr(this,dt.NEED_UNMUTE_TRACK,this))}getStats(){return Th((()=>{k.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),Ga(this,dt.GET_STATS)||Qr({},yO)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ka.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ka.ON_AUDIO_BUFFER),this._source.on(Ka.ON_AUDIO_BUFFER,(r=>e(r)))}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Gi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Gi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Gi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,dt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return nt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ne(J.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ne(J.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ki.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await Kr(this,dt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,dt.NEED_REPLACE_TRACK,this))})),e.on(ki.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(ki.ON_TRACK),e.removeAllListeners(ki.ON_NODE)}bindProcessorContextEvents(e){e.on(za.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(za.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof TO&&(this._trackSource=new P3(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new q3(this._source.context,this.getTrackId(),"local"),t=new W3(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Ka.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Gi.stop(this.getTrackId()),this._source.play()),Kr(this,dt.NEED_REPLACE_MIXING_TRACK,this).then((()=>{k.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((r=>{k.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Y3],Object.getOwnPropertyDescriptor(yn.prototype,"setVolume"),yn.prototype),pr(yn.prototype,"setPlaybackDevice",[X3,J3],Object.getOwnPropertyDescriptor(yn.prototype,"setPlaybackDevice"),yn.prototype),pr(yn.prototype,"setEnabled",[Q3,Z3,eF],Object.getOwnPropertyDescriptor(yn.prototype,"setEnabled"),yn.prototype),pr(yn.prototype,"setMuted",[tF,rF,nF],Object.getOwnPropertyDescriptor(yn.prototype,"setMuted"),yn.prototype),pr(yn.prototype,"getStats",[sF],Object.getOwnPropertyDescriptor(yn.prototype,"getStats"),yn.prototype),pr(yn.prototype,"setAudioFrameCallback",[iF],Object.getOwnPropertyDescriptor(yn.prototype,"setAudioFrameCallback"),yn.prototype),pr(yn.prototype,"play",[aF,oF],Object.getOwnPropertyDescriptor(yn.prototype,"play"),yn.prototype),pr(yn.prototype,"stop",[cF,lF],Object.getOwnPropertyDescriptor(yn.prototype,"stop"),yn.prototype),pr(yn.prototype,"close",[dF],Object.getOwnPropertyDescriptor(yn.prototype,"close"),yn.prototype),pr(yn.prototype,"pipe",[uF],Object.getOwnPropertyDescriptor(yn.prototype,"pipe"),yn.prototype),pr(yn.prototype,"unpipe",[hF],Object.getOwnPropertyDescriptor(yn.prototype,"unpipe"),yn.prototype),yn),wE=(pF=It({argsMap:(e,t)=>[e.getTrackId(),t]}),fF=Rn(),mF=v_("MicrophoneAudioTrack","_enabledMutex"),gF=It({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),_F=Rn(),yF=It({argsMap:e=>[e.getTrackId()]}),pr((dd=class extends Nn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,s){super(e,t.encoderConfig?sT(t.encoderConfig):{},s,Z("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),xe(this,"_config",void 0),xe(this,"_deviceName","default"),xe(this,"_constraints",void 0),xe(this,"_originalConstraints",void 0),xe(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(m_()||KI())&&Br.bindInterruptDetectorTrack(this)}async setDevice(e){if(k.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Xa.getDeviceById(e),r={};r.audio=Qr({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let s=null;try{s=await Ya(r,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),s=await Ya({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Xa.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}k.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return k.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Z("AUTO_RESET_AUDIO_ROUTE")&&(ii()||sc())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var s;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(s=this._source.clonedTrack)===null||s===void 0||s.stop(),r||(this._enabled=!1);try{await Kr(this,dt.NEED_DISABLE_TRACK,this)}catch(h){throw k.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Qr({},this._constraints),d=Xa.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{r||(this._enabled=!0);const h=await Ya({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await Kr(this,dt.NEED_ENABLE_TRACK,this)}catch(h){throw r||(this._enabled=!1),k.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}k.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(m_()||KI())&&Br.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ii()||sc())&&this._enabled&&!this._isClosed&&Br.duringInterruption){const e=async()=>{Br.off(Is.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Br.on(Is.IOS_INTERRUPTION_END,e)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(T_.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,r=Xa.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const s=await Ya({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(za.REQUEST_UPDATE_CONSTRAINTS,(async(t,r,s)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){s(c)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(za.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[pF,fF],Object.getOwnPropertyDescriptor(dd.prototype,"setDevice"),dd.prototype),pr(dd.prototype,"setEnabled",[mF,gF,_F],Object.getOwnPropertyDescriptor(dd.prototype,"setEnabled"),dd.prototype),pr(dd.prototype,"close",[yF],Object.getOwnPropertyDescriptor(dd.prototype,"close"),dd.prototype),dd),hre=(vF=It({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),EF=Rn(),wF=It({argsMap:e=>[e.getTrackId()]}),bF=Rn(),SF=It({argsMap:e=>[e.getTrackId()]}),xF=Rn(),TF=It({argsMap:e=>[e.getTrackId()]}),CF=Rn(),RF=It({argsMap:e=>[e.getTrackId()]}),NF=Rn(),AF=It({argsMap:e=>[e.getTrackId()]}),IF=It({argsMap:e=>[e.getTrackId()]}),OF=Rn(),pr((Ws=class extends Nn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,s){super(t.createOutputTrack(),r,s),xe(this,"source",void 0),xe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Ka.AUDIO_SOURCE_STATE_CHANGE,(c=>{this.safeEmit(T_.SOURCE_STATE_CHANGE,c)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Gr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[vF,EF],Object.getOwnPropertyDescriptor(Ws.prototype,"startProcessAudioBuffer"),Ws.prototype),pr(Ws.prototype,"pauseProcessAudioBuffer",[wF,bF],Object.getOwnPropertyDescriptor(Ws.prototype,"pauseProcessAudioBuffer"),Ws.prototype),pr(Ws.prototype,"seekAudioBuffer",[SF,xF],Object.getOwnPropertyDescriptor(Ws.prototype,"seekAudioBuffer"),Ws.prototype),pr(Ws.prototype,"resumeProcessAudioBuffer",[TF,CF],Object.getOwnPropertyDescriptor(Ws.prototype,"resumeProcessAudioBuffer"),Ws.prototype),pr(Ws.prototype,"stopProcessAudioBuffer",[RF,NF],Object.getOwnPropertyDescriptor(Ws.prototype,"stopProcessAudioBuffer"),Ws.prototype),pr(Ws.prototype,"close",[AF],Object.getOwnPropertyDescriptor(Ws.prototype,"close"),Ws.prototype),pr(Ws.prototype,"setAudioBufferPlaybackSpeed",[IF,OF],Object.getOwnPropertyDescriptor(Ws.prototype,"setAudioBufferPlaybackSpeed"),Ws.prototype),Ws);class Xn extends Nn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=N_().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,zr(8,"track-mix-")),xe(this,"trackList",void 0),xe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(k.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):k.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){k.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}$x(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((r=>{r instanceof Xn?r.emit(kf.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)})))}}class pre extends k3{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Ka.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),xe(this,"audioBuffer",void 0),xe(this,"sourceNode",void 0),xe(this,"startPlayTime",0),xe(this,"startPlayOffset",0),xe(this,"pausePlayTime",0),xe(this,"options",void 0),xe(this,"currentLoopCount",0),xe(this,"currentPlaybackSpeed",100),xe(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):k.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const kF=new Map;function PF(e,t){if(e.length===0||t.length===0)return 1/0;const r=eO(e),s=eO(t);return Math.floor(s/r)}class RO{get rendFrameRate(){const t=Math.max(1,PF(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:Js.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(k.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){xe(this,"trackId",void 0),xe(this,"config",void 0),xe(this,"onFirstVideoFrameDecoded",void 0),xe(this,"onFirstVideoFrameRender",void 0),xe(this,"onVideoStateChanged",void 0),xe(this,"freezeTimeCounterList",[]),xe(this,"renderFreezeAccTime",0),xe(this,"renderFreezeAccTime2",0),xe(this,"isKeepLastFrame",!1),xe(this,"isDestroyed",!1),xe(this,"timeUpdatedCount",0),xe(this,"freezeTime",0),xe(this,"playbackTime",0),xe(this,"lastTimeUpdatedTime",0),xe(this,"autoplayFailed",!1),xe(this,"videoTrack",void 0),xe(this,"videoElement",void 0),xe(this,"cacheVideoElement",void 0),xe(this,"internal",!1),xe(this,"_render_interframe_delays",[]),xe(this,"_render_interframe_delays_sizes",[]),xe(this,"_videoState",ld.VideoStateStopped),xe(this,"videoElementCheckInterval",void 0),xe(this,"videoElementFreezeTimeout",void 0),xe(this,"_videoElementStatus",Js.NONE),xe(this,"_isInPage",!0),xe(this,"isGettingVideoDimensions",!1),xe(this,"startGetVideoDimensions",(()=>{const r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return k.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()})),xe(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Br.curState==="running"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(k4())),V4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),xe(this,"handleVideoEvents",(r=>{switch(r.type){case"play":case"playing":r.type==="play"&&k.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=Js.PLAYING;break;case"loadeddata":if(this.videoState=ld.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Js.CANPLAY;break;case"stalled":this.videoElementStatus=Js.STALLED;break;case"suspend":this.videoElementStatus=Js.SUSPEND;break;case"pause":this.videoElementStatus=Js.PAUSED,ii()||sc()||Us()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Js.WAITING;break;case"abort":this.videoElementStatus=Js.ABORT;break;case"ended":this.videoElementStatus=Js.ENDED;break;case"emptied":this.videoElementStatus=Js.EMPTIED;break;case"error":{const s=this.videoElement.error;s&&(this.videoElementStatus=Js.ERROR,k.error("[".concat(this.trackId,"] media error: ").concat(s.message," (").concat(s.code,")")));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,ud.lastVisibleTime<ud.lastHiddenTime||d<ud.lastHiddenTime||d<ud.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>Z("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),xe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(k.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(k4())),V4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Br.on(Is.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Br.on(Is.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const r=this.videoElement.play();r&&r.catch&&r.catch((c=>{t&&F3(t,"video",c.message,this.trackId),c.name==="NotAllowedError"?(k.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):k.warning("[".concat(this.trackId,"] play warning: "),c)}));const s=fr();if((s.name==="Safari"&&Number(s.version)===15||m_())&&r&&r.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(c).catch(c)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const r=t.getContext("2d");if(!r)return k.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);const s=r.getImageData(0,0,t.width,t.height);return t.remove(),s}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const c=s.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,s.width,s.height),new nt(((d,h)=>{s.toBlob((async f=>{if(s.remove(),f){const g=await $3(f);d({buffer:g,width:s.width,height:s.height})}else h(new Ne(J.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,r<0?.1:r>1?1:r)}))):await CO(t)}destroy(){this.isDestroyed=!0,Br.off(Is.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Br.off(Is.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ld.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Js.INIT,!this.videoElementCheckInterval&&(DF.forEach((d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)}),1e3),Z("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(f,Z("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ld.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ld.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(v,E)=>{if(this.videoElementStatus===Js.PLAYING){if(d){const A=E.presentationTime-d.presentationTime,B=E.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(B),this._render_interframe_delays.push(A);const L=eO(this._render_interframe_delays_sizes),U=L-this._render_interframe_delays_sizes[0];if(L>30&&U>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===ld.VideoStateStarting&&(this.videoState=ld.VideoStateDecoding),this.videoState===ld.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,Z("VIDEO_FREEZE_DURATION"))),A<Z("VIDEO_FREEZE_DURATION")&&this.videoState===ld.VideoStateFrozen&&(this.videoState=ld.VideoStateDecoding),A>Z("VIDEO_FREEZE_DURATION")&&ud.lastVisibleTime>=ud.lastHiddenTime&&d.timestamp>ud.lastVisibleTime&&d.timestamp>ud.lastHiddenTime){const X=Math.min(66,PF(this._render_interframe_delays_sizes,this._render_interframe_delays)),Y=Math.max(0,A-(B-1)*X);this.renderFreezeAccTime2+=Y>X?Y:0,this.renderFreezeAccTime+=A}}d=Qr(Qr({},E),{},{timestamp:v})}else this.isSkipCalcRenderFreezeTime()&&(d=Qr(Qr({},E),{},{timestamp:v}));var C,R;Z("ENABLE_VIDEO_FRAME_CALLBACK")&&((C=(R=this.videoElement).requestVideoFrameCallback)===null||C===void 0||C.call(R,g))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),zx()&&!Z("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const s=fr();s.name==="Safari"&&Number(s.version)===15||m_()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Sn()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch((d=>{k.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())}))}resetVideoElement(){DF.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Js.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===Js.DESTROYED||this.internal}handleAutoPlayFailed(){const t=r=>{r.preventDefault(),this.videoElement.play().then((()=>{k.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((s=>{k.error(s)})),this.autoplayFailed=!1,dE()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};dE()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),U3()}}const DF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class NO extends RO{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),xe(this,"container",void 0),xe(this,"slot",void 0),this.slot=t.element,this.internal=r,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const r=t.element;var s;!this.internal||this.slot?(r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()):(this.slot=r,r&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(s=this.slot)===null||s===void 0||s.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,s):await CO(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Z("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var jF,LF,MF,UF,FF,VF,BF,WF,qF,GF,HF,KF,zF,$F,YF,XF,JF,QF,ZF,eV,tV,rV,nV,sV,iV,aV,oV,cV,nr,lV,dV,uV,hV,pV,fV,mV,gV,Qa;let tn=(jF=It({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),LF=Rn(),MF=It({argsMap:e=>[e.getTrackId()]}),UF=v_("LocalVideoTrack","_enabledMutex"),FF=It({argsMap:(e,t)=>[e.getTrackId(),t]}),VF=Rn(),BF=v_("LocalVideoTrack","_enabledMutex"),WF=It({argsMap:(e,t)=>[e.getTrackId(),t]}),qF=Rn(),GF=It({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),HF=Rn(),KF=It({argsMap:(e,t)=>[e.getTrackId(),t]}),zF=Rn(),$F=Rn(),YF=It({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),XF=Rn(),JF=Rn(),QF=Rn(),ZF=It({argsMap:e=>[e.getTrackId()]}),eV=Rn(),tV=Rn(),rV=Rn(),nV=Rn(),sV=Rn(),iV=It({argsMap:(e,t)=>[e.getTrackId(),t.name]}),aV=It({argsMap:e=>[e.getTrackId()]}),oV=It({argsMap:e=>[e.getTrackId()]}),cV=It({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),nr=class pY extends R_{get videoHeight(){if(Us()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Us()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Js.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,s,c,d,h){if(super(t,d),xe(this,"trackMediaType",C_.VIDEO),xe(this,"_player",void 0),xe(this,"isUseScaleResolutionDownBy",!1),xe(this,"_videoVisibleTimer",null),xe(this,"_previousVideoVisibleStatus",void 0),xe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),xe(this,"_encoderConfig",void 0),xe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),xe(this,"_optimizationMode",void 0),xe(this,"_saveEncodeBitrateRatio",1),xe(this,"_videoHeight",void 0),xe(this,"_videoWidth",void 0),xe(this,"_forceBitrateLimit",void 0),xe(this,"_enabled",!0),xe(this,"_processorDestination",void 0),xe(this,"_processorContext",void 0),Us()){const{width:f,height:g}=t.getSettings();this._videoWidth=f,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],r&&this._hints.indexOf(Hr.CUSTOM_TRACK)!==-1?this._encoderConfig=hn(r):this._encoderConfig=r,this._hints.indexOf(Hr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(BI(br.CHROME,115)&&Hx().indexOf("Windows")!==-1){const f=(function(g,v){if("VideoFrame"in window&&"TransformStream"in window&&vr().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(g),C=new MediaStreamTrackGenerator({kind:"video"});let R,A,B=Date.now();const L=()=>{U&&(clearInterval(U),U=void 0),R&&(R.close(),R=void 0),g.stop(),A=void 0,C.removeEventListener("ended",L)};let U=window.setInterval((()=>{if(A&&R&&Date.now()-B>1e3)try{C.readyState==="live"?A.enqueue(R.clone()):L()}catch{L()}}),1e3);const X=new TransformStream({transform:(Y,ee)=>{C.readyState==="live"?(A=ee,B=Date.now(),R===void 0?(R=Y,ee.enqueue(Y.clone())):(ee.enqueue(R),R=Y)):Y.close()}});return C.addEventListener("ended",L),E.readable.pipeThrough(X).pipeTo(C.writable),C}})(t);f&&(k.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}r&&this._hints.indexOf(Hr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new B3(this.getTrackId(),"local"),this._processorDestination=new V3(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const c=document.getElementById(t);c?t=c:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Qr(Qr(Qr({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new RO(s):this._player=new NO(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(T_.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}}),Z("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Kr(this,dt.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}return r||(this._enabled=!1),void k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Kr(this,dt.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to true error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,k.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Kr(this,dt.NEED_MUTE_TRACK,this):await Kr(this,dt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),k.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await Kr(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(k)}}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Ne(J.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=oc(t),Z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const s=oT({encoderConfig:t});(Us()||ii()||sc())&&(s.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(c){const d=new Ne(J.UNEXPECTED_ERROR,c.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=t,this._hints.indexOf(Hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(k)}}getStats(){return Th((()=>{k.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),Ga(this,dt.GET_STATS)||Qr({},vO)}async setBeautyEffect(t){k.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await CO(t)}async findClosestProfile(){const{width:t,height:r,frameRate:s}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},f=y_(this._videoWidth||t||c||0),g=y_(this._videoHeight||r||d||0),v=(function(E,C,R){if(!Array.isArray(Z("VIDEO_ENCODER_CONFIG_LIST"))||Z("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const A=Math.min(E,C);return!(A>=480)&&Qr(Qr({},Z("VIDEO_ENCODER_CONFIG_LIST").find((B=>B.height>A))),{},{frameRate:R})})(f,g,y_(s||h||15));if(v)return k.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(f,"x").concat(g," => ").concat(JSON.stringify(v))),this.setEncoderConfiguration(v)}async setBitrateLimit(t){k.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void k.error(J.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const r=this._optimizationMode;try{this._optimizationMode=t,await Kr(this,dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(s){throw this._optimizationMode=r,k.error("[".concat(this.getTrackId(),"] set optimization mode failed"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return k.error(J.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,k.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){G3(this._originMediaStreamTrack).then((t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r})).catch(Xx)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Ne(J.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");k.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=oc(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(k)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:r,frameRate:s}=this.getMediaStreamTrackSettings();if(!t||!r||!s)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:f}=(function(g,v,E,C,R){const A=Z("BITRATE_ADAPTER_TYPE");if(A==="DEFAULT_BITRATE")return{min:C,max:R};if(R===void 0){const B=Math.floor(200*Math.pow(E/15,.6)*Math.pow(g*v/640/360,.75));R=A==="STANDARD_BITRATE"?4*B:2*B,C=C??B}else C=C??Math.floor(R/10);return{min:C,max:R}})(t,r,s,d,c);if(this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=h,Z("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[g,v]=(function(E,C,R){const A=4*Math.floor(2e5*Math.pow(R/15,.6)*Math.pow(E*C/230400,.75)),B=E*C,L=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),U=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let X=xa(L).call(L).next().value,Y=1;if(L.has(B))X=L.get(B);else{var ee;const He=vf(ee=Array.from(L.entries())).call(ee,((Qt,Lt)=>{let[Ir]=Qt,[xr]=Lt;return Ir-xr})),Yt=He.find((Qt=>{let[Lt]=Qt;return Lt>B}));if(Yt){const Qt=He.indexOf(Yt);if(Qt>0){const Lt=He[Qt-1],Ir=(B-Lt[0])/(Yt[0]-Lt[0]);X=Lt[1]+Ir*(Yt[1]-Lt[1])}else X=Yt[1]}else X=He[He.length-1][1]}if(U.has(B))Y=U.get(B);else{var ue;const He=vf(ue=Array.from(U.entries())).call(ue,((Qt,Lt)=>{let[Ir]=Qt,[xr]=Lt;return Ir-xr})),Yt=He.find((Qt=>{let[Lt]=Qt;return Lt>B}));if(Yt){const Qt=He.indexOf(Yt);if(Qt>0){const Lt=He[Qt-1],Ir=(B-Lt[0])/(Yt[0]-Lt[0]);Y=Lt[1]+Ir*(Yt[1]-Lt[1])}else Y=Yt[1]}else Y=He[He.length-1][1]}const de=Z("VIDEO_NEW_BITRATE_RATIO");de&&de>0&&(X=de/100);const ne=Math.floor(A*X),be=Math.floor(65e4*Math.pow(E*C/230400,.5)*Math.pow(R/15,.69));let Ae=ne;const Ue=Z("VIDEO_STANDARD_BITRATE_VERSION");return Ue&&Ue>0&&(Ue===1?Ae=A:Ue===2?Ae=ne:Ue===3&&(Ae=be)),[Math.floor(Ae/1e3),Y]})(t,r,s);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=f?Math.min(f,g):g,this._saveEncodeBitrateRatio=v,k.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(s,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else k.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(s,"] => [brMax: ").concat(h,", brMin: ").concat(f,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),c={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const f=H4.checkOneElementVisible(d),g=Object.assign({},f);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const v=ft.reportApiInvoke(null,{tag:un.TRACER,name:In.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(s){throw new Ne(J.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Ne(J.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;t&&(s=Qr(Qr({},s),oc(t))),s=Nf(s);const c=zr(8,"track-video-cloned-"),d=new pY(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,Nf(this._scalabilityMode),this._optimizationMode,c,Nf(this._hints));return t&&s&&d.setEncoderConfiguration(s),k.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new Ne(J.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Ne(J.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Th((()=>{ft.reportApiInvoke(null,{name:In.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:un.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!Z("ENABLE_VIDEO_SEI")||!Z("ENABLE_ENCODED_TRANSFORM"))return void k.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Ne(J.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const r=this.getRTCRtpTransceiver();if(!r)return void k.warning("Video track is not published, SEI can not be send");const s=r.sender.getParameters();if(s.codecs.length===0)return;const c=s.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",t):k.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ki.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Kr(this,dt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Kr(this,dt.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ki.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(za.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(za.REQUEST_CONSTRAINTS)}},pr(nr.prototype,"play",[jF,LF],Object.getOwnPropertyDescriptor(nr.prototype,"play"),nr.prototype),pr(nr.prototype,"stop",[MF],Object.getOwnPropertyDescriptor(nr.prototype,"stop"),nr.prototype),pr(nr.prototype,"setEnabled",[UF,FF,VF],Object.getOwnPropertyDescriptor(nr.prototype,"setEnabled"),nr.prototype),pr(nr.prototype,"setMuted",[BF,WF,qF],Object.getOwnPropertyDescriptor(nr.prototype,"setMuted"),nr.prototype),pr(nr.prototype,"setSaveEncodeBitrateRatio",[GF,HF],Object.getOwnPropertyDescriptor(nr.prototype,"setSaveEncodeBitrateRatio"),nr.prototype),pr(nr.prototype,"setEncoderConfiguration",[KF,zF],Object.getOwnPropertyDescriptor(nr.prototype,"setEncoderConfiguration"),nr.prototype),pr(nr.prototype,"getStats",[$F],Object.getOwnPropertyDescriptor(nr.prototype,"getStats"),nr.prototype),pr(nr.prototype,"setBeautyEffect",[YF,XF],Object.getOwnPropertyDescriptor(nr.prototype,"setBeautyEffect"),nr.prototype),pr(nr.prototype,"getCurrentFrameData",[JF],Object.getOwnPropertyDescriptor(nr.prototype,"getCurrentFrameData"),nr.prototype),pr(nr.prototype,"getCurrentFrameImage",[QF],Object.getOwnPropertyDescriptor(nr.prototype,"getCurrentFrameImage"),nr.prototype),pr(nr.prototype,"findClosestProfile",[ZF,eV],Object.getOwnPropertyDescriptor(nr.prototype,"findClosestProfile"),nr.prototype),pr(nr.prototype,"setBitrateLimit",[tV],Object.getOwnPropertyDescriptor(nr.prototype,"setBitrateLimit"),nr.prototype),pr(nr.prototype,"setOptimizationMode",[rV],Object.getOwnPropertyDescriptor(nr.prototype,"setOptimizationMode"),nr.prototype),pr(nr.prototype,"setScalabiltyMode",[nV],Object.getOwnPropertyDescriptor(nr.prototype,"setScalabiltyMode"),nr.prototype),pr(nr.prototype,"updateMediaStreamTrackResolution",[sV],Object.getOwnPropertyDescriptor(nr.prototype,"updateMediaStreamTrackResolution"),nr.prototype),pr(nr.prototype,"pipe",[iV],Object.getOwnPropertyDescriptor(nr.prototype,"pipe"),nr.prototype),pr(nr.prototype,"unpipe",[aV],Object.getOwnPropertyDescriptor(nr.prototype,"unpipe"),nr.prototype),pr(nr.prototype,"close",[oV],Object.getOwnPropertyDescriptor(nr.prototype,"close"),nr.prototype),pr(nr.prototype,"replaceTrack",[cV],Object.getOwnPropertyDescriptor(nr.prototype,"replaceTrack"),nr.prototype),nr),cT=(lV=It({argsMap:(e,t)=>[e.getTrackId(),t]}),dV=Rn(),uV=v_("CameraVideoTrack","_enabledMutex"),hV=It({argsMap:(e,t)=>[e.getTrackId(),t]}),pV=Rn(),fV=It({argsMap:(e,t)=>[e.getTrackId(),t]}),mV=Rn(),gV=It({argsMap:e=>[e.getTrackId()]}),Qa=class fY extends tn{get __className__(){return"CameraVideoTrack"}constructor(t,r,s,c,d,h){super(t,oc(r.encoderConfig),c,d,h),xe(this,"_config",void 0),xe(this,"_originalConstraints",void 0),xe(this,"_constraints",void 0),xe(this,"_enabled",!0),xe(this,"_deviceName","default"),xe(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(m_()||KI())&&!(function(){const f=fr();if(f.os!==ls.IOS||!f.osVersion)return!1;const g=f.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2})()&&B4()&&this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=r,this._originalConstraints=s,this._constraints=s,this._deviceName=t.label,this._encoderConfig=oc(this._config.encoderConfig),Br.on(Is.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Br.on(Is.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(k.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const r=await Xa.getDeviceById(t),s={};s.video=Qr({},this._constraints),s.video.deviceId={exact:t},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Ya(s,this.getTrackId())}catch(d){throw k.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await Ya({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Xa.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw k.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}k.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){k.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const r={video:Qr(Qr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let s=null;try{s=await Ya(r,this.getTrackId())}catch(c){throw k.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),s=await Ya({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Qr({},r.video),k.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(k.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await Ya({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await Kr(this,dt.NEED_ENABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),k.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await Kr(this,dt.NEED_DISABLE_TRACK,this)}catch(s){throw k.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}k.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Ne(J.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=oc(t),Z("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const s=hn(this._config);s.encoderConfig=t;const c=oT(s);(Us()||ii()||sc())&&(c.deviceId=void 0),k.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Ne(J.UNEXPECTED_ERROR,d.toString());throw k.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=s,this._constraints=c,this._originalConstraints=c,this._encoderConfig=t,this._hints.indexOf(Hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Kr(this,dt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(k)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ii()||sc())&&this._enabled&&!this._isClosed&&Br.duringInterruption){const t=async()=>{Br.off(Is.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(k.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Br.on(Is.IOS_INTERRUPTION_END,t)}else k.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(T_.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=Xa.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId={exact:s}),this._enabled){const c=await Ya({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Br.off(Is.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Br.off(Is.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],s=this._encoderConfig;t&&(s=Qr(Qr({},s),oc(t))),s=Nf(s);const c=zr(8,"track-cam-cloned-"),d=new fY(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Nf(Qr(Qr({},this._config),{},{encoderConfig:s})),Nf(this._constraints),Nf(this._scalabilityMode),this._optimizationMode,c);return t&&s&&d.setEncoderConfiguration(s),k.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(r)),d}bindProcessorContextEvents(){this.processorContext.on(za.REQUEST_UPDATE_CONSTRAINTS,(async(t,r,s)=>{try{const c=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(c),r()}catch(c){s(c)}})),this.processorContext.on(za.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}},pr(Qa.prototype,"setDevice",[lV,dV],Object.getOwnPropertyDescriptor(Qa.prototype,"setDevice"),Qa.prototype),pr(Qa.prototype,"setEnabled",[uV,hV,pV],Object.getOwnPropertyDescriptor(Qa.prototype,"setEnabled"),Qa.prototype),pr(Qa.prototype,"setEncoderConfiguration",[fV,mV],Object.getOwnPropertyDescriptor(Qa.prototype,"setEncoderConfiguration"),Qa.prototype),pr(Qa.prototype,"close",[gV],Object.getOwnPropertyDescriptor(Qa.prototype,"close"),Qa.prototype),Qa);function AO(e,t,r,s){r.optimizationMode&&(s&&s.width&&s.height?(r.encoderConfig=Qr(Qr({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?k.debug("[".concat(e,"] set content hint to"),r.optimizationMode):k.debug("[".concat(e,"] set content hint failed")))):k.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var _V,yV,vV,EV,Ro,wV,bV,SV,xV,TV,CV,_i;class RV extends A3{getUserId(){return this._userId}constructor(t,r,s,c){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(c.clientId,"_").concat(zr(5,""))),xe(this,"_userId",void 0),xe(this,"_uintId",void 0),xe(this,"_isDestroyed",!1),xe(this,"store",void 0),xe(this,"processor",void 0),xe(this,"processorContext",void 0),this._userId=r,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,k.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let I_=(_V=It({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),yV=It({argsMap:e=>[e.getTrackId()]}),vV=It({argsMap:(e,t)=>[e.getTrackId(),t.name]}),EV=It({argsMap:e=>[e.getTrackId()]}),pr((Ro=class extends RV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Js.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,s,c){super(e,t,r,s),xe(this,"_videoVisibleTimer",null),xe(this,"_previousVideoVisibleStatus",void 0),xe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),xe(this,"trackMediaType",C_.VIDEO),xe(this,"_videoWidth",void 0),xe(this,"_videoHeight",void 0),xe(this,"_player",void 0),xe(this,"_prePlayer",void 0),xe(this,"processorDestination",void 0),xe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new B3(this.getTrackId(),"remote"),this.processorDestination=new V3(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Th((()=>{k.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),Ga(this,dt.GET_STATS)||Qr({},R3)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Co.PLAY_START),typeof e=="string"){const s=document.getElementById(e);s?e=s:(k.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}k.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const r=Qr(Qr({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(r);else{let s=!1,c=!1;e instanceof HTMLVideoElement?(this._player=new RO(r),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,s=this._player.videoState>0,this._player.updateConfig(r)):this._player=new NO(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Co.FIRST_FRAME_DECODED),c&&this.safeEmit(Co.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Co.VIDEO_STATE_CHANGED,d)},s&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Co.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}}),Z("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Co.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,k.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){G3(this._originMediaStreamTrack).then((e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t})).catch(Xx)}_updatePlayerSource(){k.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),s={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:c,slot:d}=s;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=H4.checkOneElementVisible(c),f=Object.assign({},h);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;const g=ft.reportApiInvoke(null,{tag:un.TRACER,name:In.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(r){throw new Ne(J.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ne(J.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ki.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ki.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(kf.SEI_RECEIVED,e)}}).prototype,"play",[_V],Object.getOwnPropertyDescriptor(Ro.prototype,"play"),Ro.prototype),pr(Ro.prototype,"stop",[yV],Object.getOwnPropertyDescriptor(Ro.prototype,"stop"),Ro.prototype),pr(Ro.prototype,"pipe",[vV],Object.getOwnPropertyDescriptor(Ro.prototype,"pipe"),Ro.prototype),pr(Ro.prototype,"unpipe",[EV],Object.getOwnPropertyDescriptor(Ro.prototype,"unpipe"),Ro.prototype),Ro),O_=(wV=It({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),bV=It({argsMap:(e,t)=>[e.getTrackId(),t]}),SV=It({argsMap:e=>[e.getTrackId()]}),xV=It({argsMap:e=>[e.getTrackId()]}),TV=It({argsMap:(e,t)=>[e.getTrackId(),t.name]}),CV=It({argsMap:e=>[e.getTrackId()]}),pr((_i=class extends RV{get isPlaying(){return this._useAudioElement?Gi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,s){super(e,t,r,s),xe(this,"trackMediaType",C_.AUDIO),xe(this,"_source",void 0),xe(this,"_useAudioElement",!0),xe(this,"_volume",100),xe(this,"processorContext",void 0),xe(this,"processorDestination",void 0),xe(this,"_played",!1),xe(this,"_bypassWebAudio",!1),Z("DISABLE_WEBAUDIO")?(this._source=new TO,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new P3(e,!0),Z("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Ka.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Co.FIRST_FRAME_DECODED)})),this.processorContext=new q3(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new W3(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Ka.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Ka.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Ka.ON_AUDIO_BUFFER),this._source.on(Ka.ON_AUDIO_BUFFER,(r=>e(r)))}setVolume(e){this._volume=e,this._useAudioElement?Gi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!S3())throw new Ne(J.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Gi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Th((()=>{k.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),Ga(this,dt.GET_STATS)||Qr({},C3)}play(){k.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(k.debug("[".concat(this.getTrackId(),"] use audio element to play")),Gi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){k.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Gi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];k.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Gi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ne(J.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ne(J.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ne(J.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ki.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(ki.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ki.ON_TRACK),this.processorDestination.removeAllListeners(ki.ON_NODE)}}).prototype,"setVolume",[wV],Object.getOwnPropertyDescriptor(_i.prototype,"setVolume"),_i.prototype),pr(_i.prototype,"setPlaybackDevice",[bV],Object.getOwnPropertyDescriptor(_i.prototype,"setPlaybackDevice"),_i.prototype),pr(_i.prototype,"play",[SV],Object.getOwnPropertyDescriptor(_i.prototype,"play"),_i.prototype),pr(_i.prototype,"stop",[xV],Object.getOwnPropertyDescriptor(_i.prototype,"stop"),_i.prototype),pr(_i.prototype,"pipe",[TV],Object.getOwnPropertyDescriptor(_i.prototype,"pipe"),_i.prototype),pr(_i.prototype,"unpipe",[CV],Object.getOwnPropertyDescriptor(_i.prototype,"unpipe"),_i.prototype),_i);const ud=new class extends _n{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),xe(this,"_lastHiddenTime",0),xe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),k.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class NV extends _n{constructor(t,r){super(),xe(this,"trackMediaType",C_.DATA),xe(this,"_version",1),xe(this,"_type",3),xe(this,"_config",void 0),xe(this,"_originDataChannel",void 0),xe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),xe(this,"_dataStreamPacketHandler",{serialize:s=>s,deserialize:s=>s}),xe(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Z("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new nt(((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const s=setTimeout((()=>{var c;r(new Ne(J.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(s),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(s),new Ne(J.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new Ne(J.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[iT.OPEN,iT.CLOSE,iT.ERROR].forEach((r=>{const s=()=>{this.emit(r)};this._datachannelEventMap.set(r,s),t.addEventListener(r,s)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((r=>{let[s,c]=r;t.removeEventListener(s,c)})),this._datachannelEventMap.clear()}}class fre extends NV{constructor(t){super(t),xe(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=r.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(s).getUint8(3);if(c!==this.id)return void(Z("SHOW_DATASTREAM2_LOG")&&k.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=r.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(iT.MESSAGE,d)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class mre extends NV{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}function lT(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>cx.revokeObjectURL(e)),0),new Worker(cx.createObjectURL(e))}const AV=71,IO=1,OO=2,kO=1,IV=2;var Nh=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(Nh||{});function PO(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=e.getUint8(0);if(r!==AV)return;const s=e.getUint16(1),c=IO+OO+s,d=new Uint8Array(e.byteLength-c);d.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:r,tlvLen:s,tlv:[],frame:d};let f=IO+OO;for(;f<c;){const g=e.getUint8(f),v=e.getUint16(f+kO),E=kO+IV;if(g===Nh.AUDIO_LEVEL){let C=e.getUint8(f+E);for(let R=1;R<v;R++)C=C<<8|e.getUint8(f+E+R);h.tlv.push({tag:g,length:v,value:t?127^C>>1:127&C})}else if(g===Nh.METADATA||g===Nh.AUDIO_64_BIT_PTS){const C=new Uint8Array(v);for(let R=0;R<v;R++)C[R]=e.getUint8(f+E+R);h.tlv.push({tag:g,length:v,value:C})}f+=E+v}return h}const dT=new Map,uT=127,jf=1e-10,DO=139/13,hT=new Map;function jO(e,t,r){const s="".concat(e,"-").concat(t,"-").concat(r);let c=0;return hT.has(s)?c=hT.get(s):(c=Math.log((function(h,f){const g=h-f;f<g&&(f=g);let v=1;for(let E=h,C=1;E>f;E--,C++)v=v*E/C;return v})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,hT.set(s,c)),c<jf&&(c=jf),c}function OV(e,t,r){const s=t.length,c=e.length/s;let d=!1;for(let h=0,f=0;h<s;h++){let g=0;for(let v=f+c;f<v;f++)e[f]>r&&g++;t[h]!==g&&(t[h]=g,d=!0)}return d}window.cache=hT;let gre=0;class kV{constructor(t){xe(this,"id",void 0),xe(this,"immediates",[]),xe(this,"lastNonSilence",-1),xe(this,"immediateSpeechActivityScore",jf),xe(this,"lastLevelChangedTime",Date.now()),xe(this,"levels",[]),xe(this,"longs",[]),xe(this,"longSpeechActivityScore",jf),xe(this,"mediums",[]),xe(this,"mediumSpeechActivityScore",jf),xe(this,"minLevel",0),xe(this,"nextMinLevel",0),xe(this,"nextMinLevelWindowLength",0),xe(this,"energyScore",0),this.id=t||"".concat(gre++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,r=this.levels,s=this.minLevel+DO;let c=!1;for(let d=0;d<t.length;++d){let h=r[d];h<s&&(h=0);const f=Math.floor(h/DO);t[d]!==f&&(t[d]=f,c=!0)}return c}computeLongs(){return OV(this.mediums,this.longs,4)}computeMediums(){return OV(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=jO(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=jO(this.longs[0],10,47),this.longSpeechActivityScore>jf&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=jO(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Vp(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let s=t;return t<0&&(s=0),t>uT&&(s=uT),this.levels.unshift(s),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(s),s>=this.minLevel+DO?s:s/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>uT&&(r=uT),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class _re{constructor(t){xe(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class LO{constructor(t,r,s){xe(this,"isDominant",void 0),xe(this,"energyRanking",void 0),xe(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=s}}class yre extends _n{constructor(t){super(),xe(this,"dominantId",null),xe(this,"lastDecisionTime",0),xe(this,"lastLevelChangedTime",0),xe(this,"lastLevelIdleTime",0),xe(this,"relativeSpeechActivities",[]),xe(this,"speakers",new Map),xe(this,"enableSilence",!1),xe(this,"timeoutToSilenceInterval",0),xe(this,"decisionMaker",null),xe(this,"loudest",[]),xe(this,"numLoudestToTrack",3),xe(this,"energyExpireTimeMs",250),xe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),s!=null&&(this.energyAlphaPct=s),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some((r=>r.id===t))}levelChanged(t,r){const s=Date.now(),c=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<s&&(this.lastLevelChangedTime=s,this.maybeStartDecisionMaker());const d=c.levelChanged(r,s);return this.updateLoudestList(c,d,s)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach((r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)}))}removeSpeakers(t){t.forEach((r=>{this.speakers.delete(r.id)}))}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new kV(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,s){const c=t.id===this.dominantId;if(r<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==t;)++g;return new LO(c,g,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new LO(c,0,t.energyScore);const d=s-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==t.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let f=0;for(;f<this.loudest.length&&!(this.loudest[f].energyScore<t.energyScore);)++f;return f<this.numLoudestToTrack&&(this.loudest.splice(f,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new LO(c,f,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new _re(this),this.decisionMaker.execute())}makeDecision(t){let r=null,s=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const f=xa(h=this.speakers).call(h).next().value;this.enableSilence&&f&&(d=f.id,f.evaluateSpeechActivityScores(t),t-f.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let f=this.dominantId==null?null:this.speakers.get(this.dominantId);if(f==null){const E=this.speakers.entries().next();E.value&&(d=E.value[0],f=E.value[1])}else d=f.id;f!=null&&f.evaluateSpeechActivityScores(t);const g=this.relativeSpeechActivities;let v=2;for(const E of this.speakers.entries()){const[C,R]=E;if(R===f)continue;R.evaluateSpeechActivityScores(t);for(let U=0;U<g.length;++U){const X=f==null?jf:f.getSpeechActivityScore(U);g[U]=Math.log(R.getSpeechActivityScore(U)/X)}const A=g[0],B=g[1],L=g[2];A>3&&B>2&&L>0&&B>v&&(v=B,d=C)}this.enableSilence&&f!=null&&d===f.id&&t-f.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(r=this.dominantId,this.dominantId=d,s=this.dominantId),s==null&&!this.enableSilence||s===r||this.emit("ActiveSpeakerChanged",s)}_runInDecisionMaker(){const t=Date.now(),r=300-(t-this.lastLevelIdleTime);let s=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):s=r;let c=300-(t-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=t,this.makeDecision(t),c=300-(Date.now()-t)),c>0&&s>c&&(s=c),s}timeoutIdleLevels(t){const r=[];for(const c of xa(s=this.speakers).call(s)){var s;const d=t-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?r.push(c.id):300<d&&c.levelTimedOut()}r.forEach((c=>this.speakers.delete(c)))}}const k_=new Map;let ol=null,pT=null;const PV=3;let Lf=[];const cl=new Map,fT=new Map;class vre{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){xe(this,"id",void 0),xe(this,"track",void 0),xe(this,"score",0),xe(this,"active",!0),xe(this,"muted",!1),xe(this,"timer",0),xe(this,"actives",0),xe(this,"inactives",0),this.id=t,this.track=r,this.setActive(cl.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:r,inactives:s}=(function(){const c=[],d=[];return Array.from(xa(cl).call(cl)).forEach((h=>{h.active?c.push(h):d.push(h)})),{actives:c,inactives:d}})();if(r.length>3){let c;r.forEach((d=>{(!c||c.score>d.score)&&(c=d)})),c&&c.setActive(!1)}if(r.length<3&&s.length>0){let c;s.forEach((d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)})),c&&t&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=(function(r){let s;return Array.from(xa(cl).call(cl)).forEach((c=>{!c.active||c.id===r||c.samples<40||(!s||c.score<s.score)&&(s=c)})),s})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=(function(r){let s;return Array.from(xa(cl).call(cl)).forEach((c=>{c.active||c.id===r||c.samples<40||(!s||c.score>s.score)&&(s=c)})),s})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let mT;function DV(e){const t=cl.get(e);t&&(cl.delete(e),t.clearTimer())}const gT=new Map,Ere=new Map,MO="video/h264",UO="video/h265";function jV(e,t,r){let s=new Uint8Array(e,t,r),c=[],d=0;for(;c.length<r;)d+3<r&&s[d]===0&&s[d+1]===0&&s[d+2]===3&&(s[d+3]===0||s[d+3]===1||s[d+3]===2||s[d+3]===3)?(c.push(s[d],s[d+1],s[d+3]),d+=4):(c.push(s[d]),d++);return new Uint8Array(c)}function LV(e){const t=e.length;let r=[],s=0;for(;s<t;)s+2<t&&e[s]===0&&e[s+1]===0&&(e[s+2]===0||e[s+2]===1||e[s+2]===2||e[s+2]===3)?(r.push(e[s],e[s+1],3,e[s+2]),s+=3):(r.push(e[s]),s++);return new Uint8Array(r)}function MV(e){if(e.length<5)return"";let t=-1;for(let c=0;c<e.length-3;c++){if(e[c]===0&&e[c+1]===0&&e[c+2]===1){t=c;break}if(c<e.length-4&&e[c]===0&&e[c+1]===0&&e[c+2]===0&&e[c+3]===1){t=c;break}}if(t===-1)return"";const r=t+(e[t+2]===0?4:3);if(r>=e.length)return"";const s=e[r];return 128&s?"":(s>>1&63)>=32||r+1<e.length&&(248&e[r+1])==0?UO:(31&s)<=31?MO:""}const _T=new Map,bE=new Map;(function(){const e=fr();As.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),As.getStreamFromExtension=e.name===br.CHROME&&Number(e.version)>34,As.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r})(),As.supportMinBitrate=e.name===br.CHROME||e.name===br.EDGE,As.supportSetRtpSenderParameters=(function(){const t=fr();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!au()||!(!Us()&&!Kx())||t.name===br.FIREFOX&&Number(t.version)>=64)})(),e.name===br.SAFARI&&(Number(e.version)>=14?As.supportDualStream=!0:As.supportDualStream=!1),As.webAudioMediaStreamDest=(function(){const t=fr();return!(t.name===br.SAFARI&&Number(t.version)<12)})(),As.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",As.supportWebGL=typeof WebGLRenderingContext<"u",As.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,au()||(As.webAudioWithAEC=!0),As.supportShareAudio=(function(){const t=fr();return(t.os===ls.WIN_10||t.os===ls.WIN_81||t.os===ls.WIN_7||t.os===ls.LINUX||t.os===ls.MAC_OS||t.os===ls.CHROMIUM_OS)&&t.name===br.CHROME&&Number(t.version)>=74})(),As.supportDataChannel=!!(f_(76)||qI(68)||L4(14)),As.supportPCSetConfiguration=(function(){const t=window.RTCPeerConnection;return!Sn()&&!!t&&t.prototype.setConfiguration instanceof Function})(),As.supportWebRTCEncodedTransform=f_(87)||P4()||qI(117),As.supportWebRTCInsertableStream=(function(){const t=fr();return(t.name===br.CHROME||t.name===br.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),As.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,As.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Yx((()=>{As.supportDualStreamEncoding=(function(){const t=fr();return!!Z("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&Z("CHROME_DUAL_STREAM_USE_ENCODING"))})(),k.debug("browser ua: ",navigator.userAgent),k.info("browser info: ",e),k.info("browser compatibility: ",As)}))})();const wre=["CHINA","GLOBAL"],UV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Mf=[],P_=[];function Uf(e,t){return!!t&&Mf.some((r=>r.uid===e&&r.channelName===t))}function FO(){return P_.length>0}var bre=QM.forEach,FV=Dp("forEach")?[].forEach:function(e){return bre(this,e,arguments.length>1?arguments[1]:void 0)};kr({target:"Array",proto:!0,forced:[].forEach!==FV},{forEach:FV});var Sre=ya("Array","forEach"),xre=Lc,Tre=us,Cre=O,Rre=Sre,VO=Array.prototype,Nre={DOMTokenList:!0,NodeList:!0},Are=function(e){var t=e.forEach;return e===VO||Cre(VO,e)&&t===VO.forEach||Tre(Nre,xre(e))?Rre:t},Ire=u(Are),Ore=Bo,VV=Vi;kr({target:"Object",stat:!0,forced:m((function(){VV(1)}))},{keys:function(e){return VV(Ore(e))}});var kre=u(xt.Object.keys),Pre=u(Gn),Dre=u(Fp),jre=kr,BV=Mc,Lre=Ms,Mre=jt,WV=v0,Ure=Ml,Fre=Le,Vre=xA,Bre=wn,Wre=Ts,qre=WM("slice"),Gre=Bre("species"),BO=Array,Hre=Math.max;jre({target:"Array",proto:!0,forced:!qre},{slice:function(e,t){var r,s,c,d=Fre(this),h=Ure(d),f=WV(e,h),g=WV(t===void 0?h:t,h);if(BV(d)&&(r=d.constructor,(Lre(r)&&(r===BO||BV(r.prototype))||Mre(r)&&(r=r[Gre])===null)&&(r=void 0),r===BO||r===void 0))return Wre(d,f,g);for(s=new(r===void 0?BO:r)(Hre(g-f,0)),c=0;f<g;f++,c++)f in d&&Vre(s,c,d[f]);return s.length=c,s}});var Kre=ya("Array","slice"),zre=O,$re=Kre,WO=Array.prototype,Yre=function(e){var t=e.slice;return e===WO||zre(WO,e)&&t===WO.slice?$re:t},Xre=u(Yre);function ht(e,t,r,s,c){var d,h,f,g={};return Ire(d=kre(s)).call(d,(function(v){g[v]=s[v]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Pre(h=Dre(f=Xre(r).call(r)).call(f)).call(h,(function(v,E){return E(e,t,v)||v}),g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(UM(e,t,g),null):g}let yT=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),qO=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),cc=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),Pi=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),Nt=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),Zr=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),Mt=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),Dt=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),SE=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),or=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),Di=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),Kt=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function vT(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw k.error("Invalid Channel Name ".concat(e)),new Ce(J.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ET(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||G4(e,1,255)))throw new Ce(J.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&k.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let cu=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({});const Jre={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},GO={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function HO(e,t){Rs(e.url,"".concat(t,".url"),1,1e3,!1),xn(e.x)||Gr(e.x,"".concat(t,".x"),0,1e4),xn(e.y)||Gr(e.y,"".concat(t,".y"),0,1e4),xn(e.width)||Gr(e.width,"".concat(t,".width"),0,1e4),xn(e.height)||Gr(e.height,"".concat(t,".height"),0,1e4),xn(e.zOrder)||Gr(e.zOrder,"".concat(t,".zOrder"),0,255),xn(e.alpha)||Gr(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Qre={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ah=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),KO=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),Jn=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function qV(e){if(!e.channelName)throw new Ce(J.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Ce(J.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Rs(e.token,"info.token",1,2047),ET(e.uid),vT(e.channelName),!0}let ji=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),lu=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),ca=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),D_=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),Mr=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),ps=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),wT=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),ds=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Cr=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({});const GV=[Cr.AFRICA,Cr.ASIA,Cr.CHINA,Cr.EUROPE,Cr.GLOBAL,Cr.INDIA,Cr.JAPAN,Cr.NORTH_AMERICA,Cr.OCEANIA,Cr.OVERSEA,Cr.SOUTH_AMERICA];let Qs=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({});const bT={CHINA:{},ASIA:{CODE:Qs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Qs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Qs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Qs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Qs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Qs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Qs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Qs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Qs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Qs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Qs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Qs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Qs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};lO&&(bT.CHINA={CODE:Qs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let xE=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function HV(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class KV extends _n{constructor(t,r){super(),H(this,"onICEConnectionStateChange",void 0),H(this,"onConnectionStateChange",void 0),H(this,"onDTLSTransportStateChange",void 0),H(this,"onDTLSTransportError",void 0),H(this,"onICETransportStateChange",void 0),H(this,"onFirstAudioReceived",void 0),H(this,"onFirstVideoReceived",void 0),H(this,"onFirstAudioDecoded",void 0),H(this,"onFirstVideoDecoded",void 0),H(this,"onFirstVideoRender",void 0),H(this,"onFirstVideoDecodedTimeout",void 0),H(this,"onSelectedLocalCandidateChanged",void 0),H(this,"onSelectedRemoteCandidateChanged",void 0),H(this,"onICECandidateError",void 0),H(this,"getLocalVideoStats",void 0)}}class zV extends KV{constructor(t,r){super(t,r),H(this,"establishPromise",void 0)}}let ot=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),Zs=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),du=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({});const $V=["disconnected","failed"];let We=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),Dr=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),Tt=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),lc=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),dc=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),fs=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),YV=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),hd=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),No=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),ll=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),j_=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Pn=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),L_=(function(e){return e.ABORT="abort",e})({}),Ih=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),Zre=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({});const ene={[yT.ACCESS_POINT]:{[Pi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Pi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Pi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Pi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Pi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Pi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Pi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yT.UNILBS]:{[cc.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[cc.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[cc.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[cc.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[cc.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[cc.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[cc.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[cc.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[cc.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[cc.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[cc.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[cc.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yT.STRING_UID_ALLOCATOR]:{[qO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function M_(e){const t=ene[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===yT.ACCESS_POINT){const s=e%1e4;if(s.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(s.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}const tne={[Nt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Nt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Nt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Nt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Nt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Nt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Nt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Nt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Nt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Nt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Nt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Nt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Nt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Nt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Nt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Nt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Nt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Nt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Nt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Nt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Nt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Nt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Nt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Nt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Nt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Nt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Nt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Nt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Nt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Nt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Nt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Nt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Nt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Nt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Nt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Nt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Nt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Nt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Nt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Nt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Nt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Nt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Nt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Nt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Nt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Nt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Nt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Nt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Nt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Nt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Nt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Nt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Nt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Nt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Nt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Nt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Nt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Nt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Nt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Nt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Nt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Nt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Nt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function TE(e){return tne[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function XV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function zO(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XV(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XV(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}function $O(e,t){if(typeof e=="string")return e;const{proxy:r,host:s,port:c}=e;if(t){const d=Z("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const rne=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,nne=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,sne=/wss:\/\/(.+):([0-9]+)\/?/,ine=/wss:\/\/(.[^\/]+)\/?/;let ane=0;class one{constructor(t,r){H(this,"id",0),H(this,"store",void 0),H(this,"recordIndex",void 0),H(this,"websockets",[]),H(this,"try443PortDuration",2e3),H(this,"forceCloseWSDuration",5e3),H(this,"try443PortTimeout",null),H(this,"forceCloseTimeout",null),H(this,"isTry443PortFailed",!1),H(this,"isNormalPortFailed",!1),H(this,"useDoubleDomain",!1),H(this,"useProxy",!1),H(this,"startTime",Date.now()),this.id=++ane,this.try443PortDuration=Z("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const r=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];k.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...c)}createWebSocket(t,r,s){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:s});const c=Z("GATEWAY_DOMAINS"),d=Date.now(),h=[],f=c.find((R=>{var A;return $e(A=t.host).call(A,R)}));f||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach((R=>{g.push($O(zO(zO({},t),{},{host:t.host.replace(f,R)}),r))}));else{const R=zO({},t);if(r&&f){const A=c.find((B=>B!==f));A&&(R.host=R.host.replace(f,A))}g.push($O(R,r))}try{g.forEach((R=>{const A=new WebSocket(R);A.binaryType="arraybuffer",h.push(A),this.logger("ws is connecting:",A.url)}))}catch(R){if(this.logger("ws create failed"),h.forEach((A=>A.close())),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,s);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,s);throw new Ce(J.WS_ERR,"init websocket failed! Error: ".concat(R.toString()))}const v=lE();this.store&&this.store.recordJoinChannelService({urls:h.map((R=>R.url)),service:"gateway"},this.recordIndex),h.forEach((R=>{R.onopen=()=>{this.logger("onopen: ws ".concat(R.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach((A=>{A!==R&&(A.onopen=null,A.onclose=null,A.onmessage=null,A.close(),this.logger("close backup websocket: ".concat(A.url)))})),this.websockets.length=0,v.resolve(R)},R.onclose=A=>{this.logger("onclose: ws ".concat(R.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(R.readyState));const B=h.every((L=>L.readyState===WebSocket.CLOSED||L.readyState===WebSocket.CLOSING));this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(B)),B&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(A.reason)),v.reject({code:A.code,reason:wT.A_ROUND_WS_FAILED})):!r&&B&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),C()),r?this.isTry443PortFailed=B:this.isNormalPortFailed=B},R.onmessage=A=>this.logger("".concat(R.url," onmessage: ").concat(A.data))})),this.websockets.push(...h);const E=()=>{this.websockets.forEach((R=>R.readyState!==WebSocket.OPEN&&R.close()))},C=()=>{if(v.isResolved)return E();fr().os===ls.MAC_OS&&Sn()&&E(),this.createWebSocket(t,!0,!0).then((R=>{v.resolve(R)})).catch((R=>{this.isNormalPortFailed&&v.reject(R),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,E()}),this.forceCloseWSDuration)};return s||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,E()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,C()}),this.try443PortDuration)})(),v.promise}chooseBestWebsocket(t,r,s,c){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=(function(d){let h,f,g;return[,h,f,g]=d.match(rne)||[],h||([,f,g]=d.match(nne)||[]),f&&g||([,f,g]=d.match(sne)||[]),f&&g||([,f]=d.match(ine)||[]),f||k.warning("un-destructible url: ",d),{proxy:h,host:f,port:g||"443"}})(t)),this.recordIndex=c,this.useProxy=!!t.proxy,s&&this.useProxy&&(k.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(t,!!s,!1).finally((()=>this.clearTimeout()))}}function JV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}class QV extends _n{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;$e(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Kt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Kt.CONNECTED):this._state==="closed"?this.emit(Kt.CLOSED):this._state==="failed"&&this.emit(Kt.FAILED))}resetReconnectCount(t){k.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),H(this,"_websocketUrl",null),H(this,"connectionID",0),H(this,"currentURLIndex",0),H(this,"urls",[]),H(this,"_reconnectMode","tryNext"),H(this,"reconnectReason",void 0),H(this,"_initMutex",void 0),H(this,"name",void 0),H(this,"_state","closed"),H(this,"reconnectInterrupter",void 0),H(this,"websocket",void 0),H(this,"retryConfig",void 0),H(this,"reconnectCount",0),H(this,"forceCloseTimeout",5e3),H(this,"onlineReconnectListener",void 0),H(this,"useCompress",void 0),H(this,"tryDoubleDomain",!1),H(this,"use443PortOnly",!1),H(this,"wsInflateLength",0),H(this,"wsDeflateLength",0),H(this,"closeEstablishingWs",(()=>{})),H(this,"store",void 0),H(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=t,this.retryConfig=(function(C){for(var R=1;R<arguments.length;R++){var A=arguments[R]!=null?arguments[R]:{};R%2?JV(Object(A),!0).forEach((function(B){H(C,B,A[B])})):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(A)):JV(Object(A)).forEach((function(B){Object.defineProperty(C,B,Object.getOwnPropertyDescriptor(A,B))}))}return C})({},r),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Xs("websocket",h?h.clientId:void 0);const{timeout:f,timeoutFactor:g}=r,v=Math.max(300,Math.floor(3*f/5)),E=Math.max(1.2,Math.floor(8*g)/10);Ra.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=E),Un.on(g_.NETWORK_STATE_CHANGE,((C,R)=>{C!==R&&(this.resetReconnectCount("network state change: ".concat(R," -> ").concat(C)),C===Ra.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=g))}))}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{var c;const d=lE(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),(function(f){return!(rT()||Z("USE_NEW_TOKEN")||!Z("ENABLE_PREALLOC_PC")&&(f==null||!f.autoSubscribe||Z("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(YV.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(Kt.CLOSED,(()=>{d.reject(new Ne(J.WS_DISCONNECT))})),this.once(Kt.CONNECTED,d.resolve),await d.promise}catch{}finally{s()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;r?setTimeout((()=>s.close()),500):s.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void k.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),k.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ne(J.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(s){throw new Ne(J.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;const s=lE();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=E=>{var C;(C=this.store)===null||C===void 0||C.signalChannelOpen(),k.debug("[".concat(this.name,"] websocket opened:"),E),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s.resolve()},d=async E=>{var C;if(k.debug("[".concat(this.name,"] websocket close ").concat((C=this.websocket)===null||C===void 0?void 0:C.url,", code: ").concat(E.code,", reason: ").concat(E.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)s.reject(new Ne(J.WS_DISCONNECT,"websocket close: ".concat(E.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=E.reason,this.state="reconnecting");const R=Ga(this,Kt.WILL_RECONNECT,this.reconnectMode,E.reason)||this.reconnectMode,A=await this.reconnectWithAction(R);if(this.state==="closed")return void k.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!A)return s.reject(new Ne(J.WS_DISCONNECT,"websocket reconnect failed: ".concat(E.code))),this.close(!0);s.resolve()}},h=E=>{this.emit(Kt.ON_MESSAGE,E)},f=E=>{k.warn("[".concat(this.connectionID,"] ws open error ").concat(E))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Z("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=Z("GATEWAY_WSS_ADDRESS")),k.debug("[".concat(this.name,"] start connect, url:"),t);const g=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;this._websocketUrl=$O(t);const E=await this.chooseBestWebsocketConnection(t);this.websocket=E,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=f,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(E){const C=this.state==="closed",R=E instanceof Ne,A=R&&E.code===J.WS_ABORT,B=R&&E.code===J.WS_ERR,L=R?E.message:E&&(E.reason||E.toString());k.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(L)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:A?"aborted":"error",errors:[E]},g),C||B?(s.reject(C?new Ne(J.WS_DISCONNECT,"websocket is closed: ".concat(L)):new Ne(J.WS_ERR,"init websocket failed: ".concat(L))),B&&k.error("[".concat(this.name,"] init websocket failed: ").concat(L))):d&&d(E)}return s.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;k.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||Un.isOnline||!Un.onlineWaiter||(this.onlineReconnectListener=Un.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let s=!0;if(this.reconnectInterrupter=()=>s=!1,r){const h=tO(this.reconnectCount,this.retryConfig);k.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(t)),await nt.race([Ns(h),this.onlineReconnectListener||new nt((()=>{}))])}if(this._state==="closed"||!s)return!1;this.reconnectCount+=1;const c=async(h,f)=>{this.emit(Kt.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(h)};try{if(t==="retry")await c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);k.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(k.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Vs(this,Kt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],t))}catch(h){var d;k.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const f=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(f)&&$e(f).call(f,"dynamic key expired")?(this.emit(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class YO extends QV{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){const s=lE(),c=(function(h,f){return new one(h,f)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),s.reject(new Ne(J.WS_ABORT,"choose best websocket aborted"))};const d=Z("GATEWAY_DOMAINS");return k.debug("[choose-best-ws] currentDomain: ",t,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(s.resolve).catch(s.reject),s.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class CE extends QV{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new nt(((s,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{k.debug("[choose-best-ws] close establishing websockets"),h.forEach((B=>{B.onclose=null,B.onopen=null,B.onmessage=null,B.close()})),c(new Ne(J.WS_ABORT,"choose best websocket aborted"))};const f=Z("GATEWAY_DOMAINS");let g;const v=t.indexOf("?h="),E=f.find((B=>v!==-1?$e(t).call(t,B,v):$e(t).call(t,B)));k.debug("[choose-best-ws] currentDomain: ",E,", domains: ",f);let C=!this.tryDoubleDomain||!E;if(!C&&E){var R;const B=Date.now();try{f.forEach((L=>{const U=v===-1?t.replace(E,L):t.substr(0,v)+t.substr(v).replace(E,L),X=new WebSocket(U);X.binaryType="arraybuffer",h.push(X),k.debug("[choose-best-ws] ws is connecting:",X.url)}))}catch{for(k.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach((U=>U.close()));h.length;)h.pop();C=!0}(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:h.map((L=>L.url)),service:"gateway"},r),h.forEach((L=>{L.onopen=()=>{if(d)return;const U=Date.now()-B;k.debug("[choose-best-ws] ws open cost ".concat(U,"ms")),h.filter((X=>X!==L)).forEach((X=>{k.debug("[choose-best-ws]close backup websocket: ".concat(X.url)),X.close()})),d=!0,s(L)},L.onclose=U=>{g=U,!d&&(h.find((X=>!(X.readyState===WebSocket.CLOSED||X.readyState===WebSocket.CLOSING)))||(k.debug("[choose-best-ws] all websocket is closed"),d=!0,c(g)))},L.onmessage=U=>{k.debug("[choose-best-ws]".concat(L.url," onmessage: ").concat(U.data))}})),Ns(this.forceCloseTimeout).then((()=>{h.forEach((L=>{L.readyState!==WebSocket.OPEN&&L.close()}))}))}if(C){var A;let B;k.debug("[choose-best-ws] use single url: ",t),(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:[t],service:"gateway"},r);try{B=new WebSocket(t),h.push(B),B.binaryType="arraybuffer"}catch(L){const U=new Ne(J.WS_ERR,"init websocket failed! Error: ".concat(L.toString()));return k.error("[".concat(this.name,"]").concat(U)),void c(U)}B.onopen=()=>{s(B)},B.onclose=L=>{c(L)},B.onmessage=L=>{k.debug("[choose-best-ws]".concat(B.url," onmessage: ").concat(L.data))},Ns(this.forceCloseTimeout).then((()=>{B&&B.readyState!==WebSocket.OPEN&&B.close()}))}})).then((s=>(this.closeEstablishingWs=void 0,s))).catch((s=>{throw this.closeEstablishingWs=void 0,s}))}}class cne extends _n{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Zr.CONNECTED?this.emit(Mt.WS_CONNECTED):t===Zr.RECONNECTING?this.emit(Mt.WS_RECONNECTING,this._websocketReconnectReason):t===Zr.CLOSED&&this.emit(Mt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",Zr.CLOSED),H(this,"reconnectToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new a3(5)),H(this,"pingpongTimer",void 0),H(this,"wsInflateDataTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"ortc",void 0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"onWebsocketMessage",(s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Mt.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===or.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===or.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Pr.UID_BANNED);break;case 15:this.close(Pr.IP_BANNED);break;case 16:this.close(Pr.CHANNEL_BANNED)}if(c._type===or.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Nt.ERR_LICENSE_MISSING:this.close(Pr.LICENSE_MISSING);break;case Nt.ERR_LICENSE_EXPIRED:this.close(Pr.LICENSE_EXPIRED);break;case Nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Pr.LICENSE_MINUTES_EXCEEDED);break;case Nt.ERR_LICENSE_PERIOD_INVALID:this.close(Pr.LICENSE_PERIOD_INVALID);break;case Nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Pr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Nt.ERR_LICENSE_ILLEGAL:this.close(Pr.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new YO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Zr.CONNECTED&&this.reconnect("retry",Fs.OFFLINE)}))}async request(t,r,s,c){const d=zr(6,""),h={_id:d,_type:t,_message:r},f=this.websocket.connectionID,g=()=>new nt(((B,L)=>{if(this.connectionState===Zr.CONNECTED)return B();const U=()=>{this.off(Mt.WS_CLOSED,X),B()},X=()=>{this.off(Mt.WS_CONNECTED,U),L(new Ce(J.WS_ABORT))};this.once(Mt.WS_CONNECTED,U),this.once(Mt.WS_CLOSED,X),t!==Dt.PUBLISH&&t!==Dt.PUBLISH_DATASTREAM&&t!==Dt.SUBSCRIBE&&t!==Dt.SUBSCRIBE_DATASTREAM&&t!==Dt.UNSUBSCRIBE&&t!==Dt.UNSUBSCRIBE_DATASTREAM&&t!==Dt.UNPUBLISH&&t!==Dt.UNPUBLISH_DATASTREAM&&t!==Dt.CONTROL&&t!==Dt.RESTART_ICE||this.once(Mt.DISCONNECT_P2P,(()=>{L(new Ce(J.DISCONNECT_P2P))})),t!==Dt.PUBLISH&&t!==Dt.RESTART_ICE||this.once(Mt.ABORT_P2P_EXECUTION,(()=>{L(new Ce(J.DISCONNECT_P2P))}))}));if(this.connectionState!==Zr.CONNECTING&&this.connectionState!==Zr.RECONNECTING||t===Dt.JOIN||t===Dt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const v=new nt(((B,L)=>{let U=!1;const X=(ee,ue)=>{U=!0,B({isSuccess:ee==="success",message:ue||{}}),this.off(Mt.WS_CLOSED,Y),this.off(Mt.WS_RECONNECTING,Y),this.emit(Mt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),X);const Y=()=>{L(new Ce(J.WS_ABORT,"type: ".concat(t))),this.off(Mt.WS_CLOSED,Y),this.off(Mt.WS_RECONNECTING,Y),this.off("res-@".concat(d),X)};this.once(Mt.WS_CLOSED,Y),this.once(Mt.WS_RECONNECTING,Y),Ns(Z("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==f||U||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Mt.REQUEST_TIMEOUT,t,r))}))}));let E=null;try{E=await v}catch(B){if(this.connectionState===Zr.CLOSED||t===Dt.LEAVE)throw new Ce(J.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?B.throw():t===Dt.JOIN||t===Dt.REJOIN?null:(await g(),await this.request(t,r))}if(E.isSuccess)return E.message;const C=Number(E.message.error_code||E.message.code),R=TE(C),A=new Ce(J.UNEXPECTED_RESPONSE,"".concat(R.desc,": ").concat(E.message.error_str),{code:C,data:E.message,desc:R.desc});return R.action==="success"?E.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(C,", message: ").concat(R.desc,", action: ").concat(R.action)),C===Nt.ERR_TOO_MANY_BROADCASTERS?((t===Dt.JOIN||t===Dt.REJOIN)&&(this.initError=A,this.close()),A.throw()):R.action==="failed"?A.throw():R.action==="quit"?(this.initError=A,this.close(),A.throw()):(C===Nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fs.MULTI_IP)):this.reconnect(R.action,Fs.SERVER_ERROR),t===Dt.JOIN||t===Dt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new nt((s=>{const c=d=>{(!r||r(d))&&(this.off(t,c),s(d))};this.on(t,c)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(SE.WRTC_STATS,r)}upload(t,r){const s={_type:t,_message:r};try{this.websocket.sendMessage(s)}catch{const d=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Zr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const s={_type:t,_message:r};this.websocket.sendMessage(s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new nt(((r,s)=>{this.once(Mt.WS_CONNECTED,(()=>r(this.joinResponse))),this.once(Mt.WS_CLOSED,(c=>s(this.initError||new Ce(J.WS_ABORT,c)))),this.connectionState=Zr.CONNECTING,this.websocket.init(t).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Pr.LEAVE,this.connectionState=Zr.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Mt.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await Vs(this,Mt.REQUEST_JOIN_INFO);this.store.joinReq();const r=await this.request(Dt.JOIN,t);if(this.ortc=t==null?void 0:t.ortc,this.store.joinRep(),!r)return this.emit(Mt.REPORT_JOIN_GATEWAY,wT.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Mt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Zr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ce(J.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=fE(this,Mt.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const r=await this.request(Dt.REJOIN,t);return!!r&&(this.connectionState=Zr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach((s=>{this.emit(or.ON_USER_ONLINE,{uid:s.uid}),s.audio&&this.emit(or.ON_ADD_AUDIO_STREAM,{uid:s.uid,uint_id:s.uint_id,audio:!0,ssrcId:s.audio_ssrc}),s.video&&this.emit(or.ON_ADD_VIDEO_STREAM,{uid:s.uid,uint_id:s.uint_id,video:!0,ssrcId:s.video_ssrc}),s.audio_mute?this.emit(or.MUTE_AUDIO,{uid:s.uid}):this.emit(or.UNMUTE_AUDIO,{uid:s.uid}),s.video_mute?this.emit(or.MUTE_VIDEO,{uid:s.uid}):this.emit(or.UNMUTE_VIDEO,{uid:s.uid}),s.audio_enable_local?this.emit(or.ENABLE_LOCAL_AUDIO,{uid:s.uid}):this.emit(or.DISABLE_LOCAL_AUDIO,{uid:s.uid}),s.video_enable_local?this.emit(or.ENABLE_LOCAL_VIDEO,{uid:s.uid}):this.emit(or.DISABLE_LOCAL_VIDEO,{uid:s.uid}),s.audio||s.video||this.emit(or.ON_REMOVE_STREAM,{uid:s.uid,uint_id:s.uint_id})})),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){if(!this.ortc)return!1;const r={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Dt.DOWNGRADE_CODEC,r)}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);const r=TE(t.code);if(t.code===28&&"detail"in t&&(k.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Mt.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Pr.UID_BANNED),void this.close()):void this.reconnect(r.action,Fs.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fs.TIMEOUT):this.request(Dt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const s=Date.now()-r;this.rttRolling.add(s),Z("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:s})})).catch((s=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload(SE.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Kt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(Mt.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Kt.CLOSED,(()=>{this.connectionState=Zr.CLOSED})),this.websocket.on(Kt.FAILED,(()=>{this._disconnectedReason=Pr.NETWORK_ERROR,this.connectionState=Zr.CLOSED})),this.websocket.on(Kt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Zr.CONNECTED?this.connectionState=Zr.RECONNECTING:this.connectionState=Zr.CONNECTING})),this.websocket.on(Kt.WILL_RECONNECT,((t,r,s)=>{const c=fE(this,Mt.IS_P2P_DISCONNECTED),d=c||t!=="retry";c&&t==="retry"&&(k.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=wT.P2P_DISCONNECTED),d&&(k.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Mt.REPORT_JOIN_GATEWAY,r||wT.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Mt.DISCONNECT_P2P)),s(t)})),this.websocket.on(Kt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{k.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Fs.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(Mt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ce){if(t.code===J.UNEXPECTED_RESPONSE&&t.data.code===Nt.ERR_NO_AUTHORIZED)return this.initError=new Ce(J.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Pr.TOKEN_EXPIRE);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fs.SERVER_ERROR):(this.initError=t,this.close())}}))})),this.websocket.on(Kt.REQUEST_NEW_URLS,((t,r)=>{Vs(this,Mt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)})),this.websocket.on(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(or.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(YV.PRE_CONNECT_PC,(()=>{this.emit(Mt.PRE_CONNECT_PC)}))}}let lne=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Fn=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function ZV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function ST(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZV(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZV(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}function Oh(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Z("TURN_DOMAIN")):(k.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function xT(e){try{const t=Z("GATEWAY_DOMAINS").concat(Z("TURN_DOMAIN")).find((r=>$e(e).call(e,r)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return k.debug("serverUrlToIp error, fallback to url",e),e}}function XO(e,t){e.addresses||(e.addresses=[]);const r=(function(f,g){if(Z("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return f.map((C=>{let{ip:R,port:A}=C;return{address:"".concat(R,":").concat(A)}}));const v=Z("GATEWAY_DOMAINS");let E=v[1]&&$e(g).call(g,v[1])?1:0;return f.map((C=>{let{domain_prefix:R,port:A,ip:B}=C;if(R)return{address:"".concat(R,".").concat(v[E++%v.length],":").concat(A)};const L=/^[\.\:\d]+$/.test(B),U=L?"".concat(B.replace(/[^\d]/g,"-"),".").concat(v[E++%v.length],":").concat(A):"".concat(B,":").concat(A);return L||k.debug("Cannot recognized as ip address: ".concat(B,", use as host3")),{ip:B,port:A,address:U}}))})(e.addresses,t),s=Array.isArray(e.detail)&&e.detail[18];if(s&&typeof s=="string"){const f=s.split(";");for(let g=0;g<f.length;g++){var c;const v=gi(c=f[g]).call(c);r[g]&&v&&(r[g].ip6=v)}}const d=e.detail&&e.detail.candidate;let h;if(d){const[f,g]=d.split(":");f&&g&&(h={port:Number(g),ip:f,address:"".concat(f,":").concat(g)})}return{gatewayAddrs:r,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Na(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function e5(e){const t=e._encoderConfig;if(!t)return{};const r={resolution:t.width&&t.height?"".concat(Na(t.width),"x").concat(Na(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function t5(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function RE(e,t){let r,s,c;switch(t){case Fn.CHOOSE_SERVER:s=4096,c="choose server";break;case Fn.CLOUD_PROXY:s=1048576,c="proxy";break;case Fn.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case Fn.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new Ce(J.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((d=>{d.buffer&&d.buffer.flag===s&&(r={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map((h=>ST(ST({},h),{},{ticket:d.buffer.cert}))),server_ts:e.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:ST(ST({},d.buffer.detail),e.detail),flag:d.buffer.flag,opid:e.opid,cert:d.buffer.cert})})),!r)throw new Ce(J.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function r5(e,t){return await nt.all(e.addresses.map((async r=>({address:Oh(r.ip),tcpport:r.port,udpport:r.port,username:t&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Bs.username,password:t&&Z("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await JI(t.toString()):Bs.password}))))}function JO(e,t){const r=t.getMediaStreamTrack(!0).getSettings(),s=t.videoHeight||r.height,c=t.videoWidth||r.width;return s&&c?Math.max(Math.min(s,c)/Math.min(Na(e.height),Na(e.width)),1):(k.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function kh(e){let{candidateType:t,relayProtocol:r,type:s,address:c,port:d,protocol:h}=e;const f={candidateType:t,relayProtocol:r,protocol:h};if(s!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),f.address=g.join("."),f.port=d}return f}function Ff(e){const t=e.split(":"),r=e.split(/[-.]/),s=$e(e).call(e,"-")?"-":".";let c=e;return t.length>1?r.length>1?(r[1]="**",c=r[0]+s+"**:"+t[t.length-1]):c=t.length>2?t[0]+s+"**:"+t[t.length-1]:"**:"+t[t.length-1]:r.length>1&&(c=r[0]+s+"**"),c}function TT(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Z("SVC_MODE");if(Z("ENABLE_SVC"))return(function(t){return t in Zx})(e)?e:Zx.L1T3}const n5={[ot.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ot.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function CT(e,t,r){t.forEach((s=>{var c;const d=n5[e].find((f=>{var g;let{key:v}=f;return $e(g=s.extensionName).call(g,v)}));if(!d)return;const h=r.find((f=>{let{extensionName:g}=f;return $e(g).call(g,d.key)}));h&&$e(c=h.extensionName).call(c,"gdpr_forbidden")&&(s.extensionName=h.extensionName)}))}function U_(e,t){t.forEach((r=>{var s;const c=n5[e].find((d=>{var h;let{key:f}=d;return $e(h=r.extensionName).call(h,f)}));$e(s=r.extensionName).call(s,"gdpr_forbidden")&&c&&(r.extensionName=c.extensionName)}))}function s5(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||$e(e).call(e,"abs-send-time")}function RT(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||$e(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function i5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function a5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}function NE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:f,filterVideoCodec:g,unsupportedVideoUplinkCodec:v,unsupportedVideoDownlinkCodec:E}=t,{useXR:C}=r;let R=[],A=[],B=[],L=[],U=!1,X=!1;if(aa(e).mediaDescriptions.forEach((ee=>{s&&s!==ee.attributes.direction||(ee.media.mediaType!=="video"||U||(A=ee.attributes.payloads,L=ee.attributes.extmaps,U=!0),ee.media.mediaType!=="audio"||X||(R=ee.attributes.payloads,B=ee.attributes.extmaps,X=!0))})),!L||A.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!B||R.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(A.forEach((ee=>{var ue;(ue=ee.rtpMap)!==null&&ue!==void 0&&ue.clockRate&&(ee.rtpMap.clockRate=parseInt(ee.rtpMap.clockRate)),C&&ee.rtcpFeedbacks.push({type:"rrtr"})})),R.forEach((ee=>{var ue;(ue=ee.rtpMap)!==null&&ue!==void 0&&ue.clockRate&&(ee.rtpMap.clockRate=parseInt(ee.rtpMap.clockRate)),C&&ee.rtcpFeedbacks.push({type:"rrtr"})})),c&&(R=R.filter((ee=>{var ue;return((ue=ee.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())!=="rtx"})),A=A.filter((ee=>{var ue;return((ue=ee.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())!=="rtx"}))),d){const ee=A.filter((ne=>{var be;return/(red)|(ulpfec)|(flexfec)/i.test(((be=ne.rtpMap)===null||be===void 0?void 0:be.encodingName)||"")})),ue=Dh(ee,A).map((ne=>ne.payloadType)),de=[...ee.map((ne=>ne.payloadType)),...ue];A=A.filter((ne=>!$e(de).call(de,ne.payloadType)))}if(h&&(R=R.filter((ee=>{var ue;return!/(red)|(ulpfec)|(flexfec)/i.test(((ue=ee.rtpMap)===null||ue===void 0?void 0:ue.encodingName)||"")}))),f&&(f==null?void 0:f.length)>0&&(R=R.filter((ee=>{var ue;return $e(f).call(f,((ue=ee.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())||"")}))),g&&(g==null?void 0:g.length)>0){const ee=A.filter((ue=>{var de;return $e(g).call(g,((de=ue.rtpMap)===null||de===void 0?void 0:de.encodingName.toLowerCase())||"")}));A=ee.concat(c?[]:Dh(ee,A))}const Y=Z("UNSUPPORTED_VIDEO_CODEC");if(Y&&Y.length>0){const ee=A.filter((ne=>ne.rtpMap&&$e(Y).call(Y,ne.rtpMap.encodingName.toLowerCase()))),ue=Dh(ee,A),de=ee.concat(ue).map((ne=>ne.payloadType));A=A.filter((ne=>!$e(de).call(de,ne.payloadType))),k.debug("unsupportedVideoCodec: ".concat(Y,", toBeRemoved: ").concat(de))}if(v&&v.length>0&&s==="sendonly"){const ee=A.filter((ne=>ne.rtpMap&&$e(v).call(v,ne.rtpMap.encodingName.toLowerCase()))),ue=Dh(ee,A),de=ee.concat(ue).map((ne=>ne.payloadType));A=A.filter((ne=>!$e(de).call(de,ne.payloadType))),k.debug("unsupportedVideoUplinkCodec: ".concat(v,", toBeRemoved: ").concat(de))}if(E&&E.length>0&&s==="recvonly"){const ee=A.filter((ne=>ne.rtpMap&&$e(E).call(E,ne.rtpMap.encodingName.toLowerCase()))),ue=Dh(ee,A),de=ee.concat(ue).map((ne=>ne.payloadType));A=A.filter((ne=>!$e(de).call(de,ne.payloadType))),k.debug("unsupportedVideoDownlinkCodec: ".concat(E,", toBeRemoved: ").concat(de))}return{audioCodecs:R,videoCodecs:A,audioExtensions:B,videoExtensions:L}}function Ph(e){const t=aa(e);let r,s;for(const c of t.mediaDescriptions){if(!r){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:d,icePwd:h}}if(!s){const d=c.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&t.attributes.fingerprints.length>0&&(s={fingerprints:t.attributes.fingerprints}),!s||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:s}}function o5(e,t){const r=[],s=e.attributes.ssrcGroups.filter((h=>h.semantic==="FID")),c=e.attributes.ssrcGroups.find((h=>h.semantic==="SIM")),d=e.attributes.ssrcs;if(c)c.ssrcIds.forEach((h=>{var f;const g=(f=s.find((v=>v.ssrcIds[0]===h)))===null||f===void 0?void 0:f.ssrcIds[1];r.push({ssrcId:h,rtx:t?g:void 0})}));else if(s.length>0){const h=s[0].ssrcIds[0],f=s[0].ssrcIds[1];r.push({ssrcId:h,rtx:t?f:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:d[0].ssrcId})}return r}function c5(e,t,r){const{cname:s}=e;let c=[];t&&(c=l5(t)),c.length===0&&(c=e.iceParameters.candidates.map((E=>({foundation:E.foundation,componentId:"1",transport:E.protocol,priority:E.priority.toString(),connectionAddress:E.ip,port:E.port.toString(),type:E.type,extension:{}}))),k.debug("Using candidates from gateway."));const d={fingerprints:e.dtlsParameters.fingerprints.map((E=>({hashFunction:E.algorithm,fingerprint:E.fingerprint})))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let f;switch(e.dtlsParameters.role){case"server":f="passive";break;case"client":f="active";break;case"auto":f="actpass"}const g=AT(e.rtpCapabilities),v=[];return Array.isArray(r)&&r.length>0&&r.forEach((E=>{v.push({kind:ot.VIDEO,ssrcMsg:[{ssrcId:E.v,rtx:E.v_rtx}],mslabel:"".concat(E.v,"_").concat(E.a)},{kind:ot.AUDIO,ssrcMsg:[{ssrcId:E.a}],mslabel:"".concat(E.v,"_").concat(E.a)})})),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:g,setup:f,cname:s,preSSRCs:v}}function l5(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],k.debug("Using remote candidate from AP ".concat(Ff(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),k.debug("Using IPV6 remote candidate from AP ".concat(Ff(e.ip6),":").concat(e.port)))),t}function AE(e,t,r){const s=[],c=[];return e.forEach((d=>{let{ssrcId:h,rtx:f}=d;const g=zr(8,"track-"),v={ssrcId:h,attributes:a5({label:g,mslabel:r=r||zr(10,""),msid:"".concat(r," ").concat(g)},t&&{cname:t})};if(s.push(v),f!==void 0){const E={ssrcId:f,attributes:a5({label:g,mslabel:r,msid:"".concat(r," ").concat(g)},t&&{cname:t})};s.push(E),c.push({semantic:"FID",ssrcIds:[h,f]})}})),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map((d=>{let{ssrcId:h}=d;return h}))}),{ssrcs:s,ssrcGroups:c}}function F_(e,t){t instanceof Nn&&e.attributes.payloads.forEach((r=>{var s;const c=(s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),c==="opus"&&typeof Z("OPUS_PTIME")=="number"?r.fmtp.parameters.ptime=Z("OPUS_PTIME"):r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";const d=t._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!Sn()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1")),t instanceof wE&&c==="opus"&&t._config.DTX&&(r.fmtp.parameters.usedtx="1"))}))}function QO(e){const t=e.attributes.unrecognized.findIndex((r=>r.attField==="x-google-flag"&&r.attValue==="conference"));t!==-1&&e.attributes.unrecognized.splice(t,1)}function ZO(e,t){var r;if(!(t instanceof tn&&t._encoderConfig&&t._hints.indexOf(Hr.SCREEN_TRACK)===-1))return;const s=t._encoderConfig;vr().supportMinBitrate&&s.bitrateMin&&e.attributes.payloads.forEach((c=>{var d,h;$e(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))})),vr().supportMinBitrate&&!$e(r=t._hints).call(r,Hr.LOW_STREAM)&&s.bitrateMax&&e.attributes.payloads.forEach((c=>{var d,h;$e(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(Z("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))}))}function d5(e){if(e.media.mediaType!=="video")return;const t=fr();if(t.name!==br.SAFARI&&t.os!==ls.IOS)return;const r=e.attributes.extmaps.findIndex((s=>/video-orientation/g.test(s.extensionName)));r!==-1&&e.attributes.extmaps.splice(r,1)}function NT(e,t,r){if(!t)return;let s,c;if(e.media.mediaType==="video"?(s=r.videoExtensions,c=r.videoCodecs):(s=r.audioExtensions,c=r.audioCodecs),t.twcc===!0){const d=s.find((h=>RT(h.extensionName)));if(d){const h=d.extensionName;e.attributes.extmaps.find((g=>RT(g.extensionName)))||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),(function(g,v){return v.filter((E=>!!g.find((C=>C.payloadType===E.payloadType&&!!C.rtcpFeedbacks.find((R=>R.type==="transport-cc"))))))})(c,e.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((v=>v.type==="transport-cc"))||g.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(t.twcc===!1){const d=e.attributes.extmaps.findIndex((h=>RT(h.extensionName)));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach((h=>{const f=h.rtcpFeedbacks.findIndex((g=>g.type==="transport-cc"));f!==-1&&h.rtcpFeedbacks.splice(f,1)}))}if(t.remb===!0){const d=s.find((h=>s5(h.extensionName)));if(d){const h=d.extensionName;e.attributes.extmaps.find((g=>g.extensionName===h))||e.attributes.extmaps.push({entry:d.entry,extensionName:h}),(function(g,v){return v.filter((E=>!!g.find((C=>C.payloadType===E.payloadType&&!!C.rtcpFeedbacks.find((R=>R.type==="goog-remb"))))))})(c,e.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((v=>v.type==="goog-remb"))||g.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(t.remb===!1){const d=e.attributes.extmaps.findIndex((h=>s5(h.extensionName)));d!==-1&&e.attributes.extmaps.splice(d,1),e.attributes.payloads.forEach((h=>{const f=h.rtcpFeedbacks.findIndex((g=>g.type==="goog-remb"));f!==-1&&h.rtcpFeedbacks.splice(f,1)}))}}function u5(e,t,r){if(Sn()||e.media.mediaType!=="video"||!(t instanceof tn)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!Z("SIMULCAST")||r==="vp9"&&Z("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const s=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],d=e.attributes.ssrcGroups.find((f=>f.semantic==="FID"&&f.ssrcIds[0]===c.ssrcId)),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let f=1;f<s;f++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+f,attributes:hn(c.attributes)}),h.ssrcIds.push(c.ssrcId+f),d&&(e.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+f,attributes:hn(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+f,d.ssrcIds[1]+f]}));e.attributes.ssrcGroups.unshift(h)}async function h5(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});const s=(await r.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=(function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const E=NE(v,f,g,"sendonly"),C=NE(v,f,g,"recvonly"),R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(uc(E,C,"videoExtensions",R,A,B),uc(E,C,"videoCodecs",R,A,B),uc(E,C,"audioExtensions",R,A,B),uc(E,C,"audioCodecs",R,A,B),Z("RAISE_H264_BASELINE_PRIORITY")){const L=[],U=[];if(B.videoCodecs.forEach(((X,Y)=>{var ee;if(((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"){var ue,de;const ne=B.videoCodecs[Y+1],be=ne&&_5(X,ne),Ae=(ue=X.fmtp)===null||ue===void 0?void 0:ue.parameters["profile-level-id"],Ue=(de=X.fmtp)===null||de===void 0?void 0:de.parameters["packetization-mode"];!Ae||Ae!==Z("FIRST_H264_PROFILE_LEVEL_ID")||Z("FIRST_PACKETIZATION_MODE")&&Ue!==Z("FIRST_PACKETIZATION_MODE")?be?U.push([X,ne]):U.push([X]):be?L.push([X,ne]):L.push([X])}})),L.length>0&&U.length>0){k.debug("raising H264 baseline profile priority"),B.videoCodecs.forEach(((Y,ee)=>{var ue;if(((ue=Y.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLocaleLowerCase())==="h264"){const de=_5(Y,B.videoCodecs[ee+1]),ne=L.shift()||U.shift()||[];ne.length>0&&(de?B.videoCodecs.splice(ee,2,...ne):B.videoCodecs.splice(ee,1,...ne))}}));const X=A.videoCodecs.filter((Y=>{var ee,ue;return((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((ue=Y.fmtp)===null||ue===void 0?void 0:ue.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID")}));if(X.length>0){const Y=Dh(X,A.videoCodecs).map((ue=>ue.payloadType)),ee=[...X.map((ue=>ue.payloadType)),...Y];A.videoCodecs=A.videoCodecs.filter((ue=>!$e(ee).call(ee,ue.payloadType)))}Z("FILTER_SEND_H264_BASELINE")&&(R.videoCodecs=R.videoCodecs.filter((Y=>{var ee,ue;return!(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((ue=Y.fmtp)===null||ue===void 0?void 0:ue.parameters["profile-level-id"])!==Z("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:R,recv:A,sendrecv:B}}return{send:R,recv:A,sendrecv:B}})(e,t,s);try{r.close()}catch{}return{send:c,recv:d,sendrecv:h}}function p5(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=NE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(uc(e,t,"videoExtensions",r,s,c),uc(e,t,"videoCodecs",r,s,c),uc(e,t,"audioExtensions",r,s,c),uc(e,t,"audioCodecs",r,s,c),Z("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex((h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f"));if(d!==-1){const h=c.videoCodecs.findIndex((f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(h<d){k.debug("raising H264 baseline profile priority");const f=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,f)}h!==-1&&(s.videoCodecs=s.videoCodecs.filter((f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:r,recv:s,sendrecv:c}}function uc(e,t,r,s,c,d){if(r==="videoExtensions"||r==="audioExtensions"){const h=[];return e[r].forEach((f=>{t[r].some(((g,v)=>{if(f.entry===g.entry&&f.extensionName===g.extensionName)return h.push(v),!0}))?d[r].push(f):s[r].push(f)})),void t[r].forEach(((f,g)=>{h.indexOf(g)===-1&&c[r].push(f)}))}if(r==="videoCodecs"||r==="audioCodecs"){const h=[];return e[r].forEach((f=>{t[r].some(((g,v)=>{if(f.payloadType===g.payloadType&&JSON.stringify(f)===JSON.stringify(g))return h.push(v),!0}))?d[r].push(f):s[r].push(f)})),void t[r].forEach(((f,g)=>{h.indexOf(g)===-1&&c[r].push(f)}))}}function AT(e){const{send:t,recv:r,sendrecv:s}=e;if(!s){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let c,d;return t?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...t.audioCodecs,...s.audioCodecs],c.videoCodecs=[...t.videoCodecs,...s.videoCodecs],c.audioExtensions=[...t.audioExtensions,...s.audioExtensions],c.videoExtensions=[...t.videoExtensions,...s.videoExtensions]):c=s,r?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...r.audioCodecs,...s.audioCodecs],d.videoCodecs=[...r.videoCodecs,...s.videoCodecs],d.audioExtensions=[...r.audioExtensions,...s.audioExtensions],d.videoExtensions=[...r.videoExtensions,...s.videoExtensions]):d=s,{send:c,recv:d}}function V_(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter((t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function IE(e,t,r,s){let c=[];if(e===ot.VIDEO){if(Z("H264_PROFILE_LEVEL_ID")&&s==="h264"&&(c=t.videoCodecs.filter((d=>{var h;return $e(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,s)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===Z("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(c)||c.length===0){let d=[];const h=[],f=[],g=[];if(r.videoCodecs.forEach((v=>{const E=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";$e(E).call(E,s)?d.push(v):$e(E).call(E,"vp9")?h.push(v):$e(E).call(E,"vp8")?f.push(v):$e(E).call(E,"h264")&&g.push(v)})),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):f.length!==0?(d=f,v="vp8"):g.length!==0&&(d=g,v="h264"),k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=t.videoCodecs.filter((v=>d.some((E=>E.payloadType===v.payloadType)))))}if(c.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),c=t.videoCodecs),Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const d=Dh(c,t.videoCodecs);c=[...c,...d]}}else{c=t.audioCodecs.filter((h=>{var f;return $e(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,s)}));const d=t.audioCodecs.filter((h=>{var f;return $e(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"red")}));c.length===0&&(k.warning("codec ".concat(s," not included in rtpCapabilities, fallback to opus")),c=t.audioCodecs.filter((h=>{var f;return $e(f=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(f,"opus")}))),Z("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function Dh(e,t){const r=e.map((s=>s.payloadType.toString()));return t.filter((s=>s.rtpMap&&s.rtpMap.encodingName==="rtx"&&s.fmtp&&s.fmtp.parameters.apt&&$e(r).call(r,s.fmtp&&s.fmtp.parameters.apt)))}async function jh(e,t,r){const s=t.toString(),c=m5(s,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:s});const d=await e.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=f5(h,r||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function f5(e,t,r){const s=aa(e),{useXR:c}=t;return s.mediaDescriptions.forEach((d=>{var h;d.attributes.mid&&(Array.isArray(r)&&!$e(r).call(r,d.attributes.mid)||(d.media.mediaType==="audio"&&V_(d),c&&$e(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach((f=>{f.rtcpFeedbacks.findIndex((g=>g.type==="rrtr"))===-1&&f.rtcpFeedbacks.push({type:"rrtr"})}))))})),Rh(s)}function m5(e,t,r,s){if(Z("SDP_LOGGING"))return k.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(s,`
`),e),t==="offer"?c=>{m5(c,"answer",r==="local"?"remote":"local",s)}:void 0}function g5(e){const t=Z("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((r=>$e(e).call(e,r)))}function _5(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function y5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function Za(e,t){return typeof Z(e)===t?Z(e):void 0}function dne(){try{const e=Z("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?y5(Object(s),!0).forEach((function(c){H(t,c,s[c])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):y5(Object(s)).forEach((function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))}))}return t})({},e)}catch(e){return k.debug("handle gateway attributes failed: ",e),{}}}const v5={};function Lh(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&k.debug("install service ".concat(e.name)),v5[e.name]=e}function uu(e){const t=v5[e];if(!t)throw new Ne(J.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function E5(e,t){return uu("DataStream").create(e,t)}function IT(){return uu("InterceptFrame").create()}function w5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function ai(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const e1=new Map;class une extends _n{get state(){return this._state}set state(t){if(t===this._state)return;const r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(ps.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(ps.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){k.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var s,c,d;super(),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"key",void 0),H(this,"ntpOffset",0),H(this,"signal",void 0),H(this,"role",void 0),H(this,"isPreallocation",void 0),H(this,"isPreSub",void 0),H(this,"inChannelInfo",{joinAt:null,duration:0}),H(this,"spec",void 0),H(this,"_state","DISCONNECTED"),H(this,"_statsCollector",void 0),H(this,"_disconnectedReason",void 0),H(this,"isSignalRecover",!1),H(this,"hasChangeBGPAddress",!1),H(this,"trafficStatsInterval",void 0),H(this,"networkQualityInterval",void 0),H(this,"_joinGatewayStartTime",0),H(this,"_signalTimeout",!1),H(this,"_clientRoleOptions",void 0),H(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(s={spec:ai(ai({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(c=(d=uu("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,s)):new cne(ai(ai({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,s){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=e1.get(t.cname);if(d||(d=new Map,e1.set(t.cname,d)),this._isProactiveJoin=!0,d.has(t.uid)){const v=new Ce(J.UID_CONFLICT);throw ft.joinGateway(t.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),v}d.set(t.uid,!0),this.joinInfo=t,this.key=r;let h=0;this.joinGatewayStartTime=c;const f=t.proxyServer;try{k.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=t.gatewayAddrs.map((E=>{let{address:C}=E;const[R,A]=C.split(":"),B={host:R,port:A};return t.proxyServer&&(B.proxy=t.proxyServer),B}));h=(await this.signal.init(v)).uid,k.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var g;throw k.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),ft.joinGateway(t.sid,{lts:c,succ:!1,ec:((g=v.data)===null||g===void 0?void 0:g.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!f,signalChannel:"0",preload:t.preload}),d.delete(t.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),k.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((v=>{k.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ps.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ps.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ps.NETWORK_QUALITY,{uplinkNetworkQuality:t5(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:t5(this._statsCollector.trafficStats.B_dnq)}):this.emit(ps.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),h}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==Pr.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Zr.CONNECTED||await(function(s,c){return c===1/0?s:nt.race([s,Lte(c)])})(this.signal.request(Dt.LEAVE,void 0,!0),3e3)}catch(s){k.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),s)}this.signal.close(r),r!==Pr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:Z("PUB_EXTEND"),twcc:!!Z("PUBLISH_TWCC"),rtx:!!Z("USE_PUB_RTX")};try{return(await this.signal.request(Dt.PUBLISH,c,!0))._message}catch(d){if(s&&d.data&&d.data.code===Nt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw d}}async publishDataChannel(t,r,s){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(c=r.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(Dt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(s&&h.data&&h.data.code===Nt.ERR_PUBLISH_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw h}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Dt.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unpublish warning: "),s)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await nt.all(t.map((r=>this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channel_id:r},!0))))}catch(r){k.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX")||void 0,extend:Z("SUB_EXTEND"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(Dt.PRE_SUBSCRIBE,c,!0)}catch(d){if(s&&d.data&&d.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(t,r,!1);throw d}}async subscribe(t,r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Z("SUBSCRIBE_TWCC"),rtx:!!Z("USE_SUB_RTX"),extend:Z("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return(await this.signal.request(Dt.SUBSCRIBE,c,!0))._message}catch(d){if(s&&d.data&&d.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw d}}async subscribeDataChannel(t,r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(Dt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(s&&d.data&&d.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw d}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const s={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!Z("USE_SUB_RTX"),twcc:!!Z("SUBSCRIBE_TWCC"),svc:Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0};try{return await this.signal.request(Dt.SUBSCRIBE_STREAMS,s,!0)}catch(c){if(r&&c.data&&c.data.code===Nt.ERR_SUBSCRIBE_REQUEST_INVALID)return k.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw c}}async setVideoProfile(t){const r=(function(s){if(!(s.bitrateMax&&s.bitrateMin&&s.frameRate&&s.height&&s.width))return;let c=s.frameRate,d=s.width,h=s.height,f=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(f=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(f=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(f=!1)),f?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*s.bitrateMax,min_bps:1e3*s.bitrateMin,target_bps:1e3*s.bitrateMax}:void 0})(t);if(r)return this.signal.request(Dt.SET_VIDEO_PROFILE,r);k.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(s){k.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),s)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await nt.all(t.map((s=>this.signal.request(Dt.UNSUBSCRIBE_DATASTREAM,{stream_id:s,uid:r},!0))))}catch(s){k.warning("unsubscribeDataChannel warning: ",s)}}async massUnsubscribe(t){try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){k.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){const{iceParameters:r,dtlsParameters:s,rtpCapabilities:c}=t;return{gatewayEstablishParams:await this.signal.request(Dt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:s,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Dt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Dt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),Z("CLIENT_ROLE_OPTIONS")&&(k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),Z("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Z("CLIENT_ROLE_OPTIONS")),k.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Z("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let s,c=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(s=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},r);delete d.delay,delete d.level,await this.signal.request(Dt.SET_CLIENT_ROLE,ai(ai({role:t,level:c,delay:s},d),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(Dt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Dt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(Dt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(Dt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Dt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,s){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,s)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ai({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Dt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=e1.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=(function(r){let s;return s=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:Bs.username,password:Bs.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ai(ai({},Bs),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Dt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((r=>{const s=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((c=>c.peer_uid===r.peer_uid));s&&s.B_st!==r.B_st&&Yx((()=>{this.emit(ps.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var r,s;if(!this.joinInfo||!this.key)throw new Ce(J.UNEXPECTED_ERROR,"can not generate join message, no join info");const c=Object.assign({},this.joinInfo.apResponse);let d=Z("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ps.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,$e(P_).call(P_,h)||P_.push(h);const f=mO(this.store),g=!((r=this.isPreallocation)===null||r===void 0||!r.call(this)),v=x3(this.store),E=dne(),C=f_(87)||P4()||qI(117),R=((function(){const B=fr();if(B.name!==br.SAFARI||!B.browserVersion)return!1;const L=B.browserVersion.split(".");return Number(L[0])>18||Number(L[0])===18&&Number(L[1])>=4})()||M4(18,4,!1))&&GI(18,6,!0)&&this.spec.codec==="h264"&&Z("ENABLE_ABSSENDTIME_AS_SENTTS"),A=ai({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:xo,browser:navigator.userAgent,process_id:Z("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:Z("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:ai(ai({enableEncodedTransform:(!!Z("ENABLE_AUDIO_METADATA")||!!Z("ENABLE_AUDIO_PTS"))&&C||!!Z("ENABLE_AUDIO_TOPN")&&BI(br.CHROME,87,116)||void 0,enableAudioMetadata:!!Z("ENABLE_AUDIO_METADATA")&&C,enableAudioPts:!!Z("ENABLE_AUDIO_PTS")&&C,topnSmoothLevel:Z("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Z("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Z("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Z("TOPN_AUDIO_GAIN"),enablePublishedUserList:Z("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Z("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Za("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Za("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Za("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Z("USE_PUB_RTX")===!0||Z("USE_SUB_RTX")===!0||void 0,disableFEC:Z("DISABLE_FEC"),enableNTPReport:!!Z("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:v,enableFulllinkAvSync:!!Z("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Za("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Z("FORCE_ENABLE_AUT_CC")||!rT()&&(!!Z("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Z("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Za("USE_XR","boolean"),enableLossbasedBwe:Za("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Z("FORCE_ENABLE_AUT_CC")||!rT()&&(!!Z("ENABLE_AUT_CC")||void 0),enableCCFallback:Za("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:f?Za("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Za("PUBLISH_TWCC","boolean"),enableSubTWCC:Za("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Za("USE_PUB_RTX","boolean"),enableSubRTX:Za("USE_SUB_RTX","boolean"),enableSubSVC:Z("ENABLE_SVC")?Z("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Z("SVC"))&&Z("SVC").length!==0?Z("SVC"):void 0,enableSvcExtended:Z("ENABLE_SVC")&&Array.isArray(Z("SVC_EXTENDED"))&&Z("SVC_EXTENDED").length!==0?Z("SVC_EXTENDED"):void 0},E),{},{audioDuplicate:Za("ENABLE_AUDIO_RED","boolean")?(s=Za("AUDIO_DUPLICATE_NUM","number"))!==null&&s!==void 0?s:2:void 0,senttsUsesAbsSendTime:!!R||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(A.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(A.aes_mode=this.joinInfo.aesmode,Z("ENCRYPT_AES")?(A.aes_secret=this.joinInfo.aespassword,A.aes_encrypt=!0):A.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(A.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(A.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(A.default_video_stream=this.joinInfo.defaultVideoStream),A}getRejoinMessage(){if(!this.joinInfo)throw new Ce(J.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Mt.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(Mt.WS_RECONNECTING,(t=>{this.joinInfo&&ft.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Fs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ft.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(Mt.WS_CLOSED,(t=>{let r;switch(t){case Pr.LEAVE:r=Fs.LEAVE;break;case Pr.UID_BANNED:case Pr.IP_BANNED:case Pr.CHANNEL_BANNED:case Pr.SERVER_ERROR:r=Fs.SERVER_ERROR;break;case Pr.FALLBACK:r=Fs.FALLBACK;break;case Pr.LICENSE_MISSING:case Pr.LICENSE_EXPIRED:case Pr.LICENSE_MINUTES_EXCEEDED:case Pr.LICENSE_PERIOD_INVALID:case Pr.LICENSE_MULTIPLE_SDK_SERVICE:case Pr.LICENSE_ILLEGAL:case Pr.TOKEN_EXPIRE:r=t;break;default:r=Fs.NETWORK_ERROR}k.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+Fs.NETWORK_ERROR)),this.joinInfo&&ft.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Pr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==Pr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(Mt.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=Z("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(k.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(ft.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void k.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));Vr("EVENT_REPORT_DOMAIN",t[1]),Vr("EVENT_REPORT_BACKUP_DOMAIN",t[1]),Vr("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}})),this.signal.on(or.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(Mt.REQUEST_RECOVER,((t,r,s)=>{if(!this.joinInfo)return s(new Ce(J.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Vs(this,ps.REQUEST_NEW_GATEWAY_LIST).then(r).catch(s)})),this.signal.on(Mt.REQUEST_JOIN_INFO,(async(t,r,s)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const f=hn((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(Z("NEW_TURN_MODE")&&f&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var g;let R=f.servers.map((L=>"turnServerURL"in L&&Z("USE_TURN_IP")?ai(ai({},L),{},{turnServerURL:xT(L.turnServerURL)}):L)),A=(g=f.serversFromGateway)===null||g===void 0?void 0:g.map((L=>Z("USE_TURN_IP")?ai(ai({},L),{},{turnServerURL:xT(L.turnServerURL)}):L));const B=this.signal.currentURLIndex;R.length>0&&(R=[R[B%R.length]],f.servers=R),Array.isArray(A)&&A.length>0&&(A=[A[0]],f.serversFromGateway=A),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(B))}const{iceParameters:v,dtlsParameters:E,rtpCapabilities:C}=await Vs(this,ps.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:f,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:v,dtlsParameters:E,rtpCapabilities:C,version:"2"}}))}catch(R){r(R)}})),this.signal.on(Mt.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(Mt.REPORT_JOIN_GATEWAY,((t,r)=>{if(!this.joinInfo)return;let s,c="";var d;t instanceof Ce?(s=((d=t.data)===null||d===void 0?void 0:d.desc)||t.code,c=t.message):s=t,ft.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,errorMsg:c,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(Mt.IS_P2P_DISCONNECTED,(t=>{t(fE(this,ps.IS_P2P_DISCONNECTED))})),this.signal.on(Mt.DISCONNECT_P2P,(()=>{this.emit(ps.DISCONNECT_P2P)})),this.signal.on(Mt.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(Mt.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(Mt.JOIN_RESPONSE,(t=>{const r=this.getCurrentGatewayAddress();this.emit(ps.JOIN_RESPONSE,t,r)})),this.signal.on(Mt.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var t,r;this.updateTurnConfigFromSignal();const c=this.getCurrentGatewayAddress(),d=hn((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(Z("NEW_TURN_MODE")&&d&&((r=this.joinInfo)===null||r===void 0?void 0:r.cloudProxyServer)==="disabled"){var s;let f=d.servers.map((E=>"turnServerURL"in E&&Z("USE_TURN_IP")?ai(ai({},E),{},{turnServerURL:xT(E.turnServerURL)}):E)),g=(s=d.serversFromGateway)===null||s===void 0?void 0:s.map((E=>Z("USE_TURN_IP")?ai(ai({},E),{},{turnServerURL:xT(E.turnServerURL)}):E));const v=this.signal.currentURLIndex;f.length>0&&(f=[f[v%f.length]],d.servers=f),Array.isArray(g)&&g.length>0&&(g=[g[0]],d.serversFromGateway=g),k.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(v,",in pre pc"))}const h=Z("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){const f=l5(c);this.emit(ps.PRE_CONNECT_PC,{candidates:f,fingerprint:h,turnServer:d})}}})),this.signal.on(Mt.RECOVER_NOTIFICATION,(t=>{this.joinInfo&&typeof Z("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Z("AP_REQUEST_DETAIL"),";").concat(t))}))}async tryUnsubBeforeResub(t,r){try{await this.signal.request(Dt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),s),s}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(Dt.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(s){throw k.warning("unsubscribe datachannel warning",s),s}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(Dt.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),s),s}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(Dt.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(s){throw k.warning("unpublish datastream warning: ",s),s}}async tryMassUnsubBeforeResub(t){const r={users:t.map((s=>({stream_id:s.stream_id,stream_type:s.stream_type})))};try{await this.signal.request(Dt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),s),s}}async muteLocal(t,r){const s={action:t.find((c=>c.stream_type===Mr.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(t,r){const s={action:t.find((c=>c.stream_type===Mr.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(t,r){const s={action:t===ot.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(t,r){const s={action:t===ot.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(Dt.CONTROL,s,!0,!0)}catch(c){throw k.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Dt.RESTART_ICE,r,!0)}catch(s){throw k.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),s),s}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||Fs.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!Z("GATEWAY_WSS_ADDRESS"))return Z("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(k.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Dt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let OT=0,t1=0;function dl(e,t,r,s){return new nt(((c,d)=>{t.timeout=t.timeout||Z("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),OT+=od(t.data)):r&&(t.data.size?OT+=t.data.size:t.data instanceof FormData?OT+=Z4(t.data):OT+=od(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,qi.request(t).then((h=>{typeof h.data=="string"?t1+=od(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?t1+=h.data.byteLength:t1+=od(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)})).catch((h=>{qi.isCancel(h)?d(new Ce(J.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Ce(J.NETWORK_TIMEOUT,h.message)):h.response?d(new Ce(J.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Ce(J.NETWORK_ERROR,h.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Me){var Xe=0;return function(){return Xe<Me.length?{done:!1,value:Me[Xe++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Me,Xe,lt){return Me==Array.prototype||Me==Object.prototype||(Me[Xe]=lt.value),Me},s,c=(function(Me){Me=[typeof globalThis=="object"&&globalThis,Me,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var Xe=0;Xe<Me.length;++Xe){var lt=Me[Xe];if(lt&&lt.Math==Math)return lt}throw Error("Cannot find global object")})(this);function d(Me,Xe){if(Xe)e:{var lt=c;Me=Me.split(".");for(var Ve=0;Ve<Me.length-1;Ve++){var D=Me[Ve];if(!(D in lt))break e;lt=lt[D]}(Xe=Xe(Ve=lt[Me=Me[Me.length-1]]))!=Ve&&Xe!=null&&r(lt,Me,{configurable:!0,writable:!0,value:Xe})}}function h(Me){return(Me={next:Me})[Symbol.iterator]=function(){return this},Me}function f(Me){var Xe=typeof Symbol<"u"&&Symbol.iterator&&Me[Symbol.iterator];return Xe?Xe.call(Me):{next:t(Me)}}if(d("Symbol",(function(Me){function Xe(D,re){this.A=D,r(this,"description",{configurable:!0,writable:!0,value:re})}if(Me)return Me;Xe.prototype.toString=function(){return this.A};var lt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ve=0;return function D(re){if(this instanceof D)throw new TypeError("Symbol is not a constructor");return new Xe(lt+(re||"")+"_"+Ve++,re)}})),d("Symbol.iterator",(function(Me){if(Me)return Me;Me=Symbol("Symbol.iterator");for(var Xe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),lt=0;lt<Xe.length;lt++){var Ve=c[Xe[lt]];typeof Ve=="function"&&typeof Ve.prototype[Me]!="function"&&r(Ve.prototype,Me,{configurable:!0,writable:!0,value:function(){return h(t(this))}})}return Me})),typeof Object.setPrototypeOf=="function")s=Object.setPrototypeOf;else{var g;e:{var v={};try{v.__proto__={a:!0},g=v.a;break e}catch{}g=!1}s=g?function(Me,Xe){if(Me.__proto__=Xe,Me.__proto__!==Xe)throw new TypeError(Me+" is not extensible");return Me}:null}var E=s;function C(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function R(Me){if(Me.m)throw new TypeError("Generator is already running");Me.m=!0}function A(Me,Xe){return Me.h=3,{value:Xe}}function B(Me){this.g=new C,this.G=Me}function L(Me,Xe,lt,Ve){try{var D=Xe.call(Me.g.j,lt);if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");if(!D.done)return Me.g.m=!1,D;var re=D.value}catch(le){return Me.g.j=null,Me.g.s(le),U(Me)}return Me.g.j=null,Ve.call(Me.g,re),U(Me)}function U(Me){for(;Me.g.h;)try{var Xe=Me.G(Me.g);if(Xe)return Me.g.m=!1,{value:Xe.value,done:!1}}catch(lt){Me.g.v=void 0,Me.g.s(lt)}if(Me.g.m=!1,Me.g.l){if(Xe=Me.g.l,Me.g.l=null,Xe.F)throw Xe.D;return{value:Xe.return,done:!0}}return{value:void 0,done:!0}}function X(Me){this.next=function(Xe){return Me.o(Xe)},this.throw=function(Xe){return Me.s(Xe)},this.return=function(Xe){return(function(lt,Ve){R(lt.g);var D=lt.g.j;return D?L(lt,"return"in D?D.return:function(re){return{value:re,done:!0}},Ve,lt.g.return):(lt.g.return(Ve),U(lt))})(Me,Xe)},this[Symbol.iterator]=function(){return this}}function Y(Me,Xe){return Xe=new X(new B(Xe)),E&&Me.prototype&&E(Xe,Me.prototype),Xe}if(C.prototype.o=function(Me){this.v=Me},C.prototype.s=function(Me){this.l={D:Me,F:!0},this.h=this.C||this.u},C.prototype.return=function(Me){this.l={return:Me},this.h=this.u},B.prototype.o=function(Me){return R(this.g),this.g.j?L(this,this.g.j.next,Me,this.g.o):(this.g.o(Me),U(this))},B.prototype.s=function(Me){return R(this.g),this.g.j?L(this,this.g.j.throw,Me,this.g.o):(this.g.s(Me),U(this))},d("Array.prototype.entries",(function(Me){return Me||function(){return(function(Xe,lt){Xe instanceof String&&(Xe+="");var Ve=0,D=!1,re={next:function(){if(!D&&Ve<Xe.length){var le=Ve++;return{value:lt(le,Xe[le]),done:!1}}return D=!0,{done:!0,value:void 0}}};return re[Symbol.iterator]=function(){return re},re})(this,(function(Xe,lt){return[Xe,lt]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ee=function(Me,Xe){for(var lt=0;lt<Me.length;lt++)Xe(Me[lt])},ue=function(Me){return Me.replace(/\r?\n|\r/g,`\r
`)},de=function(Me,Xe,lt){return Xe instanceof Blob?(lt=lt!==void 0?lt+"":typeof Xe.name=="string"?Xe.name:"blob",Xe.name===lt&&Object.prototype.toString.call(Xe)!=="[object Blob]"||(Xe=new File([Xe],lt)),[String(Me),Xe]):[String(Me),String(Xe)]},ne=function(Me,Xe){if(Me.length<Xe)throw new TypeError(Xe+" argument required, but only "+Me.length+" present.")},be=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ae=be.FormData,Ue=be.XMLHttpRequest&&be.XMLHttpRequest.prototype.send,He=be.Request&&be.fetch,Yt=be.navigator&&be.navigator.sendBeacon,Qt=be.Element&&be.Element.prototype,Lt=be.Symbol&&Symbol.toStringTag;Lt&&(Blob.prototype[Lt]||(Blob.prototype[Lt]="Blob"),"File"in be&&!File.prototype[Lt]&&(File.prototype[Lt]="File"));try{new File([],"")}catch{be.File=function(Xe,lt,Ve){return Xe=new Blob(Xe,Ve||{}),Object.defineProperties(Xe,{name:{value:lt},lastModified:{value:+(Ve&&Ve.lastModified!==void 0?new Date(Ve.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Lt&&Object.defineProperty(Xe,Lt,{value:"File"}),Xe}}var Ir=function(Me){return Me.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},xr=function(Me){this.i=[];var Xe=this;Me&&ee(Me.elements,(function(lt){if(lt.name&&!lt.disabled&&lt.type!=="submit"&&lt.type!=="button"&&!lt.matches("form fieldset[disabled] *"))if(lt.type==="file"){var Ve=lt.files&&lt.files.length?lt.files:[new File([],"",{type:"application/octet-stream"})];ee(Ve,(function(D){Xe.append(lt.name,D)}))}else lt.type==="select-multiple"||lt.type==="select-one"?ee(lt.options,(function(D){!D.disabled&&D.selected&&Xe.append(lt.name,D.value)})):lt.type==="checkbox"||lt.type==="radio"?lt.checked&&Xe.append(lt.name,lt.value):(Ve=lt.type==="textarea"?ue(lt.value):lt.value,Xe.append(lt.name,Ve))}))};if((e=xr.prototype).append=function(Me,Xe,lt){ne(arguments,2),this.i.push(de(Me,Xe,lt))},e.delete=function(Me){ne(arguments,1);var Xe=[];Me=String(Me),ee(this.i,(function(lt){lt[0]!==Me&&Xe.push(lt)})),this.i=Xe},e.entries=function Me(){var Xe,lt=this;return Y(Me,(function(Ve){if(Ve.h==1&&(Xe=0),Ve.h!=3)return Xe<lt.i.length?Ve=A(Ve,lt.i[Xe]):(Ve.h=0,Ve=void 0),Ve;Xe++,Ve.h=2}))},e.forEach=function(Me,Xe){ne(arguments,1);for(var lt=f(this),Ve=lt.next();!Ve.done;Ve=lt.next()){var D=f(Ve.value);Ve=D.next().value,D=D.next().value,Me.call(Xe,D,Ve,this)}},e.get=function(Me){ne(arguments,1);var Xe=this.i;Me=String(Me);for(var lt=0;lt<Xe.length;lt++)if(Xe[lt][0]===Me)return Xe[lt][1];return null},e.getAll=function(Me){ne(arguments,1);var Xe=[];return Me=String(Me),ee(this.i,(function(lt){lt[0]===Me&&Xe.push(lt[1])})),Xe},e.has=function(Me){ne(arguments,1),Me=String(Me);for(var Xe=0;Xe<this.i.length;Xe++)if(this.i[Xe][0]===Me)return!0;return!1},e.keys=function Me(){var Xe,lt,Ve,D,re=this;return Y(Me,(function(le){if(le.h==1&&(Xe=f(re),lt=Xe.next()),le.h!=3)return lt.done?void(le.h=0):(Ve=lt.value,D=f(Ve),A(le,D.next().value));lt=Xe.next(),le.h=2}))},e.set=function(Me,Xe,lt){ne(arguments,2),Me=String(Me);var Ve=[],D=de(Me,Xe,lt),re=!0;ee(this.i,(function(le){le[0]===Me?re&&(re=!Ve.push(D)):Ve.push(le)})),re&&Ve.push(D),this.i=Ve},e.values=function Me(){var Xe,lt,Ve,D,re=this;return Y(Me,(function(le){if(le.h==1&&(Xe=f(re),lt=Xe.next()),le.h!=3)return lt.done?void(le.h=0):(Ve=lt.value,(D=f(Ve)).next(),A(le,D.next().value));lt=Xe.next(),le.h=2}))},xr.prototype._asNative=function(){for(var Me=new Ae,Xe=f(this),lt=Xe.next();!lt.done;lt=Xe.next()){var Ve=f(lt.value);lt=Ve.next().value,Ve=Ve.next().value,Me.append(lt,Ve)}return Me},xr.prototype._blob=function(){var Me="----formdata-polyfill-"+Math.random(),Xe=[],lt="--"+Me+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(Ve,D){return typeof Ve=="string"?Xe.push(lt+Ir(ue(D))+`"\r
\r
`+ue(Ve)+`\r
`):Xe.push(lt+Ir(ue(D))+'"; filename="'+Ir(Ve.name)+`"\r
Content-Type: `+(Ve.type||"application/octet-stream")+`\r
\r
`,Ve,`\r
`)})),Xe.push("--"+Me+"--"),new Blob(Xe,{type:"multipart/form-data; boundary="+Me})},xr.prototype[Symbol.iterator]=function(){return this.entries()},xr.prototype.toString=function(){return"[object FormData]"},Qt&&!Qt.matches&&(Qt.matches=Qt.matchesSelector||Qt.mozMatchesSelector||Qt.msMatchesSelector||Qt.oMatchesSelector||Qt.webkitMatchesSelector||function(Me){for(var Xe=(Me=(this.document||this.ownerDocument).querySelectorAll(Me)).length;0<=--Xe&&Me.item(Xe)!==this;);return-1<Xe}),Lt&&(xr.prototype[Lt]="FormData"),Ue){var ti=be.XMLHttpRequest.prototype.setRequestHeader;be.XMLHttpRequest.prototype.setRequestHeader=function(Me,Xe){ti.call(this,Me,Xe),Me.toLowerCase()==="content-type"&&(this.B=!0)},be.XMLHttpRequest.prototype.send=function(Me){Me instanceof xr?(Me=Me._blob(),this.B||this.setRequestHeader("Content-Type",Me.type),Ue.call(this,Me)):Ue.call(this,Me)}}He&&(be.fetch=function(Me,Xe){return Xe&&Xe.body&&Xe.body instanceof xr&&(Xe.body=Xe.body._blob()),He.call(this,Me,Xe)}),Yt&&(be.navigator.sendBeacon=function(Me,Xe){return Xe instanceof xr&&(Xe=Xe._asNative()),Yt.call(this,Me,Xe)}),be.FormData=xr}})();const OE=()=>{const e=Z("AREAS");return e.length===0&&e.push(Cr.GLOBAL),ea(e).call(e,((t,r,s)=>{const c=b5(r);return c?s===0?c:"".concat(t,",").concat(c):t}),"")},b5=e=>e===Cr.OVERSEA?"".concat(Qs.ASIA,",").concat(Qs.EUROPE,",").concat(Qs.AFRICA,",").concat(Qs.NORTH_AMERICA,",").concat(Qs.SOUTH_AMERICA,",").concat(Qs.OCEANIA):Qs[e],hne=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((r=>{const s=bT[r],c=Object.keys(s);c&&c.map((d=>{d!=="CODE"&&(t[d]=t[d].concat(s[d]))}))})),t},kT={GLOBAL:{ASIA:[Cr.CHINA,Cr.JAPAN,Cr.INDIA,Cr.KOREA,Cr.HKMC],EUROPE:[],NORTH_AMERICA:[Cr.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},PT=Object.keys(kT[Cr.GLOBAL]),r1=[Cr.CHINA,Cr.NORTH_AMERICA,Cr.EUROPE,Cr.ASIA,Cr.JAPAN,Cr.INDIA,Cr.OCEANIA,Cr.SOUTH_AMERICA,Cr.AFRICA,Cr.KOREA,Cr.HKMC,Cr.US],pne=function(e,t){let r=[];if($e(e).call(e,Cr.GLOBAL)){const d=[Cr.GLOBAL,Cr.OVERSEA],h=Object.keys(bT);if(t===Cr.GLOBAL)throw new Ce(J.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Cr.CHINA)r=[Cr.OVERSEA];else if(c=t,$e(PT).call(PT,c)){const f=(s=t,kT[Cr.GLOBAL][s]||[]),g=[...d,t,...f];r=h.filter((v=>!$e(g).call(g,v)))}else if((function(f){let g=!1;return PT.forEach((v=>{var E;$e(E=kT[Cr.GLOBAL][v]).call(E,f)&&(g=!0)})),g})(t)){const f=(function(v){let E;return PT.forEach((C=>{var R;$e(R=kT[Cr.GLOBAL][C]).call(R,v)&&(E=C)})),E})(t),g=[...d,f,t];r=h.filter((v=>!$e(g).call(g,v)))}else r=e;r=(function(f){const g=[];return r1.forEach((v=>{$e(f).call(f,v)&&g.push(v)})),g.concat(f.filter((v=>!$e(r1).call(r1,v))))})(r)}else r=e;var s,c;return r};function S5(e){var t,r;if(!e&&$e(t=Z("AREAS")).call(t,Cr.EXTENSIONS))return k.debug("update area from ap : reset"),void n1(wre,!0);if(!$e(r=Z("AREAS")).call(r,Cr.GLOBAL)||!e)return;let s=bT.EXTENSIONS;s&&(s={CODE:b5(Cr.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},k.debug("update area from ap success: ".concat(e,",config is "),s),Vr("AREAS",[Cr.EXTENSIONS],!0),Object.keys(s).map((c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Vr(c,s[c][0]):Vr(c,s[c])})))}function n1(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=ft.reportApiInvoke(null,{name:In.SET_AREA,options:e,tag:un.TRACER});try{let s=[];if(typeof e=="string"&&(s=[e]),Array.isArray(e)&&(e.forEach((d=>{if(!$e(GV).call(GV,d))throw new Ce(J.INVALID_PARAMS,"invalid area code")})),s=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:d,excludedArea:h}=e;if(!d)throw new Ce(J.INVALID_PARAMS,"area code is needed");let f=d;typeof d=="string"&&(f=[d]),s=h?pne(f,h):f}if(!t){if(al.AREAS){const d=new Ce(J.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(d),void k.warning("setArea is prohibited because of config-distribute")}if($e(s).call(s,Cr.GLOBAL)&&Z("AREAS")===Cr.EXTENSIONS){const d=new Ce(J.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(d),void k.warning("setArea is prohibited because of ap extensions")}}Vr("AREAS",s,t);const c=hne(s);Object.keys(c).map((d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?Vr(d,c[d][0]):Vr(d,c[d])})),k.debug("set area success:",s.join(","))}catch(s){throw r.onError(s),s}r.onSuccess()}function x5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function pd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}let s1=1;function fne(e,t,r,s,c){s1+=1;const d={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:s1,requestId:s1,version:xo,cname:r.cname},h={service_name:t,json_body:JSON.stringify(d)};let f,g,v=e[0];return il((async()=>{f=Date.now();const E=await dl(v,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-f,E.code!==0){const A=new Ce(J.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:g});throw k.error(A.toString()),A}const C=JSON.parse(E.json_body);if(C.code!==200){const A=new Ce(J.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(C.code,", reason: ").concat(C.reason),{code:C.code,responseTime:g});throw k.error(A.toString()),A}if(!C.servers||C.servers.length===0){const A=new Ce(J.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:C.code,responseTime:g});throw k.error(A.toString()),A}const R=(function(A,B){return{addressList:A.servers.map((L=>"wss://".concat(L.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(L.wss,"?serviceName=").concat(encodeURIComponent(B)))),workerToken:A.workerToken,vid:A.vid}})(C,t);return Z("LIVE_STREAMING_ADDRESS")&&(R.addressList=Z("LIVE_STREAMING_ADDRESS")instanceof Array?Z("LIVE_STREAMING_ADDRESS"):[Z("LIVE_STREAMING_ADDRESS")]),pd(pd({},R),{},{responseTime:g})}),((E,C)=>(ft.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(E.addressList),firstSuccess:C===0,responseTime:g,serverIp:e[C%e.length]}),!1)),((E,C)=>(ft.apworkerEvent(r.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:t,responseTime:g,serverIp:e[C%e.length]}),!!(E.code!==J.OPERATION_ABORTED&&E.code!==J.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(v=e[(C+1)%e.length],!0))),c)}let i1=1;function T5(e,t,r,s){let{url:c,areaCode:d}=e;const{clientId:h,sid:f}=t,g=Date.now();let v;const E=t.role,[C,R]=o1(t,d,[Fn.CHOOSE_SERVER]);let A=Un.networkState;return il((async()=>{A&&Un.networkState===Ra.OFFLINE&&Un.onlineWaiter&&await nt.race([Un.onlineWaiter,Ns(s&&s.maxRetryTimeout||Kn.maxRetryTimeout)]),A=Un.networkState;const{data:B,headers:L}=await dl(c,{data:C,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=L.http3==="1"?1:-1,ft.reportResourceTiming(c,f),R5(B,c,t,g,[Fn.CHOOSE_SERVER],v);const U=RE(B,Fn.CHOOSE_SERVER);return a1(U),XO(U,c)}),(B=>(B&&ft.joinChooseServer(f,{role:E,lts:g,succ:!0,csAddr:c,opid:R,serverList:B.gatewayAddrs.map((L=>L.address)),ec:null,cid:B.cid.toString(),uid:B.uid.toString(),csIp:B.csIp,unilbsServerIds:[Fn.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:B.res.detail&&B.res.detail[38]}),!1)),(B=>B.code!==J.OPERATION_ABORTED&&(B.code===J.CAN_NOT_GET_GATEWAY_SERVER?B.data.retry:(ft.joinChooseServer(f,{role:E,lts:g,succ:!1,csAddr:c,serverList:null,opid:R,ec:B.code,csIp:B.data&&B.data.csIp,unilbsServerIds:[Fn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:A}),isHttp3:v,corssRegionTagReq:t.apRequestDetail}),k.warning("[".concat(h||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),B),!0))),s)}function C5(e,t,r,s){let c,{url:d,areaCode:h,serviceIds:f}=e;const g=Date.now(),v=t.role,[E,C]=o1(t,h,f);let R;return il((async()=>{R&&Un.networkState===Ra.OFFLINE&&Un.onlineWaiter&&await nt.race([Un.onlineWaiter,Ns(s&&s.maxRetryTimeout||Kn.maxRetryTimeout)]),R=Un.networkState;const{data:A,headers:B}=await dl(d,{data:E,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=B.http3==="1"?1:-1,ft.reportResourceTiming(d,t.sid),R5(A,d,t,g,f,c);const L=RE(A,Fn.CHOOSE_SERVER),U=RE(A,t.cloudProxyServer==="proxy5"?Fn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Fn.CLOUD_PROXY:Fn.CLOUD_PROXY_FALLBACK),X=performance.getEntriesByName(d),Y=X[X.length-1];let ee;return Y&&(ee={name:Y.name,protocol:"nextHopProtocol"in Y?Y.nextHopProtocol:"",dnscost:"domainLookupEnd"in Y&&"domainLookupStart"in Y&&typeof Y.domainLookupEnd=="number"&&typeof Y.domainLookupStart=="number"?Y.domainLookupEnd-Y.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Y&&"connectStart"in Y&&typeof Y.connectEnd=="number"&&typeof Y.connectStart=="number"?Y.connectEnd-Y.connectStart:-1,reqCost:"requestStart"in Y&&typeof Y.requestStart=="number"&&"responseEnd"in Y&&typeof Y.responseEnd=="number"?Y.responseEnd-Y.requestStart:-1,handleCost:"leave_ts"in A&&"enter_ts"in A&&typeof A.leave_ts=="number"&&typeof A.enter_ts=="number"?A.leave_ts-A.enter_ts:-1}),a1(L),{gatewayInfo:XO(L,d),proxyInfo:U,url:d,resourceTimingInfo:ee}}),(A=>(A.gatewayInfo&&ft.joinChooseServer(t.sid,{role:v,lts:g,succ:!0,csAddr:d,serverList:A.gatewayInfo.gatewayAddrs.map((B=>B.address)),ec:null,opid:C,cid:A.gatewayInfo.cid.toString(),uid:A.gatewayInfo.uid.toString(),csIp:A.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:c,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:A.gatewayInfo.res.detail&&A.gatewayInfo.res.detail[38],resourceTimingInfo:A.resourceTimingInfo?JSON.stringify(A.resourceTimingInfo):void 0}),A.proxyInfo&&ft.joinWebProxyAP(t.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:A.proxyInfo.addresses.map((B=>B.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:f.toString()}),!1)),(A=>A.code!==J.OPERATION_ABORTED&&(A.code===J.CAN_NOT_GET_GATEWAY_SERVER?A.data.retry:(ft.joinWebProxyAP(t.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:A.code,eventType:t.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:R})}),k.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),A),!0))),s)}const R5=(e,t,r,s,c,d)=>{const{sid:h,clientId:f,cloudProxyServer:g}=r,v=[],E=C=>{C.flag===4096?ft.joinChooseServer(h,{role:r.role,lts:s,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:C.error.message,csIp:C.error.data&&C.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:r.apRequestDetail}):C.flag!==1048576&&C.flag!==4194304&&C.flag!==4194310||ft.joinWebProxyAP(h,{lts:s,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:C.error.code,eventType:g,unilbsServerIds:c.toString()})};if(e.response_body.forEach((C=>{const R=C.buffer.code;if(C.uri===23&&R===0&&!C.buffer.edges_services)if(C.buffer.flag===4194310)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),C.buffer.edges_services=[];else{const A={error:new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:C.buffer.flag};v.push(A),E(A)}if(R!==0){const A=M_(R),B={error:new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,A.desc,{desc:A.desc,retry:A.retry,csIp:e.detail[502]}),flag:C.buffer.flag};C.buffer.flag===4194310?k.warning(B.error.toString()):v.push(B),E(B)}})),v.length)throw k.warning("[".concat(f||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(v.map((C=>"flag: ".concat(C.flag,", message: ").concat(C.error.message,", retry: ").concat(C.error.data.retry))).join(" | "))),new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,v.map((C=>"flag: ".concat(C.flag,", message: ").concat(C.error.message))).join(" | "),{retry:!!v.find((C=>C.error.data.retry)),csIp:e.detail[502],desc:[...new Set(v.map((C=>{var R;return C==null||(R=C.error)===null||R===void 0||(R=R.data)===null||R===void 0?void 0:R.desc})).filter((C=>!!C)))]})},a1=e=>{var t,r,s,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Z("AP_AREA")&&((s=e.detail)!==null&&s!==void 0&&s[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?S5(e.detail[23].toLowerCase()):S5()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){const h=e.detail[19],f=h==null?void 0:h.split(";");for(let g=0;g<f.length;g++){var d;const v=gi(d=f[g]).call(d);e.addresses[g]&&f&&(e.addresses[g].fingerprint=v)}}if(Z("GATEWAY_ADDRESS")&&Z("GATEWAY_ADDRESS").length>0){k.debug("assign gateway address to",Z("GATEWAY_ADDRESS"));const h=Z("GATEWAY_ADDRESS").map((f=>{var g,v;const E=(g=(v=e.addresses.find((C=>C.ip===f.ip&&C.port===f.port)))===null||v===void 0?void 0:v.fingerprint)!==null&&g!==void 0?g:"";return{ip:f.ip,port:f.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:E}}));e.addresses=h}},mne=(e,t)=>{if(e.response_body&&e.response_body.length){const r=e.response_body[0];if(r.buffer.code!==0){const s=M_(r.buffer.code);throw new Ce(J.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return r.buffer.ticket}throw k.debug("update ticket request received ap response without response body:",t),new Ce(J.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},o1=(e,t,r)=>{const s=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,d={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:pd(pd(pd({6:e.stringUid,11:t,12:Z("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};d.request_bodies.forEach((f=>{e.multiIP&&e.multiIP.gateway_ip&&(f.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const h=new FormData;return h.append("request",JSON.stringify(d)),[h,s]},gne=(e,t)=>{const r=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((d=>({ip:d.ip,port:d.port})))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,r]};let B_=0;function W_(e){return nt.all(e.map((t=>t.then((r=>{throw r}),(r=>r))))).then((t=>{throw t}),(t=>t))}const kE=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:s,allFailedhandler:c,promisesCollector:d}=e,h=0;const f=t;let g,v=0;const E=async()=>{const C=(()=>{const R=h*f,A=R+f;return r.slice(R,A).map(s)})();d&&d.push(...C);try{g=await W_(C)}catch(R){if(v+=f,h++,!(v>=r.length))return void await E();c(R)}C.forEach((R=>R.cancel()))};return await E(),g},N5=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:s}=e;const c=t.length;let d=0;const h=async()=>{const f=r(t.shift());try{return await f}catch(g){if(d++,d>=c||s!=null&&s(g))throw g;return h()}};return h()};async function _ne(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new nt(((g,v)=>{let E;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:R=>{R.close(),clearTimeout(E),g(!0)},error:R=>{clearTimeout(E),g(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();const C=[t,r,s,c,d,h];for(let R=0;R<C.length;R++){const A=new EncodedVideoChunk({type:R==0?"key":"delta",timestamp:33333*R,duration:33333,data:new Uint8Array(C[R])});try{await e.decode(A)}catch{return void g(!1)}}})(),E=setTimeout((()=>{g(!1)}),5e3)}))}async function c1(e,t,r,s){return{gatewayInfo:await(async function(d,h,f,g){let v=null;const E=[],C=async()=>{const A=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((U=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:OE()}))),B=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map((U=>U.url))}),L=await kE({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:U=>(k.debug("[".concat(d.clientId,"] Connect to choose_server:"),U.url),T5(U,d,h,f)),allFailedhandler:U=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:E});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},B),L},R=async()=>{if(await Ns(1e3),v!==null)return v;const A=Z("WEBCS_DOMAIN_BACKUP_LIST").map((U=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(U+"/api/v2/transpond/webrtc?v=2"):"https://".concat(U,"/api/v2/transpond/webrtc?v=2"),areaCode:OE()}))),B=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map((U=>U.url))}),L=await kE({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:U=>(k.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),U.url),T5(U,d,h,f)),allFailedhandler:U=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:E});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},B),L};try{return v=await W_([C(),R()]),E.length&&E.forEach((A=>A.cancel&&typeof A.cancel=="function"&&A.cancel())),v}catch(A){throw A[0]}})(e,t,r,s)}}async function A5(e,t,r,s,c){const d=e.cloudProxyServer;if(d==="disabled"){if(e.useLocalAccessPoint)return await c1(e,t,r,c);if(Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:R,proxyInfo:A}=await k5(e,t,r,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:R};const B=A.map((L=>({turnServerURL:L.address,tcpport:L.tcpport||Bs.tcpport,udpport:L.udpport||Bs.udpport,username:L.username||Bs.username,password:L.password||Bs.password,forceturn:!1,security:!0})));if(c.useP2P){var h;const L=(h=e.uid)!==null&&h!==void 0?h:R.uid,U="glb:".concat(L.toString()),X=await JI(U),Y=A.map((ee=>({turnServerURL:ee.address,tcpport:ee.tcpport||Bs.tcpport,udpport:ee.udpport||Bs.udpport,username:U,password:X,forceturn:!1,security:!0})));B.push(...Y)}return e.turnServer={mode:"manual",servers:B},{gatewayInfo:R}}return await c1(e,t,r,c)}const{proxyInfo:f,gatewayInfo:g}=await k5(e,t,r,c),v={gatewayInfo:g},E=f.map((R=>({turnServerURL:R.address,tcpport:d==="proxy3"?void 0:R.tcpport?R.tcpport:Bs.tcpport,udpport:d==="proxy4"?void 0:R.udpport?R.udpport:Bs.udpport,username:R.username||Bs.username,password:R.password||Bs.password,forceturn:d!=="proxy4",security:d==="proxy5"})));if(c.useP2P){var C;const R=(C=e.uid)!==null&&C!==void 0?C:g.uid,A="glb:".concat(R.toString()),B=await JI(A),L=f.map((U=>({turnServerURL:U.address,tcpport:d==="proxy3"?void 0:U.tcpport||Bs.tcpport,udpport:d==="proxy4"?void 0:U.udpport||Bs.udpport,username:A,password:B,forceturn:d!=="proxy4",security:d==="proxy5"})));E.push(...L)}return e.turnServer={mode:"manual",servers:E},k.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(d)),v}async function I5(e,t,r,s,c){const d=Z("ACCOUNT_REGISTER").slice(0,Z("AJAX_REQUEST_CONCURRENT"));let h=[];h=t.proxyServer?d.map((g=>"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"))):d.map((g=>"https://".concat(g,"/api/v1")));const f=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await(async function(v,E,C,R,A){const B=Date.now(),L={sid:C.sid,opid:10,appid:C.appId,string_uid:E};let U=v[0];const X=await il((()=>dl(U+"".concat(U.indexOf("?")===-1?"?":"&","action=stringuid"),{data:L,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((Y,ee)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw k.error("Invalid Uint Uid ".concat(E," => ").concat(Y.uid),Y),ft.reqUserAccount(L.sid,{lts:B,success:!1,serverAddr:U,stringUid:L.string_uid,uid:Y.uid,errorCode:J.INVALID_UINT_UID_FROM_STRING_UID,extend:L}),new Ce(J.INVALID_UINT_UID_FROM_STRING_UID);return ft.reqUserAccount(L.sid,{lts:B,success:!0,serverAddr:U,stringUid:L.string_uid,uid:Y.uid,errorCode:null,extend:L}),!1}const ue=M_(Y.code);return ue.retry&&(U=v[(ee+1)%v.length]),ft.reqUserAccount(L.sid,{lts:B,success:!1,serverAddr:U,stringUid:L.string_uid,uid:Y.uid,errorCode:ue.desc,extend:L}),ue.retry}),((Y,ee)=>Y.code!==J.OPERATION_ABORTED&&(ft.reqUserAccount(L.sid,{lts:B,success:!1,serverAddr:U,stringUid:L.string_uid,uid:null,errorCode:Y.code,extend:L}),U=v[(ee+1)%v.length],!0)),A);if(X.code!==0){const Y=M_(X.code);throw new Ce(J.UNEXPECTED_RESPONSE,Y.desc)}return X})(h,e,t,r,s);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},f),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},f),g}}async function yne(e,t,r){const s=Z("ACCOUNT_REGISTER");let c=[];c=t.proxyServer?s.map((d=>"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"))):s.map((d=>"https://".concat(d,"/api/v1")));try{return await N5({referenceList:c,asyncMapHandler:h=>(async function(f,g,v,E){const C=Date.now(),R={sid:v.sid,opid:10,appid:v.appId,string_uid:g};try{const A=await dl(f+"".concat(f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(A.code!==0){const B=M_(A.code);throw new Ce(J.UNEXPECTED_RESPONSE,"preload sua error:".concat(B.desc),B)}if(A.uid<=0||A.uid>=Math.pow(2,32))throw new Ce(J.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:C,url:f,req:R,uid:A.uid,elapse:Date.now()-C}}catch(A){throw A}})(h,e,t,r),closeFn:h=>h.code===J.OPERATION_ABORTED||h.code===J.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function vne(e,t,r){const s=Z("CDS_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config"))),c=s.map((g=>(function(v,E,C,R){const A=fr(),B={flag:64,cipher_method:0,features:pd(pd(pd(pd(pd({install_id:cO(),device:A.name,system:A.os,system_general:navigator.userAgent,vendor:E.appId,version:xo,cname:E.cname,session_id:E.sid,proxyServer:E.proxyServer,sdk_type:lne.WEB_RTC,browser_name:A.name,browser_version:A.version,user_agent:navigator.userAgent,channel_name:E.cname},E.stringUid&&{string_uid:E.stringUid}),E.uid&&{uid:E.uid+""}),A.os&&{os_name:A.os}),A.osVersion&&{os_version:A.osVersion}),{},{detail:""})};return il((()=>dl(v,{data:B,timeout:1e3,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(L=>L.code!==J.OPERATION_ABORTED),R)})(g,e,t,r)));let d=null,h=null,f={};try{d=await W_(c)}catch(g){if(g.code===J.OPERATION_ABORTED)throw g;h=g}if(c.forEach((g=>g.cancel())),ft.reportApiInvoke(e.sid,{name:In.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{f=(function(g){if(!g.test_tags)return{};const v=g.test_tags,E=Object.keys(v),C={};return E.forEach((R=>{var A;const B=gi(A=R.slice(4)).call(A),L=JSON.parse(v[R]),U=L[1];C[B]={tag:L[0]||"",value:U}})),C})(d)}catch{}return f}async function O5(e,t){const r=Z("WEBCS_DOMAIN").concat(Z("WEBCS_DOMAIN_BACKUP_LIST")).map((s=>({url:"https://".concat(s,"/api/v2/transpond/webrtc?v=2"),areaCode:OE(),serviceIds:[Fn.CHOOSE_SERVER,Fn.CLOUD_PROXY_FALLBACK]})));try{return await N5({referenceList:r,asyncMapHandler:c=>(async function(d,h,f){let g,{url:v,areaCode:E,serviceIds:C}=d;const R=Date.now(),[A,B]=o1(h,E,C);let L=Un.networkState;try{L&&Un.networkState===Ra.OFFLINE&&Un.onlineWaiter&&await nt.race([Un.onlineWaiter,Ns(Kn.maxRetryTimeout)]),L=Un.networkState;const{data:U,headers:X}=await dl(v,{data:A,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=X.http3==="1"?1:-1,(de=>{const ne=[];if(de.response_body.forEach((be=>{const Ae=be.buffer.code;if(be.uri===23&&Ae===0&&!be.buffer.edges_services)if(be.buffer.flag===4194310)be.buffer.edges_services=[];else{const Ue={error:new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:de.detail[502]}),flag:be.buffer.flag};ne.push(Ue)}if(Ae!==0){const Ue=M_(Ae),He={error:new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,Ue.desc,{desc:Ue.desc,retry:Ue.retry,csIp:de.detail[502]}),flag:be.buffer.flag};be.buffer.flag===4194310?k.warning(He.error.toString()):ne.push(He)}})),ne.length)throw new Ce(J.CAN_NOT_GET_GATEWAY_SERVER,ne.map((be=>"flag: ".concat(be.flag,", message: ").concat(be.error.message))).join(" | "),{retry:!!ne.find((be=>be.error.data.retry)),csIp:de.detail[502],desc:[...new Set(ne.map((be=>{var Ae;return be==null||(Ae=be.error)===null||Ae===void 0||(Ae=Ae.data)===null||Ae===void 0?void 0:Ae.desc})).filter((be=>!!be)))]})})(U);const ee=RE(U,Fn.CHOOSE_SERVER),ue=RE(U,Fn.CLOUD_PROXY_FALLBACK);return a1(ee),{gatewayInfo:XO(ee,v),proxyInfo:ue,opid:B,requestTime:R,url:v,isHttp3:g,elapse:Date.now()-R}}catch(U){throw U}})(c,e,t),closeFn:c=>c.code===J.OPERATION_ABORTED||c.code===J.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(s){throw s}}async function k5(e,t,r,s){const c=Z("PROXY_SERVER_TYPE3"),d=(A,B,L)=>{let U=L||c;return Array.isArray(U)&&(U=B%2==0&&c[1]||c[0]),"https://".concat(U,"/ap/?url=").concat(A)};let h=null;const f=[],g=async()=>{const A=Z("WEBCS_DOMAIN").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map(((U,X)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(U,"/api/v2/transpond/webrtc?v=2"),X,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):d("".concat(U,"/api/v2/transpond/webrtc?v=2"),X),{url:Y,areaCode:OE(),serviceIds:[Fn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Fn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Fn.CLOUD_PROXY:Fn.CLOUD_PROXY_FALLBACK]}})),B=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map((U=>U.url))}),L=await kE({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:U=>(k.debug("[".concat(e.clientId,"] Connect to choose_server:"),U.url),C5(U,e,t,r)),allFailedhandler:U=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},B),L},v=async()=>{if(await Ns(1e3),h!==null)return h;const A=Z("WEBCS_DOMAIN_BACKUP_LIST").map(((U,X)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?d("".concat(U,"/api/v2/transpond/webrtc?v=2"),X,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(U,"/api/v2/transpond/webrtc?v=2"):d("".concat(U,"/api/v2/transpond/webrtc?v=2"),X),{url:Y,areaCode:OE(),serviceIds:[Fn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Fn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Fn.CLOUD_PROXY:Fn.CLOUD_PROXY_FALLBACK]}})),B=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map((U=>U.url))}),L=await kE({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:U=>(k.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),U.url),C5(U,e,t,r)),allFailedhandler:U=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:U},B),U[0]},promisesCollector:f});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},B),L};let E,C,R;try{({gatewayInfo:E,proxyInfo:C,url:R}=await W_([g(),v()]))}catch(A){throw A[0]}if(f.length&&f.forEach((A=>A.cancel&&typeof A.cancel=="function"&&A.cancel())),!E||!C)throw new Ce(J.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=R,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&R){const A=/^https?:\/\/(.+?)(\/.*)?$/.exec(R)[1];$e(c).call(c,A)&&(e.proxyServer=A,k.setProxyServer(A),ft.setProxyServer(A))}return h={gatewayInfo:E,proxyInfo:await r5(C,E.uid)},h}async function Ene(e,t,r){const s=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((d=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"))),c=s.map((d=>(function(h,f,g,v){const E={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:xo,cname:f.cname,uid:f.uid.toString(),requestId:i1,seq:i1};i1+=1;const C={service_name:"tele_channel",json_body:JSON.stringify(E)};return il((async()=>{const R=await dl(h,{data:C,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(R.code!==0){const B=new Ce(J.UNEXPECTED_RESPONSE,"cross channel ap error, code"+R.code,{retry:!0});throw k.error(B.toString()),B}const A=JSON.parse(R.json_body);if(A.code!==200){const B=new Ce(J.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(A.code,", reason: ").concat(A.reason));throw k.error(B.toString()),B}if(!A.servers||A.servers.length===0){const B=new Ce(J.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw k.error(B.toString()),B}return{vid:A.vid,workerToken:A.workerToken,addressList:(Z("CHANNEL_MEDIA_RELAY_SERVERS")||A.servers).map((B=>"wss://".concat(B.address.replace(/\./g,"-"),".").concat(Z("WORKER_DOMAIN"),":").concat(B.wss)))}}),void 0,(R=>!!(R.code!==J.OPERATION_ABORTED&&R.code!==J.UNEXPECTED_RESPONSE||R.data&&R.data.retry)),v)})(d,e,t,r)));try{const d=await W_(c);return c.forEach((h=>h.cancel())),d}catch(d){throw d[0]}}async function wne(e,t,r){let s=null;const c=[],d=async h=>{const f=Z(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((g=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2")));return h&&(await Ns(1e3),s!==null)?s:await kE({fragementLength:Z("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:g=>(k.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),(function(v,E,C,R){const[A]=gne(E,[Fn.CHOOSE_SERVER]);let B=Un.networkState;return il((async()=>{B&&Un.networkState===Ra.OFFLINE&&Un.onlineWaiter&&await nt.race([Un.onlineWaiter,Ns(R&&R.maxRetryTimeout||Kn.maxRetryTimeout)]),B=Un.networkState;const L=await dl(v,{data:A,cancelToken:C,headers:{"Content-Type":"multipart/form-data;"}},!0);return mne(L,v)}),(()=>!1),(L=>L.code!==J.OPERATION_ABORTED&&(L.code===J.UPDATE_TICKET_FAILED?L.data.retry:(k.warning("[".concat(E.clientId,"] update ticket network error, retry"),L),!0))),R)})(g,e,t,r)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return s=await W_([d(!1),d(!0)]),c.length&&c.forEach((h=>h.cancel&&typeof h.cancel=="function"&&h.cancel())),s}catch(h){throw h[0]}}function P5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function l1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}class bne extends _n{get isSuccess(){return!!this.configs}constructor(t,r){super(),H(this,"configs",void 0),H(this,"store",void 0),H(this,"joinInfo",void 0),H(this,"cancelToken",void 0),H(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),H(this,"interval",void 0),H(this,"mutex",void 0),H(this,"mutableParamsRead",!1),H(this,"configCache",{}),H(this,"limit_bitrate",void 0),this.mutex=new Xs("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),Z("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),Z("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ft.reportApiInvoke(null,{options:void 0,name:In.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:un.TRACER}).onSuccess(JSON.stringify(al))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void k.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const r=await this.mutex.lock();try{t=await vne(this.joinInfo,this.cancelToken,this.retryConfig),k.debug("[config-distribute] get config distribute",JSON.stringify(t));const s=(function(c){var d;const h=vf(d=Object.keys(c).filter((v=>/^webrtc_ng_global_parameter/.test(v)))).call(d);for(let v=0;v<h.length;v++)for(let E=h.length-1;E>v;E--){const C=h[E],R=c[C].value;if(typeof R.__priority=="number"){const A=R.__priority,B=h[E-1],L=c[B].value;if(typeof L.__priority=="number"){if(!(A>L.__priority))continue;{const U=C;h[E]=h[E-1],h[E-1]=U}}else{const U=C;h[E]=h[E-1],h[E-1]=U}}}const f=Date.now();let g={};return h.forEach((v=>{const E=c[v].value.__expires;E&&E<=f||(g[v]=c[v])})),g})(t);this.cacheGlobalParameterConfig(s),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=s}catch(s){const c=new Ce(J.NETWORK_RESPONSE_ERROR,s);k.warning("[config-distribute] ".concat(c.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){HV(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(xE.UPDATE_BITRATE_LIMIT,t):this.emit(xE.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&l1({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const r={},s=Object.keys(t),c=[];s.forEach((d=>{const h=t[d].value;r[d]=h;const f=h.__id;if(f&&this.configCache[d]&&this.configCache[d].__id===f)return;const g=h.__type,v=t[d].value,E=t[d].tag;let C=0;g?g===m3.REALTIME&&(C=1):Object.keys(v).some((R=>Object.prototype.hasOwnProperty.call(hO,R)||!FO()&&Object.prototype.hasOwnProperty.call(eT,R)?(C=1,!0):void 0)),c.push({tag:E,isApplied:C,feature:d,params:JSON.stringify(h)})})),c.forEach((d=>{let{tag:h,feature:f,params:g,isApplied:v}=d;this.store.sessionId&&ft.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:f,params:g,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=r}catch(r){k.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){const r=(function(c){const d={};return Object.keys(c).forEach((h=>{const f=c[h].value,g=f.__expires,v=f.__type;Object.keys(f).forEach((E=>{E==="__id"||E==="__type"||E==="__priority"||E==="__expires"||Object.prototype.hasOwnProperty.call(d,E)||(d[E]=l1(l1({value:f[E]},g&&{expires:g}),v&&{type:v}))}))})),d})(t);try{var s;const c=(s=r.LIMIT_BITRATE)===null||s===void 0?void 0:s.value;delete r.LIMIT_BITRATE,c&&HV(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),(function(f){try{const g=Date.now();Object.keys(f).forEach((v=>{const{value:E,type:C,expires:R}=f[v];R&&R<=g||((C===m3.REALTIME||Object.prototype.hasOwnProperty.call(hO,v))&&(al[v]=E,cn[v]=E,k.debug("Update realtime parameters from config distribute",v,E)),C||FO()||!Object.prototype.hasOwnProperty.call(eT,v)||(al[v]=E,cn[v]=E,k.debug("Update gateway parameters from config distribute",v,E)))}))}catch(g){k.error("Error update config immediately: ".concat(f),g.message)}})(r);const d=JSON.stringify(r),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),k.debug("Caching global parameters ".concat(d))}catch(c){k.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(t){try{const r=Date.now();Object.keys(t).forEach((s=>{if(s==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(cn,s)){const{value:c,expires:d}=t[s];if(d&&d<=r)return;(function(h,f){try{return typeof h=="object"&&typeof f=="object"&&JSON.stringify(h)===JSON.stringify(f)}catch{return!1}})(cn[s],c)||(al[s]=c,cn[s]=c,this.emit(xE.UPDATE_CLIENT_ROLE_OPTIONS,c),k.debug("Updating client role options: ".concat(JSON.stringify(c))))}}))}catch(r){k.error("Error handling global parameter config:",r.message)}}}class Sne extends _n{constructor(){super(...arguments),H(this,"resultStorage",new Map)}setLocalAudioStats(t,r,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(s,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(s,r))}setLocalVideoStats(t,r,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(s,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(s,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(s)),!r.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(s))}setRemoteAudioStats(t,r){const s=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){const s=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(r))}record(t,r,s){if(Z("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(t);if(!c)return;c.result.push(s);const d=t==="VIDEO_ENCODE_FAILED"?Z("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;const f=$e(h=c.result).call(h,!0);c.isPrevNormal&&!f&&this.emit("exception",d1[t],t,r),!c.isPrevNormal&&f&&this.emit("exception",d1[t]+2e3,t+"_RECOVER",r),c.isPrevNormal=f,c.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof Xn&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let s=null;r._encoderConfig&&r._encoderConfig.frameRate&&(s=Na(r._encoderConfig.frameRate));const c=t.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var r;return!(!t.codecType||$e(r=Z("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(r,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof Xn&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const d1={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ei=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){const s=r[r.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(e,t){const r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){const s=r[r.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function D5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function Vf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}class PE{constructor(t){H(this,"store",void 0),H(this,"onStatsException",void 0),H(this,"onUploadPublishDuration",void 0),H(this,"onStatsChanged",void 0),H(this,"onVideoCodecChanged",void 0),H(this,"localStats",new Map),H(this,"remoteStats",new Map),H(this,"updateStatsInterval",void 0),H(this,"trafficStats",void 0),H(this,"trafficStatsPeerList",[]),H(this,"uplinkStats",void 0),H(this,"exceptionMonitor",void 0),H(this,"p2pChannel",void 0),H(this,"scalabilityMode",Zx.L1T1),H(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.exceptionMonitor=new Sne,this.exceptionMonitor.on("exception",((r,s,c)=>{this.onStatsException&&this.onStatsException(r,s,c)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(We.LocalAudioTrack)||Vf({},yO)}getLocalVideoTrackStats(){return this.localStats.get(We.LocalVideoTrack)||Vf({},vO)}getRemoteAudioTrackStats(t){const r=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find((g=>g.peer_uid===d));return f&&(h.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(t){var c;const d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.audioStats;d&&(s[t]=r(t,d))}else Array.from(this.remoteStats.entries()).forEach((d=>{let[h,{audioStats:f}]=d;f&&(s[h]=r(h,f))}));return s}getRemoteNetworkQualityStats(t){const r={};if(t){var s;const c=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.networkStats;c&&(r[t]=c)}else Array.from(this.remoteStats.entries()).forEach((c=>{let[d,{networkStats:h}]=c;h&&(r[d]=h)}));return r}getRemoteVideoTrackStats(t){const r=(d,h)=>{if(!this.trafficStats)return h;const f=this.trafficStats.peer_delay.find((g=>g.peer_uid===d));return f&&(h.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(t){var c;const d=(c=this.remoteStats.get(t))===null||c===void 0?void 0:c.videoStats;d&&(s[t]=r(t,d))}else Array.from(this.remoteStats.entries()).forEach((d=>{let[h,{videoStats:f}]=d;f&&(s[h]=r(h,f))}));return s}getRTCStats(){let t=0,r=0,s=0,c=0;const d=this.localStats.get(We.LocalAudioTrack);d&&(t+=d.sendBytes,r+=d.sendBitrate);const h=this.localStats.get(We.LocalVideoTrack);h&&(t+=h.sendBytes,r+=h.sendBitrate);const f=this.localStats.get(We.LocalVideoLowTrack);f&&(t+=f.sendBytes,r+=f.sendBitrate),this.remoteStats.forEach((v=>{let{audioStats:E,videoStats:C}=v;E&&(s+=E.receiveBytes,c+=E.receiveBitrate),C&&(s+=C.receiveBytes,c+=C.receiveBitrate)}));let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:r,SendBytes:t,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((r=>r.B_ppad!==void 0||r.B_ppvd!==void 0)),t.peer_delay.filter((r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1)).forEach((r=>{var s;const c=(s=this.p2pChannel)===null||s===void 0?void 0:s.getRemoteMedia(r.peer_uid),d=c!=null&&c.videoSSRC?ei.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?ei.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(r.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&k.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,s){if(!t)return!1;const c=!!s&&r.framesDecodeFreezeTime>s.framesDecodeFreezeTime,d=!s||r.framesDecodeCount>s.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((r=>{let[s,c]=r;switch(s){case We.LocalVideoTrack:case We.LocalVideoLowTrack:{const f=c,g=Vf({},vO),v=t.getStats(),E=t.getLocalMedia(s);if(v){const C=v.videoSend.find((R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId)));if(C){const R=t.getLocalVideoSize(),A=t.getEncoderConfig(We.LocalVideoTrack);var d;(C.codec==="H264"||C.codec==="H265"||C.codec==="VP8"||C.codec==="VP9"||C.codec==="AV1X"||C.codec==="AV1")&&(g.codecType=C.codec,(f==null?void 0:f.codecType)!==C.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,C.codec.toLocaleLowerCase()))),g.sendBytes=C.bytes,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0,C.inputFrame?(g.captureFrameRate=C.inputFrame.frameRate,g.captureResolutionHeight=C.inputFrame.height,g.captureResolutionWidth=C.inputFrame.width):R&&(g.captureResolutionWidth=R.width,g.captureResolutionHeight=R.height),C.sentFrame?(g.sendFrameRate=C.sentFrame.frameRate,g.sendResolutionHeight=C.sentFrame.height,g.sendResolutionWidth=C.sentFrame.width):R&&(g.sendResolutionWidth=R.width,g.sendResolutionHeight=R.height),C.avgEncodeMs&&(g.encodeDelay=C.avgEncodeMs),A&&A.bitrateMax?g.targetSendBitrate=1e3*A.bitrateMax:C.targetBitrate&&(g.targetSendBitrate=C.targetBitrate),g.sendPackets=C.packets,g.sendPacketsLost=C.packetsLost,g.sendJitterMs=C.jitterMs,g.sendRttMs=C.rttMs,g.totalDuration=f?f.totalDuration+1:1,g.totalFreezeTime=f?f.totalFreezeTime:0,this.isLocalVideoFreeze(C)&&(g.totalFreezeTime+=1),C.scalabilityMode&&this.scalabilityMode!==C.scalabilityMode&&(k.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(C.scalabilityMode)),this.scalabilityMode=C.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(s,g),((f==null?void 0:f.sendResolutionWidth)!==g.sendResolutionWidth||(f==null?void 0:f.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,g);break}case We.LocalAudioTrack:{const f=c,g=Vf({},yO),v=t.getStats(),E=t.getLocalMedia(s);if(v){const C=v.audioSend.find((R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId)));if(C){if(C.codec!=="opus"&&C.codec!=="aac"&&C.codec!=="PCMU"&&C.codec!=="PCMA"&&C.codec!=="G722"||(g.codecType=C.codec),C.inputLevel)g.sendVolumeLevel=Math.round(32767*C.inputLevel);else{const R=t.getLocalAudioVolume();R&&(g.sendVolumeLevel=Math.round(32767*R))}g.sendBytes=C.bytes,g.sendPackets=C.packets,g.sendPacketsLost=C.packetsLost,g.sendJitterMs=C.jitterMs,g.sendRttMs=C.rttMs,g.sendBitrate=f?8*Math.max(0,g.sendBytes-f.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(We.LocalAudioTrack,g),g&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,g);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((r=>{var s,c;let[d,{videoStats:h,audioStats:f,videoPcStats:g}]=r;const v=f,E=h,C=g,R=Vf({},C3),A=Vf({},R3),B=Vf({},are),{audioTrack:L,videoTrack:U,audioSSRC:X,videoSSRC:Y}=t.getRemoteMedia(d);let ee;ee=this.store.useP2P?t.getStats(!0):t.getStats();const ue=(s=ee)===null||s===void 0?void 0:s.audioRecv.find((Ae=>Ae.ssrc===X)),de=(c=ee)===null||c===void 0?void 0:c.videoRecv.find((Ae=>Ae.ssrc===Y)),ne=this.trafficStats&&this.trafficStats.peer_delay.find((Ae=>Ae.peer_uid===d));if(ue&&(ue.codec!=="opus"&&ue.codec!=="aac"&&ue.codec!=="PCMU"&&ue.codec!=="PCMA"&&ue.codec!=="G722"||(R.codecType=ue.codec),ue.outputLevel?R.receiveLevel=Math.round(32767*ue.outputLevel):L&&(R.receiveLevel=Math.round(32767*L.getVolumeLevel())),R.receiveBytes=ue.bytes,R.receivePackets=ue.packets,R.receivePacketsLost=ue.packetsLost,R.receivePacketsDiscarded=ue.packetsDiscarded,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost),R.receiveBitrate=v?8*Math.max(0,R.receiveBytes-v.receiveBytes):0,R.totalDuration=v?v.totalDuration+1:1,R.totalFreezeTime=v?v.totalFreezeTime:0,R.freezeRate=R.totalFreezeTime/R.totalDuration,R.receiveDelay=ue.jitterBufferMs,R.totalDuration>10&&PE.isRemoteAudioFreeze(L)&&(R.totalFreezeTime+=1)),de){var be;de.codec!=="H264"&&de.codec!=="H265"&&de.codec!=="VP8"&&de.codec!=="VP9"&&de.codec!=="AV1X"&&de.codec!=="AV1"||(A.codecType=de.codec),A.receiveBytes=de.bytes,A.receiveBitrate=E?8*Math.max(0,A.receiveBytes-E.receiveBytes):0,A.decodeFrameRate=de.decodeFrameRate<0?0:de.decodeFrameRate,A.renderFrameRate=de.decodeFrameRate<0?0:de.decodeFrameRate,de.outputFrame&&(A.renderFrameRate=de.outputFrame.frameRate),de.receivedFrame?(A.receiveFrameRate=de.receivedFrame.frameRate,A.receiveResolutionHeight=de.receivedFrame.height,A.receiveResolutionWidth=de.receivedFrame.width):U&&(A.receiveResolutionHeight=U._videoHeight||0,A.receiveResolutionWidth=U._videoWidth||0),de.framesRateFirefox!==void 0&&(A.receiveFrameRate=Math.round(de.framesRateFirefox)),A.receivePackets=de.packets,A.receivePacketsLost=de.packetsLost,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost);const Ae=E?E.totalFreezeTime:0,Ue=E?E.totalDuration:0;A.totalDuration=E?E.totalDuration+1:1,A.totalFreezeTime=(be=de.totalFreezesDuration)!==null&&be!==void 0?be:Ae||0,A.receiveDelay=de.jitterBufferMs||0;const He=!!Y&&t.getRemoteVideoIsReady(Y);de.totalFreezesDuration===void 0&&U&&He&&PE.isRemoteVideoFreeze(U,de,C)&&(A.totalFreezeTime+=1),A.freezeRate=Math.max(0,Math.min((A.totalFreezeTime-Ae)/(A.totalDuration-Ue),1))}ne&&(R.end2EndDelay=ne.B_ad,A.end2EndDelay=ne.B_vd,R.transportDelay=ne.B_ed,A.transportDelay=ne.B_ed,R.currentPacketLossRate=ne.B_ealr4/100,A.currentPacketLossRate=ne.B_evlr4/100,B.uplinkNetworkQuality=ne.B_punq?ne.B_punq:0,B.downlinkNetworkQuality=ne.B_pdnq?ne.B_pdnq:0),this.remoteStats.set(d,{audioStats:R,videoStats:A,videoPcStats:de,networkStats:B}),L&&this.exceptionMonitor.setRemoteAudioStats(L,R),U&&this.exceptionMonitor.setRemoteVideoStats(U,A)}))}}class j5{constructor(){H(this,"destChannelMediaInfos",new Map),H(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){qV(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){qV(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){vT(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function L5(e){if(!(e instanceof j5))return new Ce(J.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new Ce(J.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new Ce(J.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Mh{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){H(this,"uid",void 0),H(this,"_uintid",void 0),H(this,"_trust_in_room_",!0),H(this,"_trust_audio_enabled_state_",!0),H(this,"_trust_video_enabled_state_",!0),H(this,"_trust_audio_mute_state_",!0),H(this,"_trust_video_mute_state_",!0),H(this,"_audio_muted_",!1),H(this,"_video_muted_",!1),H(this,"_audio_enabled_",!0),H(this,"_video_enabled_",!0),H(this,"_audio_added_",!1),H(this,"_video_added_",!1),H(this,"_is_pre_created",!1),H(this,"_video_pre_subscribed",!1),H(this,"_audio_pre_subscribed",!1),H(this,"_trust_video_stream_added_state_",!0),H(this,"_trust_audio_stream_added_state_",!0),H(this,"_audioTrack",void 0),H(this,"_videoTrack",void 0),H(this,"_dataChannels",[]),H(this,"_audioSSRC",void 0),H(this,"_videoSSRC",void 0),H(this,"_audioOrtc",void 0),H(this,"_videoOrtc",void 0),H(this,"_cname",void 0),H(this,"_rtxSsrcId",void 0),H(this,"_videoMid",void 0),H(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function M5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function u1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const DT="9",h1=2e4,jT=4e4;function U5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function hu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}var q_=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(q_||{});const LT=new Map;function F5(e,t,r,s){let{scale:c}=e;if(c===0&&s===q_.UP||c>=t.length-1&&s===q_.DOWN)return e;let d=hu(hu({},e),{},{scale:s===q_.DOWN?++c:--c});switch(r){case"maintain-framerate":d=hu(hu({},d),t[c].motion);break;case"maintain-resolution":d=hu(hu({},d),t[c].detail);break;case"balanced":d=hu(hu({},d),t[c].balanced)}return d}function V5(e,t){if(t){const r={overUse:0,underUse:0,adaptationList:B5(t)};LT.set(e,r)}else LT.delete(e)}function B5(e){const t=hu({},e),{bitrateMax:r,frameRate:s,scaleResolutionDownBy:c,bitrateMin:d}=t,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:E,BWE_SCALE_UP_THRESHOLD:C,BWE_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_UP_THRESHOLD:B,BALANCE_BITRATE_FACTOR:L,BALANCE_FRAMERATE_FACTOR:U,BALANCE_RESOLUTION_FACTOR:X,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:ee,DETAIL_FRAMERATE_FACTOR:ue,DETAIL_BITRATE_FACTOR:de}=dO,ne=Math.min(t.frameRate,f),be=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(R,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(A,1)*ne),fps_up:s},balanced:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:r,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:r,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:s,bitrateMax:r,bitrateMin:d}}];for(let Ae=1;Ae<=g;Ae++){const Ue={bwe_up:Math.round(Math.pow(C,Ae)*r),bwe_down:Math.round(Math.pow(R,Ae+1)*r),fps_up:Math.round(Math.pow(B,Ae)*ne),fps_down:Math.round(Math.pow(A,Ae+1)*ne)},He={scaleResolutionDownBy:c/Math.pow(X,Ae),frameRate:Math.max(Math.round(Math.pow(U,Ae)*s),h),bitrateMax:Math.max(Math.round(Math.pow(L,Ae)*r),E),bitrateMin:Math.max(Math.round(Math.pow(L,Ae)*d),v)},Yt={scaleResolutionDownBy:c/Math.pow(Y,Ae),frameRate:s,bitrateMax:Math.max(Math.round(Math.pow(ee,Ae)*r),E),bitrateMin:Math.max(Math.round(Math.pow(ee,Ae)*d),v)},Qt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ue,Ae)*s),h),bitrateMax:Math.max(Math.round(Math.pow(de,Ae)*r),E),bitrateMin:Math.max(Math.round(Math.pow(de,Ae)*d),v)};be.push({scale:Ae,threshold:Ue,balanced:He,motion:Yt,detail:Qt})}return be}function xne(e,t,r,s,c,d){const h=LT.get(e)||{overUse:0,underUse:0,adaptationList:B5(c)},{adaptationList:f}=h;LT.set(e,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:v}=dO,{scale:E}=s;let C,R;return typeof t=="number"&&t>0&&(function(A,B,L,U){if(B>=L.length)return!1;let{threshold:{fps_down:X}}=L[B];return Z("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&(X=L[0].threshold.fps_down),A<X})(t,E,f,d)&&(h.overUse++,R=gE.CPU,h.overUse>g)||typeof r=="number"&&r>0&&(function(A,B,L){if(B>=L.length)return!1;const{threshold:{bwe_down:U}}=L[B];return A<U})(r,E,f)&&(h.overUse++,R=gE.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,C=F5(s,f,d,q_.DOWN),[C,R]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&(function(A,B,L,U){if(B===0)return;let{threshold:{fps_up:X}}=L[B];return Z("FORCE_AG_HIGH_FRAMERATE")&&U==="maintain-framerate"&&(X=L[1].threshold.fps_up),A>X})(t,E,f,d)&&(function(A,B,L){if(B===0)return;const{threshold:{bwe_up:U}}=L[B];return A>U})(r,E,f)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,C=F5(s,f,d,q_.UP),C.scale===0&&(R=gE.NONE))),[C,R])}function W5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function p1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const MT=new Map;function UT(e,t){const r=MT.get(e);if(r){const{timer:s}=r;window.clearTimeout(s),MT.delete(e)}t.qualityLimitationReason=gE.NONE,V5(e)}function Tne(e,t){var r;let s;switch(t){case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoTrack:s=$e(r=e._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalVideoLowTrack:s=Mr.Low}return s}function f1(e){const t=vr();if(e.some((r=>r._bypassWebAudio)))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function m1(e,t){f1(e);const r=new Xn;return e.forEach((s=>r.addAudioTrack(s))),r}const Cne=!vr().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&au();function FT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return Cne?(r={spec:t,store:e},uu("PlanBConnection").create(r)):new Ao(t,e)}function g1(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function q5(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(pE(e.turnServer.servers))return!1;if(Z("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((t=>t.forceturn)))return!0}return!1}catch{return!1}}var mr;function G5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function ul(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}let Ao=(mr=class cm extends zV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var r;return $e(r=Object.keys(yE)).call(r,t)})))]}constructor(t,r){super(t,r),H(this,"id",zr(5,"connection-")),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"forceTurn",!1),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"transportEventReceiver",void 0),H(this,"statsFilter",void 0),H(this,"extension",{useXR:Z("USE_XR")}),H(this,"localCapabilities",void 0),H(this,"remoteCodecs",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"isPreallocation",!1),H(this,"preMediaMap",new Map),H(this,"dataStreamChannelMap",new Map),H(this,"establishPromise",void 0),H(this,"recoveredDataChannelIds",[]),H(this,"currentDataChannelId",1),H(this,"supportAV1RtpSpec",!1),H(this,"mutex",void 0),H(this,"qualityLimitationReason",gE.NONE),H(this,"isFirstConnected",!1),this.store=r,this.forceTurn=q5(t),this.mutex=new Xs("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(cm.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=oO(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void k.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else k.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ph(s.sdp),d=await h5({filterRTX:!Z("USE_PUB_RTX")&&!Z("USE_SUB_RTX"),filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterVideoCodec:Z("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:Z("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:Z("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=AT(d),this.initialOffer=s,Z("ENABLE_SVC")&&this.store.codec=="av1"){const f=await(async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Zx.L1T3}]});const v=await g.createOffer();if(!v.sdp)return void g.close();const E=aa(v.sdp).mediaDescriptions[0];if(!E)return;const C=E.attributes.extmaps.find((R=>R.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return g.close(),C}catch{return}})();var t;f&&(this.supportAV1RtpSpec=!0,(t=d.send)===null||t===void 0||t.videoExtensions.push(f))}let h;return s.sdp&&g5(s.sdp)&&(h=hn(d),(r=h).send&&(U_(ot.VIDEO,r.send.videoExtensions),U_(ot.AUDIO,r.send.audioExtensions)),r.recv&&(U_(ot.VIDEO,r.recv.videoExtensions),U_(ot.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(U_(ot.VIDEO,r.sendrecv.videoExtensions),U_(ot.AUDIO,r.sendrecv.audioExtensions))),ul(ul({},c),{},{rtpCapabilities:h||d,offerSDP:s.sdp})}catch(s){throw new Ne(J.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&g5(this.initialOffer.sdp)&&(r=t.rtpCapabilities,s=this.localCapabilities,r.send&&(CT(ot.VIDEO,r.send.videoExtensions,s.send.videoExtensions),CT(ot.AUDIO,r.send.audioExtensions,s.send.audioExtensions)),r.recv&&(CT(ot.VIDEO,r.recv.videoExtensions,s.recv.videoExtensions),CT(ot.AUDIO,r.recv.audioExtensions,s.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return hn(this._localCapabilities)}get rtpCapabilities(){return hn(this._rtpCapabilities)}get candidates(){return hn(this._candidates)}get iceParameters(){return hn(this._iceParameters)}get dtlsParameters(){return hn(this._dtlsParameters)}constructor(g){let v=arguments.length>1&&arguments[1]!==void 0&&arguments[1],E=arguments.length>2&&arguments[2]!==void 0&&arguments[2];H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_originCandidates",void 0),H(this,"_iceParameters",void 0),H(this,"_isUseExtmapAllowMixed",void 0),H(this,"_isUseLocalCodecs",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),H(this,"useLocalCodecsMids",[]),H(this,"preloadSsrcs",[]),H(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=v,this._isUseLocalCodecs=E,g=hn(g);const{iceParameters:C,dtlsParameters:R,candidates:A,rtpCapabilities:B,setup:L,localCapabilities:U,cname:X}=g;this._rtpCapabilities=B,this._candidates=A,this._originCandidates=hn(A),this._iceParameters=C,this._dtlsParameters=R,this._localCapabilities=U,this.setup=L,this.cname=X,[this.sessionDesc]=this.updateRemoteRTPCapabilities(B),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every((v=>{var E;return $e(E=this.preloadSsrcs).call(E,v)}))}preloadRemoteMedia(g){let v=0;const E=[],C=[];for(;g>0;){const R=[u1({ssrcId:jT+v},Z("USE_SUB_RTX")?{rtx:jT+v+1}:{})],A="".concat(jT+v,"_").concat(h1+v),{ssrcs:B,ssrcGroups:L}=AE(R,this.cname,Z("SYNC_GROUP")?A:void 0),U=this.preCreateOrRecycleSendMedia("video",B,L,void 0),X=[{ssrcId:h1+v}],Y="".concat(jT+v,"_").concat(h1+v),{ssrcs:ee,ssrcGroups:ue}=AE(X,this.cname,Z("SYNC_GROUP")?Y:void 0),de=this.preCreateOrRecycleSendMedia("audio",ee,ue,void 0);g--,v+=2,E.push(U,de),C.push(B[0].ssrcId,ee[0].ssrcId)}return this.useLocalCodecsMids.push(...E),this.preloadSsrcs=C,{mids:E,preSSRCs:C,isAvailable:!0}}preCreateOrRecycleSendMedia(g,v,E,C){const R=this.rtpCapabilities.send.videoCodecs,A=this._isUseLocalCodecs||R.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;k.debug("create or recycle send media without remote rtp capabilities, ssrcs ",v[0].ssrcId);const B=g===ot.VIDEO?A.videoCodecs:A.audioCodecs,L=g===ot.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const U="".concat(this.currentMidIndex);let X={media:{mediaType:g,port:DT,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map((Y=>Y.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:L,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(U)}};return X=this.mungSendMediaDesc(X,C),this.sessionDesc.mediaDescriptions.push(X),this.updateBundleMids(),U}toString(){return Rh(this.sessionDesc)}send(g,v,E,C){const{ssrcs:R,ssrcGroups:A}=AE(v,this.cname,Z("SYNC_GROUP")?E:void 0),B=this.findPreloadMediaDesc(R);if(B){if(Sn()&&this.firefoxSsrcMidMap.set(R[0].ssrcId,B.attributes.mid),C&&(C.twcc||C.remb)){const L=this.sessionDesc.mediaDescriptions.indexOf(B);return this.sessionDesc.mediaDescriptions[L]=this.mungSendMediaDesc(B,C),{mid:B.attributes.mid,needExchangeSDP:!0}}return{mid:B.attributes.mid,needExchangeSDP:!1}}{const L=this.findAvailableMediaIndex(g,R);let U;return L===-1||L===1&&(Us()||(function(){const X=fr();return!(X.name!==br.CHROME||!X.osVersion)&&Number(X.version)<=90})()||Z("ENABLE_ENCODED_TRANSFORM")&&iu())||L===0&&!(function(X){const Y=fr();return!(Y.name!==br.FIREFOX||!Y.osVersion)&&Number(Y.version)===X})(138)&&Z("USE_SUB_RTX")||F4()?(U=this.createOrRecycleSendMedia(g,R,A,"sendonly",C),this.updateBundleMids()):(U=hn(this.sessionDesc.mediaDescriptions[L]),U.attributes.direction="sendonly",U.attributes.ssrcs=R,U.attributes.ssrcGroups=A,this.sessionDesc.mediaDescriptions[L]=this.mungSendMediaDesc(U,C)),Sn()&&this.firefoxSsrcMidMap.set(R[0].ssrcId,U.attributes.mid),{mid:U.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:v}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:v}}batchSend(g){const v=g.map((R=>{let{kind:A,ssrcMsg:B,mslabel:L}=R;return this.send(A,B,L)})),E=[];let C=!1;return v.forEach((R=>{let{mid:A,needExchangeSDP:B}=R;B&&(C=!0),E.push(A)})),{mids:E,needExchangeSDP:C}}stopSending(g){const v=this.sessionDesc.mediaDescriptions.filter((E=>E.attributes.mid&&g.indexOf(E.attributes.mid)!==-1));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");v.forEach((E=>{E.attributes.mid==="0"||Sn()||F4()?E.attributes.ssrcs=[]:(E.attributes.ssrcs=[],E.attributes.direction="inactive",E.media.port="0")})),this.updateBundleMids()}mute(g){const v=this.sessionDesc.mediaDescriptions.find((E=>E.attributes.mid===g));if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));v.attributes.direction="inactive"}unmute(g){const v=this.sessionDesc.mediaDescriptions.find((E=>E.attributes.mid===g));if(!v)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));v.attributes.direction="sendonly"}muteRemote(g){const v=this.sessionDesc.mediaDescriptions.filter((E=>$e(g).call(g,E.attributes.mid||"")));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");v.forEach((E=>{E.attributes.direction="inactive"}))}unmuteRemote(g){const v=this.sessionDesc.mediaDescriptions.filter((E=>$e(g).call(g,E.attributes.mid||"")));if(v.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");v.forEach((E=>{E.attributes.direction="recvonly"}))}receive(g,v,E,C){g.forEach(((R,A)=>{this.createOrRecycleRecvMedia(R,[],"recvonly",v,E,C[A])})),this.updateBundleMids()}stopReceiving(g){const v=this.sessionDesc.mediaDescriptions.filter((E=>g.indexOf(E.attributes.mid)!==-1));if(v.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");v.forEach((E=>{E.media.port="0",E.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const v=this.sessionDesc||aa((E=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(E?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var E;this._rtpCapabilities=g;let C=!1;const R=this.rtpCapabilities.send,A=this.localCapabilities.send,B=this.localCapabilities.recv,L=B.videoCodecs,U=B.audioCodecs,X=B.videoExtensions,Y=B.audioExtensions;for(const ne of v.mediaDescriptions){var ee;if(ne.attributes.direction!=="sendonly"||typeof ne.attributes.mid!="string"||!$e(ee=this.useLocalCodecsMids).call(ee,ne.attributes.mid)){if(C=!0,ne.attributes.iceUfrag=this._iceParameters.iceUfrag,ne.attributes.icePwd=this._iceParameters.icePwd,ne.attributes.fingerprints=this._dtlsParameters.fingerprints,ne.attributes.candidates=this._candidates,ne.attributes.setup=this.setup,ne.media.mediaType==="application"&&(ne.attributes.sctpPort="5000"),ne.media.mediaType==="video")if(this._isUseLocalCodecs&&ne.attributes.direction==="sendonly"){var ue;ne.media.fmts=L.map((Ae=>Ae.payloadType.toString(10))),ne.attributes.payloads=L,ne.attributes.extmaps=X;const be=ne.attributes.mid;typeof be!="string"||$e(ue=this.useLocalCodecsMids).call(ue,be)||this.useLocalCodecsMids.push(be)}else if(R.videoCodecs.length===0){const be=A.videoCodecs.filter((Ae=>{var Ue,He;return(Ue=Ae.rtpMap)===null||Ue===void 0?void 0:$e(He=Ue.encodingName.toLowerCase()).call(He,"vp8")}))||[A.videoCodecs[0]];ne.media.fmts=be.map((Ae=>Ae.payloadType.toString(10))),ne.attributes.payloads=be,ne.attributes.extmaps=[]}else ne.media.fmts=R.videoCodecs.map((be=>be.payloadType.toString(10))),ne.attributes.payloads=R.videoCodecs,ne.attributes.extmaps=R.videoExtensions;if(ne.media.mediaType==="audio")if(this._isUseLocalCodecs&&ne.attributes.direction==="sendonly"){var de;ne.media.fmts=U.map((Ae=>Ae.payloadType.toString(10))),ne.attributes.payloads=U,ne.attributes.extmaps=Y;const be=ne.attributes.mid;typeof be!="string"||$e(de=this.useLocalCodecsMids).call(de,be)||this.useLocalCodecsMids.push(be)}else if(R.audioCodecs.length===0){const be=A.audioCodecs.filter((Ae=>{var Ue,He;return(Ue=Ae.rtpMap)===null||Ue===void 0?void 0:$e(He=Ue.encodingName.toLowerCase()).call(He,"opus")}))||[A.audioCodecs[0]];ne.media.fmts=be.map((Ae=>Ae.payloadType.toString(10))),ne.attributes.payloads=be,ne.attributes.extmaps=[]}else ne.media.fmts=R.audioCodecs.map((be=>be.payloadType.toString(10))),ne.attributes.payloads=R.audioCodecs,ne.attributes.extmaps=R.audioExtensions,V_(ne)}}return this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1,[this.sessionDesc,C]}updateCandidates(g){const v=this._originCandidates.filter((C=>C.transport==="udp")),E=[];if(v.forEach((C=>{E.push(u1(u1({},C),{},{foundation:"tcpcandidate",priority:Number(C.priority)-1+"",transport:"tcp",port:Number(C.port)+90+""}))})),v.length!==0){switch(g){case Zs.TCP_RELAY:this._candidates=E;break;case Zs.UDP_TCP_RELAY:case Zs.RELAY:this._candidates=[...v,...E];break;default:this._candidates=v}for(const C of this.sessionDesc.mediaDescriptions)C.attributes.candidates=this.candidates}}restartICE(g){g=hn(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach((v=>{v.attributes.iceUfrag=g.iceUfrag,v.attributes.icePwd=g.icePwd}))}predictReceivingMids(g){const v=[];for(let E=0;E<g;E++)v.push((this.currentMidIndex+E+1).toString(10));return v}findAvailableMediaIndex(g,v){return this.sessionDesc.mediaDescriptions.findIndex((E=>{const C=E.media.mediaType===g&&E.media.port!=="0"&&(E.attributes.direction==="sendonly"||E.attributes.direction==="sendrecv")&&E.attributes.ssrcs.length===0;if(Sn()){if(C){const R=this.firefoxSsrcMidMap.get(v[0].ssrcId);return!(R||E.attributes.mid!=="0"&&E.attributes.mid!=="1")||!(!R||R!==E.attributes.mid)}return!1}return C}))}createOrRecycleDataChannel(){for(const E of this.sessionDesc.mediaDescriptions)if(E.media.mediaType==="application")return{mediaDesc:E,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),v={media:{mediaType:"application",port:DT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(v),{mediaDesc:v,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,v,E,C,R,A){const B=g._mediaStreamTrack.kind,L=this.rtpCapabilities.recv,U=IE(B,L,this.localCapabilities.send,B===ot.VIDEO?C:R),X=B===ot.VIDEO?L.videoExtensions:L.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let ee={media:{mediaType:B,port:DT,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map((de=>de.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:X,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:E,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};ee=this.mungRecvMediaDsec(ee,g,A);const ue=this.findFirstClosedMedia(B);if(ue){const de=this.sessionDesc.mediaDescriptions.indexOf(ue);this.sessionDesc.mediaDescriptions[de]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateRemoteDtlsParameters(g){const v=new Set(this._dtlsParameters.fingerprints.map((R=>R.fingerprint))),E=new Set(g.map((R=>R.fingerprint)));let C=!1;v.size!==E.size&&(C=!0);for(const R of v)E.has(R)||(C=!0);return C}updateRemoteCodec(g,v,E){const C=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLowerCase()||"")).filter((ee=>{var ue;return $e(ue=Object.keys(yE)).call(ue,ee)})))],R=new Set(v);if(C.every((ee=>R.has(ee))))return k.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(v)),!1;const A=this._rtpCapabilities.recv.videoCodecs.filter((ee=>v.some((ue=>{var de;return $e(de=ee.rtpMap&&ee.rtpMap.encodingName.toLowerCase()||"").call(de,ue)}))));if(A.length===0)return k.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(C," codecs: ").concat(v)),!1;const B=[...new Set(A.map((ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLowerCase()||"")))];let L;if(k.debug("updateRemoteCodec, from ".concat(C," to ").concat(B)),g.length===0)L=this.sessionDesc.mediaDescriptions.filter((ee=>ee.media.mediaType==="video"&&ee.attributes.direction==="recvonly"));else if(L=this.sessionDesc.mediaDescriptions.filter((ee=>ee.attributes.mid&&ee.media.mediaType==="video"&&$e(g).call(g,ee.attributes.mid)&&ee.attributes.direction==="recvonly")),L.length!==g.length)return k.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(v)),!1;if(Z("USE_PUB_RTX")||Z("USE_SUB_RTX")){const ee=Dh(A,this.rtpCapabilities.recv.videoCodecs);A.push(...ee)}this._rtpCapabilities.recv.videoCodecs=A;const U=this.localCapabilities.send,X=this.rtpCapabilities.recv,Y=IE(ot.VIDEO,X,U,E);return L.forEach((ee=>{const ue=Y.map((de=>de.payloadType.toString(10)));k.debug("updateRemoteCodec mid: ".concat(ee.attributes.mid,", from"),ee.attributes.payloads,"to",Y),ee.attributes.payloads=Y,ee.media.fmts=ue})),!0}createOrRecycleSendMedia(g,v,E,C,R){const A=this.rtpCapabilities.send.videoCodecs,B=this._isUseLocalCodecs||A.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,L=g===ot.VIDEO?B.videoCodecs:B.audioCodecs,U=g===ot.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const X="".concat(this.currentMidIndex);let Y={media:{mediaType:g,port:DT,protos:["UDP","TLS","RTP","SAVPF"],fmts:L.map((ue=>ue.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:L,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:C,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(X)}};Y=this.mungSendMediaDesc(Y,R);const ee=this.findFirstClosedMedia(g);if(ee){const ue=this.sessionDesc.mediaDescriptions.indexOf(ee);this.sessionDesc.mediaDescriptions[ue]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((g=>g.media.port!=="0")).map((g=>g.attributes.mid))}mungRecvMediaDsec(g,v,E){const C=hn(g);return QO(C),F_(C,v),ZO(C,v),d5(C),NT(C,E,this.localCapabilities.send),C}mungSendMediaDesc(g,v){const E=hn(g);return NT(E,v,this.localCapabilities.recv),V_(E),E}updateRecvMedia(g,v){const E=this.sessionDesc.mediaDescriptions.findIndex((C=>C.attributes.mid===g));if(E!==-1){const C=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[E],v);this.sessionDesc.mediaDescriptions[E]=C}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find((v=>Sn()?v.media.port==="0"&&v.media.mediaType===g:v.media.port==="0"))}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find((v=>{var E;return((E=v.attributes)===null||E===void 0||(E=E.ssrcs[0])===null||E===void 0?void 0:E.ssrcId)===g[0].ssrcId}))}getSSRC(g){var v;return(v=this.sessionDesc.mediaDescriptions.find((E=>E.attributes.mid===g)))===null||v===void 0?void 0:v.attributes.ssrcs}}(ul(ul({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!Z("ENABLE_PRE_SUB_WITH_PRE_PC")||!Z("PRE_USE_LOCAL_CODECS"))&&mO(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=f5(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const f=this.peerConnection.getTransceivers()[0];if(f!=null&&f.receiver&&this.tryBindTransportEvents(f.receiver),mO(this.store))if(t.preallocation&&Z("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=Z("PRE_SUB_NUM"),{mids:v,preSSRCs:E}=this.remoteSDP.preloadRemoteMedia(g);await jh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(E)),this.presetMedia(v,E)}else{const{preSSRCs:g=[]}=t,v=g.map((C=>C.ssrcMsg[0].ssrcId));if(g.length===0)return;const{mids:E}=this.remoteSDP.batchSend(g.map((C=>Object.assign({},C))));await jh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(v)),this.presetMedia(E,v)}}catch(c){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var r,s}presetMedia(t,r){t.forEach(((s,c)=>{this.peerConnection.getTransceivers().forEach((d=>{if(d.mid!=null&&s===d.mid&&d.receiver.track){const h=d.receiver.track;let f;h.kind==="video"&&Z("ENABLE_PRE_RENDER")&&(f=new NO({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(zr(5,""))},!0),f.updateVideoTrack(h),f.onFirstVideoFrameRender=()=>{var g;const v=this.preMediaMap.get(r[c]);v&&(v.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,r[c])},f.play(this.store.sessionId||void 0)),this.preMediaMap.set(r[c],{mid:s,track:h,player:f,transceiver:d})}})),this.store.peerReceiver()}))}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let r=!1;const{rtpCapabilities:s}=t;if([,r]=this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);r=r||h}const{preSSRCs:c=[]}=t,d=c.map((h=>h.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],f=[];if(Array.from(this.preMediaMap.entries()).every((g=>{let[v,{mid:E,player:C,track:R}]=g;return h.push(E),f.push(v),this.preMediaMap.delete(v),C&&C.destroy(),!0})),h.length>0&&(this.remoteSDP.stopSending(h),await jh(this.peerConnection,this.remoteSDP,this.extension),k.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(f)),ft.reportApiInvoke(this.store.sessionId,{name:In.PRELOAD_MEDIA_FAILED,options:[c,f],tag:un.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map((v=>Object.assign({},v))));await jh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}r?(await jh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):k.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,s){var c=this;return So((function*(){const d=yield yr(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=TT();t.forEach((U=>{const X=c.peerConnection.addTransceiver(U._mediaStreamTrack,ul({direction:"sendonly"},U.trackMediaType==="video"&&c.supportAV1RtpSpec&&f?{sendEncodings:[{scalabilityMode:f}]}:{}));h.push(X),U._updateRtpTransceiver(X)})),Sn()&&Z("SIMULCAST")===!0&&(yield yr(c.applySimulcastForFirefox(h,t)));const g=yield yr(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(t.length),E=c.mungSendOfferSDP(g.sdp,t,v),C=aa(E),R=v.map((U=>{const X=C.mediaDescriptions.find((Y=>Y.attributes.mid===U));if(!X)throw new Error("Cannot extract ssrc from mediaDescription.");return o5(X,Z("USE_PUB_RTX"))}));let A;try{A=yield R}catch(U){A=[],c.remoteSDP.receive(t,r,s,A);const X=c.remoteSDP.toString();throw yield yr(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield yr(c.peerConnection.setRemoteDescription({type:"answer",sdp:X})),yield yr(c.stopSending(v,!0)),U}c.remoteSDP.receive(t,r,s,A);const B=c.remoteSDP.toString(),L=c.logSDPExchange(E,"offer","local","send");return yield yr(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield yr(c.applySimulcastEncodings(h,t)),yield yr(c.applySendEncodings(h,t)),L==null||L(B),yield yr(c.peerConnection.setRemoteDescription({type:"answer",sdp:B})),h.map(((U,X)=>{const Y=v[X];return{localSSRC:R[X],id:Y,transceiver:U}}))}catch(h){throw h instanceof Ne?h:new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}}))()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let s=this.dataStreamChannelMap.get(t);if(s&&s.readyState==="open")k.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");s=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:Z("DATASTREAM_MAX_RETRANSMITS")}),s.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,s)}r.forEach((d=>{d._updateOriginDataChannel(s)}));const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),k.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else k.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(s){throw s instanceof Ne?s:new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(s.toString()))}}async stopDataChannels(t){try{const r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof Ne?r:new Ne(J.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){const s=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter((g=>t.indexOf(g.mid)!==-1));if(c.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map((g=>{var v;UT(this.id+g.mid,this),g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)}));const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(t,r,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,s,c);h&&(await jh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const f=this.peerConnection.getTransceivers().find((g=>g.mid===d));if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:d,transceiver:f}}catch(d){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:r,needExchangeSDP:s}=this.remoteSDP.batchSend(t);return s&&(await jh(this.peerConnection,this.remoteSDP,this.extension),k.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map((c=>{const d=this.peerConnection.getTransceivers().find((h=>h.mid===c));if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}}))}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach((d=>{Array.from(this.preMediaMap.entries()).some((h=>{let[f,{mid:g,player:v}]=h;if(g===d)return this.preMediaMap.delete(f),v&&v.destroy(),!0}))})),this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const r=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const r=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((h=>{h.direction="inactive"}));const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((async(h,f)=>{h.direction="sendonly"}));const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return So((function*(){const s=yield yr(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=vr().supportPCSetConfiguration,d=Z("FORCE_TURN_TCP")||r.forceTurn;if(t===Zs.RELAY&&!c)return;if(c&&!d){const C=t===Zs.RELAY?"relay":"all",R=r.peerConnection.getConfiguration();R.iceTransportPolicy!==C&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(R.iceTransportPolicy,"] to [").concat(C,"]")),R.iceTransportPolicy=C,r.peerConnection.setConfiguration(R))}r.remoteSDP.updateCandidates(t);const h=yield yr(r.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const f=Ph(h.sdp),{remoteIceParameters:g}=yield f.iceParameters;r.remoteSDP.restartICE(g);const v=r.remoteSDP.toString(),E=r.logSDPExchange(h.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield yr(r.peerConnection.setLocalDescription(h)),E==null||E(v),yield yr(r.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Zs.TCP_RELAY),await jh(this.peerConnection,this.remoteSDP,this.extension)}catch(r){k.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach((r=>{UT(this.id+r.mid,this)})),this.preMediaMap.forEach((r=>{let{player:s}=r;s&&s.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return ul(ul({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Ne(J.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,r){const s=this.peerConnection.getTransceivers().filter((c=>c.mid===t));s.length===1&&(this.isVP8Simulcast(r)?Sn()||await this.applySimulcastEncodings(s,[r]):await this.applySendEncodings(s,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const s=this.peerConnection.getTransceivers().find((c=>c.mid===r));s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:s,remote:c}=r.getSelectedCandidatePair();return{local:ul(ul({},cd),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:ul(ul({},cd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;const s="code: ".concat(t.errorCode,", message: ").concat(t.errorText),c=t.port?"local: ".concat(t.port):"",d=Ff(t.url||"");k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(s,"), url: ").concat(d||"",", host_candidate:").concat(c)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,s)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[]},s=t.cloudProxyServer||"disabled";return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(pE(t.turnServer.servers)?r.iceServers=t.turnServer.servers:Z("NEW_TURN_MODE")&&r.iceServers&&s==="disabled"?(Z("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...cm.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...cm.newTurnServerConfigToIceServers(t.turnServer.servers)),Z("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...cm.turnServerConfigToIceServers(t.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...cm.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Z("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((c=>{c.forceturn&&(r.iceTransportPolicy="relay")})))),Z("ENABLE_ENCODED_TRANSFORM")&&vr().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach((s=>{s.security?s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Oh(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!Z("FORCE_TURN_TCP")&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))})),r}static newTurnServerConfigToIceServers(t){const r=[];return t.forEach((s=>{const c=Z("NEW_TURN_MODE");c===1?r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}):c===2?r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}):c===3?r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Oh(s.turnServerURL),":443?transport=tcp")}):c===4&&(r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=udp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":3478?transport=tcp")}),r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(Oh(s.turnServerURL),":443?transport=tcp")}))})),r}tryBindTransportEvents(t){const r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var c;r!=null&&r.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,r.state))},r.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const c=r==null?void 0:r.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,f=d.address+":"+d.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ff(h)),", remote ").concat(JSON.stringify(Ff(f))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var s,c;if(r||(r=this.peerConnection.getSenders().find((U=>U.track===t._mediaStreamTrack))),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vr().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(t._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const f=(function(L,U){return L.getTransceivers().find((X=>X.sender.track===U||X.receiver.track===U))})(this.peerConnection,t._mediaStreamTrack),g=ure(t);if((function(L){var U;return!(!Z("ENABLE_AG_ADAPTATION")||!(L instanceof cT||$e(U=L._hints).call(U,Hr.CUSTOM_TRACK))||!Z("FORCE_SUPPORT_AG_ADAPTATION")&&!(M4(14,0,!1)&&U4(17,4)||L4(14)&&GI(17,4,!0)))})(t)&&f&&r&&g&&this.getLocalVideoStats&&$e(s=["vp8","vp9"]).call(s,this.store.codec)){var v;const L=d.degradationPreference||($e(v=t._hints).call(v,Hr.CUSTOM_TRACK)?Z("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(U,X,Y,ee,ue,de){if(UT(U,Y),ue(X),ee!=="balanced"&&ee!=="maintain-framerate"&&ee!=="maintain-resolution")return;let ne=-1;V5(U,X);const be=window.setInterval((()=>{const Ue=MT.get(U);if(!Z("ENABLE_AG_ADAPTATION")||!Ue)return UT(U,Y),void ue(X);const He=de();if(He.sendPackets>0&&He.OutgoingAvailableBandwidth>0){if(ne===-1)return void(ne=Date.now());if(Date.now()-ne<1e3)return;const Yt=He.sendFrameRate,Qt=He.OutgoingAvailableBandwidth,[Lt,Ir]=xne(U,Yt,Qt,Ue.adaptationConfig,X,ee);Ir&&(Y.qualityLimitationReason=Ir),Lt&&Ue.adaptationConfig.scale!==Lt.scale&&(k.debug("[".concat(U,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(Yt,", bwe ").concat(Qt,", switch from ").concat(Ue.adaptationConfig.scale," to ").concat(Lt.scale," ")),Ue.adaptationConfig=p1(p1({},Ue.adaptationConfig),Lt),ue(Lt))}}),Z("CHECK_LOCAL_STATS_INTERVAL")),Ae=p1({},X);MT.set(U,{timer:be,adaptationConfig:Ae,originConfig:X,adaptationFunc:ue}),k.debug("[".concat(U,"] start adaptation, originConfig: ").concat(JSON.stringify(X),", degradationPreference: ").concat(ee))})(this.id+f.mid,g,this,L,(U=>{r&&this.updateAdaptation(r,U)}),this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var E;const{bitrateMax:L,frameRate:U,scaleResolutionDownBy:X}=t._encoderConfig;L&&(h.maxBitrate=1e3*L),($e(E=t._hints).call(E,Hr.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(U&&(h.maxFramerate=Na(U)),X&&X>=1&&(h.scaleResolutionDownBy=X))}const{maxFramerate:C}=Z("ENCODER_CONFIG_LIMIT");if(C&&typeof C=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,C):C),Z("DSCP_TYPE")&&au()){var R;const L=Z("DSCP_TYPE");$e(R=["very-low","low","medium","high"]).call(R,L)&&(h.networkPriority=L)}const A=r.getParameters(),B=(c=A.encodings)===null||c===void 0?void 0:c[0];Sn()&&!B&&(d.encodings=[h]),B&&Object.assign(B,h),Object.assign(A,d),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await r.setParameters(A),await(async function(L,U,X){try{var Y;if(!vr().supportSetRtpSenderParameters||!(function(be){return be==="vp9"||be==="av1"})(L)||!Z("ENABLE_SVC"))return;const ee={},ue={},de=U.getParameters(),ne=(Y=de.encodings)===null||Y===void 0?void 0:Y[0];ue.scalabilityMode=TT(X),ne&&Object.assign(ne,ue),Object.assign(de,ee),await U.setParameters(de),k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(de.encodings)))}catch(ee){k.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ee)}})(this.store.codec,r,Z("SVC_MODE"))}async updateAdaptation(t,r){var s,c;if(!t)return k.debug("[updateAdaptation] no rtpSender found");if(!vr().supportSetRtpSenderParameters)return k.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:f,scaleResolutionDownBy:g}=r;h&&(d.maxBitrate=1e3*h),f&&(d.maxFramerate=Na(f)),g&&g>=1&&$e(s=["vp8","vp9"]).call(s,this.store.codec)&&(d.scaleResolutionDownBy=g);const v=t.getParameters(),E=(c=v.encodings)===null||c===void 0?void 0:c[0];E&&Object.assign(E,d),Object.assign(v,{});try{await t.setParameters(v),k.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(C){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?k.debug("[updateAdaptation] peerConnection not connected}"):k.debug("[updateAdaptation] updateRtpSenderEncodings failed",C):k.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!vr().supportSetRtpSenderParameters||t.length!==r.length)return;for(let s=0;s<t.length;s++){const c=t[s],d=r[s];d instanceof tn&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,s){const c=aa(t);return r.forEach(((d,h)=>{const f=s[h],g=c.mediaDescriptions.find((v=>v.attributes.mid===f));g&&(F_(g,d),u5(g,d,this.store.codec))})),Rh(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var s,c,d,h,f;const v=t[g],E=r[g];if(E instanceof tn&&!$e(s=E._hints).call(s,Hr.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=E._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const C={},R={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:R.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:R.high}];const A=v.sender.getParameters();await v.sender.setParameters(Object.assign(A,C))}}}async applySimulcastEncodings(t,r){if(!Sn()&&t.length===r.length)for(let s=0;s<t.length;s++){const c=r[s];if(c instanceof tn&&this.isVP8Simulcast(c)){const d=t[s],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,s,c,d,h;return!!(t instanceof tn&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!$e(r=t._hints).call(r,Hr.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,s,c){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",s==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(vr().supportPCSetConfiguration){const r=cm.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}t.isPreallocation&&(this.isPreallocation=!0)}},ht(mr.prototype,"updateRemoteRTPCapabilities",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"updateRemoteRTPCapabilities"),mr.prototype),ht(mr.prototype,"connect",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"connect"),mr.prototype),ht(mr.prototype,"updateRemoteConnect",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"updateRemoteConnect"),mr.prototype),ht(mr.prototype,"createDataChannels",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"createDataChannels"),mr.prototype),ht(mr.prototype,"receive",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"receive"),mr.prototype),ht(mr.prototype,"batchReceive",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"batchReceive"),mr.prototype),ht(mr.prototype,"stopReceiving",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"stopReceiving"),mr.prototype),ht(mr.prototype,"muteRemote",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"muteRemote"),mr.prototype),ht(mr.prototype,"unmuteRemote",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"unmuteRemote"),mr.prototype),ht(mr.prototype,"muteLocal",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"muteLocal"),mr.prototype),ht(mr.prototype,"unmuteLocal",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"unmuteLocal"),mr.prototype),ht(mr.prototype,"close",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"close"),mr.prototype),ht(mr.prototype,"updateEncoderConfig",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"updateEncoderConfig"),mr.prototype),ht(mr.prototype,"updateSendParameters",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"updateSendParameters"),mr.prototype),ht(mr.prototype,"replaceTrack",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"replaceTrack"),mr.prototype),ht(mr.prototype,"updateAdaptation",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"updateAdaptation"),mr.prototype),ht(mr.prototype,"getRemoteSSRC",[Hi],Object.getOwnPropertyDescriptor(mr.prototype,"getRemoteSSRC"),mr.prototype),mr);function Hi(e,t,r){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},r}function _1(e,t){let r=document.createElement("video"),s=document.createElement("canvas");r.setAttribute("style","display:none"),s.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),s.width=Na(t.width),s.height=Na(t.height);const c=Na(t.framerate||15);document.body.append(r),document.body.append(s);let d=e._mediaStreamTrack;r.srcObject=new MediaStream([d]),r.play();const h=s.getContext("2d");if(!h)throw new Ce(J.UNEXPECTED_ERROR,"can not get canvas context");const f=vr(),g=s.captureStream(f.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=s),s.startCapture=()=>{if(!r)return s.stopCapture&&s.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){const E=r.videoWidth,C=r.videoHeight/E,R=s.width*C;Math.abs(R-s.height)>=2&&(k.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(R)),s.height=R)}h.drawImage(r,0,0,s.width,s.height),g.requestFrame&&g.requestFrame(),d!==e._mediaStreamTrack&&(d=e._mediaStreamTrack,r.srcObject=new MediaStream([d]))},s.stopCapture=bO((()=>s.startCapture&&s.startCapture()),c);const v=g.stop;return g.stop=()=>{v.call(g),r&&(r.remove(),r.srcObject=null,r=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),k.debug("clean low stream renderer")},g}var H5=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(H5||{}),hl=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(hl||{}),Vt=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(Vt||{}),Os=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})(Os||{}),Ki=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Ki||{}),VT=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(VT||{});const Bf=1e3,BT=6,DE=3,Rne=Math.max(BT,DE,60);function At(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function K5(e){const t={[Ki.CONN_TYPE]:0,[Ki.RTT]:e.rtt,[Ki.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[Ki.CONN_TYPE]=1),r==="tcp"&&(t[Ki.CONN_TYPE]=3),r==="tls"&&(t[Ki.CONN_TYPE]=4);break}case"srflx":t[Ki.CONN_TYPE]=2;break;case"unknown":t[Ki.CONN_TYPE]=5;break;default:t[Ki.CONN_TYPE]=0}return t}function z5(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class $5 extends _n{constructor(t){super(),H(this,"store",void 0),H(this,"uploadWRTCStatsTimer",void 0),H(this,"uploadOutboundDenoiserStatsTimer",void 0),H(this,"uploadExtStatsTimer",void 0),H(this,"uploadExtUsageStatsTimer",void 0),H(this,"uploadInboundExtStatsTimer",void 0),H(this,"requestStats",void 0),H(this,"requestTransportStats",void 0),H(this,"requestLocalMedia",void 0),H(this,"requestRemoteMedia",void 0),H(this,"requestAllTracks",void 0),H(this,"requestVideoIsReady",void 0),H(this,"requestUploadStats",void 0),H(this,"requestUpload",void 0),H(this,"uploadOutboundStarted",!1),H(this,"uploadInboundStarted",!1),H(this,"uploadTransportStarted",!1),H(this,"uploadBaseStatsStarted",!1),H(this,"uploadExtensionUsageStarted",!1),H(this,"lastRecvStats",void 0),H(this,"lastSendStats",void 0),H(this,"lastRefRecvStats",void 0),H(this,"lastRefSendStats",void 0),H(this,"lastNormalRecvStats",void 0),H(this,"lastNormalSendStats",void 0),H(this,"lastExtendStats",{}),H(this,"needUploadStats",{}),H(this,"needUploadRenderFreezeTime",!0),H(this,"lastUploadCompensateTime",-1),H(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const r=t%DE==0,s=t%BT==0,c=t%60==0;let d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var f;const g={};if(this.uploadTransportStarted&&d){const E=this.getTransportStats(d,h,r);E&&(g.misc=[E])}if(this.uploadOutboundStarted&&d){const E=this.getOutboundStats(d,s?this.lastNormalSendStats:void 0,r?this.lastRefSendStats:void 0,this.lastSendStats,c);E&&(g.outbound=[E])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(t);const E=this.getInboundStats(h,s?this.lastNormalRecvStats:void 0,r?this.lastRefRecvStats:void 0,this.lastRecvStats);E&&(g.inbound=E)}const v=(f=this.requestTransportStats)===null||f===void 0?void 0:f.call(this).connectState;v&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[VT.RTC_PEER_CONNECTION_STATE]=aO[v]):g.misc=[{addition:{[VT.RTC_PEER_CONNECTION_STATE]:aO[v]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[H5.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=d,s&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),r&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,s;const c=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(c&&((s=this.requestUploadStats)===null||s===void 0||s.call(this,{misc:[{addition:{[VT.RTC_PEER_CONNECTION_STATE]:aO[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===Rne+1&&(t=1)}),Bf)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const r=t%DE==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!r)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const s=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=s,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&d){const f=this.requestRemoteMedia()||[],g=[];f.forEach((v=>{let[E,C]=v;const R={peer:E.uid};if(E._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(E._videoSSRC)&&C.has(ot.VIDEO)&&E.videoTrack){const A=(function(B,L,U){if(!L.videoRecv.find((Y=>Y.ssrc===B)))return;const X={};if(U&&U._player){const Y=U._player,{renderFreezeAccTime2:ee,videoElementStatus:ue}=Y;if(ud.visibility==="visible"&&ue===Js.PLAYING&&vr().supportRequestVideoFrameCallback){const de=Math.min(6e3,ee);Y.renderFreezeAccTime2=Math.max(0,ee-de),At(X,hl.Video_Render_Freeze_Time_Render2,de),Z("USE_NEW_RENDER_FREEZE_TIME")&&At(X,hl.Video_Render_Freeze_Time_Render,de)}}return X})(E._videoSSRC,d,E.videoTrack);A&&(R.video=A)}R.video&&g.push(R)})),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,r,s){if(!this.requestStats)return;if(!s)return t.rtt==null?void 0:{addition:{[Ki.RTT]:t.rtt,[Ki.CONN_TYPE]:void 0,[Ki.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const c=K5(t);if(this.store.useP2P){if(r){const d=K5(r);c[Ki.CONN_TYPE]+=d[Ki.CONN_TYPE]<<3}c[Ki.CONN_TYPE]+=110}else c[Ki.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(t,r,s,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let f,g,v;return h.forEach((E=>{let[C,{track:R,ssrcs:A}]=E;switch(C){case We.LocalVideoLowTrack:case We.LocalVideoTrack:if(C===We.LocalVideoTrack){var B;const L=(function(ee,ue,de,ne,be,Ae){const Ue=ue.videoSend.find((Lt=>Lt.ssrc===ee));if(!Ue)return;const He={},{sentFrame:Yt,inputFrame:Qt}=Ue;if(ne&&(At(He,hl.Video_Send_Qp_Sum,Ue.qpSumPerFrame),Qt&&Yt)){const Lt=Qt.frameRate,Ir=Yt.frameRate;He[hl.Video_Send_Freeze]=(function(xr,ti){let Me=!0;return Me=!(xr<=5)&&(xr<=10?ti<3:xr<=20?ti<4:ti<5),Me})(Lt,Ir)?1:0}if(be){switch(Yt&&(At(He,Vt.Video_Send_Height,Yt.height),At(He,Vt.Video_Send_Width,Yt.width),At(He,Vt.Video_Send_Frame_Rate,Yt.frameRate)),He[Vt.Video_Send_Disabled]=de._originMediaStreamTrack&&!de._originMediaStreamTrack.enabled||de._mediaStreamTrack&&!de._mediaStreamTrack.enabled?1:0,Ue.adaptionChangeReason){case"none":He[Vt.Video_Send_Adaptation]=0;break;case"cpu":He[Vt.Video_Send_Adaptation]=1;break;case"bandwidth":He[Vt.Video_Send_Adaptation]=2;break;case"other":He[Vt.Video_Send_Adaptation]=3}let Lt=0;Ue.adaptionChangeReason&&(Lt+=z5(Ue.adaptionChangeReason)),ue.qualityLimitationReason&&(Lt+=z5(ue.qualityLimitationReason)<<3),He[Vt.Video_Send_Adaptation]=Lt,He[Vt.Video_Send_Player_Status]=EO[de._player?de._player.videoElementStatus:"uninit"],At(He,Vt.Video_Send_Nacks,Ue.nacksCount),At(He,Vt.Video_Send_Plis,Ue.plisCount),At(He,Vt.Video_Send_Firs,Ue.firsCount),At(He,Vt.Video_Send_Avg_Encode,Ue.avgEncodeMs),At(He,Vt.Video_Send_Huge_Frame_Sent,Ue.hugeFramesSent),At(He,Vt.Video_Send_Bytes_Retransmit,Ue.retransmittedBytesSent),At(He,Vt.Video_Send_Packages_Retransmit,Ue.retransmittedPacketsSent),At(He,Vt.Video_Send_Key_Frames_Encoded,Ue.keyFramesEncoded);const Ir=be.videoSend.find((xr=>xr.ssrc===ee));if(Ir){let xr=Bf*DE;Ir.timestamp&&Ue.timestamp&&(xr=Ue.timestamp-Ir.timestamp),Ir.packets!=null&&Ue.packets!=null&&At(He,Vt.Video_Send_Package_Rate,1e3*(Ue.packets-Ir.packets)/xr),Ue.packetsLost!=null&&Ir.packetsLost!=null&&At(He,Vt.Video_Send_Package_Lost,Ue.packetsLost-Ir.packetsLost),Ir.bytes!=null&&Ue.bytes!=null&&At(He,Vt.Video_Send_Bitrate,8*(Ue.bytes-Ir.bytes)/xr)}}return He})(A[0].ssrcId,t,R,r,s),U=R.__className__==="CameraVideoTrack"?3:$e(B=R._hints).call(B,Hr.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==U||d)&&(this.needUploadStats={sendType:U},this.lastExtendStats.sendType=U);const X=R&&(function(ee,ue,de,ne){const be=ue.videoSend.find((Ue=>Ue.ssrc===ee));if(!be)return null;const Ae={};if(ne){const Ue=be.inputFrame,He=Ue&&Ue.height||de.videoHeight||0,Yt=Ue&&Ue.width||de.videoWidth||0,Qt=Ue&&Ue.frameRate||0;At(Ae,Vt.Video_Capture_Height,He),At(Ae,Vt.Video_Capture_Width,Yt),At(Ae,Vt.Video_Capture_Frame_Rate,Qt)}return Ae})(A[0].ssrcId,t,R,!!s),Y=(function(ee,ue){const de={};return ue&&(At(de,Vt.Video_Send_Retransmit,ee.bitrate.retransmit),At(de,Vt.Video_Send_Target_Encoded,ee.bitrate.targetEncoded),At(de,Vt.Video_Send_Actual_Encoded,ee.bitrate.actualEncoded),At(de,Vt.Video_Send_Transmit,ee.bitrate.transmit),At(de,Vt.Video_Send_Bandwidth,ee.sendBandwidth)),de})(t,!!s);g=Object.assign({},L,X,Y)}else v=(function(L,U,X,Y,ee){const ue=U.videoSend.find((ne=>ne.ssrc===L));if(!ue)return;const de={};if(Y){const ne=ue.sentFrame;ne&&(At(de,Vt.Video_Send_Low_Height,ne.height),At(de,Vt.Video_Send_Low_Width,ne.width),At(de,Vt.Video_Send_Low_Frame_Rate,ne.frameRate));const be=Y.videoSend.find((Ae=>Ae.ssrc===L));if(be){let Ae=Bf*BT;be.timestamp&&ue.timestamp&&(Ae=ue.timestamp-be.timestamp),be.packets!=null&&ue.packets!=null&&At(de,Vt.Video_Send_Low_Package_Rate,1e3*(ue.packets-be.packets)/Ae),ue.packetsLost!=null&&be.packetsLost!=null&&At(de,Vt.Video_Send_Low_Package_Lost,ue.packetsLost-be.packetsLost),be.bytes!=null&&ue.bytes!=null&&At(de,Vt.Video_Send_Low_Bitrate,8*(ue.bytes-be.bytes)/Ae)}}return de})(A[0].ssrcId,t,0,s);break;case We.LocalAudioTrack:f=R&&(function(L,U,X,Y,ee,ue){const de=U.audioSend.find((be=>be.ssrc===L));if(!de)return;const ne={};if(ee){ne[Vt.Audio_Send_Disabled]=X._originMediaStreamTrack&&!X._originMediaStreamTrack.enabled||X._mediaStreamTrack&&!X._mediaStreamTrack.enabled?1:0;const be=100*X._source.getAccurateVolumeLevel(),Ae=de.inputLevel;if(Ae!=null){const He=Math.ceil(50*Math.log10(100*Ae+1));At(ne,Vt.Audio_Send_Level,He)}At(ne,Vt.Audio_Capture_PCM_Level,be),At(ne,Vt.Audio_Send_AEC_Return_Loss,de.aecReturnLoss),At(ne,Vt.Audio_Send_AEC_Return_Loss_Enhancement,de.aecReturnLossEnhancement),At(ne,Vt.Audio_Send_Bytes_Retransmit,de.retransmittedBytesSent),At(ne,Vt.Audio_Send_Packages_Retransmit,de.retransmittedPacketsSent),ne[Vt.Audio_Send_Freeze]=0;const Ue=ee.audioSend.find((He=>He.ssrc===L));if(Ue){let He=Bf*BT;Ue.timestamp&&de.timestamp&&(He=de.timestamp-Ue.timestamp),Ue.bytes!=null&&de.bytes!=null&&At(ne,Vt.Audio_Send_Bitrate,8*(de.bytes-Ue.bytes)/He),Ue.packets!=null&&de.packets!=null&&At(ne,Vt.Audio_Send_Package_Rate,1e3*(de.packets-Ue.packets)/He)}}return ne})(A[0].ssrcId,t,R,0,s)}})),{high:g,low:v,audio:f}}getInboundStats(t,r,s,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach((f=>{let[g,v]=f;const E={peer:g.uid};if(v.has(ot.VIDEO)&&g.videoTrack){const C=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,R=g.videoTrack?(function(A,B,L,U,X,Y,ee,ue){const de=B.videoRecv.find((Lt=>Lt.ssrc===A));if(!de)return;const ne={},{receivedFrame:be,outputFrame:Ae,decodeFrameRate:Ue}=de;At(ne,Os.Video_Render_Frame_Rate_Decode,Ue),de.framesRateFirefox&&At(ne,Os.Video_Recv_Frame_Rate,de.framesRateFirefox),be&&At(ne,Os.Video_Recv_Frame_Rate,be.frameRate),At(ne,Os.Video_Recv_Frame_Dropped,de.framesDroppedCount),At(ne,Os.Video_Recv_Bytes_Retransmit,de.retransmittedBytesReceived),At(ne,Os.Video_Recv_Packages_Retransmit,de.retransmittedPacketsReceived),At(ne,Os.Video_Recv_Packages_Discarded,de.packetsDiscarded),At(ne,Os.Video_Recv_Avg_Decode,de.avgDecodeMs),At(ne,Os.Video_Recv_Avg_Processing_Delay,de.avgProcessingDelayMs),At(ne,Os.Video_Recv_Avg_Assembly_Time,de.avgFramesAssembledFromMultiplePacketsMs),At(ne,Os.Video_Recv_Avg_Inter_Frame_Delay,de.avgInterFrameDelayMs),At(ne,Os.Video_Recv_Key_Frames_Decoded,de.keyFramesDecoded);const He=ue&&ue.videoRecv.find((Lt=>Lt.ssrc===A));if(He){const Lt=B.timestamp-ue.timestamp||Bf;de.packetsLost!=null&&He.packetsLost!=null&&At(ne,Os.Video_Recv_Package_Lost,de.packetsLost-He.packetsLost),He.bytes!=null&&de.bytes!=null&&At(ne,Os.Video_Recv_Bitrate,8*(de.bytes-He.bytes)/Lt),He.packets!=null&&de.packets!=null&&At(ne,Os.Video_Recv_Package_Rate,1e3*(de.packets-He.packets)/Lt)}const Yt=Y&&Y.videoRecv.find((Lt=>Lt.ssrc===A));if(Yt&&(At(ne,hl.Video_Recv_Qp_Sum,de.qpSumPerFrame),ne[hl.Video_Recv_Freeze]=U&&PE.isRemoteVideoFreeze(L,de,Yt)?1:0),ee){var Qt;const Lt=ee.videoRecv.find((xr=>xr.ssrc===A));be?(At(ne,Vt.Video_Recv_Height,be.height),At(ne,Vt.Video_Recv_Width,be.width)):L&&(At(ne,Vt.Video_Recv_Height,L._videoHeight||0),At(ne,Vt.Video_Recv_Width,L._videoWidth||0)),Ae&&At(ne,Vt.Video_Recv_Frame_Rate_Output,Ae.frameRate);const Ir=(Qt=L._player)===null||Qt===void 0?void 0:Qt.rendFrameRate.toFixed(0);if(Ir&&At(ne,Vt.Video_Render_Frame_Rate_Render,+Ir),At(ne,Vt.Video_Recv_Jitter_Buffer,de.jitterBufferMs),At(ne,Vt.Video_Recv_Current_Delay,de.currentDelayMs),At(ne,Vt.Video_Recv_Firs,de.firsCount),At(ne,Vt.Video_Recv_Nacks,de.nacksCount),At(ne,Vt.Video_Recv_Plis,de.plisCount),L){ne[Vt.Video_Recv_Disabled]=L._originMediaStreamTrack.enabled&&L._mediaStreamTrack.enabled?0:1;const xr=L._player;if(xr){const{freezeTimeCounterList:ti,renderFreezeAccTime:Me,renderFreezeAccTime2:Xe,videoElementStatus:lt}=xr;if(ti&&ti.length>0&&At(ne,hl.Video_Render_Freeze_Time,ti.splice(0,1)[0]),X&&ud.visibility==="visible"&&lt===Js.PLAYING&&vr().supportRequestVideoFrameCallback){const Ve=Math.min(6e3,Xe);xr.renderFreezeAccTime2=Math.max(0,Xe-Ve),At(ne,hl.Video_Render_Freeze_Time_Render2,Ve);const D=Math.min(6e3,Me);xr.renderFreezeAccTime=Math.max(0,Me-D),At(ne,hl.Video_Render_Freeze_Time_Render,Z("USE_NEW_RENDER_FREEZE_TIME")?Ve:D)}if(typeof de.totalFreezesDuration=="number"){const Ve=Lt&&Lt.totalFreezesDuration?de.totalFreezesDuration-Lt.totalFreezesDuration:de.totalFreezesDuration;At(ne,Vt.Video_Render_Freeze_Duration,1e3*Ve)}}}if(ne[Vt.Video_Recv_Player_Status]=EO[L._player?L._player.videoElementStatus:"uninit"],Lt&&de.totalInterFrameDelay!==void 0&&de.totalSquaredInterFrameDelay!==void 0&&Lt.totalInterFrameDelay!==void 0&&Lt.totalSquaredInterFrameDelay!==void 0){const xr=de.totalInterFrameDelay-Lt.totalInterFrameDelay,ti=de.totalSquaredInterFrameDelay-Lt.totalSquaredInterFrameDelay,Me=de.framesDecodeCount-Lt.framesDecodeCount,Xe=xr/Me*1e3,lt=Math.round(1e3*Math.sqrt((ti-Math.pow(xr,2)/Me)/Me));!isNaN(lt)&&Xe+lt>Math.max(3*Xe,Xe+150)&&(ne[Vt.Video_Recv_I_Frame_Delay]=lt)}}return ne})(g._videoSSRC,t,g.videoTrack,C===!0,this.needUploadRenderFreezeTime,r,s,c):void 0;R&&(E.video=R)}if(v.has(ot.AUDIO)&&g.audioTrack){const C=g.audioTrack?(function(R,A,B,L,U,X){const Y=A.audioRecv.find((ne=>ne.ssrc===R));if(!Y)return;const ee={};At(ee,Os.Audio_Recv_Jitter,Y.jitterMs),At(ee,Os.Audio_Recv_Bytes_Retransmit,Y.retransmittedBytesReceived),At(ee,Os.Audio_Recv_Packages_Retransmit,Y.retransmittedPacketsReceived),At(ee,Os.Audio_Recv_Packages_Discarded,Y.packetsDiscarded),At(ee,Os.Audio_Recv_Avg_Processing_Delay,Y.avgProcessingDelayMs);const ue=X&&X.audioRecv.find((ne=>ne.ssrc===R));if(ue){const ne=Bf;Y.packets!=null&&ue.packets!=null&&At(ee,Os.Audio_Recv_Package_Rate,1e3*(Y.packets-ue.packets)/ne),Y.packetsLost!=null&&ue.packetsLost!=null&&At(ee,Os.Audio_Recv_Package_Lost,Y.packetsLost-ue.packetsLost)}if(L){const{receivedFrames:ne,droppedFrames:be}=Y;ne!=null&&be!=null&&(ee[hl.Audio_Recv_Freeze]=(de=ne)===0||100*be/de>20?1:0)}var de;if(U){const ne=100*B._source.getAccurateVolumeLevel(),be=Y.outputLevel;if(be!=null){const Ue=Math.ceil(50*Math.log10(100*be+1));At(ee,Vt.Audio_Render_Level,Ue)}At(ee,Vt.Audio_Recv_PCM_Level,ne),B&&(ee[Vt.Audio_Recv_Disabled]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1),At(ee,Vt.Audio_Recv_Jitter_Buffer,Y.jitterBufferMs),At(ee,Vt.Audio_Recv_Current_Delay,Y.jitterBufferMs),ee[Vt.Audio_Recv_Player_Status]=EO[Gi.getPlayerState(B.getTrackId())];const Ae=U.audioRecv.find((Ue=>Ue.ssrc===R));if(Ae){Ae.bytes!=null&&Y.bytes!=null&&At(ee,Vt.Audio_Recv_Bitrate,8*(Y.bytes-Ae.bytes)/(Bf*DE));const Ue=Y.concealedSamples-Ae.concealedSamples;Ue>0&&At(ee,Vt.Audio_Recv_Concealed_Samples,Ue);const He=Y.totalSamplesReceived-Ae.totalSamplesReceived;He>0&&At(ee,Vt.Audio_Recv_Total_Samples_Received,He);const Yt=Y.freezeSamples80-Ae.freezeSamples80;Yt>0&&At(ee,Vt.Audio_Render_Freeze_Samples_80ms,Yt);const Qt=Y.freezeSamples200-Ae.freezeSamples200;Qt>0&&At(ee,Vt.Audio_Render_Freeze_Samples_200ms,Qt);const Lt=Y.freezeMs80-Ae.freezeMs80;At(ee,Vt.Audio_Render_Freeze_Time_80ms,Lt<0?0:Lt);const Ir=Y.freezeMs200-Ae.freezeMs200;At(ee,Vt.Audio_Render_Freeze_Time_200ms,Ir<0?0:Ir)}}return ee})(g._audioSSRC,t,g.audioTrack,r,s,c):void 0;C&&(E.audio=C)}(E.video||E.audio)&&h.push(E)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find((r=>r instanceof wE));if(t&&t._external.getDenoiserStats){const r=t._external.getDenoiserStats();r&&this.requestUpload(SE.DENOISER_STATS,r)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((t=>{t.getProcessorStats().forEach((r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((t=>{let[r,s]=t;s.has(ot.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach((c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})),s.has(ot.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach((c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const r=Date.now(),s={connectionInterval:Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,E]of h)E.has(ot.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),E.has(ot.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;s.details=(function(v,E){const C={};for(const{id:L,value:U,level:X,direction:Y}of v){var R;const ee=(R=E.get(L))!==null&&R!==void 0?R:0,ue=U===2?ee+Z("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ee;var A,B;E.set(L,ue),C[L]?(U===2&&(C[L].value=U),X>C[L].level&&(C[L].level=X),Y==="remote"&&(C[L].remoteUidCount+=1),C[L].totalTs=(A=E.get(L))!==null&&A!==void 0?A:0):C[L]={value:U,level:X,remoteUidCount:Y==="local"?0:1,totalTs:(B=E.get(L))!==null&&B!==void 0?B:0}}return Object.keys(C).map((L=>{const{level:U,value:X,totalTs:Y}=C[L];return{id:L,level:U,value:X,totalTs:Y}}))})(c,t);const f=Date.now(),g=f>r?f:r+1;this.requestUpload&&this.requestUpload(SE.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:g})}),Z("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Nne=Z("ICE_RESTART_INTERVAL");let WT=new Map,G_=new Map,Uh=[Zs.UDP_TCP_RELAY,Zs.TCP_RELAY,Zs.RELAY],y1=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vr().supportPCSetConfiguration;function Y5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r=WT.get(e.id);r&&(window.clearTimeout(r),WT.delete(e.id));const s=G_.get(e.id);t&&s&&s.index===Uh.length-1&&(k.debug("[".concat(e.id,"] reset ICE restart policy")),G_.delete(e.id))}function X5(e,t,r){if(WT.size===0&&G_.size===0&&(Array.isArray(Z("RESTART_SEQUENCE"))&&Z("RESTART_SEQUENCE").length>0&&!(function(f,g){if(f.length!==g.length)return!1;for(let v=0;v<f.length;v+=1){const E=f[v];if(f.filter((C=>C===E)).length!==g.filter((C=>C===E)).length)return!1}return!0})(Uh,Z("RESTART_SEQUENCE"))&&(Uh=Z("RESTART_SEQUENCE").filter((f=>{var g;if($e(g=Object.values(Zs)).call(g,f))return!0})),k.debug("use reconnection policy from config distribution, queues: ".concat(Uh.join(" => ")))),y1=Z("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vr().supportPCSetConfiguration),Uh.length===0)return void r();let s,{index:c=0,type:d}=G_.get(e.id)||{};if(y1&&d===Zs.RELAY)return void r();let h=d&&c>=Uh.length-1;if(y1)d=Zs.RELAY;else{if(h)return void r();d?(c++,d=Uh[c]):(d=Uh[0],c=0)}k.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),t(d),G_.set(e.id,{index:c,type:d}),s=window.setTimeout((()=>X5(e,t,r)),Nne),WT.set(e.id,s)}var sr;function J5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function fd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}function Q5(e){var t,r,s,c=2;for(typeof Symbol<"u"&&(r=PI,s=Symbol.iterator);c--;){if(r&&(t=e[r])!=null)return t.call(e);if(s&&(t=e[s])!=null)return new qT(t.call(e));r="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function qT(e){function t(r){if(Object(r)!==r)return nt.reject(new TypeError(r+" is not an object."));var s=r.done;return nt.resolve(r.value).then((function(c){return{value:c,done:s}}))}return qT=function(r){this.s=r,this.n=r.next},qT.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var s=this.s.return;return s===void 0?nt.resolve({value:r,done:!0}):t(s.apply(this.s,arguments))},throw:function(r){var s=this.s.return;return s===void 0?nt.reject(r):t(s.apply(this.s,arguments))}},new qT(e)}let jE=(sr=class extends _n{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Tt.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",void 0),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"connection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"remoteDataChannelMap",new Map),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"pendingLocalDataChannels",[]),H(this,"pendingRemoteDataChannels",[]),H(this,"statsCollector",void 0),H(this,"shouldForwardP2PCreation",void 0),H(this,"iceFailedCount",0),H(this,"dtlsFailedCount",0),H(this,"mutex",void 0),H(this,"_state",Dr.Disconnected),H(this,"_pcStatsUploadType",Z("NEW_ICE_RESTART")?du.FIRST_CONNECTION:du.OLD_FIRST_CONNECTION),H(this,"_isStartRestartIce",!1),H(this,"_restartTimer",void 0),H(this,"_isTryConnecting",!1),H(this,"_iceError",null),H(this,"_forceTurn",!1),H(this,"_isWaitPcToRePub",!1),H(this,"handleMuteLocalTrack",(async(r,s,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Dr.Connected)return void c(new Ne(J.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(r);if(h.length===0)return void s();const f=h.find((v=>v[0]==="videoLowTrack"));if(f){const v=f[1];this.store.enableInstantMuteRestore?(v.track._originMediaStreamTrack.enabled=!1,k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):v.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map((v=>{let[,{id:E}]=v;return E})));const g=this.createMuteMessage(h);await Kr(this,Tt.RequestMuteLocal,g),s()}catch(h){c(h)}finally{d()}})),H(this,"handleUnmuteLocalTrack",(async(r,s,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Dr.Connected)return void c(new Ne(J.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void s();const f=h.find((v=>v[0]==="videoLowTrack"));if(f){const v=f[1];if(this.store.enableInstantMuteRestore)v.track._originMediaStreamTrack.enabled=!0,k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(v.track._originMediaStreamTrack.stop(),!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&vr().supportDualStreamEncoding){const E=r._mediaStreamTrack.clone();v.track._mediaStreamTrack=E,v.track._originMediaStreamTrack=E}else{const E=_1(r,fE(this,Tt.RequestLowStreamParameter));v.track._mediaStreamTrack=E,v.track._originMediaStreamTrack=E}await new nt(((E,C)=>{this.handleReplaceTrack(v.track,E,C,!0)}))}}this.store.enableInstantMuteRestore?k.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map((v=>{let[,{id:E}]=v;return E})));const g=this.createUnmuteMessage(h);await Kr(this,Tt.RequestUnmuteLocal,g),s()}catch(h){c(h)}finally{d()}})),H(this,"handleUpdateVideoEncoder",(async(r,s,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(We.LocalVideoTrack);if(!this.connection||!g||g.track!==r||this.state!==Dr.Connected)return void s();const{id:v,track:E}=g;await this.connection.updateSendParameters(v,E),await this.connection.updateEncoderConfig(v,E),this.emit(Tt.UpdateVideoEncoder,E),s()}catch(g){c(g)}finally{var f;(f=h)===null||f===void 0||f()}})),H(this,"handleUpdateVideoSendParameters",(async(r,s,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(We.LocalVideoTrack);if(!this.connection||!h||h.track!==r||this.state!==Dr.Connected)return void s();const{id:f,track:g}=h;await this.connection.updateSendParameters(f,g),s()}catch(h){c(h)}finally{d()}})),H(this,"handleReplaceMixingTrack",(async(r,s,c,d)=>{if(!this.connection||this.state!==Dr.Connected)return void s();const h=m1([r]);let f;k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,h),s()}catch(v){c(v)}finally{var g;(g=f)===null||g===void 0||g()}})),H(this,"handleReplaceTrack",(async(r,s,c,d)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find((E=>{let[,{track:C}]=E;return r===C}));if(!this.connection||!v||this.state!==Dr.Connected)return void s();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(r,v[1].id)),this.isPlanB){const E=v[1];E.id=r._mediaStreamTrack.id,this.localTrackMap.set(v[0],E)}if(v[0]===We.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&vr().supportDualStreamEncoding){const E=this.localTrackMap.get(We.LocalVideoLowTrack);if(E){const C=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=C,E.track._originMediaStreamTrack=C,await new nt(((R,A)=>{this.handleReplaceTrack(E.track,R,A,!0)}))}}s()}catch(v){c(v)}finally{var g;(g=h)===null||g===void 0||g()}})),H(this,"handleGetRTCStats",(r=>{r(this.statsCollector.getRTCStats())})),H(this,"handleGetLocalVideoStats",(r=>{r(this.statsCollector.getLocalVideoTrackStats())})),H(this,"handleGetLocalAudioStats",(r=>{r(this.statsCollector.getLocalAudioTrackStats())})),H(this,"handleGetRemoteVideoStats",(r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid])),H(this,"handleGetRemoteAudioStats",(r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new $5(this.store),this.bindStatsUploaderEvents(),this.mutex=new Xs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!vr().supportUnifiedPlan||Z("CHROME_FORCE_PLAN_B")&&au(),this.shouldForwardP2PCreation=Z("FORWARD_P2P_CREATION")&&vr().supportPCSetConfiguration&&zI(),this.shouldForwardP2PCreation&&(this.connection=FT(this.store),this.emit(Tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var r;this.state=Dr.New,this._forceTurn=q5(e),k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||s||t)&&((s||t)&&this.connection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=FT(this.store,e),this.emit(Tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ne(J.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Z("NEW_ICE_RESTART")?du.FIRST_CONNECTION:du.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ne(J.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===Dr.Connected){if(this.connection instanceof Ao&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),ft.reportApiInvoke(this.store.sessionId,{name:In.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:un.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(Tt.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Dr.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((c=>{var d;let[h]=c;return $e(d=[We.LocalVideoLowTrack,We.LocalVideoTrack]).call(d,h)})),r=t.map((c=>{let[,{id:d}]=c;return d})),s=t.map((c=>{let[d]=c;return d}));if(this.connection instanceof Ao){if(ft.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(s),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!$e(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find((d=>$e(e).call(e,d)));c&&(this.store.codec=c,k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof Ao&&this.connection.peerConnectionState!=="closed"&&$e(e=[Dr.New,Dr.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Dr.Connected){if(this.state===Dr.Disconnected)throw new Ne(J.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((r=>{var s;$e(s=this.pendingLocalDataChannels).call(s,r)||this.pendingLocalDataChannels.push(r)})),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach((r=>{const s=Date.now();this.store.publish(r.id.toString(),"datachannel",s)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((r=>{this.localDataChannels.push(r);const s=Date.now();this.store.publish(r.id+"","datachannel",void 0,s)})),e.map((r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId}))))}publish(e,t,r){var s=this;return So((function*(){const c=yield yr(s.mutex.lock("From P2PChannel.publish"));try{var d;const h=s.connection&&$e(d=["disconnected","failed"]).call(d,s.connection.peerConnectionState);if(!s.connection||s.state!==Dr.Connected||h){if(s.state===Dr.Disconnected)throw new Ne(J.UNEXPECTED_ERROR,"PeerConnection already disconnected.");s.throwIfTrackTypeNotMatch(e);const g=e.filter((v=>s.pendingLocalTracks.indexOf(v)===-1));return s.pendingLocalTracks=s.pendingLocalTracks.concat(g),void(h&&(s._isWaitPcToRePub=!0))}s.store.pubId=s.store.pubId+1,ei.markPublishStart(s.store.clientId,s.store.pubId);const f=s.filterTobePublishedTracks(e,t,r);if(f.length===0)return void(yield yr(s.tryToUnmuteAudio(e)));yield*jx(Q5(s.doPublish(s.connection,f)))}finally{c()}}))()}doPublish(e,t){var r=this;return So((function*(){t.forEach((R=>{let{track:A,type:B}=R;const L=Date.now();r.store.publish(A.getTrackId(),B===We.LocalAudioTrack?"audio":"video",L)})),r.bindLocalTrackEvents(t);const s=t.map((R=>{let{track:A}=R;return A})),c=yield yr(e.send(s,r.store.codec,r.store.audioCodec)),d=(yield yr(c.next())).value,h=r.createGatewayPublishMessage(t,d);let f;try{f=yield h}catch(R){throw c.throw(R),(R==null?void 0:R.code)===J.WS_ABORT&&t.forEach((A=>{let{track:B}=A;r.pendingLocalTracks.indexOf(B)===-1&&r.pendingLocalTracks.push(B)})),r.unbindLocalTrackEvents(t),R}const g=r.mapPubResToRemoteConfig(h,f,s),v=(yield yr(c.next(g))).value;if(r.state===Dr.Disconnected)throw new Ne(J.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Z("ENABLE_VIDEO_SEI");const E=Z("ENABLE_ENCODED_TRANSFORM"),C=Z("ENABLE_AUDIO_METADATA");s.forEach((async R=>{const A=R.getRTCRtpTransceiver();if(!A||!E)return;const{interceptLocalVideoFrame:B,interceptLocalAudioFrame:L}=IT();R.trackMediaType===ot.VIDEO?await B(A.sender,R):R.trackMediaType===ot.AUDIO&&await L(A.sender,{metadata:C?()=>{const U=R.metadata.shift();return U&&U.value}:void 0})})),t.forEach((R=>{let{type:A}=R;r.statsCollector.addLocalStats(A)})),r.assignLocalTracks(t,v),r.statsUploader.startUploadOutboundStats(),t.forEach((R=>{let{track:A,type:B}=R;const L=Date.now();r.store.publish(A.getTrackId(),B===We.LocalAudioTrack?"audio":"video",void 0,L)}))}))()}async updateVideoStreamParameter(e,t){const r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof tn))return k.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:s}=r,c=(function(d,h){const f={};return d.height&&d.width&&(f.scaleResolutionDownBy=JO(d,h)),f.maxFramerate=d.framerate?Na(d.framerate):void 0,f.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,f})(e,s);if(s._encoderConfig||(s._encoderConfig={}),t!==We.LocalVideoLowTrack||!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&vr().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(s._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=s._originMediaStreamTrack;if(!d.canvas)return k.warn("[".concat(s.getTrackId(),"] no canvas on track"));(function(h,f){const g=h.canvas;f.width&&(g.width=Na(f.width)),f.height&&(g.height=Na(f.height)),f.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=bO((()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()}),Na(f.framerate)))})(d,e)}c.maxBitrate!=null&&(s._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(s._encoderConfig.frameRate&&typeof s._encoderConfig.frameRate=="object"?s._encoderConfig.frameRate.max=c.maxFramerate:s._encoderConfig.frameRate={max:c.maxFramerate}),k.debug("[".concat(s.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(s._encoderConfig))),await this.connection.updateRtpSenderEncodings(s)}publishLowStream(e){var t=this;return So((function*(){if(!t.connection||t.state!==Dr.Connected)return;const r=yield yr(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=t.localTrackMap.get(We.LocalVideoTrack);if(!c)throw new Ne(J.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(We.LocalVideoLowTrack))throw new Ne(J.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:t.getLowVideoTrack(c.track,e),type:We.LocalVideoLowTrack}];if(yield*jx(Q5(t.doPublish(t.connection,d))),c.track.muted||!c.track.enabled){var s;const h=(s=t.localTrackMap.get(We.LocalVideoLowTrack))===null||s===void 0?void 0:s.id;h!==void 0&&(yield yr(t.connection.muteLocal([h])))}}finally{r()}}))()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Vs(this,Tt.RequestRePublish,this.pendingLocalTracks),this.emit(Tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(k.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Vs(this,Tt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:r,kind:s}=this.pendingRemoteTracks[t];(s!==ot.AUDIO||r._audio_added_&&r._audioSSRC)&&(s!==ot.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Vs(this,Tt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===ot.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:r}=t;this.emit(Tt.MediaReconnectEnd,r.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Dr.Connected)return void e.forEach((s=>{const c=this.pendingLocalTracks.indexOf(s);c!==-1&&this.pendingLocalTracks.splice(c,1)}));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find((s=>s[0]==="videoLowTrack"));return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==Dr.Connected)return void e.forEach((r=>{const s=this.pendingLocalDataChannels.indexOf(r);s!==-1&&this.pendingLocalDataChannels.splice(s,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach((r=>{const s=this.localDataChannels.indexOf(r);s!==-1&&this.localDataChannels.splice(s,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map((r=>r.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Dr.Connected)return;const e=this.localTrackMap.get(We.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[We.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((s=>{let[,{id:c}]=s;return c}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((s=>{let[c,{track:d}]=s;return{type:c,track:d}}))),t.forEach((s=>{let[c]=s;this.statsCollector.removeLocalStats(c)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==Dr.Connected)throw new Ne(J.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const r=t.filter((s=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(s.id))}));if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach((s=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(s.id,s):this.remoteDataChannelMap.set(e,new Map([[s.id,s]]));const d=this.pendingRemoteDataChannels.findIndex((h=>{let{user:f,id:g}=h;return f.uid===e.uid&&g===s.id}));d!==-1&&this.pendingRemoteDataChannels.splice(d,1)})),r.map((s=>s.id))}async subscribe(e,t,r,s,c){var d;if(!this.connection||this.state!==Dr.Connected)throw new Ne(J.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(e))!==null&&d!==void 0&&d.has(t))return;let h,f,g,v;const E=this.connection.getPreMedia(r);if(E)k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),g=E.transceiver,h=E.track,f=E.mid,v=E.player,E.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:E.firstVideoRender});else if(c){const A=c.find((L=>{let{stream_type:U}=L;return U===t}));if(!A)throw new Ne(J.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const B=await this.connection.receive(t,A.ssrcs,String(e._uintid),A.attributes);this.connection instanceof Ao&&(g=B.transceiver),h=B.track,f=B.id}else{const A=await this.connection.receive(t,[{ssrcId:r,rtx:s}],String(e._uintid),void 0);this.connection instanceof Ao&&(g=A.transceiver),h=A.track,f=A.id}if(t===ot.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new O_(h,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),g&&e._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new I_(h,e.uid,e._uintid,this.store,v),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(Co.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(Co.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),v?e._videoTrack.once(Co.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(Co.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),g&&e._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(e,e._videoTrack)),g&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:B}=IT();t==ot.VIDEO?await A(g.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(L=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(L)})}):t==ot.AUDIO&&await B(g.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),enablePts:!!Z("ENABLE_AUDIO_PTS"),onMetadata:L=>{this.safeEmit(Tt.AudioMetadata,L)},onPts:L=>{this.safeEmit(Tt.AudioPts,L)}})}const C=this.remoteUserMap.get(e);C?C.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex((A=>{let{user:B,kind:L}=A;return B.uid===e.uid&&t===L}));R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Tt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Dr.Connected)throw new Ne(J.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((c=>{var d;let{user:h,mediaType:f}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(f))}));const t=[],r=new Map;e.forEach((c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:h,mid:f,transceiver:g,player:v}=d;r.set(c.ssrcId,{track:h,id:f,transceiver:g,player:v})}else t.push(c)}));const s=await this.connection.batchReceive(t.map((c=>{let{user:d,mediaType:h,ssrcId:f,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:f,rtx:g}],mslabel:String(d._uintid)}})));t.forEach(((c,d)=>{r.set(c.ssrcId,s[d])}));for(const{user:c,mediaType:d,ssrcId:h}of e){const f=r.get(h);if(!f)return void k.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:g,id:v,transceiver:E,player:C}=f;if(E&&Z("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:B,interceptRemoteAudioFrame:L}=IT();d==ot.VIDEO?await B(E.receiver,{onSei:Z("ENABLE_VIDEO_SEI")&&(U=>{var X;return(X=c._videoTrack)===null||X===void 0?void 0:X._onSei(U)})}):d==ot.AUDIO&&await L(E.receiver,{enableTopn:!!Z("ENABLE_AUDIO_TOPN"),enableMetadata:!!Z("ENABLE_AUDIO_METADATA"),enablePts:!!Z("ENABLE_AUDIO_PTS"),onMetadata:U=>{this.safeEmit(Tt.AudioMetadata,U)},onPts:U=>{this.safeEmit(Tt.AudioPts,U)}})}if(d===ot.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new O_(g,c.uid,c._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),E&&c._audioTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new I_(g,c.uid,c._uintid,this.store,C),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),E&&c._videoTrack._updateRtpTransceiver(E),this.bindRemoteTrackEvents(c,c._videoTrack)),Z("ENABLE_VIDEO_SEI")&&E){const{interceptRemoteVideoFrame:B,interceptRemoteAudioFrame:L}=IT();d==ot.VIDEO?await B(E.receiver,{onSei:U=>{var X;(X=c._videoTrack)===null||X===void 0||X._onSei(U)}}):d==ot.AUDIO&&await L(E.receiver)}const R=this.remoteUserMap.get(c);R?R.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex((B=>{let{user:L,kind:U}=B;return L.uid===c.uid&&d===U}));A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Tt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,t,r){const s=this.pendingRemoteTracks.filter((h=>{let{user:f,kind:g}=h;return t!==void 0?f.uid===e.uid&&t===g:f.uid===e.uid}));if(s.forEach((h=>{const f=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(f,1)})),this.connection&&this.state===Dr.Connected||r||s.forEach((h=>{let{kind:f}=h;var g;if(f===ot.AUDIO)(g=e._audioTrack)===null||g===void 0||g._destroy(),e._audioTrack=void 0;else if(f===ot.VIDEO){var v;(v=e._videoTrack)===null||v===void 0||v._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==Dr.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,t);if(c.length===0)return;await this.connection.stopReceiving(c.map((h=>{let[,{id:f}]=h;return f})));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach((h=>{let[f,{kind:g}]=h;var v,E;if(g===ot.VIDEO&&f._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===ot.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),r||((E=f._videoTrack)===null||E===void 0||E._destroy(),f._videoTrack=void 0);else if(g===ot.AUDIO){var C;this.unbindRemoteTrackEvents(f._audioTrack),!r&&((C=f._audioTrack)===null||C===void 0||C._destroy(),f._audioTrack=void 0)}})),d}async unsubscribeDataChannel(e,t){if(t.forEach((c=>{const d=this.pendingRemoteDataChannels.findIndex((h=>h.id===c.id));d!==-1&&this.pendingRemoteDataChannels.splice(d,1)})),!this.connection)return;const r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach((c=>{c._close()}));const s=this.remoteDataChannelMap.get(e);return r.forEach((c=>{s&&s.delete(c.id)})),s&&s.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map((c=>c.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:c,mediaType:d}of e){const h=this.pendingRemoteTracks.filter((f=>{let{user:g,kind:v}=f;return d!==void 0?g.uid===c.uid&&d===v:g.uid===c.uid}));h.forEach((f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)})),t=t.concat(h)}if(!this.connection||this.state!==Dr.Connected)return void t.forEach((c=>{let{user:d,kind:h}=c;var f;if(h===ot.AUDIO)(f=d._audioTrack)===null||f===void 0||f._destroy(),d._audioTrack=void 0;else if(h===ot.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}}));const r=ea(e).call(e,((c,d)=>{let{user:h,mediaType:f}=d;const g=this.filterTobeUnSubscribedTracks(h,f);return c.concat(g)}),[]);if(r.length===0)return;await this.connection.stopReceiving(r.map((c=>{let[,{id:d}]=c;return d})));const s=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach((c=>{let[d,{kind:h}]=c;var f,g;if(h===ot.VIDEO&&d._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===ot.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(h===ot.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}})),s}isPreSubScribe(e){return!this.connection||this.state!==Dr.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===ot.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.connection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(We.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(We.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xn){const r=t.track;return Array.from(this.localTrackMap.entries()).filter((s=>{let[c]=s;return c!==We.LocalAudioTrack})).filter((s=>{let[c]=s;return!(e&&c===We.LocalVideoLowTrack)})).map((s=>{let[,{track:c}]=s;return c})).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter((r=>{let[s]=r;return!(e&&s===We.LocalVideoLowTrack)})).map((r=>{let[,{track:s}]=r;return s}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,s,c){if(e){const h=this.localTrackMap.get(We.LocalAudioTrack),f=s?this.localTrackMap.get(We.LocalVideoLowTrack):this.localTrackMap.get(We.LocalVideoTrack);ft.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;r||(r=[]);const h=r.find((g=>g instanceof Nn)),f=s?(d=this.localTrackMap.get(We.LocalVideoTrack))===null||d===void 0?void 0:d.track:r.find((g=>g instanceof tn));ft.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,s){const c=s===ot.VIDEO?r._videoSSRC:r._audioSSRC;c&&ft.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===ot.VIDEO,audio:s===ot.AUDIO,peerid:r.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Xs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=FT(this.store),this.emit(Tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(We.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((r=>{t.removeAudioTrack(r)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Dr.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(We.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(We.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof tn||t&&t.track instanceof Nn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(oa(t=this.remoteUserMap).call(t)).find((s=>s.uid===e));return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((r=>{let[s]=r;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(We.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vf(e).call(e,((r,s)=>r.level-s.level)),e}async disconnectForReconnect(){this.connection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Dr.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=FT(this.store),this.emit(Tt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[r,{track:s}]=e;switch(r){case We.LocalVideoTrack:$e(t=s._hints).call(t,Hr.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case We.LocalAudioTrack:s instanceof Xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case We.LocalVideoLowTrack:}})),this.emit(Tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;Array.from(oa(r).call(r)).forEach((s=>{this.setPendingRemoteMedia(t,s)})),this.emit(Tt.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,r]=e;Array.from(oa(r).call(r)).forEach((s=>{this.setPendingRemoteDataChannel(t,s)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const r of this.pendingRemoteDataChannels){const{user:s,id:c}=r;if((e instanceof Mh?e.uid:e)===s.uid&&c===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:s,kind:c}=r;if((e instanceof Mh?e.uid:e)===s.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return So((function*(){if(!t.connection||t.state!==Dr.Connected)return;const r=yield yr(t.mutex.lock("From P2PChannel.restartICE"));let s;try{s=yield yr(t.connection.restartICE(e));const d=yield yr(s.next());if(d.done)return;const h=d.value,f=yield h;switch(g1(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Zs.UDP_TCP_RELAY:t._pcStatsUploadType=du.UDP_TCP_RESTART;break;case Zs.TCP_RELAY:t._pcStatsUploadType=du.TCP_RESTART;break;case Zs.RELAY:t._pcStatsUploadType=du.RELAY_RESTART;break;default:t._pcStatsUploadType=du.OLD_RESTART}t._isTryConnecting=!0,s.next(f)}catch(d){var c;(c=s)===null||c===void 0||c.throw(d)}finally{r()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(We.LocalVideoTrack),r=this.localTrackMap.get(We.LocalAudioTrack),s=e.videoSend.find((A=>A.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId))),c=e.audioSend.find((A=>A.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)));if(!s||!c)return 1;const d=Ga(this,Tt.NeedSignalRTT),h=s?s.rttMs:void 0,f=c?c.rttMs:void 0,g=h&&f?(h+f)/2:h||f,v=(g&&d?(g+d)/2:g||d)||0,E=100*e.sendPacketLossRate*.7/50+.3*v/1500,C=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,R=t==null?void 0:t.track;if(R&&R._encoderConfig&&R._hints.indexOf(Hr.SCREEN_TRACK)===-1){const A=R._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(A&&B){const L=(1e3*A-B)/(1e3*A);return UV[L<.15?0:L<.3?1:L<.45?2:L<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((r=>{let[s]=r;const c=s._audioSSRC,d=s._videoSSRC,h=e.audioRecv.find((B=>B.ssrc===c)),f=e.videoRecv.find((B=>B.ssrc===d));if(!h&&!f)return void(t+=1);const g=Ga(this,Tt.NeedSignalRTT),v=e.rtt,E=(v&&g?(v+g)/2:v||g)||0,C=h?h.jitterMs:void 0,R=e.recvPacketLossRate;let A=.7*R*100/50+.3*E/1500;C&&(A=.6*R*100/50+.2*E/1500+.2*C/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new nt(((t,r)=>{this.handleMuteLocalTrack(e,t,r)}))}async replaceTrack(e,t){var r;if(k.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==Dr.Connected)return;const s=Array.from(this.localTrackMap.entries()).find((d=>{let[,{track:h}]=d;return e===h}));if(!s)return;const c=s[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:t,type:c}]),s[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,s[1].id)),this.isPlanB){const d=s[1];d.id=t._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===We.LocalVideoTrack&&!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&vr().supportDualStreamEncoding){const d=this.localTrackMap.get(We.LocalVideoLowTrack);if(d){const h=e._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new nt(((f,g)=>{this.handleReplaceTrack(d.track,f,g,!0)}))}}}filterTobePublishedTracks(e,t,r){const s=[],c=this.getAllTracks();e=__(e=e.filter((g=>c.indexOf(g)===-1)));let d,h=!1;const f=this.localTrackMap.get(We.LocalAudioTrack);for(const g of e){if(g instanceof tn&&(this.localTrackMap.has(We.LocalVideoTrack)||h?new Ne(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:We.LocalVideoTrack}),h=!0),t)){const v=this.getLowVideoTrack(g,r);s.push({track:v,type:We.LocalVideoLowTrack})}if(g instanceof Nn)if(f){const v=f.track;if(v instanceof Xn)f1([g]),v.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const E=m1([v,g]);k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(E.getTrackId(),"]")),this.replaceTrack(v,E)}}else d instanceof Xn?(f1([g]),d.addAudioTrack(g)):d||!g._useAudioElement&&vr().webAudioMediaStreamDest&&!g._bypassWebAudio?d=m1(d?[g,d]:[g]):d=g}return d&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),s.push({track:d,type:We.LocalAudioTrack})),s}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=__(e=e.filter((s=>r.indexOf(s)!==-1)));for(const s of e){if(s instanceof Nn){const c=this.localTrackMap.get(We.LocalAudioTrack);if(!c)continue;c.track instanceof Xn?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(t.push([We.LocalAudioTrack,c]),c.track.close())):t.push([We.LocalAudioTrack,c])}if(s instanceof tn){const c=this.localTrackMap.get(We.LocalVideoTrack);if(!c)continue;t.push([We.LocalVideoTrack,c]);const d=this.localTrackMap.get(We.LocalVideoLowTrack);d&&t.push([We.LocalVideoLowTrack,d])}}return t}filterTobePublishedDataChannels(e){return e=(e=__(e)).filter((t=>this.localDataChannels.findIndex((r=>r.id===t.id))===-1))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=__(e)).filter((t=>this.localDataChannels.indexOf(t)!==-1))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(e){e.forEach((t=>{let{track:r,type:s}=t;switch(s){case We.LocalVideoTrack:r.addListener(dt.GET_STATS,this.handleGetLocalVideoStats),r.addListener(dt.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case We.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case We.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof Xn?e.trackList.forEach((r=>{r.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(dt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[r,{track:s}]=t;return{track:s,type:r}}))),e.forEach((t=>{let{track:r,type:s}=t;switch(s){case We.LocalVideoTrack:r.off(dt.GET_STATS,this.handleGetLocalVideoStats),r.off(dt.GET_RTC_STATS,this.handleGetRTCStats),r.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case We.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case We.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof Xn?e.trackList.forEach((t=>{t.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(dt.GET_STATS,this.handleGetLocalAudioStats),t.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(dt.GET_STATS,this.handleGetLocalAudioStats),e.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(dt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof I_&&t.addListener(dt.GET_STATS,(r=>{r(this.handleGetRemoteVideoStats(e))})),t instanceof O_&&t.addListener(dt.GET_STATS,(r=>{r(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(dt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;r.has(ot.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(ot.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((r,s)=>{var c;let d,h,{track:f,type:g}=r;switch(g){case We.LocalAudioTrack:d=Mr.Audio,h={dtx:f instanceof wE&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case We.LocalVideoTrack:d=$e(c=f._hints).call(c,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High,h=fd(fd({},e5(f)),{},{codec:this.store.codec,svc_mode:TT()});break;case We.LocalVideoLowTrack:d=Mr.Low,h=fd(fd({},e5(f)),{},{codec:this.store.codec,svc_mode:TT()})}return{stream_type:d,attributes:h,ssrcs:t[s]}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var r;let s,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case We.LocalVideoTrack:s=$e(r=d._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoLowTrack:s=Mr.Low}return{stream_type:s,ssrcs:h,mid:f}}))}assignLocalTracks(e,t){e.forEach(((r,s)=>{let{track:c,type:d}=r;this.localTrackMap.set(d,{track:c,id:t[s].id,ssrcs:t[s].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[r]=t;this.localTrackMap.delete(r)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Tt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Ao&&!Sn()&&Z("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{t==="connecting"&&e.extendCandidate()}),Z("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Ao&&Y5(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=du.DISCONNECTED_OR_FAILED,Ga(this,Tt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const r=this.pendingLocalTracks.map((c=>c.getTrackId())),s=this.pendingLocalDataChannels.map((c=>"dc_".concat(c.id)));ft.reportApiInvoke(this.store.sessionId,{name:In.REPUB_AFTER_PC_CONNECTED,options:r.concat(s),tag:un.TRACER}).onSuccess(),this.republish()}if(Z("NEW_ICE_RESTART")&&e instanceof Ao&&!Sn()&&!this._forceTurn){if($e($V).call($V,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=c=>{g1(e)&&(k.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Ga(this,Tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Tt.RequestRestartICE,c))},s=()=>{g1(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),k.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(Tt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{X5(e,r,s)}),800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout((()=>{e.iceConnectionState==="disconnected"&&Z("ICE_RESTART")&&Ga(this,Tt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Tt.RequestRestartICE)}),800),void setTimeout((()=>{e.peerConnectionState==="disconnected"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(Tt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);t==="failed"&&(k.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(Tt.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ft.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:un.TRACER}).onSuccess(),this.emit(Tt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((d=>d._audioSSRC===t));var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(Co.FIRST_FRAME_DECODED),ft.firstRemoteFrame(this.store.sessionId,ss.FIRST_AUDIO_DECODE,ln.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((c=>c._audioSSRC===t));s&&ft.firstRemoteFrame(this.store.sessionId,ss.FIRST_AUDIO_RECEIVED,ln.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,s)=>{var c;const d=Array.from(oa(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===t));d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,r,s)},e.onFirstVideoRender=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((c=>c._videoSSRC===t));s&&(this.store.firstVideoFrameDecoded(s.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(s))},e.onFirstVideoReceived=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((c=>c._videoSSRC===t));s&&(this.store.firstVideoFrameDecoded(s.uid,{firstReceived:Date.now()}),ft.firstRemoteFrame(this.store.sessionId,ss.FIRST_VIDEO_RECEIVED,ln.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,r)=>{const s=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&s===c||this.emit(Tt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(kh(r))," -> ").concat(JSON.stringify(kh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(kh(r))," -> ").concat(JSON.stringify(kh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return fd(fd({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Ao&&(function(t){G_.delete(t.id),Y5(t)})(e),e.close(),this.emit(Tt.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(We.LocalAudioTrack);if(e instanceof Nn&&(r==null?void 0:r.track)instanceof Xn)return r.track.isActive||t.push([We.LocalAudioTrack,r]),t;const s=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return e===d}));if(s&&(t.push(s),s[0]===We.LocalVideoTrack)){const c=this.localTrackMap.get(We.LocalVideoLowTrack);c&&t.push([We.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(We.LocalAudioTrack);if(e instanceof Nn&&(r==null?void 0:r.track)instanceof Xn)return r.track.isActive&&t.push([We.LocalAudioTrack,r]),t;const s=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return e===d}));if(s)if(s[0]===We.LocalVideoTrack){t.push(s);const c=this.localTrackMap.get(We.LocalVideoLowTrack);c&&t.push([We.LocalVideoLowTrack,c])}else t.push(s);return t}createMuteMessage(e){return e.map((t=>{var r;let s,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoTrack:s=$e(r=d._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalVideoLowTrack:s=Mr.Low}return{stream_type:s,ssrcs:h,mid:f}}))}createUnmuteMessage(e){return e.map((t=>{var r;let s,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoTrack:s=$e(r=d._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalVideoLowTrack:s=Mr.Low}return{stream_type:s,ssrcs:h,mid:f}}))}filterTobeUnSubscribedTracks(e,t){const r=[],s=this.remoteUserMap.get(e);if(!s)return r;if(t){const c=s.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(s.entries()).forEach((c=>{let[d,h]=c;r.push([e,{kind:d,id:h}])}));return r}filterTobeUnSubscribedDataChannels(e,t){const r=[];return t.forEach((s=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(s.id)&&r.push(s)})),r}createUnsubscribeMessage(e){const t=[];return e.forEach((r=>{let[s,{kind:c,id:d}]=r;switch(c){case ot.VIDEO:return void(s._videoSSRC&&t.push({stream_type:ot.VIDEO,ssrcId:s._videoSSRC}));case ot.AUDIO:return void(s._audioSSRC&&t.push({stream_type:ot.AUDIO,ssrcId:s._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((r=>{let[s,{kind:c}]=r;if(t.has(s)){let d=t.get(s);c===ot.VIDEO?d|=ds.Video:d|=ds.Audio,t.set(s,d)}else c===ot.VIDEO?t.set(s,ds.Video):t.set(s,ds.Audio)})),{users:Array.from(t.entries()).map((r=>{let[s,c]=r;return{stream_id:s.uid,stream_type:c}}))}}withdrawRemoteTracks(e){e.forEach((t=>{let[r,{kind:s}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(We.LocalVideoTrack),r=this.localTrackMap.get(We.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new nt(((s,c)=>{this.handleUpdateVideoEncoder(t.track,s,c,!0)}))),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new nt(((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Ao&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Ao&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,r){return e.map(((s,c)=>{var d;let{stream_type:h}=s;const f=(d=t.find((g=>{let{stream_type:v}=g;return h===v})))===null||d===void 0?void 0:d.attributes;if(f&&Z("DISABLE_SCREEN_SHARE_REMB")){const g=r[c]._hints;($e(g).call(g,Hr.SCREEN_TRACK)||$e(g).call(g,Hr.SCREEN_LOW_TRACK))&&(f.remb=!1,k.debug("disable remb for screen share, hints:",g))}return f}))}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Nn){var t;const s=this.filterTobeUnmutedTracks(e[r]);if(s.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(s.map((d=>{let[,{id:h}]=d;return h}))));const c=this.createUnmuteMessage(s);return void await Kr(this,Tt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Tt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ns(tO(this.dtlsFailedCount,Kn)),this.emit(Tt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Vs(this,Tt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Tt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(We.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof tn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof tn)).length>1)throw new Ne(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Nn)).length>1&&(e.some((t=>t instanceof Nn&&t._bypassWebAudio))||!vr().webAudioMediaStreamDest))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof tn&&this.pendingLocalTracks.some((r=>r instanceof tn)))throw new Ne(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Nn&&this.pendingLocalTracks.some((r=>r instanceof Nn))&&(!vr().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((r=>r instanceof Nn&&r._bypassWebAudio))))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;const s=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&vr().supportDualStreamEncoding,c=fd(fd({},{width:160,height:120,framerate:15,bitrate:50}),t);let d;d=s?e._mediaStreamTrack.clone():_1(e,c);const h=zr(8,"track-low-"),f=new tn(d,fd(fd({},s&&{scaleResolutionDownBy:JO(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return f.on(kf.TRANSCEIVER_UPDATED,(g=>{e._updateRtpTransceiver(g,x_.LOW_STREAM)})),f._hints.push(Hr.LOW_STREAM),$e(r=e._hints).call(r,Hr.SCREEN_TRACK)&&f._hints.push(Hr.SCREEN_LOW_TRACK),e.on("sei-to-send",(g=>{f.emit("sei-to-send",g)})),e.addListener(dt.NEED_CLOSE,(()=>{f.close()})),f}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ao){var c,d,h,f;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:E,peerConnectionState:C}=this.connection,{local:R,remote:A}=await this.connection.getSelectedCandidatePair();ft.pcStats(this.store.sessionId,{startTime:g,eventElapse:e-g||0,iceconnectionsate:v,dtlsstate:E,connectionstate:C,intSucc:t?1:2,error:this._iceError||s||"",selectedLocalCandidateProtocol:(c=R==null?void 0:R.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=R.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(R.address,":").concat(R.port),selectedRemoteCandidateProtocol:(h=A.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(f=A.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(A.address,":").concat(A.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,r=t.firstVideoFrameDecoded.find((E=>E.userId===e.uid));if(!r)return;const{isInternalUpload:s,isExternalUpload:c}=r;if(s&&c)return;const{subscribeEnd:d,firstPreRender:h,peerPublishDuration:f,peerPubStatusMs:g}=r;let{firstRender:v=0}=r;if(d&&(v||h)&&f&&g){r.isInternalUpload=!0;const{playEnd:E}=r;E&&(r.isExternalUpload=!0);const{firstPreRender:C=0}=r;v=C||v;const R=e.videoTrack,A={peer:e._uintid,width:(R==null?void 0:R._videoWidth)||0,height:(R==null?void 0:R._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:f,peerPubStatusMs:g,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:r.userJoinNotify||0,videoAddNotify:r.videoAddNotify||0,subscribeStart:r.subscribeStart||0,subscribeEnd:r.subscribeEnd||0,firstReceived:r.firstReceived||0,firstDecoded:r.firstDecoded||0,firstPreRender:C||0,firstRender:E?Math.max(v,E):Math.max(v,d),playStart:r.playStart||0,playEnd:r.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:x3(this.store)};ft.firstXLAPeerFirstVideoFrame(this.store.sessionId,A)}}reportVideoFirstFrameDecoded(e,t,r,s){var c;const d=Array.from(oa(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===e));if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find((g=>g.userId===d.uid&&g.type==="video"));ft.firstRemoteVideoDecode(this.store.sessionId,ss.FIRST_VIDEO_DECODE,ln.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:r,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:s?1:0,firstFrame:(f==null?void 0:f.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const c=s.get(t);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:r}]=e;t===We.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,x_.LOW_STREAM):r._updateRtpTransceiver(void 0)}))}},ht(sr.prototype,"startP2PConnection",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"startP2PConnection"),sr.prototype),ht(sr.prototype,"connect",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"connect"),sr.prototype),ht(sr.prototype,"updateRemoteRTPCapabilities",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"updateRemoteRTPCapabilities"),sr.prototype),ht(sr.prototype,"publishDataChannel",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"publishDataChannel"),sr.prototype),ht(sr.prototype,"unpublish",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"unpublish"),sr.prototype),ht(sr.prototype,"unpublishDataChannel",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"unpublishDataChannel"),sr.prototype),ht(sr.prototype,"unpublishLowStream",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"unpublishLowStream"),sr.prototype),ht(sr.prototype,"subscribeDataChannel",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"subscribeDataChannel"),sr.prototype),ht(sr.prototype,"subscribe",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"subscribe"),sr.prototype),ht(sr.prototype,"massSubscribe",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"massSubscribe"),sr.prototype),ht(sr.prototype,"unsubscribe",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"unsubscribe"),sr.prototype),ht(sr.prototype,"unsubscribeDataChannel",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"unsubscribeDataChannel"),sr.prototype),ht(sr.prototype,"massUnsubscribe",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"massUnsubscribe"),sr.prototype),ht(sr.prototype,"muteRemote",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"muteRemote"),sr.prototype),ht(sr.prototype,"unmuteRemote",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"unmuteRemote"),sr.prototype),ht(sr.prototype,"hasRemoteMediaWithLock",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"hasRemoteMediaWithLock"),sr.prototype),ht(sr.prototype,"disconnectForReconnect",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"disconnectForReconnect"),sr.prototype),ht(sr.prototype,"updateBitrateLimit",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"updateBitrateLimit"),sr.prototype),ht(sr.prototype,"remoteMediaSsrcChanged",[yi],Object.getOwnPropertyDescriptor(sr.prototype,"remoteMediaSsrcChanged"),sr.prototype),sr);function yi(e,t,r){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(t));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},r}function Z5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function eB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Z5(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z5(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const Ane=Date.now(),Ine=20,v1=new Map,GT=new Map;async function tB(e){const t=v1.get(e),r=Array.isArray(t)&&t[t.length-1],s=GT.get(e);if(!r)return void(s.isSyncing=!1);const c={uid:r.uid,payload:r.payload};s.firstRecvTs===0&&(s.firstRecvTs=r.recvTs,s.firstSendTs=r.sendTs);const d=r.sendTs-s.firstSendTs,h=d-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-d);let f=r.mediaDelay+h;f<=0?(t.pop(),rB(r.context,c),f=0):f=Math.min(f,Ine),setTimeout((()=>t.length&&tB(e)),f)}function rB(e,t){e.safeEmit(ir.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function One(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return rB(r,{uid:e.uid,payload:e.payload});const s="".concat(r.id,"-").concat(e.uid),c=v1.get(s)||[],d=c.findIndex((v=>e.sendTs>=v.sendTs)),h=eB(eB({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),v1.set(s,c);let f=!1;var g;GT.has(s)?f=!((g=GT.get(s))===null||g===void 0||!g.isSyncing):GT.set(s,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||tB(s)}const kne=fr().name;function nB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function sB(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nB(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nB(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const H_="websdk_ng_cache_parameter",Pne=Z("MAX_PRELOAD_ASYNC_LENGTH"),Dne=1e4,Wf=new Map,qf=[];let E1=null,w1=0,b1=0;const HT=new Map,jne=(function(e,t){const r=[];let s=0;const c=async()=>{const d=r.shift();d&&await d(),r.length>0&&s<t?c():s--};return async function(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];return new nt((async(g,v)=>{r.push((async()=>{try{const E=await e(...h);g(E)}catch(E){v(E)}})),s<t&&(s++,c())}))}})(iB,Pne),S1=qi.CancelToken.source();async function iB(e,t,r,s,c,d){try{if(!Z("ENABLE_PRELOAD"))return;if(!vr().supportWebCrypto)return void Th((()=>{k.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!r&&r!==null)throw new Ne(J.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&Rs(r,"token",1,2047),Rs(e,"appid",1,2047),vT(t),s&&ET(s);const h=If();k.debug("preload channel ".concat(t,", uid is ").concat(s));const f={appId:e,cname:t,token:r||e,uid:typeof s!="string"?s:null,sid:h,proxyServer:c};let g,v;typeof s=="string"?(f.stringUid=s,[v,g]=await nt.all([yne(s,{sid:h,appId:e},S1.token),O5(sB(sB({},f),{},{token:r||e,uid:0}),S1.token)]),f.uid=v.uid,g.gatewayInfo.uid=f.uid,g.gatewayInfo.res.uid=f.uid):(d&&(f.stringUid=d),g=await O5(f,S1.token));const E={sid:h,appId:e,cname:t,token:r||e,uid:f.stringUid||s,intUid:f.uid||g.gatewayInfo.uid,stringUid:f.stringUid,ts:Date.now(),sua:v,ap:g};await(async function(C){let R;try{C.uid&&oB({appId:C.appId,cname:C.cname,token:C.token,uid:C.uid,stringUid:C.stringUid});const A=uB(C),B=await(async function(U,X){try{const Y=await window.crypto.subtle.importKey("raw",J4(X),"AES-GCM",!1,["encrypt"]),ee=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,Af(window.btoa(JSON.stringify(U))));return Ch(new Uint8Array(ee))}catch{return}})(C,C.token||C.appId);if(!B)return;R=dB(H_);const L=R?JSON.parse(R):[];L.push({[A]:B}),L.length>Z("AP_CACHE_NUM")&&L.shift(),KT(H_,JSON.stringify(L))}catch(A){k.warn("Error caching server parameters:",A.message),KT(H_,"")}})(E),w1++}catch(h){throw b1++,(function(f){E1||(E1=window.setTimeout((()=>{let v="";HT.forEach(((E,C)=>{v+="".concat(C,": ").concat(E," ;")})),ft.reportApiInvoke(null,{name:In.PRELOAD,options:{success:w1,failed:b1,err:v}}).onError(f),w1=0,b1=0,HT.clear(),E1=null}),Dne));const g=HT.get(f.code)||0;HT.set(f.code,g+1)})(h),h}}async function aB(e){try{if(Z("AP_REQUEST_DETAIL")||Z("ENABLE_ROLE_SELECT_EDGE"))return;const t=oB(e);if(!t||e.cloudProxyServer!=="disabled")return;const r=await(async function(s,c){try{const d=await window.crypto.subtle.importKey("raw",J4(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,Af(s));return JSON.parse(window.atob(Ch(new Uint8Array(h))))}catch{return}})(t,e.token||e.appId);if(!r||!(function(s,c){return s.cname===c.cname&&s.appId===c.appId&&s.token===c.token?c.stringUid?s.stringUid===c.stringUid:typeof c.uid=="number"?s.uid===c.uid:s.uid==c.uid:!1})(r,e))return;if(r&&Date.now()-r.ts<Z("AP_CACHE_LIFETIME"))return r}catch(t){k.warn("Error get preloadInfo",t.message)}}function oB(e){let t;try{if(t=dB(H_),!t)return;const r=JSON.parse(t),s=uB(e),c=(function(h,f){for(let g=h.length-1;g>=0;g--)if(f(h[g]))return g;return-1})(r,(h=>s in h));if(c===-1)return;const d=r.splice(c,1)[0];return KT(H_,JSON.stringify(r)),d[s]}catch(r){k.warn("Error delete preload info: ".concat(t),r.message),KT(H_,"")}}function x1(e){if(e){let t=Wf.get(e);t&&(window.clearTimeout(t),t=null,Wf.delete(e)),$e(qf).call(qf,e)||e.cloudProxyServer!=="disabled"||qf.push(e)}if(Wf.size<Z("AP_CACHE_NUM")&&qf.length>0){const t=qf.shift();Wf.set(t,window.setTimeout((async()=>{const{appId:r,cname:s,token:c,stringUid:d,uid:h,proxyServer:f}=t;try{await jne(r,s,c,h,f,d),Wf.has(t)&&x1(t)}catch(g){k.warn("update preload failed",g.message),cB(t)}}),Z("AP_UPDATE_INTERVAL")))}}function cB(e){const t=qf.indexOf(e);t!==-1&&qf.splice(t,1);let r=Wf.get(e);r&&(window.clearTimeout(r),r=null,Wf.delete(e),x1())}function lB(e,t){const r=e.sua,s=e.ap;t&&r&&ft.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),ft.reportResourceTiming(e.ap.url,e.sid),ft.joinWebProxyAP(e.sid,{lts:s.requestTime,elapse:s.elapse,sucess:1,apServerAddr:s.url,turnServerAddrList:s.proxyInfo.addresses.map((c=>c.ip)).join(","),eventType:"disabled",unilbsServerIds:[Fn.CHOOSE_SERVER,Fn.CLOUD_PROXY_FALLBACK].toString()}),ft.joinChooseServer(e.sid,{lts:s.requestTime,elapse:s.elapse,succ:!0,csAddr:s.url,opid:s.opid,serverList:s.gatewayInfo.gatewayAddrs.map((c=>c.address)),ec:null,cid:s.gatewayInfo.cid.toString(),uid:s.gatewayInfo.uid.toString(),csIp:s.gatewayInfo.csIp,unilbsServerIds:[Fn.CHOOSE_SERVER].toString(),isHttp3:s.isHttp3})}function dB(e){return window.atob(window.localStorage.getItem(e)||"")}function KT(e,t){window.localStorage.setItem(e,window.btoa(t))}function uB(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),s3(t)}function Lne(e){let t=(function(){const r=Fne.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(r,s){let c=r.appId;c!==void 0&&(Vn(s,10),Fh(s,c));let d=r.cid;d!==void 0&&(Vn(s,16),Vn(s,d));let h=r.cname;h!==void 0&&(Vn(s,26),Fh(s,h));let f=r.deviceId;f!==void 0&&(Vn(s,34),Fh(s,f));let g=r.elapse;g!==void 0&&(Vn(s,40),Vh(s,g));let v=r.fileSize;v!==void 0&&(Vn(s,48),Vh(s,K_(v)));let E=r.height;E!==void 0&&(Vn(s,56),Vh(s,K_(E)));let C=r.jpg;C!==void 0&&(Vn(s,66),Vn(s,C.length),pB(s,C));let R=r.networkType;R!==void 0&&(Vn(s,72),Vh(s,K_(R)));let A=r.osType;A!==void 0&&(Vn(s,80),Vh(s,K_(A)));let B=r.requestId;B!==void 0&&(Vn(s,90),Fh(s,B));let L=r.sdkVersion;L!==void 0&&(Vn(s,98),Fh(s,L));let U=r.sequence;U!==void 0&&(Vn(s,104),Vh(s,K_(U)));let X=r.sid;X!==void 0&&(Vn(s,114),Fh(s,X));let Y=r.timestamp;Y!==void 0&&(Vn(s,120),Vh(s,Y));let ee=r.uid;ee!==void 0&&(Vn(s,128),Vn(s,ee));let ue=r.vid;ue!==void 0&&(Vn(s,136),Vn(s,ue));let de=r.width;de!==void 0&&(Vn(s,144),Vh(s,K_(de)));let ne=r.service;ne!==void 0&&(Vn(s,152),Vn(s,ne));let be=r.callbackData;be!==void 0&&(Vn(s,162),Vn(s,be.length),pB(s,be));let Ae=r.ticket;Ae!==void 0&&(Vn(s,170),Fh(s,Ae));let Ue=r.vendorConfigs;Ue!==void 0&&(Vn(s,178),Fh(s,Ue))})(e,t),(function(r){let s=r.bytes,c=r.limit;return s.length===c?s:s.subarray(0,c)})(t)}function Mne(e){return(function(r){let s={};e:for(;!Vne(r);){let c=LE(r);switch(c>>>3){case 0:break e;case 1:s.code=LE(r);break;case 2:s.msg=fB(r,LE(r));break;case 3:s.requestId=fB(r,LE(r));break;case 4:s.timestamp=Bne(r,!1);break;default:Une(r,7&c)}}return s})({bytes:t=e,offset:0,limit:t.length});var t}function Une(e,t){switch(t){case 0:for(;128&hc(e););break;case 2:T1(e,LE(e));break;case 5:T1(e,4);break;case 1:T1(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function K_(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Fne=[];function T1(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Vne(e){return e.offset>=e.limit}function zT(e,t){let r=e.bytes,s=e.offset,c=e.limit,d=s+t;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),s}function hB(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function pB(e,t){let r=zT(e,t.length);e.bytes.set(t,r)}function fB(e,t){let r=hB(e,t),s=String.fromCharCode,c=e.bytes,d="",h="";for(let f=0;f<t;f++){let g,v,E,C,R=c[f+r];(128&R)==0?h+=s(R):(224&R)==192?f+1>=t?h+=d:(g=c[f+r+1],(192&g)!=128?h+=d:(C=(31&R)<<6|63&g,C<128?h+=d:(h+=s(C),f++))):(240&R)==224?f+2>=t?h+=d:(g=c[f+r+1],v=c[f+r+2],(49344&(g|v<<8))!=32896?h+=d:(C=(15&R)<<12|(63&g)<<6|63&v,C<2048||C>=55296&&C<=57343?h+=d:(h+=s(C),f+=2))):(248&R)==240?f+3>=t?h+=d:(g=c[f+r+1],v=c[f+r+2],E=c[f+r+3],(12632256&(g|v<<8|E<<16))!=8421504?h+=d:(C=(7&R)<<18|(63&g)<<12|(63&v)<<6|63&E,C<65536||C>1114111?h+=d:(C-=65536,h+=s(55296+(C>>10),56320+(1023&C)),f+=3))):h+=d}return h}function Fh(e,t){let r=t.length,s=0;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}Vn(e,s);let c=zT(e,s),d=e.bytes;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),f<128?d[c++]=f:(f<2048?d[c++]=f>>6&31|192:(f<65536?d[c++]=f>>12&15|224:(d[c++]=f>>18&7|240,d[c++]=f>>12&63|128),d[c++]=f>>6&63|128),d[c++]=63&f|128)}}function hc(e){return e.bytes[hB(e,1)]}function mB(e,t){let r=zT(e,1);e.bytes[r]=t}function LE(e){let t,r=0,s=0;do t=hc(e),r<32&&(s|=(127&t)<<r),r+=7;while(128&t);return s}function Vn(e,t){for(t>>>=0;t>=128;)mB(e,127&t|128),t>>>=7;mB(e,t)}function Bne(e,t){let r,s=0,c=0,d=0;return r=hc(e),s=127&r,128&r&&(r=hc(e),s|=(127&r)<<7,128&r&&(r=hc(e),s|=(127&r)<<14,128&r&&(r=hc(e),s|=(127&r)<<21,128&r&&(r=hc(e),c=127&r,128&r&&(r=hc(e),c|=(127&r)<<7,128&r&&(r=hc(e),c|=(127&r)<<14,128&r&&(r=hc(e),c|=(127&r)<<21,128&r&&(r=hc(e),d=127&r,128&r&&(r=hc(e),d|=(127&r)<<7))))))))),{low:s|c<<28,high:c>>>4|d<<24,unsigned:t}}function Vh(e,t){let r=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?s===0?r<16384?r<128?1:2:r<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=zT(e,d),f=e.bytes;switch(d){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=d!==9?128|c:127&c;case 8:f[h+7]=d!==8?s>>>21|128:s>>>21&127;case 7:f[h+6]=d!==7?s>>>14|128:s>>>14&127;case 6:f[h+5]=d!==6?s>>>7|128:s>>>7&127;case 5:f[h+4]=d!==5?128|s:127&s;case 4:f[h+3]=d!==4?r>>>21|128:r>>>21&127;case 3:f[h+2]=d!==3?r>>>14|128:r>>>14&127;case 2:f[h+1]=d!==2?r>>>7|128:r>>>7&127;case 1:f[h]=d!==1?128|r:127&r}}const gB={},_B={},$T=4294967296,Wne=$T*$T,yB=Wne/2;EB(0,!0);const vB=EB(0),qne=ME(0,-2147483648,!1),Gne=ME(-1,2147483647,!1);function EB(e,t){let r,s,c;return t?(c=0<=(e>>>=0)&&e<256)&&(s=_B[e],s)?s:(r=ME(e,0,!0),c&&(_B[e]=r),r):(c=-128<=(e|=0)&&e<128)&&(s=gB[e],s)?s:(r=ME(e,e<0?-1:0,!1),c&&(gB[e]=r),r)}function ME(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function wB(e,t){if(isNaN(e))return vB;{if(e<=-yB)return qne;if(e+1>=yB)return Gne}return e<0?vB:ME(e%$T|0,e/$T|0,t)}function bB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}class C1 extends _n{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(ll.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var r;super(),H(this,"name","AgoraRTCImageModeration"),H(this,"_connectionState",No.CONNECTING),H(this,"_sequence",0),H(this,"_moderationStartTime",void 0),H(this,"_workerConnection",void 0),H(this,"_workerMessageLengthLimit",void 0),H(this,"_qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",qi.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"_moderationInterval",void 0),H(this,"_moderationTimer",null),H(this,"_moderationMode",1),H(this,"_quality",1),H(this,"_qualityTimer",null),H(this,"_ticket",void 0),H(this,"_moderationIntervalMinimum",void 0),H(this,"_uploadFailedNum",0),H(this,"_uploadNum",0),H(this,"_uploadTimer",null),H(this,"_extraInfo",void 0),H(this,"_vendor",""),H(this,"_encoder",new TextEncoder),H(this,"_moderationId",void 0),H(this,"inspectImage",(()=>{if(this.connectionState!==No.CONNECTED)throw new Ce(J.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===No.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=zr(5,"image-moderation-"),this._workerMessageLengthLimit=Z("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Z("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=Z("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new CE("worker-"+this._moderationId,Kn),this.on(ll.STATE_CHANGE,((s,c)=>{k.debug("[".concat(this._moderationId,"] Moderation operation :").concat(j_[s]," ").concat(c||""))})),this.handleWorkerEvents()}async init(t,r){this.emit(ll.STATE_CHANGE,j_.CONNECT_AP),this._connectInfo=t;const s=this._cancelTokenSource.token;return this._retryConfig=r,new nt(((c,d)=>{this.on(ll.CONNECTION_STATE_CHANGE,((h,f)=>{h===No.CONNECTED&&c()})),this.requestAP(t,s,r).then((h=>{this.connectWorker(h)})).catch((h=>{d(h)}))}))}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),k.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===No.CONNECTED&&this.inspectImage()}async requestAP(t,r,s){const c=Z("WEBCS_DOMAIN").map((g=>"https://".concat(g,"/api/v1"))),d=await(function(g,v,E,C){let{appId:R,areaCode:A,cname:B,sid:L,token:U,uid:X}=v;B_++;const Y="moderation_plugin",ee={service_name:Y,json_body:JSON.stringify({appId:R,areaCode:A,cname:B,command:"allocateEdge",requestId:B_,seq:B_,sid:L,appToken:U,ts:Date.now(),uid:X+""})};let ue,de,ne=g[0];return il((async()=>{ue=Date.now();const be=await dl(ne,{data:ee,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(de=Date.now()-ue,be.code!==0){const He=new Ce(J.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+be.code,{retry:!0,responseTime:de});throw k.error(He.toString()),He}const Ae=JSON.parse(be.json_body);if(Ae.code!==200){const He=new Ce(J.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ae.code,", reason: ").concat(Ae.reason),{code:Ae.code,responseTime:de});throw k.error(He.toString()),He}if(!Ae.servers||!Array.isArray(Ae.servers)||Ae.servers.length===0){const He=new Ce(J.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ae.code,responseTime:de});throw k.error(He.toString()),He}if(!Ae.servers.some((He=>!!He.wss))){const He=new Ce(J.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ae.code,responseTime:de});throw k.error(He.toString()),He}const Ue=Z("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ae.servers.map((He=>{let{address:Yt,wss:Qt}=He;if(Yt&&Qt)return"wss://".concat(Yt.replace(/\./g,"-"),".").concat(Ue,":").concat(Qt,"/moderation")})).filter((He=>!!He)),workerToken:Ae.workerToken,vid:Ae.vid,ticket:Ae.appTicket,responseTime:de}}),((be,Ae)=>(ft.apworkerEvent(L,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(be.addressList),firstSuccess:Ae===0,responseTime:de,serverIp:g[Ae%g.length]}),!1)),((be,Ae)=>(ft.apworkerEvent(L,{success:!1,sc:be.data&&be.data.code||200,serviceName:Y,responseTime:de,serverIp:g[Ae%g.length]}),!!(be.code!==J.OPERATION_ABORTED&&be.code!==J.UNEXPECTED_RESPONSE||be.data&&be.data.retry)&&(ne=g[(Ae+1)%g.length],!0))),C)})(c,t,r,s);this.emit(ll.STATE_CHANGE,j_.AP_CONNECTED);const{addressList:h,ticket:f}=d;return this._ticket=f,h}async connectWorker(t){this.emit(ll.STATE_CHANGE,j_.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Kt.CONNECTED,(async()=>{this.emit(ll.STATE_CHANGE,j_.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=No.CONNECTED})),this._workerConnection.on(Kt.CLOSED,(()=>{this.connectionState=No.CLOSED})),this._workerConnection.on(Kt.FAILED,(()=>{this.connectionState=No.CLOSED})),this._workerConnection.on(Kt.RECONNECTING,(()=>{this.connectionState=this.connectionState===No.CONNECTED?No.RECONNECTING:No.CONNECTING})),this._workerConnection.on(Kt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const r=Mne(new Uint8Array(t.data));Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,k.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{ft.reportApiInvoke(this._connectInfo.sid||null,{name:In.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:un.TRACER}).onError(new Ce(J.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null}),Z("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else k.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Kt.WILL_RECONNECT,((t,r,s)=>{t==="recover"&&s(t),s("tryNext")})),this._workerConnection.on(Kt.REQUEST_NEW_URLS,((t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Ga(this,ll.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being played can be inspected"));this._sequence++;const s=await this.generateRequestData(t,r);this._workerConnection.sendMessage(s,!0,!0)}else Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&k.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:s,cname:c,cid:d,vid:h,sid:f,uid:g}=r;const v=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),C=await z3(E,s,c),R=this._sequence+"-"+d+"-"+g+"-"+v+"-"+zr(12,""),A={appId:s,cid:d,cname:c,deviceId:"",elapse:C1.intToLong(Number(v-this._moderationStartTime)),fileSize:E.buffer.byteLength,height:E.height,width:E.width,jpg:C,networkType:6,osType:7,requestId:R,sdkVersion:"4.24.0",sequence:this._sequence,sid:f,timestamp:wB(v),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete A.callbackData;const B=Lne(A);if(B.byteLength<this._workerMessageLengthLimit){if(Z("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const L=(function(U){for(var X=1;X<arguments.length;X++){var Y=arguments[X]!=null?arguments[X]:{};X%2?bB(Object(Y),!0).forEach((function(ee){H(U,ee,Y[ee])})):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(Y)):bB(Object(Y)).forEach((function(ee){Object.defineProperty(U,ee,Object.getOwnPropertyDescriptor(Y,ee))}))}return U})({},A);delete L.jpg,k.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(L))}return B}{const L=this.quality*this._qualityRatio;return this.quality=L,await this.generateRequestData(t,{appId:s,cname:c,cid:d,vid:h,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=qi.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=No.CLOSED,this.emit(ll.STATE_CHANGE,j_.CLOSED)}}function SB(e){if(Gr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Ce(J.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Ce(J.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Hne={name:"ImageModeration",create:function(e){let{config:t}=e;return SB(t),new C1(t)}};var xB,TB,CB,RB,NB,AB,IB,OB,kB,PB,DB,jB,LB,MB,UB,FB,VB,BB,WB,qB,GB,HB,KB,zB,$B,YB,XB,JB,QB,ZB,e6,t6,r6,n6,s6,i6,a6,o6,c6,l6,d6,at;function u6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function pc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u6(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u6(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}Xs.setLogger(k);let Kne=(xB=It(),TB=It({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof R_))return[t];t=[t]}return t.map((r=>r?Object(r).toString():"null"))}}),CB=It({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==C_.DATA?(Array.isArray(t)||(t=[t]),t.map((r=>r.getTrackId()))):[t.getChannelId()])}),RB=It({argsMap:(e,t,r,s)=>[typeof t=="object"?t.uid:t,r,s]}),NB=It({argsMap:(e,t,r)=>[t,r]}),AB=It({argsMap:(e,t)=>t.map((r=>{let{user:s,mediaType:c}=r;return[s==null?void 0:s.uid,c]}))}),IB=It({argsMap:(e,t,r,s)=>[typeof t=="object"?t.uid:t,r,s]}),OB=It({argsMap:(e,t)=>t.map((r=>{let{user:s,mediaType:c}=r;return{uid:s==null?void 0:s.uid,mediaType:c}}))}),kB=It(),PB=It(),DB=It(),jB=It(),LB=It(),MB=It(),UB=It(),FB=It(),VB=It(),BB=It(),WB=It(),qB=It(),GB=It(),HB=It(),KB=It(),zB=It({argsMap:(e,t)=>[t]}),$B=It(),YB=It(),XB=It(),JB=It(),QB=It(),ZB=It(),e6=It(),t6=It(),r6=It({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),n6=It(),s6=It(),i6=It(),a6=It(),o6=It(),c6=It(),l6=It({reportResult:!0}),d6=It(),at=class extends _n{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),H(this,"store",void 0),H(this,"_uid",void 0),H(this,"_channelName",void 0),H(this,"_uintUid",void 0),H(this,"_users",[]),H(this,"_config",void 0),H(this,"_clientId",void 0),H(this,"_appId",void 0),H(this,"_sessionId",null),H(this,"_key",void 0),H(this,"_rtmConfig",{}),H(this,"_joinInfo",void 0),H(this,"_gateway",void 0),H(this,"_statsCollector",void 0),H(this,"_configDistribute",void 0),H(this,"_leaveMutex",void 0),H(this,"_publishMutex",void 0),H(this,"_renewTokenMutex",void 0),H(this,"_subscribeMutex",void 0),H(this,"_encryptionMode","none"),H(this,"_encryptionSecret",null),H(this,"_encryptionSalt",null),H(this,"_encryptDataStream",!1),H(this,"_encryptDataStreamKey",null),H(this,"_encryptDataStreamIv",null),H(this,"_proxyServer",void 0),H(this,"_turnServer",{servers:[],mode:"auto"}),H(this,"_cloudProxyServerMode","disabled"),H(this,"_isDualStreamEnabled",!1),H(this,"_defaultStreamFallbackType",void 0),H(this,"_lowStreamParameter",void 0),H(this,"_streamFallbackTypeCacheMap",new Map),H(this,"_remoteStreamTypeCacheMap",new Map),H(this,"_axiosCancelSource",qi.CancelToken.source()),H(this,"_audioVolumeIndicationInterval",void 0),H(this,"_networkQualityInterval",void 0),H(this,"_userOfflineTimeout",void 0),H(this,"_streamRemovedTimeout",void 0),H(this,"_liveTranscodeStreamingClient",void 0),H(this,"_liveRawStreamingClient",void 0),H(this,"_channelMediaRelayClient",void 0),H(this,"_networkQualitySensitivity","normal"),H(this,"_p2pChannel",void 0),H(this,"_useLocalAccessPoint",!1),H(this,"_setLocalAPVersion",void 0),H(this,"_joinAndNotLeaveYet",!1),H(this,"_numberOfJoinCount",0),H(this,"_joinResponse",null),H(this,"_remoteDefaultVideoStreamType",void 0),H(this,"_inspect",void 0),H(this,"_moderation",void 0),H(this,"_license",void 0),H(this,"_pendingPublishedUsers",[]),H(this,"ntpAlignErrorCount",0),H(this,"remoteInboundOffset",0),H(this,"_peerConnectionState",void 0),H(this,"_handleLocalTrackEnable",((c,d,h)=>{this.publish(c,!1).then(d).catch(h)})),H(this,"_handleLocalTrackDisable",((c,d,h)=>{this.unpublish(c).then(d).catch(h)})),H(this,"_handleUserOnline",(c=>{if(Z("BLOCK_LOCAL_CLIENT")&&Uf(c.uid,this.channelName))return void k.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&k.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find((h=>h.uid===c.uid));if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(ir.USER_JOINED,d));else{const h=new Mh(c.uid,c.uint_id||c.uid);this._users.push(h),k.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(ir.USER_JOINED,h)}})),H(this,"_handleUserOffline",(c=>{if(Z("BLOCK_LOCAL_CLIENT")&&Uf(c.uid,this.channelName))return;const d=this._users.find((h=>h.uid===c.uid));d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:$x(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),k.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(ir.USER_LEAVED,d,c.reason))})),H(this,"_handleAddAudioOrVideoStream",((c,d,h,f,g,v,E,C)=>{if(Z("BLOCK_LOCAL_CLIENT")&&Uf(d,this.channelName))return;const R=this._users.find((B=>B.uid===d));if(!R)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(R.uid,{videoAddNotify:Date.now()});const A=c==="audio"?R.hasAudio:R.hasVideo;if(R._uintid||(R._uintid=v||d),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),f!==void 0&&(R._cname=f),E&&(R._audioOrtc=E)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),f!==void 0&&(R._cname=f),C!==void 0&&(R._rtxSsrcId=C),E&&(R._videoOrtc=E)),(c==="audio"?R.hasAudio:R.hasVideo)&&!A&&(k.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(ir.USER_PUBLISHED,R,c)),c==="video"?ft.onGatewayStream(this._sessionId,ss.ON_ADD_VIDEO_STREAM,ln.ON_ADD_VIDEO_STREAM,{peer:v||d,ssrc:R._videoSSRC}):ft.onGatewayStream(this._sessionId,ss.ON_ADD_AUDIO_STREAM,ln.ON_ADD_AUDIO_STREAM,{peer:v||d,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then((B=>{if(B&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof jE))return this._p2pChannel.unsubscribe(R,c,!0).then((()=>this._subscribe(R,c,!0).catch((L=>{k.error("[".concat(this._clientId,"] resubscribe error"),L.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch((B=>{k.error("[".concat(this._clientId,"] resubscribe error"),B.toString())}))),c==="video"&&!Us()&&!ii()){const B=this._getEncodingName(g);(B==null?void 0:B.toLocaleLowerCase())==yE.av1&&_ne().then((L=>{L||this._gateway.downgradeCodec(B)}))}})),H(this,"_handleRemoveStream",(c=>{if(Z("BLOCK_LOCAL_CLIENT")&&Uf(c.uid,this.channelName))return;const d=this._users.find((f=>f.uid===c.uid));if(!d)return void k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));k.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(ir.USER_UNPUBLISHED,d,"audio"),k.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(ir.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(ir.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(ir.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof jE&&this._p2pChannel.unsubscribe(d).then((f=>{if(f)return this._gateway.unsubscribe(f,d.uid)})),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),ft.onGatewayStream(this._sessionId,ss.ON_REMOVE_STREAM,ln.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()})),H(this,"_handleSetStreamLocalEnable",((c,d,h)=>{if(Z("BLOCK_LOCAL_CLIENT")&&Uf(d,this.channelName))return;const f=this._users.find((E=>E.uid===d));if(!f)return void k.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));k.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const g=c==="audio"?f.hasAudio:f.hasVideo;if(c==="audio"){f._trust_audio_enabled_state_=!0;const E=f._audio_enabled_;if(f._audio_enabled_=h,f._audio_enabled_===E)return;{const C=f._audio_enabled_?"enable-local-audio":"disable-local-audio";k.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(C)),this.safeEmit(ir.USER_INFO_UPDATED,d,C)}}else{f._trust_video_enabled_state_=!0;const E=f._video_enabled_;if(f._video_enabled_=h,f._video_enabled_===E)return;{const C=f._video_enabled_?"enable-local-video":"disable-local-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(C)),this.safeEmit(ir.USER_INFO_UPDATED,d,C)}}const v=c==="audio"?f.hasAudio:f.hasVideo;return g!==v?!g&&v?(k.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(ir.USER_PUBLISHED,f,c)):(c==="video"&&f._videoTrack&&f._videoTrack._destroy(),c==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,c),k.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(ir.USER_UNPUBLISHED,f,c)):void 0})),H(this,"_handleMuteStream",((c,d,h)=>{if(Z("BLOCK_LOCAL_CLIENT")&&Uf(c,this.channelName))return;k.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const f=this._users.find((E=>E.uid===c));if(!f)return void k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=d==="audio"?f.hasAudio:f.hasVideo;if(d==="audio"){f._trust_audio_mute_state_=!0;const E=f._audio_muted_;if(f._audio_muted_=h,f._audio_muted_===E)return;{const C=f._audio_muted_?"mute-audio":"unmute-audio";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(C)),this.safeEmit(ir.USER_INFO_UPDATED,c,C)}}else{f._trust_video_mute_state_=!0;const E=f._video_muted_;if(f._video_muted_=h,f._video_muted_===E)return;{const C=f._video_muted_?"mute-video":"unmute-video";k.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(C)),this.safeEmit(ir.USER_INFO_UPDATED,c,C)}}const v=d==="audio"?f.hasAudio:f.hasVideo;if(g!==v){if(!g&&v)return(d==="audio"?f._audioSSRC:f._videoSSRC)?(k.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(ir.USER_PUBLISHED,f,d)):void k.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&f._videoTrack&&!f._video_pre_subscribed&&f._videoTrack._destroy(),d==="audio"&&f._audioTrack,this._p2pChannel.muteRemote(f,d),k.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(ir.USER_UNPUBLISHED,f,d)}})),H(this,"_handleP2PLost",(async c=>{k.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():k.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)})),H(this,"_handleTokenWillExpire",(()=>{k.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ir.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),H(this,"_handleBeforeUnload",(c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),k.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),H(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(ir.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ir.NETWORK_QUALITY,c)})),H(this,"_handleP2PAddAudioOrVideoStream",((c,d,h,f)=>{const g=this._users.find((E=>E.uid===d));if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));k.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),f!==void 0&&(g._audioMid=f)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),f!==void 0&&(g._videoMid=f)),(c==="audio"?g.hasAudio:g.hasVideo)&&!v&&(k.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(ir.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(k.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch((E=>{k.error("[".concat(this._clientId,"] resubscribe error"),E.toString())})))})),this._config=e,this._clientId=t||zr(5,"client-"),this.store=new class{constructor(c,d,h,f){Ut(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:f,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Of.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=(function(d,h){switch(h.type){case Ft.SET_SESSION_ID:return Ke(Ke({},d),{},{sessionId:h.sessionId});case Ft.SET_P2P_ID:return Ke(Ke({},d),{},{p2pId:h.p2pId});case Ft.SET_UID:return Ke(Ke({},d),{},{uid:h.uid});case Ft.SET_INT_UID:return Ke(Ke({},d),{},{intUid:h.intUid});case Ft.SET_PUB_ID:return Ke(Ke({},d),{},{pubId:h.pubId});case Ft.KEY_METRIC_CLIENT_CREATED:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{clientCreated:h.metric})});case Ft.KEY_METRIC_JOIN_START:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{joinStart:h.metric})});case Ft.KEY_METRIC_PRELOAD_START:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{preloadStart:h.metric})});case Ft.KEY_METRIC_PRELOAD_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{preloadEnd:h.metric})});case Ft.KEY_METRIC_JOIN_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{joinEnd:h.metric})});case Ft.KEY_METRIC_REQUEST_AP_START:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{requestAPStart:h.metric})});case Ft.KEY_METRIC_REQUEST_AP_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{requestAPEnd:h.metric})});case Ft.KEY_METRIC_REQUEST_SUA_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case Ft.KEY_METRIC_BEFORE_CONNECT:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{beforeConnect:h.metric})});case Ft.KEY_METRIC_PEER_RECEIVER:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{peerReceiver:h.metric})});case Ft.KEY_METRIC_SIGNAL_CONNECTED:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{signalConnected:h.metric})});case Ft.KEY_METRIC_JOIN_REQ:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{joinReq:h.metric})});case Ft.KEY_METRIC_JOIN_REP:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{joinRep:h.metric})});case Ft.KEY_METRIC_JOIN_GATEWAY_START:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case Ft.KEY_METRIC_JOIN_GATEWAY_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case Ft.KEY_METRIC_PEER_CONNECTION_START:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case Ft.KEY_METRIC_PEER_CONNECTION_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case Ft.KEY_METRIC_DESCRIPTION_START:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{descriptionStart:h.metric})});case Ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case Ft.KEY_METRIC_ICE_CONNECTION_END:return Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case Ft.KEY_METRIC_PUBLISH:{const f=d.keyMetrics.publish,g=f.findIndex((v=>v.trackId===h.metric.trackId));return g!==-1?(f[g]=Ke(Ke({},f[g]),h.metric),Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{publish:[...f]})})):Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case Ft.KEY_METRIC_SUBSCRIBE:{const f=d.keyMetrics.subscribe,g=f.findIndex((v=>v.userId===h.metric.userId&&v.type===h.metric.type));return g!==-1?(f[g]=Ke(Ke({},f[g]),h.metric),Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{subscribe:[...f]})})):Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case Ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const f=d.keyMetrics.firstVideoFrameDecoded,g=f.findIndex((v=>v.userId===h.metric.userId));return g!==-1?(f[g]=Ke(Ke({},f[g]),h.metric),Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{firstVideoFrameDecoded:[...f]})})):Ke(Ke({},d),{},{keyMetrics:Ke(Ke({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case Ft.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case Ft.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case Ft.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Ke(Ke({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case Ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case Ft.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case Ft.SET_USE_P2P:return Ke(Ke({},d),{},{useP2P:h.val});case Ft.SET_TRANSPORT_TYPE:return Ke(Ke({},d),{},{p2pTransport:h.val});default:return d}})(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:Ft.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Ft.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Ft.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Ft.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Ft.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Ft.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Ft.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Ft.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Ft.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Ft.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ft.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:Ft.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:Ft.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:Ft.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ft.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ft.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:Ft.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:Ft.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:Ft.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:Ft.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:Ft.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:Ft.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ft.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ft.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ft.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ft.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:Ft.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ke({userId:c},d)})}descriptionStart(){this.dispatch({type:Ft.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ft.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ft.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,f){this.dispatch({type:Ft.KEY_METRIC_PUBLISH,metric:Ke(Ke({trackId:c,type:d},h&&{publishStart:h}),f&&{publishEnd:f})})}subscribe(c,d,h,f,g,v,E){this.dispatch({type:Ft.KEY_METRIC_SUBSCRIBE,metric:Ke(Ke(Ke(Ke(Ke({userId:c,type:d},h&&{subscribeStart:h}),f&&{subscribeEnd:f}),g&&{firstFrame:g}),v&&{streamAdded:v}),E&&{firstDecoded:E})})}massSubscribe(c,d,h,f){c.forEach((g=>{this.dispatch({type:Ft.KEY_METRIC_SUBSCRIBE,metric:Ke(Ke(Ke({userId:g.userId,type:g.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),f&&{firstFrame:f})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map((h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof d!="number"?(this.dispatch({type:Ft.RECORD_JOIN_CHANNEL_SERVICE,record:Ke(Ke({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ft.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ft.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ft.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:Ft.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Xs("client-leave",this._clientId),this._publishMutex=new Xs("client-publish",this._clientId),this._renewTokenMutex=new Xs("client-renewtoken",this._clientId),this._subscribeMutex=new Xs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),k.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(xo," build: ").concat(uO,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{QI(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(c){k.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var s;this._statsCollector=new PE(this.store),this._statsCollector.onStatsException=(c,d,h)=>{k.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===d1.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((f=>{f instanceof cT&&Z("ENABLE_ENCODE_EXCEPTION")&&f.findClosestProfile()})),this.safeEmit(ir.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,f)=>{const g=this._users.find((v=>v.uid===c));g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),ft.peerPublishStatus(this._sessionId,{subscribeElapse:f,audioPublishDuration:d,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(Z("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find((h=>h instanceof tn));d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?Z("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new une(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Kn,httpRetryConfig:e.httpRetryConfig||Kn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new bne(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(s={store:this.store,statsCollector:this._statsCollector},uu("P2PChannel").create(s)),this._handleP2PEvents()):this._p2pChannel=new jE(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,s,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Vr("JOIN_GATEWAY_USE_443PORT_ONLY",d),Vr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const f=this._gateway.signal.websocket;return f instanceof YO&&(f.use443PortOnly=d,f.tryDoubleDomain=h),(async function(g,v,E){qx.get(g)||qx.set(g,[]),Gx.get(g)||Gx.set(g,v),ad.get(g)||ad.set(g,0);const C=qx.get(g),R=Gx.get(g);if(!C||!R)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ad.get(g)===R){const X=lE();C.push(X),await X.promise}ad.set(g,ad.get(g)+1);for(var A=arguments.length,B=new Array(A>3?A-3:0),L=3;L<A;L++)B[L-3]=arguments[L];const U=await E(...B);return ad.set(g,ad.get(g)-1),ad.get(g)===R-1&&C.length>0&&(C[0].resolve(),C.shift()),ad.get(g)===0&&(qx.set(g,[]),Gx.set(g,0),ad.set(g,0)),U})("client.join",Z("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,s,c)}async join(e,t,r,s,c){const d=++this._numberOfJoinCount;this.store.joinStart(),s&&(this.store.uid=s);const h=(Jx||Jx||(Jx=(window.location.protocol.split(":")[0]||"").toUpperCase(),Jx))==="HTTPS",f=o3()?window.isSecureContext:"Browser Not Support";(!o3()&&!h||!window.isSecureContext)&&k.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;ft.setAppId(e);try{if(!r&&r!==null)throw new Ce(J.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));if(r&&Rs(r,"token",1,2047),Rs(e,"appid",1,2047),vT(t),s&&ET(s),c)if(typeof c=="string")Rs(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new Ce(J.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:U,enableInstantMuteRestore:X}=c;U&&(sl(U,"autoSubscribe"),k.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(U)),this.store.autoSubscribe=U),X&&(sl(X,"enableInstantMuteRestore"),k.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(X)),this.store.enableInstantMuteRestore=X)}}}catch(U){throw ft.reportApiInvoke(If(),{name:In.JOIN,options:[e,t,r,s],states:{isHttps:h,isSecureContext:f},tag:un.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(k.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),k.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw ft.reportApiInvoke(If(),{name:In.JOIN,options:[e,t,r,s],states:{isHttps:h,isSecureContext:f},tag:un.TRACER}).onError(U),U}this._gateway.state="CONNECTING",this.store.preloadStart();const v=await aB({appId:e,cname:t,uid:s,stringUid:typeof s=="string"?s:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(v==null?void 0:v.sid)||If();k.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(d)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const C=ft.reportApiInvoke(E,{id:this._clientId,name:In.JOIN,options:[e,t,r,s],states:{isHttps:h,isSecureContext:f},tag:un.TRACER}),R=pc(pc(pc({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof s!="string"?s:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!v},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Z("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof s=="string"&&(R.stringUid=s,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const X=(function(de){const ne=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),be=new Uint8Array(new ArrayBuffer(ne.length));for(let Ae=0;Ae<ne.length;Ae+=1)be[Ae]=ne.charCodeAt(Ae);return be})(),Y=await window.crypto.subtle.importKey("spki",X,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=XI(U),ue=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,ee);return(function(de){let ne="";for(let be=0;be<de.length;be+=1)ne+=String.fromCharCode(de[be]);return window.btoa(ne)})(new Uint8Array(ue))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,X=Z("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(Y,ee,ue){const de=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),ne=Y==="aes-128-gcm2"?128:256,be=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:_3,hash:"SHA-256",salt:ue},de,ne+Bte);return new Uint8Array(be).subarray(ne/8)})(this._encryptionMode,X,Af(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(Y,ee,ue){const de=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),ne=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:_3,hash:"SHA-256",salt:ue},de,{name:"AES-GCM",length:ne},!0,["encrypt","decrypt"])})(this._encryptionMode,X,Af(this._encryptionSalt))}else f?k.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):k.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,k.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:R.stringUid});const A=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&A===this._sessionId&&ft.joinChannelTimeout(this._sessionId,5)}),5e3);try{var B;let U;const X=R.cloudProxyServer;if($e(B=["proxy3","proxy4","proxy5"]).call(B,X)){const ne=Z("PROXY_SERVER_TYPE3");Array.isArray(ne)?R.proxyServer=ne[0]:R.proxyServer=ne}if(ft.setProxyServer(R.proxyServer),k.setProxyServer(R.proxyServer),this.store.requestAPStart(),v){if(k.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(v.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=v.intUid),U={gatewayInfo:v.ap.gatewayInfo},Z("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(v.ap.proxyInfo.addresses.length===0)k.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ne=(await r5(v.ap.proxyInfo,v.ap.gatewayInfo.uid)).map((be=>({turnServerURL:be.address,tcpport:be.tcpport||Bs.tcpport,udpport:be.udpport||Bs.udpport,username:be.username||Bs.username,password:be.password||Bs.password,forceturn:!1,security:!0})));R.turnServer={mode:"manual",servers:ne}}lB(v,R.stringUid)}else{if(R.stringUid&&!R.uid){let ne;[ne,U]=await nt.all([I5(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store).finally((()=>{this.store.requestSUAEnd()})),A5(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),k.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(ne)),R.uid=ne,U.gatewayInfo.uid=ne,U.gatewayInfo.res.uid=ne}else U=await A5(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(xE.UPDATE_BITRATE_LIMIT,(ne=>{this._p2pChannel.updateBitrateLimit(ne)})),this._configDistribute.on(xE.UPDATE_CLIENT_ROLE_OPTIONS,(ne=>{this._setClientRoleOptions(ne)}))}),0),this._key=r||e;const Y=U.gatewayInfo,ee=R.uid?R.uid:Y.uid;this._joinInfo=pc(pc({},R),{},{cid:Y.cid,uid:ee,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=ee,this.store.cid=Y.cid;const ue=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));C.onSuccess(ue),this._appId=e,this._channelName=R.cname,this._uid=ue,this.store.uid=ue,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Us()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const de=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return k.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(de)),setTimeout((()=>{k.startUpload()}),5e3),this.store.joinEnd(),L=this,$e(Mf).call(Mf,L)||Mf.push(L),this._cloudProxyServerMode==="disabled"&&vr().supportWebCrypto&&Z("ENABLE_PRELOAD")&&x1(this._joinInfo),ue}catch(U){const X=Array.isArray(U)?U[0]:U;throw X&&X.code===J.OPERATION_ABORTED?k.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),X):k.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),X),X.code!==J.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),C.onError(X),X}var L}_joinGateway(){if(!this._joinInfo||!this._key)throw new Ce(J.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Z("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){k.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Us()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){const r=Mf.indexOf(t);r!==-1&&Mf.splice(r,1)})(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return k.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Pr.LEAVE),k.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof R_))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Ce(J.INVALID_PARAMS,"param list is empty");const r=e;if(this._gateway.role==="audience")throw new Ce(J.INVALID_OPERATION,"audience can not publish stream");for(const c of r){if(!(c instanceof R_))throw new Ce(J.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&t)throw new Ce(J.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}k.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map((c=>"".concat(c.getTrackId()," ")))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach((c=>{const d=this._configDistribute.getBitrateLimit();c instanceof tn&&d&&c.setBitrateLimit(d.uplink)}));try{await this._publishHighStream(r),k.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map((c=>"".concat(c.getTrackId()," ")))))}catch(c){throw k.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{s()}}async _publishDataChannel(e){if(e==null)throw new Ce(J.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Gr(e.id,"id",0,65535,!0),sl(e.ordered,"ordered"),Rs(e.metadata,"metadata",0,512),k.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((c=>c.id===e.id))!==-1)throw new Ce(J.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ce(J.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new Ce(J.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const r=(function(c){return E5(c,!1)})(e),s=await this._p2pChannel.publishDataChannel([r]);if(s.length>0){if(typeof r._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ce(J.CREATE_DATACHANNEL_ERROR);try{await nt.all(s.map((c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)))),await r._waitTillOpen()}catch(c){if(c.code!==J.DISCONNECT_P2P)throw c}}return k.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw k.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Ce(J.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof R_))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);k.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((s=>"".concat(s.getTrackId()," ")))," "));const r=await this._publishMutex.lock();try{if(this.store.useP2P){const s=await this._p2pChannel.unpublish(t);s&&await this._gateway.sendExtensionMessage(Pn.UNPUBLISH,{unpubMsg:s},!0)}else{const s=await this._p2pChannel.unpublish(t);s&&await this._gateway.unpublish(s,this._uid),k.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((c=>"".concat(c.getTrackId())))))}}catch(s){throw k.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),k.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((r=>"".concat(r.id," ")))," "));const t=await this._publishMutex.lock();try{const r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),k.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((s=>"".concat(s.id)))))}catch(r){throw k.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof Mh)){const s=this.remoteUsers.find((c=>c.uid===e));if(!s)throw new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");e=s}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(ns(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Ce(J.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const r=t===ot.AUDIO,s=t===ot.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:f,cname:g,uint_id:v}=await this._gateway.presubscribe(e,t,!0);if(d==null)throw new Ce(J.UNEXPECTED_RESPONSE,"no ssrc id");let E=this._users.find((R=>R.uid===e));E||(E=new Mh(e,v||e),E._is_pre_created=!0,this._users.push(E)),g&&(E._cname=g),E._uintid||(E._uintid=v||e),r&&(E._audioSSRC=d,E._audio_pre_subscribed=!0,h&&(E._audioOrtc=h)),s&&(E._videoSSRC=d,E._video_pre_subscribed=!0,h&&(E._videoOrtc=h),f!=null&&(E._rtxSsrcId=f)),k.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(E,t,d,f,h);const C=r?E._audioTrack:E._videoTrack;if(!C)throw new Ce(J.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(E._trust_audio_stream_added_state_=!0,E._audio_added_=!0),s&&(E._trust_video_stream_added_state_=!0,E._video_added_=!0),C}catch(d){throw k.error("[".concat(this._clientId,"] presub user ").concat(e," error"),d),d}finally{c()}}async _subscribeDataChannel(e,t){var r;if(Gr(t,"channelId",0,65535,!0),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((f=>f===e)))throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Ce(J.INVALID_REMOTE_USER,"user is not published");const c=(r=e._dataChannels)===null||r===void 0?void 0:r.find((f=>f.id===t));if(!c)throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Ce(J.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const f=await this._p2pChannel.subscribeDataChannel(e,[c]);if(f&&$e(f).call(f,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ce(J.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==J.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),g;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(e,t,r){if(ns(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((d=>d===e))){const d=new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),d}if(!e.hasAudio&&!e.hasVideo){const d=new Ce(J.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),d}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const d=new Ce(J.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),d}const c=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const h=t==="audio"?e._audioSSRC:e._videoSSRC,f=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,h,f)}catch(h){throw h}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((h=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),h)}));const d=t==="audio"?e._audioTrack:e._videoTrack;if(!d)throw new Ce(J.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),d),d}finally{c()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(ns(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((v=>v===e))){const v=new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),v}if(!e.hasAudio&&!e.hasVideo){const v=new Ce(J.INVALID_REMOTE_USER,"user is not published");throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),v}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const v=new Ce(J.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),v}let c=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,f={stream_type:t==="audio"?ot.AUDIO:ot.VIDEO,ssrcId:c};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const E=t==="audio"?e._audioSSRC:e._videoSSRC;E!==void 0&&E!==c&&(c=E,d=t==="audio"?e._audioOrtc:e._videoOrtc,h=t==="video"?e._rtxSsrcId:void 0,f={stream_type:t==="audio"?ot.AUDIO:ot.VIDEO,ssrcId:c}),ei.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,f,!0)}catch(C){if((C==null?void 0:C.code)!==J.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),C;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(E){throw this._p2pChannel.reportSubscribeEvent(!1,E==null?void 0:E.code,e,t),E}k.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((E=>{k.warning("[".concat(this._clientId,"] auto set fallback failed"),E)}));const v=t==="audio"?e._audioTrack:e._videoTrack;if(!v)throw new Ce(J.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),v}catch(v){throw k.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),v),v}finally{g()}}async massSubscribe(e){if(ou(e,"subscribeList"),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),r=new Map,s=await this._subscribeMutex.lock();k.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((f=>{let{user:g,mediaType:v}=f;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(v)})).join("; ")));const c=(e=[...e]).map((f=>{let{user:g,mediaType:v}=f;return{user:g,mediaType:v}})),d=await this._p2pChannel.globalLock();try{var h;for(let g=e.length-1;g>=0;g--){const v=e[g],{user:E,mediaType:C}=v;if(ns(C,"mediaType",["audio","video"]),!E){const L=new Ce(J.INVALID_PARAMS,"user property does not exist in subscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),L}if(!this._users.find((L=>L===E))){const L=new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");k.error("[".concat(this._clientId,"] can not massSubscribe ").concat(E.uid,", this user is not in the channel")),c[g].error=L,e.splice(g,1);continue}if(C==="audio"&&(!E.hasAudio||E._audioSSRC===void 0)||C==="video"&&(!E.hasVideo||E._videoSSRC===void 0)){const L=new Ce(J.REMOTE_USER_IS_NOT_PUBLISHED);k.error("[".concat(this._clientId,"] can not subscribe ").concat(E.uid," with mediaType ").concat(C,", remote user is not published")),c[g].error=L,e.splice(g,1);continue}const A=ds.Video|ds.LwoVideo,B=r.get(E);if(B){if(C==="video"?B&A:B&ds.Audio){e.splice(g,1),k.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(E.uid,", mediaType:").concat(C," twice"));continue}r.set(E,B|(C==="video"?A:ds.Audio))}else r.set(E,C==="video"?A:ds.Audio)}for(let g=e.length-1;g>=0;g--){const v=e[g],{user:E,mediaType:C}=v,R=ds.Video|ds.LwoVideo;if(this._p2pChannel.hasRemoteMedia(E,C)){await this._p2pChannel.unmuteRemoteNoLock(E,C);const A=r.get(E);r.set(E,C==="video"?A^R:A^ds.Audio),e.splice(g,1)}}this.store.massSubscribe(e.map((g=>({userId:g.user.uid,type:g.mediaType}))),t);let f=ea(h=Array.from(r.entries())).call(h,((g,v)=>{let[E,C]=v;if(C===0)return g;const R={stream_id:E.uid,stream_type:C};return C&ds.Audio&&(R.audio_ssrc=E._audioSSRC),C&ds.Video&&(R.video_ssrc=E._videoSSRC),g.push(R),g}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((v=>{let{user:E,mediaType:C}=v;return{user:E,mediaType:C,ssrcId:C===ot.VIDEO?E._videoSSRC:E._audioSSRC,rtxSsrcId:C===ot.VIDEO?E._rtxSsrcId:void 0}})));const g=new Map;if(f=f.filter((v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc)),f.length>0){const v=await this._gateway.subscribeAll(f,!0);((v==null?void 0:v.users)||[]).forEach((E=>{let{stream_id:C,video_error_code:R,audio_error_code:A,error_code:B}=E;(R||A||B)&&g.set(C,{video_error_code:R,audio_error_code:A,error_code:B})}))}if(Array.from(g.entries()).length>0){const v=[];Array.from(g.entries()).forEach((E=>{let[C,R]=E;const A=this.remoteUsers.find((B=>B.uid===C));if(A){let B;R.error_code||R.video_error_code&&R.audio_error_code?B=void 0:R.video_error_code?B=ot.VIDEO:R.audio_error_code&&(B=ot.AUDIO),v.push({user:A,mediaType:B})}})),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const E=g.get(v.user.uid);if(E){const C=E.error_code||v.mediaType==="audio"&&E.audio_error_code||v.mediaType==="video"&&E.video_error_code;if(C){const R=TE(C);k.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(R.desc)),v.error=new Ce(J.SUBSCRIBE_FAILED,"code ".concat(C,": ").concat(R.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter((v=>!v.error)).map((v=>({userId:v.user.uid,type:v.mediaType}))),void 0,Date.now()),c.forEach((v=>{var E;ft.subscribe(this.store.sessionId,{succ:!!v.error,ec:((E=v.error)===null||E===void 0?void 0:E.code)||null,video:v.mediaType===ot.VIDEO,audio:v.mediaType===ot.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===ot.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)})),k.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((v=>{let{user:E,mediaType:C}=v;return"user: ".concat(E==null?void 0:E.uid,", mediaType: ").concat(C)})).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(e),g}}finally{d(),s()}}async unsubscribe(e,t,r){if(!(e instanceof Mh)){const d=this.remoteUsers.find((h=>h.uid===e));if(!d)throw new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");e=d}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&ns(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((d=>d===e))){const d=new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),d}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const d=await this._p2pChannel.unsubscribe(e,t);d&&await this._gateway.unsubscribe(d,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&$x(this._users,e),k.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(d){if(d.code===J.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(e,t){if(t&&Gr(t,"id",0,65535,!0),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((c=>c===e))){const c=new Ce(J.INVALID_REMOTE_USER,"user is not in the channel");throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let s;if(typeof t=="number"){const c=e._dataChannels.find((d=>d.id===t));c&&(s=[c])}else s=e._dataChannels;if(s===void 0){const c=new Ce(J.REMOTE_USER_IS_NOT_PUBLISHED);throw k.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),c}k.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s.map((c=>c.id))));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,s);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),k.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===J.DISCONNECT_P2P)return void k.warning("disconnecting p2p, abort unsubscribe request.");throw k.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(ou(e,"unsubscribeList"),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");k.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((r=>{let{user:s,mediaType:c}=r;return"user: ".concat(s==null?void 0:s.uid,", mediaType: ").concat(c,";")})).join())),e=[...e];const t=new Map;for(let r=e.length-1;r>=0;r--){const{user:s,mediaType:c}=e[r];if(!s){const f=new Ce(J.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw k.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),f}if(ns(c,"mediaType",["video","audio",void 0]),!this._users.find((f=>f===s))){k.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(s.uid,", user is not in the channel")),e.splice(r,1);continue}const h=ds.Video|ds.LwoVideo;if(t.has(s)){const f=t.get(s);let g;switch(c){case"video":g=f&h;break;case"audio":g=f&ds.Audio;break;default:g=f&(ds.Audio|h)}if(g){k.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(s.uid,",mediaType:").concat(c," twice.")),e.splice(r,1);continue}c?c==="audio"?t.set(s,f|ds.Audio):c==="video"&&t.set(s,f|h):t.set(s,f|ds.Audio|h)}else c?c==="audio"?t.set(s,ds.Audio):c==="video"&&t.set(s,h):t.set(s,ds.Audio|h)}try{const r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),k.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((s=>{let{user:c,mediaType:d}=s;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")})).join()))}catch(r){if(r.code===J.DISCONNECT_P2P)return void k.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw k.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new Ne(J.INVALID_PARAMS);xn(r.width)||$I(r.width,"streamParameter.width"),xn(r.height)||$I(r.height,"streamParameter.height"),xn(r.framerate)||$I(r.framerate,"streamParameter.framerate"),xn(r.bitrate)||Gr(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&k.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),k.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,We.LocalVideoLowTrack)}async enableDualStream(){if(!vr().supportDualStream)throw ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ce(J.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ce(J.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),k.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(We.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ft.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),k.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(s){ns(s,"role",["audience","host"])})(e),t&&QI(t),this.mode==="rtc"||this.mode==="p2p")throw k.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ce(J.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Ce(J.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ce(J.INVALID_OPERATION,"can not set client role to audience when publishing stream");const r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&Z("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",Fs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),k.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&QI(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{k.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Rs(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Ce(J.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ce(J.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ft.setProxyServer(this._proxyServer),k.setProxyServer(this._proxyServer),k.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Ce(J.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ce(J.INVALID_OPERATION,"You have already set the proxy")}if(pE(e))return this._turnServer={servers:e,mode:"original-manual"},void k.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((r=>r.urls)).join(","),"."));e.forEach((r=>Y4(r))),this._turnServer={servers:e,mode:"manual"},k.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Ce(J.INVALID_OPERATION,"you should set license before join channel");if(Rs(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Ce(J.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,k.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Ce(J.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ce(J.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Ce(J.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new Ce(J.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ce(J.INVALID_OPERATION,"Stop proxy server after leave channel");ft.setProxyServer(),k.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",k.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Ce(J.INVALID_PARAMS,"accessPoints is required.");ou(e.accessPoints.serverList,"accessPoints.serverList"),Rs(e.accessPoints.domain,"accessPoints.domain");const t=(R,A)=>{Gr(R,A,0,65535,!0)};let r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ce(J.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Z("CLOSE_AFB_FOR_LOCAL_AP")&&(Vr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Vr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const s=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,d=e.accessPoints.serverList.map((R=>s.test(R)?"".concat(R.replace(/\./g,"-"),".").concat(c):R)),h=d.map((R=>"".concat(R,":").concat(r)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Vr("WEBCS_DOMAIN",h),Vr("WEBCS_DOMAIN_BACKUP_LIST",h),Vr("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ou(e.report.hostname,"report.hostname"),Vr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Vr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Vr("EVENT_REPORT_DOMAIN",d[0]),Vr("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let f=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),f=e.report.port),Vr("STATS_COLLECTOR_PORT",f),e.report?Vr("ENABLE_EVENT_REPORT",!0):Vr("ENABLE_EVENT_REPORT",!1);let g="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ou(e.log.hostname,"log.hostname"),g=e.log.hostname[0]):g=d[0];let v=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),v=e.log.port),Vr("LOG_UPLOAD_SERVER","".concat(g,":").concat(v));let E=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ou(e.cds.hostname,"cds.hostname"),E=e.cds.hostname):E=d;let C=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),C=e.cds.port),Vr("CDS_AP",E.map((R=>"".concat(R,":").concat(C)))),e.cds?Vr("ENABLE_CONFIG_DISTRIBUTE",!0):Vr("ENABLE_CONFIG_DISTRIBUTE",!1),k.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(ou(e,"serverList"),Rs(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ce(J.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((s=>r.test(s)?"".concat(s.replace(/\./g,"-"),".").concat(t):s)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Vr("WEBCS_DOMAIN",e),Vr("WEBCS_DOMAIN_BACKUP_LIST",e),Vr("GATEWAY_DOMAINS",[t]),Vr("EVENT_REPORT_DOMAIN",e[0]),Vr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Vr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),k.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(ns(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw k.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else k.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){ns(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const r=this._users.find((s=>s.uid===e));r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(r){throw k.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}k.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){ns(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw k.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}k.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,s){(function(d){ns(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Rs(t,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if($e(c).call(c,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new Ce(J.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new Ce(J.INVALID_PARAMS,"current encrypt mode does not need salt");if(s){if(sl(s,"encryptDataStream"),!$e(c).call(c,e))throw new Ce(J.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||k.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Ch(r))}async renewToken(e){if(Rs(e,"token",1,2047),!this._key||!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const r=await this._renewTokenMutex.lock();try{if(Z("USE_NEW_TOKEN")){k.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const s=await wne(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn);k.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:s})}else k.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});k.debug("[".concat(this._clientId,"] renewToken success"))}catch(s){throw this._key=t,this._joinInfo.token=t,k.error("[".concat(this._clientId,"] renewToken failed"),s.toString()),s}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?k.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(ir.VOLUME_INDICATOR,e)}),Z("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Ce(J.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ce(J.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Ce(J.LIVE_STREAMING_TASK_CONFLICT);const r=t?cu.TRANSCODE:cu.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(cu.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((r=>r&&r.hasUrl(e)));if(!t.length)throw new Ce(J.INVALID_PARAMS,"can not find live streaming url to stop");await nt.all(t.map((r=>r&&r.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){L5(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){L5(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof jE&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let s=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$e(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(s=!0,e.payload=await(async function(c,d,h){var f;const g=ea(f=Array.from(h)).call(f,((L,U)=>L+U),0),v={serverTs:0,seq:Wte++,length:h.length,checkSum:g},E=new Uint8Array(n3(g,2)),C=new ArrayBuffer(w_),R=new DataView(C);R.setUint32(0,v.serverTs),R.setUint16(4,v.seq),R.setUint16(6,v.length),R.setUint16(8,v.checkSum);const A=16-h.length%16;h=Q4(h,new Uint8Array(A));const B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:g3,additionalData:E},d,h);return Q4(new Uint8Array(C),new Uint8Array(B))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Ce(J.INVALID_PARAMS,s?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Dt.DATA_STREAM,{payload:Ch(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Ane},!r)}sendMetadata(e){if(!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Ce(J.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Dt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ch(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Jte),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"can not send custom report, not joined");await ft.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(Z("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((r=>r.uid+""));Object.keys(e).forEach((r=>{$e(t).call(t,r)||delete e[r]}))}return e}async pickSVCLayer(e,t){ns(t.spatialLayer,"spatialLayer",[0,1,2,3]),ns(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw k.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:r}=e;if(sl(t,"apRTM"),Gr(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,k.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(k.debug("[".concat(this._clientId,"] reset client")),(function(e){const t=P_.indexOf(e);t!==-1&&P_.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=qi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&cB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&ft.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((t=>t._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Xs("client-publish",this._clientId),this._subscribeMutex=new Xs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;const s=e||If();e?k.debug("[".concat(this._clientId,"] new Session ").concat(s)):k.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s));const c=e?"":this._sessionId||"";this._sessionId=s,this.store.sessionId=s,ft.addSid(s);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};ft.sessionInit(this._sessionId,pc({cname:t.channel,appid:t.appId},d)),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Ce(J.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Z("FORCE_TURN")&&!Z("TURN_ENABLE_TCP")&&!Z("TURN_ENABLE_UDP"))throw new Ce(J.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");k.debug("[".concat(this._clientId,"] publish high stream"));try{const r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const s=(await r.next()).value;if(s){try{await this._gateway.sendExtensionMessage(Pn.PUBLISH,s,!0)}catch(c){throw r.throw(c),c}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const s=(await r.next()).value;if(s){var t;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==J.DISCONNECT_P2P)throw r.throw(d),d}await r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof tn&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch((d=>{k.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,e),(r==null?void 0:r.code)===J.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ce(J.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ce(J.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));k.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),s=(await r.next()).value;if(s){var t;let c;try{c=await this._gateway.publish(this._uid,s,!0)}catch(d){if(d.code!==J.DISCONNECT_P2P)throw r.throw(d),d}r.next(((t=c)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r==null?void 0:r.code,void 0,!0),(r==null?void 0:r.code)===J.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Ce(J.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const r=(s={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},uu("LiveStreaming").create(s));var s;return r.onLiveStreamError=(c,d)=>{ft.reportApiInvoke(this._sessionId,{name:In.ON_LIVE_STREAM_ERROR,options:[c,d],tag:un.TRACER}).onSuccess(),this.safeEmit(ir.LIVE_STREAMING_ERROR,c,d)},r.onLiveStreamWarning=(c,d)=>{ft.reportApiInvoke(this._sessionId,{name:In.ON_LIVE_STREAM_WARNING,options:[c,d],tag:un.TRACER}).onSuccess(),this.safeEmit(ir.LIVE_STREAMING_WARNING,c,d)},r.on(KO.REQUEST_WORKER_MANAGER_LIST,((c,d,h)=>{if(!this._joinInfo)return h(new Ce(J.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(f,g,v,E){const C=Z("UAP_AP").slice(0,Z("AJAX_REQUEST_CONCURRENT")).map((R=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(R+"/api/v1?action=uap"):"https://".concat(R,"/api/v1?action=uap")));return await fne(C,f,g,v,E)})(c,this._joinInfo,this._axiosCancelSource.token,Kn).then(d).catch(h)})),r};return e===cu.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ce(J.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),s=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},uu("ChannelMediaRelay").create(e));s.on("state",(c=>{c===ca.RELAY_STATE_FAILURE&&s&&s.dispose(),this.safeEmit(ir.CHANNEL_MEDIA_RELAY_STATE,c)})),s.on("event",(c=>{this.safeEmit(ir.CHANNEL_MEDIA_RELAY_EVENT,c)})),this._channelMediaRelayClient=s,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:r,deleted:s}=e,c=[];if(t){const d=[];this._users.forEach((h=>{h._dataChannels.forEach((f=>{r.every((g=>g.uid!==h._uintid||g.stream_id!==f.id))&&d.push({uid:h._uintid,stream_id:f.id,ordered:f.ordered,max_retrans_times:f.maxRetransmits,metadata:f.metadata})}))})),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(r)&&r.length>0&&r.forEach((d=>{const{uid:h,stream_id:f,ordered:g,max_retrans_times:v,metadata:E}=d,C=this._users.find((R=>R._uintid===h));if(!C)return void k.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(k.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),$e(c).call(c,C)||c.push(C),C._uintid||(C._uintid=h),C._dataChannels.findIndex((R=>R.id===d.stream_id))===-1){const R={id:f,ordered:!!g,maxRetransmits:v,metadata:E},A=(function(B){return E5(B,!0)})(R);C._dataChannels.push(A),k.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published datachannel")),t||this.safeEmit(ir.USER_PUBLISHED,C,"datachannel",R)}this._p2pChannel.hasPendingRemoteDataChannel(C,d.stream_id)&&(k.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(C.uid," after reconnect.")),this._subscribeDataChannel(C,d.stream_id).catch((R=>{k.error("[".concat(this._clientId,"] resubscribe datachannel error"),R.toString())})))})),t&&(this.safeEmit(ir.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(s)&&s.length>0&&s.forEach((d=>{const{uid:h,stream_id:f}=d,g=this._users.find((E=>E._uintid===h));if(!g)return void k.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=g._dataChannels.find((E=>E.id===d.stream_id));v&&(k.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[v]).then((E=>{if(g._dataChannels=g._dataChannels.filter((C=>C!==v)),E)return this._gateway.unsubscribeDataChannel(E,g.uid)})),k.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(ir.USER_UNPUBLISHED,g,"datachannel",v._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const r=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(r)for(const c of r){var s;if(c.payloadType===e)return c==null||(s=c.rtpMap)===null||s===void 0?void 0:s.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((r=>r.uid===e.uid));if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){k.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const r=()=>{k.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((s=>{this.safeEmit(ir.USER_UNPUBLISHED,t,"datachannel",s._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((s=>{if(s)return this._gateway.unsubscribeDataChannel(s,t.uid)})),r()}}else k.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ps.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach((s=>{const{value:c,type:d,expires:h}=t[s];h&&h<=r||d||FO()||!Object.prototype.hasOwnProperty.call(eT,s)||(al[s]=c,cn[s]=c,k.debug("Update gateway parameters from config distribute",s,c))}))}catch(t){k.error("Error update config from local cache",t.message)}})()})),this._gateway.on(ps.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(ps.CONNECTION_STATE_CHANGE,((e,t,r)=>{var s;if(r===Pr.FALLBACK)return;const c=()=>{this.safeEmit(ir.CONNECTION_STATE_CHANGE,e,t,r)};if(ft.reportApiInvoke(this._sessionId||((s=this._gateway.joinInfo)===null||s===void 0?void 0:s.sid)||null,{name:In.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:un.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),k.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach((h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach(((h,f)=>{this._gateway.setStreamFallbackOption(f,h).catch((g=>{k.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)}))})),this._remoteStreamTypeCacheMap.forEach(((h,f)=>{this._gateway.setRemoteVideoStreamType(f,h).catch((g=>{k.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)}))})),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{k.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((h=>{k.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((h=>!h._trust_in_room_)).forEach((h=>{k.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((h=>{h._trust_audio_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ot.AUDIO,!1)),h._trust_video_mute_state_||(k.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,ot.VIDEO,!1)),h._trust_audio_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(k.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(k.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(k.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))})))}),1e3))}c()})),this._gateway.on(ps.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new Ce(J.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r;const s=await aB(pc(pc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));s?(r=s.ap,lB(s),this._joinInfo.preload=!0):(r=await c1(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Kn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);const c=[];r.gatewayInfo.gatewayAddrs.forEach((d=>{let{address:h}=d;const[f,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:f,port:g}):c.push({host:f,port:g})})),e(c)}catch(r){t(r)}})),this._gateway.on(ps.NETWORK_QUALITY,(e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(ir.NETWORK_QUALITY,e)})),this._gateway.on(ps.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(ir.STREAM_TYPE_CHANGED,e,t),ft.reportApiInvoke(this._sessionId,{name:In.STREAM_TYPE_CHANGE,options:[e,t],tag:un.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(ps.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(ps.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,r)=>{try{let s=await this._p2pChannel.getEstablishParams();s&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(s=await this._p2pChannel.startP2PConnection(e)),t(s)}catch(s){r(s)}})),this._gateway.on(ps.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let r;this._joinResponse=e,e.attributes?r=e.attributes.userAttributes.preSubSsrcs:k.debug("no attributes in joinResponse");const s=c5(e.ortc,t,r);this._p2pChannel.connect(s)})),this._gateway.on(ps.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:r,turnServer:s}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:d,cid:h}=this._joinInfo.apResponse,f="".concat(h,"_").concat(d);if(f.length<4||f.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:s,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=Z("FINGERPRINT"))!==null&&c!==void 0?c:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===J.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:s,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(or.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(or.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(or.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(or.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(or.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(or.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(or.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(or.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(or.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,ot.AUDIO,!0))),this._gateway.signal.on(or.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,ot.AUDIO,!1))),this._gateway.signal.on(or.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,ot.VIDEO,!0))),this._gateway.signal.on(or.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,ot.VIDEO,!1))),this._gateway.signal.on(or.RECEIVE_METADATA,(e=>{const t=Af(e.metadata);this.safeEmit(ir.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(or.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let r=Af(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$e(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<w_)throw new Ce(J.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(w_));r=await(async function(d,h,f){const g=f.subarray(0,w_),v=g.slice(8,w_),E=(v[0]<<8)+v[1],C=(g[6]<<8)+g[7],R=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:g3,additionalData:new Uint8Array(n3(E,2))},h,f.subarray(w_));return new Uint8Array(R).subarray(0,C)})(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let s=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find((f=>f.uid===e.uid)),h=c==null?void 0:c.audioRecv.find((f=>f.ssrc===(d==null?void 0:d._audioSSRC)));s=h==null?void 0:h.jitterBufferMs}(s==null||Number.isNaN(s))&&(s=0),One(pc(pc({},e),{},{payload:r}),s,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(or.ON_CRYPT_ERROR,(()=>{Th((()=>{k.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ir.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(or.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(or.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{k.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Pr.TOKEN_EXPIRE),this.safeEmit(ir.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(or.ON_STREAM_FALLBACK_UPDATE,(e=>{k.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(ir.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(or.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),k.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(or.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(or.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(Mt.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case Dt.PUBLISH:{if(!t)return;const c=t.ortc;if(c){var r,s;const d=c.some((g=>{let{stream_type:v}=g;return v===Mr.Audio})),h=c.some((g=>{let{stream_type:v}=g;return v!==Mr.Audio})),f=c.some((g=>{let{stream_type:v}=g;return v===Mr.Screen||v===Mr.ScreenLow}));t.state==="offer"&&ft.publish(this._joinInfo.sid,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:J.TIMEOUT,audio:d,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:d?(r=c.find((g=>{let{stream_type:v}=g;return v===Mr.Audio})))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(s=c.find((g=>{let{stream_type:v}=g;return v!==Mr.Audio})))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0})}break}case Dt.SUBSCRIBE:t&&ft.subscribe(this._joinInfo.sid,{succ:!1,ec:J.TIMEOUT,audio:t.stream_type===ot.AUDIO,video:t.stream_type===ot.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(or.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(or.ON_PUBLISHED_USER_LIST,(e=>{if(e==null||!e.users)return;Z("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((s=>!Uf(s.string_id||s.stream_id,this.channelName))));const t=[],r=[];for(const s of e.users){let c=this._users.find((E=>E._uintid===s.stream_id));c?c._trust_in_room_=!0:(c=new Mh(s.string_id||s.stream_id,s.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(ir.PUBLISHED_USER_LIST).length===0&&(k.debug("[".concat(this._clientId,"] user online"),s.stream_id),this.safeEmit(ir.USER_JOINED,c)));const d=ds.Audio&s.stream_type,h=(ds.Video|ds.LwoVideo)&s.stream_type,f=(65280&s.stream_type)!=0,g=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=s.video_ssrc,c._rtxSsrcId=s.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=s.audio_ssrc),d&&!g&&this.getListeners(ir.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(ir.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(ir.PUBLISHED_USER_LIST).length===0&&(k.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(ir.USER_PUBLISHED,c,"video")),(d&&!g||h&&!v||f)&&t.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&r.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&r.push({user:c,mediaType:"audio"})}r.length>0&&(k.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map((s=>"user: ".concat(s.user.uid,", mediaType: ").concat(s.mediaType))).join("; ")," ")),this.massSubscribe(r).catch((s=>{k.error("[".concat(this._clientId,"] mass resubscribe error"),s.toString())}))),this.getListeners(ir.PUBLISHED_USER_LIST).length>0?Z("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(k.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((s=>s.uid)).join(", "))),this.safeEmit(ir.PUBLISHED_USER_LIST,t)):k.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((s=>s.uid)).join(", ")))})),this._gateway.signal.on(or.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof jE&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((r=>r.toLowerCase())).filter((r=>{var s;return $e(s=Object.keys(yE)).call(s,r)})))}))}_handleP2PEvents(){this._gateway.signal.on(or.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Pn.PUBLISH,((e,t,r)=>{const{uid:s}=e;e.forEach((c=>{const{kind:d,ssrcs:h,mid:f,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(d,s,h[0].ssrcId,f);const v=this._users.find((E=>E.uid===s));return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,f).then((()=>{t()})).catch(r):t(),this._handleMuteStream(s,d,!!g)}))})),this._gateway.signal.on(Pn.CALL,(async(e,t,r)=>{if(this.store.useP2P)try{var s;t(await this._p2pChannel.startP2P({turnServer:(s=this._joinInfo)===null||s===void 0?void 0:s.turnServer},e))}catch(c){r(c)}})),this._gateway.signal.on(Mt.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Pn.UNPUBLISH,(async(e,t,r)=>{if(this.store.useP2P){const{unpubMsg:s,uid:c}=e,d=this._users.find((h=>h.uid===c));if(!d)return k.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void t();try{s.forEach((async h=>{let{stream_type:f}=h;const g=f===Mr.Audio?ot.AUDIO:ot.VIDEO;await this._p2pChannel.unsubscribe(d,g),this._handleMuteStream(c,g,!0)})),t()}catch(h){r(h)}}})),this._gateway.signal.on(Pn.CONTROL,(async(e,t)=>{const{action:r}=e;switch(r){case Ih.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ot.VIDEO,!0);break;case Ih.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ot.AUDIO,!0);break;case Ih.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ot.VIDEO,!1);break;case Ih.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ot.AUDIO,!1)}})),this._gateway.signal.on(Pn.RESTART_ICE,(async(e,t,r)=>{if(this.store.useP2P)try{const{direction:s,iceParameter:c}=e;s!==Di.SEND_ONLY||c?t(await this._p2pChannel.restartICE(s,c)):(this._p2pChannel.handleDisconnect(s),t())}catch(s){r(s)}})),this._gateway.signal.on(Pn.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}})),this._p2pChannel.on(Tt.RequestP2PRestartICE,(async(e,t,r)=>{try{const{direction:s}=e;t(await this._gateway.sendExtensionMessage(Pn.RESTART_ICE,e,s===Di.SEND_ONLY))}catch(s){r(s)}})),this._p2pChannel.on(Tt.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Pn.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(Tt.RequestP2PMuteLocal,(async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(Pn.CONTROL,e,!0),t()}catch(s){r(s)}})),this._p2pChannel.on(Tt.RequestP2PUnmuteRemote,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===J.DISCONNECT_P2P?t():r(s)}else t()})),this._p2pChannel.on(Tt.RequestP2PMuteRemote,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===J.DISCONNECT_P2P?t():r(s)}else t()})),this._p2pChannel.on(Tt.StateChange,((e,t)=>{t===Dr.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(Tt.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit(ir.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(Tt.RequestMuteLocal,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===J.DISCONNECT_P2P?t():r(s)}else t()})),this._p2pChannel.on(Tt.RequestUnmuteLocal,(async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(s){s.code===J.DISCONNECT_P2P?t():r(s)}else t()})),this._p2pChannel.on(Tt.RequestRePublish,((e,t,r)=>{this.publish(e,!1).then(t).catch(r)})),this._p2pChannel.on(Tt.RequestRePublishDataChannel,((e,t,r)=>{nt.all(e.map((async s=>{const c=await this._p2pChannel.publishDataChannel([s]);try{c.forEach((d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)}))}catch(d){if(d.code!==J.DISCONNECT_P2P)throw d}}))).then(t).catch(r)})),this._p2pChannel.on(Tt.RequestReSubscribe,(async(e,t,r)=>{try{for(const{user:s,kind:c}of e)c===ot.VIDEO?await this.subscribe(s,"video"):await this.subscribe(s,"audio");t()}catch(s){r(s)}})),this._p2pChannel.on(Tt.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(Tt.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(Tt.MediaReconnectStart,(e=>{this.safeEmit(ir.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(Tt.MediaReconnectEnd,(e=>{this.safeEmit(ir.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(Tt.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(Tt.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;const s=r.value;let c;try{c=await this._gateway.restartICE({iceParameters:s})}catch(h){return void t.throw(h)}const{iceParameters:d}=(function(h){const f=h.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}})(c);await t.next({remoteIceParameters:d})})),this._p2pChannel.on(Tt.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(Tt.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:r,rtpCapabilities:s}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:s}),h=c5(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(Tt.RequestUnpublishForReconnectPC,(async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()})),this._p2pChannel.on(Tt.P2PLost,(()=>{this.safeEmit(ir.P2P_LOST,this.store.uid)})),this._p2pChannel.on(Tt.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(Tt.ConnectionTypeChange,(e=>{this.safeEmit(ir.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(Tt.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(Tt.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(Tt.AudioMetadata,(e=>{this.safeEmit(ir.AUDIO_METADATA,e)})),this._p2pChannel.on(Tt.AudioPts,(e=>{this.safeEmit(ir.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const r=(t={config:e},uu("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);const{appId:s,cname:c,sid:d,token:h,uid:f,cid:g,vid:v}=this._joinInfo;await r.init({appId:s,areaCode:"",cname:c,sid:d,token:h,uid:f,cid:g,vid:v?Number(v):0},Kn)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(fs.CONNECTION_STATE_CHANGE,((t,r)=>{if(this.safeEmit(ir.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===lc.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(ir.CONTENT_INSPECT_ERROR,new Ce(J.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(fs.INSPECT_RESULT,((t,r)=>{var s;if((r==null?void 0:r.code)===J.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return k.debug("Stop inspect content because that has left channel"),this==null||(s=this._inspect)===null||s===void 0||s.close(),void(this._inspect=void 0);this.safeEmit(ir.CONTENT_INSPECT_RESULT,t,r)})),e.on(fs.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((r=>r.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(sl(e,"enabled"),e){if(!t)throw new Ce(J.INVALID_PARAMS,"config is required");if(SB(t),!this._joinInfo)throw new Ce(J.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const s=(r={config:t},uu("ImageModeration").create(r));this._moderation=s,this.handleImageModerationEvents(s);const{appId:c,cname:d,sid:h,token:f,uid:g,cid:v,vid:E}=this._joinInfo;await s.init({appId:c,areaCode:"",cname:d,sid:h,token:f,uid:g,cid:v,vid:E?Number(E):0},Kn)}}catch(s){throw Array.isArray(s)?s[0]:s}}else{var r;if(!this._moderation)throw new Ce(J.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(e){e.on(ll.CONNECTION_STATE_CHANGE,((t,r)=>{if(this.safeEmit(ir.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===No.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ce(J.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(ll.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((r=>r.trackMediaType==="video"))[0])}))}setP2PTransport(e){if((function(t){ns(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new Ce(J.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,k.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return k.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){sl(e,"enabled"),Vr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ht(at.prototype,"leave",[xB],Object.getOwnPropertyDescriptor(at.prototype,"leave"),at.prototype),ht(at.prototype,"publish",[TB],Object.getOwnPropertyDescriptor(at.prototype,"publish"),at.prototype),ht(at.prototype,"unpublish",[CB],Object.getOwnPropertyDescriptor(at.prototype,"unpublish"),at.prototype),ht(at.prototype,"subscribe",[RB],Object.getOwnPropertyDescriptor(at.prototype,"subscribe"),at.prototype),ht(at.prototype,"presubscribe",[NB],Object.getOwnPropertyDescriptor(at.prototype,"presubscribe"),at.prototype),ht(at.prototype,"massSubscribe",[AB],Object.getOwnPropertyDescriptor(at.prototype,"massSubscribe"),at.prototype),ht(at.prototype,"unsubscribe",[IB],Object.getOwnPropertyDescriptor(at.prototype,"unsubscribe"),at.prototype),ht(at.prototype,"massUnsubscribe",[OB],Object.getOwnPropertyDescriptor(at.prototype,"massUnsubscribe"),at.prototype),ht(at.prototype,"setLowStreamParameter",[kB],Object.getOwnPropertyDescriptor(at.prototype,"setLowStreamParameter"),at.prototype),ht(at.prototype,"enableDualStream",[PB],Object.getOwnPropertyDescriptor(at.prototype,"enableDualStream"),at.prototype),ht(at.prototype,"disableDualStream",[DB],Object.getOwnPropertyDescriptor(at.prototype,"disableDualStream"),at.prototype),ht(at.prototype,"setClientRole",[jB],Object.getOwnPropertyDescriptor(at.prototype,"setClientRole"),at.prototype),ht(at.prototype,"_setClientRoleOptions",[LB],Object.getOwnPropertyDescriptor(at.prototype,"_setClientRoleOptions"),at.prototype),ht(at.prototype,"setProxyServer",[MB],Object.getOwnPropertyDescriptor(at.prototype,"setProxyServer"),at.prototype),ht(at.prototype,"setTurnServer",[UB],Object.getOwnPropertyDescriptor(at.prototype,"setTurnServer"),at.prototype),ht(at.prototype,"setLicense",[FB],Object.getOwnPropertyDescriptor(at.prototype,"setLicense"),at.prototype),ht(at.prototype,"startProxyServer",[VB],Object.getOwnPropertyDescriptor(at.prototype,"startProxyServer"),at.prototype),ht(at.prototype,"stopProxyServer",[BB],Object.getOwnPropertyDescriptor(at.prototype,"stopProxyServer"),at.prototype),ht(at.prototype,"setLocalAccessPointsV2",[WB],Object.getOwnPropertyDescriptor(at.prototype,"setLocalAccessPointsV2"),at.prototype),ht(at.prototype,"setLocalAccessPoints",[qB],Object.getOwnPropertyDescriptor(at.prototype,"setLocalAccessPoints"),at.prototype),ht(at.prototype,"setRemoteDefaultVideoStreamType",[GB],Object.getOwnPropertyDescriptor(at.prototype,"setRemoteDefaultVideoStreamType"),at.prototype),ht(at.prototype,"setRemoteVideoStreamType",[HB],Object.getOwnPropertyDescriptor(at.prototype,"setRemoteVideoStreamType"),at.prototype),ht(at.prototype,"setStreamFallbackOption",[KB],Object.getOwnPropertyDescriptor(at.prototype,"setStreamFallbackOption"),at.prototype),ht(at.prototype,"setEncryptionConfig",[zB],Object.getOwnPropertyDescriptor(at.prototype,"setEncryptionConfig"),at.prototype),ht(at.prototype,"renewToken",[$B],Object.getOwnPropertyDescriptor(at.prototype,"renewToken"),at.prototype),ht(at.prototype,"enableAudioVolumeIndicator",[YB],Object.getOwnPropertyDescriptor(at.prototype,"enableAudioVolumeIndicator"),at.prototype),ht(at.prototype,"startLiveStreaming",[XB],Object.getOwnPropertyDescriptor(at.prototype,"startLiveStreaming"),at.prototype),ht(at.prototype,"setLiveTranscoding",[JB],Object.getOwnPropertyDescriptor(at.prototype,"setLiveTranscoding"),at.prototype),ht(at.prototype,"stopLiveStreaming",[QB],Object.getOwnPropertyDescriptor(at.prototype,"stopLiveStreaming"),at.prototype),ht(at.prototype,"startChannelMediaRelay",[ZB],Object.getOwnPropertyDescriptor(at.prototype,"startChannelMediaRelay"),at.prototype),ht(at.prototype,"updateChannelMediaRelay",[e6],Object.getOwnPropertyDescriptor(at.prototype,"updateChannelMediaRelay"),at.prototype),ht(at.prototype,"stopChannelMediaRelay",[t6],Object.getOwnPropertyDescriptor(at.prototype,"stopChannelMediaRelay"),at.prototype),ht(at.prototype,"sendCustomReportMessage",[r6],Object.getOwnPropertyDescriptor(at.prototype,"sendCustomReportMessage"),at.prototype),ht(at.prototype,"pickSVCLayer",[n6],Object.getOwnPropertyDescriptor(at.prototype,"pickSVCLayer"),at.prototype),ht(at.prototype,"setRTMConfig",[s6],Object.getOwnPropertyDescriptor(at.prototype,"setRTMConfig"),at.prototype),ht(at.prototype,"enableContentInspect",[i6],Object.getOwnPropertyDescriptor(at.prototype,"enableContentInspect"),at.prototype),ht(at.prototype,"disableContentInspect",[a6],Object.getOwnPropertyDescriptor(at.prototype,"disableContentInspect"),at.prototype),ht(at.prototype,"setImageModeration",[o6],Object.getOwnPropertyDescriptor(at.prototype,"setImageModeration"),at.prototype),ht(at.prototype,"setP2PTransport",[c6],Object.getOwnPropertyDescriptor(at.prototype,"setP2PTransport"),at.prototype),ht(at.prototype,"getJoinChannelServiceRecords",[l6],Object.getOwnPropertyDescriptor(at.prototype,"getJoinChannelServiceRecords"),at.prototype),ht(at.prototype,"setPublishAudioFilterEnabled",[d6],Object.getOwnPropertyDescriptor(at.prototype,"setPublishAudioFilterEnabled"),at.prototype),at);class UE{constructor(t,r){H(this,"id",0),H(this,"element",void 0),H(this,"peerPair",void 0),H(this,"context",void 0),H(this,"audioPlayerElement",void 0),H(this,"audioTrack",void 0),UE.count+=1,this.id=UE.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;const t=async(s,c)=>{const d=c==="offer"?await s.createOffer():await s.createAnswer();return await s.setLocalDescription(d),s.iceGatheringState==="complete"?s.localDescription:new nt((h=>{s.onicegatheringstatechange=()=>{s.iceGatheringState==="complete"&&h(s.localDescription)}}))},r=async(s,c)=>await s.setRemoteDescription(c);try{const s=await t(this.peerPair[0],"offer");await r(this.peerPair[1],s);const c=await t(this.peerPair[1],"answer");await r(this.peerPair[0],c)}catch(s){throw new Ce(J.LOCAL_AEC_ERROR,s.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(c){throw new Ce(J.LOCAL_AEC_ERROR,c.toString()).print()}if(!r)throw new Ce(J.LOCAL_AEC_ERROR,"no dest node when local aec").print();const s=r.stream.getAudioTracks()[0];return this.audioTrack=s,s}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){k.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var h6,YT;H(UE,"count",0);const zne=window.AudioContext||window.webkitAudioContext,$ne=new(h6=It({report:ft}),ht((YT=class{constructor(){H(this,"units",[]),H(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return k.debug("the system does not need to process local aec"),-1;this.context||(this.context=new zne);let t=this.units.find((r=>r&&r.getElement()===e));return t||(t=new UE(e,this.context),this.units.push(t)),t.startEchoCancellation(),k.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return fr().name!==br.SAFARI}}).prototype,"processExternalMediaAEC",[h6],Object.getOwnPropertyDescriptor(YT.prototype,"processExternalMediaAEC"),YT.prototype),YT);function p6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function f6(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?p6(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p6(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}const R1=window||document;function m6(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!R1)return;const r=zn._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);const s=c=>{if(!(c&&c.blockedURI&&(zn.onSecurityPolicyViolation||zn.getListeners(hd.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;Z("CSP_DETECTED_HOSTNAME_LIST").some((h=>$e(d).call(d,h)))&&(zn.onSecurityPolicyViolation&&typeof zn.onSecurityPolicyViolation=="function"&&zn.onSecurityPolicyViolation(c),zn.getListeners(hd.SECURITY_POLICY_VIOLATION).length>0&&zn.safeEmit(hd.SECURITY_POLICY_VIOLATION,c))};r&&R1.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||zn.getListeners(hd.SECURITY_POLICY_VIOLATION).length>0)&&R1.addEventListener("securitypolicyviolation",s),zn._cspEventHandlerPointer=s}var Yne=O,Xne=XU,g6=RegExp.prototype,Jne=function(e){return e===g6||Yne(g6,e)?Xne(e):e.flags},vi=u(Jne);function z_(e){let t=e.length;for(;--t>=0;)e[t]=0}const N1=256,_6=286,FE=30,VE=15,A1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),XT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Qne=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),y6=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),pu=new Array(576);z_(pu);const BE=new Array(60);z_(BE);const WE=new Array(512);z_(WE);const qE=new Array(256);z_(qE);const I1=new Array(29);z_(I1);const JT=new Array(FE);function O1(e,t,r,s,c){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=s,this.max_length=c,this.has_stree=e&&e.length}let v6,E6,w6;function k1(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}z_(JT);const b6=e=>e<256?WE[e]:WE[256+(e>>>7)],GE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},eo=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,GE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},md=(e,t,r)=>{eo(e,r[2*t],r[2*t+1])},S6=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},x6=(e,t,r)=>{const s=new Array(16);let c,d,h=0;for(c=1;c<=VE;c++)h=h+r[c-1]<<1,s[c]=h;for(d=0;d<=t;d++){let f=e[2*d+1];f!==0&&(e[2*d]=S6(s[f]++,f))}},T6=e=>{let t;for(t=0;t<_6;t++)e.dyn_ltree[2*t]=0;for(t=0;t<FE;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},C6=e=>{e.bi_valid>8?GE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},R6=(e,t,r,s)=>{const c=2*t,d=2*r;return e[c]<e[d]||e[c]===e[d]&&s[t]<=s[r]},P1=(e,t,r)=>{const s=e.heap[r];let c=r<<1;for(;c<=e.heap_len&&(c<e.heap_len&&R6(t,e.heap[c+1],e.heap[c],e.depth)&&c++,!R6(t,s,e.heap[c],e.depth));)e.heap[r]=e.heap[c],r=c,c<<=1;e.heap[r]=s},N6=(e,t,r)=>{let s,c,d,h,f=0;if(e.sym_next!==0)do s=255&e.pending_buf[e.sym_buf+f++],s+=(255&e.pending_buf[e.sym_buf+f++])<<8,c=e.pending_buf[e.sym_buf+f++],s===0?md(e,c,t):(d=qE[c],md(e,d+N1+1,t),h=A1[d],h!==0&&(c-=I1[d],eo(e,c,h)),s--,d=b6(s),md(e,d,r),h=XT[d],h!==0&&(s-=JT[d],eo(e,s,h)));while(f<e.sym_next);md(e,256,t)},D1=(e,t)=>{const r=t.dyn_tree,s=t.stat_desc.static_tree,c=t.stat_desc.has_stree,d=t.stat_desc.elems;let h,f,g,v=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<d;h++)r[2*h]!==0?(e.heap[++e.heap_len]=v=h,e.depth[h]=0):r[2*h+1]=0;for(;e.heap_len<2;)g=e.heap[++e.heap_len]=v<2?++v:0,r[2*g]=1,e.depth[g]=0,e.opt_len--,c&&(e.static_len-=s[2*g+1]);for(t.max_code=v,h=e.heap_len>>1;h>=1;h--)P1(e,r,h);g=d;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],P1(e,r,1),f=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=f,r[2*g]=r[2*h]+r[2*f],e.depth[g]=(e.depth[h]>=e.depth[f]?e.depth[h]:e.depth[f])+1,r[2*h+1]=r[2*f+1]=g,e.heap[1]=g++,P1(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((E,C)=>{const R=C.dyn_tree,A=C.max_code,B=C.stat_desc.static_tree,L=C.stat_desc.has_stree,U=C.stat_desc.extra_bits,X=C.stat_desc.extra_base,Y=C.stat_desc.max_length;let ee,ue,de,ne,be,Ae,Ue=0;for(ne=0;ne<=VE;ne++)E.bl_count[ne]=0;for(R[2*E.heap[E.heap_max]+1]=0,ee=E.heap_max+1;ee<573;ee++)ue=E.heap[ee],ne=R[2*R[2*ue+1]+1]+1,ne>Y&&(ne=Y,Ue++),R[2*ue+1]=ne,ue>A||(E.bl_count[ne]++,be=0,ue>=X&&(be=U[ue-X]),Ae=R[2*ue],E.opt_len+=Ae*(ne+be),L&&(E.static_len+=Ae*(B[2*ue+1]+be)));if(Ue!==0){do{for(ne=Y-1;E.bl_count[ne]===0;)ne--;E.bl_count[ne]--,E.bl_count[ne+1]+=2,E.bl_count[Y]--,Ue-=2}while(Ue>0);for(ne=Y;ne!==0;ne--)for(ue=E.bl_count[ne];ue!==0;)de=E.heap[--ee],de>A||(R[2*de+1]!==ne&&(E.opt_len+=(ne-R[2*de+1])*R[2*de],R[2*de+1]=ne),ue--)}})(e,t),x6(r,v,e.bl_count)},A6=(e,t,r)=>{let s,c,d=-1,h=t[1],f=0,g=7,v=4;for(h===0&&(g=138,v=3),t[2*(r+1)+1]=65535,s=0;s<=r;s++)c=h,h=t[2*(s+1)+1],++f<g&&c===h||(f<v?e.bl_tree[2*c]+=f:c!==0?(c!==d&&e.bl_tree[2*c]++,e.bl_tree[32]++):f<=10?e.bl_tree[34]++:e.bl_tree[36]++,f=0,d=c,h===0?(g=138,v=3):c===h?(g=6,v=3):(g=7,v=4))},I6=(e,t,r)=>{let s,c,d=-1,h=t[1],f=0,g=7,v=4;for(h===0&&(g=138,v=3),s=0;s<=r;s++)if(c=h,h=t[2*(s+1)+1],!(++f<g&&c===h)){if(f<v)do md(e,c,e.bl_tree);while(--f!=0);else c!==0?(c!==d&&(md(e,c,e.bl_tree),f--),md(e,16,e.bl_tree),eo(e,f-3,2)):f<=10?(md(e,17,e.bl_tree),eo(e,f-3,3)):(md(e,18,e.bl_tree),eo(e,f-11,7));f=0,d=c,h===0?(g=138,v=3):c===h?(g=6,v=3):(g=7,v=4)}};let O6=!1;const k6=(e,t,r,s)=>{eo(e,0+(s?1:0),3),C6(e),GE(e,r),GE(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var Zne=e=>{O6||((()=>{let t,r,s,c,d;const h=new Array(16);for(s=0,c=0;c<28;c++)for(I1[c]=s,t=0;t<1<<A1[c];t++)qE[s++]=c;for(qE[s-1]=c,d=0,c=0;c<16;c++)for(JT[c]=d,t=0;t<1<<XT[c];t++)WE[d++]=c;for(d>>=7;c<FE;c++)for(JT[c]=d<<7,t=0;t<1<<XT[c]-7;t++)WE[256+d++]=c;for(r=0;r<=VE;r++)h[r]=0;for(t=0;t<=143;)pu[2*t+1]=8,t++,h[8]++;for(;t<=255;)pu[2*t+1]=9,t++,h[9]++;for(;t<=279;)pu[2*t+1]=7,t++,h[7]++;for(;t<=287;)pu[2*t+1]=8,t++,h[8]++;for(x6(pu,287,h),t=0;t<FE;t++)BE[2*t+1]=5,BE[2*t]=S6(t,5);v6=new O1(pu,A1,257,_6,VE),E6=new O1(BE,XT,0,FE,VE),w6=new O1(new Array(0),Qne,0,19,7)})(),O6=!0),e.l_desc=new k1(e.dyn_ltree,v6),e.d_desc=new k1(e.dyn_dtree,E6),e.bl_desc=new k1(e.bl_tree,w6),e.bi_buf=0,e.bi_valid=0,T6(e)},ese=(e,t,r,s)=>{let c,d,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(f=>{let g,v=4093624447;for(g=0;g<=31;g++,v>>>=1)if(1&v&&f.dyn_ltree[2*g]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(g=32;g<N1;g++)if(f.dyn_ltree[2*g]!==0)return 1;return 0})(e)),D1(e,e.l_desc),D1(e,e.d_desc),h=(f=>{let g;for(A6(f,f.dyn_ltree,f.l_desc.max_code),A6(f,f.dyn_dtree,f.d_desc.max_code),D1(f,f.bl_desc),g=18;g>=3&&f.bl_tree[2*y6[g]+1]===0;g--);return f.opt_len+=3*(g+1)+5+5+4,g})(e),c=e.opt_len+3+7>>>3,d=e.static_len+3+7>>>3,d<=c&&(c=d)):c=d=r+5,r+4<=c&&t!==-1?k6(e,t,r,s):e.strategy===4||d===c?(eo(e,2+(s?1:0),3),N6(e,pu,BE)):(eo(e,4+(s?1:0),3),((f,g,v,E)=>{let C;for(eo(f,g-257,5),eo(f,v-1,5),eo(f,E-4,4),C=0;C<E;C++)eo(f,f.bl_tree[2*y6[C]+1],3);I6(f,f.dyn_ltree,g-1),I6(f,f.dyn_dtree,v-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),N6(e,e.dyn_ltree,e.dyn_dtree)),T6(e),s&&C6(e)},tse=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(qE[r]+N1+1)]++,e.dyn_dtree[2*b6(t)]++),e.sym_next===e.sym_end),rse=e=>{eo(e,2,3),md(e,256,pu),(t=>{t.bi_valid===16?(GE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},nse={_tr_init:Zne,_tr_stored_block:k6,_tr_flush_block:ese,_tr_tally:tse,_tr_align:rse},HE=(e,t,r,s)=>{let c=65535&e|0,d=e>>>16&65535|0,h=0;for(;r!==0;){h=r>2e3?2e3:r,r-=h;do c=c+t[s++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const sse=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Li=(e,t,r,s)=>{const c=sse,d=s+r;e^=-1;for(let h=s;h<d;h++)e=e>>>8^c[255&(e^t[h])];return-1^e},Gf={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},QT={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ise,_tr_stored_block:j1,_tr_flush_block:ase,_tr_tally:Bh,_tr_align:ose}=nse,{Z_NO_FLUSH:Wh,Z_PARTIAL_FLUSH:cse,Z_FULL_FLUSH:lse,Z_FINISH:fc,Z_BLOCK:P6,Z_OK:zi,Z_STREAM_END:D6,Z_STREAM_ERROR:gd,Z_DATA_ERROR:dse,Z_BUF_ERROR:L1,Z_DEFAULT_COMPRESSION:use,Z_FILTERED:hse,Z_HUFFMAN_ONLY:ZT,Z_RLE:pse,Z_FIXED:fse,Z_DEFAULT_STRATEGY:mse,Z_UNKNOWN:gse,Z_DEFLATED:eC}=QT,M1=286,_se=30,yse=19,vse=2*M1+1,Ese=15,Hf=258,_d=262,$_=42,Kf=113,KE=666,zf=(e,t)=>(e.msg=Gf[t],t),j6=e=>2*e-(e>4?9:0),qh=e=>{let t=e.length;for(;--t>=0;)e[t]=0},wse=e=>{let t,r,s,c=e.w_size;t=e.hash_size,s=t;do r=e.head[--s],e.head[s]=r>=c?r-c:0;while(--t);t=c,s=t;do r=e.prev[--s],e.prev[s]=r>=c?r-c:0;while(--t)};let Gh=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const Io=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},Oo=(e,t)=>{ase(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Io(e.strm)},On=(e,t)=>{e.pending_buf[e.pending++]=t},zE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},U1=(e,t,r,s)=>{let c=e.avail_in;return c>s&&(c=s),c===0?0:(e.avail_in-=c,t.set(e.input.subarray(e.next_in,e.next_in+c),r),e.state.wrap===1?e.adler=HE(e.adler,t,c,r):e.state.wrap===2&&(e.adler=Li(e.adler,t,c,r)),e.next_in+=c,e.total_in+=c,c)},L6=(e,t)=>{let r,s,c=e.max_chain_length,d=e.strstart,h=e.prev_length,f=e.nice_match;const g=e.strstart>e.w_size-_d?e.strstart-(e.w_size-_d):0,v=e.window,E=e.w_mask,C=e.prev,R=e.strstart+Hf;let A=v[d+h-1],B=v[d+h];e.prev_length>=e.good_match&&(c>>=2),f>e.lookahead&&(f=e.lookahead);do if(r=t,v[r+h]===B&&v[r+h-1]===A&&v[r]===v[d]&&v[++r]===v[d+1]){d+=2,r++;do;while(v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&v[++d]===v[++r]&&d<R);if(s=Hf-(R-d),d=R-Hf,s>h){if(e.match_start=t,h=s,s>=f)break;A=v[d+h-1],B=v[d+h]}}while((t=C[t&E])>g&&--c!=0);return h<=e.lookahead?h:e.lookahead},Y_=e=>{const t=e.w_size;let r,s,c;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-_d)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),wse(e),s+=t),e.strm.avail_in===0)break;if(r=U1(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=r,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Gh(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Gh(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_d&&e.strm.avail_in!==0)},M6=(e,t)=>{let r,s,c,d=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,f=e.strm.avail_in;do{if(r=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,s=e.strstart-e.block_start,r>s+e.strm.avail_in&&(r=s+e.strm.avail_in),r>c&&(r=c),r<d&&(r===0&&t!==fc||t===Wh||r!==s+e.strm.avail_in)))break;h=t===fc&&r===s+e.strm.avail_in?1:0,j1(e,0,0,h),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Io(e.strm),s&&(s>r&&(s=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,r-=s),r&&(U1(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(h===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:t!==Wh&&t!==fc&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(U1(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,d=c>e.w_size?e.w_size:c,s=e.strstart-e.block_start,(s>=d||(s||t===fc)&&t!==Wh&&e.strm.avail_in===0&&s<=c)&&(r=s>c?c:s,h=t===fc&&e.strm.avail_in===0&&r===s?1:0,j1(e,e.block_start,r,h),e.block_start+=r,Io(e.strm)),h?3:1)},F1=(e,t)=>{let r,s;for(;;){if(e.lookahead<_d){if(Y_(e),e.lookahead<_d&&t===Wh)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Gh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-_d&&(e.match_length=L6(e,r)),e.match_length>=3)if(s=Bh(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Gh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Gh(e,e.ins_h,e.window[e.strstart+1]);else s=Bh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Oo(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===fc?(Oo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Oo(e,!1),e.strm.avail_out===0)?1:2},X_=(e,t)=>{let r,s,c;for(;;){if(e.lookahead<_d){if(Y_(e),e.lookahead<_d&&t===Wh)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=Gh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-_d&&(e.match_length=L6(e,r),e.match_length<=5&&(e.strategy===hse||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,s=Bh(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Gh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(Oo(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(s=Bh(e,0,e.window[e.strstart-1]),s&&Oo(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Bh(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===fc?(Oo(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Oo(e,!1),e.strm.avail_out===0)?1:2};function yd(e,t,r,s,c){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=s,this.func=c}const $E=[new yd(0,0,0,0,M6),new yd(4,4,8,4,F1),new yd(4,5,16,8,F1),new yd(4,6,32,32,F1),new yd(4,4,16,16,X_),new yd(8,16,32,32,X_),new yd(8,16,128,128,X_),new yd(8,32,128,256,X_),new yd(32,128,258,1024,X_),new yd(32,258,258,4096,X_)];function bse(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=eC,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*vse),this.dyn_dtree=new Uint16Array(2*(2*_se+1)),this.bl_tree=new Uint16Array(2*(2*yse+1)),qh(this.dyn_ltree),qh(this.dyn_dtree),qh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Ese+1),this.heap=new Uint16Array(2*M1+1),qh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*M1+1),qh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const YE=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==$_&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Kf&&t.status!==KE?1:0},U6=e=>{if(YE(e))return zf(e,gd);e.total_in=e.total_out=0,e.data_type=gse;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?$_:Kf,e.adler=t.wrap===2?0:1,t.last_flush=-2,ise(t),zi},F6=e=>{const t=U6(e);return t===zi&&(r=>{r.window_size=2*r.w_size,qh(r.head),r.max_lazy_match=$E[r.level].max_lazy,r.good_match=$E[r.level].good_length,r.nice_match=$E[r.level].nice_length,r.max_chain_length=$E[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},V6=(e,t,r,s,c,d)=>{if(!e)return gd;let h=1;if(t===use&&(t=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||r!==eC||s<8||s>15||t<0||t>9||d<0||d>fse||s===8&&h!==1)return zf(e,gd);s===8&&(s=9);const f=new bse;return e.state=f,f.strm=e,f.status=$_,f.wrap=h,f.gzhead=null,f.w_bits=s,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=c+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<c+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=t,f.strategy=d,f.method=r,F6(e)};var Sse=(e,t)=>{if(YE(e)||t>P6||t<0)return e?zf(e,gd):gd;const r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===KE&&t!==fc)return zf(e,e.avail_out===0?L1:gd);const s=r.last_flush;if(r.last_flush=t,r.pending!==0){if(Io(e),e.avail_out===0)return r.last_flush=-1,zi}else if(e.avail_in===0&&j6(t)<=j6(s)&&t!==fc)return zf(e,L1);if(r.status===KE&&e.avail_in!==0)return zf(e,L1);if(r.status===$_&&r.wrap===0&&(r.status=Kf),r.status===$_){let c=eC+(r.w_bits-8<<4)<<8,d=-1;if(d=r.strategy>=ZT||r.level<2?0:r.level<6?1:r.level===6?2:3,c|=d<<6,r.strstart!==0&&(c|=32),c+=31-c%31,zE(r,c),r.strstart!==0&&(zE(r,e.adler>>>16),zE(r,65535&e.adler)),e.adler=1,r.status=Kf,Io(e),r.pending!==0)return r.last_flush=-1,zi}if(r.status===57){if(e.adler=0,On(r,31),On(r,139),On(r,8),r.gzhead)On(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),On(r,255&r.gzhead.time),On(r,r.gzhead.time>>8&255),On(r,r.gzhead.time>>16&255),On(r,r.gzhead.time>>24&255),On(r,r.level===9?2:r.strategy>=ZT||r.level<2?4:0),On(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(On(r,255&r.gzhead.extra.length),On(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Li(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(On(r,0),On(r,0),On(r,0),On(r,0),On(r,0),On(r,r.level===9?2:r.strategy>=ZT||r.level<2?4:0),On(r,3),r.status=Kf,Io(e),r.pending!==0)return r.last_flush=-1,zi}if(r.status===69){if(r.gzhead.extra){let c=r.pending,d=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+d>r.pending_buf_size;){let f=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+f),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>c&&(e.adler=Li(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex+=f,Io(e),r.pending!==0)return r.last_flush=-1,zi;c=0,d-=f}let h=new Uint8Array(r.gzhead.extra);r.pending_buf.set(h.subarray(r.gzindex,r.gzindex+d),r.pending),r.pending+=d,r.gzhead.hcrc&&r.pending>c&&(e.adler=Li(e.adler,r.pending_buf,r.pending-c,c)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(e.adler=Li(e.adler,r.pending_buf,r.pending-d,d)),Io(e),r.pending!==0)return r.last_flush=-1,zi;d=0}c=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,On(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>d&&(e.adler=Li(e.adler,r.pending_buf,r.pending-d,d)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let c,d=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>d&&(e.adler=Li(e.adler,r.pending_buf,r.pending-d,d)),Io(e),r.pending!==0)return r.last_flush=-1,zi;d=0}c=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,On(r,c)}while(c!==0);r.gzhead.hcrc&&r.pending>d&&(e.adler=Li(e.adler,r.pending_buf,r.pending-d,d))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Io(e),r.pending!==0))return r.last_flush=-1,zi;On(r,255&e.adler),On(r,e.adler>>8&255),e.adler=0}if(r.status=Kf,Io(e),r.pending!==0)return r.last_flush=-1,zi}if(e.avail_in!==0||r.lookahead!==0||t!==Wh&&r.status!==KE){let c=r.level===0?M6(r,t):r.strategy===ZT?((d,h)=>{let f;for(;;){if(d.lookahead===0&&(Y_(d),d.lookahead===0)){if(h===Wh)return 1;break}if(d.match_length=0,f=Bh(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,f&&(Oo(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===fc?(Oo(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Oo(d,!1),d.strm.avail_out===0)?1:2})(r,t):r.strategy===pse?((d,h)=>{let f,g,v,E;const C=d.window;for(;;){if(d.lookahead<=Hf){if(Y_(d),d.lookahead<=Hf&&h===Wh)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,g=C[v],g===C[++v]&&g===C[++v]&&g===C[++v])){E=d.strstart+Hf;do;while(g===C[++v]&&g===C[++v]&&g===C[++v]&&g===C[++v]&&g===C[++v]&&g===C[++v]&&g===C[++v]&&g===C[++v]&&v<E);d.match_length=Hf-(E-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(f=Bh(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(f=Bh(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),f&&(Oo(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===fc?(Oo(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Oo(d,!1),d.strm.avail_out===0)?1:2})(r,t):$E[r.level].func(r,t);if(c!==3&&c!==4||(r.status=KE),c===1||c===3)return e.avail_out===0&&(r.last_flush=-1),zi;if(c===2&&(t===cse?ose(r):t!==P6&&(j1(r,0,0,!1),t===lse&&(qh(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Io(e),e.avail_out===0))return r.last_flush=-1,zi}return t!==fc?zi:r.wrap<=0?D6:(r.wrap===2?(On(r,255&e.adler),On(r,e.adler>>8&255),On(r,e.adler>>16&255),On(r,e.adler>>24&255),On(r,255&e.total_in),On(r,e.total_in>>8&255),On(r,e.total_in>>16&255),On(r,e.total_in>>24&255)):(zE(r,e.adler>>>16),zE(r,65535&e.adler)),Io(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?zi:D6)},xse=(e,t)=>{let r=t.length;if(YE(e))return gd;const s=e.state,c=s.wrap;if(c===2||c===1&&s.status!==$_||s.lookahead)return gd;if(c===1&&(e.adler=HE(e.adler,t,r,0)),s.wrap=0,r>=s.w_size){c===0&&(qh(s.head),s.strstart=0,s.block_start=0,s.insert=0);let g=new Uint8Array(s.w_size);g.set(t.subarray(r-s.w_size,r),0),t=g,r=s.w_size}const d=e.avail_in,h=e.next_in,f=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Y_(s);s.lookahead>=3;){let g=s.strstart,v=s.lookahead-2;do s.ins_h=Gh(s,s.ins_h,s.window[g+3-1]),s.prev[g&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=g,g++;while(--v);s.strstart=g,s.lookahead=2,Y_(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=h,e.input=f,e.avail_in=d,s.wrap=c,zi},XE={deflateInit:(e,t)=>V6(e,t,eC,15,8,mse),deflateInit2:V6,deflateReset:F6,deflateResetKeep:U6,deflateSetHeader:(e,t)=>YE(e)||e.state.wrap!==2?gd:(e.state.gzhead=t,zi),deflate:Sse,deflateEnd:e=>{if(YE(e))return gd;const t=e.state.status;return e.state=null,t===Kf?zf(e,dse):zi},deflateSetDictionary:xse,deflateInfo:"pako deflate (from Nodeca project)"};const Tse=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var tC={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(const s in r)Tse(r,s)&&(e[s]=r[s])}}return e},flattenChunks:e=>{let t=0;for(let s=0,c=e.length;s<c;s++)t+=e[s].length;const r=new Uint8Array(t);for(let s=0,c=0,d=e.length;s<d;s++){let h=e[s];r.set(h,c),c+=h.length}return r}};let B6=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{B6=!1}const JE=new Uint8Array(256);for(let e=0;e<256;e++)JE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;JE[254]=JE[254]=1;var QE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,s,c,d,h=e.length,f=0;for(c=0;c<h;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(s=e.charCodeAt(c+1),(64512&s)==56320&&(r=65536+(r-55296<<10)+(s-56320),c++)),f+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(f),d=0,c=0;d<f;c++)r=e.charCodeAt(c),(64512&r)==55296&&c+1<h&&(s=e.charCodeAt(c+1),(64512&s)==56320&&(r=65536+(r-55296<<10)+(s-56320),c++)),r<128?t[d++]=r:r<2048?(t[d++]=192|r>>>6,t[d++]=128|63&r):r<65536?(t[d++]=224|r>>>12,t[d++]=128|r>>>6&63,t[d++]=128|63&r):(t[d++]=240|r>>>18,t[d++]=128|r>>>12&63,t[d++]=128|r>>>6&63,t[d++]=128|63&r);return t},buf2string:(e,t)=>{const r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let s,c;const d=new Array(2*r);for(c=0,s=0;s<r;){let h=e[s++];if(h<128){d[c++]=h;continue}let f=JE[h];if(f>4)d[c++]=65533,s+=f-1;else{for(h&=f===2?31:f===3?15:7;f>1&&s<r;)h=h<<6|63&e[s++],f--;f>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,f)=>{if(f<65534&&h.subarray&&B6)return String.fromCharCode.apply(null,h.length===f?h:h.subarray(0,f));let g="";for(let v=0;v<f;v++)g+=String.fromCharCode(h[v]);return g})(d,c)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+JE[e[r]]>t?r:t}},W6=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const q6=Object.prototype.toString,{Z_NO_FLUSH:Cse,Z_SYNC_FLUSH:Rse,Z_FULL_FLUSH:Nse,Z_FINISH:Ase,Z_OK:rC,Z_STREAM_END:Ise,Z_DEFAULT_COMPRESSION:Ose,Z_DEFAULT_STRATEGY:kse,Z_DEFLATED:Pse}=QT;function nC(e){this.options=tC.assign({level:Ose,method:Pse,chunkSize:16384,windowBits:15,memLevel:8,strategy:kse},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new W6,this.strm.avail_out=0;let r=XE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==rC)throw new Error(Gf[r]);if(t.header&&XE.deflateSetHeader(this.strm,t.header),t.dictionary){let s;if(s=typeof t.dictionary=="string"?QE.string2buf(t.dictionary):q6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=XE.deflateSetDictionary(this.strm,s),r!==rC)throw new Error(Gf[r]);this._dict_set=!0}}function Dse(e,t){const r=new nC(t);if(r.push(e,!0),r.err)throw r.msg||Gf[r.err];return r.result}nC.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Ase:Cse,typeof e=="string"?r.input=QE.string2buf(e):q6.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),(d===Rse||d===Nse)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(c=XE.deflate(r,d),c===Ise)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),c=XE.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===rC;if(r.avail_out!==0){if(d>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},nC.prototype.onData=function(e){this.chunks.push(e)},nC.prototype.onEnd=function(e){e===rC&&(this.result=tC.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jse={deflate:Dse};const sC=16209;var Lse=function(e,t){let r,s,c,d,h,f,g,v,E,C,R,A,B,L,U,X,Y,ee,ue,de,ne,be,Ae,Ue;const He=e.state;r=e.next_in,Ae=e.input,s=r+(e.avail_in-5),c=e.next_out,Ue=e.output,d=c-(t-e.avail_out),h=c+(e.avail_out-257),f=He.dmax,g=He.wsize,v=He.whave,E=He.wnext,C=He.window,R=He.hold,A=He.bits,B=He.lencode,L=He.distcode,U=(1<<He.lenbits)-1,X=(1<<He.distbits)-1;e:do{A<15&&(R+=Ae[r++]<<A,A+=8,R+=Ae[r++]<<A,A+=8),Y=B[R&U];t:for(;;){if(ee=Y>>>24,R>>>=ee,A-=ee,ee=Y>>>16&255,ee===0)Ue[c++]=65535&Y;else{if(!(16&ee)){if((64&ee)==0){Y=B[(65535&Y)+(R&(1<<ee)-1)];continue t}if(32&ee){He.mode=16191;break e}e.msg="invalid literal/length code",He.mode=sC;break e}ue=65535&Y,ee&=15,ee&&(A<ee&&(R+=Ae[r++]<<A,A+=8),ue+=R&(1<<ee)-1,R>>>=ee,A-=ee),A<15&&(R+=Ae[r++]<<A,A+=8,R+=Ae[r++]<<A,A+=8),Y=L[R&X];r:for(;;){if(ee=Y>>>24,R>>>=ee,A-=ee,ee=Y>>>16&255,!(16&ee)){if((64&ee)==0){Y=L[(65535&Y)+(R&(1<<ee)-1)];continue r}e.msg="invalid distance code",He.mode=sC;break e}if(de=65535&Y,ee&=15,A<ee&&(R+=Ae[r++]<<A,A+=8,A<ee&&(R+=Ae[r++]<<A,A+=8)),de+=R&(1<<ee)-1,de>f){e.msg="invalid distance too far back",He.mode=sC;break e}if(R>>>=ee,A-=ee,ee=c-d,de>ee){if(ee=de-ee,ee>v&&He.sane){e.msg="invalid distance too far back",He.mode=sC;break e}if(ne=0,be=C,E===0){if(ne+=g-ee,ee<ue){ue-=ee;do Ue[c++]=C[ne++];while(--ee);ne=c-de,be=Ue}}else if(E<ee){if(ne+=g+E-ee,ee-=E,ee<ue){ue-=ee;do Ue[c++]=C[ne++];while(--ee);if(ne=0,E<ue){ee=E,ue-=ee;do Ue[c++]=C[ne++];while(--ee);ne=c-de,be=Ue}}}else if(ne+=E-ee,ee<ue){ue-=ee;do Ue[c++]=C[ne++];while(--ee);ne=c-de,be=Ue}for(;ue>2;)Ue[c++]=be[ne++],Ue[c++]=be[ne++],Ue[c++]=be[ne++],ue-=3;ue&&(Ue[c++]=be[ne++],ue>1&&(Ue[c++]=be[ne++]))}else{ne=c-de;do Ue[c++]=Ue[ne++],Ue[c++]=Ue[ne++],Ue[c++]=Ue[ne++],ue-=3;while(ue>2);ue&&(Ue[c++]=Ue[ne++],ue>1&&(Ue[c++]=Ue[ne++]))}break}}break}}while(r<s&&c<h);ue=A>>3,r-=ue,A-=ue<<3,R&=(1<<A)-1,e.next_in=r,e.next_out=c,e.avail_in=r<s?s-r+5:5-(r-s),e.avail_out=c<h?h-c+257:257-(c-h),He.hold=R,He.bits=A};const iC=15,Mse=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Use=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Fse=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Vse=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ZE=(e,t,r,s,c,d,h,f)=>{const g=f.bits;let v,E,C,R,A,B,L=0,U=0,X=0,Y=0,ee=0,ue=0,de=0,ne=0,be=0,Ae=0,Ue=null;const He=new Uint16Array(16),Yt=new Uint16Array(16);let Qt,Lt,Ir,xr=null;for(L=0;L<=iC;L++)He[L]=0;for(U=0;U<s;U++)He[t[r+U]]++;for(ee=g,Y=iC;Y>=1&&He[Y]===0;Y--);if(ee>Y&&(ee=Y),Y===0)return c[d++]=20971520,c[d++]=20971520,f.bits=1,0;for(X=1;X<Y&&He[X]===0;X++);for(ee<X&&(ee=X),ne=1,L=1;L<=iC;L++)if(ne<<=1,ne-=He[L],ne<0)return-1;if(ne>0&&(e===0||Y!==1))return-1;for(Yt[1]=0,L=1;L<iC;L++)Yt[L+1]=Yt[L]+He[L];for(U=0;U<s;U++)t[r+U]!==0&&(h[Yt[t[r+U]]++]=U);if(e===0?(Ue=xr=h,B=20):e===1?(Ue=Mse,xr=Use,B=257):(Ue=Fse,xr=Vse,B=0),Ae=0,U=0,L=X,A=d,ue=ee,de=0,C=-1,be=1<<ee,R=be-1,e===1&&be>852||e===2&&be>592)return 1;for(;;){Qt=L-de,h[U]+1<B?(Lt=0,Ir=h[U]):h[U]>=B?(Lt=xr[h[U]-B],Ir=Ue[h[U]-B]):(Lt=96,Ir=0),v=1<<L-de,E=1<<ue,X=E;do E-=v,c[A+(Ae>>de)+E]=Qt<<24|Lt<<16|Ir|0;while(E!==0);for(v=1<<L-1;Ae&v;)v>>=1;if(v!==0?(Ae&=v-1,Ae+=v):Ae=0,U++,--He[L]==0){if(L===Y)break;L=t[r+h[U]]}if(L>ee&&(Ae&R)!==C){for(de===0&&(de=ee),A+=X,ue=L-de,ne=1<<ue;ue+de<Y&&(ne-=He[ue+de],!(ne<=0));)ue++,ne<<=1;if(be+=1<<ue,e===1&&be>852||e===2&&be>592)return 1;C=Ae&R,c[C]=ee<<24|ue<<16|A-d|0}}return Ae!==0&&(c[A+Ae]=L-de<<24|64<<16|0),f.bits=ee,0};const{Z_FINISH:G6,Z_BLOCK:Bse,Z_TREES:aC,Z_OK:$f,Z_STREAM_END:Wse,Z_NEED_DICT:qse,Z_STREAM_ERROR:mc,Z_DATA_ERROR:H6,Z_MEM_ERROR:K6,Z_BUF_ERROR:Gse,Z_DEFLATED:z6}=QT,oC=16180,cC=16190,fu=16191,V1=16192,B1=16194,lC=16199,dC=16200,W1=16206,ms=16209,$6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Hse(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Yf=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<oC||t.mode>16211?1:0},Y6=e=>{if(Yf(e))return mc;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=oC,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,$f},X6=e=>{if(Yf(e))return mc;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Y6(e)},J6=(e,t)=>{let r;if(Yf(e))return mc;const s=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?mc:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=r,s.wbits=t,X6(e))},Q6=(e,t)=>{if(!e)return mc;const r=new Hse;e.state=r,r.strm=e,r.window=null,r.mode=oC;const s=J6(e,t);return s!==$f&&(e.state=null),s};let q1,G1,Z6=!0;const Kse=e=>{if(Z6){q1=new Int32Array(512),G1=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ZE(1,e.lens,0,288,q1,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ZE(2,e.lens,0,32,G1,0,e.work,{bits:5}),Z6=!1}e.lencode=q1,e.lenbits=9,e.distcode=G1,e.distbits=5},e8=(e,t,r,s)=>{let c;const d=e.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),s>=d.wsize?(d.window.set(t.subarray(r-d.wsize,r),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>s&&(c=s),d.window.set(t.subarray(r-s,r-s+c),d.wnext),(s-=c)?(d.window.set(t.subarray(r-s,r),0),d.wnext=s,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var zse=(e,t)=>{let r,s,c,d,h,f,g,v,E,C,R,A,B,L,U,X,Y,ee,ue,de,ne,be,Ae=0;const Ue=new Uint8Array(4);let He,Yt;const Qt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Yf(e)||!e.output||!e.input&&e.avail_in!==0)return mc;r=e.state,r.mode===fu&&(r.mode=V1),h=e.next_out,c=e.output,g=e.avail_out,d=e.next_in,s=e.input,f=e.avail_in,v=r.hold,E=r.bits,C=f,R=g,be=$f;e:for(;;)switch(r.mode){case oC:if(r.wrap===0){r.mode=V1;break}for(;E<16;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(2&r.wrap&&v===35615){r.wbits===0&&(r.wbits=15),r.check=0,Ue[0]=255&v,Ue[1]=v>>>8&255,r.check=Li(r.check,Ue,2,0),v=0,E=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&v)<<8)+(v>>8))%31){e.msg="incorrect header check",r.mode=ms;break}if((15&v)!==z6){e.msg="unknown compression method",r.mode=ms;break}if(v>>>=4,E-=4,ne=8+(15&v),r.wbits===0&&(r.wbits=ne),ne>15||ne>r.wbits){e.msg="invalid window size",r.mode=ms;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&v?16189:fu,v=0,E=0;break;case 16181:for(;E<16;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(r.flags=v,(255&vi(r))!==z6){e.msg="unknown compression method",r.mode=ms;break}if(57344&vi(r)){e.msg="unknown header flags set",r.mode=ms;break}r.head&&(r.head.text=v>>8&1),512&vi(r)&&4&r.wrap&&(Ue[0]=255&v,Ue[1]=v>>>8&255,r.check=Li(r.check,Ue,2,0)),v=0,E=0,r.mode=16182;case 16182:for(;E<32;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}r.head&&(r.head.time=v),512&vi(r)&&4&r.wrap&&(Ue[0]=255&v,Ue[1]=v>>>8&255,Ue[2]=v>>>16&255,Ue[3]=v>>>24&255,r.check=Li(r.check,Ue,4,0)),v=0,E=0,r.mode=16183;case 16183:for(;E<16;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}r.head&&(r.head.xflags=255&v,r.head.os=v>>8),512&vi(r)&&4&r.wrap&&(Ue[0]=255&v,Ue[1]=v>>>8&255,r.check=Li(r.check,Ue,2,0)),v=0,E=0,r.mode=16184;case 16184:if(1024&vi(r)){for(;E<16;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}r.length=v,r.head&&(r.head.extra_len=v),512&vi(r)&&4&r.wrap&&(Ue[0]=255&v,Ue[1]=v>>>8&255,r.check=Li(r.check,Ue,2,0)),v=0,E=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&vi(r)&&(A=r.length,A>f&&(A=f),A&&(r.head&&(ne=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(d,d+A),ne)),512&vi(r)&&4&r.wrap&&(r.check=Li(r.check,s,A,d)),f-=A,d+=A,r.length-=A),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&vi(r)){if(f===0)break e;A=0;do ne=s[d+A++],r.head&&ne&&r.length<65536&&(r.head.name+=String.fromCharCode(ne));while(ne&&A<f);if(512&vi(r)&&4&r.wrap&&(r.check=Li(r.check,s,A,d)),f-=A,d+=A,ne)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&vi(r)){if(f===0)break e;A=0;do ne=s[d+A++],r.head&&ne&&r.length<65536&&(r.head.comment+=String.fromCharCode(ne));while(ne&&A<f);if(512&vi(r)&&4&r.wrap&&(r.check=Li(r.check,s,A,d)),f-=A,d+=A,ne)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&vi(r)){for(;E<16;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(4&r.wrap&&v!==(65535&r.check)){e.msg="header crc mismatch",r.mode=ms;break}v=0,E=0}r.head&&(r.head.hcrc=vi(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=fu;break;case 16189:for(;E<32;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}e.adler=r.check=$6(v),v=0,E=0,r.mode=cC;case cC:if(r.havedict===0)return e.next_out=h,e.avail_out=g,e.next_in=d,e.avail_in=f,r.hold=v,r.bits=E,qse;e.adler=r.check=1,r.mode=fu;case fu:if(t===Bse||t===aC)break e;case V1:if(r.last){v>>>=7&E,E-=7&E,r.mode=W1;break}for(;E<3;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}switch(r.last=1&v,v>>>=1,E-=1,3&v){case 0:r.mode=16193;break;case 1:if(Kse(r),r.mode=lC,t===aC){v>>>=2,E-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=ms}v>>>=2,E-=2;break;case 16193:for(v>>>=7&E,E-=7&E;E<32;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if((65535&v)!=(v>>>16^65535)){e.msg="invalid stored block lengths",r.mode=ms;break}if(r.length=65535&v,v=0,E=0,r.mode=B1,t===aC)break e;case B1:r.mode=16195;case 16195:if(A=r.length,A){if(A>f&&(A=f),A>g&&(A=g),A===0)break e;c.set(s.subarray(d,d+A),h),f-=A,d+=A,g-=A,h+=A,r.length-=A;break}r.mode=fu;break;case 16196:for(;E<14;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(r.nlen=257+(31&v),v>>>=5,E-=5,r.ndist=1+(31&v),v>>>=5,E-=5,r.ncode=4+(15&v),v>>>=4,E-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=ms;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;E<3;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}r.lens[Qt[r.have++]]=7&v,v>>>=3,E-=3}for(;r.have<19;)r.lens[Qt[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,He={bits:r.lenbits},be=ZE(0,r.lens,0,19,r.lencode,0,r.work,He),r.lenbits=He.bits,be){e.msg="invalid code lengths set",r.mode=ms;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;Ae=r.lencode[v&(1<<r.lenbits)-1],U=Ae>>>24,X=Ae>>>16&255,Y=65535&Ae,!(U<=E);){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(Y<16)v>>>=U,E-=U,r.lens[r.have++]=Y;else{if(Y===16){for(Yt=U+2;E<Yt;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(v>>>=U,E-=U,r.have===0){e.msg="invalid bit length repeat",r.mode=ms;break}ne=r.lens[r.have-1],A=3+(3&v),v>>>=2,E-=2}else if(Y===17){for(Yt=U+3;E<Yt;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}v>>>=U,E-=U,ne=0,A=3+(7&v),v>>>=3,E-=3}else{for(Yt=U+7;E<Yt;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}v>>>=U,E-=U,ne=0,A=11+(127&v),v>>>=7,E-=7}if(r.have+A>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=ms;break}for(;A--;)r.lens[r.have++]=ne}}if(r.mode===ms)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=ms;break}if(r.lenbits=9,He={bits:r.lenbits},be=ZE(1,r.lens,0,r.nlen,r.lencode,0,r.work,He),r.lenbits=He.bits,be){e.msg="invalid literal/lengths set",r.mode=ms;break}if(r.distbits=6,r.distcode=r.distdyn,He={bits:r.distbits},be=ZE(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,He),r.distbits=He.bits,be){e.msg="invalid distances set",r.mode=ms;break}if(r.mode=lC,t===aC)break e;case lC:r.mode=dC;case dC:if(f>=6&&g>=258){e.next_out=h,e.avail_out=g,e.next_in=d,e.avail_in=f,r.hold=v,r.bits=E,Lse(e,R),h=e.next_out,c=e.output,g=e.avail_out,d=e.next_in,s=e.input,f=e.avail_in,v=r.hold,E=r.bits,r.mode===fu&&(r.back=-1);break}for(r.back=0;Ae=r.lencode[v&(1<<r.lenbits)-1],U=Ae>>>24,X=Ae>>>16&255,Y=65535&Ae,!(U<=E);){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(X&&(240&X)==0){for(ee=U,ue=X,de=Y;Ae=r.lencode[de+((v&(1<<ee+ue)-1)>>ee)],U=Ae>>>24,X=Ae>>>16&255,Y=65535&Ae,!(ee+U<=E);){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}v>>>=ee,E-=ee,r.back+=ee}if(v>>>=U,E-=U,r.back+=U,r.length=Y,X===0){r.mode=16205;break}if(32&X){r.back=-1,r.mode=fu;break}if(64&X){e.msg="invalid literal/length code",r.mode=ms;break}r.extra=15&X,r.mode=16201;case 16201:if(r.extra){for(Yt=r.extra;E<Yt;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}r.length+=v&(1<<r.extra)-1,v>>>=r.extra,E-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;Ae=r.distcode[v&(1<<r.distbits)-1],U=Ae>>>24,X=Ae>>>16&255,Y=65535&Ae,!(U<=E);){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if((240&X)==0){for(ee=U,ue=X,de=Y;Ae=r.distcode[de+((v&(1<<ee+ue)-1)>>ee)],U=Ae>>>24,X=Ae>>>16&255,Y=65535&Ae,!(ee+U<=E);){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}v>>>=ee,E-=ee,r.back+=ee}if(v>>>=U,E-=U,r.back+=U,64&X){e.msg="invalid distance code",r.mode=ms;break}r.offset=Y,r.extra=15&X,r.mode=16203;case 16203:if(r.extra){for(Yt=r.extra;E<Yt;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}r.offset+=v&(1<<r.extra)-1,v>>>=r.extra,E-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=ms;break}r.mode=16204;case 16204:if(g===0)break e;if(A=R-g,r.offset>A){if(A=r.offset-A,A>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=ms;break}A>r.wnext?(A-=r.wnext,B=r.wsize-A):B=r.wnext-A,A>r.length&&(A=r.length),L=r.window}else L=c,B=h-r.offset,A=r.length;A>g&&(A=g),g-=A,r.length-=A;do c[h++]=L[B++];while(--A);r.length===0&&(r.mode=dC);break;case 16205:if(g===0)break e;c[h++]=r.length,g--,r.mode=dC;break;case W1:if(r.wrap){for(;E<32;){if(f===0)break e;f--,v|=s[d++]<<E,E+=8}if(R-=g,e.total_out+=R,r.total+=R,4&r.wrap&&R&&(e.adler=r.check=vi(r)?Li(r.check,c,R,h-R):HE(r.check,c,R,h-R)),R=g,4&r.wrap&&(vi(r)?v:$6(v))!==r.check){e.msg="incorrect data check",r.mode=ms;break}v=0,E=0}r.mode=16207;case 16207:if(r.wrap&&vi(r)){for(;E<32;){if(f===0)break e;f--,v+=s[d++]<<E,E+=8}if(4&r.wrap&&v!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=ms;break}v=0,E=0}r.mode=16208;case 16208:be=Wse;break e;case ms:be=H6;break e;case 16210:return K6;default:return mc}return e.next_out=h,e.avail_out=g,e.next_in=d,e.avail_in=f,r.hold=v,r.bits=E,(r.wsize||R!==e.avail_out&&r.mode<ms&&(r.mode<W1||t!==G6))&&e8(e,e.output,e.next_out,R-e.avail_out),C-=e.avail_in,R-=e.avail_out,e.total_in+=C,e.total_out+=R,r.total+=R,4&r.wrap&&R&&(e.adler=r.check=vi(r)?Li(r.check,c,R,e.next_out-R):HE(r.check,c,R,e.next_out-R)),e.data_type=r.bits+(r.last?64:0)+(r.mode===fu?128:0)+(r.mode===lC||r.mode===B1?256:0),(C===0&&R===0||t===G6)&&be===$f&&(be=Gse),be},mu={inflateReset:X6,inflateReset2:J6,inflateResetKeep:Y6,inflateInit:e=>Q6(e,15),inflateInit2:Q6,inflate:zse,inflateEnd:e=>{if(Yf(e))return mc;let t=e.state;return t.window&&(t.window=null),e.state=null,$f},inflateGetHeader:(e,t)=>{if(Yf(e))return mc;const r=e.state;return(2&r.wrap)==0?mc:(r.head=t,t.done=!1,$f)},inflateSetDictionary:(e,t)=>{const r=t.length;let s,c,d;return Yf(e)?mc:(s=e.state,s.wrap!==0&&s.mode!==cC?mc:s.mode===cC&&(c=1,c=HE(c,t,r,0),c!==s.check)?H6:(d=e8(e,t,r,r),d?(s.mode=16210,K6):(s.havedict=1,$f)))},inflateInfo:"pako inflate (from Nodeca project)"},$se=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const t8=Object.prototype.toString,{Z_NO_FLUSH:Yse,Z_FINISH:Xse,Z_OK:ew,Z_STREAM_END:H1,Z_NEED_DICT:K1,Z_STREAM_ERROR:Jse,Z_DATA_ERROR:r8,Z_MEM_ERROR:Qse}=QT;function uC(e){this.options=tC.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new W6,this.strm.avail_out=0;let r=mu.inflateInit2(this.strm,t.windowBits);if(r!==ew)throw new Error(Gf[r]);if(this.header=new $se,mu.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=QE.string2buf(t.dictionary):t8.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=mu.inflateSetDictionary(this.strm,t.dictionary),r!==ew)))throw new Error(Gf[r])}function Zse(e,t){const r=new uC(t);if(r.push(e),r.err)throw r.msg||Gf[r.err];return r.result}uC.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let d,h,f;if(this.ended)return!1;for(h=t===~~t?t:t===!0?Xse:Yse,t8.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),d=mu.inflate(r,h),d===K1&&c&&(d=mu.inflateSetDictionary(r,c),d===ew?d=mu.inflate(r,h):d===r8&&(d=K1));r.avail_in>0&&d===H1&&r.state.wrap>0&&e[r.next_in]!==0;)mu.inflateReset(r),d=mu.inflate(r,h);switch(d){case Jse:case r8:case K1:case Qse:return this.onEnd(d),this.ended=!0,!1}if(f=r.avail_out,r.next_out&&(r.avail_out===0||d===H1))if(this.options.to==="string"){let g=QE.utf8border(r.output,r.next_out),v=r.next_out-g,E=QE.buf2string(r.output,g);r.next_out=v,r.avail_out=s-v,v&&r.output.set(r.output.subarray(g,g+v),0),this.onData(E)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(d!==ew||f!==0){if(d===H1)return d=mu.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},uC.prototype.onData=function(e){this.chunks.push(e)},uC.prototype.onEnd=function(e){e===ew&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=tC.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var eie={inflate:Zse};const{deflate:tie}=jse,{inflate:rie}=eie;var nie=tie,sie=rie,n8=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(n8||{});class iie{constructor(){H(this,"_sequence",0),H(this,"_startTime",Date.now()),H(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const f=new Uint8Array(4);f.set([1,0,0,0]);const g={id:0,length:4,data:f.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};r.commonPacketHeader.extension=1,r.extension=v,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;Z("SHOW_DATASTREAM2_LOG")&&k.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));const s=new ArrayBuffer(r.commonPacketHeader.length),c=new Uint8Array(s),d=new DataView(s);let h=0;if(d.setUint16(h,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),h+=2,d.setUint32(h,r.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,r.commonStreamHeader,!0),h+=2,r.extension){const f=this.serializeExtension(r.extension);c.set(new Uint8Array(f),h),h+=f.byteLength}if(c.set(new Uint8Array(r.payload),h),h+=r.payload.byteLength,h!==r.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const r=new DataView(t);let s=0;const c=r.getUint16(s,!0);s+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:r.getUint16(s+2,!0)<<16|r.getUint16(s,!0)};let h,f;if(s+=4,Z("SHOW_DATASTREAM2_LOG")&&k.debug("receive data header: ".concat(JSON.stringify(d))),r.getUint16(s,!0),s+=2,d.extension){f=this.deserializeExtension(t.slice(s)),s+=2+f.length,h=t.slice(s);let g=!1;if(f.datas.length>0){const v=f.datas.find((E=>E.id===0));v&&(g=(1&new DataView(v.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=t.slice(8);return h}serializeExtension(t){const{profile:r,length:s,datas:c}=t,d=new ArrayBuffer(s+2),h=new Uint8Array(d),f=new DataView(d);let g=0;if(f.setUint8(g++,r),f.setUint8(g++,s),c.forEach((v=>{r?(f.setUint8(g++,v.id),f.setUint8(g++,v.length),h.set(new Uint8Array(v.data),g),g+=v.data.byteLength):(f.setUint8(g++,v.id|v.length<<4),h.set(new Uint8Array(v.data),g),g+=v.data.byteLength)})),g!==s+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(s+2));return d}deserializeExtension(t){const r=new DataView(t);let s=0;const c=r.getUint8(s);s++;const d=r.getUint8(s);s++;const h=c===n8.TWO_BYTE,f=[],g=new DataView(t,2);let v=0;for(;v<d;){let E=0,C=0,R=new ArrayBuffer(0);h?(E=g.getUint8(v),v++,C=g.getUint8(v),v++):(E=15&g.getUint8(v),C=g.getUint8(v)>>4,v++),C>0&&(R=g.buffer.slice(v+2,v+2+C),v+=R.byteLength),f.push({id:E,length:C,data:R})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:f}}decompress(t){return sie(new Uint8Array(t))}compress(t){return nie(new Uint8Array(t))}}const aie={name:"DataStream",create:(e,t)=>{const r=t?new fre(e):new mre(e);return r.useDataStream(new iie),r}};class oie extends _n{constructor(t,r,s){super(),H(this,"ws",void 0),H(this,"requestId",1),H(this,"heartBeatTimer",void 0),H(this,"joinInfo",void 0),H(this,"clientId",void 0),H(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),H(this,"onClose",(c=>{this.emit("close"),this.dispose()})),H(this,"onMessage",(c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)})),this.joinInfo=t,this.clientId=r,this.ws=new CE("cross-channel-".concat(this.clientId),s),this.ws.on(Kt.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(Kt.CONNECTED,this.onOpen),this.ws.on(Kt.ON_MESSAGE,this.onMessage),this.ws.on(Kt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new nt(((r,s)=>{const c=window.setTimeout((()=>{s(new Ce(J.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(d=>{window.clearTimeout(c),d.state&&d.state!==0?s(new Ce(J.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)})),this.once("dispose",(()=>{window.clearTimeout(c),s(new Ce(J.WS_ABORT))}))}))}async request(t){if(this.ws.state==="closed")throw new Ce(J.WS_DISCONNECT);const r=()=>new nt(((h,f)=>{this.ws.once(Kt.CLOSED,(()=>f(new Ce(J.WS_ABORT)))),this.ws.once(Kt.CONNECTED,h)}));this.ws.state!=="connected"&&await r();const s=this.sendMessage(t),c=new nt(((h,f)=>{const g=()=>{f(new Ce(J.WS_ABORT))};this.ws.once(Kt.RECONNECTING,g),this.ws.once(Kt.CLOSED,g),this.once("req_".concat(s),h),Ns(3e3).then((()=>{this.removeAllListeners("req_".concat(s)),this.ws.off(Kt.RECONNECTING,g),this.ws.off(Kt.CLOSED,g),f(new Ce(J.TIMEOUT,"cross channel ws request timeout"))}))})),d=await c;if(!d||d.code!==200)throw new Ce(J.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(t){this.ws.removeAllListeners(Kt.REQUEST_NEW_URLS),this.ws.on(Kt.REQUEST_NEW_URLS,(r=>{r(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class cie extends _n{set state(t){t!==this._state&&(t!==ca.RELAY_STATE_FAILURE&&(this.errorCode=D_.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,s,c,d){super(),H(this,"joinInfo",void 0),H(this,"sid",void 0),H(this,"clientId",void 0),H(this,"cancelToken",qi.CancelToken.source()),H(this,"workerToken",void 0),H(this,"requestId",0),H(this,"signal",void 0),H(this,"prevChannelMediaConfig",void 0),H(this,"httpRetryConfig",void 0),H(this,"_resolution",void 0),H(this,"_state",ca.RELAY_STATE_IDLE),H(this,"errorCode",D_.RELAY_OK),H(this,"onStatus",(h=>{k.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",lu.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",lu.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=D_.SRC_TOKEN_EXPIRED,this.state=ca.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=D_.DEST_TOKEN_EXPIRED,this.state=ca.RELAY_STATE_FAILURE))})),H(this,"onReconnect",(async()=>{k.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",lu.NETWORK_DISCONNECTED),this.state=ca.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((h=>{this.state!==ca.RELAY_STATE_IDLE&&(k.error("auto restart channel media relay failed",h.toString()),this.errorCode=D_.SERVER_CONNECTION_LOST,this.state=ca.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=r,this.sid=If(),this.signal=new oie(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(t){if(this.state!==ca.RELAY_STATE_IDLE)throw new Ce(J.INVALID_OPERATION);this.state=ca.RELAY_STATE_CONNECTING,await this.connect(),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new Ce(J.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new Ce(J.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new Ce(J.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==ca.RELAY_STATE_RUNNING)throw new Ce(J.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==ca.RELAY_STATE_RUNNING)throw new Ce(J.INVALID_OPERATION);const r=this.genMessage(ji.SetVideoProfile);await this.signal.request(r),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),k.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ca.RELAY_STATE_IDLE,this.dispose()}dispose(){k.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=qi.CancelToken.source(),this.state=ca.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Ene(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",lu.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const r=this.genMessage(ji.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const s=this.genMessage(ji.SetSdkProfile,t);await this.signal.request(s),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ji.SetSourceChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",lu.PACKET_JOINED_SRC_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(ji.SetSourceUserId,t);await this.signal.request(d),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(ji.SetDestChannel,t);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",lu.PACKET_JOINED_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const f=this.genMessage(ji.StartPacketTransfer,t);await this.signal.request(f),this.emit("event",lu.PACKET_SENT_TO_DEST_CHANNEL),this.state=ca.RELAY_STATE_RUNNING,k.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const r=this.genMessage(ji.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",lu.PACKET_UPDATE_DEST_CHANNEL),k.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(ji.StopPacketTransfer);await this.signal.request(t),k.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){const s=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:xo,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let f=null,g=null;switch(t){case ji.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case ji.SetSourceChannel:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new Ce(J.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case ji.SetSourceUserId:if(g=r&&r.getSrcChannelMediaInfo(),!g)throw new Ce(J.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case ji.SetDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new Ce(J.UNEXPECTED_ERROR,"can not find dest config");return f.forEach((v=>{s.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)})),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:d},h;case ji.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case ji.Reconnect:return h.clientRequest={command:"Reconnect"},h;case ji.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case ji.UpdateDestChannel:if(f=r&&r.getDestChannelMediaInfo(),!f)throw new Ce(J.UNEXPECTED_ERROR,"can not find dest config");return f.forEach((v=>{s.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)})),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:d},h;case ji.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const lie={name:"ChannelMediaRelay",create:function(e){return new cie(e.joinInfo,e.clientId,e.websocketRetryConfig||Kn,e.httpRetryConfig||Kn,e.resolution)}};function s8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function tw(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?s8(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s8(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}class die extends _n{constructor(t,r,s,c){super(),H(this,"spec",void 0),H(this,"token",void 0),H(this,"websocket",void 0),H(this,"pingpongTimer",void 0),H(this,"reconnectMode","retry"),H(this,"serviceMode",void 0),H(this,"reqId",0),H(this,"commandReqId",0),H(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),H(this,"handleWebSocketMessage",(d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(ft.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===cu.TRANSCODE?1:2}),this.emit(Ah.PUBLISH_STREAM_STATUS,h))})),this.spec=r,this.token=t,this.serviceMode=c,this.websocket=new CE("live-streaming",s),this.websocket.on(Kt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Kt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Kt.REQUEST_NEW_URLS,((d,h)=>{Vs(this,Ah.REQUEST_NEW_ADDRESS).then(d).catch(h)})),this.websocket.on(Kt.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,r,s,c){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Ce(J.UNEXPECTED_ERROR);const f=tw({command:t,sdkVersion:xo==="4.24.0"?"0.0.1":xo,seq:h,requestId:h,allocate:s,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new Ce(J.WS_DISCONNECT);const g=()=>new nt(((R,A)=>{this.websocket.once(Kt.CLOSED,(()=>A(new Ce(J.WS_ABORT)))),this.websocket.once(Kt.CONNECTED,R)}));this.websocket.state!=="connected"&&await g(),f.clientRequest&&(f.clientRequest.workerToken=this.token);const v=new nt(((R,A)=>{const B=()=>{A(new Ce(J.WS_ABORT))};this.websocket.once(Kt.RECONNECTING,B),this.websocket.once(Kt.CLOSED,B),this.once("@".concat(h,"-").concat(this.spec.sid),(L=>{R(L)}))}));c&&ft.workerEvent(this.spec.sid,tw(tw({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));const E=Date.now();this.websocket.sendMessage(f);let C=null;try{C=await v}catch(R){if(this.websocket.state==="closed")throw R;return await g(),await this.request(t,r,s)}return c&&ft.workerEvent(this.spec.sid,tw(tw({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(C.serverResponse),serverCode:C.code,success:C.code===200,responseTime:Date.now()-E})),C.code!==200&&this.handleResponseError(C),C}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=xo==="4.24.0"?"0.0.1":xo;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Jn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void k.warning("live stream response already exists stream");case Jn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Jn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Jn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ce(J.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Jn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Jn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ce(J.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Jn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const r=new Ce(J.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ah.WARNING,r,t.serverResponse.url)}case Jn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const r=new Ce(J.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ah.WARNING,r,t.serverResponse.url)}case Jn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Jn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ce(J.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Jn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const r=new Ce(J.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ah.WARNING,r,t.serverResponse.url)}case Jn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Jn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Jn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Jn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Jn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Jn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ce(J.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Xx)}),6e3)}}function i8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function la(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?i8(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i8(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}class uie extends _n{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kn,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Kn;super(),H(this,"onLiveStreamWarning",void 0),H(this,"onLiveStreamError",void 0),H(this,"spec",void 0),H(this,"retryTimeout",1e4),H(this,"connection",void 0),H(this,"httpRetryConfig",void 0),H(this,"wsRetryConfig",void 0),H(this,"streamingTasks",new Map),H(this,"isStartingStreamingTask",!1),H(this,"taskMutex",new Xs("live-streaming")),H(this,"cancelToken",qi.CancelToken.source()),H(this,"transcodingConfig",void 0),H(this,"uapResponse",void 0),H(this,"lastTaskId",1),H(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=s,this.wsRetryConfig=r}async setTranscodingConfig(t){const r=la(la({},Qre),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(k.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map((h=>la(la(la({},Jre),h),{},{zOrder:h.zOrder?h.zOrder+1:1})))),(function(h){xn(h.width)||Gr(h.width,"config.width",0,1e4),xn(h.height)||Gr(h.height,"config.height",0,1e4),xn(h.videoBitrate)||Gr(h.videoBitrate,"config.videoBitrate",1,1e6),xn(h.videoFrameRate)||Gr(h.videoFrameRate,"config.videoFrameRate"),xn(h.lowLatency)||sl(h.lowLatency,"config.lowLatency"),xn(h.audioSampleRate)||ns(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),xn(h.audioBitrate)||Gr(h.audioBitrate,"config.audioBitrate",1,128),xn(h.audioChannels)||ns(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),xn(h.videoGop)||Gr(h.videoGop,"config.videoGop"),xn(h.videoCodecProfile)||ns(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),xn(h.userCount)||Gr(h.userCount,"config.userCount",0,17),xn(h.backgroundColor)||Gr(h.backgroundColor,"config.backgroundColor",0,16777215),xn(h.userConfigExtraInfo)||Rs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!xn(h.transcodingUsers)&&(ou(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach(((f,g)=>{ET(f.uid),xn(f.x)||Gr(f.x,"transcodingUser[".concat(g,"].x"),0,1e4),xn(f.y)||Gr(f.y,"transcodingUser[".concat(g,"].y"),0,1e4),xn(f.width)||Gr(f.width,"transcodingUser[".concat(g,"].width"),0,1e4),xn(f.height)||Gr(f.height,"transcodingUser[".concat(g,"].height"),0,1e4),xn(f.zOrder)||Gr(f.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),xn(f.alpha)||Gr(f.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)}))),xn(h.watermark)||HO(h.watermark,"watermark"),xn(h.backgroundImage)||HO(h.backgroundImage,"backgroundImage"),h.images&&!xn(h.images)&&(ou(h.images,"config.images"),h.images.forEach(((f,g)=>{HO(f,"images[".concat(g,"]"))})))})(r);const s=[];r.images&&s.push(...r.images.map((h=>la(la(la({},GO),h),{},{zOrder:255})))),r.backgroundImage&&(s.push(la(la(la({},GO),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(s.push(la(la(la({},GO),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=s,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map((h=>la({},h))),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);const c=(r.userConfigs||[]).map((h=>typeof h.uid=="number"?nt.resolve(h.uid):I5(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await nt.all(c)).forEach(((h,f)=>{r.userConfigs&&r.userConfigs[f]&&(r.userConfigs[f].uid=h)})),this.transcodingConfig=r,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(xa(d=this.streamingTasks).call(d)).map((f=>f.taskId)).join("#")});k.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((f=>{k.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,h).then((()=>{k.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))})).catch((g=>{k.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)}))}))}}async startLiveStreamingTask(t,r,s){if(!this.transcodingConfig&&r===cu.TRANSCODE)throw new Ce(J.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};k.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));const d=await this.taskMutex.lock();if(!this.connection&&s)return void d();if(this.streamingTasks.get(t)&&!s)return d(),new Ce(J.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(f){throw d(),f}switch(r){case cu.TRANSCODE:c.transcodingConfig=la({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const f=new nt(((v,E)=>{Ns(this.retryTimeout).then((()=>{if(s)return E(s);const C=this.statusError.get(t);return C?(this.statusError.delete(t),E(C)):void 0}))})),g=await nt.race([this.connection.request("request",{clientRequest:c},!0,{url:t,command:"PublishStream",workerType:r===cu.TRANSCODE?1:2,requestByUser:!s,tid:h.toString()}),f]);this.isStartingStreamingTask=!1,k.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(t,{clientRequest:c,mode:r,url:t,taskId:h}),d()}catch(f){if(d(),this.isStartingStreamingTask=!1,!f.data||!f.data.retry||s)throw f;return f.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,f)):await this.startLiveStreamingTask(t,r,f)}}stopLiveStreamingTask(t){return new nt(((r,s)=>{const c=this.streamingTasks.get(t);if(!c||!this.connection)return new Ce(J.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:t,command:"UnPublishStream",workerType:d===cu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((h=>{k.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()})).catch(s)}))}resetAllTask(){var t;const r=Array.from(xa(t=this.streamingTasks).call(t));this.terminate();for(const s of r)this.startLiveStreamingTask(s.url,s.mode).catch((c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=qi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Ce(J.UNEXPECTED_ERROR,"live streaming connection has already connected");const r=await Vs(this,KO.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new die(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ah.WARNING,((s,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,s))),this.connection.on(Ah.PUBLISH_STREAM_STATUS,(s=>this.handlePublishStreamServer(s))),this.connection.on(Ah.REQUEST_NEW_ADDRESS,((s,c)=>{if(!this.connection)return c(new Ce(J.UNEXPECTED_ERROR,"can not get new live streaming address list"));Vs(this,KO.REQUEST_WORKER_MANAGER_LIST,t).then((d=>{this.uapResponse=d,s(d.addressList)})).catch(c)})),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){const r=t.serverStatus&&t.serverStatus.url||"empty_url",s=this.streamingTasks.get(r),c=t.reason;switch(t.code){case Jn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Jn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Ce(J.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(s)return k.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,h);if(!this.isStartingStreamingTask)return;this.statusError.set(r,h)}case Jn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Ce(J.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,h)}case Jn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Jn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(xa(d=this.streamingTasks).call(d));for(const f of h)f.abortTask?f.abortTask():(k.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new Ce(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{k.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)})).catch((g=>{k.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,g)})));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const hie={name:"LiveStreaming",create:function(e){return new uie(e.joinInfo,e.websocketRetryConfig||Kn,e.httpRetryConfig||Kn)}};function pie(e){let t=c8();return(function(r,s){let c=r.appId;c!==void 0&&(Fr(s,10),vd(s,c));let d=r.cid;d!==void 0&&(Fr(s,16),Fr(s,d));let h=r.cname;h!==void 0&&(Fr(s,26),vd(s,h));let f=r.deviceId;f!==void 0&&(Fr(s,34),vd(s,f));let g=r.elapse;g!==void 0&&(Fr(s,40),Hh(s,g));let v=r.fileSize;v!==void 0&&(Fr(s,48),Hh(s,J_(v)));let E=r.height;E!==void 0&&(Fr(s,56),Hh(s,J_(E)));let C=r.jpg;C!==void 0&&(Fr(s,66),Fr(s,C.length),(function(ti,Me){let Xe=Q_(ti,Me.length);ti.bytes.set(Me,Xe)})(s,C));let R=r.networkType;R!==void 0&&(Fr(s,72),Hh(s,J_(R)));let A=r.osType;A!==void 0&&(Fr(s,80),Hh(s,J_(A)));let B=r.requestId;B!==void 0&&(Fr(s,90),vd(s,B));let L=r.sdkVersion;L!==void 0&&(Fr(s,98),vd(s,L));let U=r.sequence;U!==void 0&&(Fr(s,104),Hh(s,J_(U)));let X=r.sid;X!==void 0&&(Fr(s,114),vd(s,X));let Y=r.timestamp;Y!==void 0&&(Fr(s,120),Hh(s,Y));let ee=r.uid;ee!==void 0&&(Fr(s,128),Fr(s,ee));let ue=r.vid;ue!==void 0&&(Fr(s,136),Fr(s,ue));let de=r.width;de!==void 0&&(Fr(s,144),Hh(s,J_(de)));let ne=r.service;ne!==void 0&&(Fr(s,152),Fr(s,ne));let be=r.callbackData;be!==void 0&&(Fr(s,162),vd(s,be));let Ae=r.jpgEncryption;Ae!==void 0&&(Fr(s,168),Fr(s,Ae));let Ue=r.requestType;Ue!==void 0&&(Fr(s,176),Fr(s,Ue));let He=r.scorePorn;He!==void 0&&(Fr(s,185),J1(s,He));let Yt=r.scoreSexy;Yt!==void 0&&(Fr(s,193),J1(s,Yt));let Qt=r.scoreNeutral;Qt!==void 0&&(Fr(s,201),J1(s,Qt));let Lt=r.scene;Lt!==void 0&&(Fr(s,208),Fr(s,Lt));let Ir=r.ossFilePrefix;Ir!==void 0&&(Fr(s,218),vd(s,Ir));let xr=r.serviceVendor;if(xr!==void 0)for(let ti of xr){Fr(s,226);let Me=c8();gie(ti,Me),Fr(s,Me.limit),Eie(s,Me),vie(Me)}})(e,t),(function(r){let s=r.bytes,c=r.limit;return s.length===c?s:s.subarray(0,c)})(t)}function fie(e){return(function(r){let s={};e:for(;!l8(r);){let c=Ed(r);switch(c>>>3){case 0:break e;case 1:s.code=Ed(r);break;case 2:s.msg=d8(r,Ed(r));break;case 3:{let d=_ie(r);s.data=mie(r),r.limit=d;break}default:a8(r,7&c)}}return s})({bytes:t=e,offset:0,limit:t.length});var t}function mie(e){let t={};e:for(;!l8(e);){let r=Ed(e);switch(r>>>3){case 0:break e;case 1:t.requestId=d8(e,Ed(e));break;case 2:t.requestType=Ed(e)>>>0;break;case 3:t.scorePorn=X1(e);break;case 4:t.scoreSexy=X1(e);break;case 5:t.scoreNeutral=X1(e);break;case 6:t.requestScene=Ed(e)>>>0;break;case 7:t.scene=Ed(e)>>>0;break;default:a8(e,7&r)}}return t}function gie(e,t){let r=e.service;r!==void 0&&(Fr(t,8),Fr(t,r));let s=e.vendor;s!==void 0&&(Fr(t,16),Fr(t,s));let c=e.token;c!==void 0&&(Fr(t,26),vd(t,c));let d=e.callbackUrl;d!==void 0&&(Fr(t,34),vd(t,d))}function _ie(e){let t=Ed(e),r=e.limit;return e.limit=e.offset+t,r}function a8(e,t){switch(t){case 0:for(;128&u8(e););break;case 2:$1(e,Ed(e));break;case 5:$1(e,4);break;case 1:$1(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let yie=new Float32Array(1);new Uint8Array(yie.buffer);let z1=new Float64Array(1),da=new Uint8Array(z1.buffer);function J_(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let o8=[];function c8(){const e=o8.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function vie(e){o8.push(e)}function $1(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function l8(e){return e.offset>=e.limit}function Q_(e,t){let r=e.bytes,s=e.offset,c=e.limit,d=s+t;if(d>r.length){let h=new Uint8Array(2*d);h.set(r),e.bytes=h}return e.offset=d,d>c&&(e.limit=d),s}function Y1(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function d8(e,t){let r=Y1(e,t),s=String.fromCharCode,c=e.bytes,d="",h="";for(let f=0;f<t;f++){let g,v,E,C,R=c[f+r];(128&R)==0?h+=s(R):(224&R)==192?f+1>=t?h+=d:(g=c[f+r+1],(192&g)!=128?h+=d:(C=(31&R)<<6|63&g,C<128?h+=d:(h+=s(C),f++))):(240&R)==224?f+2>=t?h+=d:(g=c[f+r+1],v=c[f+r+2],(49344&(g|v<<8))!=32896?h+=d:(C=(15&R)<<12|(63&g)<<6|63&v,C<2048||C>=55296&&C<=57343?h+=d:(h+=s(C),f+=2))):(248&R)==240?f+3>=t?h+=d:(g=c[f+r+1],v=c[f+r+2],E=c[f+r+3],(12632256&(g|v<<8|E<<16))!=8421504?h+=d:(C=(7&R)<<18|(63&g)<<12|(63&v)<<6|63&E,C<65536||C>1114111?h+=d:(C-=65536,h+=s(55296+(C>>10),56320+(1023&C)),f+=3))):h+=d}return h}function vd(e,t){let r=t.length,s=0;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),s+=f<128?1:f<2048?2:f<65536?3:4}Fr(e,s);let c=Q_(e,s),d=e.bytes;for(let h=0;h<r;h++){let f=t.charCodeAt(h);f>=55296&&f<=56319&&h+1<r&&(f=(f<<10)+t.charCodeAt(++h)-56613888),f<128?d[c++]=f:(f<2048?d[c++]=f>>6&31|192:(f<65536?d[c++]=f>>12&15|224:(d[c++]=f>>18&7|240,d[c++]=f>>12&63|128),d[c++]=f>>6&63|128),d[c++]=63&f|128)}}function Eie(e,t){let r=Q_(e,t.limit),s=e.bytes,c=t.bytes;for(let d=0,h=t.limit;d<h;d++)s[d+r]=c[d]}function u8(e){return e.bytes[Y1(e,1)]}function h8(e,t){let r=Q_(e,1);e.bytes[r]=t}function X1(e){let t=Y1(e,8),r=e.bytes;return da[0]=r[t++],da[1]=r[t++],da[2]=r[t++],da[3]=r[t++],da[4]=r[t++],da[5]=r[t++],da[6]=r[t++],da[7]=r[t++],z1[0]}function J1(e,t){let r=Q_(e,8),s=e.bytes;z1[0]=t,s[r++]=da[0],s[r++]=da[1],s[r++]=da[2],s[r++]=da[3],s[r++]=da[4],s[r++]=da[5],s[r++]=da[6],s[r++]=da[7]}function Ed(e){let t,r=0,s=0;do t=u8(e),r<32&&(s|=(127&t)<<r),r+=7;while(128&t);return s}function Fr(e,t){for(t>>>=0;t>=128;)h8(e,127&t|128),t>>>=7;h8(e,t)}function Hh(e,t){let r=t.low>>>0,s=(t.low>>>28|t.high<<4)>>>0,c=t.high>>>24,d=c===0?s===0?r<16384?r<128?1:2:r<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=Q_(e,d),f=e.bytes;switch(d){case 10:f[h+9]=c>>>7&1;case 9:f[h+8]=d!==9?128|c:127&c;case 8:f[h+7]=d!==8?s>>>21|128:s>>>21&127;case 7:f[h+6]=d!==7?s>>>14|128:s>>>14&127;case 6:f[h+5]=d!==6?s>>>7|128:s>>>7&127;case 5:f[h+4]=d!==5?128|s:127&s;case 4:f[h+3]=d!==4?r>>>21|128:r>>>21&127;case 3:f[h+2]=d!==3?r>>>14|128:r>>>14&127;case 2:f[h+1]=d!==2?r>>>7|128:r>>>7&127;case 1:f[h]=d!==1?128|r:127&r}}function p8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}const wie=new Map([["moderation",1],["supervise",2]]);class bie extends _n{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const r=this._connectionState;this._connectionState=t,this.emit(fs.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=ea(r=t.map((s=>wie.get(s)||0))).call(r,((s,c)=>s+c)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),H(this,"name","AgoraRTCVideoContentInspect"),H(this,"_connectionState",lc.CONNECTING),H(this,"_innerConnectionState",void 0),H(this,"sequence",0),H(this,"inspectStartTime",void 0),H(this,"workerManagerConnection",void 0),H(this,"workerConnection",void 0),H(this,"workerMessageLengthLimit",void 0),H(this,"inspectIntervalMinimum",void 0),H(this,"qualityRatio",void 0),H(this,"_connectInfo",void 0),H(this,"_cancelTokenSource",qi.CancelToken.source()),H(this,"_retryConfig",void 0),H(this,"wmSequence",0),H(this,"inspectInterval",void 0),H(this,"inspectTimer",null),H(this,"ossFilePrefix",void 0),H(this,"extraInfo",void 0),H(this,"_inspectType",void 0),H(this,"_inspectMode",void 0),H(this,"_quality",1),H(this,"qualityTimer",null),H(this,"_inspectId",void 0),H(this,"_needWorkUrlOnly",!1),H(this,"inspectImage",(()=>{if(this.connectionState!==lc.CONNECTED)throw new Ce(J.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===lc.CONNECTED?this.requestToInspectImage():k.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=zr(5,"inspect-"),this.workerMessageLengthLimit=Z("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Z("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Z("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new CE("worker-manager-"+this._inspectId,Kn),this.on(fs.STATE_CHANGE,((r,s)=>{this._innerConnectionState=r,k.debug("[".concat(this._inspectId,"] Inspect operation :").concat(dc[r]," ").concat(s||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new CE("worker-"+this._inspectId,Kn),this.handleWorkerEvents()}async init(t,r){this.emit(fs.STATE_CHANGE,dc.CONNECT_AP),this._connectInfo=t;const s=this._cancelTokenSource.token;return this._retryConfig=r,new nt(((c,d)=>{this.on(fs.CONNECTION_STATE_CHANGE,((h,f)=>{f===lc.CONNECTED&&c()})),this.requestAP(t,s,r).then((h=>{this.connectWorkerManager(h)})).catch((h=>{d(h)}))}))}async requestAP(t,r,s){const c=Z("WEBCS_DOMAIN").map((f=>"https://".concat(f,"/api/v1"))),d=await(function(f,g,v,E){let{appId:C,areaCode:R,cname:A,sid:B,token:L,uid:U}=g;B_++;const X="image_moderation_api",Y={service_name:X,json_body:JSON.stringify({appId:C,areaCode:R,cname:A,command:"allocateEdge",requestId:B_,seq:B_,sid:B,token:L,ts:Date.now(),uid:U+""})};let ee,ue,de=f[0];return il((async()=>{ee=Date.now();const ne=await dl(de,{data:Y,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ue=Date.now()-ee,ne.code!==0){const He=new Ce(J.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ne.code,{retry:!0,responseTime:ue});throw k.error(He.toString()),He}const be=JSON.parse(ne.json_body);if(be.code!==200){const He=new Ce(J.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(be.code,", reason: ").concat(be.reason),{code:be.code,responseTime:ue});throw k.error(He.toString()),He}if(!be.servers||!Array.isArray(be.servers)||be.servers.length===0){const He=new Ce(J.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:be.code,responseTime:ue});throw k.error(He.toString()),He}const Ae=Z("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ue=Z("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:be.servers.map((He=>{let{address:Yt,wss:Qt}=He;if(Yt&&Qt)return"wss://".concat(Yt.replace(/\./g,"-"),".").concat(Ae,":").concat(Ue||Qt)})).filter((He=>!!He)),workerToken:be.workerToken,vid:be.vid,responseTime:ue}}),((ne,be)=>(ft.apworkerEvent(B,{success:!0,sc:200,serviceName:X,responseDetail:JSON.stringify(ne.addressList),firstSuccess:be===0,responseTime:ue,serverIp:f[be%f.length]}),!1)),((ne,be)=>(ft.apworkerEvent(B,{success:!1,sc:ne.data&&ne.data.code||200,serviceName:X,responseTime:ue,serverIp:f[be%f.length]}),!!(ne.code!==J.OPERATION_ABORTED&&ne.code!==J.UNEXPECTED_RESPONSE||ne.data&&ne.data.retry)&&(de=f[(be+1)%f.length],!0))),E)})(c,t,r,s);this.emit(fs.STATE_CHANGE,dc.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(fs.STATE_CHANGE,dc.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Kt.CONNECTED,(async()=>{this.emit(fs.STATE_CHANGE,dc.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Kt.CLOSED,(()=>{this._innerConnectionState<dc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(Kt.FAILED,(()=>{this._innerConnectionState<dc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(Kt.RECONNECTING,(()=>{this._innerConnectionState<dc.GET_WORKER_MANAGER_RESPONSE&&k.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(Kt.ON_MESSAGE,(async t=>{this.emit(fs.STATE_CHANGE,dc.GET_WORKER_MANAGER_RESPONSE);const r=this.workerManagerConnection.url;this.workerManagerConnection.close();const s=JSON.parse(t.data);if(s.code!==200)throw k.error("[".concat(this._inspectId,"] Unexpected code ").concat(s.code," from worker manager")),new Ce(J.UNEXPECTED_RESPONSE,"response code of worker is unexpected",s);if(!(s.serverResponse&&s.serverResponse.portWss&&r))throw k.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(s))),new Ce(J.UNEXPECTED_RESPONSE,"response content of worker is unexpected",s);{const c=Z("VIDEO_INSPECT_WORKER_PORT")||s.serverResponse.portWss,d=r.replace(/:\d+\/?$/,":".concat(c));this.emit(fs.STATE_CHANGE,dc.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(fs.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}})),this.workerManagerConnection.on(Kt.WILL_RECONNECT,((t,r,s)=>{s(t)})),this.workerManagerConnection.on(Kt.REQUEST_NEW_URLS,((t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)}))}handleWorkerEvents(){this.workerConnection.on(Kt.CONNECTED,(async()=>{this.emit(fs.STATE_CHANGE,dc.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=lc.CONNECTED})),this.workerConnection.on(Kt.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const s=fie(new Uint8Array(t.data));if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&k.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(s)),s.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(fs.INSPECT_RESULT,void 0,void 0);if(s.data&&s.data.scorePorn&&s.data.scoreSexy&&s.data.scoreNeutral){var r;const c={porn:s.data.scorePorn,sexy:s.data.scoreSexy,neutral:s.data.scoreNeutral},d=ea(r=Object.keys(c)).call(r,((f,g)=>c[f]>c[g]?f:g),"porn"),h=Object.keys(c).find((f=>f===d));this.emit(fs.INSPECT_RESULT,h)}else this.emit(fs.INSPECT_RESULT,void 0,new Ce(J.UNEXPECTED_RESPONSE,s.code+"","There is an unexpected data on message"))}else this.emit(fs.INSPECT_RESULT,void 0,new Ce(J.UNEXPECTED_RESPONSE,s.code+"",s.msg))}else k.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(fs.INSPECT_RESULT,void 0,new Ce(J.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Kt.CLOSED,(()=>{this.connectionState=lc.CLOSED})),this.workerConnection.on(Kt.FAILED,(()=>{this.connectionState=lc.CLOSED})),this.workerConnection.on(Kt.RECONNECTING,(()=>{this.connectionState=this.connectionState===lc.CONNECTED?lc.RECONNECTING:lc.CONNECTING})),this.workerConnection.on(Kt.WILL_RECONNECT,((t,r,s)=>{t==="recover"&&s(t),s("tryNext")})),this.workerConnection.on(Kt.REQUEST_NEW_URLS,((t,r)=>{this.workerManagerConnection.close(),this.once(fs.REQUEST_NEW_WORKER_URL,(s=>{t([s])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((s=>{this.connectWorkerManager(s,!0)})).catch((s=>{r(s)}))}))}async requestToInspectImage(){this.sequence++;const t=Ga(this,fs.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(fs.INSPECT_RESULT,void 0,new Ce(J.INVALID_OPERATION,"Only the track being played can be inspected"));const s=await this.generateRequestData(t,r);this.workerConnection.sendMessage(s,!0,!0)}else this.emit(fs.INSPECT_RESULT,void 0,new Ce(J.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:s,cname:c,cid:d,vid:h,sid:f,uid:g}=r;const v=Date.now(),E=await t.getCurrentFrameImage("image/jpeg",this.quality),C=await z3(E,s,c),R=this.sequence+"-"+d+"-"+g+"-"+v+"-"+zr(12,""),A={appId:s,cid:d,cname:c,deviceId:"",elapse:(B=Number(v-this.inspectStartTime),{low:B|=0,high:B>>31,unsigned:B>=0}),fileSize:C.byteLength,jpgEncryption:2,height:E.height,width:E.width,jpg:C,networkType:6,osType:7,requestId:R,sdkVersion:"4.24.0",sequence:this.sequence,sid:f,timestamp:wB(v),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var B;this.extraInfo===void 0&&delete A.callbackData,this.ossFilePrefix===void 0&&delete A.ossFilePrefix;const L=pie(A);if(L.byteLength<this.workerMessageLengthLimit){if(Z("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const U=(function(X){for(var Y=1;Y<arguments.length;Y++){var ee=arguments[Y]!=null?arguments[Y]:{};Y%2?p8(Object(ee),!0).forEach((function(ue){H(X,ue,ee[ue])})):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(ee)):p8(Object(ee)).forEach((function(ue){Object.defineProperty(X,ue,Object.getOwnPropertyDescriptor(ee,ue))}))}return X})({},A);delete U.jpg,k.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(U))}return L}{const U=this.quality*this.qualityRatio;return this.quality=U,await this.generateRequestData(t,{appId:s,cname:c,cid:d,vid:h,sid:f,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=qi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=lc.CLOSED,this.emit(fs.STATE_CHANGE,dc.CLOSED)}}const Sie={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(r){if(!r)throw new Ce(J.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new Ce(J.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const s=[...new Set(r.inspectType)];s.forEach((c=>{var d;if(!$e(d=["supervise","moderation"]).call(d,c))throw new Ce(J.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))})),r.inspectType=s}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new Ce(J.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new bie(t)}};var f8=u(xt.Object.getOwnPropertySymbols),xie=kr,Tie=Qm.indexOf,Cie=Dp,Q1=oe([].indexOf),m8=!!Q1&&1/Q1([1],1,-0)<0;xie({target:"Array",proto:!0,forced:m8||!Cie("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return m8?Q1(this,e,t)||0:Tie(this,e,t)}});var Rie=ya("Array","indexOf"),Nie=O,Aie=Rie,Z1=Array.prototype,Iie=function(e){var t=e.indexOf;return e===Z1||Nie(Z1,e)&&t===Z1.indexOf?Aie:t},g8=u(Iie);function Oie(e,t){if(e==null)return{};var r,s,c=(function(h,f){if(h==null)return{};var g={};for(var v in h)if({}.hasOwnProperty.call(h,v)){if(g8(f).call(f,v)!==-1)continue;g[v]=h[v]}return g})(e,t);if(f8){var d=f8(e);for(s=0;s<d.length;s++)r=d[s],g8(t).call(t,r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(c[r]=e[r])}return c}let _8=class{get localCapabilities(){return hn(this._localCapabilities)}get rtpCapabilities(){return hn(this._rtpCapabilities)}get candidates(){return hn(this._candidates)}get iceParameters(){return hn(this._iceParameters)}get dtlsParameters(){return hn(this._dtlsParameters)}constructor(e){H(this,"sessionDesc",void 0),H(this,"_localCapabilities",void 0),H(this,"_rtpCapabilities",void 0),H(this,"_candidates",void 0),H(this,"_iceParameters",void 0),H(this,"_dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname","o/i14u9pJrxRKAsu"),H(this,"firefoxSsrcMidMap",new Map),e=hn(e);const{remoteIceParameters:t,remoteDtlsParameters:r,candidates:s,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:f,videoCodec:g,audioCodec:v}=e;let E;this.setup=f,E=h===Di.RECEIVE_ONLY?aa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):aa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=s,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=d;const C=h===Di.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,R=h===Di.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,A=h===Di.RECEIVE_ONLY?c.send.videoCodecs:IE(ot.VIDEO,C,R,g),B=h===Di.RECEIVE_ONLY?c.send.audioCodecs:IE(ot.AUDIO,C,R,v);for(const L of E.mediaDescriptions)L.attributes.iceUfrag=t.iceUfrag,L.attributes.icePwd=t.icePwd,L.attributes.fingerprints=r.fingerprints,L.attributes.candidates=s,L.attributes.setup=this.setup,L.media.mediaType==="application"&&(L.attributes.sctpPort="5000"),L.media.mediaType==="video"&&(L.media.fmts=A.map((U=>U.payloadType.toString(10))),L.attributes.payloads=A,L.attributes.extmaps=C.videoExtensions),L.media.mediaType==="audio"&&(L.media.fmts=B.map((U=>U.payloadType.toString(10))),L.attributes.payloads=B,L.attributes.extmaps=C.audioExtensions,V_(L));this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Rh(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((t=>this.hasMid(t))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,r,s,c){r=r.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=AE(t,this.cname,Z("SYNC_GROUP")?r:void 0),f=this.findPreloadMediaDesc(d);if(f){if(Sn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,f.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(f,c),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(e,d,s);let v;return g===-1?(v=this.createOrRecycleSendMedia(e,d,h,"sendonly",s,c),this.updateBundleMids()):(v=hn(this.sessionDesc.mediaDescriptions[g]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(v,c)),Sn()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((r=>{r.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,r){const s=[];return e.forEach((c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let f,g=!1;h===-1?(g=!0,f=this.createOrRecycleRecvMedia(c,[],"recvonly",t,r),this.updateBundleMids()):(f=hn(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="recvonly"),s.push({mid:f.attributes.mid,needCreateTransceiver:g})})),s}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>e.indexOf(r.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((r=>{r.media.port="0",r.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:r,address:s,port:c,type:d,relatedAddress:h,relatedPort:f,priority:g}=new RTCIceCandidate(e),v={foundation:t??"",componentId:"1",transport:r??"",priority:g?g+"":"",connectionAddress:s??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:f?f+"":"",extension:{}};this.candidates.some((E=>E.priority===v.priority&&E.connectionAddress===v.connectionAddress&&E.port===v.port))||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach((E=>{E.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,s,c){const d=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=IE(d,h,this.localCapabilities.send,d===ot.AUDIO?c:s),g=d===ot.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let E={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map((R=>R.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};E=this.mungRecvMediaDsec(E,e);const C=this.findFirstClosedMedia(d);if(C){const R=this.sessionDesc.mediaDescriptions.indexOf(C);this.sessionDesc.mediaDescriptions[R]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>$e(e).call(e,r.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((r=>{r.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((r=>$e(e).call(e,r.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((r=>{r.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex((s=>{const c=s.media.mediaType===e&&s.media.port!=="0"&&(s.attributes.direction==="sendonly"||s.attributes.direction==="sendrecv")&&s.attributes.ssrcs.length===0;if(Sn()){if(c){const d=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(d||s.attributes.mid!=="0"&&s.attributes.mid!=="1")||!(!d||d!==s.attributes.mid)}return!1}return c&&s.attributes.mid===r}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r}))}predictReceivingMids(e){const t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=hn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,r,s,c,d){const h=this.rtpCapabilities.send,f=e===ot.VIDEO?h.videoCodecs:h.audioCodecs,g=e===ot.VIDEO?h.videoExtensions:h.audioExtensions;Sn()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map((C=>C.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const E=this.findFirstClosedMedia(e);if(E){const C=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[C]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(e,t,r){const s=hn(e);return QO(s),F_(s,t),ZO(s,t),d5(s),NT(s,r,this.localCapabilities.send),s}mungSendMediaDesc(e,t){const r=hn(e);return NT(r,t,this.localCapabilities.recv),V_(r),r}updateRecvMedia(e,t){const r=this.sessionDesc.mediaDescriptions.findIndex((s=>s.attributes.mid===e));if(r!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=s}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>e.media.port!=="0")).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>Sn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0"))}};const kie=["sdp"];var rn;function y8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function Kh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y8(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y8(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}let v8=(rn=class ly extends KV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,s){super(t,r),H(this,"direction",void 0),H(this,"name",void 0),H(this,"store",void 0),H(this,"spec",void 0),H(this,"peerConnection",void 0),H(this,"initialOffer",void 0),H(this,"transport",void 0),H(this,"statsFilter",void 0),H(this,"localCandidateCount",0),H(this,"_isInRestartIce",!1),H(this,"mutex",void 0),H(this,"onLocalCandidate",void 0),H(this,"remoteSDP",void 0),H(this,"pendingCandidates",[]),H(this,"localCapabilities",void 0),H(this,"isReady",!1),H(this,"restartCnt",0),H(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new Xs("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(ly.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=s??Di.SEND_ONLY,this.name=this.direction===Di.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=oO(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const r=await h5();if(this.localCapabilities=AT(r),t){const{sdp:s}=t,c=Oie(t,kie),d=(function(){const E={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},C=NE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(uc(C,E,"videoExtensions",R,A,B),uc(C,E,"videoCodecs",R,A,B),uc(C,E,"audioExtensions",R,A,B),uc(C,E,"audioCodecs",R,A,B),Z("RAISE_H264_BASELINE_PRIORITY")){const L=B.videoCodecs.findIndex((U=>U.rtpMap&&U.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&U.fmtp&&U.fmtp.parameters["profile-level-id"]==="42001f"));if(L!==-1){const U=B.videoCodecs.findIndex((X=>X.rtpMap&&X.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(U<L){k.debug("raising H264 baseline profile priority");const X=B.videoCodecs[L];B.videoCodecs.splice(L,1),B.videoCodecs.splice(U,0,X)}U!==-1&&Z("FILTER_SEND_H264_BASELINE")&&(R.videoCodecs=R.videoCodecs.filter((X=>!(X.rtpMap&&X.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&X.fmtp&&X.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:R,recv:A,sendrecv:B}})({},{},s);this.remoteSDP=new _8({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const f=Ph(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await p5({},{},h.sdp);this.localCapabilities=AT(g);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),Kh(Kh({},f),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ph(s.sdp);return this.initialOffer=s,Kh(Kh({},c),{},{sdp:s.sdp})}}catch(r){throw new Ne(J.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:r,iceParameters:s,dtlsParameters:c}=t,d=await p5({},{},r);this.remoteSDP=new _8({remoteIceParameters:s,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((r=>{this.peerConnection.addIceCandidate(r)})),this.pendingCandidates=[])}catch(r){throw new Ne(J.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,s){var c=this;return So((function*(){const d=yield yr(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],f=c.remoteSDP.receive(t,r,s);t.forEach(((U,X)=>{if(f[X].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(U._mediaStreamTrack,{direction:"sendonly"});h.push(Y),U._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find((ee=>ee.mid===f[X].mid));if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[X].mid));h.push(Y),U._updateRtpTransceiver(Y)}})),Sn()&&Z("SIMULCAST")===!0&&(yield yr(c.applySimulcastForFirefox(h,t)));const g=f.map((U=>U.mid)),v=yield yr(c.peerConnection.createOffer()),E=c.mungSendOfferSDP(v.sdp,t,g),C=aa(E),R=g.map((U=>{const X=C.mediaDescriptions.find((Y=>Y.attributes.mid===U));if(!X)throw new Error("Cannot extract ssrc from mediaDescription.");return o5(X,Z("USE_PUB_RTX"))})),A=h.map(((U,X)=>{const Y=g[X];return{localSSRC:R[X],id:Y}}));yield yr(c.peerConnection.setLocalDescription({type:"offer",sdp:E}));try{yield A}catch(U){const X=c.remoteSDP.toString();throw yield yr(c.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield yr(c.peerConnection.setRemoteDescription({type:"answer",sdp:X})),yield yr(c.stopSending(g,!0)),U}yield yr(c.applySimulcastEncodings(h,t)),yield yr(c.applySendEncodings(h,t));const B=c.remoteSDP.toString(),L=c.logSDPExchange(E,"offer","local","send");return L==null||L(B),yield yr(c.setRemoteDescription({type:"answer",sdp:B})),h.map(((U,X)=>{const Y=g[X];return{localSSRC:R[X],id:Y}}))}catch(h){throw h instanceof Ne?h:new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}}))()}async stopSending(t,r){const s=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter((g=>t.indexOf(g.mid)!==-1));if(c.length!==t.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));c.map((g=>{var v;g.direction="inactive",(v=g.stop)===null||v===void 0||v.call(g)}));const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(t);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(c){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{s&&s()}}async receive(t,r,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,s,c);if(h){const g=this.remoteSDP.toString(),v=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer(),C=this.mungReceiveAnswerSDP(E.sdp,d,t);v==null||v(C||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:C}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const f=this.peerConnection.getTransceivers().find((g=>g.mid===d));if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(d){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(t,r,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(t,r,s,c);if(h){const f=this.remoteSDP.toString(),g=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});const v=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(v.sdp,d,t);g==null||g(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else k.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(d){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString(),s=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});const c=await this.peerConnection.createAnswer();s==null||s(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Of.Auto&&(this.store.p2pTransport=Of.SdRtn,vr().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ly.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,vr().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ly.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:s}=Ph(r.sdp);return this.store.descriptionStart(),this.direction===Di.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),s}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Di.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:s}=Ph(r.sdp);return await this.peerConnection.setLocalDescription(r),s}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Ne(J.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,r){const s=this.peerConnection.getTransceivers().filter((c=>c.mid===t));s.length===1&&(this.isVP8Simulcast(r)?Sn()||await this.applySimulcastEncodings(s,[r]):await this.applySendEncodings(s,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const s=this.peerConnection.getTransceivers().find((c=>c.mid===r));s&&await s.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const r=t[0].transport.iceTransport,{local:s,remote:c}=r.getSelectedCandidatePair();return{local:Kh(Kh({},cd),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port}),remote:Kh(Kh({},cd),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;$e(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return t.iceServers?c.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(pE(t.turnServer.servers)?c.iceServers=t.turnServer.servers:(c.iceServers&&c.iceServers.push(...ly.turnServerConfigToIceServers(t.turnServer.servers,r,s)),Z("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&t.turnServer.serversFromGateway&&c.iceServers.push(...ly.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,s)),$e(d=[Of.Relay,Of.SdRtn]).call(d,r)&&(c.iceTransportPolicy="relay"),Z("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((h=>{h.forceturn&&(c.iceTransportPolicy="relay")})))),Z("ENABLE_ENCODED_TRANSFORM")&&vr().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),k.debug("P2PConnection p2pTransport is ".concat(r)),c}static turnServerConfigToIceServers(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=t.filter((f=>f.tcpport));k.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(s));const h=d.length>s?d[s]:d[0];switch(r){case Of.SdRtn:const f=t.filter((v=>{var E;return $e(E=v.username).call(E,"glb:")&&v.turnServerURL==v.turnServerURL})),g=f.length>s?f[s]:f[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Oh(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Oh(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case Of.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Oh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Oh(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var s;t!=null&&t.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,t.state))},t.onerror=s=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in s?s.error:s)};const r=t.iceTransport;r&&(r.onstatechange=()=>{const s=t==null?void 0:t.iceTransport.state;var c;s&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,s))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:s,remote:c}=r.getSelectedCandidatePair()||{};if(s&&c){const d=s.address+":"+s.port,h=c.address+":"+c.port;k.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(Ff(d)),", remote ").concat(JSON.stringify(Ff(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var s;if(r||(r=this.peerConnection.getSenders().find((E=>E.track===t._mediaStreamTrack))),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return k.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!vr().supportSetRtpSenderParameters)return k.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(t._encoderConfig){var h;const{bitrateMax:E,frameRate:C,scaleResolutionDownBy:R}=t._encoderConfig;E&&(d.maxBitrate=1e3*E),$e(h=t._hints).call(h,Hr.LOW_STREAM)&&(C&&(d.maxFramerate=Na(C)),R&&R>=1&&(d.scaleResolutionDownBy=R))}if(Z("DSCP_TYPE")&&au()){var f;const E=Z("DSCP_TYPE");$e(f=["very-low","low","medium","high"]).call(f,E)&&(d.networkPriority=E)}const g=r.getParameters(),v=(s=g.encodings)===null||s===void 0?void 0:s[0];Sn()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(g,c),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await r.setParameters(g)}async applySendEncodings(t,r){try{if(!vr().supportSetRtpSenderParameters||t.length!==r.length)return;for(let s=0;s<t.length;s++){const c=t[s],d=r[s];d instanceof tn&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,s){const c=aa(t);return r.forEach(((d,h)=>{const f=s[h],g=c.mediaDescriptions.find((v=>v.attributes.mid===f));g&&(F_(g,d),u5(g,d,this.store.codec))})),Rh(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let g=0;g<t.length;g++){var s,c,d,h,f;const v=t[g],E=r[g];if(E instanceof tn&&!$e(s=E._hints).call(s,Hr.LOW_STREAM)&&(c=E._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=E._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=E._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((f=E._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){const C={},R={high:1e3*(E._encoderConfig.bitrateMax-50),medium:5e4};C.encodings=[{rid:"m",active:!0,maxBitrate:R.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:R.high}];const A=v.sender.getParameters();await v.sender.setParameters(Object.assign(A,C))}}}async applySimulcastEncodings(t,r){if(!Sn()&&t.length===r.length)for(let s=0;s<t.length;s++){const c=r[s];if(c instanceof tn&&this.isVP8Simulcast(c)){const d=t[s],h={},f={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(t){var r,s,c,d,h;return!!(t instanceof tn&&Z("SIMULCAST")&&this.store.codec==="vp8"&&!$e(r=t._hints).call(r,Hr.LOW_STREAM)&&(s=t._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((c=t._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=t._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=t._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(t,r,s,c){if(Z("SDP_LOGGING"))return k.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(r," SDP during P2PConnection.").concat(c,`
`),t),r==="offer"?d=>{this.logSDPExchange(d,"answer",s==="local"?"remote":"local",c)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((h=>{h.direction="inactive"}));const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.muteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getTransceivers().filter((h=>h.mid&&t.indexOf(h.mid)!==-1));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map((async h=>{h.direction="sendonly"}));const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(s),this.remoteSDP.unmuteRemote(t);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var s;if(r=r??((s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp)){var c;const d=(c=aa(r).mediaDescriptions.find((h=>h.attributes.mid===t)))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),$e(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,s){const c=aa(t),d=c.mediaDescriptions.find((h=>h.attributes.mid===r));return d&&s===ot.AUDIO&&d.media.mediaType==="audio"&&V_(d),Rh(c)}},ht(rn.prototype,"establish",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"establish"),rn.prototype),ht(rn.prototype,"connect",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"connect"),rn.prototype),ht(rn.prototype,"receive",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"receive"),rn.prototype),ht(rn.prototype,"mockReceive",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"mockReceive"),rn.prototype),ht(rn.prototype,"stopReceiving",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"stopReceiving"),rn.prototype),ht(rn.prototype,"restartICE",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"restartICE"),rn.prototype),ht(rn.prototype,"close",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),ht(rn.prototype,"updateEncoderConfig",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"updateEncoderConfig"),rn.prototype),ht(rn.prototype,"updateSendParameters",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"updateSendParameters"),rn.prototype),ht(rn.prototype,"replaceTrack",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"replaceTrack"),rn.prototype),ht(rn.prototype,"muteLocal",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"muteLocal"),rn.prototype),ht(rn.prototype,"unmuteLocal",[gc],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteLocal"),rn.prototype),rn);function gc(e,t,r){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},r}let pl=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var E8,w8,b8,S8,x8,T8,C8,R8,N8,A8,I8,pn;function O8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function hC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O8(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O8(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}let Pie=(E8=fl(pl.SEND_ONLY),w8=fl(pl.SEND_ONLY),b8=fl(),S8=fl(pl.RECEIVE_ONLY),x8=fl(pl.RECEIVE_ONLY),T8=fl(pl.RECEIVE_ONLY),C8=fl(pl.RECEIVE_ONLY),R8=fl(pl.RECEIVE_ONLY),N8=fl(pl.RECEIVE_ONLY),A8=fl(),I8=fl(pl.RECEIVE_ONLY),pn=class extends _n{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Tt.StateChange,t,this._state)}constructor(e,t){super(),H(this,"isPlanB",!1),H(this,"store",void 0),H(this,"statsUploader",void 0),H(this,"sendConnection",void 0),H(this,"recvConnection",void 0),H(this,"localTrackMap",new Map),H(this,"remoteUserMap",new Map),H(this,"localDataChannels",[]),H(this,"pendingLocalTracks",[]),H(this,"pendingRemoteTracks",[]),H(this,"statsCollector",void 0),H(this,"dtlsFailedCount",0),H(this,"sendMutex",void 0),H(this,"recvMutex",void 0),H(this,"_state",Dr.Disconnected),H(this,"_restartStates",["disconnected","failed"]),H(this,"reconnectInterval",void 0),H(this,"uploadUnplinkStarted",!1),H(this,"uploadDownlinkStarted",!1),H(this,"uplinkStateUploadInterval",void 0),H(this,"downlinkStatsUploadInterval",void 0),H(this,"handleMuteLocalTrack",(async(r,s,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Dr.Connected)return void c(new Ne(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(r);if(g.length===0)return void s();const v=g.find((A=>A[0]==="videoLowTrack"));v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map((A=>{let[,{id:B}]=A;return B})));let E=!1;var h,f;r.trackMediaType==="video"?E=!((h=this.localTrackMap.get(We.LocalAudioTrack))===null||h===void 0||!h.track._muted):E=((f=this.localTrackMap.get(We.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;const C=this.createMuteMessage(g);await Kr(this,Tt.RequestMuteLocal,C);const R=r.trackMediaType==="video"?Ih.MUTE_LOCAL_VIDEO:Ih.MUTE_LOCAL_AUDIO;await Kr(this,Tt.RequestP2PMuteLocal,{action:R,message:C,isMuteAll:E}),s()}catch(g){c(g)}finally{d()}})),H(this,"handleUnmuteLocalTrack",(async(r,s,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Dr.Connected)return void c(new Ne(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(r);if(h.length===0)return void s();await this.sendConnection.unmuteLocal(h.map((v=>{let[,{id:E}]=v;return E})));const f=this.createUnmuteMessage(h),g=r.trackMediaType==="video"?Ih.UNMUTE_LOCAL_VIDEO:Ih.UNMUTE_LOCAL_AUDIO;await Kr(this,Tt.RequestP2PMuteLocal,{action:g,message:f}),s()}catch(h){c(h)}finally{d()}})),H(this,"handleUpdateVideoEncoder",(async(r,s,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(We.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==r||this.state!==Dr.Connected)return void s();const{id:v,track:E}=g;v&&(await this.sendConnection.updateSendParameters(v,E),await this.sendConnection.updateEncoderConfig(v,E),this.emit(Tt.UpdateVideoEncoder,E)),s()}catch(g){c(g)}finally{var f;(f=h)===null||f===void 0||f()}})),H(this,"handleUpdateVideoSendParameters",(async(r,s,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(We.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==r||this.state!==Dr.Connected)return void s();const{id:f,track:g}=h;f&&await this.sendConnection.updateSendParameters(f,g),s()}catch(h){c(h)}finally{d()}})),H(this,"handleReplaceTrack",(async(r,s,c,d)=>{let h;k.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;const v=Array.from(this.localTrackMap.entries()).find((E=>{let[,{track:C}]=E;return r===C}));if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Dr.Connected)return void s();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(r,v[1].id)),v[0]===We.LocalVideoTrack&&vr().supportDualStreamEncoding){const E=this.localTrackMap.get(We.LocalVideoLowTrack);if(E){const C=r._mediaStreamTrack.clone();E.track._originMediaStreamTrack.stop(),E.track._mediaStreamTrack=C,E.track._originMediaStreamTrack=C,await new nt(((R,A)=>{this.handleReplaceTrack(E.track,R,A,!0)}))}}s()}catch(v){c(v)}finally{var g;(g=h)===null||g===void 0||g()}})),H(this,"handleGetLocalVideoStats",(r=>{r(this.statsCollector.getLocalVideoTrackStats())})),H(this,"handleGetLocalAudioStats",(r=>{r(this.statsCollector.getLocalAudioTrackStats())})),H(this,"handleGetRemoteVideoStats",(r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid])),H(this,"handleGetRemoteAudioStats",(r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new $5(e),this.bindStatsUploaderEvents(),this.sendMutex=new Xs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Xs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))}))}),Z("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new v8(e,this.store,Di.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const s=await this.recvConnection.establish(t);return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}{this.state=Dr.New,this.sendConnection&&(k.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new v8(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const s=await this.sendConnection.establish();return{iceParameters:s.iceParameters,dtlsParameters:s.dtlsParameters,sdp:s.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new Ne(J.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Dr.Connected}async addRemoteCandidate(e,t){if(t===Di.RECEIVE_ONLY){if(!this.sendConnection)throw new Ne(J.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ne(J.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var s=this;return So((function*(){const c=yield yr(s.sendMutex.lock("From P2PChannel.publish"));try{if(!s.sendConnection||s.state!==Dr.Connected){s.throwIfTrackTypeNotMatch(e);const v=e.filter((E=>s.pendingLocalTracks.indexOf(E)===-1));return void(s.pendingLocalTracks=s.pendingLocalTracks.concat(v))}s.store.pubId=s.store.pubId+1,ei.markPublishStart(s.store.clientId,s.store.pubId);const d=s.filterTobePublishedTracks(e,t,r);if(d.length===0)return void(yield yr(s.tryToUnmuteAudio(e)));d.forEach((v=>{let{track:E,type:C}=v;const R=Date.now();s.store.publish(E.getTrackId(),C===We.LocalAudioTrack?"audio":"video",R)})),s.bindLocalTrackEvents(d);const h=yield yr(s.sendConnection.send(d.map((v=>{let{track:E}=v;return E})),s.store.codec,s.store.audioCodec)),f=(yield yr(h.next())).value,g=s.createGatewayPublishMessage(d,f);try{yield g}catch(v){throw h.throw(v),(v==null?void 0:v.code)===J.WS_ABORT&&d.forEach((E=>{let{track:C}=E;s.pendingLocalTracks.indexOf(C)===-1&&s.pendingLocalTracks.push(C)})),s.unbindLocalTrackEvents(d),v}yield yr(h.next()),d.forEach((v=>{let{type:E}=v;s.statsCollector.addLocalStats(E)})),s.statsUploader.startUploadOutboundStats(),s.assignLocalTracks(d,f),d.forEach((v=>{let{track:E,type:C}=v;const R=Date.now();s.store.publish(E.getTrackId(),C===We.LocalAudioTrack?"audio":"video",void 0,R)})),s.startUploadUplinkState()}finally{c()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==Dr.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((c=>!$e(e).call(e,c))));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const r=t.find((c=>c[0]==="videoLowTrack"));r&&r[1].track.close();const s=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((c=>{let[,{id:d}]=c;return d}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((c=>{let[d,{track:h}]=c;return{type:d,track:h}}))),t.forEach((c=>{let[d]=c;this.statsCollector.removeLocalStats(d)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Dr.Connected)return r&&r[1].track.close(),s;e.forEach((c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],r=[];Array.from(this.localTrackMap.entries()).forEach((s=>{let[c,{track:d,ssrcs:h}]=s;const f={stream_type:Tne(d,c),ssrcs:h};d._muted||!d._enabled?t.push(f):r.push(f)})),t.length>0&&t.forEach((s=>{Kr(this,Tt.RequestMuteLocal,[s])})),r.length>0&&r.forEach((s=>{Kr(this,Tt.RequestUnmuteLocal,[s])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return So((function*(){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(k.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Vs(this,Tt.RequestRePublish,this.pendingLocalTracks),this.emit(Tt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,s){var c;if(!this.recvConnection)throw new Ne(J.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;const{track:d,mid:h,transceiver:f}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),s);t===ot.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new O_(d,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new I_(d,e.uid,e._uintid,this.store),k.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack));const g=this.remoteUserMap.get(e);g?g.set(t,h):this.remoteUserMap.set(e,new Map([[t,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex((E=>{let{user:C,kind:R}=E;return C.uid===e.uid&&t===R}));v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Tt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,s){if(!this.recvConnection)throw new Ne(J.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),s)}async unsubscribe(e,t,r){const s=this.pendingRemoteTracks.filter((d=>{let{user:h,kind:f}=d;return t!==void 0?h.uid===e.uid&&t===f:h.uid===e.uid}));if(s.forEach((d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)})),this.recvConnection||r||s.forEach((d=>{let{kind:h}=d;var f;if(h===ot.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(h===ot.VIDEO){var g;(g=e._videoTrack)===null||g===void 0||g._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,t);c.length!==0&&(await this.recvConnection.stopReceiving(c.map((d=>{let[,{id:h}]=d;return h}))),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach((d=>{let[h,{kind:f}]=d;var g,v;if(f===ot.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),f===ot.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),r||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(f===ot.AUDIO){var E;this.unbindRemoteTrackEvents(h._audioTrack),!r&&((E=h._audioTrack)===null||E===void 0||E._destroy(),h._audioTrack=void 0)}})),c.forEach((d=>{let[,{kind:h}]=d;Kr(this,Tt.RequestP2PMuteRemote,h)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((t=>{let[,r]=t;[ot.VIDEO,ot.AUDIO].forEach((s=>{r.has(s)?Kr(this,Tt.RequestP2PUnmuteRemote,s):Kr(this,Tt.RequestP2PMuteRemote,s)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ne(J.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const s=t===ot.VIDEO?e._videoSSRC:e._audioSSRC;s!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(s,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const r=this.remoteUserMap.get(e);if(!r)return void k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||k.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(We.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Xn){const r=t.track;return Array.from(this.localTrackMap.entries()).filter((s=>{let[c]=s;return c!==We.LocalAudioTrack})).filter((s=>{let[c]=s;return!(e&&c===We.LocalVideoLowTrack)})).map((s=>{let[,{track:c}]=s;return c})).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter((r=>{let[s]=r;return!(e&&s===We.LocalVideoLowTrack)})).map((r=>{let[,{track:s}]=r;return s}))}reportPublishEvent(e,t,r,s,c){if(e){const h=this.localTrackMap.get(We.LocalAudioTrack),f=s?this.localTrackMap.get(We.LocalVideoLowTrack):this.localTrackMap.get(We.LocalVideoTrack);ft.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(Hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;r||(r=[]);const h=r.find((g=>g instanceof Nn)),f=s?(d=this.localTrackMap.get(We.LocalVideoTrack))===null||d===void 0?void 0:d.track:r.find((g=>g instanceof tn));ft.publish(this.store.sessionId,{eventElapse:ei.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:h==null?void 0:h.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(Hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,t,r,s){const c=s===ot.VIDEO?r._videoSSRC:r._audioSSRC;c&&ft.subscribe(this.store.sessionId,{succ:e,ec:t,video:s===ot.VIDEO,audio:s===ot.AUDIO,peerid:r.uid,subscribeRequestid:s===ot.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:ei.measureFromSubscribeStart(this.store.clientId,c)})}reset(){k.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Xs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Xs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(We.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Xn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((r=>{t.removeAudioTrack(r)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Dr.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(We.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(We.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof tn||t&&t.track instanceof Nn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;const r=Array.from(oa(t=this.remoteUserMap).call(t)).find((s=>s.uid===e));return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((r=>{let[s]=r;return{uid:s.uid,level:s.audioTrack?100*s.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(We.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=vf(e).call(e,((r,s)=>r.level-s.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(k.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Dr.Reconnecting,Z("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[r,{track:s}]=e;switch(r){case We.LocalVideoTrack:$e(t=s._hints).call(t,Hr.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case We.LocalAudioTrack:s instanceof Xn?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);case We.LocalVideoLowTrack:}})),this.emit(Tt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;Array.from(oa(r).call(r)).forEach((s=>{this.setPendingRemoteMedia(t,s)})),this.emit(Tt.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),k.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const r of this.pendingRemoteTracks){const{user:s,kind:c}=r;if((e instanceof Mh?e.uid:e)===s.uid&&t===c)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,s;if(e===Di.SEND_ONLY){if(!this.sendConnection)throw new Ne(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),s=this.sendConnection}else{if(!this.recvConnection)throw new Ne(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),s=this.recvConnection}try{if(t){const c=await s.restartICE(t);return s.isInRestartIce=!1,c}{const c=await s.restartICE();if(c){const d=await Vs(this,Tt.RequestP2PRestartICE,{direction:Di.RECEIVE_ONLY,iceParameter:c});await s.restartICE(d),s.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(We.LocalVideoTrack),r=this.localTrackMap.get(We.LocalAudioTrack),s=e.videoSend.find((A=>{var B;return A.ssrc===(t==null||(B=t.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)})),c=e.audioSend.find((A=>{var B;return A.ssrc===(r==null||(B=r.ssrcs)===null||B===void 0?void 0:B[0].ssrcId)}));if(!s||!c)return 1;const d=Ga(this,Tt.NeedSignalRTT),h=s?s.rttMs:void 0,f=c?c.rttMs:void 0,g=h&&f?(h+f)/2:h||f,v=(g&&d?(g+d)/2:g||d)||0,E=100*e.sendPacketLossRate*.7/50+.3*v/1500,C=E<.17?1:E<.36?2:E<.59?3:E<.1?4:5,R=t==null?void 0:t.track;if(R&&R._encoderConfig&&R._hints.indexOf(Hr.SCREEN_TRACK)===-1){const A=R._encoderConfig.bitrateMax,B=e.bitrate.actualEncoded;if(A&&B){const L=(1e3*A-B)/(1e3*A);return UV[L<.15?0:L<.3?1:L<.45?2:L<.6?3:4][C]}}return C}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((r=>{let[s]=r;const c=s._audioSSRC,d=s._videoSSRC,h=e.audioRecv.find((B=>B.ssrc===c)),f=e.videoRecv.find((B=>B.ssrc===d));if(!h&&!f)return void(t+=1);const g=Ga(this,Tt.NeedSignalRTT),v=e.rtt,E=(v&&g?(v+g)/2:v||g)||0,C=h?h.jitterMs:void 0,R=e.recvPacketLossRate;let A=.7*R*100/50+.3*E/1500;C&&(A=.6*R*100/50+.2*E/1500+.2*C/400),t+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new nt(((t,r)=>{this.handleMuteLocalTrack(e,t,r)}))}filterTobePublishedTracks(e,t,r){const s=[],c=vr(),d=this.getAllTracks();e=__(e=e.filter((g=>d.indexOf(g)===-1)));let h=!1,f=!1;for(const g of e){if(g instanceof tn&&(this.localTrackMap.has(We.LocalVideoTrack)||h?new Ne(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(s.push({track:g,type:We.LocalVideoTrack}),h=!0),t)){const v=this.getLowVideoTrack(g,r);s.push({track:v,type:We.LocalVideoLowTrack})}if(g instanceof Nn){const v=this.localTrackMap.get(We.LocalAudioTrack);if(v){if(!(v.track instanceof Xn))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(f){const E=s.find((C=>{let{type:R}=C;return R===We.LocalAudioTrack}));if(!(E.track instanceof Xn))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof Xn||g._bypassWebAudio)s.push({track:g,type:We.LocalAudioTrack});else{const E=new Xn;E.addAudioTrack(g),s.push({track:E,type:We.LocalAudioTrack})}f=!0}}}return s}filterTobeUnpublishedTracks(e){const t=[],r=this.getAllTracks();e=__(e=e.filter((s=>r.indexOf(s)!==-1)));for(const s of e){if(s instanceof Nn){const c=this.localTrackMap.get(We.LocalAudioTrack);if(!c)continue;c.track instanceof Xn?(c.track.removeAudioTrack(s),this.unbindLocalAudioTrackEvents(s),c.track.trackList.length===0&&(t.push([We.LocalAudioTrack,c]),c.track.close())):t.push([We.LocalAudioTrack,c])}if(s instanceof tn){const c=this.localTrackMap.get(We.LocalVideoTrack);if(!c)continue;t.push([We.LocalVideoTrack,c]);const d=this.localTrackMap.get(We.LocalVideoLowTrack);d&&t.push([We.LocalVideoLowTrack,d])}}return t}bindLocalTrackEvents(e){e.forEach((t=>{let{track:r,type:s}=t;switch(s){case We.LocalVideoTrack:r.addListener(dt.GET_STATS,this.handleGetLocalVideoStats),r.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case We.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case We.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof Xn?e.trackList.forEach((r=>{r.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(dt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[r,{track:s}]=t;return{track:s,type:r}}))),e.forEach((t=>{let{track:r,type:s}=t;switch(s){case We.LocalVideoTrack:r.off(dt.GET_STATS,this.handleGetLocalVideoStats),r.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(dt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(dt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case We.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case We.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof Xn?e.trackList.forEach((t=>{t.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(dt.GET_STATS,this.handleGetLocalAudioStats),t.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(dt.GET_STATS,this.handleGetLocalAudioStats),e.off(dt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(dt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(dt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(dt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof I_&&t.addListener(dt.GET_STATS,(r=>{r(this.handleGetRemoteVideoStats(e))})),t instanceof O_&&t.addListener(dt.GET_STATS,(r=>{r(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(dt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,r]=e;r.has(ot.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(ot.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((r,s)=>{var c;let d,{track:h,type:f}=r;switch(f){case We.LocalAudioTrack:d=Mr.Audio;break;case We.LocalVideoTrack:d=$e(c=h._hints).call(c,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalVideoLowTrack:d=Mr.Low}return{kind:f===We.LocalAudioTrack?ot.AUDIO:ot.VIDEO,stream_type:d,mid:t[s].id,ssrcs:t[s].localSSRC,isMuted:h.muted||!h.enabled}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var r;let s,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case We.LocalVideoTrack:s=$e(r=d._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoLowTrack:s=Mr.Low}return{stream_type:s,ssrcs:h,mid:f}}))}assignLocalTracks(e,t){e.forEach(((r,s)=>{let{track:c,type:d}=r;this.localTrackMap.set(d,{track:c,id:t[s].id,ssrcs:t[s].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[r]=t;this.localTrackMap.delete(r)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Tt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),$e(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Ns(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ft.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:un.TRACER}).onSuccess(),this.emit(Tt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((d=>d._audioSSRC===t));var c;s&&(this.store.subscribe(s.uid,"audio",void 0,void 0,void 0,Date.now()),(c=s.audioTrack)===null||c===void 0||c.emit(Co.FIRST_FRAME_DECODED),ft.firstRemoteFrame(this.store.sessionId,ss.FIRST_AUDIO_DECODE,ln.FIRST_AUDIO_DECODE,{peer:s._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((c=>c._audioSSRC===t));s&&ft.firstRemoteFrame(this.store.sessionId,ss.FIRST_AUDIO_RECEIVED,ln.FIRST_AUDIO_RECEIVED,{peer:s._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,s)=>{this.reportVideoFirstFrameDecoded(t,r,s)},e.onFirstVideoReceived=t=>{var r;const s=Array.from(oa(r=this.remoteUserMap).call(r)).find((c=>c._videoSSRC===t));s&&ft.firstRemoteFrame(this.store.sessionId,ss.FIRST_VIDEO_RECEIVED,ln.FIRST_VIDEO_RECEIVED,{peer:s._uintid,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{const s=t.candidateType==="relay",c=r.candidateType==="relay";r.candidateType!=="unknown"&&s===c||this.emit(Tt.ConnectionTypeChange,s),k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(kh(r))," -> ").concat(JSON.stringify(kh(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{k.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(kh(r))," -> ").concat(JSON.stringify(kh(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Tt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Di.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,k.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Di.SEND_ONLY?this.restartICE(e):Vs(this,Tt.RequestP2PRestartICE,{direction:Di.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const r=this.localTrackMap.get(We.LocalAudioTrack);if(e instanceof Nn&&(r==null?void 0:r.track)instanceof Xn)return r.track.isActive||t.push([We.LocalAudioTrack,r]),t;const s=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return e===d}));if(s&&(t.push(s),s[0]===We.LocalVideoTrack)){const c=this.localTrackMap.get(We.LocalVideoLowTrack);c&&t.push([We.LocalVideoLowTrack,c])}return t}filterTobeUnmutedTracks(e){const t=[],r=this.localTrackMap.get(We.LocalAudioTrack);if(e instanceof Nn&&(r==null?void 0:r.track)instanceof Xn)return r.track.isActive&&t.push([We.LocalAudioTrack,r]),t;const s=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return e===d}));if(s)if(s[0]===We.LocalVideoTrack){t.push(s);const c=this.localTrackMap.get(We.LocalVideoLowTrack);c&&t.push([We.LocalVideoLowTrack,c])}else t.push(s);return t}createMuteMessage(e){return e.map((t=>{var r;let s,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoTrack:s=$e(r=d._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalVideoLowTrack:s=Mr.Low}return{stream_type:s,ssrcs:h,mid:f}}))}createUnmuteMessage(e){return e.map((t=>{var r;let s,[c,{track:d,ssrcs:h,id:f}]=t;switch(c){case We.LocalAudioTrack:s=Mr.Audio;break;case We.LocalVideoTrack:s=$e(r=d._hints).call(r,Hr.SCREEN_TRACK)?Mr.Screen:Mr.High;break;case We.LocalVideoLowTrack:s=Mr.Low}return{stream_type:s,ssrcs:h,mid:f}}))}filterTobeUnSubscribedTracks(e,t){const r=[],s=this.remoteUserMap.get(e);if(!s)return r;if(t){const c=s.get(t);if(!c)return r;r.push([e,{kind:t,id:c}])}else Array.from(s.entries()).forEach((c=>{let[d,h]=c;r.push([e,{kind:d,id:h}])}));return r}createUnsubscribeMessage(e){const t=[];return e.forEach((r=>{let[s,{kind:c,id:d}]=r;switch(c){case ot.VIDEO:return void(s._videoSSRC&&t.push({stream_type:ot.VIDEO,ssrcId:s._videoSSRC}));case ot.AUDIO:return void(s._audioSSRC&&t.push({stream_type:ot.AUDIO,ssrcId:s._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((t=>{let[r,{kind:s}]=t;const c=this.remoteUserMap.get(r);c&&(c.delete(s),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(r))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(We.LocalVideoTrack),r=this.localTrackMap.get(We.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new nt(((s,c)=>{this.handleUpdateVideoEncoder(t.track,s,c,!0)}))),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new nt(((s,c)=>{this.handleUpdateVideoEncoder(r.track,s,c,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Nn){const r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;const s=this.createUnmuteMessage(r);return void await Kr(this,Tt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Tt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Tt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Ns(tO(this.dtlsFailedCount,Kn)),this.emit(Tt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(We.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof tn))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof tn)).length>1)throw new Ne(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Nn)).length>1&&(e.some((t=>t instanceof Nn&&t._bypassWebAudio))||!vr().webAudioMediaStreamDest))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof tn&&this.pendingLocalTracks.some((r=>r instanceof tn)))throw new Ne(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Nn&&this.pendingLocalTracks.some((r=>r instanceof Nn))&&(!vr().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((r=>r instanceof Nn&&r._bypassWebAudio))))throw new Ne(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const r=!Z("DISABLE_DUAL_STREAM_USE_ENCODING")&&vr().supportDualStreamEncoding,s=hC(hC({},{width:160,height:120,framerate:15,bitrate:50}),t);let c;c=r?e._mediaStreamTrack.clone():_1(e,s);const d=zr(8,"track-low-"),h=new tn(c,hC(hC({},r&&{scaleResolutionDownBy:JO(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return h.on(kf.TRANSCEIVER_UPDATED,(f=>{e._updateRtpTransceiver(f,x_.LOW_STREAM)})),h._hints.push(Hr.LOW_STREAM),e.addListener(dt.NEED_CLOSE,(()=>{h.close()})),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,s){var c;const d=Array.from(oa(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===e));if(d){s||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,f=h.subscribe.find((g=>g.userId===d.uid&&g.type==="video"));ft.firstRemoteVideoDecode(this.store.sessionId,ss.FIRST_VIDEO_DECODE,ln.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:t,videoheight:r,subscribeElapse:ei.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:s?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;const s=this.remoteUserMap.get(e);if(!s)return!1;const c=s.get(t);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ne(J.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ne(J.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Ne(J.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Ne(J.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Ne(J.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Ne(J.NOT_SUPPORTED)}async preConnect(e){throw new Ne(J.NOT_SUPPORTED)}getEstablishParams(){throw new Ne(J.NOT_SUPPORTED)}async reSubscribe(e){throw new Ne(J.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new Ne(J.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:r}]=e;t===We.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,x_.LOW_STREAM):r._updateRtpTransceiver(void 0)}))}},ht(pn.prototype,"p2pConnect",[E8],Object.getOwnPropertyDescriptor(pn.prototype,"p2pConnect"),pn.prototype),ht(pn.prototype,"unpublish",[w8],Object.getOwnPropertyDescriptor(pn.prototype,"unpublish"),pn.prototype),ht(pn.prototype,"unpublishLowStream",[b8],Object.getOwnPropertyDescriptor(pn.prototype,"unpublishLowStream"),pn.prototype),ht(pn.prototype,"subscribe",[S8],Object.getOwnPropertyDescriptor(pn.prototype,"subscribe"),pn.prototype),ht(pn.prototype,"mockSubscribe",[x8],Object.getOwnPropertyDescriptor(pn.prototype,"mockSubscribe"),pn.prototype),ht(pn.prototype,"unsubscribe",[T8],Object.getOwnPropertyDescriptor(pn.prototype,"unsubscribe"),pn.prototype),ht(pn.prototype,"muteRemote",[C8],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),ht(pn.prototype,"unmuteRemote",[R8],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),ht(pn.prototype,"hasRemoteMediaWithLock",[N8],Object.getOwnPropertyDescriptor(pn.prototype,"hasRemoteMediaWithLock"),pn.prototype),ht(pn.prototype,"disconnectForReconnect",[A8],Object.getOwnPropertyDescriptor(pn.prototype,"disconnectForReconnect"),pn.prototype),ht(pn.prototype,"remoteMediaSsrcChanged",[I8],Object.getOwnPropertyDescriptor(pn.prototype,"remoteMediaSsrcChanged"),pn.prototype),pn);function fl(e){return function(t,r,s){const c=t[r];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];switch(e){case pl.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{g()}}case pl.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(r)),v=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await c.apply(this,h)}finally{g(),v()}}}},s}}class Xf extends _n{constructor(t,r){super(),H(this,"signal",void 0),H(this,"token",void 0),H(this,"tokenTimeout",void 0),H(this,"tokenInterval",void 0),H(this,"_sequence",0),H(this,"userMap",new Map),H(this,"encoder",new TextEncoder),this.signal=t,this.token=r;const s=()=>{this.signal.connectionState===Zr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(s,1e3):this.tokenInterval=window.setTimeout(s,3*Z("P2P_TOKEN_INTERVAL"))};s()}async send(t,r,s,c,d){var h;if(this.userMap.size===0)return;const f=Array.from(xa(h=this.userMap).call(h))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),c=c??zr(6,""),d=d??this._sequence++;const g={_id:c,_type:t,_seq:d,_message:r,token:"".concat(this.token,"_").concat(f)};Z("SHOW_P2P_LOG")&&k.debug("send message",g,"noNeedResponse : ".concat(s)),this.splitMessage(JSON.stringify(g)).forEach((E=>{this.signal.request(Dt.DATA_STREAM,{payload:Ch(this.encoder.encode(E))})}));const v=new nt(((E,C)=>{const R=window.setTimeout((()=>{this.off("res-@".concat(c,"_ack"),A),this.off("res-@".concat(c),L),this.off(L_.ABORT,B),k.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(c)),this.userMap.size===0?C(new Ne(J.INVALID_REMOTE_USER)):C(new Ne(J.TIMEOUT))}),Z("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{R&&window.clearTimeout(R),this.off(L_.ABORT,B),s&&E()},B=()=>{R&&window.clearTimeout(R),this.off("res-@".concat(c,"_ack"),A),this.off("res-@".concat(c),L),C(new Ne(J.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(c)))};this.once(L_.ABORT,B),this.once("res-@".concat(c,"_ack"),A);const L=(X,Y)=>{U=!0,R&&window.clearTimeout(R),this.off("res-@".concat(c,"_ack"),A),this.off(L_.ABORT,B),X==="success"?E(Y):C(new Ne(J.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(c)))};let U=!1;s||(this.once("res-@".concat(c),L),Ns(Z("SIGNAL_REQUEST_TIMEOUT")).then((()=>{U||k.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(c,", ").concat(g))})))}));try{return await v}catch(E){if(E.code===J.TIMEOUT)return await this.send(t,r,s,c,d);throw E}}onMessage(t){var r;const{_uid:s}=t;let c,d=this.userMap.get(s);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Pn.CHECK)return;const{token:v}=t;c=new Map,d={uid:s,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(s,d),this.signal.emit(or.ON_USER_ONLINE,{uid:s}),this.handleUserOnline()}if("id"in t&&"total"in t){var h;const{id:v,total:E}=t,C=(h=c.get(v))!==null&&h!==void 0?h:[];if(C.push(t),c.has(v)||c.set(v,C),C.length!==E)return;{const R=vf(C).call(C,((A,B)=>A.index-B.index)).map((A=>A.payload)).join("");c.delete(v),(t=JSON.parse(R))._uid=s}}const{_type:f,token:g}=t;if($e(r=[Pn.ACK,Pn.CHECK]).call(r,f))return f===Pn.CHECK&&this.handleCheckToken(d,g),void this.receiveMessage(t);g==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(t):k.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(d.token,"_").concat(this.token),t)}check(){const t={_id:zr(6,""),token:this.token,_type:Pn.CHECK};Z("SHOW_P2P_LOG")&&k.debug("send message",t),this.signal.request(Dt.DATA_STREAM,{payload:Ch(this.encoder.encode(JSON.stringify(t)))})}ack(t){const r={_id:t,_type:Pn.ACK,token:this.token};Z("SHOW_P2P_LOG")&&k.debug("send message",r),this.signal.request(Dt.DATA_STREAM,{payload:Ch(this.encoder.encode(JSON.stringify(r)))})}response(t,r,s){this.send(Pn.RESPONSE,JSON.stringify({success:!s,message:r}),!0,t)}handleReceivedMessage(t){const r=()=>{this.userMap.forEach((v=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:C}=v;for(;E.has(C);){const R=E.get(C);E.delete(C),this.receiveMessage(R),v.nextExpectedSequenceNumber++}}))};if(!t)return void r();const{_uid:s,_seq:c}=t,d=this.userMap.get(s),{receivedMessagesMap:h,isStart:f,nextExpectedSequenceNumber:g}=d;if(c<g)return this.ack(t._id),void k.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(t._message));h.set(c,t),f&&c===g&&(this.receiveMessage(t),h.delete(g),d.nextExpectedSequenceNumber++,r())}receiveMessage(t){const{_id:r,_type:s,_message:c,_uid:d}=t;if(Z("SHOW_P2P_LOG")&&k.debug("receive message",t),r){let h;switch(t._type!==Pn.ACK&&(c&&(h=JSON.parse(c)),this.ack(t._id)),t._type){case Pn.CANDIDATE:case Pn.CONTROL:this.signal.emit(s,h,d);break;case Pn.PUBLISH:case Pn.UNPUBLISH:case Pn.RESTART_ICE:case Pn.CALL:h.uid=d,Vs(this.signal,s,h).then((f=>{this.response(t._id,f)})).catch((()=>{this.response(t._id,void 0,!0)}));break;case Pn.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case Pn.RESPONSE:{const{success:f,message:g}=h;this.emit("res-@".concat(r),f?"success":"failed",g);break}}}}splitMessage(t){if(t.length<Xf.MAX_MESSAGE_SIZE)return[t];const r=[],{remoteToken:s}=JSON.parse(t),c=zr(6,"");let d=0,h=800;const f=Math.ceil(t.length/h);for(;t.length>0;){d++;const g={id:c,index:d,total:f,payload:t.slice(0,h),token:"".concat(this.token,"_").concat(s)};JSON.stringify(g).length>Xf.MAX_MESSAGE_SIZE?h-=50:(r.push(g),t=t.slice(h))}return r.map((g=>JSON.stringify(g)))}handleCheckToken(t,r){return t.token!==r?(k.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{k.debug("token timeout, ".concat(r)),this.reset(t.uid)}),Z("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await Vs(this.signal,Pn.CALL,void 0),r=await this.send(Pn.CALL,t);this.signal.emit(Mt.P2P_CONNECTION,r,!0)}async reset(t,r){const s=this.userMap.get(t);s&&(this.emit(L_.ABORT),this.signal.emit(or.ON_USER_OFFLINE,{uid:s.uid,reason:Zre.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(k.debug("change local token from ".concat(r," to ").concat(r)),this.token=zr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(L_.ABORT)}}H(Xf,"MAX_SIZE",1),H(Xf,"MAX_MESSAGE_SIZE",1024);class Die extends _n{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Zr.CONNECTED?this.emit(Mt.WS_CONNECTED):t===Zr.RECONNECTING?this.emit(Mt.WS_RECONNECTING,this._websocketReconnectReason):t===Zr.CLOSED&&this.emit(Mt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),H(this,"_disconnectedReason",void 0),H(this,"_websocketReconnectReason",void 0),H(this,"_connectionState",Zr.CLOSED),H(this,"reconnectToken",void 0),H(this,"p2pToken",void 0),H(this,"websocket",void 0),H(this,"openConnectionTime",void 0),H(this,"clientId",void 0),H(this,"lastMsgTime",Date.now()),H(this,"uploadCache",[]),H(this,"uploadCacheInterval",void 0),H(this,"rttRolling",new a3(5)),H(this,"pingpongTimer",void 0),H(this,"pingpongTimeoutCount",0),H(this,"joinResponse",void 0),H(this,"multiIpOption",void 0),H(this,"initError",void 0),H(this,"spec",void 0),H(this,"store",void 0),H(this,"_external_signal",void 0),H(this,"onWebsocketMessage",(s=>{if(s.data instanceof ArrayBuffer)return void this.emit(Mt.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case or.ON_DATA_STREAM:return void this.handleDataStream(c._message);case or.MUTE_AUDIO:case or.MUTE_VIDEO:case or.ON_P2P_LOST:case or.ON_USER_ONLINE:return;case or.ON_USER_OFFLINE:const{uid:d}=c._message;return k.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===or.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===or.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Pr.UID_BANNED);break;case 15:this.close(Pr.IP_BANNED);break;case 16:this.close(Pr.CHANNEL_BANNED)}if(c._type===or.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Nt.ERR_LICENSE_MISSING:this.close(Pr.LICENSE_MISSING);break;case Nt.ERR_LICENSE_EXPIRED:this.close(Pr.LICENSE_EXPIRED);break;case Nt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Pr.LICENSE_MINUTES_EXCEEDED);break;case Nt.ERR_LICENSE_PERIOD_INVALID:this.close(Pr.LICENSE_PERIOD_INVALID);break;case Nt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Pr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Nt.ERR_LICENSE_ILLEGAL:this.close(Pr.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new YO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Z("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Z("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Zr.CONNECTED&&this.reconnect("retry",Fs.OFFLINE)})),this.p2pToken=zr(6,""),this._external_signal=new Xf(this,this.p2pToken)}async request(t,r,s,c){const d=zr(6,""),h={_id:d,_type:t,_message:r},f=this.websocket.connectionID,g=()=>new nt(((B,L)=>{if(this.connectionState===Zr.CONNECTED)return B();const U=()=>{this.off(Mt.WS_CLOSED,X),B()},X=()=>{this.off(Mt.WS_CONNECTED,U),L(new Ne(J.WS_ABORT))};this.once(Mt.WS_CONNECTED,U),this.once(Mt.WS_CLOSED,X)}));if(this.connectionState!==Zr.CONNECTING&&this.connectionState!==Zr.RECONNECTING||t===Dt.JOIN||t===Dt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const v=new nt(((B,L)=>{let U=!1;const X=(ee,ue)=>{U=!0,B({isSuccess:ee==="success",message:ue||{}}),this.off(Mt.WS_CLOSED,Y),this.off(Mt.WS_RECONNECTING,Y),this.emit(Mt.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(d),X);const Y=()=>{L(new Ne(J.WS_ABORT,"type: ".concat(t))),this.off(Mt.WS_CLOSED,Y),this.off(Mt.WS_RECONNECTING,Y),this.off("res-@".concat(d),X)};this.once(Mt.WS_CLOSED,Y),this.once(Mt.WS_RECONNECTING,Y),Ns(Z("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==f||U||(k.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Mt.REQUEST_TIMEOUT,t,r))}))}));let E=null;try{E=await v}catch(B){if(this.connectionState===Zr.CLOSED||t===Dt.LEAVE)throw new Ne(J.WS_ABORT);return!this.spec.forceWaitGatewayResponse||s?B.throw():t===Dt.JOIN||t===Dt.REJOIN?null:(await g(),await this.request(t,r))}if(E.isSuccess)return E.message;const C=Number(E.message.error_code||E.message.code),R=TE(C),A=new Ne(J.UNEXPECTED_RESPONSE,"".concat(R.desc,": ").concat(E.message.error_str),{code:C,data:E.message,desc:R.desc});return R.action==="success"?E.message:(k.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(C,", message: ").concat(R.desc,", action: ").concat(R.action)),C===Nt.ERR_TOO_MANY_BROADCASTERS?((t===Dt.JOIN||t===Dt.REJOIN)&&(this.initError=A,this.close()),A.throw()):R.action==="failed"?A.throw():R.action==="quit"?(this.initError=A,this.close(),A.throw()):(C===Nt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=E.message.option,k.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fs.MULTI_IP)):this.reconnect(R.action,Fs.SERVER_ERROR),t===Dt.JOIN||t===Dt.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new nt((s=>{const c=d=>{(!r||r(d))&&(this.off(t,c),s(d))};this.on(t,c)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void k.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(SE.WRTC_STATS,r)}upload(t,r){const s={_type:t,_message:r};try{this.websocket.sendMessage(s)}catch{const d=Z("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Zr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),Z("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){const s={_type:t,_message:r};this.websocket.sendMessage(s)}async sendExtensionMessage(t,r,s){return await this._external_signal.send(t,r,s)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new nt(((r,s)=>{this.once(Mt.WS_CONNECTED,(()=>r(this.joinResponse))),this.once(Mt.WS_CLOSED,(()=>s(this.initError||new Ne(J.WS_ABORT)))),this.connectionState=Zr.CONNECTING,this.websocket.init(t).catch(s)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Pr.LEAVE,this.connectionState=Zr.CLOSED,k.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=zr(6,""),this._external_signal.clear(),this._external_signal=new Xf(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Mt.ABORT_P2P_EXECUTION);const t=await Vs(this,Mt.REQUEST_JOIN_INFO),r=await this.request(Dt.JOIN,t);if(!r)return this.emit(Mt.REPORT_JOIN_GATEWAY,J.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Mt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Zr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}async downgradeCodec(t){return!1}handleDataStream(t){try{var r;const s=Af(t.payload),c=new TextDecoder().decode(s),d=JSON.parse(c);"total"in d&&"id"in d||$e(r=Object.values(Pn)).call(r,d._type)?(d._uid=t.uid,this._external_signal.onMessage(d)):this.emit(or.ON_DATA_STREAM,t)}catch{this.emit(or.ON_DATA_STREAM,t)}}handleNotification(t){k.debug("[".concat(this.clientId,"] receive notification: "),t);const r=TE(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Pr.UID_BANNED),void this.close()):void this.reconnect(r.action,Fs.SERVER_ERROR);k.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=Z("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(k.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Z("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fs.TIMEOUT):this.request(Dt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const s=Date.now()-r;this.rttRolling.add(s),Z("REPORT_STATS")&&this.send(Dt.PING_BACK,{pingpongElapse:s})})).catch((s=>{}))}handleWebsocketEvents(){this.websocket.on(Kt.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(Mt.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Kt.CLOSED,(()=>{this.connectionState=Zr.CLOSED})),this.websocket.on(Kt.FAILED,(()=>{this._disconnectedReason=Pr.NETWORK_ERROR,this.connectionState=Zr.CLOSED})),this.websocket.on(Kt.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Zr.CONNECTED?this.connectionState=Zr.RECONNECTING:this.connectionState=Zr.CONNECTING})),this.websocket.on(Kt.WILL_RECONNECT,((t,r,s)=>{t!=="retry"?(k.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):k.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),s(t)})),this.websocket.on(Kt.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((t=>{if(this.emit(Mt.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ne&&t.code===J.UNEXPECTED_RESPONSE&&t.data.code===Nt.ERR_NO_AUTHORIZED)return k.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Fs.SERVER_ERROR);k.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fs.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(Kt.REQUEST_NEW_URLS,((t,r)=>{Vs(this,Mt.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)})),this.websocket.on(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(or.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const jie={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new Pie(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new Die(r,t)}};function k8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function P8(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k8(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k8(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}class Lie{constructor(t){H(this,"sessionDesc",void 0),H(this,"localCapabilities",void 0),H(this,"rtpCapabilities",void 0),H(this,"candidates",void 0),H(this,"_originCandidates",void 0),H(this,"iceParameters",void 0),H(this,"dtlsParameters",void 0),H(this,"setup",void 0),H(this,"currentMidIndex",void 0),H(this,"cname",void 0),t=hn(t);const{iceParameters:r,dtlsParameters:s,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:f,sdkCodec:g,cname:v}=t,E=aa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=hn(c),this.iceParameters=r,this.dtlsParameters=s,this.setup=h,this.localCapabilities=f,this.cname=v;for(let C=0;C<E.mediaDescriptions.length;C++){const R=E.mediaDescriptions[C];if(R.attributes.iceUfrag=r.iceUfrag,R.attributes.icePwd=r.icePwd,R.attributes.fingerprints=s.fingerprints,R.attributes.candidates=c,R.attributes.setup=h,R.media.mediaType==="video"){R.media.fmts=d.videoCodecs.map((L=>L.payloadType.toString(10)));const A=d.videoCodecs.filter((L=>{var U,X;return(U=L.rtpMap)===null||U===void 0?void 0:$e(X=U.encodingName.toLowerCase()).call(X,g)})),B=d.videoCodecs.filter((L=>!$e(A).call(A,L)));R.attributes.payloads=[...A,...B],R.attributes.extmaps=d.videoExtensions}R.media.mediaType==="audio"&&(R.media.fmts=d.audioCodecs.map((A=>A.payloadType.toString(10))),R.attributes.payloads=d.audioCodecs,R.attributes.extmaps=d.audioExtensions),E.mediaDescriptions[C]=this.mungMediaDesc(R)}this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1}toString(){return Rh(this.sessionDesc)}send(t,r,s){const{ssrcs:c,ssrcGroups:d}=AE(r,this.cname),h=this.sessionDesc.mediaDescriptions.find((v=>t===ot.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio")),f=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:f,mslabel:g}}batchSend(t){return t.map((r=>{let{kind:s,ssrcMsg:c}=r;return this.send(s,c,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((r=>{const s=[],c=[],d=[];r.attributes.ssrcs.forEach((h=>{$e(t).call(t,h.attributes.label||"")?d.push(h):s.push(h)})),r.attributes.ssrcGroups.forEach((h=>{var f;$e(f=d.map((g=>g.ssrcId))).call(f,h.ssrcIds[0])||c.push(h)})),r.attributes.ssrcs=s,r.attributes.ssrcGroups=c}))}mute(t){const r=this.sessionDesc.mediaDescriptions.find((s=>s.attributes.mid===t));if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){const r=this.sessionDesc.mediaDescriptions.find((s=>s.attributes.mid===t));if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,s){t.forEach(((c,d)=>{const h=c._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex((v=>v.attributes.mid===h.kind)),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],c);this.sessionDesc.mediaDescriptions[f]=g}))}stopReceiving(t){}updateCandidates(t){const r=this._originCandidates.filter((c=>c.transport==="udp")),s=[];if(r.forEach((c=>{s.push(P8(P8({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))})),r.length!==0){switch(t){case Zs.TCP_RELAY:this.candidates=s;break;case Zs.UDP_TCP_RELAY:case Zs.RELAY:this.candidates=[...r,...s];break;default:this.candidates=r}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(t){t=hn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}mungRecvMediaDsec(t,r){const s=hn(t);return F_(s,r),ZO(s,r),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex((c=>c.attributes.mid===t));if(s!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,s){const c=this.sessionDesc.mediaDescriptions.find((h=>t===ot.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio"));if(c){const h=c.attributes.ssrcs.find((f=>f.attributes.label===r));var d;h&&(h.attributes.label=s,(d=h.attributes.msid)===null||d===void 0||d.replace(r,s))}}mungMediaDesc(t){const r=hn(t);return QO(r),(function(s){const c=s.attributes.extmaps.find((d=>RT(d.extensionName)));c&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(c),1),s.attributes.payloads.forEach((d=>{const h=d.rtcpFeedbacks.findIndex((f=>f.type==="transport-cc"));h!==-1&&d.rtcpFeedbacks.splice(h,1)}))})(r),r}getSSRC(t){for(const r of this.sessionDesc.mediaDescriptions)for(const s of r.attributes.ssrcs)if(s.attributes.label===t)return[s]}}var $r;function D8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable}))),r.push.apply(r,s)}return r}function pC(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D8(Object(r),!0).forEach((function(s){H(e,s,r[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D8(Object(r)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))}))}return e}let Mie=($r=class yw extends zV{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var r;return $e(r=Object.keys(yE)).call(r,t)})))]}constructor(t,r){super(t,r),H(this,"store",void 0),H(this,"peerConnection",void 0),H(this,"remoteSDP",void 0),H(this,"initialOffer",void 0),H(this,"statsFilter",void 0),H(this,"useRTX",!1),H(this,"localCapabilities",void 0),H(this,"localCandidateCount",0),H(this,"allCandidatesReceived",!1),H(this,"establishPromise",void 0),H(this,"mutex",void 0),this.store=r,this.mutex=new Xs("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(yw.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=oO(this.peerConnection,Z("STATS_UPDATE_INTERVAL"),void 0,Sn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Ph(t.sdp),s=NE(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:Z("FILTER_VIDEO_FEC"),filterAudioFec:Z("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=s,this.initialOffer=t,pC(pC({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:s},offerSDP:t.sdp})}catch(t){throw new Ne(J.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Lie(pC(pC({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new Ne(J.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var s=this;return So((function*(){const c=yield yr(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=t.map((R=>s.peerConnection.addTrack(R._mediaStreamTrack))),h=yield yr(s.peerConnection.createOffer()),f=aa(h.sdp),g=t.map((R=>{const A=R._mediaStreamTrack,B=f.mediaDescriptions.find((L=>L.attributes.mid===A.kind));if(!B)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(L,U,X){const Y=L.attributes.ssrcs.filter((ue=>ue.attributes.label===U)),ee=L.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ee&&Y.length>1){const ue=ee.find((de=>de.ssrcIds.indexOf(Y[0].ssrcId)!==-1));return ue?[{ssrcId:ue.ssrcIds[0],rtx:X?ue.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]})(B,A.id,s.useRTX)}));let v;try{v=yield g}catch(R){throw d.forEach((A=>{Us()&&A.replaceTrack(null),s.peerConnection.removeTrack(A)})),R}const E=s.mungSendOfferSDP(h.sdp,t);s.remoteSDP.receive(t,r,v);const C=s.remoteSDP.toString();return yield yr(s.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield yr(s.applySendEncodings(d,t)),yield yr(s.peerConnection.setRemoteDescription({type:"answer",sdp:C})),t.map(((R,A)=>{const B=R._mediaStreamTrack.id;return{localSSRC:g[A],id:B}}))}catch(d){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getSenders().filter((d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map((d=>{Us()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)}));const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(t);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,s,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(t,r,c),f=new nt(((E,C)=>{const R=setTimeout((()=>{C(new Error("Cannot receive track, id: ".concat(d)))}),1e4),A=B=>{const L=fr();if((L.name==="Safari"&&Number(L.version)===11||ii())&&B.track.id!==d&&B.streams[0].id===h){var U;const X=B.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(t,d,B.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(R),void E(X)}if(B.track.id===d)return this.peerConnection.removeEventListener("track",A),clearTimeout(R),void E(B.track)};this.peerConnection.addEventListener("track",A)})),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await f,id:d}}catch(d){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter((s=>{var c;return t.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1}));if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map((s=>{if(Us()&&s.track)s.track.enabled=!1;else{const c=s.getParameters();c.encodings.forEach((d=>d.active=!1)),s.setParameters(c)}}))}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const r=this.peerConnection.getSenders().filter((d=>{var h;return t.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map((async d=>{if(Us()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach((f=>f.active=!0)),await d.setParameters(h)}}));const s=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(s);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return So((function*(){const s=yield yr(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=vr().supportPCSetConfiguration;if(t===Zs.RELAY&&!c)return;if(c){const v=r.peerConnection.getConfiguration(),E=t===Zs.RELAY?"relay":"all";v.iceTransportPolicy!==E&&(k.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(E,"]")),v.iceTransportPolicy=E,r.peerConnection.setConfiguration(v))}t!==Zs.RELAY&&r.remoteSDP.updateCandidates(t);const d=yield yr(r.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Ph(d.sdp),{remoteIceParameters:f}=yield h.iceParameters;r.remoteSDP.restartICE(f);const g=r.remoteSDP.toString();yield yr(r.peerConnection.setLocalDescription(d)),yield yr(r.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){k.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}}))()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const s=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(s.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Ne(J.EXCHANGE_SDP_FAILED,s.toString())}}async updateSendParameters(t,r){const s=this.peerConnection.getSenders().filter((c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===t}));s.length===1&&await this.applySendEncodings(s,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){const s=this.peerConnection.getSenders().find((c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r}));s&&await s.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new Ne(J.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Ne(J.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,k.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),Z("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(pE(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...yw.turnServerConfigToIceServers(t.turnServer.servers)),Z("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...yw.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((s=>{s.forceturn&&(r.iceTransportPolicy="relay")})))),r}static turnServerConfigToIceServers(t){const r=[];return t.forEach((s=>{s.security?s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&r.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))})),r}async updateRtpSenderEncodings(t,r){var s;if(r||(r=this.peerConnection.getSenders().find((v=>{var E;return((E=v.track)===null||E===void 0?void 0:E.id)===t._mediaStreamTrack.id}))),!r)return k.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!vr().supportSetRtpSenderParameters)return k.warn("Browser not support set rtp-sender parameters");const c={},d={};if(t instanceof tn)switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(Z("DSCP_TYPE")&&au()){var h;const v=Z("DSCP_TYPE");$e(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const f=r.getParameters(),g=(s=f.encodings)===null||s===void 0?void 0:s[0];g&&Object.assign(g,d),Object.assign(f,c),k.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await r.setParameters(f)}async applySendEncodings(t,r){try{if(!vr().supportSetRtpSenderParameters||t.length!==r.length)return;for(let s=0;s<t.length;s++){const c=t[s],d=r[s];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{k.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){const s=aa(t);return r.forEach(((c,d)=>{const h=c._mediaStreamTrack,f=s.mediaDescriptions.find((g=>g.attributes.mid===h.kind));f&&F_(f,c)})),Rh(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,s)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,t,r,s)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var s;(s=this.onSelectedLocalCandidateChanged)===null||s===void 0||s.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var s;(s=this.onSelectedRemoteCandidateChanged)===null||s===void 0||s.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const r=this.remoteSDP.batchSend(t).map(((d,h)=>{let{id:f,mslabel:g}=d;const{kind:v}=t[h];return new nt(((E,C)=>{const R=setTimeout((()=>{C(new Error("Cannot receive track, id: ".concat(f)))}),1e4),A=B=>{const L=fr();if(L.name==="Safari"&&Number(L.version)===11&&B.track.id!==f&&B.streams[0].id===g){var U;const X=B.streams[0].getTracks()[0];return(U=this.remoteSDP)===null||U===void 0||U.updateTrackLabel(v,f,B.track.id),this.peerConnection.removeEventListener("track",A),clearTimeout(R),void E({track:X,id:f})}if(B.track.id===f)return this.peerConnection.removeEventListener("track",A),clearTimeout(R),void E({track:B.track,id:f})};this.peerConnection.addEventListener("track",A)}))})),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await nt.all(r)}catch(r){throw new Ne(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const r=this.remoteSDP.getSSRC(t);return r==null?void 0:r[0].ssrcId}setConfiguration(t){if(vr().supportPCSetConfiguration){const r=yw.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},ht($r.prototype,"connect",[ko],Object.getOwnPropertyDescriptor($r.prototype,"connect"),$r.prototype),ht($r.prototype,"stopSending",[ko],Object.getOwnPropertyDescriptor($r.prototype,"stopSending"),$r.prototype),ht($r.prototype,"receive",[ko],Object.getOwnPropertyDescriptor($r.prototype,"receive"),$r.prototype),ht($r.prototype,"stopReceiving",[ko],Object.getOwnPropertyDescriptor($r.prototype,"stopReceiving"),$r.prototype),ht($r.prototype,"muteRemote",[ko],Object.getOwnPropertyDescriptor($r.prototype,"muteRemote"),$r.prototype),ht($r.prototype,"unmuteRemote",[ko],Object.getOwnPropertyDescriptor($r.prototype,"unmuteRemote"),$r.prototype),ht($r.prototype,"muteLocal",[ko],Object.getOwnPropertyDescriptor($r.prototype,"muteLocal"),$r.prototype),ht($r.prototype,"unmuteLocal",[ko],Object.getOwnPropertyDescriptor($r.prototype,"unmuteLocal"),$r.prototype),ht($r.prototype,"close",[ko],Object.getOwnPropertyDescriptor($r.prototype,"close"),$r.prototype),ht($r.prototype,"updateEncoderConfig",[ko],Object.getOwnPropertyDescriptor($r.prototype,"updateEncoderConfig"),$r.prototype),ht($r.prototype,"updateSendParameters",[ko],Object.getOwnPropertyDescriptor($r.prototype,"updateSendParameters"),$r.prototype),ht($r.prototype,"replaceTrack",[ko],Object.getOwnPropertyDescriptor($r.prototype,"replaceTrack"),$r.prototype),ht($r.prototype,"getRemoteSSRC",[ko],Object.getOwnPropertyDescriptor($r.prototype,"getRemoteSSRC"),$r.prototype),$r);function ko(e,t,r){const s=e[t];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(t));try{for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];return await s.apply(this,f)}finally{d()}},r}const Uie={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new Mie(r,t)}},Fie={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!vr().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(dT.has(e)||!e.track)return;const r={track:e.track};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,f){r.controller||(r.controller=f),e.track&&e.track.id!==r.track.id&&(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s));const g=t.metadata&&t.metadata();g?(function(v,E){const{chunk:C,controller:R}=E,A=Nh.METADATA;C.data=(function(B,L,U){const X=U.byteLength,Y=X+kO+IV,ee=IO+OO+Y,ue=new ArrayBuffer(B.byteLength+ee),de=new DataView(ue);de.setUint8(0,AV),de.setUint16(1,Y),de.setUint8(3,L),de.setUint16(4,X);for(let be=0;be<X;be++)de.setUint8(6+be,U[be]);const ne=new Uint8Array(de.buffer);return ne.set(new Uint8Array(B),ee),ne.buffer})(C.data,A,v),R.enqueue(C)})(g,{chunk:h,controller:f}):f.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Us()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=lT(),d=new MessageChannel;await new nt((f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);e.transform=h,await new nt((f=>c.onmessage=g=>{g.data==="started"&&f(void 0)})),d.port1.onmessage=f=>{var g;if(f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id)k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s);else if(f.data.getMetadata){const v=t.metadata&&t.metadata();v&&d.port1.postMessage({metadata:v})}},r.worker=c}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const c=dT.get(e);if(c){dT.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){k.warning(f&&f.message)}}}dT.set(e,r),e.track.addEventListener("ended",s)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!vr().supportWebRTCEncodedTransform)return void k.warning("browser not support audio encoded transform");if(gT.has(e))return;const r={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(iu()&&!ii()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");BI(br.CHROME,87,116)||(t.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,f){r.controller||(r.controller=f),e.track&&e.track.id!==r.track.id&&(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s)),t.enableTopn?(function(g,v,E){var C;const R=PO(new DataView(v.data));if(!R)return E.enqueue(v);const A=g.track.id;Ere.set(A,g.track);const B=(C=R.tlv.find((ue=>ue.tag===Nh.AUDIO_LEVEL)))===null||C===void 0?void 0:C.value;let L=0;typeof B=="number"&&(L=127-B);const U=Math.round(Math.pow(10,L/60)-1),{selected:X,speaker:Y}=(function(ue,de){let ne=k_.get(ue);if(ne||(ne=(function(be){const Ae=new kV;return k_.set(be,Ae),ol||(ol=new yre(Z("TOPN_SILENCE_THRESHOLD")||500),ol.on("ActiveSpeakerChanged",(Ue=>{Ue!=null&&(pT=Ue)}))),ol.addSpeakers([Ae]),Ae})(ue)),k_.size<=PV)return{selected:!0,speaker:ne};if(!ol)throw new Error("no active speaker detector");return ol.levelChanged(ne.id,de),Lf=ol.loudest.map((be=>be.id)),pT&&!$e(Lf).call(Lf,pT)&&Lf.length>=PV&&Lf.pop(),{selected:$e(Lf).call(Lf,ne.id)||ne.id===pT,speaker:ne}})(g,U),ee=(function(ue,de,ne){const be=cl.get(ue)||new vre(ue,de);return be.score=ne,cl.set(ue,be),(function(Ae){if(fT.set(Ae,!0),!mT)return void(mT=Date.now());const Ue=Date.now();Ue-mT>1e3&&(fT.get(Ae)?fT.set(Ae,!1):(DV(Ae),fT.delete(Ae)),mT=Ue)})(ue),be})(A,g.track,Y.energyScore);ee.addSample(X),ee.active&&(v.data=R.frame.buffer,E.enqueue(v))})(e,h,f):t.enableMetadata||t.enablePts?(function(g,v,E,C){const R=new DataView(g.data),A=R.getUint8(0);let B;if((128&A)!=0&&A!==71){const X=(function(Y){if(Y.byteLength<=0)return[];const ee=[];let ue=0;for(;ue<Y.byteLength;){const ne=(128&Y.getUint8(ue))>>7,be=127&Y.getUint8(ue);if(!(ne&&ue+4<=Y.byteLength)){ue++;break}{const Ae=Y.getUint32(ue,!1),Ue=(16776192&Ae)>>10,He=1023&Ae;ee.push({pt:be,ts_offset:Ue,length:He,data:new Uint8Array}),ue+=4}}let de=Y.byteLength-ue;for(const ne of ee){if(ne.length>de)return console.warn("Broken red payload"),[];ne.length>0&&(ne.data=new Uint8Array(Y.buffer,Y.byteOffset+ue,ne.length),ue+=ne.length,de-=ne.length)}if(de>0){const ne={pt:ee.length>0?ee[ee.length-1].pt:0,ts_offset:0,length:de,data:new Uint8Array(Y.buffer,Y.byteOffset+ue,de)};ee.push(ne)}return ee})(R);if(X.length>0){const Y=(function(ee){let ue=0;for(let be=0;be<ee.length;be++)ue+=be<ee.length-1?4:1,ue+=ee[be].length;const de=new Uint8Array(ue);let ne=0;for(let be=0;be<ee.length;be++)if(be<ee.length-1){const Ae=(2147483648|(127&ee[be].pt)<<24|(262143&ee[be].ts_offset)<<10|1023&ee[be].length)>>>0;de[ne++]=Ae>>24&255,de[ne++]=Ae>>16&255,de[ne++]=Ae>>8&255,de[ne++]=255&Ae}else de[ne++]=127&ee[be].pt;for(const be of ee)de.set(be.data,ne),ne+=be.length;return de})(X.map((ee=>{const ue=new Uint8Array(ee.length);ue.set(ee.data);const de=PO(new DataView(ue.buffer));return de!=null&&de.frame&&(ee.data=de==null?void 0:de.frame),B=de,ee})));g.data=Y.buffer}}else B=PO(R),B&&(g.data=B.frame.buffer);if(v.enqueue(g),!B)return;const L=B.tlv.find((X=>X.tag===Nh.METADATA));L&&E&&L.value instanceof Uint8Array&&E(L.value);const U=B.tlv.find((X=>X.tag===Nh.AUDIO_64_BIT_PTS));U&&C&&U.value instanceof Uint8Array&&U.value.length==8&&C(new DataView(U.value.buffer).getBigUint64(0,!0))})(h,f,t.onMetadata,t.onPts):f.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=lT(),d=new MessageChannel;await new nt((f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);e.transform=h,await new nt((f=>c.onmessage=g=>{g.data==="started"&&f(void 0)})),d.port1.onmessage=f=>{var g;f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(k.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s)):f.data.metadata&&r.onMetadata?r.onMetadata(f.data.metadata):f.data.pts&&r.onPts&&r.onPts(f.data.pts)},r.worker=c}function s(){e.track.removeEventListener("ended",s),(function(c){const d=gT.get(c);if(d){(function(g){const v=k_.get(g);v&&(k_.delete(g),ol&&(ol.removeSpeakers([v]),k_.size===0&&(ol.destroy(),ol=null)))})(c),DV(c.track.id),gT.delete(c);try{var h,f;(h=d.controller)===null||h===void 0||h.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}gT.set(e,r),e.track.addEventListener("ended",s)},interceptLocalVideoFrame:async function(e,t){if(!vr().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(_T.has(e)||!e.track)return;const r={track:e.track};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(f){return void k.error("create video-encoded-streams error",f&&f.message)}const d=[];t.on("sei-to-send",(f=>{d.push(f)}));const h=new TransformStream({transform(f,g){r.controller||(r.controller=g),e.track&&e.track.id!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s));const v=MV(new Uint8Array(f.data)),E=d.shift();if(E){const C=(function(R,A,B){switch(B){case MO:return(function(L,U){const X=LV(U),Y=X.length,ee=Math.floor(Y/255),ue=Y%255,de=new Uint8Array(6+ee+1+Y+L.byteLength);de[0]=0,de[1]=0,de[2]=0,de[3]=1,de[4]=6,de[5]=101;let ne=0;for(;ne<ee;)de[6+ne]=255,ne++;return de[6+ne]=ue,ne++,de.set(X,6+ne),de.set(new Uint8Array(L),6+ne+Y),de.buffer})(R,A);case UO:return(function(L,U){const X=LV(U),Y=X.length,ee=Math.floor(Y/255),ue=Y%255,de=new Uint8Array(7+ee+1+Y+1+L.byteLength);de[0]=0,de[1]=0,de[2]=0,de[3]=1,de[4]=78,de[5]=1,de[6]=101;let ne=0;for(;ne<ee;)de[7+ne]=255,ne++;return de[7+ne]=ue,ne++,de.set(X,7+ne),ne+=Y,de[7+ne]=128,ne++,de.set(new Uint8Array(L),7+ne),de.buffer})(R,A);default:return null}})(f.data,E,v);C&&(f.data=C)}g.enqueue(f)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Us())return;{if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=lT(),d=new MessageChannel;await new nt((f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);e.transform=h,await new nt((f=>c.onmessage=g=>{g.data==="started"&&f(void 0)})),t.on("sei-to-send",(f=>{d.port1.postMessage({sei:f})})),d.port1.onmessage=f=>{var g;f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s))},r.worker=c}}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}const c=_T.get(e);if(c){_T.delete(e);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(f){k.warning(f&&f.message)}}}_T.set(e,r),e.track.addEventListener("ended",s)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!vr().supportWebRTCEncodedTransform)return void k.warning("browser not support video encoded transform");if(!e.track)return;if(bE.has(e)){const c=bE.get(e);return void(c&&(c.onSei=t.onSei))}const r={track:e.track,onSei:t.onSei};if(iu()){if(!e.createEncodedStreams)return void k.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void k.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,f){r.controller||(r.controller=f),e.track&&e.track.id!==r.track.id&&(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s));const g=(function(v,E){switch(E){case MO:return(function(C){const R=new DataView(C.data);let A=0;for(;A+4<C.data.byteLength;){if(R.getUint8(A+0)===0&&R.getUint8(A+1)===0&&R.getUint8(A+2)===0&&R.getUint8(A+3)===1&&R.getUint8(A+4)===6){let B=A+6,L=0,U=0;for(;(U=R.getUint8(B++))===255;)L+=255;L+=U;const X=jV(C.data,B,L);return new Uint8Array(X)}A++}return null})(v);case UO:return(function(C){const R=new DataView(C.data);let A=0;for(;A+5<C.data.byteLength;){if(R.getUint8(A+0)===0&&R.getUint8(A+1)===0&&R.getUint8(A+2)===0&&R.getUint8(A+3)===1&&R.getUint8(A+4)===78&&R.getUint8(A+5)===1&&R.getUint8(A+6)===101){let B=A+7,L=0,U=0;for(;(U=R.getUint8(B++))===255;)L+=255;L+=U;const X=jV(C.data,B,L);return new Uint8Array(X)}A++}return null})(v);default:return null}})(h,MV(new Uint8Array(h.data)));g&&r.onSei&&r.onSei(g),f.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Us()){if(typeof RTCRtpScriptTransform>"u")return void k.warning("browser not support RTCRtpScriptTransform");const c=lT(),d=new MessageChannel;await new nt((f=>c.onmessage=g=>{g.data==="registered"&&f(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);e.transform=h,await new nt((f=>c.onmessage=g=>{g.data==="started"&&f(void 0)})),d.port1.onmessage=f=>{var g;f.data.transformed&&e.track&&((g=e.track)===null||g===void 0?void 0:g.id)!==r.track.id?(k.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",s),r.track=e.track,r.track.addEventListener("ended",s)):f.data.sei&&r.onSei&&r.onSei(f.data.sei)},r.worker=c}function s(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",s)}(function(c){const d=bE.get(c);if(d){bE.delete(c);try{var h,f;(h=d.controller)===null||h===void 0||h.terminate(),(f=d.worker)===null||f===void 0||f.terminate()}catch(g){k.warning(g&&g.message)}}})(e)}bE.set(e,r),e.track.addEventListener("ended",s)}},Vie={name:"InterceptFrame",create:()=>Fie};cO(),Vr("PROCESS_ID","process-".concat(zr(8,""),"-").concat(zr(4,""),"-").concat(zr(4,""),"-").concat(zr(4,""),"-").concat(zr(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void k.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),r=Date.now();k.debug("Loading global parameters from cache",t),Object.keys(t).forEach((s=>{if(Object.prototype.hasOwnProperty.call(cn,s)){const{value:c,expires:d}=t[s];if(d&&d<=r)return;al[s]=c,cn[s]=c}}))}catch(t){k.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(al.AREAS)&&al.AREAS.length>0&&n1(al.AREAS,!0);const j8=(e,t,r)=>{k.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),Vr(e,t,r)};Lh(lie,!1),Lh(hie,!1),Lh(Hne,!1),Lh(Sie,!1),Lh(aie,!1),Lh(jie,!1),Lh(Uie,!1),Lh(Vie,!1);const zn=(function(e){const t=new _n,r=e,s={getListeners:t.getListeners.bind(t),on:(c,d)=>((function(h,f){h===hd.SECURITY_POLICY_VIOLATION&&m6(f,!0)})(c,d),t.on.bind(t)(c,d)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return f6(f6({},r),s)})({__TRACK_LIST__:S_,VERSION:xo,BUILD:uO,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:j8,getParameter:Z,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const r=await(async function(s){let c;return vr().supportUnifiedPlan?(s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"}),c=(await s.createOffer()).sdp):c=(await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c})(t);if(!r)return e;t.close(),t=null,e=(function(s){const c={video:[],audio:[]};return s.match(/ VP8/i)&&c.video.push("VP8"),s.match(/ VP9/i)&&c.video.push("VP9"),s.match(/ AV1/i)&&c.video.push("AV1"),s.match(/ H264/i)&&c.video.push("H264"),s.match(/ H265/i)&&c.video.push("H265"),s.match(/ opus/i)&&c.audio.push("OPUS"),s.match(/ PCMU/i)&&c.audio.push("PCMU"),s.match(/ PCMA/i)&&c.audio.push("PCMA"),s.match(/ G722/i)&&c.audio.push("G722"),c})(r)}catch(t){throw new Ce(J.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=ft.reportApiInvoke(null,{name:In.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:un.TRACER});let t=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;t=!!(d&&h&&f),t&&zI()&&j4(75)&&new d().close()}catch(d){return k.error("check system requirement failed: ",d),!1}let r=!1;const s=fr();s.name===br.CHROME&&Number(s.version)>=58&&(nl.engine.name!=="WebKit"||(function(){const d=fr();if(Kx()){if(d.os===ls.MAC_OS)return!0;if(d.os===ls.IOS){const h=nl.os.version&&nl.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1})())&&(r=!0),(s.name===br.FIREFOX&&Number(s.version)>=56||s.name===br.OPERA&&Number(s.version)>=45||s.name===br.SAFARI&&Number(s.version)>=11||s.name==="WebKit"&&(ii()||sc())&&s.osVersion&&Number(s.osVersion.split(".")[0])>=11||B4()||fr().name===br.QQ)&&(r=!0),k.debug("checkSystemRequirements, api:",t,"browser",r);const c=t&&r;return e.onSuccess(c),c},getDevices:function(e){return Xa.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Xa.getRecordingDevices(e)},getCameras:function(e){return Xa.getCamerasDevices(e)},getElectronScreenSources:j3,getPlaybackDevices:function(e){return Xa.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const r=zr(5,"client-"),s=ft.reportApiInvoke(null,{id:r,name:In.CREATE_CLIENT,options:[t],tag:un.TRACER});try{(function(c){ns(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),ns(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&ns(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Rs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&Y4(c.turnServer),c.httpRetryConfig!==void 0&&$4(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&$4(c.websocketRetryConfig)})(t)}catch(c){throw s.onError(c),c}return(U4(16,0)||GI(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",k.debug("browser not support vp9, force use vp8")),Vr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),s.onSuccess(),new Kne(pc(pc({forceWaitGatewayResponse:!0},t),{},{role:$e(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Z("CAMERA_CAPTURE_CONFIG"),r=zr(8,"track-cam-"),s=ft.reportApiInvoke(null,{id:r,tag:un.TRACER,name:In.CREATE_CAM_VIDEO_TRACK,options:[Qr({},e),t]});t&&(e.encoderConfig=t);const c=oT(e);let d=null;k.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{d=(await Ya({video:c},r)).getVideoTracks()[0]||null}catch(f){throw s.onError(f),f}if(!d){const f=new Ne(J.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(f),f.throw(k)}if(e.optimizationMode&&AO(r,d,e,oc(e.encoderConfig)),Z("USE_STANDARD_BITRATE_DEFAULT")){const f=oc(e.encoderConfig);e.encoderConfig=f,delete f.bitrateMax,delete f.bitrateMin}const h=new cT(d,e,c,e.scalabiltyMode?nT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return s.onSuccess(h.getTrackId()),k.info("create camera video success, trackId:",r),h},createCustomVideoTrack:function(e){const t=zr(8,"track-cus-"),r=ft.reportApiInvoke(null,{id:t,tag:un.TRACER,name:In.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});Z("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const s=new tn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?nT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Hr.CUSTOM_TRACK]);return r.onSuccess(s.getTrackId()),k.info("create custom video track success with config",e,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const r=typeof t=="object"?(function(R){return H3(R)})(t):void 0;r&&(t="auto");const s=zr(8,"track-scr-v-"),c=ft.reportApiInvoke(null,{id:s,tag:un.TRACER,name:In.CREATE_SCREEN_VIDEO_TRACK,options:[Qr({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const d=(function(R){const A={};R.screenSourceType&&(A.mediaSource=R.screenSourceType),R.extensionId&&iu()&&(A.extensionId=R.extensionId);const{displaySurface:B,selfBrowserSurface:L,surfaceSwitching:U,systemAudio:X,preferCurrentTab:Y}=R;(f_(107)||WI(107)||HI(93))&&(B&&(ns(B,"displaySurface",["browser","window","monitor"]),A.displaySurface=B),L?(ns(L,"selfBrowserSurface",["exclude","include"]),A.selfBrowserSurface=L):A.selfBrowserSurface="include",U&&(ns(U,"surfaceSwitching",["exclude","include"]),A.surfaceSwitching=U)),(f_(105)||WI(105)||HI(91))&&X&&(ns(X,"systemAudio",["exclude","include"]),A.systemAudio=X),(f_(94)||WI(94)||HI(80))&&Y&&(A.preferCurrentTab=!0),R.electronScreenSourceId&&(A.sourceId=R.electronScreenSourceId);const ee=R.encoderConfig?_O(R.encoderConfig):null;return A.mandatory={chromeMediaSource:"desktop",maxWidth:ee?ee.width:void 0,maxHeight:ee?ee.height:void 0},ee&&(ee.frameRate&&(typeof ee.frameRate=="number"?(A.mandatory.maxFrameRate=ee.frameRate,A.mandatory.minFrameRate=ee.frameRate):(A.mandatory.maxFrameRate=ee.frameRate.max||ee.frameRate.ideal||ee.frameRate.exact||void 0,A.mandatory.minFrameRate=ee.frameRate.min||ee.frameRate.ideal||ee.frameRate.exact||void 0),A.frameRate=ee.frameRate),ee.width&&(A.width=ee.width),ee.height&&(A.height=ee.height)),A})(e);let h=null,f=null;const g=vr();if(!g.supportShareAudio&&t==="enable"){const R=new Ne(J.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(R),R.throw(k)}k.info("start create screen video track with config",e,"withAudio",t,"trackId",s);const v=g.supportShareAudio&&t!=="disable";try{const R=await Ya({screen:d,screenAudio:v?r||!0:void 0},s);h=R.getVideoTracks()[0]||null,f=R.getAudioTracks()[0]||null}catch(R){throw c.onError(R),R}if(!h){const R=new Ne(J.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(R),R.throw(k)}if(!f&&t==="enable"){h&&h.stop();const R=new Ne(J.SHARE_AUDIO_NOT_ALLOWED);return c.onError(R),R.throw(k)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(AO(s,h,e,e.encoderConfig&&_O(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const E=new tn(h,e.encoderConfig?_O(e.encoderConfig):{},e.scalabiltyMode?nT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[Hr.SCREEN_TRACK]);if(!f)return c.onSuccess(E.getTrackId()),k.info("create screen video track success","video:",E.getTrackId()),E;const C=new Nn(f,void 0,zr(8,"track-scr-a-"),!1);return c.onSuccess([E.getTrackId(),C.getTrackId()]),k.info("create screen video track success","video:",E.getTrackId(),"audio:",C.getTrackId()),[E,C]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=Z("CAMERA_CAPTURE_CONFIG"),s=zr(8,"track-mic-"),c=zr(8,"track-cam-"),d=ft.reportApiInvoke(null,{id:"".concat(s,"-").concat(c),tag:un.TRACER,name:In.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);const h=oT(t),f=K3(e);let g=null,v=null;k.info("start create camera video track(".concat(c,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const R=await Ya({audio:f,video:h},"".concat(s,"-").concat(c));g=R.getAudioTracks()[0],v=R.getVideoTracks()[0]}catch(R){throw d.onError(R),R}if(!g||!v){const R=new Ne(J.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(R),R.throw(k)}if(t.optimizationMode&&AO(c,v,t,oc(t.encoderConfig)),Z("USE_STANDARD_BITRATE_DEFAULT")){const R=oc(t.encoderConfig);t.encoderConfig=R,delete R.bitrateMax,delete R.bitrateMin}const E=new wE(g,e,f,s),C=new cT(v,t,h,t.scalabiltyMode?nT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return d.onSuccess([E.getTrackId(),C.getTrackId()]),k.info("create camera video track(".concat(c,") and microphone audio track(").concat(s,") success")),[E,C]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=zr(8,"track-mic-"),r=ft.reportApiInvoke(null,{id:t,tag:un.TRACER,name:In.CREATE_MIC_AUDIO_TRACK,options:[e]}),s=K3(e);let c=null;k.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{c=(await Ya({audio:s},t)).getAudioTracks()[0]||null}catch(h){throw r.onError(h),h}if(!c){const h=new Ne(J.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(h),h.throw(k)}const d=new wE(c,e,s,t);return r.onSuccess(d.getTrackId()),k.info("create microphone audio track success, trackId:",t),d},createCustomAudioTrack:function(e){const t=zr(8,"track-cus-"),r=ft.reportApiInvoke(null,{id:t,tag:un.TRACER,name:In.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),s=new Nn(e.mediaStreamTrack,e.encoderConfig?sT(e.encoderConfig):{},t,!1);return k.info("create custom audio track success with config",e,"trackId",s.getTrackId()),r.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:r,encoderConfig:s}=e;let{source:c}=e;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":c,cacheOnlineFile:r,encoderConfig:s},h=zr(8,"track-buf-"),f=ft.reportApiInvoke(null,{id:h,tag:un.TRACER,name:In.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(Z("DISABLE_WEBAUDIO"))throw new Ne(J.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");k.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await(async function(C,R){let A=null;if(typeof C=="string"){const L=kF.get(C);if(L)return k.debug("use cached audio resource: ",C),L;try{A=(await il((()=>qi.get(C,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(U){throw new Ne(J.FETCH_AUDIO_FILE_FAILED,U.toString())}}else A=await new nt(((U,X)=>{const Y=new FileReader;Y.onload=ee=>{ee.target?U(ee.target.result):X(new Ne(J.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{X(new Ne(J.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(C)}));const B=await(function(L){const U=N_();return new nt(((X,Y)=>{U.decodeAudioData(L,(ee=>{X(ee)}),(ee=>{Y(new Ne(J.DECODE_AUDIO_FILE_FAILED,ee.toString()))}))}))})(A);return typeof C=="string"&&R&&kF.set(C,B),B})(c,r)}catch(C){return f.onError(C),C.throw(k)}const v=new pre(c),E=new hre(g,v,s?sT(s):{},h);return k.info("create buffer source audio track success, trackId:",h),f.onSuccess(E.getTrackId()),E},setAppType:function(e){if(k.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw k.debug("Invalid appType"),new Ce(J.INVALID_PARAMS,"invalid app type",e);Vr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){k.setLogLevel(e)},enableLogUpload:function(){Z("USE_NEW_LOG")?Vr("UPLOAD_LOG",!0):k.enableLogUpload()},disableLogUpload:function(){Z("USE_NEW_LOG")?Vr("UPLOAD_LOG",!1):k.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new j5},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=ft.reportApiInvoke(null,{tag:un.TRACER,name:In.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Nn||e instanceof O_)){const g=new Ce(J.INVALID_TRACK,"the parameter is not a audio track");return r.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const s=e instanceof Nn?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let d=c,h=c;const f=Date.now();return new nt((g=>{const v=setInterval((()=>{const E=e.getVolumeLevel();d=E>d?E:d,h=E<h?E:h;const C=d-h>1e-4,R=Date.now()-f;if(C||R>t){clearInterval(v);const A=C,B={duration:R,deviceLabel:s,maxVolumeLevel:d,result:A};k.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(B))),r.onSuccess(B),g(A)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=ft.reportApiInvoke(null,{tag:un.TRACER,name:In.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof tn||e instanceof I_)){const C=new Ce(J.INVALID_TRACK,"the parameter is not a video track");return r.onError(C),C.throw()}t&&t<1e3&&(t=1e3);const s=e instanceof tn?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Us()||Kx())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let f=0,g=0;try{const C=Date.now();f=await(function(R,A,B,L){let U,X=0,Y=null;return new nt(((ee,ue)=>{function de(){X>L&&U&&(U(),ee(X));const ne=B.getContext("2d");if(!ne){const Ue=new Ce(J.UNEXPECTED_ERROR,"can not get canvas 2d context.");return k.error(Ue.toString()),void ue(Ue)}ne.drawImage(R,0,0,160,120);const be=ne.getImageData(0,0,B.width,B.height),Ae=Math.floor(be.data.length/3);if(Y){for(let Ue=0;Ue<Ae;Ue+=3)if(be.data[Ue]!==Y[Ue])return X+=1,void(Y=be.data);Y=be.data}else Y=be.data}setTimeout((()=>{U&&(U(),ee(X))}),A),U=bO((()=>{de()}),30)}))})(d,t,h,4),g=Date.now()-C}catch(C){throw r.onError(C),C}kne===br.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=f>4,E={duration:g,changedPicNum:f,deviceLabel:s,result:v};return k.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),r.onSuccess(E),v},setArea:n1,audioElementPlayCenter:Gi,resumeAudioContext:function(){Gi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){$ne.processExternalMediaAEC(e)},registerExtensions:function(e){const t=Z("PLUGIN_INFO")||[];e.forEach((r=>{"name"in r&&!$e(t).call(t,r.name)&&t.push(r.name);const s=r;s.__registered__=!0,s.logger.hookLog=k.extLog,s.reporter.hookApiInvoke=ft.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach((c=>{s.parameters[c]=Z(c)}))})),j8("PLUGIN_INFO",t)},ChannelMediaRelayError:D_,ChannelMediaRelayEvent:lu,ChannelMediaRelayState:ca,RemoteStreamFallbackType:ire,RemoteStreamType:sre,ConnectionDisconnectedReason:Pr,AudienceLatencyLevelType:jte,AREAS:Cr,preload:async function(e,t,r,s){return iB(e,t,r,s)}});return Object.defineProperties(zn,{onAudioAutoplayFailed:{get:()=>Ja.onAudioAutoplayFailed,set:e=>{Ja.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ja.onAutoplayFailed,set:e=>{Ja.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>zn._onSecurityPolicyViolation,set(e){zn._onSecurityPolicyViolation=e,m6(e)}},__CLIENT_LIST__:{get:()=>Z("SHOW_GLOBAL_CLIENT_LIST")?Mf:[]}}),Xa.on(Pf.CAMERA_DEVICE_CHANGED,(e=>{k.info("camera device changed",JSON.stringify(e)),zn.onCameraChanged&&zn.onCameraChanged(e),zn.safeEmit(hd.CAMERA_CHANGED,e)})),Xa.on(Pf.RECORDING_DEVICE_CHANGED,(e=>{k.info("microphone device changed",JSON.stringify(e)),zn.onMicrophoneChanged&&zn.onMicrophoneChanged(e),zn.safeEmit(hd.MICROPHONE_CHANGED,e)})),Xa.on(Pf.PLAYOUT_DEVICE_CHANGED,(e=>{k.debug("playout device changed",JSON.stringify(e)),zn.onPlaybackDeviceChanged&&zn.onPlaybackDeviceChanged(e),zn.safeEmit(hd.PLAYBACK_DEVICE_CHANGED,e)})),Gi.onAutoplayFailed=()=>{k.info("detect audio element autoplay failed"),Ja.onAudioAutoplayFailed&&Ja.onAudioAutoplayFailed()},Br.on("autoplay-failed",(()=>{k.info("detect webaudio autoplay failed"),Ja.onAudioAutoplayFailed&&Ja.onAudioAutoplayFailed(),zn.safeEmit(hd.AUTOPLAY_FAILED)})),Br.on(Is.STATE_CHANGE,((e,t)=>{k.info("audio context state changed: ".concat(t," => ").concat(e)),zn.onAudioContextStateChanged&&zn.onAudioContextStateChanged(e,t),zn.safeEmit(hd.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),Un.on(g_.NETWORK_STATE_CHANGE,((e,t)=>{k.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=zn),zn}))})(JC)),JC.exports}var Nwe=Rwe();const QC=Qw(Nwe);async function qy(i,n){const a="https://qaffpsbiciegxxonsxzl.functions.supabase.co";try{const l=a?`${a}/generateagoratoken`:"/api/generateagoratoken";return await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channelName:i,uid:n})})).json().catch(()=>({}))||{}}catch{return{}}}const Awe=Object.freeze(Object.defineProperty({__proto__:null,getAgoraToken:qy},Symbol.toStringTag,{value:"Module"}));function mY({username:i,onComplete:n}){const[a,l]=M.useState(!0);return M.useEffect(()=>{const u=setTimeout(()=>{l(!1),n&&n()},3e3);return()=>clearTimeout(u)},[n]),o.jsx(E2,{children:a&&o.jsxs(Xi.div,{initial:{opacity:0,scale:.5,y:-50},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.5,y:-50},transition:{duration:.5,ease:"easeOut"},className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50",children:[o.jsx("div",{className:"bg-gradient-to-r from-emerald-500 via-green-500 to-emerald-500 text-white px-8 py-4 rounded-full shadow-2xl shadow-emerald-500/50 border-2 border-emerald-300",children:o.jsxs(Xi.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.3,type:"spring",stiffness:200},className:"flex items-center space-x-3",children:[o.jsx(Xi.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-6 h-6 bg-white/20 rounded-full flex items-center justify-center",children:o.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})}),o.jsx("span",{className:"text-lg font-bold",children:i?`${i} entered!`:"Welcome!"}),o.jsx(Xi.div,{animate:{rotate:-360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-6 h-6 bg-white/20 rounded-full flex items-center justify-center",children:o.jsx("div",{className:"w-3 h-3 bg-white rounded-full"})})]})}),o.jsx(Xi.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((u,m)=>o.jsx(Xi.div,{initial:{scale:0,opacity:0},animate:{scale:[0,1,0],opacity:[0,1,0],x:Math.cos(m*60*Math.PI/180)*100,y:Math.sin(m*60*Math.PI/180)*100},transition:{delay:.5+m*.1,duration:1,ease:"easeOut"},className:"absolute top-1/2 left-1/2 w-2 h-2 bg-yellow-300 rounded-full",style:{transform:"translate(-50%, -50%)"}},m))})]})})}async function gY(i,n,a,l,u=null,m=null){try{const{data:y,error:w}=await K.from("notifications").insert({user_id:i,type:n,title:a,message:l,related_user_id:u,link_url:m,is_read:!1,created_date:new Date().toISOString()}).select().single();if(w)throw w;return y}catch(y){throw console.error("Error creating notification:",y),y}}async function Iwe(i,n,a,l,u,m){try{return await gY(i,"gift_received",`${n} sent you ${u} ${l}!`,`You received ${m} coins from ${n}`,a,`/#/profile/${a}`)}catch(y){throw console.error("Error notifying gift received:",y),y}}async function Owe(i,n,a,l,u){try{const m=u>0?`${n} sent you a message and paid ${u} coins`:`${n} sent you a message`;return await gY(i,"message",` New message from ${n}`,m,a,"/#/messages")}catch(m){throw console.error("Error notifying message received:",m),m}}const rD=[{id:"dog",name:"Dog",value:10,category:"animal",emoji:"",color:"#8B4513"},{id:"cat",name:"Cat",value:15,category:"animal",emoji:"",color:"#FF8C00"},{id:"bird",name:"Bird",value:5,category:"animal",emoji:"",color:"#DAA520"},{id:"fish",name:"Fish",value:8,category:"animal",emoji:"",color:"#FF69B4"},{id:"rabbit",name:"Rabbit",value:12,category:"animal",emoji:"",color:"#FFB6C1"},{id:"horse",name:"Horse",value:50,category:"animal",emoji:"",color:"#8B4513"},{id:"lion",name:"Lion",value:100,category:"animal",emoji:"",color:"#FFD700"},{id:"penguin",name:"Penguin",value:20,category:"animal",emoji:"",color:"#000000"},{id:"car",name:"Sports Car",value:500,category:"vehicle",emoji:"",color:"#FF0000"},{id:"yacht",name:"Yacht",value:2e3,category:"vehicle",emoji:"",color:"#4169E1"},{id:"helicopter",name:"Helicopter",value:1500,category:"vehicle",emoji:"",color:"#A9A9A9"},{id:"rocket",name:"Rocket",value:5e3,category:"vehicle",emoji:"",color:"#FF6347"},{id:"house",name:"House",value:1e3,category:"property",emoji:"",color:"#DC143C"},{id:"mansion",name:"Mansion",value:5e3,category:"property",emoji:"",color:"#FFD700"},{id:"island",name:"Private Island",value:1e4,category:"property",emoji:"",color:"#32CD32"},{id:"castle",name:"Castle",value:8e3,category:"property",emoji:"",color:"#D2691E"},{id:"coin_bag",name:"Coin Bag",value:100,category:"currency",emoji:"",color:"#FFD700"},{id:"money_stack",name:"Money Stack",value:500,category:"currency",emoji:"",color:"#228B22"},{id:"diamond",name:"Diamond",value:2e3,category:"currency",emoji:"",color:"#00CED1"},{id:"gold_bar",name:"Gold Bar",value:3e3,category:"currency",emoji:"",color:"#FFD700"},{id:"crown",name:"Crown",value:1e3,category:"luxury",emoji:"",color:"#FFD700"},{id:"ring",name:"Diamond Ring",value:800,category:"luxury",emoji:"",color:"#FF1493"},{id:"watch",name:"Luxury Watch",value:1200,category:"luxury",emoji:"",color:"#C0C0C0"},{id:"champagne",name:"Champagne",value:300,category:"luxury",emoji:"",color:"#FFD700"},{id:"pizza",name:"Pizza",value:25,category:"food",emoji:"",color:"#FF8C00"},{id:"cake",name:"Cake",value:30,category:"food",emoji:"",color:"#FFB6C1"},{id:"burger",name:"Burger",value:20,category:"food",emoji:"",color:"#8B4513"},{id:"troll_gift",name:"Troll Gift",value:1,category:"troll",emoji:"",color:"#9370DB"}];function kwe(i=30){return[...rD].sort(()=>Math.random()-.5).slice(0,Math.min(i,rD.length))}function _Y(i){return rD.find(n=>n.id===i)}async function Pwe(i,n,a,l,u){const m=_Y(l);if(!m)throw new Error("Gift not found");const y=new Date().toISOString(),{data:w,error:b}=await i.from("stream_gifts").insert({sender_id:n,recipient_id:a,stream_id:u,gift_id:l,gift_name:m.name,coin_value:m.value,created_date:y}).select().single();if(b)throw console.error("Failed to record gift transaction:",b),b;try{await Iwe(a,n,m.name,m.value,u)}catch(x){console.error("Failed to send gift notification:",x)}return w}const Dwe=({userId:i,streamId:n,streamerId:a,streamerName:l,onGiftSent:u})=>{const m=Wn(),[y,w]=M.useState(!1),[b,x]=M.useState([]),[T,N]=M.useState(null),[O,P]=M.useState(!1),F=()=>{const V=kwe(30);x(V),w(!0)},z=async V=>{if(!i){pe.error("Please log in first");return}if(!n){pe.error("Stream not found");return}P(!0);try{const{data:W,error:te}=await K.from("profiles").select("coins, purchased_coins, free_coins").eq("id",i).single();if(te)throw te;let $;try{if($=await $D(i,V.value,{reason:"gift_sent",source:"stream_gift",reference:n}),$.needsStoreRedirect){pe.error("Insufficient coins. Redirecting to store..."),setTimeout(()=>m("/store"),2e3),P(!1);return}}catch{if(((W==null?void 0:W.coins)||0)<V.value){pe.error(`Insufficient coins. Need ${V.value}, you have ${(W==null?void 0:W.coins)||0}`),P(!1);return}await WR(i,V.value,{reason:"gift_sent",source:"stream_gift"})}await Pwe(K,i,a,V.id,n),pe.success(`${V.emoji} Sent ${V.name} to ${l}!`),N(null),u&&u({gift:V,userId:i,timestamp:new Date}),setTimeout(()=>{w(!1),x([])},500)}catch(W){console.error("Gift send error:",W),pe.error(W.message||"Failed to send gift")}finally{P(!1)}};return o.jsxs(o.Fragment,{children:[o.jsxs(ke,{onClick:F,className:"bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2",children:[o.jsx(jy,{className:"w-5 h-5"}),"Gifts"]}),y&&o.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:o.jsxs(Fe,{className:"bg-[#1a1a2e] border-purple-500/50 max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[o.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-purple-500/30 sticky top-0 bg-[#1a1a2e]",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(jy,{className:"w-6 h-6 text-pink-500"}),o.jsxs("h2",{className:"text-2xl font-bold text-white",children:["Send a Gift to ",l]})]}),o.jsx("button",{onClick:()=>{w(!1),N(null),x([])},className:"text-gray-400 hover:text-white",children:o.jsx(Oc,{className:"w-6 h-6"})})]}),o.jsx("div",{className:"p-6",children:T?o.jsxs("div",{className:"text-center space-y-6",children:[o.jsx("div",{className:"text-8xl",children:T.emoji}),o.jsx("h3",{className:"text-3xl font-bold text-white",children:T.name}),o.jsxs("div",{className:"bg-purple-500/20 rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 mb-2",children:"Cost:"}),o.jsxs("p",{className:"text-4xl font-bold text-purple-400",children:[T.value," "]})]}),o.jsxs("div",{className:"flex gap-4 justify-center",children:[o.jsx(ke,{onClick:()=>z(T),disabled:O,className:"bg-green-600 hover:bg-green-700 text-white font-bold px-8 py-6 text-lg",children:O?"Sending...":"Send Gift"}),o.jsx(ke,{onClick:()=>N(null),disabled:O,variant:"outline",className:"px-8 py-6",children:"Back"})]})]}):o.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-4",children:b.map(V=>o.jsxs("button",{onClick:()=>N(V),className:"group relative p-4 bg-[#0f0f1a] rounded-lg hover:bg-purple-500/20 transition-all duration-200 border border-purple-500/20 hover:border-purple-500/60",children:[o.jsx("div",{className:"text-5xl mb-2 group-hover:scale-110 transition-transform duration-200",children:V.emoji}),o.jsx("p",{className:"text-xs font-bold text-white truncate",children:V.name}),o.jsxs("p",{className:"text-xs text-purple-400 font-bold mt-1",children:[V.value," "]}),o.jsx("div",{className:"absolute inset-0 rounded-lg bg-gradient-to-t from-purple-500/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold",children:"Select"})})]},V.id))})}),o.jsx("div",{className:"border-t border-purple-500/30 p-4 bg-blue-500/10",children:o.jsx("p",{className:"text-xs text-gray-400",children:" Tip: Gifts are displayed on stream for 4 seconds and visible to all viewers and the broadcaster!"})})]})})]})},jwe=({userId:i,streamId:n,className:a=""})=>{const[l,u]=M.useState(!1),m=vn(),{data:y}=mt({queryKey:["streamLike",n,i],queryFn:async()=>{if(!i||!n)return!1;const{data:x,error:T}=await K.from("stream_likes").select("id").eq("user_id",i).eq("stream_id",n).single();return T?!1:!!x},enabled:!!i&&!!n,refetchInterval:5e3}),w=Wt({mutationFn:async()=>{if(!i)throw new Error("Please log in first");if(!n)throw new Error("Stream not found");if(y){const{error:x}=await K.from("stream_likes").delete().eq("user_id",i).eq("stream_id",n);if(x)throw x;return{liked:!1}}else{const{error:x}=await K.from("stream_likes").insert({user_id:i,stream_id:n});if(x)throw x;return{liked:!0}}},onSuccess:x=>{m.invalidateQueries({queryKey:["streamLike",n,i]}),m.invalidateQueries({queryKey:["streamLikeCount",n]})},onError:x=>{console.error("Like error:",x),pe.error("Failed to like stream")}}),b=()=>{u(!0),w.mutate(),setTimeout(()=>u(!1),300)};return o.jsxs(ke,{onClick:b,disabled:w.isPending,className:`flex items-center gap-2 transition-all duration-200 ${y?"bg-red-600 hover:bg-red-700 text-white":"bg-gray-700 hover:bg-gray-600 text-white"} ${l?"scale-110":"scale-100"} ${a}`,children:[o.jsx(Ru,{className:`w-5 h-5 transition-all duration-200 ${y?"fill-current":"fill-none"} ${l?"scale-125":"scale-100"}`}),"Like"]})},Lwe=({streamerId:i,streamId:n})=>{const[a,l]=M.useState({coinsEarned:0,likeCount:0,followerCount:0}),{data:u}=mt({queryKey:["streamerProfile",i],queryFn:async()=>{if(!i)return null;const{data:w,error:b}=await K.from("profiles").select("id, username, coins, follower_count, stream_coins_earned, like_count").eq("id",i).single();return b?(console.warn("Error fetching profile:",b),null):w},enabled:!!i,refetchInterval:2e3}),{data:m=0}=mt({queryKey:["streamLikeCount",n],queryFn:async()=>{if(!n)return 0;const{count:w,error:b}=await K.from("stream_likes").select("*",{count:"exact",head:!0}).eq("stream_id",n);return b?(console.warn("Error fetching likes:",b),0):w||0},enabled:!!n,refetchInterval:3e3}),{data:y=0}=mt({queryKey:["streamCoinsEarned",n],queryFn:async()=>{if(!n)return 0;const{data:w,error:b}=await K.from("stream_gifts").select("coin_value").eq("stream_id",n);return b?(console.warn("Error fetching stream gifts:",b),0):(w||[]).reduce((x,T)=>x+(T.coin_value||0),0)},enabled:!!n,refetchInterval:2e3});return M.useEffect(()=>{u&&l({coinsEarned:y,likeCount:m,followerCount:u.follower_count||0})},[u,m,y]),u?o.jsxs("div",{className:"grid grid-cols-3 gap-3 w-full",children:[o.jsxs(Fe,{className:"bg-gradient-to-br from-purple-600/40 to-purple-900/40 border-purple-500/50 p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(ni,{className:"w-5 h-5 text-yellow-400"}),o.jsx("span",{className:"text-xs text-gray-300 font-semibold",children:"Coins (This Stream)"})]}),o.jsx("p",{className:"text-2xl font-bold text-yellow-300",children:a.coinsEarned.toLocaleString()}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Total: ",(u.stream_coins_earned||0).toLocaleString()]})]}),o.jsxs(Fe,{className:"bg-gradient-to-br from-red-600/40 to-red-900/40 border-red-500/50 p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(Ru,{className:"w-5 h-5 text-red-400 fill-current"}),o.jsx("span",{className:"text-xs text-gray-300 font-semibold",children:"Likes"})]}),o.jsx("p",{className:"text-2xl font-bold text-red-300",children:a.likeCount.toLocaleString()}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Profile: ",(u.like_count||0).toLocaleString()]})]}),o.jsxs(Fe,{className:"bg-gradient-to-br from-blue-600/40 to-blue-900/40 border-blue-500/50 p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(jn,{className:"w-5 h-5 text-blue-400"}),o.jsx("span",{className:"text-xs text-gray-300 font-semibold",children:"Followers"})]}),o.jsx("p",{className:"text-2xl font-bold text-blue-300",children:a.followerCount.toLocaleString()}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["You have ",a.followerCount," followers"]})]})]}):null},Mwe=({gift:i,senderName:n,duration:a=4e3})=>{const[l,u]=M.useState(!0);if(M.useEffect(()=>{const y=setTimeout(()=>{u(!1)},a);return()=>clearTimeout(y)},[a]),!l)return null;const m=_Y(i.id)||i;return o.jsxs("div",{className:"fixed top-20 right-6 z-40 animate-bounce",style:{animation:`slideInRight 0.5s ease-out, slideOutRight 0.5s ease-out ${a-500}ms`,animationFillMode:"forwards"},children:[o.jsx("style",{children:`
        @keyframes slideInRight {
          from {
            opacity: 0;
            transform: translateX(200px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        
        @keyframes slideOutRight {
          from {
            opacity: 1;
            transform: translateX(0);
          }
          to {
            opacity: 0;
            transform: translateX(200px);
          }
        }
      `}),o.jsx("div",{className:"bg-gradient-to-br from-purple-600 to-pink-600 rounded-2xl p-6 shadow-2xl border-2 border-yellow-400 max-w-xs",children:o.jsxs("div",{className:"text-center space-y-3",children:[o.jsx("div",{className:"text-8xl animate-bounce",style:{animationDelay:"0s"},children:m.emoji}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("p",{className:"text-white font-bold text-lg",children:[n||"A Troller"," sent a gift!"]}),o.jsx("p",{className:"text-2xl font-bold text-yellow-300",children:m.name}),o.jsxs("p",{className:"text-sm text-gray-100",children:["Worth ",m.value," coins! "]})]}),o.jsxs("div",{className:"flex justify-center gap-2 text-2xl",children:[o.jsx("span",{className:"animate-pulse",children:""}),o.jsx("span",{className:"animate-pulse",style:{animationDelay:"0.2s"},children:""}),o.jsx("span",{className:"animate-pulse",style:{animationDelay:"0.4s"},children:""})]})]})})]})},yY=({appId:i,channelName:n,token:a,uid:l,isStreamer:u,stream:m,isApprovedCoHost:y})=>{var vt,pt,er;const w=Wn(),b=M.useRef(null),x=M.useRef({audio:null,video:null}),T=M.useRef({}),N=M.useRef(null),O=M.useRef(new Set),P=M.useRef(!1),[F,z]=M.useState(null),[V,W]=M.useState(null),[te,$]=M.useState(!1),[Q,G]=M.useState(null),[se,ie]=M.useState([]),ce=new URLSearchParams(window.location.search),Se=ce.get("id")||ce.get("streamId"),{data:oe}=mt({queryKey:["currentUser"],queryFn:ib,retry:!1,staleTime:1e4}),{data:ve}=mt({queryKey:["streamByIdOrStreamer",Se],queryFn:async()=>{if(!Se)return null;let gt=await K.entities.Stream.filter({id:Se},void 0,1),qe=(gt==null?void 0:gt[0])||null;return qe||(gt=await K.entities.Stream.filter({streamer_id:Se},"-created_at",1),(gt==null?void 0:gt[0])||null)},enabled:!!Se,initialData:null,staleTime:3e3,refetchInterval:5e3}),he=m||ve,Ze=!!(oe&&he&&oe.id===he.streamer_id),Qe=!!(u||Ze),me=!!((oe==null?void 0:oe.user_role)==="admin"||(oe==null?void 0:oe.role)==="admin"||oe!=null&&oe.is_troll_officer||(vt=oe==null?void 0:oe.permissions)!=null&&vt.includes("moderate_chat")||(pt=oe==null?void 0:oe.permissions)!=null&&pt.includes("kick_users")||(er=oe==null?void 0:oe.permissions)!=null&&er.includes("ban_users")||Ze),ye=i||Q||"7b95b64b0e154f7ab931e2abf000e694",ge=n||(he==null?void 0:he.agora_channel_name)||(he==null?void 0:he.agora_channel_name)||(he==null?void 0:he.agora_channel),Ee=a||(he==null?void 0:he.agora_token);M.useEffect(()=>{W(Ee||null)},[Ee]);const Oe=l||(oe==null?void 0:oe.id)||0,we=async()=>{var qe,Wr,en,Cn;if(!ge){console.warn("[Agora] Missing credentials:",{effectiveAppId:ye,effectiveChannelName:ge});return}$(!0);const gt=QC.createClient({mode:"live",codec:"vp8"});b.current=gt,gt.on("user-published",async(Lr,Le)=>{if(console.log("[Agora] user-published:",Lr.uid,Le),!gt||gt.connectionState!=="CONNECTED"){console.warn(" Skipping subscribe  invalid connection state:",gt.connectionState);return}try{if(await gt.subscribe(Lr,Le),console.log("[Agora] subscribed to user:",Lr.uid),Le==="video"){const it=document.createElement("div");it.id=`remote-${Lr.uid}`,it.style.cssText=`
            width: 100%;
            height: 100%;
            min-height: 200px;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
          `,N.current.appendChild(it),Lr.videoTrack.play(it)}Le==="audio"&&Lr.audioTrack&&Lr.audioTrack.play(),T.current[Lr.uid]=Lr}catch(it){console.error(" Failed to subscribe:",it)}}),gt.on("user-unpublished",Lr=>{console.log("[Agora] user-unpublished:",Lr.uid);const Le=document.getElementById(`remote-${Lr.uid}`);Le&&Le.remove(),delete T.current[Lr.uid]}),gt.on("connection-state-change",(Lr,Le)=>{console.log(`[Agora] Connection state changed: ${Le} -> ${Lr}`)});try{let Lr=V,Le=ye;if(!Lr)try{const it=await qy(ge,Oe);Lr=(it==null?void 0:it.token)??(it==null?void 0:it.rtcToken)??((qe=it==null?void 0:it.data)==null?void 0:qe.token)??null,Le=Le||(it==null?void 0:it.appId)||(it==null?void 0:it.agoraAppId)||((Wr=it==null?void 0:it.data)==null?void 0:Wr.appId)||null,Lr&&W(Lr),Le&&G(Le)}catch(it){console.warn("[Agora] Initial token fetch failed:",it)}if(!Le){console.warn("[Agora] Missing App ID  set VITE_AGORA_APP_ID or return 'appId' from token API."),$(!1);return}if(await gt.join(Le,ge,Lr,Oe),console.log("[Agora] Joined channel:",ge),$(!1),u||y){const[it,jt]=await QC.createMicrophoneAndCameraTracks();x.current={audio:it,video:jt},await gt.publish(Object.values(x.current));const xt=document.createElement("div");xt.id="local-streamer",xt.style.cssText=`
          width: 100%;
          height: 100%;
          min-height: 200px;
          background: #000;
          border-radius: 8px;
          overflow: hidden;
          position: relative;
          grid-column: 1 / -1;
        `,N.current.appendChild(xt),jt.play(xt),console.log("[Agora] Local tracks published")}}catch(Lr){console.error("[Agora] Join error:",Lr);const Le=String((Lr==null?void 0:Lr.message)||"").toUpperCase(),it=Number(Lr==null?void 0:Lr.code);if(Le.includes("DYNAMIC_KEY_EXPIRED")||Le.includes("TOKEN_EXPIRED")||it===109){console.warn("[Agora] Token expired, attempting to refresh token...");try{const xt=await qy(ge,Oe),Tr=(xt==null?void 0:xt.token)??(xt==null?void 0:xt.rtcToken)??((en=xt==null?void 0:xt.data)==null?void 0:en.token)??null,An=(xt==null?void 0:xt.appId)||(xt==null?void 0:xt.agoraAppId)||((Cn=xt==null?void 0:xt.data)==null?void 0:Cn.appId)||ye;if(!Tr)console.warn("[Agora] No token returned from fallback token fetch.");else{if(W(Tr),An&&G(An),await gt.join(An,ge,Tr,Oe),console.log("[Agora] Re-joined channel after token refresh:",ge),u||y){const[En,on]=await QC.createMicrophoneAndCameraTracks();x.current={audio:En,video:on},await gt.publish(Object.values(x.current)),on.play(N.current),console.log("[Agora] Local tracks published (after refresh)")}$(!1)}}catch(xt){console.error("[Agora] Token refresh failed:",xt)}}$(!1)}},fe=async()=>{const gt=b.current;if(gt)try{console.log("[Agora] Cleaning up Agora client..."),gt.removeAllListeners(),Object.values(T.current).forEach(en=>{const Cn=document.getElementById(`remote-${en.uid}`);Cn&&Cn.remove()}),T.current={};const{audio:qe,video:Wr}=x.current;qe&&qe.close(),Wr&&Wr.close(),x.current={},await gt.leave(),console.log("[Agora] Left the channel cleanly")}catch(qe){console.error("Leave error:",qe)}finally{b.current=null}},De=(he==null?void 0:he.is_live)===!0||(he==null?void 0:he.is_live)==="true"||(he==null?void 0:he.is_live)===1||(he==null?void 0:he.status)==="live",{data:je}=mt({queryKey:["myStreamBan",he==null?void 0:he.id,oe==null?void 0:oe.id],queryFn:async()=>{if(!(he!=null&&he.streamer_id)||!(oe!=null&&oe.id))return null;const{data:gt,error:qe}=await K.from("user_stream_bans").select("*").eq("streamer_id",he.streamer_id).eq("user_id",oe.id).eq("is_active",!0).limit(1).single();return qe?null:gt||null},enabled:!!(he!=null&&he.streamer_id)&&!!(oe!=null&&oe.id),refetchInterval:5e3}),_e=!!je;M.useEffect(()=>{if(!Qe&&(De||!!ge)&&!0){if(_e){console.warn("[StreamViewer] User is banned from this stream, blocking join");return}const qe=setTimeout(()=>{we()},1e3);return()=>{clearTimeout(qe),fe()}}},[De,he==null?void 0:he.status,Qe,ye,ge,V]),M.useEffect(()=>{(async()=>{try{if(!(he!=null&&he.id)||!(oe!=null&&oe.id)||Qe||P.current)return;await K.entities.ChatMessage.create({stream_id:he.id,user_id:oe.id,username:oe.username||oe.full_name,message_type:"join"}),P.current=!0,console.log(" Sent join message for viewer:",oe.username||oe.full_name)}catch(qe){console.warn("Failed to send join message:",(qe==null?void 0:qe.message)||qe)}})()},[he==null?void 0:he.id,oe==null?void 0:oe.id,Qe]),M.useEffect(()=>{if(!(he!=null&&he.id)||!(oe!=null&&oe.id)||Qe)return;const gt=async()=>{try{await K.from("stream_viewers").upsert({stream_id:he.id,user_id:oe.id,last_heartbeat:new Date().toISOString()},{onConflict:"stream_id,user_id"})}catch(Wr){console.warn("Failed to update heartbeat:",Wr)}};gt();const qe=setInterval(gt,25e3);return()=>clearInterval(qe)},[he==null?void 0:he.id,oe==null?void 0:oe.id,Qe]);const Je=()=>{b.current&&(b.current.leave(),b.current=null),x.current&&(Object.values(x.current).forEach(gt=>{gt&&(gt.stop(),gt.close())}),x.current={audio:null,video:null}),Object.values(T.current).forEach(gt=>{gt.videoTrack&&gt.videoTrack.stop(),gt.audioTrack&&gt.audioTrack.stop()}),T.current={},N.current&&(N.current.innerHTML=""),w("/")},{data:st=[]}=mt({queryKey:["viewerStreamChat",he==null?void 0:he.id],queryFn:async()=>{if(!(he!=null&&he.id))return[];const{data:gt,error:qe}=await K.from("chat_messages").select("*").eq("stream_id",he.id).order("created_date",{ascending:!1}).limit(100);return qe?(console.warn("fetch viewer chat error:",qe.message),[]):gt||[]},initialData:[],refetchInterval:3e3,enabled:!!(he!=null&&he.id),staleTime:2e3});return M.useEffect(()=>{const gt=st.filter(Wr=>Wr.message_type==="join"&&!O.current.has(Wr.id));if(gt.length===0)return;const qe=gt[0];(async()=>{try{const{data:Wr,error:en}=await K.from("profiles").select("*").eq("id",qe.user_id).limit(1);if(en)throw en;const Cn=Array.isArray(Wr)?Wr[0]:null;Cn&&Cn.active_entrance_effect&&(z(Cn),O.current.add(qe.id),setTimeout(()=>z(null),4e3))}catch(Wr){console.error("viewer entrance effect lookup failed:",Wr)}})()},[st]),o.jsxs("div",{style:{width:"100%",height:"100%",background:"#000",display:"flex",flexDirection:"row"},children:[F&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:999999,pointerEvents:"none"},children:o.jsx(mY,{username:F.username||F.full_name,onComplete:()=>z(null)})}),se.map((gt,qe)=>o.jsx(Mwe,{gift:gt.gift,senderName:gt.senderName,duration:4e3},qe)),o.jsxs("div",{ref:N,id:"video-container",style:{flex:1,minHeight:0,display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"8px",padding:"8px",position:"relative"},children:[o.jsx("button",{onClick:Je,style:{position:"absolute",top:"16px",left:"16px",zIndex:50,backgroundColor:"rgba(220, 38, 38, 0.8)",color:"white",border:"none",borderRadius:"50%",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:gt=>gt.target.style.backgroundColor="rgba(220, 38, 38, 1)",onMouseLeave:gt=>gt.target.style.backgroundColor="rgba(220, 38, 38, 0.8)",children:o.jsx(Oc,{size:20})}),Qe&&he&&o.jsx("div",{style:{position:"absolute",top:16,left:16,zIndex:30,width:300},children:o.jsx(Lwe,{streamerId:he.streamer_id,streamId:he.id})}),o.jsx("p",{style:{color:"#fff"},children:te?"Connecting to live stream...":he==null?"Loading stream...":!ge||!ye?"Missing streaming credentials. Set VITE_AGORA_APP_ID or join with a valid channel.":De?"Connecting to live stream...":"Stream not live"})]}),o.jsx("div",{style:{width:360,borderLeft:"1px solid #222",background:"#0a0a0f",display:"flex",flexDirection:"column"},children:he?o.jsxs(o.Fragment,{children:[!Qe&&o.jsxs("div",{style:{padding:"12px",borderBottom:"1px solid #222",display:"flex",gap:"8px"},children:[o.jsx(Dwe,{userId:oe==null?void 0:oe.id,streamId:he.id,streamerId:he.streamer_id,streamerName:he.broadcaster_name||"Streamer",onGiftSent:gt=>{ie([...se,gt]),setTimeout(()=>{ie(qe=>qe.filter((Wr,en)=>en!==0))},4500)}}),o.jsx(jwe,{userId:oe==null?void 0:oe.id,streamId:he.id})]}),o.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto"},children:o.jsx(hY,{stream:he,user:oe,canModerate:me,isStreamer:Qe})})]}):o.jsx("div",{style:{color:"#bbb",padding:12},children:"Loading chat"})})]})},hb=ut.createContext({value:void 0,onValueChange:()=>{},open:!1,setOpen:()=>{}});function gs({value:i,onValueChange:n,children:a,className:l=""}){const[u,m]=ut.useState(!1),y=ut.useMemo(()=>({value:i,onValueChange:n||(()=>{}),open:u,setOpen:m}),[i,n,u]);return o.jsx("div",{className:l,children:o.jsx(hb.Provider,{value:y,children:a})})}function _s({children:i,className:n=""}){const{open:a,setOpen:l}=ut.useContext(hb);return o.jsx("button",{type:"button",className:n,"aria-expanded":a,onClick:()=>l(!a),children:i})}function ys({children:i}){const{value:n}=ut.useContext(hb);return o.jsx("span",{children:i||String(n||"")})}function vs({children:i,className:n=""}){const{open:a}=ut.useContext(hb),l=[n,a?"block":"hidden"].filter(Boolean).join(" ");return o.jsx("div",{className:l,role:"listbox",children:i})}function Ct({value:i,children:n,className:a="",onSelect:l}){const{onValueChange:u,setOpen:m}=ut.useContext(hb),y=()=>{l&&l(i),u&&u(i),m(!1)};return o.jsx("div",{className:["px-2 py-1 cursor-pointer",a].filter(Boolean).join(" "),role:"option","aria-selected":!1,onClick:y,children:n})}function Uwe({requests:i=[],onApprove:n,onReject:a}){return i!=null&&i.length?o.jsx("div",{className:"space-y-2",children:i.map(l=>o.jsxs("div",{className:"flex items-center justify-between bg-[#0a0a0f] border border-[#2a2a3a] rounded p-2 text-sm",children:[o.jsx("div",{className:"text-gray-300",children:l.username||l.user_id||l.id}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{className:"px-2 py-1 rounded bg-green-600 text-white",onClick:()=>n&&n(l),children:"Approve"}),o.jsx("button",{className:"px-2 py-1 rounded bg-red-600 text-white",onClick:()=>a&&a(l),children:"Reject"})]})]},l.id))}):o.jsx("div",{className:"text-gray-400 text-sm",children:"No join requests"})}function Fwe({gift:i}){return i?o.jsxs("div",{className:"fixed bottom-4 right-4 px-3 py-2 rounded bg-pink-600/20 border border-pink-600/30 text-pink-200 text-sm",children:[" ",(i==null?void 0:i.name)||"Gift"]}):null}const kd=Object.create(null);kd.open="0";kd.close="1";kd.ping="2";kd.pong="3";kd.message="4";kd.upgrade="5";kd.noop="6";const ZC=Object.create(null);Object.keys(kd).forEach(i=>{ZC[kd[i]]=i});const nD={type:"error",data:"parser error"},vY=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",EY=typeof ArrayBuffer=="function",wY=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,O2=({type:i,data:n},a,l)=>vY&&n instanceof Blob?a?l(n):AG(n,l):EY&&(n instanceof ArrayBuffer||wY(n))?a?l(n):AG(new Blob([n]),l):l(kd[i]+(n||"")),AG=(i,n)=>{const a=new FileReader;return a.onload=function(){const l=a.result.split(",")[1];n("b"+(l||""))},a.readAsDataURL(i)};function IG(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let Vk;function Vwe(i,n){if(vY&&i.data instanceof Blob)return i.data.arrayBuffer().then(IG).then(n);if(EY&&(i.data instanceof ArrayBuffer||wY(i.data)))return n(IG(i.data));O2(i,!1,a=>{Vk||(Vk=new TextEncoder),n(Vk.encode(a))})}const OG="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vw=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<OG.length;i++)vw[OG.charCodeAt(i)]=i;const Bwe=i=>{let n=i.length*.75,a=i.length,l,u=0,m,y,w,b;i[i.length-1]==="="&&(n--,i[i.length-2]==="="&&n--);const x=new ArrayBuffer(n),T=new Uint8Array(x);for(l=0;l<a;l+=4)m=vw[i.charCodeAt(l)],y=vw[i.charCodeAt(l+1)],w=vw[i.charCodeAt(l+2)],b=vw[i.charCodeAt(l+3)],T[u++]=m<<2|y>>4,T[u++]=(y&15)<<4|w>>2,T[u++]=(w&3)<<6|b&63;return x},Wwe=typeof ArrayBuffer=="function",k2=(i,n)=>{if(typeof i!="string")return{type:"message",data:bY(i,n)};const a=i.charAt(0);return a==="b"?{type:"message",data:qwe(i.substring(1),n)}:ZC[a]?i.length>1?{type:ZC[a],data:i.substring(1)}:{type:ZC[a]}:nD},qwe=(i,n)=>{if(Wwe){const a=Bwe(i);return bY(a,n)}else return{base64:!0,data:i}},bY=(i,n)=>{switch(n){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},SY="",Gwe=(i,n)=>{const a=i.length,l=new Array(a);let u=0;i.forEach((m,y)=>{O2(m,!1,w=>{l[y]=w,++u===a&&n(l.join(SY))})})},Hwe=(i,n)=>{const a=i.split(SY),l=[];for(let u=0;u<a.length;u++){const m=k2(a[u],n);if(l.push(m),m.type==="error")break}return l};function Kwe(){return new TransformStream({transform(i,n){Vwe(i,a=>{const l=a.length;let u;if(l<126)u=new Uint8Array(1),new DataView(u.buffer).setUint8(0,l);else if(l<65536){u=new Uint8Array(3);const m=new DataView(u.buffer);m.setUint8(0,126),m.setUint16(1,l)}else{u=new Uint8Array(9);const m=new DataView(u.buffer);m.setUint8(0,127),m.setBigUint64(1,BigInt(l))}i.data&&typeof i.data!="string"&&(u[0]|=128),n.enqueue(u),n.enqueue(a)})}})}let Bk;function UC(i){return i.reduce((n,a)=>n+a.length,0)}function FC(i,n){if(i[0].length===n)return i.shift();const a=new Uint8Array(n);let l=0;for(let u=0;u<n;u++)a[u]=i[0][l++],l===i[0].length&&(i.shift(),l=0);return i.length&&l<i[0].length&&(i[0]=i[0].slice(l)),a}function zwe(i,n){Bk||(Bk=new TextDecoder);const a=[];let l=0,u=-1,m=!1;return new TransformStream({transform(y,w){for(a.push(y);;){if(l===0){if(UC(a)<1)break;const b=FC(a,1);m=(b[0]&128)===128,u=b[0]&127,u<126?l=3:u===126?l=1:l=2}else if(l===1){if(UC(a)<2)break;const b=FC(a,2);u=new DataView(b.buffer,b.byteOffset,b.length).getUint16(0),l=3}else if(l===2){if(UC(a)<8)break;const b=FC(a,8),x=new DataView(b.buffer,b.byteOffset,b.length),T=x.getUint32(0);if(T>Math.pow(2,21)-1){w.enqueue(nD);break}u=T*Math.pow(2,32)+x.getUint32(4),l=3}else{if(UC(a)<u)break;const b=FC(a,u);w.enqueue(k2(m?b:Bk.decode(b),n)),l=0}if(u===0||u>i){w.enqueue(nD);break}}}})}const xY=4;function li(i){if(i)return $we(i)}function $we(i){for(var n in li.prototype)i[n]=li.prototype[n];return i}li.prototype.on=li.prototype.addEventListener=function(i,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(n),this};li.prototype.once=function(i,n){function a(){this.off(i,a),n.apply(this,arguments)}return a.fn=n,this.on(i,a),this};li.prototype.off=li.prototype.removeListener=li.prototype.removeAllListeners=li.prototype.removeEventListener=function(i,n){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var a=this._callbacks["$"+i];if(!a)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var l,u=0;u<a.length;u++)if(l=a[u],l===n||l.fn===n){a.splice(u,1);break}return a.length===0&&delete this._callbacks["$"+i],this};li.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),a=this._callbacks["$"+i],l=1;l<arguments.length;l++)n[l-1]=arguments[l];if(a){a=a.slice(0);for(var l=0,u=a.length;l<u;++l)a[l].apply(this,n)}return this};li.prototype.emitReserved=li.prototype.emit;li.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};li.prototype.hasListeners=function(i){return!!this.listeners(i).length};const $R=typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,a)=>a(n,0),Rc=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Ywe="arraybuffer";function TY(i,...n){return n.reduce((a,l)=>(i.hasOwnProperty(l)&&(a[l]=i[l]),a),{})}const Xwe=Rc.setTimeout,Jwe=Rc.clearTimeout;function YR(i,n){n.useNativeTimers?(i.setTimeoutFn=Xwe.bind(Rc),i.clearTimeoutFn=Jwe.bind(Rc)):(i.setTimeoutFn=Rc.setTimeout.bind(Rc),i.clearTimeoutFn=Rc.clearTimeout.bind(Rc))}const Qwe=1.33;function Zwe(i){return typeof i=="string"?ebe(i):Math.ceil((i.byteLength||i.size)*Qwe)}function ebe(i){let n=0,a=0;for(let l=0,u=i.length;l<u;l++)n=i.charCodeAt(l),n<128?a+=1:n<2048?a+=2:n<55296||n>=57344?a+=3:(l++,a+=4);return a}function CY(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function tbe(i){let n="";for(let a in i)i.hasOwnProperty(a)&&(n.length&&(n+="&"),n+=encodeURIComponent(a)+"="+encodeURIComponent(i[a]));return n}function rbe(i){let n={},a=i.split("&");for(let l=0,u=a.length;l<u;l++){let m=a[l].split("=");n[decodeURIComponent(m[0])]=decodeURIComponent(m[1])}return n}class nbe extends Error{constructor(n,a,l){super(n),this.description=a,this.context=l,this.type="TransportError"}}class P2 extends li{constructor(n){super(),this.writable=!1,YR(this,n),this.opts=n,this.query=n.query,this.socket=n.socket,this.supportsBinary=!n.forceBase64}onError(n,a,l){return super.emitReserved("error",new nbe(n,a,l)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(n){this.readyState==="open"&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const a=k2(n,this.socket.binaryType);this.onPacket(a)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,a={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(a)}_hostname(){const n=this.opts.hostname;return n.indexOf(":")===-1?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(n){const a=tbe(n);return a.length?"?"+a:""}}class sbe extends P2{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(n){this.readyState="pausing";const a=()=>{this.readyState="paused",n()};if(this._polling||!this.writable){let l=0;this._polling&&(l++,this.once("pollComplete",function(){--l||a()})),this.writable||(l++,this.once("drain",function(){--l||a()}))}else a()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){const a=l=>{if(this.readyState==="opening"&&l.type==="open"&&this.onOpen(),l.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(l)};Hwe(n,this.socket.binaryType).forEach(a),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const n=()=>{this.write([{type:"close"}])};this.readyState==="open"?n():this.once("open",n)}write(n){this.writable=!1,Gwe(n,a=>{this.doWrite(a,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",a=this.query||{};return this.opts.timestampRequests!==!1&&(a[this.opts.timestampParam]=CY()),!this.supportsBinary&&!a.sid&&(a.b64=1),this.createUri(n,a)}}let RY=!1;try{RY=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ibe=RY;function abe(){}class obe extends sbe{constructor(n){if(super(n),typeof location<"u"){const a=location.protocol==="https:";let l=location.port;l||(l=a?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||l!==n.port}}doWrite(n,a){const l=this.request({method:"POST",data:n});l.on("success",a),l.on("error",(u,m)=>{this.onError("xhr post error",u,m)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(a,l)=>{this.onError("xhr poll error",a,l)}),this.pollXhr=n}}let by=class eR extends li{constructor(n,a,l){super(),this.createRequest=n,YR(this,l),this._opts=l,this._method=l.method||"GET",this._uri=a,this._data=l.data!==void 0?l.data:null,this._create()}_create(){var n;const a=TY(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");a.xdomain=!!this._opts.xd;const l=this._xhr=this.createRequest(a);try{l.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let u in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(u)&&l.setRequestHeader(u,this._opts.extraHeaders[u])}}catch{}if(this._method==="POST")try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}(n=this._opts.cookieJar)===null||n===void 0||n.addCookies(l),"withCredentials"in l&&(l.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(l.timeout=this._opts.requestTimeout),l.onreadystatechange=()=>{var u;l.readyState===3&&((u=this._opts.cookieJar)===null||u===void 0||u.parseCookies(l.getResponseHeader("set-cookie"))),l.readyState===4&&(l.status===200||l.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof l.status=="number"?l.status:0)},0))},l.send(this._data)}catch(u){this.setTimeoutFn(()=>{this._onError(u)},0);return}typeof document<"u"&&(this._index=eR.requestsCount++,eR.requests[this._index]=this)}_onError(n){this.emitReserved("error",n,this._xhr),this._cleanup(!0)}_cleanup(n){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=abe,n)try{this._xhr.abort()}catch{}typeof document<"u"&&delete eR.requests[this._index],this._xhr=null}}_onLoad(){const n=this._xhr.responseText;n!==null&&(this.emitReserved("data",n),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};by.requestsCount=0;by.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",kG);else if(typeof addEventListener=="function"){const i="onpagehide"in Rc?"pagehide":"unload";addEventListener(i,kG,!1)}}function kG(){for(let i in by.requests)by.requests.hasOwnProperty(i)&&by.requests[i].abort()}const cbe=(function(){const i=NY({xdomain:!1});return i&&i.responseType!==null})();class lbe extends obe{constructor(n){super(n);const a=n&&n.forceBase64;this.supportsBinary=cbe&&!a}request(n={}){return Object.assign(n,{xd:this.xd},this.opts),new by(NY,this.uri(),n)}}function NY(i){const n=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||ibe))return new XMLHttpRequest}catch{}if(!n)try{return new Rc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const AY=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class dbe extends P2{get name(){return"websocket"}doOpen(){const n=this.uri(),a=this.opts.protocols,l=AY?{}:TY(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(l.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(n,a,l)}catch(u){return this.emitReserved("error",u)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let a=0;a<n.length;a++){const l=n[a],u=a===n.length-1;O2(l,this.supportsBinary,m=>{try{this.doWrite(l,m)}catch{}u&&$R(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",a=this.query||{};return this.opts.timestampRequests&&(a[this.opts.timestampParam]=CY()),this.supportsBinary||(a.b64=1),this.createUri(n,a)}}const Wk=Rc.WebSocket||Rc.MozWebSocket;class ube extends dbe{createSocket(n,a,l){return AY?new Wk(n,a,l):a?new Wk(n,a):new Wk(n)}doWrite(n,a){this.ws.send(a)}}class hbe extends P2{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(n){return this.emitReserved("error",n)}this._transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(n=>{const a=zwe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),l=n.readable.pipeThrough(a).getReader(),u=Kwe();u.readable.pipeTo(n.writable),this._writer=u.writable.getWriter();const m=()=>{l.read().then(({done:w,value:b})=>{w||(this.onPacket(b),m())}).catch(w=>{})};m();const y={type:"open"};this.query.sid&&(y.data=`{"sid":"${this.query.sid}"}`),this._writer.write(y).then(()=>this.onOpen())})})}write(n){this.writable=!1;for(let a=0;a<n.length;a++){const l=n[a],u=a===n.length-1;this._writer.write(l).then(()=>{u&&$R(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;(n=this._transport)===null||n===void 0||n.close()}}const pbe={websocket:ube,webtransport:hbe,polling:lbe},fbe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,mbe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function sD(i){if(i.length>8e3)throw"URI too long";const n=i,a=i.indexOf("["),l=i.indexOf("]");a!=-1&&l!=-1&&(i=i.substring(0,a)+i.substring(a,l).replace(/:/g,";")+i.substring(l,i.length));let u=fbe.exec(i||""),m={},y=14;for(;y--;)m[mbe[y]]=u[y]||"";return a!=-1&&l!=-1&&(m.source=n,m.host=m.host.substring(1,m.host.length-1).replace(/;/g,":"),m.authority=m.authority.replace("[","").replace("]","").replace(/;/g,":"),m.ipv6uri=!0),m.pathNames=gbe(m,m.path),m.queryKey=_be(m,m.query),m}function gbe(i,n){const a=/\/{2,9}/g,l=n.replace(a,"/").split("/");return(n.slice(0,1)=="/"||n.length===0)&&l.splice(0,1),n.slice(-1)=="/"&&l.splice(l.length-1,1),l}function _be(i,n){const a={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(l,u,m){u&&(a[u]=m)}),a}const iD=typeof addEventListener=="function"&&typeof removeEventListener=="function",tR=[];iD&&addEventListener("offline",()=>{tR.forEach(i=>i())},!1);class pp extends li{constructor(n,a){if(super(),this.binaryType=Ywe,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,n&&typeof n=="object"&&(a=n,n=null),n){const l=sD(n);a.hostname=l.host,a.secure=l.protocol==="https"||l.protocol==="wss",a.port=l.port,l.query&&(a.query=l.query)}else a.host&&(a.hostname=sD(a.host).host);YR(this,a),this.secure=a.secure!=null?a.secure:typeof location<"u"&&location.protocol==="https:",a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=a.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},a.transports.forEach(l=>{const u=l.prototype.name;this.transports.push(u),this._transportsByName[u]=l}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=rbe(this.opts.query)),iD&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},tR.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(n){const a=Object.assign({},this.opts.query);a.EIO=xY,a.transport=n,this.id&&(a.sid=this.id);const l=Object.assign({},this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[n]);return new this._transportsByName[n](l)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const n=this.opts.rememberUpgrade&&pp.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const a=this.createTransport(n);a.open(),this.setTransport(a)}setTransport(n){this.transport&&this.transport.removeAllListeners(),this.transport=n,n.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",a=>this._onClose("transport close",a))}onOpen(){this.readyState="open",pp.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",n),this.emitReserved("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const a=new Error("server error");a.code=n.data,this._onError(a);break;case"message":this.emitReserved("data",n.data),this.emitReserved("message",n.data);break}}onHandshake(n){this.emitReserved("handshake",n),this.id=n.sid,this.transport.query.sid=n.sid,this._pingInterval=n.pingInterval,this._pingTimeout=n.pingTimeout,this._maxPayload=n.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const n=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+n,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},n),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const n=this._getWritablePackets();this.transport.send(n),this._prevBufferLen=n.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let a=1;for(let l=0;l<this.writeBuffer.length;l++){const u=this.writeBuffer[l].data;if(u&&(a+=Zwe(u)),l>0&&a>this._maxPayload)return this.writeBuffer.slice(0,l);a+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const n=Date.now()>this._pingTimeoutTime;return n&&(this._pingTimeoutTime=0,$R(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),n}write(n,a,l){return this._sendPacket("message",n,a,l),this}send(n,a,l){return this._sendPacket("message",n,a,l),this}_sendPacket(n,a,l,u){if(typeof a=="function"&&(u=a,a=void 0),typeof l=="function"&&(u=l,l=null),this.readyState==="closing"||this.readyState==="closed")return;l=l||{},l.compress=l.compress!==!1;const m={type:n,data:a,options:l};this.emitReserved("packetCreate",m),this.writeBuffer.push(m),u&&this.once("flush",u),this.flush()}close(){const n=()=>{this._onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),n()},l=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():n()}):this.upgrading?l():n()),this}_onError(n){if(pp.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",n),this._onClose("transport error",n)}_onClose(n,a){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),iD&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const l=tR.indexOf(this._offlineEventListener);l!==-1&&tR.splice(l,1)}this.readyState="closed",this.id=null,this.emitReserved("close",n,a),this.writeBuffer=[],this._prevBufferLen=0}}}pp.protocol=xY;class ybe extends pp{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let n=0;n<this._upgrades.length;n++)this._probe(this._upgrades[n])}_probe(n){let a=this.createTransport(n),l=!1;pp.priorWebsocketSuccess=!1;const u=()=>{l||(a.send([{type:"ping",data:"probe"}]),a.once("packet",N=>{if(!l)if(N.type==="pong"&&N.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;pp.priorWebsocketSuccess=a.name==="websocket",this.transport.pause(()=>{l||this.readyState!=="closed"&&(T(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const O=new Error("probe error");O.transport=a.name,this.emitReserved("upgradeError",O)}}))};function m(){l||(l=!0,T(),a.close(),a=null)}const y=N=>{const O=new Error("probe error: "+N);O.transport=a.name,m(),this.emitReserved("upgradeError",O)};function w(){y("transport closed")}function b(){y("socket closed")}function x(N){a&&N.name!==a.name&&m()}const T=()=>{a.removeListener("open",u),a.removeListener("error",y),a.removeListener("close",w),this.off("close",b),this.off("upgrading",x)};a.once("open",u),a.once("error",y),a.once("close",w),this.once("close",b),this.once("upgrading",x),this._upgrades.indexOf("webtransport")!==-1&&n!=="webtransport"?this.setTimeoutFn(()=>{l||a.open()},200):a.open()}onHandshake(n){this._upgrades=this._filterUpgrades(n.upgrades),super.onHandshake(n)}_filterUpgrades(n){const a=[];for(let l=0;l<n.length;l++)~this.transports.indexOf(n[l])&&a.push(n[l]);return a}}let vbe=class extends ybe{constructor(n,a={}){const l=typeof n=="object"?n:a;(!l.transports||l.transports&&typeof l.transports[0]=="string")&&(l.transports=(l.transports||["polling","websocket","webtransport"]).map(u=>pbe[u]).filter(u=>!!u)),super(n,l)}};function Ebe(i,n="",a){let l=i;a=a||typeof location<"u"&&location,i==null&&(i=a.protocol+"//"+a.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=a.protocol+i:i=a.host+i),/^(https?|wss?):\/\//.test(i)||(typeof a<"u"?i=a.protocol+"//"+i:i="https://"+i),l=sD(i)),l.port||(/^(http|ws)$/.test(l.protocol)?l.port="80":/^(http|ws)s$/.test(l.protocol)&&(l.port="443")),l.path=l.path||"/";const m=l.host.indexOf(":")!==-1?"["+l.host+"]":l.host;return l.id=l.protocol+"://"+m+":"+l.port+n,l.href=l.protocol+"://"+m+(a&&a.port===l.port?"":":"+l.port),l}const wbe=typeof ArrayBuffer=="function",bbe=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,IY=Object.prototype.toString,Sbe=typeof Blob=="function"||typeof Blob<"u"&&IY.call(Blob)==="[object BlobConstructor]",xbe=typeof File=="function"||typeof File<"u"&&IY.call(File)==="[object FileConstructor]";function D2(i){return wbe&&(i instanceof ArrayBuffer||bbe(i))||Sbe&&i instanceof Blob||xbe&&i instanceof File}function rR(i,n){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let a=0,l=i.length;a<l;a++)if(rR(i[a]))return!0;return!1}if(D2(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return rR(i.toJSON(),!0);for(const a in i)if(Object.prototype.hasOwnProperty.call(i,a)&&rR(i[a]))return!0;return!1}function Tbe(i){const n=[],a=i.data,l=i;return l.data=aD(a,n),l.attachments=n.length,{packet:l,buffers:n}}function aD(i,n){if(!i)return i;if(D2(i)){const a={_placeholder:!0,num:n.length};return n.push(i),a}else if(Array.isArray(i)){const a=new Array(i.length);for(let l=0;l<i.length;l++)a[l]=aD(i[l],n);return a}else if(typeof i=="object"&&!(i instanceof Date)){const a={};for(const l in i)Object.prototype.hasOwnProperty.call(i,l)&&(a[l]=aD(i[l],n));return a}return i}function Cbe(i,n){return i.data=oD(i.data,n),delete i.attachments,i}function oD(i,n){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<n.length)return n[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let a=0;a<i.length;a++)i[a]=oD(i[a],n);else if(typeof i=="object")for(const a in i)Object.prototype.hasOwnProperty.call(i,a)&&(i[a]=oD(i[a],n));return i}const Rbe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Nbe=5;var mn;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(mn||(mn={}));class Abe{constructor(n){this.replacer=n}encode(n){return(n.type===mn.EVENT||n.type===mn.ACK)&&rR(n)?this.encodeAsBinary({type:n.type===mn.EVENT?mn.BINARY_EVENT:mn.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id}):[this.encodeAsString(n)]}encodeAsString(n){let a=""+n.type;return(n.type===mn.BINARY_EVENT||n.type===mn.BINARY_ACK)&&(a+=n.attachments+"-"),n.nsp&&n.nsp!=="/"&&(a+=n.nsp+","),n.id!=null&&(a+=n.id),n.data!=null&&(a+=JSON.stringify(n.data,this.replacer)),a}encodeAsBinary(n){const a=Tbe(n),l=this.encodeAsString(a.packet),u=a.buffers;return u.unshift(l),u}}function PG(i){return Object.prototype.toString.call(i)==="[object Object]"}class j2 extends li{constructor(n){super(),this.reviver=n}add(n){let a;if(typeof n=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");a=this.decodeString(n);const l=a.type===mn.BINARY_EVENT;l||a.type===mn.BINARY_ACK?(a.type=l?mn.EVENT:mn.ACK,this.reconstructor=new Ibe(a),a.attachments===0&&super.emitReserved("decoded",a)):super.emitReserved("decoded",a)}else if(D2(n)||n.base64)if(this.reconstructor)a=this.reconstructor.takeBinaryData(n),a&&(this.reconstructor=null,super.emitReserved("decoded",a));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+n)}decodeString(n){let a=0;const l={type:Number(n.charAt(0))};if(mn[l.type]===void 0)throw new Error("unknown packet type "+l.type);if(l.type===mn.BINARY_EVENT||l.type===mn.BINARY_ACK){const m=a+1;for(;n.charAt(++a)!=="-"&&a!=n.length;);const y=n.substring(m,a);if(y!=Number(y)||n.charAt(a)!=="-")throw new Error("Illegal attachments");l.attachments=Number(y)}if(n.charAt(a+1)==="/"){const m=a+1;for(;++a&&!(n.charAt(a)===","||a===n.length););l.nsp=n.substring(m,a)}else l.nsp="/";const u=n.charAt(a+1);if(u!==""&&Number(u)==u){const m=a+1;for(;++a;){const y=n.charAt(a);if(y==null||Number(y)!=y){--a;break}if(a===n.length)break}l.id=Number(n.substring(m,a+1))}if(n.charAt(++a)){const m=this.tryParse(n.substr(a));if(j2.isPayloadValid(l.type,m))l.data=m;else throw new Error("invalid payload")}return l}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,a){switch(n){case mn.CONNECT:return PG(a);case mn.DISCONNECT:return a===void 0;case mn.CONNECT_ERROR:return typeof a=="string"||PG(a);case mn.EVENT:case mn.BINARY_EVENT:return Array.isArray(a)&&(typeof a[0]=="number"||typeof a[0]=="string"&&Rbe.indexOf(a[0])===-1);case mn.ACK:case mn.BINARY_ACK:return Array.isArray(a)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ibe{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const a=Cbe(this.reconPack,this.buffers);return this.finishedReconstruction(),a}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Obe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:j2,Encoder:Abe,get PacketType(){return mn},protocol:Nbe},Symbol.toStringTag,{value:"Module"}));function xl(i,n,a){return i.on(n,a),function(){i.off(n,a)}}const kbe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class OY extends li{constructor(n,a,l){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=a,l&&l.auth&&(this.auth=l.auth),this._opts=Object.assign({},l),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[xl(n,"open",this.onopen.bind(this)),xl(n,"packet",this.onpacket.bind(this)),xl(n,"error",this.onerror.bind(this)),xl(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...a){var l,u,m;if(kbe.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(a.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(a),this;const y={type:mn.EVENT,data:a};if(y.options={},y.options.compress=this.flags.compress!==!1,typeof a[a.length-1]=="function"){const T=this.ids++,N=a.pop();this._registerAckCallback(T,N),y.id=T}const w=(u=(l=this.io.engine)===null||l===void 0?void 0:l.transport)===null||u===void 0?void 0:u.writable,b=this.connected&&!(!((m=this.io.engine)===null||m===void 0)&&m._hasPingExpired());return this.flags.volatile&&!w||(b?(this.notifyOutgoingListeners(y),this.packet(y)):this.sendBuffer.push(y)),this.flags={},this}_registerAckCallback(n,a){var l;const u=(l=this.flags.timeout)!==null&&l!==void 0?l:this._opts.ackTimeout;if(u===void 0){this.acks[n]=a;return}const m=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let w=0;w<this.sendBuffer.length;w++)this.sendBuffer[w].id===n&&this.sendBuffer.splice(w,1);a.call(this,new Error("operation has timed out"))},u),y=(...w)=>{this.io.clearTimeoutFn(m),a.apply(this,w)};y.withError=!0,this.acks[n]=y}emitWithAck(n,...a){return new Promise((l,u)=>{const m=(y,w)=>y?u(y):l(w);m.withError=!0,a.push(m),this.emit(n,...a)})}_addToQueue(n){let a;typeof n[n.length-1]=="function"&&(a=n.pop());const l={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((u,...m)=>l!==this._queue[0]?void 0:(u!==null?l.tryCount>this._opts.retries&&(this._queue.shift(),a&&a(u)):(this._queue.shift(),a&&a(null,...m)),l.pending=!1,this._drainQueue())),this._queue.push(l),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||this._queue.length===0)return;const a=this._queue[0];a.pending&&!n||(a.pending=!0,a.tryCount++,this.flags=a.flags,this.emit.apply(this,a.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){typeof this.auth=="function"?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:mn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,a){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,a),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(n=>{if(!this.sendBuffer.some(l=>String(l.id)===n)){const l=this.acks[n];delete this.acks[n],l.withError&&l.call(this,new Error("socket has been disconnected"))}})}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case mn.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case mn.EVENT:case mn.BINARY_EVENT:this.onevent(n);break;case mn.ACK:case mn.BINARY_ACK:this.onack(n);break;case mn.DISCONNECT:this.ondisconnect();break;case mn.CONNECT_ERROR:this.destroy();const l=new Error(n.data.message);l.data=n.data.data,this.emitReserved("connect_error",l);break}}onevent(n){const a=n.data||[];n.id!=null&&a.push(this.ack(n.id)),this.connected?this.emitEvent(a):this.receiveBuffer.push(Object.freeze(a))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const a=this._anyListeners.slice();for(const l of a)l.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&typeof n[n.length-1]=="string"&&(this._lastOffset=n[n.length-1])}ack(n){const a=this;let l=!1;return function(...u){l||(l=!0,a.packet({type:mn.ACK,id:n,data:u}))}}onack(n){const a=this.acks[n.id];typeof a=="function"&&(delete this.acks[n.id],a.withError&&n.data.unshift(null),a.apply(this,n.data))}onconnect(n,a){this.id=n,this.recovered=a&&this._pid===a,this._pid=a,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:mn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const a=this._anyListeners;for(let l=0;l<a.length;l++)if(n===a[l])return a.splice(l,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const a=this._anyOutgoingListeners;for(let l=0;l<a.length;l++)if(n===a[l])return a.splice(l,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const a=this._anyOutgoingListeners.slice();for(const l of a)l.apply(this,n.data)}}}function e0(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}e0.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),a=Math.floor(n*this.jitter*i);i=(Math.floor(n*10)&1)==0?i-a:i+a}return Math.min(i,this.max)|0};e0.prototype.reset=function(){this.attempts=0};e0.prototype.setMin=function(i){this.ms=i};e0.prototype.setMax=function(i){this.max=i};e0.prototype.setJitter=function(i){this.jitter=i};class cD extends li{constructor(n,a){var l;super(),this.nsps={},this.subs=[],n&&typeof n=="object"&&(a=n,n=void 0),a=a||{},a.path=a.path||"/socket.io",this.opts=a,YR(this,a),this.reconnection(a.reconnection!==!1),this.reconnectionAttempts(a.reconnectionAttempts||1/0),this.reconnectionDelay(a.reconnectionDelay||1e3),this.reconnectionDelayMax(a.reconnectionDelayMax||5e3),this.randomizationFactor((l=a.randomizationFactor)!==null&&l!==void 0?l:.5),this.backoff=new e0({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(a.timeout==null?2e4:a.timeout),this._readyState="closed",this.uri=n;const u=a.parser||Obe;this.encoder=new u.Encoder,this.decoder=new u.Decoder,this._autoConnect=a.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,n||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(n){return n===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var a;return n===void 0?this._reconnectionDelay:(this._reconnectionDelay=n,(a=this.backoff)===null||a===void 0||a.setMin(n),this)}randomizationFactor(n){var a;return n===void 0?this._randomizationFactor:(this._randomizationFactor=n,(a=this.backoff)===null||a===void 0||a.setJitter(n),this)}reconnectionDelayMax(n){var a;return n===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,(a=this.backoff)===null||a===void 0||a.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new vbe(this.uri,this.opts);const a=this.engine,l=this;this._readyState="opening",this.skipReconnect=!1;const u=xl(a,"open",function(){l.onopen(),n&&n()}),m=w=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",w),n?n(w):this.maybeReconnectOnOpen()},y=xl(a,"error",m);if(this._timeout!==!1){const w=this._timeout,b=this.setTimeoutFn(()=>{u(),m(new Error("timeout")),a.close()},w);this.opts.autoUnref&&b.unref(),this.subs.push(()=>{this.clearTimeoutFn(b)})}return this.subs.push(u),this.subs.push(y),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push(xl(n,"ping",this.onping.bind(this)),xl(n,"data",this.ondata.bind(this)),xl(n,"error",this.onerror.bind(this)),xl(n,"close",this.onclose.bind(this)),xl(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(a){this.onclose("parse error",a)}}ondecoded(n){$R(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,a){let l=this.nsps[n];return l?this._autoConnect&&!l.active&&l.connect():(l=new OY(this,n,a),this.nsps[n]=l),l}_destroy(n){const a=Object.keys(this.nsps);for(const l of a)if(this.nsps[l].active)return;this._close()}_packet(n){const a=this.encoder.encode(n);for(let l=0;l<a.length;l++)this.engine.write(a[l],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(n,a){var l;this.cleanup(),(l=this.engine)===null||l===void 0||l.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,a),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const a=this.backoff.duration();this._reconnecting=!0;const l=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(u=>{u?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",u)):n.onreconnect()}))},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}}const hw={};function nR(i,n){typeof i=="object"&&(n=i,i=void 0),n=n||{};const a=Ebe(i,n.path||"/socket.io"),l=a.source,u=a.id,m=a.path,y=hw[u]&&m in hw[u].nsps,w=n.forceNew||n["force new connection"]||n.multiplex===!1||y;let b;return w?b=new cD(l,n):(hw[u]||(hw[u]=new cD(l,n)),b=hw[u]),a.query&&!n.query&&(n.query=a.queryKey),b.socket(a.path,n)}Object.assign(nR,{Manager:cD,Socket:OY,io:nR,connect:nR});const Pbe=window.location.origin;function kY(){const i=vn(),n=Wn(),a=M.useRef(null),l=M.useRef(null),u=M.useRef(null),m=M.useRef(null),y=M.useRef(null),w=M.useRef(null),b=M.useRef(new Set),x=M.useRef(!1),T=M.useRef(null),N=M.useRef({}),O=M.useRef({}),P=M.useRef({}),[F,z]=M.useState(1),[V,W]=M.useState({title:"",category:"gaming",thumbnailUrl:"",streamMode:"solo",maxParticipants:1}),te=[{id:"all",label:"All"},{id:"gaming",label:" Gaming"},{id:"music",label:" Music"},{id:"talk",label:" Just Chatting"},{id:"creative",label:" Creative"},{id:"smoking",label:" Smoking"},{id:"drinking",label:" Drinking"},{id:"comedy",label:" Comedy"},{id:"dating",label:" Dating"}],[$,Q]=M.useState(!1),[G,se]=M.useState(null),[ie,ce]=M.useState(0),[Se,oe]=M.useState(!1),[ve,he]=M.useState(!1),[Ze,Qe]=M.useState(!1),[me,ye]=M.useState(!1),[ge,Ee]=M.useState(""),[Oe,we]=M.useState(!1),[fe,De]=M.useState(0),[je,_e]=M.useState(null),[Je,st]=M.useState(null),vt=M.useRef(null),pt=M.useRef(null),[er,gt]=M.useState(()=>Array.from({length:4},(Be,tt)=>({id:tt+1,occupiedBy:null,stream:null,joining:!1}))),{data:qe,isLoading:Wr}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me(),refetchInterval:5e3,staleTime:3e3}),{data:en=[]}=mt({queryKey:["myActiveStreams",qe==null?void 0:qe.id],queryFn:async()=>{if(!qe)return[];const{data:Be,error:tt}=await K.from("streams").select("*").eq("streamer_id",qe.id).eq("is_live",!0);return tt?(console.warn("fetch active streams error:",tt.message),[]):Be||[]},enabled:!!qe,refetchInterval:1e4,staleTime:5e3}),{data:Cn=[]}=mt({queryKey:["streamChat",G==null?void 0:G.id],queryFn:async()=>{if(!(G!=null&&G.id))return[];const{data:Be,error:tt}=await K.from("chat_messages").select("*").eq("stream_id",G.id).order("created_date",{ascending:!1}).limit(100);return tt?(console.warn("fetch chat messages error:",tt.message),[]):Be||[]},initialData:[],refetchInterval:3e3,enabled:!!(G!=null&&G.id)&&$,staleTime:2e3}),{data:Lr=[]}=mt({queryKey:["joinRequests",G==null?void 0:G.id],queryFn:async()=>{if(!(G!=null&&G.id))return[];const{data:Be,error:tt}=await K.from("join_requests").select("*").eq("stream_id",G.id).eq("status","pending").order("created_date",{ascending:!1});return tt?(console.warn("fetch join requests error:",tt.message),[]):Be||[]},initialData:[],refetchInterval:5e3,enabled:!!(G!=null&&G.id)&&$,staleTime:3e3}),{data:Le=[]}=mt({queryKey:["broadcasterGifts",G==null?void 0:G.id],queryFn:async()=>{if(!(G!=null&&G.id))return[];const{data:Be,error:tt}=await K.from("stream_gifts").select("*").eq("stream_id",G.id).order("created_date",{ascending:!1}).limit(5);return tt?(console.warn("fetch gifts error:",tt.message),[]):Be||[]},enabled:!!(G!=null&&G.id)&&$,refetchInterval:3e3,initialData:[],staleTime:2e3}),{data:it=[]}=mt({queryKey:["streamParticipants",G==null?void 0:G.id],queryFn:async()=>{if(!(G!=null&&G.id))return[];const{data:Be,error:tt}=await K.from("stream_participants").select("*").eq("stream_id",G.id);return tt?(console.warn("fetch participants error:",tt.message),[]):Be||[]},enabled:!!(G!=null&&G.id)&&$&&(G==null?void 0:G.stream_mode)==="multi",refetchInterval:5e3,initialData:[],staleTime:3e3});M.useEffect(()=>{const Be=Cn.filter(tt=>tt.message_type==="join"&&!b.current.has(tt.id));if(Be.length>0){const tt=Be[0];(async()=>{try{const{data:bt,error:ct}=await K.from("profiles").select("*").eq("id",tt.user_id).limit(1);if(ct)throw ct;const Pt=Array.isArray(bt)?bt[0]:null;Pt&&Pt.active_entrance_effect&&(_e(Pt),b.current.add(tt.id),setTimeout(()=>_e(null),4e3))}catch(bt){console.error("entrance effect lookup failed:",bt)}})()}},[Cn]),M.useEffect(()=>{if(Le.length>0){const Be=Le[0];(!vt.current||Be.id!==vt.current)&&(vt.current=Be.id,st(Be))}},[Le]),M.useEffect(()=>{if(!T.current){const Be=nR(Pbe,{transports:["websocket"]});T.current=Be,Be.on("connect",()=>{var tt;return console.log(" socket connected",(tt=T.current)==null?void 0:tt.id)}),Be.on("room-state",tt=>{tt&&Array.isArray(tt.boxes)&&gt(bt=>bt.map(ct=>{const Pt=tt.boxes.find(Ot=>Ot.id===ct.id);return!Pt||ct.occupiedBy&&ct.occupiedBy.id===(qe==null?void 0:qe.id)?ct:{...ct,occupiedBy:Pt.occupiedBy||null}}))}),Be.on("box-joined",({boxId:tt,user:bt})=>{gt(ct=>ct.map(Pt=>Pt.id===tt?{...Pt,occupiedBy:bt}:Pt))}),Be.on("box-left",({boxId:tt})=>{gt(bt=>bt.map(ct=>ct.id===tt?{...ct,occupiedBy:null,stream:null}:ct))}),Be.on("signal-offer",async({fromSocketId:tt,toSocketId:bt,boxId:ct,offer:Pt})=>{var Ot;((Ot=T.current)==null?void 0:Ot.id)===bt&&await Tr(tt,ct,Pt)}),Be.on("signal-answer",async({fromSocketId:tt,toSocketId:bt,boxId:ct,answer:Pt})=>{var Ot;((Ot=T.current)==null?void 0:Ot.id)===bt&&await An(tt,Pt)}),Be.on("signal-ice",async({fromSocketId:tt,toSocketId:bt,candidate:ct})=>{var Ot;if(((Ot=T.current)==null?void 0:Ot.id)!==bt)return;const Pt=N.current[tt];if(Pt&&ct)try{await Pt.addIceCandidate(new RTCIceCandidate(ct))}catch(tr){console.warn("ice add error",tr)}})}return()=>{const Be=T.current;if(Be){Be.off("connect"),Be.off("room-state"),Be.off("box-joined"),Be.off("box-left"),Be.off("signal-offer"),Be.off("signal-answer"),Be.off("signal-ice");try{Be.disconnect()}catch(tt){console.warn("socket disconnect error",tt)}}Object.values(P.current||{}).forEach(tt=>{try{tt.getTracks().forEach(bt=>bt.stop())}catch{}}),P.current={},Object.values(N.current||{}).forEach(tt=>{try{tt.close()}catch{}}),N.current={}}},[qe==null?void 0:qe.id]);const jt=(Be,tt)=>{if(!Be)return null;if(N.current[Be])return N.current[Be];const bt=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return bt.onicecandidate=ct=>{ct.candidate&&T.current&&T.current.emit("signal-ice",{toSocketId:Be,candidate:ct.candidate})},bt.ontrack=ct=>{const[Pt]=ct.streams;Pt&&(gt(Ot=>Ot.map(tr=>tr.id===tt?{...tr,stream:Pt}:tr)),O.current[Be]=Pt)},N.current[Be]=bt,bt},xt=async Be=>{if(!qe){pe.error("Please login to join");return}const tt=er.find(bt=>bt.id===Be);if(tt!=null&&tt.occupiedBy){pe.error("Box already taken");return}gt(bt=>bt.map(ct=>ct.id===Be?{...ct,joining:!0}:ct));try{const bt=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});P.current[Be]=bt,gt(ct=>ct.map(Pt=>Pt.id===Be?{...Pt,occupiedBy:qe,stream:bt,joining:!1}:Pt)),T.current&&(T.current.emit("join-box",{boxId:Be,user:{id:qe.id,username:qe.username,avatar:qe.avatar},toRoom:(G==null?void 0:G.id)||null}),T.current.emit("request-peers-for-box",{boxId:Be},async(ct=[])=>{for(const Pt of ct){if(Pt===T.current.id)continue;const Ot=jt(Pt,Be);if(Ot){try{bt.getTracks().forEach(tr=>Ot.addTrack(tr,bt))}catch(tr){console.warn("addTrack failed",tr)}try{const tr=await Ot.createOffer();await Ot.setLocalDescription(tr),T.current.emit("signal-offer",{toSocketId:Pt,fromSocketId:T.current.id,boxId:Be,offer:tr})}catch(tr){console.error("offer create/send failed",tr)}}}})),pe.success("You joined the box"),G!=null&&G.id&&K.from("stream_participants").insert({stream_id:G.id,user_id:qe.id,box_number:Be,username:qe.username||qe.full_name,user_avatar:qe.avatar,user_level:qe.level||1,role:Be===1?"host":"co-host",is_publishing:!0,joined_at:new Date().toISOString()}).catch(console.error)}catch(bt){console.error("Failed to get media:",bt),gt(ct=>ct.map(Pt=>Pt.id===Be?{...Pt,joining:!1}:Pt)),pe.error("Camera / Microphone permission required")}},Tr=async(Be,tt,bt)=>{try{const ct=jt(Be,tt);if(!ct)return;const Pt=P.current[tt];if(Pt)try{Pt.getTracks().forEach(tr=>ct.addTrack(tr,Pt))}catch(tr){console.warn("add local tracks error",tr)}await ct.setRemoteDescription(new RTCSessionDescription(bt));const Ot=await ct.createAnswer();await ct.setLocalDescription(Ot),T.current&&T.current.emit("signal-answer",{toSocketId:Be,fromSocketId:T.current.id,boxId:tt,answer:Ot})}catch(ct){console.error("Offer handling failed",ct)}},An=async(Be,tt)=>{try{const bt=N.current[Be];if(!bt)return;await bt.setRemoteDescription(new RTCSessionDescription(tt))}catch(bt){console.error("Answer handling failed",bt)}},En=async Be=>{if(!G||!T.current)return;const tt=G.max_participants;if(!(Be>=tt))try{for(let ct=Be+1;ct<=tt;ct++){const Pt=er.find(Ot=>Ot.id===ct);Pt!=null&&Pt.occupiedBy&&Pt.occupiedBy.id!==qe.id&&T.current.emit("force-leave-box",{boxId:ct})}const{error:bt}=await K.from("streams").update({max_participants:Be}).eq("id",G.id);if(bt)throw bt;se(ct=>({...ct,max_participants:Be})),gt(ct=>ct.slice(0,Be));for(let ct=Be+1;ct<=tt;ct++)P.current[ct]&&(P.current[ct].getTracks().forEach(Pt=>Pt.stop()),delete P.current[ct]);pe.success(`Stream downgraded to ${Be} boxes`),he(!1)}catch(bt){console.error("Box downgrade error:",bt),pe.error("Failed to downgrade boxes")}},on=async Be=>{const tt=P.current[Be];if(tt){try{tt.getTracks().forEach(bt=>bt.stop())}catch{}delete P.current[Be]}if(T.current&&T.current.emit("leave-box",{boxId:Be}),gt(bt=>bt.map(ct=>ct.id===Be?{id:ct.id,occupiedBy:null,stream:null,joining:!1}:ct)),G!=null&&G.id)try{const{data:bt=[]}=await K.from("stream_participants").select("*").eq("stream_id",G.id).eq("user_id",qe.id).eq("box_number",Be);for(const ct of bt)await K.from("stream_participants").delete().eq("id",ct.id).catch(console.error)}catch(bt){console.error("leaveBox cleanup failed",bt)}},Sr=async()=>{if(window.AgoraRTC){console.log(" Agora SDK already loaded");return}return console.log(" Loading Agora SDK..."),new Promise((Be,tt)=>{const bt=document.createElement("script");bt.src="https://download.agora.io/sdk/release/AgoraRTC_N-4.20.0.js",bt.onload=()=>{window.AgoraRTC?(console.log(" Agora SDK loaded successfully"),Be()):tt(new Error("Agora SDK not found after load"))},bt.onerror=()=>tt(new Error("Failed to load Agora SDK script")),document.head.appendChild(bt)})},js=async()=>{var Be,tt,bt;try{oe(!0),console.log(" Starting Agora stream setup..."),await Sr();const Pt=`stream_${(qe==null?void 0:qe.id)||"anon"}_${Date.now()}`;console.log(" Channel name:",Pt);let Ot;try{const hr=await K.functions.invoke("generateagoratoken",{body:{channelName:Pt,role:"publisher",uid:(qe==null?void 0:qe.id)||1}});Ot=(hr==null?void 0:hr.data)||hr}catch(hr){console.warn("Supabase invoke failed, falling back to direct fetch:",(hr==null?void 0:hr.message)||hr);try{const{getAgoraToken:Ar}=await OK(async()=>{const{getAgoraToken:ja}=await Promise.resolve().then(()=>Awe);return{getAgoraToken:ja}},void 0);Ot=await Ar(Pt,(qe==null?void 0:qe.id)||1)}catch(Ar){console.error("Fallback token fetch failed:",(Ar==null?void 0:Ar.message)||Ar),Ot=null}}const tr=(Ot==null?void 0:Ot.appId)??(Ot==null?void 0:Ot.agoraAppId)??"7b95b64b0e154f7ab931e2abf000e694",Da=[Ot==null?void 0:Ot.token,Ot==null?void 0:Ot.rtcToken,(Be=Ot==null?void 0:Ot.data)==null?void 0:Be.token,(tt=Ot==null?void 0:Ot.data)==null?void 0:tt.rtcToken,null].find(Boolean)??null,ma=(Ot==null?void 0:Ot.uid)??(Ot==null?void 0:Ot.userId)??((bt=Ot==null?void 0:Ot.data)==null?void 0:bt.uid)??((qe==null?void 0:qe.id)||1);if(!Da){const Ar=Object.keys(Ot||{});pe.error(`Missing Agora token from server. Expected 'token' or 'rtcToken'. Received keys: ${JSON.stringify(Ar)}`),oe(!1);return}if(!tr){pe.dismiss("stream-setup"),pe.error("Missing Agora App ID. Set VITE_AGORA_APP_ID or return appId in token response."),oe(!1);return}console.log(" Token received:",{appId:tr,uid:ma}),pe.dismiss("stream-setup");let Dc,ar;try{Dc=await window.AgoraRTC.createMicrophoneAudioTrack({encoderConfig:"high_quality_stereo"}),ar=await window.AgoraRTC.createCameraVideoTrack({encoderConfig:"720p_2",facingMode:"user",optimizationMode:"detail"})}catch(hr){throw(hr==null?void 0:hr.name)==="NotAllowedError"||/Permission denied/i.test((hr==null?void 0:hr.message)||"")?pe.error("Camera/mic permission denied. Please allow access in your browser and try again."):pe.error((hr==null?void 0:hr.message)||"Failed to access camera/mic"),oe(!1),hr}console.log(" Media tracks created"),pe.dismiss("media-request"),l.current=Dc,u.current=ar;const kn=window.AgoraRTC.createClient({mode:"live",codec:"vp8",role:"host"});if(kn.enableDualStream(),a.current=kn,await kn.join(tr,Pt,Da,ma),console.log(" Joined Agora channel"),await kn.publish([Dc,ar]),console.log(" Published tracks"),!qe||!(qe!=null&&qe.id)){pe.error("User info missing. Please sign in again and retry.");try{await kn.leave()}catch{}oe(!1);return}const{data:qn,error:Ls}=await K.from("streams").insert({title:V.title,streamer_name:(qe==null?void 0:qe.username)||(qe==null?void 0:qe.full_name)||"Anonymous",streamer_id:qe==null?void 0:qe.id,streamer_avatar:(qe==null?void 0:qe.avatar)||"",streamer_follower_count:(qe==null?void 0:qe.follower_count)||0,streamer_created_date:(qe==null?void 0:qe.created_date)||new Date().toISOString(),category:V.category,stream_mode:V.streamMode,max_participants:V.maxParticipants,status:"live",streaming_backend:"agora",agora_channel_name:Pt,agora_token:Da,agora_uid:String(ma),thumbnail:V.thumbnailUrl||"",peer_id:Pt,last_heartbeat:new Date().toISOString(),viewer_count:0,is_live:!0}).select("*").single();if(Ls){console.error("Stream create error:",Ls.message),pe.dismiss("create-stream"),pe.error("Failed to create stream: "+Ls.message);try{await kn.leave()}catch{}oe(!1);return}const Ji=qn;console.log(" Stream record created:",Ji.id),pe.dismiss("create-stream"),se(Ji),Q(!0),oe(!1);try{const{data:hr=[]}=await K.from("follows").select("follower_id").eq("following_id",qe.id);if(Array.isArray(hr)&&hr.length>0){const Ar=hr.map(ja=>({user_id:ja.follower_id,type:"stream_live",title:"Stream Live",message:`${qe.username||qe.full_name} is live: ${Ji.title}`,link_url:`${Or("StreamViewer")}?id=${Ji.id}`,is_read:!1,created_date:new Date().toISOString()}));await K.from("notifications").insert(Ar).catch(()=>{})}}catch{}setTimeout(()=>{const hr=document.getElementById("local-player");if(hr&&ar&&!x.current){x.current=!0;try{ar.play(hr,{fit:"contain"}),console.log(" Local video playing")}catch(Ar){console.warn("Local video play warning:",Ar),x.current=!1}}},1e3),pe.success(" You're LIVE!"),T.current&&T.current.emit("join-stream-room",{streamId:Ji.id})}catch(ct){console.error(" Agora setup error:",ct),oe(!1),x.current=!1,(ct==null?void 0:ct.name)==="NotAllowedError"||/Permission denied/i.test((ct==null?void 0:ct.message)||"")?pe.error("Camera/mic permission denied. Please allow access and retry."):/sd-rtn\.com/i.test((ct==null?void 0:ct.stack)||"")||/sd-rtn\.com/i.test((ct==null?void 0:ct.message)||"")||/config/i.test((ct==null?void 0:ct.message)||"")?pe.error("Agora config endpoint blocked. Disable ad-blocker/VPN/firewall and allow https://cds-web-2.ap.sd-rtn.com."):pe.error("Failed to start stream: "+((ct==null?void 0:ct.message)||"Unknown error"))}},ts=async()=>{if(!qe||!(qe!=null&&qe.id)){pe.error("Please sign in to go live");try{n("/login")}catch{}return}if(!V.title.trim()){pe.error("Please enter a stream title");return}if(V.streamMode==="solo")await js();else{oe(!0);try{const Be=`multi_${qe.id}_${Date.now()}`,{data:tt,error:bt}=await K.from("streams").insert({title:V.title,streamer_name:qe.username||qe.full_name,streamer_id:qe.id,streamer_avatar:qe.avatar,streamer_follower_count:qe.follower_count||0,streamer_created_date:qe.created_date,category:V.category,stream_mode:"multi",max_participants:V.maxParticipants,status:"live",streaming_backend:"webrtc-mesh",agora_channel_name:Be,thumbnail:V.thumbnailUrl||"",peer_id:null,last_heartbeat:new Date().toISOString(),viewer_count:0,is_live:!0}).select("*").single();if(bt)throw bt;const ct=tt;se(ct),Q(!0),oe(!1);try{const{data:Pt=[]}=await K.from("follows").select("follower_id").eq("following_id",qe.id);if(Array.isArray(Pt)&&Pt.length>0){const Ot=Pt.map(tr=>({user_id:tr.follower_id,type:"stream_live",title:"Stream Live",message:`${qe.username||qe.full_name} is live: ${ct.title}`,link_url:`${Or("StreamViewer")}?id=${ct.id}`,is_read:!1,created_date:new Date().toISOString()}));await K.from("notifications").insert(Ot).catch(()=>{})}}catch{}T.current&&T.current.emit("join-stream-room",{streamId:ct.id,maxParticipants:V.maxParticipants}),gt(Array.from({length:V.maxParticipants},(Pt,Ot)=>({id:Ot+1,occupiedBy:null,stream:null,joining:!1}))),pe.success("Multi-beam room created"),setTimeout(async()=>{try{const Pt=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});P.current[1]=Pt,gt(Ot=>Ot.map(tr=>tr.id===1?{...tr,occupiedBy:qe,stream:Pt,joining:!1}:tr)),T.current&&T.current.emit("join-box",{boxId:1,user:{id:qe.id,username:qe.username,avatar:qe.avatar},toRoom:ct.id}),await K.from("stream_participants").insert({stream_id:ct.id,user_id:qe.id,box_number:1,username:qe.username||qe.full_name,user_avatar:qe.avatar,user_level:qe.level||1,role:"host",is_publishing:!0,joined_at:new Date().toISOString()}),pe.success("You joined Box 1 as broadcaster")}catch(Pt){console.error("Failed to auto-join broadcaster:",Pt),pe.error("Could not start camera/mic. Please join manually.")}},500)}catch(Be){console.error("Create multi stream error",Be),oe(!1),pe.error("Failed to create multi-beam stream: "+Be.message)}}},_t=()=>{const Be=!Ze;Qe(Be),l.current?l.current.setEnabled(!Be):P.current[1]&&P.current[1].getAudioTracks().forEach(tt=>tt.enabled=!Be),pe.success(Be?" Microphone muted":" Microphone unmuted")},wr=()=>{const Be=!me;ye(Be),u.current?u.current.setEnabled(!Be):P.current[1]&&P.current[1].getVideoTracks().forEach(tt=>tt.enabled=!Be),pe.success(Be?" Camera off":" Camera on")},Ur=async()=>{if(G)try{if(x.current=!1,await K.from("streams").update({status:"ended",is_live:!1,ended_date:new Date().toISOString()}).eq("id",G.id),Object.values(P.current||{}).forEach(Be=>{try{Be.getTracks().forEach(tt=>tt.stop())}catch{}}),P.current={},Object.values(N.current||{}).forEach(Be=>{try{Be.close()}catch{}}),N.current={},l.current)try{l.current.stop(),l.current.close()}catch{}if(u.current)try{u.current.stop(),u.current.close()}catch{}if(a.current)try{await a.current.leave()}catch{}a.current=null,y.current&&clearInterval(y.current),w.current&&clearInterval(w.current),Q(!1),se(null),ce(0),De(0),z(1),W({title:"",category:"gaming",thumbnailUrl:"",streamMode:"solo",maxParticipants:1}),Ee(""),Qe(!1),ye(!1),oe(!1),i.invalidateQueries(["myActiveStreams"]),i.invalidateQueries(["streams"]),pe.success("Stream ended"),n(Or("Home"))}catch(Be){console.error("End stream error",Be),n(Or("Home"))}},dn=Be=>{const tt=Math.floor(Be/3600),bt=Math.floor(Be%3600/60),ct=Be%60;return tt>0?`${tt}h ${bt}m ${ct}s`:`${bt}m ${ct}s`},bs=()=>{if(((qe==null?void 0:qe.level)||1)>=20)return" Unlimited";const Be=7200-fe;if(Be<=0)return"Time's up!";const tt=Math.floor(Be/60),bt=Be%60;return`${tt}m ${bt}s left`},di=async(Be,tt)=>{try{const bt=new Date(Date.now()-9e5).toISOString(),{data:ct}=await K.from("chat_messages").select("id").eq("user_id",Be).eq("stream_id",tt).eq("message_type","chat").gte("created_date",bt).limit(1);if(ct&&ct.length>0)return!0;const{data:Pt}=await K.from("stream_likes").select("id").eq("user_id",Be).eq("stream_id",tt).gte("created_date",bt).limit(1);if(Pt&&Pt.length>0)return!0;const{data:Ot}=await K.from("stream_gifts").select("id").eq("sender_id",Be).eq("stream_id",tt).gte("created_date",bt).limit(1);return!!(Ot&&Ot.length>0)}catch(bt){return console.warn("Error checking user engagement:",bt),!0}};if(M.useEffect(()=>{if($&&G)return w.current=setInterval(async()=>{try{const{data:Be=[],error:tt}=await K.from("stream_viewers").select("*").eq("stream_id",G.id);if(tt){console.warn("viewer fetch error:",tt.message);return}const bt=Date.now(),ct=Be.filter(tr=>tr.last_heartbeat&&bt-new Date(tr.last_heartbeat).getTime()<3e4);ce(ct.length),await K.from("streams").update({viewer_count:ct.length,last_heartbeat:new Date().toISOString()}).eq("id",G.id);const Pt=Be.filter(tr=>!tr.last_heartbeat||bt-new Date(tr.last_heartbeat).getTime()>6e4);for(const tr of Pt)await K.from("stream_viewers").delete().eq("id",tr.id).catch(console.error);const Ot=Be.filter(tr=>{const Vo=bt-new Date(tr.last_heartbeat).getTime();return Vo<3e4&&Vo>6e5});for(const tr of Ot)await di(tr.user_id,G.id)||(console.log(`Kicking inactive viewer: ${tr.user_id} - no activity for 15+ minutes`),await K.from("stream_viewers").delete().eq("id",tr.id).catch(console.error))}catch(Be){console.error(Be)}},3e3),()=>{w.current&&clearInterval(w.current)}},[$,G]),M.useEffect(()=>{if($)return pt.current=Date.now(),y.current=setInterval(()=>{const Be=Math.floor((Date.now()-pt.current)/1e3);De(Be),((qe==null?void 0:qe.level)||1)<20&&Be>=7200&&(pe.warning("2 hour limit reached  ending stream"),Ur())},1e3),()=>{y.current&&clearInterval(y.current)}},[$,qe==null?void 0:qe.level]),M.useEffect(()=>{const Be=tt=>{ve&&!tt.target.closest(".box-controls-container")&&he(!1)};if(ve)return document.addEventListener("click",Be),()=>document.removeEventListener("click",Be)},[ve]),Wr)return o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-purple-500"})});if(!qe)return o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center p-6",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Please login to stream"}),o.jsx(ke,{type:"button",onClick:()=>K.auth.redirectToLogin(),children:"Login"})]})});if($&&G){const Be=G.stream_mode==="multi";return o.jsxs("div",{className:"min-h-screen bg-[#0a0a0f]",children:[je&&o.jsx("div",{style:{position:"fixed",inset:0,zIndex:999999,pointerEvents:"none"},children:o.jsx(mY,{username:je.username||je.email,onComplete:()=>_e(null)})}),o.jsx(Fwe,{gift:Je,onComplete:()=>st(null)}),o.jsx("div",{className:"border-b border-[#2a2a3a] bg-[#1a1a24]/80",children:o.jsx("div",{className:"container mx-auto px-4 py-4",children:o.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs(wt,{className:"bg-red-500 text-white px-4 py-2",children:[o.jsx("div",{className:"w-2 h-2 bg-white rounded-full mr-2 animate-pulse"}),"LIVE"]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-white font-bold",children:G.title}),o.jsx("p",{className:"text-gray-400 text-sm",children:G.category})]}),Be&&o.jsxs(wt,{className:"bg-purple-500 text-white",children:[o.jsx(lk,{className:"w-4 h-4 mr-1"}),G.max_participants," Boxes"]})]}),o.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[o.jsxs(wt,{variant:"outline",className:"bg-blue-500/20 px-4 py-2",children:[o.jsx(uo,{className:"w-4 h-4 mr-2"}),dn(fe)]}),((qe==null?void 0:qe.level)||1)<20&&o.jsxs(wt,{variant:"outline",className:"bg-yellow-500/20 text-yellow-400 px-4 py-2",children:[" ",bs()]}),o.jsxs(wt,{variant:"outline",className:"bg-purple-500/20 px-4 py-2",children:[o.jsx(Mm,{className:"w-4 h-4 mr-2"}),ie]}),o.jsxs(wt,{variant:"outline",className:"bg-yellow-500/20 text-yellow-400 px-4 py-2",children:[o.jsx(ni,{className:"w-4 h-4 mr-2"}),((qe==null?void 0:qe.coins)||0).toLocaleString()]}),Be&&o.jsxs("div",{className:"relative box-controls-container",children:[o.jsxs(ke,{type:"button",onClick:()=>he(!ve),variant:"outline",className:"bg-purple-600/20 border-purple-500 text-purple-300 hover:bg-purple-600/30",children:[o.jsx(lk,{className:"w-4 h-4 mr-2"}),"Boxes: ",G.max_participants]}),ve&&o.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-[#1a1a24] border border-[#2a2a3a] rounded-lg p-4 shadow-lg z-50 min-w-[200px]",children:[o.jsx("h3",{className:"text-white font-semibold mb-3",children:"Change Box Count"}),o.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:Array.from({length:13},(tt,bt)=>bt+1).map(tt=>o.jsx(ke,{type:"button",onClick:()=>En(tt),disabled:tt>=G.max_participants,variant:"outline",size:"sm",className:`${tt===G.max_participants?"bg-purple-500 text-white border-purple-500":tt<G.max_participants?"bg-red-500/20 border-red-500 text-red-300 hover:bg-red-500/30":"bg-gray-700/20 border-gray-600 text-gray-500 cursor-not-allowed"}`,children:tt},tt))}),o.jsx("p",{className:"text-xs text-gray-400 mb-3",children:" Downgrading will remove users from higher-numbered boxes"}),o.jsx(ke,{type:"button",onClick:()=>he(!1),variant:"outline",size:"sm",className:"w-full",children:"Close"})]})]}),o.jsx(ke,{type:"button",onClick:_t,variant:"outline",size:"icon",className:Ze?"border-red-500 text-red-400":"border-green-500 text-green-400",children:Ze?o.jsx(cle,{className:"w-4 h-4"}):o.jsx(dle,{className:"w-4 h-4"})}),o.jsx(ke,{type:"button",onClick:wr,variant:"outline",size:"icon",className:me?"border-red-500 text-red-400":"border-green-500 text-green-400",children:me?o.jsx(tde,{className:"w-4 h-4"}):o.jsx(nde,{className:"w-4 h-4"})}),o.jsx(ke,{type:"button",onClick:()=>Ur(),className:"bg-red-600 hover:bg-red-700",children:"End Stream"})]})]})})}),o.jsx("div",{className:"container mx-auto px-4 py-6",children:o.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[Be&&Lr.length>0&&o.jsx(Uwe,{stream:G,user:qe,isStreamer:!0}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] overflow-hidden",children:[!Be&&o.jsxs("div",{className:"relative aspect-video bg-black overflow-hidden",children:[" ",o.jsx("div",{id:"local-player",className:"w-full h-full",ref:tt=>{if(tt&&u.current&&!x.current){x.current=!0;try{u.current.play(tt,{fit:"cover"})}catch(bt){console.warn("Local video play warning:",bt),x.current=!1}}}}),o.jsx(wt,{className:"absolute top-4 left-4 bg-green-500 text-white z-10",children:"You (Broadcasting)"})]}),Be&&o.jsx("div",{className:"relative aspect-video bg-black p-2",children:o.jsx("div",{className:"grid gap-2 h-full",style:{gridTemplateColumns:`repeat(${G.max_participants<=1?1:G.max_participants<=4?2:G.max_participants<=9?3:4}, 1fr)`,gridTemplateRows:`repeat(${Math.ceil(G.max_participants/(G.max_participants<=1?1:G.max_participants<=4?2:G.max_participants<=9?3:4))}, 1fr)`},children:er.slice(0,G.max_participants).map(tt=>{var bt,ct,Pt,Ot;return o.jsx("div",{className:`relative bg-[#0a0a0f] rounded-lg border-2 ${tt.stream?"border-green-500":"border-dashed border-gray-700"} flex items-center justify-center transition-all duration-300`,style:{minHeight:"120px"},children:tt.stream?o.jsxs("div",{className:"w-full h-full relative",children:[o.jsx("video",{autoPlay:!0,playsInline:!0,ref:tr=>{tr&&tt.stream&&(tr.srcObject=tt.stream)},muted:((bt=tt.occupiedBy)==null?void 0:bt.id)===qe.id,className:"w-full h-full object-cover rounded-lg"}),o.jsx(wt,{className:"absolute top-2 left-2 bg-green-500 text-white text-xs z-10",children:((ct=tt.occupiedBy)==null?void 0:ct.id)===qe.id?"You":(Pt=tt.occupiedBy)==null?void 0:Pt.username}),((Ot=tt.occupiedBy)==null?void 0:Ot.id)===qe.id&&o.jsx(ke,{type:"button",onClick:()=>on(tt.id),variant:"outline",size:"sm",className:"absolute top-2 right-2",children:"Leave"})]}):o.jsxs("div",{className:"text-center p-4 w-full h-full flex flex-col items-center justify-center",children:[o.jsx(jn,{className:"w-8 h-8 text-gray-600 mx-auto mb-2"}),o.jsxs("p",{className:"text-gray-300 text-sm font-semibold",children:["Box ",tt.id]}),o.jsx("p",{className:"text-gray-500 text-xs",children:tt.occupiedBy?tt.occupiedBy.username:"Empty"}),!tt.occupiedBy&&tt.id!==1&&o.jsx(ke,{type:"button",disabled:tt.joining,onClick:()=>xt(tt.id),className:"mt-3 bg-purple-600 hover:bg-purple-700",size:"sm",children:tt.joining?"Joining...":"Join"})]})},`box-${tt.id}-${G.max_participants}`)})})})]})]}),o.jsx("div",{className:"lg:col-span-1",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] min-h-[300px] h-[55svh] md:h-[calc(100dvh-8rem)] lg:h-[calc(100dvh-8rem)] flex flex-col overflow-hidden",children:o.jsx(hY,{stream:G,user:qe,canModerate:!0})})})]})})]})}return o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Go Live"}),o.jsx(wt,{className:"bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-4 py-2",children:"Powered by Agora.io"})]}),o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8",children:o.jsxs(E2,{mode:"wait",children:[F===1&&o.jsxs(Xi.div,{initial:{opacity:0},animate:{opacity:1},children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Stream Details"}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-medium mb-2 block",children:"Title *"}),o.jsx(Zt,{value:V.title,onChange:Be=>W({...V,title:Be.target.value}),placeholder:"What are you streaming?",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",maxLength:100})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-medium mb-2 block",children:"Category *"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:te.filter(Be=>Be.id!=="all").map(Be=>o.jsx("button",{type:"button",onClick:()=>W({...V,category:Be.id}),className:`px-3 py-2 rounded-xl transition-all duration-150 text-sm font-medium ${V.category===Be.id?"bg-purple-500 text-white":"bg-black text-gray-300 hover:bg-purple-500/10"}`,children:Be.label},Be.id))}),o.jsxs(gs,{value:V.category,onValueChange:Be=>W({...V,category:Be}),children:[o.jsx(_s,{className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"gaming",children:" Gaming"}),o.jsx(Ct,{value:"music",children:" Music"}),o.jsx(Ct,{value:"talk",children:" Just Chatting"}),o.jsx(Ct,{value:"creative",children:" Creative"}),o.jsx(Ct,{value:"smoking",children:" Smoking"}),o.jsx(Ct,{value:"drinking",children:" Drinking"}),o.jsx(Ct,{value:"comedy",children:" Comedy"}),o.jsx(Ct,{value:"dating",children:" Dating"})]})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-medium mb-2 block",children:"Stream Mode *"}),o.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[o.jsx("button",{type:"button",onClick:()=>W({...V,streamMode:"solo",maxParticipants:1}),className:`px-3 py-2 rounded-xl transition-all duration-150 text-sm font-medium ${V.streamMode==="solo"?"bg-purple-500 text-white":"bg-black text-gray-300 hover:bg-purple-500/10"}`,children:" Solo Stream"}),o.jsx("button",{type:"button",onClick:()=>W({...V,streamMode:"multi",maxParticipants:Math.max(V.maxParticipants||4,4)}),className:`px-3 py-2 rounded-xl transition-all duration-150 text-sm font-medium ${V.streamMode==="multi"?"bg-purple-500 text-white":"bg-black text-gray-300 hover:bg-purple-500/10"}`,children:" Multi-Beam (Boxes)"})]}),o.jsxs(gs,{value:V.streamMode,onValueChange:Be=>W({...V,streamMode:Be,maxParticipants:Be==="solo"?1:4}),children:[o.jsx(_s,{className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"solo",children:" Solo Stream"}),o.jsx(Ct,{value:"multi",children:" Multi-Beam (Boxes)"})]})]})]}),V.streamMode==="multi"&&o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-medium mb-2 block",children:"Number of Boxes *"}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:[1,2,3,4,5,6,7,8,9,10,11,12,13].map(Be=>o.jsx("button",{type:"button",onClick:()=>W({...V,maxParticipants:Be}),className:`px-3 py-2 rounded-xl transition-all duration-150 text-sm font-medium ${V.maxParticipants===Be?"bg-purple-500 text-white":"bg-black text-gray-300 hover:bg-purple-500/10"}`,children:Be},Be))}),o.jsxs(gs,{value:V.maxParticipants.toString(),onValueChange:Be=>W({...V,maxParticipants:parseInt(Be)}),children:[o.jsx(_s,{className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsx(vs,{children:Array.from({length:13},(Be,tt)=>tt+1).map(Be=>o.jsxs(Ct,{value:Be.toString(),children:[Be," Box",Be===1?"":"es"]},Be))})]}),o.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[o.jsx(lk,{className:"w-3 h-3 inline mr-1"}),"Others can request to join your boxes"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-medium mb-2 block",children:"Thumbnail (Optional)"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("input",{ref:m,type:"file",accept:"image/*",onChange:async Be=>{var bt;const tt=(bt=Be.target.files)==null?void 0:bt[0];if(tt){if(!tt.type.startsWith("image/")){pe.error("Please upload an image file");return}if(tt.size>5*1024*1024){pe.error("Max 5MB");return}try{we(!0);const ct=new FileReader;ct.onloadend=()=>Ee(ct.result),ct.readAsDataURL(tt);const{file_url:Pt}=await K.integrations.Core.UploadFile({file:tt,bucket:"avatars",pathPrefix:"streams"});W({...V,thumbnailUrl:Pt}),pe.success("Thumbnail uploaded")}catch(ct){console.error(ct),pe.error("Failed to upload")}finally{we(!1)}}},className:"hidden"}),o.jsx(ke,{type:"button",onClick:()=>{var Be;return(Be=m.current)==null?void 0:Be.click()},disabled:Oe,variant:"outline",className:"flex-1 border-[#2a2a3a]",children:Oe?"Uploading...":o.jsxs(o.Fragment,{children:[o.jsx(DH,{className:"w-4 h-4 mr-2"}),"Upload Thumbnail"]})}),ge&&o.jsx("div",{className:"w-32 h-20 rounded overflow-hidden border border-green-500",children:o.jsx("img",{src:ge,alt:"Thumbnail",className:"w-full h-full object-cover"})})]}),o.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Or auto-capture from camera when going live"})]}),((qe==null?void 0:qe.level)||1)<20&&o.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-yellow-300",children:[o.jsx(uo,{className:"w-5 h-5"}),o.jsx("p",{className:"font-semibold",children:" 2 Hour Stream Limit"})]}),o.jsx("p",{className:"text-yellow-200 text-sm mt-2",children:"Your stream will automatically end after 2 hours. Reach Level 20 for unlimited streaming!"})]}),o.jsx(ke,{type:"button",onClick:()=>z(2),disabled:!V.title.trim(),className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 py-6",children:"Next"})]})]},"step1"),F===2&&o.jsxs(Xi.div,{initial:{opacity:0},animate:{opacity:1},children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Review & Go Live"}),o.jsxs("div",{className:"space-y-4 mb-6",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Title"}),o.jsx("p",{className:"text-white font-semibold",children:V.title})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Category"}),o.jsx("p",{className:"text-white font-semibold",children:V.category})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Mode"}),o.jsx("p",{className:"text-white font-semibold",children:V.streamMode==="solo"?" Solo Stream":` Multi-Beam (${V.maxParticipants} boxes)`})]}),ge&&o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Thumbnail"}),o.jsx("img",{src:ge,alt:"Thumbnail",className:"w-full h-32 object-cover rounded"})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{type:"button",onClick:()=>z(1),variant:"outline",className:"flex-1",disabled:Se,children:"Back"}),o.jsx(ke,{type:"button",onClick:ts,disabled:Se,className:"flex-1 bg-gradient-to-r from-red-500 to-pink-500 py-6",children:Se?"Starting...":" Go Live"})]})]},"step2")]})})]})})}function PY(){const i=Wn(),n=vn(),[a,l]=M.useState(1),[u,m]=M.useState(""),[y,w]=M.useState(""),[b,x]=M.useState(""),[T,N]=M.useState(null),[O,P]=M.useState(""),[F,z]=M.useState(""),[V,W]=M.useState(""),[te,$]=M.useState(""),[Q,G]=M.useState(""),[se,ie]=M.useState(""),[ce,Se]=M.useState(!1),[oe,ve]=M.useState(""),[he,Ze]=M.useState(!1),[Qe,me]=M.useState(!1);M.useEffect(()=>{const fe=new URLSearchParams(window.location.search).get("ref");fe&&(console.log(" Referral code detected:",fe),sessionStorage.setItem("referral_code",fe))},[]);const{data:ye}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me()});M.useEffect(()=>{let we=!1;const De=(u||"").toLowerCase().replace(/[^a-z0-9_]/g,"").trim();if(!De){ve("Username is required"),me(!1);return}if(De.length<3){ve("Username must be at least 3 characters"),me(!1);return}Ze(!0),ve("");const je=setTimeout(async()=>{try{const{data:_e,error:Je}=await K.from("profiles").select("id").ilike("username",De).neq("id",(ye==null?void 0:ye.id)||"").limit(1);if(we)return;Je?(console.warn("Username availability check failed:",Je.message),ve("Could not check username availability"),me(!1)):Array.isArray(_e)&&_e.length>0?(ve("Username is already taken"),me(!1)):(ve(""),me(!0))}catch(_e){we||(console.warn("Username availability check exception:",(_e==null?void 0:_e.message)||_e),ve("Could not check username availability"),me(!1))}finally{we||Ze(!1)}},300);return()=>{we=!0,clearTimeout(je)}},[u,ye==null?void 0:ye.id]);const ge=Wt({mutationFn:async()=>{if(!u||u.length<3)throw new Error("Username must be at least 3 characters");const we=u.toLowerCase().replace(/[^a-z0-9_]/g,"").trim();if(we.length<3)throw new Error("Username must be at least 3 characters and use a-z, 0-9, _");const{data:fe}=await K.from("profiles").select("id").ilike("username",we).neq("id",ye.id).limit(1);if(Array.isArray(fe)&&fe.length>0)throw new Error("Username is already taken. Please choose another.");let De=(ye==null?void 0:ye.avatar)||"";if(T){Se(!0);const vt=new FileReader,pt=await new Promise((en,Cn)=>{vt.onloadend=()=>en(vt.result),vt.onerror=Cn,vt.readAsDataURL(T)}),er=await cropImageToSquareBlob(pt,512),gt=(T.name||"avatar").replace(/\.[^/.]+$/,""),qe=new File([er],`${gt}.jpg`,{type:"image/jpeg"}),{file_url:Wr}=await K.integrations.Core.UploadFile({file:qe,bucket:"avatars",pathPrefix:"avatars"});De=Wr,Se(!1)}const je=`${we.toUpperCase().substring(0,4)}${Math.random().toString(36).substring(2,6).toUpperCase()}`,_e={username:we,display_name:y.trim()||ye.full_name,bio:b.trim()||"",avatar:De,payment_method:F,profile_completed:!0,referral_code:je};if(F==="paypal")_e.payment_email=V;else if(F==="zelle")_e.payment_email=V;else if(F==="cashapp"||F==="venmo"){let vt=te.trim();F==="cashapp"&&!vt.startsWith("$")&&(vt="$"+vt),_e.payment_username=vt}else F==="bank_transfer"&&(_e.bank_account_number=Q,_e.bank_routing_number=se);const{error:Je}=await K.from("profiles").update(_e).eq("id",ye.id);if(Je){const vt=Object.keys(_e);let pt=!1,er=Je;for(const gt of vt){const qe={[gt]:_e[gt]},{error:Wr}=await K.from("profiles").update(qe).eq("id",ye.id);Wr?er=Wr:pt=!0}if(!pt&&er)throw er}const st=sessionStorage.getItem("referral_code");if(st){console.log(" Processing referral with code:",st);const vt=await K.entities.User.filter({referral_code:st});if(vt.length>0){const pt=vt[0];console.log(" Found referrer:",pt.username||pt.full_name),await K.entities.Referral.create({referrer_id:pt.id,referrer_name:pt.full_name,referrer_username:pt.username||pt.full_name,referred_id:ye.id,referred_name:ye.full_name,referred_username:we,referral_code:st,status:"pending",reward_given:!1,referred_user_level:1});const{error:er}=await K.from("profiles").update({referred_by_code:st}).eq("id",ye.id);if(er){const{error:gt}=await K.from("profiles").update({referred_by_code:st}).eq("id",ye.id);gt&&console.warn("Failed to set referred_by_code:",gt.message)}console.log(" Referral record created"),pe.success(`Welcome! You were referred by ${pt.username||pt.full_name}`)}else console.log(" Referrer not found for code:",st);sessionStorage.removeItem("referral_code")}},onSuccess:()=>{n.invalidateQueries(["currentUser"]),pe.success("Profile setup complete! Welcome to TrollCity! "),setTimeout(()=>{i(Or("Home"))},1e3)},onError:we=>{console.error(" Profile setup error:",we),pe.error(we.message||"Failed to complete setup")}}),Ee=we=>{const fe=we.target.files[0];if(fe){N(fe);const De=new FileReader;De.onloadend=()=>P(De.result),De.readAsDataURL(fe)}},Oe=()=>{if(a===1){if(!u){pe.error("Username is required");return}if(u.length<3){pe.error("Username must be at least 3 characters");return}l(2)}else if(a===2){if(!F){pe.error("Please select a payment method");return}if(F==="paypal"&&!V.includes("@")){pe.error("Please enter a valid PayPal email");return}if((F==="cashapp"||F==="venmo")&&!te.trim()){pe.error(`Please enter your ${F==="cashapp"?"Cash App Tag":"Venmo Username"}`);return}if(F==="bank_transfer"&&(!Q.trim()||!se.trim())){pe.error("Please enter both bank account and routing numbers");return}ge.mutate()}};return ye?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 flex items-center justify-center",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 w-full max-w-2xl",children:[o.jsxs("div",{className:"mb-8 text-center",children:[o.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:["Welcome to ",o.jsx("span",{className:"text-emerald-400",children:"Troll"}),o.jsx("span",{className:"text-cyan-400",children:"City"}),"! "]}),o.jsx("p",{className:"text-gray-400",children:"Let's set up your profile"})]}),o.jsx("div",{className:"flex items-center justify-center mb-8",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:`flex items-center gap-2 ${a>=1?"text-purple-400":"text-gray-500"}`,children:[o.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${a>=1?"bg-purple-500":"bg-gray-700"}`,children:a>1?o.jsx(Ui,{className:"w-5 h-5"}):"1"}),o.jsx("span",{className:"font-semibold",children:"Profile"})]}),o.jsx("div",{className:"w-16 h-0.5 bg-gray-700"}),o.jsxs("div",{className:`flex items-center gap-2 ${a>=2?"text-green-400":"text-gray-500"}`,children:[o.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${a>=2?"bg-green-500":"bg-gray-700"}`,children:"2"}),o.jsx("span",{className:"font-semibold",children:"Payment"})]})]})}),a===1&&o.jsxs("div",{className:"space-y-6",children:[o.jsx("div",{className:"flex justify-center",children:o.jsxs("div",{className:"relative",children:[O||ye.avatar?o.jsx("img",{src:O||ye.avatar,alt:"Avatar",className:"w-32 h-32 rounded-full object-cover ring-4 ring-purple-500"}):o.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center ring-4 ring-purple-500",children:o.jsx(Pa,{className:"w-16 h-16 text-white"})}),o.jsxs("label",{className:"absolute bottom-0 right-0 bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-full cursor-pointer",children:[o.jsx(NH,{className:"w-5 h-5"}),o.jsx("input",{type:"file",accept:"image/*",onChange:Ee,className:"hidden"})]})]})}),o.jsxs("div",{children:[o.jsxs(jr,{className:"text-white mb-2 flex items-center gap-2",children:[o.jsx(dce,{className:"w-4 h-4"}),"Username *"]}),o.jsx(Zt,{value:u,onChange:we=>m(we.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"")),placeholder:"coolstreamer123",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",maxLength:20}),o.jsxs("div",{className:"mt-1",children:[he&&o.jsx("p",{className:"text-xs text-gray-400",children:"Checking availability"}),!he&&oe&&o.jsx("p",{className:"text-xs text-red-400",children:oe}),!he&&!oe&&u.length>=3&&o.jsx("p",{className:"text-xs text-emerald-400",children:"Username is available"}),o.jsx("p",{className:"text-xs text-gray-500",children:"3-20 characters, letters, numbers and underscores only"})]})]}),o.jsxs("div",{children:[o.jsxs(jr,{className:"text-white mb-2 flex items-center gap-2",children:[o.jsx(Pa,{className:"w-4 h-4"}),"Display Name (optional)"]}),o.jsx(Zt,{value:y,onChange:we=>w(we.target.value),placeholder:ye.full_name,className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",maxLength:50})]}),o.jsxs("div",{children:[o.jsxs(jr,{className:"text-white mb-2 flex items-center gap-2",children:[o.jsx(mp,{className:"w-4 h-4"}),"Bio (optional)"]}),o.jsx(Nl,{value:b,onChange:we=>x(we.target.value),placeholder:"Tell us about yourself...",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white min-h-[100px]",maxLength:500}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b.length,"/500 characters"]})]}),o.jsx(ke,{type:"button",onClick:Oe,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 py-6 text-lg",disabled:he||!!oe,children:"Next: Payment Setup"})]}),a===2&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs(ke,{type:"button",variant:"ghost",onClick:()=>l(1),className:"text-gray-400 hover:text-white mb-4",children:[o.jsx(RH,{className:"w-4 h-4 mr-2"}),"Back"]}),o.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-6",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Es,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-blue-300 font-semibold mb-1",children:" Why add payment info now?"}),o.jsx("p",{className:"text-blue-200 text-sm",children:"To cash out your earnings later, you'll need to reach your payout tier. Adding your payment method now saves time when you're ready to cash out!"})]})]})}),o.jsxs("div",{children:[o.jsxs(jr,{className:"text-white mb-2 flex items-center gap-2",children:[o.jsx(Es,{className:"w-4 h-4"}),"Payment Method *"]}),o.jsxs(gs,{value:F,onValueChange:z,children:[o.jsx(_s,{className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",children:o.jsx(ys,{placeholder:"Select payment method"})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"paypal",children:" PayPal"}),o.jsx(Ct,{value:"cashapp",children:" Cash App"}),o.jsx(Ct,{value:"venmo",children:" Venmo"}),o.jsx(Ct,{value:"zelle",children:" Zelle"}),o.jsx(Ct,{value:"bank_transfer",children:" Bank Transfer"})]})]})]}),F==="paypal"&&o.jsxs("div",{children:[o.jsx(jr,{className:"text-white mb-2",children:"PayPal Email *"}),o.jsx(Zt,{type:"email",value:V,onChange:we=>W(we.target.value),placeholder:"your@email.com",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),F==="cashapp"&&o.jsxs("div",{children:[o.jsx(jr,{className:"text-white mb-2",children:"Cash App Tag *"}),o.jsx(Zt,{value:te,onChange:we=>$(we.target.value),placeholder:"$YourCashTag",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your $cashtag (e.g., $johndoe)"})]}),F==="venmo"&&o.jsxs("div",{children:[o.jsx(jr,{className:"text-white mb-2",children:"Venmo Username *"}),o.jsx(Zt,{value:te,onChange:we=>$(we.target.value),placeholder:"@YourVenmo",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your Venmo username (e.g., @johndoe)"})]}),F==="zelle"&&o.jsxs("div",{children:[o.jsx(jr,{className:"text-white mb-2",children:"Zelle Email or Phone *"}),o.jsx(Zt,{value:V,onChange:we=>W(we.target.value),placeholder:"your@email.com or phone number",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),F==="bank_transfer"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(jr,{className:"text-white mb-2",children:"Bank Account Number *"}),o.jsx(Zt,{value:Q,onChange:we=>G(we.target.value),placeholder:"Account number",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx(jr,{className:"text-white mb-2",children:"Routing Number *"}),o.jsx(Zt,{value:se,onChange:we=>ie(we.target.value),placeholder:"Routing number",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]})]}),o.jsx(ke,{onClick:Oe,disabled:ge.isPending||ce,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 py-6 text-lg",children:ge.isPending||ce?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}),ce?"Uploading avatar...":"Completing setup..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Ui,{className:"w-5 h-5 mr-2"}),"Complete Setup"]})}),o.jsx("p",{className:"text-center text-xs text-gray-500",children:"You can update your payment method later in your profile settings"})]})]})}):o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})})}function DY({name:i="Troll Family"}){return o.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-purple-600/20 text-purple-300 border border-purple-600/30 text-xs",children:[o.jsx("span",{children:""}),o.jsx("span",{children:i})]})}function jY(){var Cn,Lr;const i=vn(),n=M.useRef(null),a=(Le,it="MMMM d, yyyy")=>{try{if(!Le)return"Unknown";const jt=new Date(Le);return isNaN(jt.getTime())?"Unknown":hp(jt,it)}catch{return"Unknown"}},[l,u]=M.useState(!1),[m,y]=M.useState({}),[w,b]=M.useState(!1),[x,T]=M.useState(""),[N,O]=M.useState(""),[P,F]=M.useState(""),[z,V]=M.useState(""),[W,te]=M.useState(""),[$,Q]=M.useState(""),[G,se]=M.useState(""),[ie,ce]=M.useState(""),[Se,oe]=M.useState({profile:!0,stats:!1,moderation:!1,streams:!1,effects:!1,payment:!1,settings:!1}),ve=Le=>{oe(it=>({...it,[Le]:!it[Le]}))},{data:he,isLoading:Ze}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me(),refetchInterval:5e3}),{data:Qe=[]}=mt({queryKey:["myStreams",he==null?void 0:he.id],queryFn:async()=>he?await K.entities.Stream.filter({streamer_id:he.id},"-created_date",10):[],enabled:!!he,initialData:[]}),me=M.useMemo(()=>{if(!Qe.length)return 0;let Le=0;return Qe.forEach(it=>{if(it.created_date){const jt=new Date(it.created_date),Tr=(it.updated_date?new Date(it.updated_date):new Date)-jt;Le+=Math.floor(Tr/1e3/60)}}),(Le/60).toFixed(1)},[Qe]),{data:ye=[]}=mt({queryKey:["userEffects",he==null?void 0:he.id],queryFn:()=>K.entities.UserEntranceEffect.filter({user_id:he.id}),initialData:[],enabled:!!(he!=null&&he.id)}),{data:ge=[]}=mt({queryKey:["paymentVerifications",he==null?void 0:he.id],queryFn:async()=>he?await K.entities.PaymentVerification.filter({user_id:he.id}):[],enabled:!!he,initialData:[]}),{data:Ee=[]}=mt({queryKey:["kickHistory",he==null?void 0:he.id],queryFn:async()=>{if(!(he!=null&&he.id))return[];const{data:Le,error:it}=await K.from("kicked_users").select(`
          *,
          kicked_by_user:profiles!kicked_by(id, username, full_name)
        `).eq("user_id",he.id).order("kicked_at",{ascending:!1});return it?(console.error("Error fetching kick history:",it),[]):Le||[]},enabled:!!(he!=null&&he.id)}),{data:Oe=[]}=mt({queryKey:["banHistory",he==null?void 0:he.id],queryFn:async()=>{if(!(he!=null&&he.id))return[];const{data:Le,error:it}=await K.from("banned_users").select(`
          *,
          banned_by_user:profiles!banned_by(id, username, full_name)
        `).eq("user_id",he.id).order("created_at",{ascending:!1});return it?(console.error("Error fetching ban history:",it),[]):Le||[]},enabled:!!(he!=null&&he.id)}),we=Wt({mutationFn:async Le=>{const it={...Le};if(typeof it.username=="string"){const on=it.username.toLowerCase().replace(/[^a-z0-9_]/g,"");if(on.length<3)throw new Error("Username must be at least 3 characters and use a-z, 0-9, _");const{data:Sr}=await K.from("profiles").select("id").ilike("username",on).neq("id",he.id).limit(1);if(Array.isArray(Sr)&&Sr.length>0)throw new Error("Username is already taken. Please choose another.");it.username=on}const{error:jt}=await K.from("profiles").update(it).eq("id",he.id);if(!jt)return;const xt=Object.keys(it);let Tr=!1,An=jt;for(const En of xt){const on={[En]:it[En]},{error:Sr}=await K.from("profiles").update(on).eq("id",he.id);Sr?An=Sr:Tr=!0}if(!Tr&&An)throw An},onSuccess:async(Le,it)=>{const jt={...it};typeof jt.username=="string"&&(jt.username=jt.username.toLowerCase().replace(/[^a-z0-9_]/g,"")),i.setQueryData(["currentUser"],xt=>xt&&{...xt,...jt});try{const{data:xt}=await K.from("profiles").select("*").eq("id",he.id).single();xt&&i.setQueryData(["currentUser"],Tr=>Tr&&{...Tr,...xt})}catch{}i.invalidateQueries(["currentUser"]),u(!1),pe.success("Profile updated successfully!")},onError:Le=>{pe.error(Le.message||"Failed to update profile")}}),fe=Wt({mutationFn:async Le=>{await K.entities.UserEntranceEffect.filter({user_id:he.id}).then(xt=>{xt.forEach(Tr=>K.entities.UserEntranceEffect.update(Tr.id,{is_active:!1}))});const it=ye.find(xt=>xt.id===Le);await K.entities.UserEntranceEffect.update(Le,{is_active:!0});const{error:jt}=await K.from("profiles").update({active_entrance_effect:(it==null?void 0:it.animation_type)||null,active_entrance_effect_name:(it==null?void 0:it.effect_name)||null}).eq("id",he.id);if(jt)throw jt},onSuccess:()=>{i.invalidateQueries(["userEffects"]),i.invalidateQueries(["currentUser"]),pe.success("Entrance effect activated!")}});Wt({mutationFn:async({method:Le,details:it})=>{const jt=Math.floor(1e5+Math.random()*9e5).toString();return await K.entities.PaymentVerification.create({user_id:he.id,user_name:he.full_name,payment_method:Le,payment_details:it,verification_code:jt,verified_by_user:!1,verified_by_admin:!1}),jt},onSuccess:Le=>{i.invalidateQueries(["paymentVerifications"]),pe.success(`Verification started! Code: ${Le}`),O(""),F("")},onError:Le=>{pe.error(Le.message||"Failed to start verification")}});const De=Wt({mutationFn:async({verificationId:Le,code:it})=>{if(ge.find(xt=>xt.id===Le).verification_code!==it)throw new Error("Invalid verification code");await K.entities.PaymentVerification.update(Le,{verified_by_user:!0,verification_date:new Date().toISOString()})},onSuccess:()=>{i.invalidateQueries(["paymentVerifications"]),pe.success("Payment method verified! Awaiting admin approval."),T("")},onError:Le=>{pe.error(Le.message)}}),je=Wt({mutationFn:async({applePayId:Le})=>{if(!Le.trim())throw new Error("Please enter Apple Pay details");const{error:it}=await K.from("profiles").update({payout_method:"apple_pay",apple_pay_id:Le,last_payout_date:new Date().toISOString()}).eq("id",he.id);if(it)throw it;return Le},onSuccess:()=>{i.invalidateQueries(["currentUser"]),pe.success("Apple Pay setup complete! Payment method updated."),V("")},onError:Le=>{pe.error(Le.message||"Failed to setup Apple Pay")}}),_e=Wt({mutationFn:async({googleWalletId:Le})=>{if(!Le.trim())throw new Error("Please enter Google Wallet details");const{error:it}=await K.from("profiles").update({payout_method:"google_wallet",google_wallet_id:Le,last_payout_date:new Date().toISOString()}).eq("id",he.id);if(it)throw it;return Le},onSuccess:()=>{i.invalidateQueries(["currentUser"]),pe.success("Google Wallet setup complete! Payment method updated."),te("")},onError:Le=>{pe.error(Le.message||"Failed to setup Google Wallet")}}),Je=Wt({mutationFn:async({chimeId:Le})=>{if(!Le.trim())throw new Error("Please enter Chime details");const{error:it}=await K.from("profiles").update({payout_method:"chime",chime_id:Le,last_payout_date:new Date().toISOString()}).eq("id",he.id);if(it)throw it;return Le},onSuccess:()=>{i.invalidateQueries(["currentUser"]),pe.success("Chime setup complete! Payment method updated."),Q("")},onError:Le=>{pe.error(Le.message||"Failed to setup Chime")}}),st=Wt({mutationFn:async({cashappTag:Le})=>{if(!Le.trim())throw new Error("Please enter CashApp tag");if(!Le.startsWith("$"))throw new Error("CashApp tag must start with $ symbol");const{error:it}=await K.from("profiles").update({payout_method:"cashapp",cashapp_tag:Le,last_payout_date:new Date().toISOString()}).eq("id",he.id);if(it)throw it;return Le},onSuccess:()=>{i.invalidateQueries(["currentUser"]),pe.success("CashApp setup complete! Payment method updated."),se("")},onError:Le=>{pe.error(Le.message||"Failed to setup CashApp")}}),vt=Wt({mutationFn:async({chargeAmount:Le})=>{const it=parseInt(Le);if(isNaN(it)||it<0)throw new Error("Please enter a valid charge amount");const{error:jt}=await K.from("profiles").update({message_charge_amount:it,message_charge_enabled:it>0}).eq("id",he.id);if(jt)throw jt;return it},onSuccess:()=>{i.invalidateQueries(["currentUser"]),pe.success("Message charge settings updated!")},onError:Le=>{pe.error(Le.message||"Failed to update message charge")}}),pt=Wt({mutationFn:async()=>{await K.entities.User.update(he.id,{is_deleted:!0,deleted_date:new Date().toISOString()}),await K.auth.signOut()},onError:Le=>{pe.error(Le.message||"Failed to delete account")}});Wt({mutationFn:async()=>{const Le=typeof window<"u"?window.location.origin:"",it={user_id:he.id,user_email:he.email,return_url:`${Le}/profile?connected=stripe`,refresh_url:`${Le}/profile?connect=retry`},{data:jt,error:xt}=await K.functions.invoke("createstripeconnect",{body:it,headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZmZwc2JpY2llZ3h4b25zeHpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NDEyMzgsImV4cCI6MjA3ODMxNzIzOH0.Rfb4WfqYHCGwZHv8HE3OxUSZbpEFqTfAnL0K4jaFnZU","x-client-info":"trollcity-web"}});if(xt)throw xt;const Tr=(jt==null?void 0:jt.url)||(jt==null?void 0:jt.onboarding_url)||null;if(Tr)return Tr;throw new Error("Failed to start Stripe onboarding: missing URL from function")},onSuccess:Le=>{try{window.location.href=Le}catch{pe.error("Unable to redirect to Stripe onboarding")}},onError:Le=>{pe.error((Le==null?void 0:Le.message)||"Failed to start Stripe onboarding")}}),M.useEffect(()=>{try{new URLSearchParams(window.location.search).get("connected")==="stripe"&&(pe.success("Payouts connected with Stripe. You're all set!"),i.invalidateQueries(["currentUser"]))}catch{}},[i]);const er=Le=>new Promise((it,jt)=>{const xt=new FileReader;xt.onload=Tr=>it(Tr.target.result),xt.onerror=jt,xt.readAsDataURL(Le)}),gt=(Le,it=512)=>new Promise((jt,xt)=>{const Tr=new Image;Tr.onload=()=>{const An=Math.min(Tr.width,Tr.height),En=(Tr.width-An)/2,on=(Tr.height-An)/2,Sr=document.createElement("canvas");Sr.width=it,Sr.height=it;const js=Sr.getContext("2d");try{js.drawImage(Tr,En,on,An,An,0,0,it,it),Sr.toBlob(ts=>{if(ts)jt(ts);else{const _t=Sr.toDataURL("image/jpeg",.9);fetch(_t).then(wr=>wr.blob()).then(jt).catch(xt)}},"image/jpeg",.9)}catch(ts){xt(ts)}},Tr.onerror=xt,Tr.src=Le});M.useEffect(()=>{if(he)try{const Le=localStorage.getItem(`tc_avatar_${he.id}`);Le&&i.setQueryData(["currentUser"],it=>it&&{...it,avatar:Le})}catch{}},[he,i]);const qe=async Le=>{var jt;const it=(jt=Le.target.files)==null?void 0:jt[0];if(it){if(!it.type.startsWith("image/")){pe.error("Please upload an image file");return}try{b(!0);const xt=await er(it),Tr=await gt(xt,512),An=(it.name||"avatar").replace(/\.[^/.]+$/,""),En=new File([Tr],`${An}.jpg`,{type:"image/jpeg"});let on=null;try{const{file_url:Sr}=await K.integrations.Core.UploadFile({file:En,bucket:"avatars",pathPrefix:"avatars"});on=Sr}catch{on=xt;try{localStorage.setItem(`tc_avatar_${he.id}`,xt)}catch{}}if(on){if(K.__isConfigured)try{const Sr=[{avatar:on},{avatar_url:on}];let js=!1;for(const ts of Sr){const{error:_t}=await K.from("profiles").update(ts).eq("id",he.id);if(!_t){js=!0;break}}js||i.setQueryData(["currentUser"],ts=>ts&&{...ts,avatar:on})}catch{i.setQueryData(["currentUser"],js=>js&&{...js,avatar:on})}else i.setQueryData(["currentUser"],Sr=>Sr&&{...Sr,avatar:on});i.invalidateQueries(["currentUser"]),pe.success("Avatar updated!")}else throw new Error("Failed to process avatar")}catch(xt){const Tr=(xt==null?void 0:xt.message)||"Failed to upload avatar";pe.error(Tr)}finally{b(!1)}}},Wr=Le=>Le>=71?{tier:5,color:"from-red-600 to-black",name:"Graveyard"}:Le>=1&&Le<=9?{tier:1,color:"from-gray-500 to-slate-500",name:"Newbie"}:Le>=10&&Le<=19?{tier:2,color:"from-blue-500 to-cyan-500",name:"Rising Star"}:Le>=20&&Le<=29?{tier:3,color:"from-purple-500 to-pink-500",name:"Elite"}:Le>=30?{tier:4,color:"from-yellow-500 to-orange-500",name:"Legend"}:{tier:1,color:"from-gray-500 to-slate-500",name:"Newbie"};if(Ze)return o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-purple-500"})});if(!he)return o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center p-4",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center max-w-md w-full",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Please login to view profile"}),o.jsx(ke,{onClick:()=>K.auth.redirectToLogin(),children:"Login"})]})});const en=Wr(he.level||1);return o.jsx("div",{className:"min-h-screen bg-[#0a0a0f] p-4",children:o.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsxs("div",{className:"relative",children:[he.avatar?o.jsx("img",{src:he.avatar,alt:he.username,className:"w-24 h-24 rounded-full object-cover"}):o.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white text-3xl font-bold",children:(Lr=(Cn=he.username)==null?void 0:Cn[0])==null?void 0:Lr.toUpperCase()})}),o.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:qe,className:"hidden"}),o.jsx(ke,{size:"icon",onClick:()=>{var Le;return(Le=n.current)==null?void 0:Le.click()},disabled:w,className:"absolute bottom-0 right-0 rounded-full bg-purple-600 hover:bg-purple-700",children:o.jsx(NH,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-2",children:[o.jsxs("h1",{className:"text-2xl font-bold text-white",children:["@",he.username||he.full_name]}),o.jsx(VR,{user:he,size:"md"})]}),o.jsx("p",{className:"text-gray-400 text-sm",children:he.email}),o.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[o.jsxs(wt,{className:`bg-gradient-to-r ${en.color} text-white`,children:["Level ",he.level||1,"  ",en.name]}),o.jsx(DY,{user:he})]})]})]})}),o.jsx(Sc,{open:Se.profile,onOpenChange:()=>ve("profile"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Pa,{className:"w-5 h-5 text-purple-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Profile Info"})]}),Se.profile?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsx("div",{className:"p-4 pt-0 space-y-4",children:l?o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-400 text-sm mb-1 block",children:"Username"}),o.jsx(Zt,{value:m.username,onChange:Le=>y({...m,username:Le.target.value}),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-400 text-sm mb-1 block",children:"Bio"}),o.jsx(Nl,{value:m.bio,onChange:Le=>y({...m,bio:Le.target.value}),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white h-20",maxLength:200})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{onClick:()=>we.mutate(m),disabled:we.isPending,className:"flex-1 bg-green-600 hover:bg-green-700",children:[o.jsx(RR,{className:"w-4 h-4 mr-2"}),"Save"]}),o.jsx(ke,{onClick:()=>u(!1),variant:"outline",className:"flex-1 border-[#2a2a3a]",children:"Cancel"})]})]}):o.jsxs(o.Fragment,{children:[he.bio&&o.jsx("p",{className:"text-gray-300 text-sm",children:he.bio}),o.jsxs(ke,{onClick:()=>{u(!0),y({bio:he.bio||"",username:he.username||""})},className:"w-full bg-purple-600 hover:bg-purple-700",children:[o.jsx(SD,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})})})]})}),o.jsx(Sc,{open:Se.stats,onOpenChange:()=>ve("stats"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(PH,{className:"w-5 h-5 text-yellow-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Stats"})]}),Se.stats?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsxs("div",{className:"p-4 pt-0 grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3 text-center",children:[o.jsx(ni,{className:"w-6 h-6 text-yellow-400 mx-auto mb-1"}),o.jsx("p",{className:"text-gray-400 text-xs",children:"Coins"}),o.jsx("p",{className:"text-white font-bold",children:(he.coins||0).toLocaleString()})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3 text-center",children:[o.jsx(Es,{className:"w-6 h-6 text-green-400 mx-auto mb-1"}),o.jsx("p",{className:"text-gray-400 text-xs",children:"Earned"}),o.jsx("p",{className:"text-white font-bold",children:(he.earned_coins||0).toLocaleString()})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3 text-center",children:[o.jsx(jn,{className:"w-6 h-6 text-blue-400 mx-auto mb-1"}),o.jsx("p",{className:"text-gray-400 text-xs",children:"Followers"}),o.jsx("p",{className:"text-white font-bold",children:he.follower_count||0})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3 text-center",children:[o.jsx(Si,{className:"w-6 h-6 text-red-400 mx-auto mb-1"}),o.jsx("p",{className:"text-gray-400 text-xs",children:"Streams"}),o.jsx("p",{className:"text-white font-bold",children:Qe.length})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3 text-center col-span-2",children:[o.jsx(uo,{className:"w-6 h-6 text-purple-400 mx-auto mb-1"}),o.jsx("p",{className:"text-gray-400 text-xs",children:"Hours Streamed"}),o.jsxs("p",{className:"text-white font-bold",children:[me,"h"]})]})]})})]})}),o.jsx(Sc,{open:Se.moderation,onOpenChange:()=>ve("moderation"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Oc,{className:"w-5 h-5 text-red-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Moderation History"}),o.jsx(wt,{className:"bg-red-500",children:Ee.length+Oe.length})]}),Se.moderation?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsxs("div",{className:"p-4 pt-0 space-y-4",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-red-400 font-semibold text-sm",children:"Kick History"}),o.jsx(wt,{className:"bg-red-500 text-xs",children:Ee.length})]}),Ee.length===0?o.jsx("p",{className:"text-gray-500 text-xs",children:"No kicks recorded"}):o.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:Ee.map((Le,it)=>{var jt;return o.jsx("div",{className:"bg-[#1a1a24] rounded p-2",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsxs("p",{className:"text-white text-xs font-medium",children:["Kicked by @",((jt=Le.kicked_by_user)==null?void 0:jt.username)||"Unknown"]}),o.jsx("p",{className:"text-gray-400 text-xs",children:Le.reason||"No reason provided"})]}),o.jsx("span",{className:"text-gray-500 text-xs",children:a(Le.kicked_at,"MMM d, yyyy")})]})},it)})})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-red-400 font-semibold text-sm",children:"Ban History"}),o.jsx(wt,{className:"bg-red-500 text-xs",children:Oe.length})]}),Oe.length===0?o.jsx("p",{className:"text-gray-500 text-xs",children:"No bans recorded"}):o.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:Oe.map((Le,it)=>{var jt;return o.jsx("div",{className:"bg-[#1a1a24] rounded p-2",children:o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{children:[o.jsxs("p",{className:"text-white text-xs font-medium",children:["Banned by @",((jt=Le.banned_by_user)==null?void 0:jt.username)||"Unknown"]}),o.jsx("p",{className:"text-gray-400 text-xs",children:Le.reason||"No reason provided"}),Le.expires_at&&o.jsxs("p",{className:"text-yellow-400 text-xs",children:["Expires: ",a(Le.expires_at,"MMM d, yyyy")]})]}),o.jsx("span",{className:"text-gray-500 text-xs",children:a(Le.created_at,"MMM d, yyyy")})]})},it)})})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-purple-400 font-semibold text-sm",children:"Troller Level"}),o.jsx(wt,{className:"bg-purple-500 text-xs",children:Ee.length+Oe.length===0?"0%":`${Math.min(100,Math.round((Ee.length+Oe.length)/10*100))}%`})]}),o.jsx("div",{className:"w-full bg-[#1a1a24] rounded-full h-2",children:o.jsx("div",{className:"bg-gradient-to-r from-green-500 to-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,(Ee.length+Oe.length)/10*100)}%`}})}),o.jsx("p",{className:"text-gray-400 text-xs mt-1",children:Ee.length+Oe.length===0?"Clean record!":Ee.length+Oe.length<3?"Minor offenses":Ee.length+Oe.length<6?"Moderate troller":Ee.length+Oe.length<10?"Serious troller":"Maximum troll!"})]})]})})]})}),o.jsx(Sc,{open:Se.streams,onOpenChange:()=>ve("streams"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Si,{className:"w-5 h-5 text-red-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Recent Streams"}),o.jsx(wt,{className:"bg-red-500",children:Qe.length})]}),Se.streams?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsx("div",{className:"p-4 pt-0 space-y-2",children:Qe.length===0?o.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No streams yet"}):Qe.map(Le=>o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("h3",{className:"text-white font-semibold text-sm",children:Le.title}),Le.is_live&&o.jsx(wt,{className:"bg-red-500 text-xs",children:"LIVE"})]}),o.jsx("p",{className:"text-gray-400 text-xs",children:a(Le.created_date,"MMM d, yyyy")})]},Le.id))})})]})}),o.jsx(Sc,{open:Se.effects,onOpenChange:()=>ve("effects"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(lP,{className:"w-5 h-5 text-purple-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Entrance Effects"}),o.jsx(wt,{className:"bg-purple-500",children:ye.length})]}),Se.effects?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsx("div",{className:"p-4 pt-0 space-y-2",children:ye.length===0?o.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No effects owned"}):ye.map(Le=>o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3 flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-semibold text-sm",children:Le.effect_name}),o.jsx("p",{className:"text-gray-400 text-xs",children:Le.animation_type})]}),o.jsx(ke,{size:"sm",onClick:()=>fe.mutate(Le.id),disabled:Le.is_active,className:Le.is_active?"bg-green-600":"bg-purple-600 hover:bg-purple-700",children:Le.is_active?o.jsxs(o.Fragment,{children:[o.jsx(AH,{className:"w-3 h-3 mr-1"}),"Active"]}):"Activate"})]},Le.id))})})]})}),o.jsx(Sc,{open:Se.payment,onOpenChange:()=>ve("payment"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(_y,{className:"w-5 h-5 text-green-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Payment Methods"})]}),Se.payment?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsxs("div",{className:"p-4 pt-0 space-y-3",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("label",{className:"text-white font-medium mb-3 block text-sm",children:" CashApp"}),o.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Enter your CashApp tag (e.g., $YourTag)"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Zt,{value:G,onChange:Le=>se(Le.target.value),placeholder:"$YourCashAppTag",className:"bg-[#1a1a24] border-[#2a2a3a] text-white"}),o.jsxs("div",{className:"text-xs",children:[G&&!G.startsWith("$")&&o.jsx("p",{className:"text-red-400",children:" Must start with $ symbol"}),G&&G.startsWith("$")&&o.jsx("p",{className:"text-green-400",children:" Valid CashApp format"})]}),o.jsxs(ke,{onClick:()=>{if(!G.trim()){alert("Please enter your CashApp tag");return}if(!G.startsWith("$")){alert("CashApp tag must start with $ symbol");return}st.mutate({cashappTag:G})},disabled:!G||!G.startsWith("$")||st.isPending,className:"w-full bg-emerald-600 hover:bg-emerald-700",children:[o.jsx(Es,{className:"w-4 h-4 mr-2"}),"Connect CashApp"]})]}),he.payout_method==="cashapp"&&o.jsxs("div",{className:"mt-3 p-2 bg-green-900/30 rounded border border-green-600",children:[o.jsx("p",{className:"text-green-400 text-xs",children:" CashApp connected"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["Tag: ",he.cashapp_tag]})]})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("label",{className:"text-white font-medium mb-3 block text-sm",children:" Apple Pay"}),o.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Enter your Apple Pay email or phone number"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Zt,{value:z,onChange:Le=>V(Le.target.value),placeholder:"Email or Phone Number",className:"bg-[#1a1a24] border-[#2a2a3a] text-white"}),o.jsxs("div",{className:"text-xs",children:[z&&z.length<3&&o.jsx("p",{className:"text-red-400",children:" Must be at least 3 characters"}),z&&z.length>=3&&o.jsx("p",{className:"text-green-400",children:" Valid format"})]}),o.jsxs(ke,{onClick:()=>{if(!z.trim()){alert("Please enter your Apple Pay details");return}if(z.length<3){alert("Apple Pay details must be at least 3 characters");return}je.mutate({applePayId:z})},disabled:!z||z.length<3||je.isPending,className:"w-full bg-blue-600 hover:bg-blue-700",children:[o.jsx(Ple,{className:"w-4 h-4 mr-2"}),"Connect Apple Pay"]})]}),he.payout_method==="apple_pay"&&o.jsxs("div",{className:"mt-3 p-2 bg-green-900/30 rounded border border-green-600",children:[o.jsx("p",{className:"text-green-400 text-xs",children:" Apple Pay connected"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["ID: ",he.apple_pay_id]})]})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("label",{className:"text-white font-medium mb-3 block text-sm",children:" Google Wallet"}),o.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Enter your Google Wallet email"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Zt,{value:W,onChange:Le=>te(Le.target.value),placeholder:"Google Email Address",className:"bg-[#1a1a24] border-[#2a2a3a] text-white"}),o.jsxs("div",{className:"text-xs",children:[W&&W.length<3&&o.jsx("p",{className:"text-red-400",children:" Must be at least 3 characters"}),W&&W.length>=3&&o.jsx("p",{className:"text-green-400",children:" Valid format"})]}),o.jsxs(ke,{onClick:()=>{if(!W.trim()){alert("Please enter your Google Wallet email");return}if(W.length<3){alert("Google Wallet email must be at least 3 characters");return}_e.mutate({googleWalletId:W})},disabled:!W||W.length<3||_e.isPending,className:"w-full bg-orange-600 hover:bg-orange-700",children:[o.jsx(ide,{className:"w-4 h-4 mr-2"}),"Connect Google Wallet"]})]}),he.payout_method==="google_wallet"&&o.jsxs("div",{className:"mt-3 p-2 bg-green-900/30 rounded border border-green-600",children:[o.jsx("p",{className:"text-green-400 text-xs",children:" Google Wallet connected"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["Email: ",he.google_wallet_id]})]})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("label",{className:"text-white font-medium mb-3 block text-sm",children:" Chime"}),o.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Enter your Chime account email or username"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Zt,{value:$,onChange:Le=>Q(Le.target.value),placeholder:"Chime Email or Username",className:"bg-[#1a1a24] border-[#2a2a3a] text-white"}),o.jsxs("div",{className:"text-xs",children:[$&&$.length<3&&o.jsx("p",{className:"text-red-400",children:" Must be at least 3 characters"}),$&&$.length>=3&&o.jsx("p",{className:"text-green-400",children:" Valid format"})]}),o.jsxs(ke,{onClick:()=>{if(!$.trim()){alert("Please enter your Chime details");return}if($.length<3){alert("Chime details must be at least 3 characters");return}Je.mutate({chimeId:$})},disabled:!$||$.length<3||Je.isPending,className:"w-full bg-purple-600 hover:bg-purple-700",children:[o.jsx(_ce,{className:"w-4 h-4 mr-2"}),"Connect Chime"]})]}),he.payout_method==="chime"&&o.jsxs("div",{className:"mt-3 p-2 bg-green-900/30 rounded border border-green-600",children:[o.jsx("p",{className:"text-green-400 text-xs",children:" Chime connected"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["Account: ",he.chime_id]})]})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsx("label",{className:"text-white font-medium mb-3 block text-sm",children:" Message Charging"}),o.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Charge users paid coins to message you (0 = free)"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Zt,{value:ie,onChange:Le=>ce(Le.target.value),placeholder:"Amount in coins (e.g., 50)",className:"bg-[#1a1a24] border-[#2a2a3a] text-white",type:"number",min:"0"}),o.jsxs("div",{className:"text-xs",children:[ie&&parseInt(ie)>0&&o.jsxs("p",{className:"text-green-400",children:[" Users will pay ",ie," coins per message"]}),ie&&parseInt(ie)===0&&o.jsx("p",{className:"text-blue-400",children:" Messaging is free"})]}),o.jsxs(ke,{onClick:()=>{const Le=parseInt(ie);if(isNaN(Le)||Le<0){alert("Please enter a valid amount (0 or positive number)");return}vt.mutate({chargeAmount:ie})},disabled:!ie||vt.isPending,className:"w-full bg-indigo-600 hover:bg-indigo-700",children:[o.jsx(mp,{className:"w-4 h-4 mr-2"}),"Update Message Charge"]})]}),he.message_charge_enabled&&o.jsxs("div",{className:"mt-3 p-2 bg-blue-900/30 rounded border border-blue-600",children:[o.jsx("p",{className:"text-blue-400 text-xs",children:" Message charging enabled"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["Cost: ",he.message_charge_amount," coins per message"]})]})]}),ge.map(Le=>o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-white font-semibold text-sm capitalize",children:Le.payment_method.replace("_"," ")}),o.jsx(wt,{className:Le.verified_by_admin?"bg-green-500":Le.verified_by_user?"bg-yellow-500":"bg-gray-500",children:Le.verified_by_admin?"Verified":Le.verified_by_user?"Pending":"Unverified"})]}),!Le.verified_by_user&&o.jsxs("div",{className:"flex gap-2 mt-2",children:[o.jsx(Zt,{value:x,onChange:it=>T(it.target.value),placeholder:"Enter code",className:"bg-[#1a1a24] border-[#2a2a3a] text-white text-sm"}),o.jsx(ke,{size:"sm",onClick:()=>De.mutate({verificationId:Le.id,code:x}),children:"Verify"})]})]},Le.id))]})})]})}),o.jsx(Sc,{open:Se.settings,onOpenChange:()=>ve("settings"),children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(xc,{className:"w-full p-4 flex items-center justify-between hover:bg-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(My,{className:"w-5 h-5 text-gray-400"}),o.jsx("span",{className:"text-white font-semibold",children:"Account Settings"})]}),Se.settings?o.jsx(Zf,{className:"w-5 h-5 text-gray-400"}):o.jsx(bc,{className:"w-5 h-5 text-gray-400"})]}),o.jsx(Tc,{children:o.jsxs("div",{className:"p-4 pt-0 space-y-4",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Message Charge Amount"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(Zt,{value:ie,onChange:Le=>ce(Le.target.value),placeholder:"Amount in coins (e.g., 50)",className:"bg-[#1a1a24] border-[#2a2a3a] text-white text-sm",type:"number",min:"0"}),o.jsxs("div",{className:"text-xs",children:[ie&&parseInt(ie)>0&&o.jsxs("p",{className:"text-green-400",children:[" Users pay ",ie," coins per message"]}),ie&&parseInt(ie)===0&&o.jsx("p",{className:"text-blue-400",children:" Messaging is free"})]}),o.jsxs(ke,{onClick:()=>{const Le=parseInt(ie);if(isNaN(Le)||Le<0){alert("Please enter a valid amount (0 or positive number)");return}vt.mutate({chargeAmount:ie})},disabled:!ie||vt.isPending,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-xs py-2",size:"sm",children:[o.jsx(mp,{className:"w-3 h-3 mr-1"}),"Update Charge"]})]})]}),o.jsx(Dbe,{}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Member Since"}),o.jsx("p",{className:"text-white text-sm",children:a(he.created_date,"MMMM d, yyyy")})]}),o.jsxs(ke,{onClick:()=>{confirm("Delete account? This cannot be undone!")&&pt.mutate()},variant:"destructive",className:"w-full",children:[o.jsx(Oc,{className:"w-4 h-4 mr-2"}),"Delete Account"]})]})})]})})]})})}function Dbe(){const i=vn(),[n,a]=M.useState([]),[l,u]=M.useState(!0),m=Wt({mutationFn:async y=>{const{data:{user:w}}=await K.auth.getUser();if(!w)throw new Error("Not authenticated");const{error:b}=await K.from("blocked_users").delete().eq("blocker_id",w.id).eq("blocked_id",y);if(b)throw b;return y},onSuccess:y=>{pe.success("User unblocked successfully"),a(w=>w.filter(b=>b.id!==y)),i.invalidateQueries(["blockedUsers"])},onError:y=>{pe.error(y.message||"Failed to unblock user")}});return M.useEffect(()=>{(async()=>{try{const{data:{user:w}}=await K.auth.getUser();if(!w){u(!1);return}const{data:b,error:x}=await K.from("blocked_users").select(`
            blocked_id,
            created_at,
            blocked_user:profiles!blocked_id(id, username, full_name, avatar_url)
          `).eq("blocker_id",w.id).order("created_at",{ascending:!1});if(x){console.warn("Error fetching blocked users (table may be new):",x),a([]);return}const T=(b||[]).map(N=>{var O,P,F;return{id:N.blocked_id,username:((O=N.blocked_user)==null?void 0:O.username)||"Unknown User",fullName:((P=N.blocked_user)==null?void 0:P.full_name)||"Unknown User",avatarUrl:(F=N.blocked_user)==null?void 0:F.avatar_url,blockedAt:N.created_at}});a(T)}catch(w){console.warn("Failed to fetch blocked users:",w),a([])}finally{u(!1)}})()},[]),l?o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Blocked Users"}),o.jsx("div",{className:"flex items-center justify-center py-4",children:o.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})})]}):o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-gray-400 text-xs",children:"Blocked Users"}),o.jsx(wt,{className:"bg-red-500 text-white text-xs",children:n.length})]}),n.length===0?o.jsx("p",{className:"text-gray-500 text-xs",children:"No users blocked"}):o.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:n.map(y=>o.jsxs("div",{className:"flex items-center justify-between bg-[#1a1a24] rounded p-2",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("img",{src:y.avatarUrl||"/default-avatar.png",alt:y.username,className:"w-6 h-6 rounded-full object-cover",onError:w=>{w.target.src="/default-avatar.png"}}),o.jsxs("div",{children:[o.jsxs("p",{className:"text-white text-xs font-medium",children:["@",y.username]}),o.jsx("p",{className:"text-gray-400 text-xs",children:y.fullName})]})]}),o.jsx(ke,{onClick:()=>m.mutate(y.id),disabled:m.isPending,variant:"outline",size:"sm",className:"text-xs py-1 px-2 border-red-500 text-red-400 hover:bg-red-500 hover:text-white",children:"Unblock"})]},y.id))})]})}function LY(){return o.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-yellow-600/20 text-yellow-300 border border-yellow-600/30 text-xs",children:[o.jsx("span",{children:""}),o.jsx("span",{children:"OG"})]})}function MY({stream:i,onStreamClick:n,onUserClick:a,adminControls:l}){var w,b;const u=Wn(),{data:m}=mt({queryKey:["streamerProfileForCard",i==null?void 0:i.streamer_id],queryFn:async()=>{if(!(i!=null&&i.streamer_id))return null;const{data:x,error:T}=await K.from("profiles").select("id, avatar, avatar_url, username, created_date").eq("id",i.streamer_id).single();return T?null:x||null},staleTime:3e4,enabled:!!(i!=null&&i.streamer_id)&&!(i!=null&&i.streamer_avatar)}),y=()=>{n?n(i.id):u(Or("StreamViewer")+`?streamId=${i.id}`)};return o.jsxs("div",{className:"group relative bg-[#1a1a24] rounded-2xl overflow-hidden border border-[#2a2a3a] hover:border-purple-500/50 transition-all duration-300 hover:scale-[1.02] cursor-pointer",children:[l&&o.jsx("div",{className:"absolute top-2 right-2 z-20",children:o.jsxs(ke,{type:"button",onClick:x=>{x.stopPropagation(),l.onEndStream(i.id)},size:"sm",className:"bg-red-600 hover:bg-red-700 text-white",children:[o.jsx(Aw,{className:"w-4 h-4 mr-1"}),"End"]})}),o.jsxs("div",{onClick:y,className:"relative aspect-video bg-black/50 overflow-hidden",children:[i.thumbnail_url?o.jsx("img",{src:i.thumbnail_url,alt:i.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onError:x=>{x.target.style.display="none",x.target.nextElementSibling.style.display="flex"}}):null,o.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-900/50 to-pink-900/50 flex items-center justify-center",style:{display:i.thumbnail_url?"none":"flex"},children:o.jsx(Si,{className:"w-16 h-16 text-purple-300/30"})}),o.jsx("div",{className:"absolute top-3 left-3",children:o.jsxs(wt,{className:"bg-red-500 text-white px-3 py-1 font-bold",children:[o.jsx("div",{className:"w-2 h-2 bg-white rounded-full mr-2 animate-pulse"}),"LIVE"]})}),o.jsxs("div",{className:"absolute top-3 right-3 bg-black/70 backdrop-blur-sm px-3 py-1 rounded-full flex items-center gap-2",children:[o.jsx(Mm,{className:"w-4 h-4 text-white"}),o.jsx("span",{className:"text-white text-sm font-semibold",children:i.viewer_count||0})]}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"})]}),o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{onClick:x=>{x.stopPropagation(),a?a(i.streamer_id):u(Or("PublicProfile")+`?userId=${i.streamer_id}`)},className:"flex items-start gap-3 mb-3 cursor-pointer hover:opacity-80 transition-opacity",children:[i.streamer_avatar||m!=null&&m.avatar||m!=null&&m.avatar_url?o.jsx("img",{src:i.streamer_avatar||(m==null?void 0:m.avatar)||(m==null?void 0:m.avatar_url),alt:i.streamer_name,className:"w-10 h-10 rounded-full object-cover ring-2 ring-purple-500 flex-shrink-0",onError:x=>{x.target.style.display="none",x.target.nextElementSibling.style.display="flex"}}):null,o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center ring-2 ring-purple-500 flex-shrink-0",style:{display:i.streamer_avatar||m!=null&&m.avatar||m!=null&&m.avatar_url?"none":"flex"},children:o.jsx("span",{className:"text-white font-bold text-sm",children:(b=(w=i.streamer_name)==null?void 0:w[0])==null?void 0:b.toUpperCase()})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{onClick:x=>{x.stopPropagation(),y()},className:"text-white font-semibold text-base line-clamp-2 mb-1 hover:text-purple-400 transition-colors",children:i.title}),o.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[o.jsx("p",{className:"text-gray-400 text-sm font-medium hover:text-purple-400 transition-colors",children:i.streamer_name}),o.jsx(LY,{user:{created_date:i.streamer_created_date}})]})]})]}),o.jsx("div",{className:"mb-3",children:o.jsx(wt,{className:"bg-purple-500/20 text-purple-300 border border-purple-500/30 hover:bg-purple-500/30 transition-colors",children:i.category})}),o.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(Ru,{className:"w-4 h-4"}),o.jsx("span",{children:i.likes||0})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(Um,{className:"w-4 h-4"}),o.jsx("span",{children:i.chat_message_count||0})]}),i.stream_mode==="multi"&&o.jsxs("div",{className:"flex items-center gap-1 text-cyan-400",children:[o.jsx(jn,{className:"w-4 h-4"}),o.jsx("span",{children:"Multi-Beam"})]})]})]})]})}function Nc({className:i="",width:n,height:a}){const l={};return n&&(l.width=n),a&&(l.height=a),o.jsx("div",{className:`animate-pulse bg-[#1a1a24] border border-[#2a2a3a] rounded ${i}`,style:l})}function UY(){const[i,n]=M.useState(""),a=Wn(),{data:l=[],isLoading:u}=mt({queryKey:["trendingStreams"],queryFn:async()=>await K.entities.Stream.filter({status:"live",is_live:!0},"-viewer_count"),initialData:[],refetchInterval:3e3}),m=l.filter(w=>{var x,T;if(!i)return!0;const b=i.toLowerCase();return((x=w.title)==null?void 0:x.toLowerCase().includes(b))||((T=w.streamer_name)==null?void 0:T.toLowerCase().includes(b))}),y=l.reduce((w,b)=>w+(b.viewer_count||0),0);return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] pb-20",children:[o.jsx("div",{className:"text-center pt-12 pb-8 px-6",children:o.jsxs(Xi.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[o.jsx(kw,{className:"w-10 h-10 text-red-400"}),o.jsx("h1",{className:"text-5xl font-black text-white",children:"Trending"})]}),o.jsx("p",{className:"text-gray-400 text-lg mb-6",children:" Hottest streams right now"}),o.jsxs("div",{className:"flex items-center justify-center gap-3",children:[o.jsxs(wt,{className:"bg-red-600/20 border border-red-500/50 text-red-400 px-5 py-2.5",children:[o.jsx($ce,{className:"w-4 h-4 mr-2"}),l.length," Live"]}),o.jsxs(wt,{className:"bg-purple-600/20 border border-purple-500/50 text-purple-400 px-5 py-2.5",children:[o.jsx(Mm,{className:"w-4 h-4 mr-2"}),y," Watching"]})]})]})}),o.jsx("div",{className:"px-6 mb-6",children:o.jsxs("div",{className:"max-w-2xl mx-auto relative",children:[o.jsx(oR,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),o.jsx(Zt,{placeholder:"Search trending streams...",value:i,onChange:w=>n(w.target.value),className:"pl-12 py-6 bg-[#1a1a24]/50 backdrop-blur-sm border-[#2a2a3a] text-white rounded-2xl"})]})}),o.jsx("div",{className:"px-6",children:o.jsx("div",{className:"max-w-7xl mx-auto",children:u?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array(8).fill(0).map((w,b)=>o.jsxs("div",{className:"space-y-3",children:[o.jsx(Nc,{className:"aspect-[16/10] w-full bg-[#1a1a24] rounded-2xl"}),o.jsx(Nc,{className:"h-4 w-3/4 bg-[#1a1a24]"}),o.jsx(Nc,{className:"h-4 w-1/2 bg-[#1a1a24]"})]},b))}):m.length===0?o.jsxs("div",{className:"bg-[#1a1a24]/50 backdrop-blur-sm border border-[#2a2a3a] rounded-3xl p-12 text-center",children:[o.jsx(kw,{className:"w-20 h-20 text-gray-600 mx-auto mb-4"}),o.jsx("h3",{className:"text-2xl font-bold text-gray-300 mb-2",children:"No trending streams"}),o.jsx("p",{className:"text-gray-500",children:"Check back later for hot content!"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:m.map(w=>o.jsx(MY,{stream:w,onStreamClick:b=>a(Or("StreamViewer")+`?streamId=${b}`),onUserClick:b=>a(Or("PublicProfile")+`?userId=${b}`)},w.id))})})})]})}function FY(){const i=Wn(),[n,a]=M.useState(""),[l,u]=M.useState(!1),{data:m}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me()}),{data:y=[]}=mt({queryKey:["myFollowing",m==null?void 0:m.id],queryFn:async()=>m?await K.entities.Follow.filter({follower_id:m.id}):[],enabled:!!m,initialData:[]}),{data:w=[],isLoading:b}=mt({queryKey:["followingStreams",m==null?void 0:m.id],queryFn:async()=>{if(!m||y.length===0)return[];const F=y.map(V=>V.following_id);return(await K.entities.Stream.filter({status:"live",is_live:!0},"-viewer_count")).filter(V=>F.includes(V.streamer_id))},enabled:!!m&&y.length>0,initialData:[],refetchInterval:5e3}),{data:x=[],isLoading:T}=mt({queryKey:["allLiveStreams"],queryFn:async()=>await K.entities.Stream.filter({status:"live",is_live:!0,agora_channel_name_ne:null},"-viewer_count",50),enabled:l,initialData:[],refetchInterval:1e4}),N=l?T:b,O=l?x:w,P=O.filter(F=>{var V,W;if(!n)return!0;const z=n.toLowerCase();return((V=F.title)==null?void 0:V.toLowerCase().includes(z))||((W=F.streamer_name)==null?void 0:W.toLowerCase().includes(z))});return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] pb-20",children:[o.jsx("div",{className:"text-center pt-12 pb-8 px-6",children:o.jsxs(Xi.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[o.jsx(Ru,{className:"w-10 h-10 text-pink-400"}),o.jsx("h1",{className:"text-5xl font-black text-white",children:l?"All Streams":"Following"})]}),o.jsx("p",{className:"text-gray-400 text-lg mb-6",children:l?" Browse all live streams":" Streams from creators you follow"}),o.jsxs("div",{className:"flex items-center justify-center gap-3",children:[o.jsxs(wt,{className:"bg-pink-600/20 border border-pink-500/50 text-pink-400 px-5 py-2.5",children:[o.jsx(jn,{className:"w-4 h-4 mr-2"}),y.length," Following"]}),o.jsxs(wt,{className:"bg-purple-600/20 border border-purple-500/50 text-purple-400 px-5 py-2.5",children:[o.jsx(Mm,{className:"w-4 h-4 mr-2"}),O.length," Live Now"]})]})]})}),o.jsx("div",{className:"px-6 mb-4",children:o.jsxs("div",{className:"max-w-2xl mx-auto flex gap-2",children:[o.jsxs(ke,{onClick:()=>{u(!1),a("")},className:`flex-1 ${l?"bg-[#1a1a24] hover:bg-[#2a2a3a] text-gray-300":"bg-pink-600 hover:bg-pink-700"}`,children:[o.jsx(Ru,{className:"w-4 h-4 mr-2"}),"Following"]}),o.jsxs(ke,{onClick:()=>{u(!0),a("")},className:`flex-1 ${l?"bg-purple-600 hover:bg-purple-700":"bg-[#1a1a24] hover:bg-[#2a2a3a] text-gray-300"}`,children:[o.jsx(Si,{className:"w-4 h-4 mr-2"}),"All Streams"]})]})}),o.jsx("div",{className:"px-6 mb-6",children:o.jsxs("div",{className:"max-w-2xl mx-auto relative",children:[o.jsx(oR,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),o.jsx(Zt,{placeholder:l?"Search all streamers...":"Search followed streamers...",value:n,onChange:F=>a(F.target.value),className:"pl-12 py-6 bg-[#1a1a24]/50 backdrop-blur-sm border-[#2a2a3a] text-white rounded-2xl"})]})}),o.jsx("div",{className:"px-6",children:o.jsx("div",{className:"max-w-7xl mx-auto",children:N?o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array(4).fill(0).map((F,z)=>o.jsxs("div",{className:"space-y-3",children:[o.jsx(Nc,{className:"aspect-[16/10] w-full bg-[#1a1a24] rounded-2xl"}),o.jsx(Nc,{className:"h-4 w-3/4 bg-[#1a1a24]"}),o.jsx(Nc,{className:"h-4 w-1/2 bg-[#1a1a24]"})]},z))}):P.length===0?o.jsxs("div",{className:"bg-[#1a1a24]/50 backdrop-blur-sm border border-[#2a2a3a] rounded-3xl p-12 text-center",children:[o.jsx(Ru,{className:"w-20 h-20 text-gray-600 mx-auto mb-4"}),o.jsx("h3",{className:"text-2xl font-bold text-gray-300 mb-2",children:!l&&y.length===0?"Not following anyone yet":"No streams found"}),o.jsx("p",{className:"text-gray-500",children:!l&&y.length===0?"Follow creators to see their streams here":n?"Try a different search term or check for typos.":"Check back later when streams go live."})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:P.map(F=>o.jsx(MY,{stream:F,onStreamClick:z=>i(Or("StreamViewer")+`?streamId=${z}`),onUserClick:z=>i(Or("PublicProfile")+`?userId=${z}`)},F.id))})})})]})}function VY(){const i=Wn(),[n]=TH(),a=n.get("userId");n.get("username");const{data:l}=mt({queryKey:["targetUser",a],queryFn:async()=>{if(!a)return null;const{data:x,error:T}=await K.from("profiles").select("id, username, full_name, avatar, bio, level, is_verified").eq("id",a).single();return T?(console.error("Error fetching target user:",T),null):x},enabled:!!a}),{data:u=[],isLoading:m}=mt({queryKey:["followers",a],queryFn:async()=>{if(!a)return[];try{const{data:x,error:T}=await K.from("follows").select("follower_id, created_at").eq("following_id",a).order("created_at",{ascending:!1});if(T)return console.error("Error fetching follows:",T),[];if(!x||x.length===0)return[];const N=x.map(z=>z.follower_id),{data:O,error:P}=await K.from("profiles").select("id, username, full_name, avatar, bio, level, is_verified, created_date").in("id",N);return P?(console.error("Error fetching follower profiles:",P),[]):(O==null?void 0:O.map(z=>{const V=x.find(W=>W.follower_id===z.id);return{...z,followed_at:V==null?void 0:V.created_at}}))||[]}catch(x){return console.error("Error in followers query:",x),[]}},enabled:!!a}),{data:y}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:x}=await K.auth.getUser();return(x==null?void 0:x.user)||null}}),w=x=>{i(`${Or("PublicProfile")}?userId=${x}`)},b=()=>{i(l?`${Or("PublicProfile")}?userId=${l.id}`:-1)};return a?m?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx(Nc,{className:"h-8 w-32 bg-[#1a1a24] mb-4"}),o.jsx(Nc,{className:"h-12 w-64 bg-[#1a1a24] mb-2"}),o.jsx(Nc,{className:"h-6 w-48 bg-[#1a1a24]"})]}),o.jsx("div",{className:"space-y-4",children:Array(6).fill(0).map((x,T)=>o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(Nc,{className:"w-12 h-12 rounded-full bg-[#0a0a0f]"}),o.jsxs("div",{className:"flex-1",children:[o.jsx(Nc,{className:"h-4 w-32 bg-[#0a0a0f] mb-2"}),o.jsx(Nc,{className:"h-3 w-48 bg-[#0a0a0f]"})]})]})},T))})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs(ke,{onClick:b,variant:"outline",className:"mb-6 border-[#2a2a3a] text-gray-300 hover:bg-[#1a1a24]",children:[o.jsx(RH,{className:"w-4 h-4 mr-2"}),"Back to Profile"]}),o.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[o.jsx(jn,{className:"w-8 h-8 text-purple-400"}),o.jsxs("div",{children:[o.jsxs("h1",{className:"text-3xl font-bold text-white",children:[l?`@${l.username}'s`:"User's"," Followers"]}),o.jsxs("p",{className:"text-gray-400",children:[u.length," ",u.length===1?"person follows":"people follow"," ",l?l.username:"this user"]})]})]})]}),u.length===0?o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-12 text-center",children:[o.jsx(jn,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),o.jsx("h3",{className:"text-xl font-bold text-gray-300 mb-2",children:"No followers yet"}),o.jsxs("p",{className:"text-gray-500",children:[l?`@${l.username}`:"This user"," doesn't have any followers yet."]})]}):o.jsx("div",{className:"space-y-4",children:u.map(x=>o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4 hover:bg-[#1a1a24]/80 transition-all cursor-pointer",onClick:()=>w(x.id),children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"relative",children:[x.avatar?o.jsx("img",{src:x.avatar,alt:x.username,className:"w-12 h-12 rounded-full object-cover"}):o.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:o.jsx(Pa,{className:"w-6 h-6 text-white"})}),x.is_verified&&o.jsx(wt,{className:"absolute -top-1 -right-1 bg-blue-500 text-white text-xs p-0 w-5 h-5 flex items-center justify-center",children:""})]}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsxs("h3",{className:"font-semibold text-white",children:["@",x.username]}),o.jsxs(wt,{className:"bg-purple-500 text-white text-xs",children:["Lvl ",x.level||1]})]}),x.bio&&o.jsx("p",{className:"text-gray-400 text-sm line-clamp-2",children:x.bio}),o.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(wD,{className:"w-3 h-3"}),"Followed ",new Date(x.followed_at).toLocaleDateString()]}),x.created_date&&o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Pa,{className:"w-3 h-3"}),"Joined ",new Date(x.created_date).toLocaleDateString()]})]})]}),o.jsx(ke,{variant:"outline",className:"border-purple-500 text-purple-400 hover:bg-purple-500/10",onClick:T=>{T.stopPropagation(),w(x.id)},children:"View Profile"})]})},x.id))})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center p-6",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:o.jsx("p",{className:"text-white",children:"No user specified"})})})}function BY(){const i=vn(),n=Wn(),[a,l]=M.useState(null),[u,m]=M.useState("drivers_license"),[y,w]=M.useState(""),[b,x]=M.useState(""),[T,N]=M.useState(!1),{data:O}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me()}),{data:P}=mt({queryKey:["broadcasterApplication",O==null?void 0:O.id],queryFn:async()=>O&&(await K.entities.BroadcasterApplication.filter({user_id:O.id}))[0]||null,enabled:!!(O!=null&&O.id)}),F=Wt({mutationFn:async()=>{if(!a)throw new Error("Please upload your ID document");if(!b)throw new Error("Please enter ID expiry date");const Se=new Date(b)<new Date;if(Se)throw new Error("Your ID has expired. Please provide a valid ID.");N(!0);const{file_url:oe}=await K.integrations.Core.UploadFile({file:a,bucket:"avatars",pathPrefix:"ids"}),ve=await K.integrations.Core.InvokeLLM({prompt:`Analyze this ID document image and verify:
1. Is this a valid government-issued ID?
2. Can you read the expiration date?
3. Does it appear to be authentic (not fake or photoshopped)?
4. Is the document clear and readable?

Respond with a JSON object containing:
- is_valid: boolean
- expiry_date_readable: boolean
- appears_authentic: boolean
- is_clear: boolean
- notes: string (any concerns or observations)`,file_urls:[oe],response_json_schema:{type:"object",properties:{is_valid:{type:"boolean"},expiry_date_readable:{type:"boolean"},appears_authentic:{type:"boolean"},is_clear:{type:"boolean"},notes:{type:"string"}}}});N(!1);const he=ve.is_valid&&ve.appears_authentic&&ve.is_clear&&!Se,Ze=await K.entities.BroadcasterApplication.create({user_id:O.id,user_name:O.full_name,user_email:O.email,username:O.username||O.full_name,user_level:O.level||1,id_type:u,id_photo_url:oe,full_legal_name:O.full_name,date_of_birth:O.date_of_birth||"",status:he?"approved":"pending",agreed_to_terms:!0});return he&&await K.auth.updateMe({is_broadcaster_approved:!0}),{app:Ze,shouldApprove:he}},onSuccess:({shouldApprove:ie})=>{i.invalidateQueries(["currentUser"]),i.invalidateQueries(["broadcasterApplication"]),ie?pe.success(" Application Approved! You can now cash out your earnings."):pe.warning("Application submitted for manual review. We'll notify you once approved.")},onError:ie=>{N(!1),pe.error(ie.message||"Application failed. Please try again.")}}),z=ie=>{const ce=ie.target.files[0];if(ce){if(ce.size>10*1024*1024){pe.error("File size must be less than 10MB");return}l(ce)}},V=ie=>{ie.preventDefault(),F.mutate()},W=(O==null?void 0:O.level)||1,te=W>=1,$=ie=>Math.floor(1500*Math.pow(1.6,ie-1)),G=(ie=>{let ce=0;for(let Se=1;Se<ie;Se++)ce+=$(Se);return ce})(1),se=(O==null?void 0:O.experience)||0;return(P==null?void 0:P.status)==="approved"||O!=null&&O.is_broadcaster_approved?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:o.jsx("div",{className:"max-w-2xl mx-auto",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:[o.jsx(Ui,{className:"w-20 h-20 text-green-500 mx-auto mb-4"}),o.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:" Broadcaster Approved!"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"You're all set to receive payouts"}),o.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-4 mb-6",children:o.jsx("p",{className:"text-green-300 text-sm",children:"Your broadcaster application has been approved. You can now cash out your earnings from the Earnings page."})}),o.jsx(ke,{onClick:()=>n("/#/Earnings"),className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700",children:"Go to Earnings Page"})]})})}):(P==null?void 0:P.status)==="pending"?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:o.jsx("div",{className:"max-w-2xl mx-auto",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:[o.jsx(yy,{className:"w-20 h-20 text-yellow-500 mx-auto mb-4 animate-spin"}),o.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:" Under Review"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"Your application is being reviewed"}),o.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4",children:o.jsx("p",{className:"text-yellow-300 text-sm",children:"We're reviewing your ID document. This usually takes 24-48 hours. You'll be notified once approved."})})]})})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:o.jsxs("div",{className:"max-w-2xl mx-auto",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs("h1",{className:"text-4xl font-bold text-white mb-2 flex items-center gap-3",children:[o.jsx(GC,{className:"w-10 h-10 text-purple-400"}),"Broadcaster Application"]}),o.jsx("p",{className:"text-gray-400 text-lg",children:"Apply to receive payouts for your streams"})]}),!te&&o.jsx(Fe,{className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 border-orange-500 p-6 mb-6",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Ly,{className:"w-6 h-6 text-orange-400 flex-shrink-0 mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:" Level 1 Required"}),o.jsxs("p",{className:"text-orange-200 mb-3",children:["You must reach ",o.jsx("strong",{children:"Level 1"})," before you can apply to receive payouts."]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-gray-300",children:"Current Level:"}),o.jsxs(wt,{className:"bg-purple-500 text-white text-lg px-4 py-1",children:["Level ",W]})]}),o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-gray-300",children:"Your XP:"}),o.jsxs("span",{className:"text-cyan-400 font-bold",children:[se.toLocaleString()," XP"]})]}),o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("span",{className:"text-gray-300",children:"Level 1 Requires:"}),o.jsxs("span",{className:"text-yellow-400 font-bold",children:[G.toLocaleString()," XP"]})]}),o.jsx("div",{className:"bg-[#1a1a24] rounded-full h-3 overflow-hidden",children:o.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-500",style:{width:`${Math.min(se/(G>0?G:1)*100,100)}%`}})}),o.jsx("p",{className:"text-xs text-gray-400 mt-2 text-center",children:" Earn XP: Receive gifts (+1 XP per coin)  Rapid-tap likes (+1 XP per like)"})]})]})]})}),o.jsx(Fe,{className:"bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border-blue-500 p-6 mb-6",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(GC,{className:"w-6 h-6 text-blue-400 flex-shrink-0 mt-1"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-lg font-bold text-white mb-3",children:" Tiered Cashout Rates"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"First 20k coins:"}),o.jsx("span",{className:"text-green-400 font-bold",children:"$125"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Next 20k coins:"}),o.jsx("span",{className:"text-green-400 font-bold",children:"$100"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Next 20k coins:"}),o.jsx("span",{className:"text-green-400 font-bold",children:"$80"})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-300",children:"Above 60k coins:"}),o.jsx("span",{className:"text-green-400 font-bold",children:"Better rates!"})]})]}),o.jsx("p",{className:"text-xs text-gray-400 mt-3",children:" Better rates than other platforms! Plus admin manual approval for your security."})]})]})}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Submit Your Application"}),!te&&o.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-6",children:o.jsxs("p",{className:"text-red-300 text-sm flex items-center gap-2",children:[o.jsx(fp,{className:"w-4 h-4"}),"You cannot submit an application until you reach Level 1"]})}),o.jsxs("form",{onSubmit:V,className:"space-y-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"id-type",className:"text-white mb-2 block",children:"ID Document Type"}),o.jsxs(gs,{value:u,onValueChange:m,children:[o.jsx(_s,{className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"drivers_license",children:"Driver's License"}),o.jsx(Ct,{value:"state_id",children:"State ID"}),o.jsx(Ct,{value:"passport",children:"Passport"}),o.jsx(Ct,{value:"library_card",children:"Library Card"}),o.jsx(Ct,{value:"homeless_card",children:"Homeless Card"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"id-number",className:"text-white mb-2 block",children:"ID Number (Optional)"}),o.jsx(Zt,{id:"id-number",placeholder:"Enter your ID number",value:y,onChange:ie=>w(ie.target.value),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"expiry-date",className:"text-white mb-2 block",children:"Expiration Date *"}),o.jsx(Zt,{id:"expiry-date",type:"date",value:b,onChange:ie=>x(ie.target.value),min:new Date().toISOString().split("T")[0],className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",required:!0})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"id-file",className:"text-white mb-2 block",children:"Upload ID Document *"}),o.jsxs("div",{className:"bg-[#0a0a0f] border-2 border-dashed border-[#2a2a3a] rounded-lg p-6 text-center hover:border-purple-500 transition-colors",children:[o.jsx("input",{id:"id-file",type:"file",accept:"image/*,.pdf",onChange:z,className:"hidden",required:!0}),o.jsxs("label",{htmlFor:"id-file",className:"cursor-pointer",children:[o.jsx(DH,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),a?o.jsx("p",{className:"text-green-400 font-semibold",children:a.name}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"text-white mb-1",children:"Click to upload ID document"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"PNG, JPG, or PDF (Max 10MB)"})]})]})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-2",children:" Your ID will be verified by AI to ensure it's valid and not expired"})]}),o.jsxs("div",{className:"bg-[#0a0a0f] border border-[#2a2a3a] rounded-lg p-4",children:[o.jsx("h4",{className:"text-white font-semibold mb-3",children:" Requirements:"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ui,{className:`w-4 h-4 ${te?"text-green-500":"text-gray-500"}`}),o.jsx("span",{className:te?"text-green-400":"text-gray-400",children:"Level 1 or higher"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ui,{className:`w-4 h-4 ${a?"text-green-500":"text-gray-500"}`}),o.jsx("span",{className:a?"text-green-400":"text-gray-400",children:"Valid government-issued ID"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ui,{className:`w-4 h-4 ${b?"text-green-500":"text-gray-500"}`}),o.jsx("span",{className:b?"text-green-400":"text-gray-400",children:"ID must not be expired"})]})]})]}),o.jsx(ke,{type:"submit",disabled:!te||F.isPending||T,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 font-bold py-6 text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:T?o.jsxs(o.Fragment,{children:[o.jsx(yy,{className:"w-5 h-5 mr-2 animate-spin"}),"Verifying ID..."]}):F.isPending?o.jsxs(o.Fragment,{children:[o.jsx(yy,{className:"w-5 h-5 mr-2 animate-spin"}),"Submitting..."]}):o.jsxs(o.Fragment,{children:[o.jsx(GC,{className:"w-5 h-5 mr-2"}),"Submit Application"]})})]}),o.jsx("p",{className:"text-xs text-gray-500 mt-6 text-center",children:" Your information is secure and encrypted. We use AI to instantly verify your ID."})]})]})})}function WY(){var ve,he,Ze,Qe;const i=Wn(),n=vn(),a=new URLSearchParams(window.location.search);let l=a.get("userId");const u=a.get("username"),m=typeof l=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(l),{data:y}=mt({queryKey:["userIdFromUsername",u],queryFn:async()=>{if(!u)return null;const{data:me,error:ye}=await K.from("profiles").select("id").eq("username",u).limit(1);return!ye&&me&&me[0]?me[0].id:null},enabled:!!u&&!l});y&&!l&&(l=y);const{data:w}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me()}),{data:b}=mt({queryKey:["currentUserProfile",w==null?void 0:w.id],queryFn:async()=>{if(!(w!=null&&w.id))return null;const{data:me,error:ye}=await K.from("profiles").select("id, username, role, is_admin, is_troll_officer").eq("id",w.id).limit(1);return!ye&&me&&me[0]?me[0]:null},enabled:!!(w!=null&&w.id)}),x=b&&(b.role==="admin"||b.is_admin===!0),T=Wt({mutationFn:async()=>{if(!(w!=null&&w.id)||!l)throw new Error("Missing user information");const{error:me}=await K.from("kicked_users").insert({user_id:l,kicked_by:w.id,reason:`Kicked by admin @${(b==null?void 0:b.username)||"Admin"}`,expires_at:new Date(Date.now()+1440*60*1e3).toISOString()});if(me)throw me;const{error:ye}=await K.from("notifications").insert({user_id:l,type:"admin_action",title:"Kicked by Admin",message:`You have been kicked by admin @${(b==null?void 0:b.username)||"Admin"}`,icon:"",is_read:!1,created_date:new Date().toISOString()});if(ye)throw ye;return!0},onSuccess:()=>{pe.success("User kicked successfully"),i("/paymentrequired?reason=kicked")},onError:me=>{pe.error(me.message||"Failed to kick user")}}),N=Wt({mutationFn:async()=>{if(!(w!=null&&w.id)||!l)throw new Error("Missing user information");const{error:me}=await K.from("profiles").update({is_banned:!0}).eq("id",l);if(me)throw me;const{error:ye}=await K.from("notifications").insert({user_id:l,type:"admin_action",title:"Banned by Admin",message:`You have been banned by admin @${(b==null?void 0:b.username)||"Admin"}`,icon:"",is_read:!1,created_date:new Date().toISOString()});if(ye)throw ye;return!0},onSuccess:()=>{pe.success("User banned successfully"),i("/paymentrequired?reason=banned")},onError:me=>{pe.error(me.message||"Failed to ban user")}}),O=()=>{!x||oe||(window.confirm(`Admin Actions for @${(P==null?void 0:P.username)||"User"}:

Kick - Remove from current session
Ban - Permanently ban user

Click OK to Kick, Cancel to Ban`)?T.mutate():window.confirm("Are you sure you want to BAN this user?")&&N.mutate())},{data:P,isLoading:F}=mt({queryKey:["publicProfile",l],queryFn:async()=>{var ge,Ee;if(!l||!m)return null;const{data:me,error:ye}=await K.from("profiles").select("*").eq("id",l).limit(1);if(!ye&&me&&me[0])return me[0];try{return(await((Ee=(ge=K.entities)==null?void 0:ge.User)==null?void 0:Ee.filter)?await K.entities.User.filter({id:l}):[])[0]||null}catch{return null}},enabled:!!l&&m}),{data:z=[]}=mt({queryKey:["recentStreams",l],queryFn:async()=>!l||!m?[]:await K.entities.Stream.filter({streamer_id:l},"-created_date",5),enabled:!!l&&m,initialData:[]}),{data:V=[]}=mt({queryKey:["userRecentStreams",P==null?void 0:P.id],queryFn:async()=>!(P!=null&&P.id)||!m?[]:await K.entities.Stream.filter({streamer_id:P.id},"-created_date",5),enabled:!!(P!=null&&P.id)&&m,initialData:[]}),W=ut.useMemo(()=>{if(!V.length)return 0;let me=0;return V.forEach(ye=>{if(ye.created_date){const ge=new Date(ye.created_date),Oe=(ye.updated_date?new Date(ye.updated_date):new Date)-ge;me+=Math.floor(Oe/1e3/60)}}),(me/60).toFixed(1)},[V]),{data:te=!1}=mt({queryKey:["isFollowing",w==null?void 0:w.id,l],queryFn:async()=>{if(console.log("Checking isFollowing status:",{currentUser:w,userId:l,isValidUuid:m}),!w||!l||!m)return!1;try{const{data:me,error:ye}=await K.from("follows").select("*").eq("follower_id",w.id).eq("following_id",l).limit(1);if(console.log("Direct follows query result:",{data:me,error:ye}),me&&me.length>0)return!0;const ge=await K.entities.Follow.filter({follower_id:w.id,following_id:l});return console.log("Entities Follow.filter result:",ge),ge.length>0}catch(me){return console.error("Error checking follow status:",me),!1}},enabled:!!w&&!!l&&m}),$=Wt({mutationFn:async()=>{if(console.log("Follow mutation started:",{currentUser:w,userId:l,isFollowing:te}),!(w!=null&&w.id))throw new Error("User not authenticated");if(!l)throw new Error("Target user not found");if(te){console.log("Unfollowing user...");const{data:me,error:ye}=await K.from("follows").select("id").eq("follower_id",w.id).eq("following_id",l).limit(1);if(ye)throw console.error("Error finding follow record:",ye),new Error("Failed to find follow record");if(me&&me.length>0){const{error:we}=await K.from("follows").delete().eq("id",me[0].id);if(we)throw console.error("Error deleting follow record:",we),new Error("Failed to delete follow record");console.log("Follow record deleted successfully")}const{error:ge}=await K.from("profiles").update({follower_count:(P.follower_count||0)-1}).eq("id",l);if(ge)throw ge;const{data:Ee}=await K.from("profiles").select("following_count").eq("id",w.id).single(),{error:Oe}=await K.from("profiles").update({following_count:((Ee==null?void 0:Ee.following_count)||0)-1}).eq("id",w.id);if(Oe)throw Oe;console.log("Unfollow completed successfully")}else{console.log("Following user...");const{error:me}=await K.from("follows").insert({follower_id:w.id,following_id:l,created_at:new Date().toISOString()});if(me)throw console.error("Error inserting follow record:",me),new Error("Failed to create follow relationship");console.log("Follow record inserted successfully");const{error:ye}=await K.from("profiles").update({follower_count:(P.follower_count||0)+1}).eq("id",l);if(ye)throw ye;const{data:ge}=await K.from("profiles").select("following_count").eq("id",w.id).single(),{error:Ee}=await K.from("profiles").update({following_count:((ge==null?void 0:ge.following_count)||0)+1}).eq("id",w.id);if(Ee)throw Ee;const Oe=(b==null?void 0:b.username)||(b==null?void 0:b.full_name)||"Someone";try{await K.from("notifications").insert({user_id:l,type:"new_follower",title:"New Follower",message:`${Oe} started following you!`,icon:"",related_user_id:w.id,related_user_name:Oe,is_read:!1,created_date:new Date().toISOString()})}catch{console.log("Notification creation failed, but follow was successful")}console.log("Follow completed successfully")}},onSuccess:()=>{console.log("Follow mutation success, invalidating queries"),n.invalidateQueries(["isFollowing"]),n.invalidateQueries(["publicProfile"]),n.invalidateQueries(["currentUserProfile"]),pe.success(te?"Unfollowed":"Following!")},onError:me=>{console.error("Follow mutation error:",me),pe.error(me.message||"Failed to follow user")}}),[Q,G]=ut.useState(!1),[se,ie]=ut.useState(""),ce=async()=>{var me,ye;if(P.messages_closed&&!x){pe.error("This user has closed their messages");return}P.messages_closed&&x&&pe.info(" Admin access: Messaging user with closed messages");try{const{data:ge}=await K.from("conversations").select("*").eq("participant1_id",w.id).eq("participant2_id",l).limit(1),{data:Ee}=await K.from("conversations").select("*").eq("participant1_id",l).eq("participant2_id",w.id).limit(1);let Oe=((me=ge==null?void 0:ge[0])==null?void 0:me.id)||((ye=Ee==null?void 0:Ee[0])==null?void 0:ye.id)||null;if(!Oe){const{data:we,error:fe}=await K.from("conversations").insert({participant1_id:w.id,participant2_id:l}).select("*").single();!fe&&we&&(Oe=we.id)}Oe?(pe.success("Opening conversation..."),i(`${Or("Messages")}?conversation=${Oe}`)):pe.error("Failed to create conversation")}catch(ge){console.error("Error starting conversation:",ge),pe.error("Failed to start conversation")}},Se=async()=>{var ye,ge;const me=se.trim();if(me)try{const{data:Ee}=await K.from("conversations").select("*").eq("participant1_id",w.id).eq("participant2_id",l).limit(1),{data:Oe}=await K.from("conversations").select("*").eq("participant1_id",l).eq("participant2_id",w.id).limit(1);let we=((ye=Ee==null?void 0:Ee[0])==null?void 0:ye.id)||((ge=Oe==null?void 0:Oe[0])==null?void 0:ge.id)||null;if(!we){const{data:je}=await K.from("conversations").insert({participant1_id:w.id,participant2_id:l}).select("*").single();we=(je==null?void 0:je.id)||we}if(!we){const je=await K.entities.Conversation.create({participant1_id:w.id,participant2_id:l});we=(je==null?void 0:je.id)||we}let fe={conversation_id:we,sender_id:w.id,message:me,created_date:new Date().toISOString()},De=!1;for(let je=0;je<3&&!De;je++){const{error:_e}=await K.from("direct_messages").insert(fe);if(!_e){De=!0;break}const st=String((_e==null?void 0:_e.message)||_e).match(/column\s+"?(\w+)"?\s+does not exist/i),vt=st==null?void 0:st[1];if(vt&&fe.hasOwnProperty(vt)){delete fe[vt];continue}break}De||await K.from("messages").insert({conversation_id:we,sender_id:w.id,content:me});try{const{data:je}=await K.from("conversations").select("*").eq("id",we).limit(1),_e=(je==null?void 0:je[0])||null,st=(_e==null?void 0:_e.participant1_id)===w.id?{unread_count_p2:((_e==null?void 0:_e.unread_count_p2)||0)+1,last_message:me.slice(0,100),last_message_time:new Date().toISOString()}:{unread_count_p1:((_e==null?void 0:_e.unread_count_p1)||0)+1,last_message:me.slice(0,100),last_message_time:new Date().toISOString()};await K.from("conversations").update(st).eq("id",we)}catch{}try{await K.from("notifications").insert({user_id:l,type:"message",title:"New Message",message:`${w.username||w.full_name} sent you a message`,link_url:Or("Messages"),is_read:!1,created_date:new Date().toISOString()})}catch{}pe.success("Message sent"),G(!1),ie(""),i(`${Or("Messages")}?conversation=${we}`)}catch(Ee){pe.error((Ee==null?void 0:Ee.message)||"Failed to send message")}};if(!l)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center p-6",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:o.jsx("p",{className:"text-white",children:"No user specified"})})});if(F)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})});if(!P)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center p-6",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:o.jsx("p",{className:"text-white",children:"User not found"})})});const oe=(w==null?void 0:w.id)===l;return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:[o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 mb-6",children:o.jsxs("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[o.jsxs("div",{className:`relative ${x&&!oe?"cursor-pointer hover:opacity-80 transition-opacity":""}`,onClick:O,title:x&&!oe?"Click for admin actions (Kick/Ban)":"",children:[P.avatar?o.jsx("img",{src:P.avatar,alt:"Avatar",className:"w-32 h-32 rounded-full object-cover ring-4 ring-purple-500"}):o.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center ring-4 ring-purple-500",children:o.jsx("span",{className:"text-5xl font-bold text-white",children:((he=(ve=P.username)==null?void 0:ve[0])==null?void 0:he.toUpperCase())||((Qe=(Ze=P.full_name)==null?void 0:Ze[0])==null?void 0:Qe.toUpperCase())})}),x&&!oe&&o.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1",children:o.jsx(xi,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[o.jsx("h1",{className:`text-3xl font-bold text-white ${x&&!oe?"cursor-pointer hover:text-purple-300 transition-colors":""}`,onClick:O,title:x&&!oe?"Click for admin actions (Kick/Ban)":"",children:o.jsxs("div",{className:"flex items-center gap-2",children:["@",P.username||"NoUsername",o.jsx(VR,{user:P,size:"md"})]})}),o.jsxs(wt,{className:"bg-purple-500 text-white",children:["Level ",P.level||1]}),o.jsx(LY,{user:P}),P.is_troll_officer&&o.jsxs(wt,{className:"bg-orange-500 text-white",children:[o.jsx(xi,{className:"w-3 h-3 mr-1"}),"Officer"]}),P.troll_family_name&&o.jsx(DY,{familyName:P.troll_family_name})]}),o.jsx("p",{className:"text-gray-400 mb-4",children:P.bio||"No bio yet"}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(ni,{className:"w-4 h-4 text-yellow-400"}),o.jsx("span",{className:"text-xs text-gray-400",children:"Level"})]}),o.jsx("p",{className:"text-lg font-bold text-purple-400",children:P.level||1})]}),o.jsxs(gy,{to:Or("Followers")+`?userId=${P.id}`,className:"bg-[#0a0a0f] rounded-lg p-3 hover:bg-[#1a1a24] transition-all cursor-pointer",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(jn,{className:"w-4 h-4 text-purple-400"}),o.jsx("span",{className:"text-xs text-gray-400",children:"Followers"})]}),o.jsx("p",{className:"text-lg font-bold text-purple-400",children:P.follower_count||0})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(Si,{className:"w-4 h-4 text-red-400"}),o.jsx("span",{className:"text-xs text-gray-400",children:"Streams"})]}),o.jsx("p",{className:"text-lg font-bold text-red-400",children:P.total_streams||0})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-3",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(Es,{className:"w-4 h-4 text-green-400"}),o.jsx("span",{className:"text-xs text-gray-400",children:"Earned"})]}),o.jsxs("p",{className:"text-lg font-bold text-green-400",children:["$",((P.earned_coins||0)*.00625).toFixed(2)]})]})]}),!oe&&w&&o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{type:"button",onClick:()=>$.mutate(),disabled:$.isPending,className:te?"bg-gray-600 hover:bg-gray-700":"bg-purple-600 hover:bg-purple-700",children:te?o.jsxs(o.Fragment,{children:[o.jsx($le,{className:"w-4 h-4 mr-2"}),"Unfollow"]}):o.jsxs(o.Fragment,{children:[o.jsx(Xle,{className:"w-4 h-4 mr-2"}),"Follow"]})}),o.jsxs(ke,{type:"button",onClick:ce,className:"bg-blue-600 hover:bg-blue-700",children:[o.jsx(Um,{className:"w-4 h-4 mr-2"}),"Message"]})]}),oe&&o.jsx(ke,{type:"button",onClick:()=>i(Or("Profile")),className:"bg-purple-600 hover:bg-purple-700",children:"Edit Profile"})]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx(Si,{className:"w-5 h-5 text-red-400"}),"Streaming Stats"]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4 text-center",children:[o.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Total Streams"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:V.length})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4 text-center",children:[o.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Hours Streamed"}),o.jsxs("p",{className:"text-2xl font-bold text-white",children:[W,"h"]})]}),o.jsxs("div",{className:"bg-[#0a0a0f] rounded-lg p-4 text-center",children:[o.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Experience"}),o.jsxs("p",{className:"text-2xl font-bold text-purple-400",children:[P.streaming_hours||0,"h"]})]})]})]}),P.troll_family_name&&o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx(jn,{className:"w-5 h-5 text-purple-400"}),"Troll Family"]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-3",children:[o.jsx("p",{className:"text-purple-300 font-semibold text-lg",children:P.troll_family_name}),P.owns_troll_family&&o.jsxs(wt,{className:"mt-2 bg-yellow-500",children:[o.jsx(dp,{className:"w-3 h-3 mr-1"}),"Owner"]})]}),o.jsx(ke,{type:"button",onClick:()=>i(Or("TrollFamily")),variant:"outline",className:"w-full border-purple-500 text-purple-400",children:"View Family"})]})]})]}),z.length>0&&o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6 mt-6",children:[o.jsxs("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[o.jsx(Si,{className:"w-5 h-5 text-red-400"}),"Recent Streams"]}),o.jsx("div",{className:"space-y-3",children:z.map(me=>o.jsx("div",{onClick:()=>{me.is_live&&i(Or("StreamViewer")+`?id=${me.id}`)},className:`bg-[#0a0a0f] rounded-lg p-4 border border-[#2a2a3a] ${me.is_live?"cursor-pointer hover:border-purple-500 transition-all":""}`,children:o.jsxs("div",{className:"flex items-start gap-4",children:[me.thumbnail?o.jsx("img",{src:me.thumbnail,alt:me.title,className:"w-24 h-16 rounded object-cover flex-shrink-0"}):o.jsx("div",{className:"w-24 h-16 rounded bg-gradient-to-br from-purple-900/50 to-pink-900/50 flex items-center justify-center flex-shrink-0",children:o.jsx(Si,{className:"w-6 h-6 text-white/50"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("h4",{className:"text-white font-semibold truncate",children:me.title}),me.is_live?o.jsxs(wt,{className:"bg-red-500 text-white text-xs flex-shrink-0",children:[o.jsx(Si,{className:"w-3 h-3 mr-1 animate-pulse"}),"LIVE"]}):o.jsx(wt,{className:"bg-gray-600 text-white text-xs flex-shrink-0",children:"Ended"})]}),o.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-400",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(wD,{className:"w-3 h-3"}),new Date(me.created_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),o.jsx("span",{children:new Date(me.created_date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),o.jsx(wt,{className:"bg-purple-500/20 text-purple-300 text-xs",children:me.category})]}),o.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs",children:[o.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[o.jsx(jn,{className:"w-3 h-3"}),me.viewer_count||0," viewers"]}),me.total_gifts>0&&o.jsxs("span",{className:"text-yellow-400 flex items-center gap-1",children:[" ",me.total_gifts," gifts"]})]})]})]})},me.id))})]})]}),o.jsx(gm,{open:Q,onOpenChange:G,children:o.jsxs(_m,{className:"bg-[#1a1a24] border-[#2a2a3a] max-w-lg w-full",children:[o.jsx(ym,{children:o.jsxs(vm,{className:"text-white",children:["Message @",P.username||P.full_name]})}),o.jsx(Nl,{value:se,onChange:me=>ie(me.target.value),placeholder:"Type your message",className:"bg-[#0f0f16] border-[#2a2a3a] text-white"}),o.jsxs("div",{className:"flex gap-2 justify-end mt-3",children:[o.jsx(ke,{variant:"outline",className:"border-[#2a2a3a]",onClick:()=>G(!1),children:"Cancel"}),o.jsx(ke,{className:"bg-blue-600 hover:bg-blue-700",onClick:Se,children:"Send"})]})]})})]})}function qY(){const i=vn(),n=Wn(),[a,l]=M.useState("all"),{data:u}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:V,error:W}=await K.auth.getUser();if(W)throw W;return V==null?void 0:V.user}}),{data:m=[],isLoading:y}=mt({queryKey:["notifications",u==null?void 0:u.id],queryFn:async()=>{if(!u)return[];const{data:V,error:W}=await K.from("notifications").select("*").eq("user_id",u.id).order("created_at",{ascending:!1}).limit(100);return W?(console.error("Error fetching notifications:",W),[]):V||[]},enabled:!!u,initialData:[],refetchInterval:5e3}),w=Wt({mutationFn:async()=>{if(!u)return;console.log(" Marking all notifications as read for user:",u.id);const{error:V}=await K.from("notifications").update({is_read:!0}).eq("user_id",u.id).eq("is_read",!1);if(V)throw console.error(" Failed to mark notifications as read:",V),V;console.log(" Successfully marked notifications as read")},onSuccess:()=>{console.log(" Invalidating queries after marking as read"),i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),i.invalidateQueries({queryKey:["unreadNotifications",u==null?void 0:u.id]}),i.setQueryData(["unreadNotifications",u==null?void 0:u.id],0)},onError:V=>{console.warn("Failed to mark notifications as read:",V)}});M.useEffect(()=>{if(u&&m.length>0){const V=m.some(W=>!W.is_read);console.log(" Notifications page check:",{userId:u.id,totalNotifications:m.length,hasUnread:V,unreadCount:m.filter(W=>!W.is_read).length,notifications:m.map(W=>({id:W.id,is_read:W.is_read,type:W.type}))}),V&&w.mutate()}},[u,m.length]);const b=Wt({mutationFn:async V=>{const{error:W}=await K.from("notifications").update({is_read:!0}).eq("id",V);if(W)throw W},onSuccess:()=>{i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),i.invalidateQueries({queryKey:["unreadNotifications",u==null?void 0:u.id]})}}),x=Wt({mutationFn:async()=>{const{error:V}=await K.from("notifications").update({is_read:!0}).eq("user_id",u.id).eq("is_read",!1);if(V)throw V},onSuccess:()=>{i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),i.invalidateQueries({queryKey:["unreadNotifications",u==null?void 0:u.id]}),pe.success("All notifications marked as read")}}),T=Wt({mutationFn:async V=>{const{error:W}=await K.from("notifications").delete().eq("id",V);if(W)throw W},onSuccess:()=>{i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),pe.success("Notification deleted")}}),N=V=>{V.is_read||b.mutate(V.id),V.link_url&&n(V.link_url.replace("/#",""))},O=V=>{switch(V){case"stream_live":return o.jsx(Si,{className:"w-5 h-5 text-red-400"});case"new_follower":return o.jsx(jn,{className:"w-5 h-5 text-purple-400"});case"gift_received":return o.jsx(jy,{className:"w-5 h-5 text-pink-400"});case"tip_received":return o.jsx(Es,{className:"w-5 h-5 text-green-400"});case"message":return o.jsx(Um,{className:"w-5 h-5 text-blue-400"});case"system":return o.jsx(Ic,{className:"w-5 h-5 text-yellow-400"});default:return o.jsx(Am,{className:"w-5 h-5 text-gray-400"})}},P=a==="all"?m:a==="unread"?m.filter(V=>!V.is_read):m.filter(V=>V.type===a),F=m.filter(V=>!V.is_read).length,z=Intl.DateTimeFormat().resolvedOptions().timeZone;return y?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})}):u?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(Am,{className:"w-10 h-10 text-purple-400"}),o.jsx("h1",{className:"text-4xl font-bold text-white",children:"Notifications"})]}),o.jsx("p",{className:"text-gray-400",children:"Stay updated with the latest activity"}),o.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Times shown in ",z]})]}),o.jsx("div",{className:"flex gap-2",children:o.jsx(ke,{onClick:()=>x.mutate(),disabled:x.isPending||F===0,variant:"outline",className:"border-purple-500 text-purple-400",children:"Mark all read"})})]})}),o.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:["all","unread","stream_live","new_follower","gift_received","message"].map(V=>o.jsx(ke,{onClick:()=>l(V),variant:a===V?"default":"outline",size:"sm",className:a===V?"bg-purple-600":"border-[#2a2a3a]",children:V.replace("_"," ")},V))}),P.length===0?o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-12 text-center",children:[o.jsx(Am,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500 text-lg",children:"No notifications"})]}):o.jsx("div",{className:"space-y-3",children:P.map(V=>{const W=new Date(V.created_at),te=new Date,$=te.toDateString()===W.toDateString(),Q=new Date(te.setDate(te.getDate()-1)).toDateString()===W.toDateString();return o.jsx(Xi.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:o.jsx(Fe,{className:`${V.is_read?"bg-purple-500/10 border-purple-500/50":"bg-purple-500/20 border-purple-500/70 shadow-lg shadow-purple-500/20"} cursor-pointer hover:border-purple-500 transition-all`,onClick:()=>N(V),children:o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsxs("div",{className:"text-3xl flex-shrink-0 relative",children:[O(V.type),!V.is_read&&o.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-[#1a1a24]"})]}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsx("h3",{className:"text-white font-bold",children:V.title}),o.jsx(ke,{variant:"ghost",size:"icon",onClick:G=>{G.stopPropagation(),T.mutate(V.id)},className:"text-gray-400 hover:text-red-400 flex-shrink-0",children:o.jsx(Oc,{className:"w-4 h-4"})})]}),o.jsx("p",{className:"text-gray-400 text-sm mt-1",children:V.message}),o.jsx("p",{className:"text-gray-600 text-xs mt-2",children:$?hp(W,"h:mm a"):Q?"Yesterday "+hp(W,"h:mm a"):hp(W,"MMM d, yyyy h:mm a")})]})]})})})},V.id)})})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:[o.jsx("p",{className:"text-white mb-4",children:"Please log in to view notifications"}),o.jsx(ke,{onClick:()=>K.auth.signInWithOAuth({provider:"google"}),children:"Login"})]})})}function GY(){const i=vn(),n=Wn(),[a,l]=M.useState("all"),{data:u}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:te,error:$}=await K.auth.getUser();if($)throw $;return te==null?void 0:te.user}}),{data:m=[],isLoading:y}=mt({queryKey:["notifications",u==null?void 0:u.id],queryFn:async()=>{if(!(u!=null&&u.id))return[];const{data:te,error:$}=await K.from("notifications").select("*").eq("user_id",u.id).order("created_at",{ascending:!1}).limit(100);if($)throw $;return te||[]},enabled:!!(u!=null&&u.id),initialData:[],refetchInterval:5e3});M.useEffect(()=>{if(u!=null&&u.id&&m.length>0){const te=m.filter($=>!$.is_read);te.length>0&&te.forEach($=>{T.mutate($.id)})}},[u==null?void 0:u.id,m.length]);const w=M.useMemo(()=>Array.from(new Set((m||[]).map($=>$.related_user_id).filter(Boolean))),[m]),{data:b=[]}=mt({queryKey:["notifRelatedProfiles",w.join(",")],queryFn:async()=>{if(!w||w.length===0)return[];const{data:te,error:$}=await K.from("profiles").select("id, username, avatar, avatar_url").in("id",w);return $?[]:te||[]},enabled:w.length>0,staleTime:6e4}),x=M.useMemo(()=>{const te={};return(b||[]).forEach($=>{te[$.id]=$}),te},[b]),T=Wt({mutationFn:async te=>{const{error:$}=await K.from("notifications").update({is_read:!0,updated_at:new Date().toISOString()}).eq("id",te);if($)throw $},onSuccess:()=>{i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),i.invalidateQueries({queryKey:["unreadNotifications",u==null?void 0:u.id]})}}),N=Wt({mutationFn:async()=>{const te=m.filter(Q=>!Q.is_read);if(te.length===0)return;const{error:$}=await K.from("notifications").update({is_read:!0,updated_at:new Date().toISOString()}).in("id",te.map(Q=>Q.id));if($)throw $},onSuccess:()=>{i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),i.invalidateQueries({queryKey:["unreadNotifications",u==null?void 0:u.id]}),pe.success("All notifications marked as read")}}),O=Wt({mutationFn:async te=>{const{error:$}=await K.from("notifications").delete().eq("id",te);if($)throw $},onSuccess:()=>{i.invalidateQueries({queryKey:["notifications",u==null?void 0:u.id]}),pe.success("Notification deleted")}}),P=te=>{T.mutate(te.id),te.link_url&&n(te.link_url.replace("/#",""))},F=te=>{switch(te){case"stream_live":return o.jsx(Si,{className:"w-5 h-5 text-red-400"});case"new_follower":return o.jsx(jn,{className:"w-5 h-5 text-purple-400"});case"gift_received":return o.jsx(jy,{className:"w-5 h-5 text-pink-400"});case"tip_received":return o.jsx(Es,{className:"w-5 h-5 text-green-400"});case"message":return o.jsx(Um,{className:"w-5 h-5 text-blue-400"});case"system":return o.jsx(Ic,{className:"w-5 h-5 text-yellow-400"});default:return o.jsx(Am,{className:"w-5 h-5 text-gray-400"})}},z=a==="all"?m:a==="unread"?m.filter(te=>!te.is_read):m.filter(te=>te.type===a),V=m.filter(te=>!te.is_read).length;if(y)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"})});if(!u)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 text-center",children:[o.jsx("p",{className:"text-white mb-4",children:"Please log in to view notifications"}),o.jsx(ke,{onClick:()=>K.auth.redirectToLogin(),children:"Login"})]})});const W=Intl.DateTimeFormat().resolvedOptions().timeZone;return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(Am,{className:"w-10 h-10 text-purple-400"}),o.jsx("h1",{className:"text-4xl font-bold text-white",children:"Notifications"})]}),o.jsx("p",{className:"text-gray-400",children:"Stay updated with the latest activity"}),o.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Times shown in ",W]})]}),o.jsx("div",{className:"flex gap-2",children:o.jsx(ke,{onClick:()=>N.mutate(),disabled:N.isPending||V===0,variant:"outline",className:"border-purple-500 text-purple-400",children:"Mark all read"})})]})}),o.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:["all","unread","stream_live","new_follower","gift_received","message"].map(te=>o.jsx(ke,{onClick:()=>l(te),size:"sm",className:a===te?"bg-purple-600 text-white hover:bg-purple-700 border border-purple-500":"bg-gradient-to-br from-purple-500/10 to-pink-500/10 text-white border border-purple-500/40 hover:bg-purple-500/20",children:te.replace("_"," ")},te))}),z.length===0?o.jsxs(Fe,{className:"bg-gradient-to-br from-purple-500/10 to-pink-500/10 border-purple-500/40 p-12 text-center",children:[o.jsx(Am,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500 text-lg",children:"No notifications"})]}):o.jsx("div",{className:"space-y-3",children:z.map(te=>{const $=new Date(te.created_date),Q=new Date,G=Q.toDateString()===$.toDateString(),se=new Date(Q.setDate(Q.getDate()-1)).toDateString()===$.toDateString();return o.jsx(Xi.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:o.jsx(Fe,{className:"bg-gradient-to-br from-purple-500/20 to-pink-500/20 border-purple-500/50 cursor-pointer hover:border-purple-400 transition-all",onClick:()=>P(te),children:o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden ring-2 ring-purple-500 flex-shrink-0",children:(()=>{var Se,oe;const ie=x[te.related_user_id],ce=(ie==null?void 0:ie.avatar)||(ie==null?void 0:ie.avatar_url);return ce?o.jsx("img",{src:ce,alt:(ie==null?void 0:ie.username)||"",className:"w-full h-full object-cover"}):o.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center",children:o.jsx("span",{className:"text-white text-sm font-bold",children:((oe=(Se=te.related_user_name)==null?void 0:Se[0])==null?void 0:oe.toUpperCase())||""})})})()}),o.jsx("div",{className:"text-3xl flex-shrink-0",children:F(te.type)}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsx("h3",{className:"text-white font-bold",children:te.title}),o.jsx(ke,{variant:"ghost",size:"icon",onClick:ie=>{ie.stopPropagation(),O.mutate(te.id)},className:"text-gray-400 hover:text-red-400 flex-shrink-0",children:o.jsx(Oc,{className:"w-4 h-4"})})]}),o.jsx("p",{className:"text-gray-400 text-sm mt-1",children:te.message}),o.jsx("p",{className:"text-gray-600 text-xs mt-2",children:G?hp($,"h:mm a"):se?"Yesterday "+hp($,"h:mm a"):hp($,"MMM d, yyyy h:mm a")})]})]})})})},te.id)})})]})})}function jbe(){const i=vn(),n=Wn(),[a,l]=M.useState(""),[u,m]=M.useState(null),[y,w]=M.useState(!1),[b,x]=M.useState(!1),[T,N]=M.useState(!1),[O,P]=M.useState(!1),[F,z]=M.useState(100),[V,W]=M.useState("real"),[te,$]=M.useState("all"),[Q,G]=M.useState("users"),{data:se=[],isLoading:ie}=mt({queryKey:["modernAdminUsers",a,te],queryFn:async()=>{if(!K.__isConfigured)return[];let _e=K.from("profiles").select("id, username, full_name, email, avatar_url, coins, free_coins, purchased_coins, level, role, is_banned, is_troll_officer, is_admin, created_at").order("is_admin",{ascending:!1}).order("created_at",{ascending:!1});if(a.trim().length>=2){const pt=a.trim().toLowerCase();_e=_e.or(`username.ilike.%${pt}%,full_name.ilike.%${pt}%,email.ilike.%${pt}%`)}te!=="all"&&(te==="active"?_e=_e.or("is_banned.eq.false,is_admin.eq.true"):te==="banned"?_e=_e.eq("is_banned",!0):te==="officers"?_e=_e.eq("is_troll_officer",!0):te==="admins"&&(_e=_e.eq("is_admin",!0)));const{data:Je,error:st}=await _e;if(st)throw console.error("Error fetching users:",st),st;console.log(`Fetched ${(Je==null?void 0:Je.length)||0} users from database`);const vt=(Je==null?void 0:Je.filter(pt=>pt.is_admin||pt.role==="admin"))||[];return console.log("Admin users found:",vt.map(pt=>({id:pt.id,username:pt.username,is_admin:pt.is_admin,role:pt.role}))),Je||[]},staleTime:5e3});M.useEffect(()=>{if(!K.__isConfigured)return;const _e=K.channel("profiles_admin_realtime");return _e.on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},Je=>{const st=(Je==null?void 0:Je.new)||null;st&&i.setQueryData(["modernAdminUsers",a,te],vt=>Array.isArray(vt)?vt.map(pt=>pt.id===st.id?{...pt,...st,level:st.level||pt.level||0,coins:st.coins||pt.coins||0,free_coins:st.free_coins||pt.free_coins||0,purchased_coins:st.purchased_coins||pt.purchased_coins||0,is_banned:st.is_banned??pt.is_banned??!1,is_troll_officer:st.is_troll_officer??pt.is_troll_officer??!1,is_admin:st.is_admin??pt.is_admin??!1,role:st.role??pt.role??null}:pt):vt)}).subscribe(),()=>{try{_e.unsubscribe()}catch{}}},[a,te,i]),Wt({mutationFn:async({userId:_e,updates:Je})=>{const{error:st}=await K.from("profiles").update(Je).eq("id",_e);if(st)throw st;return{userId:_e,updates:Je}},onSuccess:({userId:_e,updates:Je})=>{i.setQueryData(["modernAdminUsers",a,te],st=>Array.isArray(st)?st.map(vt=>vt.id===_e?{...vt,...Je}:vt):st),pe.success("User updated successfully")},onError:_e=>pe.error(_e.message||"Failed to update user")});const ce=Wt({mutationFn:async({userId:_e,amount:Je,type:st})=>(st==="real"?await zD(_e,Je,{source:"admin_dashboard"}):await PP(_e,Je,{source:"admin_dashboard"}),{userId:_e,amount:Je,type:st}),onSuccess:()=>{i.invalidateQueries(["modernAdminUsers",a,te]),pe.success(`${F} ${V} coins added successfully`)},onError:_e=>pe.error(_e.message||"Failed to add coins")}),Se=Wt({mutationFn:async({userId:_e,ban:Je})=>{const st=Je?{is_banned:!0}:{is_banned:!1},{error:vt}=await K.from("profiles").update(st).eq("id",_e);if(vt)throw vt;return{userId:_e,ban:Je}},onSuccess:({userId:_e,ban:Je})=>{i.setQueryData(["modernAdminUsers",a,te],st=>Array.isArray(st)?st.map(vt=>vt.id===_e?{...vt,is_banned:Je}:vt):st),pe.success(Je?"User banned successfully":"User unbanned successfully")},onError:_e=>pe.error(_e.message||"Failed to update ban status")}),oe=Wt({mutationFn:async({userId:_e})=>{const{error:Je}=await K.from("kicked_users").insert({user_id:_e,kicked_at:new Date().toISOString(),reason:"Admin kick - payment required"});if(Je)throw Je;return{userId:_e}},onSuccess:({userId:_e})=>{pe.success("User kicked successfully - they will be redirected to payment page")},onError:_e=>pe.error(_e.message||"Failed to kick user")}),ve=Wt({mutationFn:async({userId:_e,makeAdmin:Je})=>{const st=Je?{is_admin:!0,role:"admin"}:{is_admin:!1,role:"user"},{error:vt}=await K.from("profiles").update(st).eq("id",_e);if(vt)throw vt;return{userId:_e,makeAdmin:Je}},onSuccess:({userId:_e,makeAdmin:Je})=>{i.setQueryData(["modernAdminUsers",a,te],st=>Array.isArray(st)?st.map(vt=>vt.id===_e?{...vt,is_admin:Je,role:Je?"admin":"user"}:vt):st),pe.success(Je?"User promoted to admin":"User demoted to regular user")},onError:_e=>pe.error(_e.message||"Failed to update user role")}),he=_e=>_e.is_banned?"bg-red-600":_e.is_admin||_e.role==="admin"?"bg-purple-600":_e.is_troll_officer?"bg-blue-600":"bg-green-600",Ze=_e=>_e.is_banned?"Banned":_e.is_admin||_e.role==="admin"?"Admin":_e.is_troll_officer?"Officer":"Active",Qe=_e=>_e?new Date(_e).toLocaleDateString():"Never",me=_e=>{m(_e),w(!0)},ye=_e=>{m(_e),x(!0)},ge=_e=>{m(_e),N(!0)},Ee=_e=>{m(_e),confirm(`Are you sure you want to kick ${_e.username||_e.full_name}? This will redirect them to the payment page.`)&&oe.mutate({userId:_e.id})},Oe=_e=>{m(_e),P(!0)},we=_e=>{n(`${Or("PublicProfile")}?userId=${encodeURIComponent(_e.id)}`)},fe=_e=>{u&&(ve.mutate({userId:u.id,makeAdmin:_e}),P(!1))},De=()=>{u&&(Se.mutate({userId:u.id,ban:!u.is_banned}),N(!1))},je=()=>{!u||!F||(ce.mutate({userId:u.id,amount:F,type:V}),x(!1))};return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-2xl font-bold text-white",children:"User Management"}),o.jsx("p",{className:"text-gray-400",children:"Manage user accounts, roles, and permissions"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(ke,{variant:"outline",size:"sm",className:"border-[#2a2a3a] text-gray-300 hover:border-purple-500",onClick:()=>{i.invalidateQueries(["modernAdminUsers",a,te]),pe.success("Users refreshed")},children:[o.jsx(cp,{className:"w-4 h-4 mr-1"}),"Refresh"]}),o.jsxs("div",{className:"relative",children:[o.jsx(oR,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),o.jsx(Zt,{type:"text",placeholder:"Search users...",value:a,onChange:_e=>l(_e.target.value),className:"pl-10 bg-[#0a0a0f] border-[#2a2a3a] text-white w-64"})]}),o.jsxs("select",{value:te,onChange:_e=>$(_e.target.value),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white rounded px-3 py-2 text-sm",children:[o.jsx("option",{value:"all",children:"All Users"}),o.jsx("option",{value:"active",children:"Active"}),o.jsx("option",{value:"banned",children:"Banned"}),o.jsx("option",{value:"officers",children:"Officers"}),o.jsx("option",{value:"admins",children:"Admins"})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsx(Fe,{className:"p-4 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border-blue-500/30",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Total Users"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:se.length})]}),o.jsx(jn,{className:"w-8 h-8 text-blue-400"})]})}),o.jsx(Fe,{className:"p-4 bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-green-500/30",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Active Users"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:se.filter(_e=>!_e.is_banned).length})]}),o.jsx(xi,{className:"w-8 h-8 text-green-400"})]})}),o.jsx(Fe,{className:"p-4 bg-gradient-to-br from-red-500/20 to-pink-500/20 border-red-500/30",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Banned Users"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:se.filter(_e=>_e.is_banned).length})]}),o.jsx(Ly,{className:"w-8 h-8 text-red-400"})]})}),o.jsx(Fe,{className:"p-4 bg-gradient-to-br from-purple-500/20 to-indigo-500/20 border-purple-500/30",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Total Coins"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:se.reduce((_e,Je)=>_e+(Je.coins||0),0).toLocaleString()})]}),o.jsx(Es,{className:"w-8 h-8 text-purple-400"})]})})]}),o.jsxs(db,{value:Q,onValueChange:G,className:"space-y-6",children:[o.jsxs(ub,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(es,{value:"users",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(Pa,{className:"w-4 h-4 mr-2"}),"All Users"]}),o.jsxs(es,{value:"search",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(oR,{className:"w-4 h-4 mr-2"}),"Search Users"]}),o.jsxs(es,{value:"moderation",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(xi,{className:"w-4 h-4 mr-2"}),"Moderation"]}),o.jsxs(es,{value:"economy",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(Es,{className:"w-4 h-4 mr-2"}),"Economy"]})]}),o.jsx(Gs,{value:"users",children:o.jsx(Fe,{className:"bg-[#0a0a0f] border-[#2a2a3a]",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsx("h3",{className:"text-lg font-semibold text-white",children:"Users"}),o.jsxs(wt,{variant:"secondary",className:"bg-[#1a1a24] text-gray-300",children:[se.length," users"]})]}),ie?o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"w-8 h-8 mx-auto mb-4 animate-spin border-4 border-purple-600 border-t-transparent rounded-full"}),o.jsx("p",{className:"text-gray-400",children:"Loading users..."})]}):o.jsxs("div",{className:"overflow-x-auto",children:[o.jsxs("table",{className:"w-full",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"border-b border-[#2a2a3a]",children:[o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"User"}),o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"Email"}),o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"Status"}),o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"Level"}),o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"Coins"}),o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"Joined"}),o.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium",children:"Actions"})]})}),o.jsx("tbody",{children:se.map(_e=>{var Je,st;return o.jsxs("tr",{className:"border-b border-[#2a2a3a] hover:bg-[#1a1a24] transition-colors",children:[o.jsx("td",{className:"py-3 px-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white font-semibold text-sm",children:((Je=_e.full_name)==null?void 0:Je.charAt(0))||((st=_e.username)==null?void 0:st.charAt(0))||"?"})}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-medium text-white",children:["@",_e.username||_e.full_name||"Unknown"]}),o.jsxs("div",{className:"text-sm text-gray-400",children:[_e.id.slice(0,8),"..."]})]})]})}),o.jsx("td",{className:"py-3 px-4",children:o.jsx("div",{className:"text-gray-300",children:_e.email||"No email"})}),o.jsx("td",{className:"py-3 px-4",children:o.jsx(wt,{className:`${he(_e)} text-white text-xs`,children:Ze(_e)})}),o.jsx("td",{className:"py-3 px-4",children:o.jsx("div",{className:"text-cyan-400 font-semibold",children:_e.level||0})}),o.jsx("td",{className:"py-3 px-4",children:o.jsx("div",{className:"text-yellow-400 font-semibold",children:(_e.coins||0).toLocaleString()})}),o.jsx("td",{className:"py-3 px-4",children:o.jsx("div",{className:"text-gray-400 text-sm",children:Qe(_e.created_at)})}),o.jsx("td",{className:"py-3 px-4",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ke,{size:"sm",variant:"ghost",className:"p-1 h-8 w-8 text-gray-400 hover:text-blue-400",onClick:()=>we(_e),title:"View user profile",children:o.jsx(bD,{className:"w-4 h-4"})}),o.jsx(ke,{size:"sm",variant:"ghost",className:"p-1 h-8 w-8 text-gray-400 hover:text-blue-400",onClick:()=>me(_e),title:"Edit user",children:o.jsx(SD,{className:"w-4 h-4"})}),o.jsx(ke,{size:"sm",variant:"ghost",className:"p-1 h-8 w-8 text-gray-400 hover:text-green-400",onClick:()=>ye(_e),title:"Add coins",children:o.jsx(kH,{className:"w-4 h-4"})}),o.jsx(ke,{size:"sm",variant:"ghost",className:`p-1 h-8 w-8 ${_e.is_admin||_e.role==="admin"?"text-purple-400 hover:text-gray-400":"text-gray-400 hover:text-purple-400"}`,onClick:()=>Oe(_e),title:_e.is_admin||_e.role==="admin"?"Demote from admin":"Promote to admin",children:o.jsx(xi,{className:"w-4 h-4"})}),o.jsx(ke,{size:"sm",variant:"ghost",className:`p-1 h-8 w-8 ${_e.is_banned?"text-red-400 hover:text-green-400":"text-gray-400 hover:text-red-400"}`,onClick:()=>ge(_e),title:_e.is_banned?"Unban user":"Ban user",children:_e.is_banned?o.jsx(oP,{className:"w-4 h-4"}):o.jsx(Ly,{className:"w-4 h-4"})}),o.jsx(ke,{size:"sm",variant:"ghost",className:"p-1 h-8 w-8 text-gray-400 hover:text-orange-400",onClick:()=>Ee(_e),title:"Kick user (redirects to payment page)",children:o.jsx(up,{className:"w-4 h-4"})})]})})]},_e.id)})})]}),se.length===0&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx(Pa,{className:"w-12 h-12 mx-auto mb-4 text-gray-600"}),o.jsx("p",{className:"text-gray-400",children:"No users found"})]})]})]})})}),o.jsx(gm,{open:y,onOpenChange:w,children:o.jsxs(_m,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(ym,{children:[o.jsx(vm,{className:"text-white",children:"Edit User"}),o.jsxs(my,{className:"text-gray-400",children:["Update user information for @",(u==null?void 0:u.username)||(u==null?void 0:u.full_name)]})]}),o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ke,{onClick:()=>{w(!1)},className:"bg-blue-600 hover:bg-blue-700",children:"Save Changes"}),o.jsx(ke,{variant:"outline",onClick:()=>w(!1),className:"border-[#2a2a3a] text-white hover:bg-[#2a2a3a]",children:"Cancel"})]})})]})}),o.jsx(gm,{open:b,onOpenChange:x,children:o.jsxs(_m,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(ym,{children:[o.jsx(vm,{className:"text-white",children:"Add Coins"}),o.jsxs(my,{className:"text-gray-400",children:["Add coins to @",(u==null?void 0:u.username)||(u==null?void 0:u.full_name)]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Coin Type"}),o.jsxs("select",{value:V,onChange:_e=>W(_e.target.value),className:"w-full bg-[#0a0a0f] border-[#2a2a3a] text-white rounded px-3 py-2",children:[o.jsx("option",{value:"real",children:"Real Coins (Purchased)"}),o.jsx("option",{value:"free",children:"Free Coins"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Amount"}),o.jsx(Zt,{type:"number",value:F,onChange:_e=>z(parseInt(_e.target.value)||0),className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",min:"1"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ke,{onClick:je,className:"bg-green-600 hover:bg-green-700",children:"Add Coins"}),o.jsx(ke,{variant:"outline",onClick:()=>x(!1),className:"border-[#2a2a3a] text-white hover:bg-[#2a2a3a]",children:"Cancel"})]})]})]})}),o.jsx(gm,{open:T,onOpenChange:N,children:o.jsxs(_m,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(ym,{children:[o.jsx(vm,{className:"text-white",children:u!=null&&u.is_banned?"Unban User":"Ban User"}),o.jsxs(my,{className:"text-gray-400",children:["Are you sure you want to ",u!=null&&u.is_banned?"unban":"ban"," @",(u==null?void 0:u.username)||(u==null?void 0:u.full_name),"?"]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ke,{onClick:De,className:u!=null&&u.is_banned?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:u!=null&&u.is_banned?"Unban User":"Ban User"}),o.jsx(ke,{variant:"outline",onClick:()=>N(!1),className:"border-[#2a2a3a] text-white hover:bg-[#2a2a3a]",children:"Cancel"})]})]})}),o.jsx(gm,{open:O,onOpenChange:P,children:o.jsxs(_m,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsxs(ym,{children:[o.jsx(vm,{className:"text-white",children:"Change User Role"}),o.jsxs(my,{className:"text-gray-400",children:["Change role for @",(u==null?void 0:u.username)||(u==null?void 0:u.full_name)]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{onClick:()=>fe(!0),className:u!=null&&u.is_admin||(u==null?void 0:u.role)==="admin"?"bg-gray-600 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700",disabled:(u==null?void 0:u.is_admin)||(u==null?void 0:u.role)==="admin",children:[o.jsx(xi,{className:"w-4 h-4 mr-2"}),"Make Admin"]}),o.jsxs(ke,{onClick:()=>fe(!1),className:u!=null&&u.is_admin||(u==null?void 0:u.role)==="admin"?"bg-blue-600 hover:bg-blue-700":"bg-gray-600 cursor-not-allowed",disabled:!(u!=null&&u.is_admin||(u==null?void 0:u.role)==="admin"),children:[o.jsx(Pa,{className:"w-4 h-4 mr-2"}),"Make User"]})]}),o.jsx(ke,{variant:"outline",onClick:()=>P(!1),className:"border-[#2a2a3a] text-white hover:bg-[#2a2a3a] w-full",children:"Cancel"})]})]})})]})]})}function Lbe(){const[n,a]=M.useState(null),{data:l}=mt({queryKey:["earningsConfigForAdmin"],queryFn:async()=>{try{const{data:N}=await K.from("earnings_config").select("*").eq("id",1).single();return N||null}catch{return null}},staleTime:5e3,refetchInterval:5e3});M.useEffect(()=>{a(l||null)},[l]),M.useEffect(()=>{try{const N=K.channel("earnings_config_admin_rt");return N.on("postgres_changes",{event:"UPDATE",schema:"public",table:"earnings_config",filter:"id=eq.1"},O=>{const P=(O==null?void 0:O.new)||null;P&&a(P)}).subscribe(),()=>{try{N.unsubscribe()}catch{}}}catch{}},[]);const u={url:!0,key:!0,configured:!!K.__isConfigured},m={appId:!0,devToken:!1},y={active:!!(n!=null&&n.square_account_active),appId:!!(n!=null&&n.square_application_id),location:!!(n!=null&&n.square_location_id),accessToken:!!(n!=null&&n.square_access_token),environment:!!(n!=null&&n.square_environment)},w=async()=>{try{!u.url||u.key;const{data:N,error:O}=await K.from("profiles").select("id").limit(1);if(O)throw O;pe.success("Supabase: OK")}catch(N){pe.error((N==null?void 0:N.message)||"Supabase test failed")}},b=async()=>{try{m.appId,window.AgoraRTC||await new Promise((z,V)=>{const W=document.createElement("script");W.src="https://download.agora.io/sdk/release/AgoraRTC_N-4.20.0.js",W.onload=z,W.onerror=()=>V(new Error("Failed to load Agora SDK")),document.head.appendChild(W)});const N=`admin_integrations_${Date.now()}`;let O;try{const z=await K.functions.invoke("generateagoratoken",{body:{channelName:N,role:"publisher",uid:1}});O=(z==null?void 0:z.data)||z}catch{O=await qy(N,1)}if(!((O==null?void 0:O.token)||(O==null?void 0:O.rtcToken)||void 0||null))throw new Error("Agora token missing");if(!window.AgoraRTC.createClient({mode:"live",codec:"vp8"}))throw new Error("Client create failed");pe.success("Agora: OK")}catch(N){pe.error((N==null?void 0:N.message)||"Agora test failed")}},x=async()=>{try{const N=await HD();if(!(N!=null&&N.success))throw new Error((N==null?void 0:N.error)||"Square test failed");pe.success("Square: OK")}catch(N){pe.error((N==null?void 0:N.message)||"Square test failed")}},T=({label:N,ok:O})=>o.jsxs("div",{className:"flex items-center gap-2",children:[O?o.jsx(Ui,{className:"w-4 h-4 text-emerald-400"}):o.jsx(Aw,{className:"w-4 h-4 text-red-400"}),o.jsx("span",{className:"text-gray-300 text-sm",children:N})]});return o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-white font-semibold",children:"Supabase"}),o.jsx(wt,{className:"bg-blue-500 text-white",children:"Core"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(T,{label:"URL present",ok:u.url}),o.jsx(T,{label:"Anon key present",ok:u.key}),o.jsx(T,{label:"Client configured",ok:u.configured})]}),o.jsx("div",{className:"mt-3",children:o.jsx(ke,{size:"sm",variant:"outline",onClick:w,children:"Run Test"})})]}),o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-white font-semibold",children:"Agora"}),o.jsx(wt,{className:"bg-purple-500 text-white",children:"Streaming"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(T,{label:"App ID present",ok:m.appId}),o.jsx(T,{label:"Dev token available",ok:m.devToken})]}),o.jsx("div",{className:"mt-3",children:o.jsx(ke,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:b,children:"Run Test"})})]}),o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:"text-white font-semibold",children:"Square"}),o.jsx(wt,{className:"bg-emerald-500 text-black",children:"Payments"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(T,{label:"Account active",ok:y.active}),o.jsx(T,{label:"Application ID",ok:y.appId}),o.jsx(T,{label:"Access token",ok:y.accessToken}),o.jsx(T,{label:"Environment",ok:y.environment}),o.jsx(T,{label:"Location ID",ok:y.location})]}),o.jsx("div",{className:"mt-3",children:o.jsx(ke,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",onClick:x,children:"Run Test"})})]})]})})}function Mbe(){const i=vn(),{data:n=[]}=mt({queryKey:["apps_officers"],queryFn:async()=>{const{data:T}=await K.from("troll_officer_applications").select("*").order("created_at",{ascending:!1}).limit(200);return T||[]},staleTime:5e3,refetchInterval:1e4}),{data:a=[]}=mt({queryKey:["apps_families"],queryFn:async()=>{const{data:T}=await K.from("troll_family_applications").select("*").order("created_at",{ascending:!1}).limit(200);return T||[]},staleTime:5e3,refetchInterval:1e4}),l=Wt({mutationFn:async T=>{if(!K.__isConfigured)throw new Error("Supabase not configured");const N=T.user_id||null;if(!N&&!(T.user_email||T.user_username))throw new Error("Missing applicant id");if(await K.from("troll_officer_applications").update({status:"approved"}).eq("id",T.id),N)await K.from("profiles").update({role:"troll_officer",is_troll_officer:!0}).eq("id",N);else if(T.user_email||T.user_username){let O=K.from("profiles").select("id").limit(1);T.user_email&&(O=O.eq("email",T.user_email)),T.user_username&&(O=O.eq("username",T.user_username));const{data:P}=await O.single().catch(()=>({data:null})),F=(P==null?void 0:P.id)||null;F&&await K.from("profiles").update({role:"troll_officer",is_troll_officer:!0}).eq("id",F)}try{await K.from("notifications").insert({user_id:T.user_id,type:"officer_application_status",title:"Officer Application",message:"Approved",is_read:!1,created_date:new Date().toISOString()})}catch{}return!0},onSuccess:()=>{i.invalidateQueries(["apps_officers"]),pe.success("Officer approved")},onError:T=>pe.error((T==null?void 0:T.message)||"Approve failed")}),u=Wt({mutationFn:async T=>{if(!K.__isConfigured)throw new Error("Supabase not configured");await K.from("troll_officer_applications").update({status:"rejected"}).eq("id",T.id);try{await K.from("notifications").insert({user_id:T.user_id,type:"officer_application_status",title:"Officer Application",message:"Rejected",is_read:!1,created_date:new Date().toISOString()})}catch{}return!0},onSuccess:()=>{i.invalidateQueries(["apps_officers"]),pe.success("Officer rejected")},onError:T=>pe.error((T==null?void 0:T.message)||"Reject failed")}),m=Wt({mutationFn:async T=>{if(!K.__isConfigured)throw new Error("Supabase not configured");const N=T.user_id||null;await K.from("troll_family_applications").update({status:"approved"}).eq("id",T.id);const O={name:T.family_name,owner_id:N,emoji:T.family_emoji||null,color:T.family_color||null,created_date:new Date().toISOString()};let P=null;try{const{data:F}=await K.from("troll_families").insert(O).select().single();P=(F==null?void 0:F.id)||null}catch{}if(N){try{await K.from("troll_family_members").insert({family_id:P,user_id:N,role:"owner",joined_date:new Date().toISOString()})}catch{}try{await K.from("profiles").update({owns_troll_family:!0,troll_family_name:T.family_name}).eq("id",N)}catch{}}try{await K.from("notifications").insert({user_id:N,type:"family_application_status",title:"Troll Family Application",message:"Approved",is_read:!1,created_date:new Date().toISOString()})}catch{}return!0},onSuccess:()=>{i.invalidateQueries(["apps_families"]),pe.success("Family approved")},onError:T=>pe.error((T==null?void 0:T.message)||"Approve failed")}),y=Wt({mutationFn:async T=>{if(!K.__isConfigured)throw new Error("Supabase not configured");await K.from("troll_family_applications").update({status:"rejected"}).eq("id",T.id);try{await K.from("notifications").insert({user_id:T.user_id,type:"family_application_status",title:"Troll Family Application",message:"Rejected",is_read:!1,created_date:new Date().toISOString()})}catch{}return!0},onSuccess:()=>{i.invalidateQueries(["apps_families"]),pe.success("Family rejected")},onError:T=>pe.error((T==null?void 0:T.message)||"Reject failed")}),w=Wt({mutationFn:async T=>{if(!K.__isConfigured)throw new Error("Supabase not configured");const{data:N}=await K.from("troll_families").select("id").eq("name",T.family_name).single();N!=null&&N.id&&(await K.from("troll_family_members").delete().eq("family_id",N.id),await K.from("profiles").update({troll_family_name:null,owns_troll_family:!1}).eq("troll_family_name",T.family_name),await K.from("troll_families").delete().eq("id",N.id)),await K.from("troll_family_applications").update({status:"deleted"}).eq("id",T.id);try{await K.from("notifications").insert({user_id:T.user_id,type:"family_application_status",title:"Troll Family Deleted",message:"Your troll family has been deleted by an admin",is_read:!1,created_date:new Date().toISOString()})}catch{}return!0},onSuccess:()=>{i.invalidateQueries(["apps_families"]),pe.success("Family deleted successfully")},onError:T=>pe.error((T==null?void 0:T.message)||"Delete failed")}),b=Wt({mutationFn:async T=>{if(!K.__isConfigured)throw new Error("Supabase not configured");await K.from("troll_family_applications").delete().eq("id",T.id);try{await K.from("notifications").insert({user_id:T.user_id,type:"family_application_status",title:"Application Deleted",message:"Your troll family application has been deleted by an admin",is_read:!1,created_date:new Date().toISOString()})}catch{}return!0},onSuccess:()=>{i.invalidateQueries(["apps_families"]),pe.success("Application deleted successfully")},onError:T=>pe.error((T==null?void 0:T.message)||"Delete failed")}),x=({title:T,items:N,renderRow:O})=>o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("h4",{className:"text-white font-semibold mb-3",children:T}),N.length===0?o.jsx("p",{className:"text-sm text-gray-400",children:"No applications"}):o.jsx("div",{className:"space-y-3",children:N.map(O)})]});return o.jsxs("div",{className:"space-y-6",children:[o.jsx(x,{title:"Troll Officer Applications",items:n,renderRow:T=>o.jsx(Fe,{className:"p-3 bg-[#11121a] border-[#2a2a3a]",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"text-white font-semibold",children:["@",T.user_username||T.user_email||T.user_id||"unknown"]}),o.jsxs("div",{className:"text-xs text-gray-500",children:["Status: ",o.jsx(wt,{className:T.status==="approved"?"bg-green-600":T.status==="rejected"?"bg-red-600":"bg-yellow-600",children:T.status||"pending"})]})]}),!T.status||T.status==="pending"?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ke,{size:"sm",className:"bg-emerald-600",onClick:()=>l.mutate(T),disabled:l.isPending||u.isPending,children:"Approve"}),o.jsx(ke,{size:"sm",variant:"outline",className:"border-red-500 text-red-400",onClick:()=>u.mutate(T),disabled:l.isPending||u.isPending,children:"Deny"})]}):null]})},T.id)}),o.jsx(x,{title:"Troll Family Applications",items:a,renderRow:T=>o.jsx(Fe,{className:"p-3 bg-[#11121a] border-[#2a2a3a]",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-white font-semibold",children:T.family_name}),o.jsxs("div",{className:"text-xs text-gray-500",children:["Status: ",o.jsx(wt,{className:T.status==="approved"?"bg-green-600":T.status==="rejected"?"bg-red-600":"bg-yellow-600",children:T.status||"pending"})]})]}),!T.status||T.status==="pending"?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ke,{size:"sm",className:"bg-emerald-600",onClick:()=>m.mutate(T),disabled:m.isPending||y.isPending,children:"Approve"}),o.jsx(ke,{size:"sm",variant:"outline",className:"border-red-500 text-red-400",onClick:()=>y.mutate(T),disabled:m.isPending||y.isPending,children:"Deny"}),o.jsx(ke,{size:"sm",variant:"outline",className:"border-orange-600 text-orange-500 hover:bg-orange-600 hover:text-white",onClick:()=>b.mutate(T),disabled:b.isPending,children:"Delete App"})]}):T.status==="approved"?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ke,{size:"sm",variant:"outline",className:"border-red-600 text-red-500 hover:bg-red-600 hover:text-white",onClick:()=>w.mutate(T),disabled:w.isPending,children:"Delete Family"}),o.jsx(ke,{size:"sm",variant:"outline",className:"border-orange-600 text-orange-500 hover:bg-orange-600 hover:text-white",onClick:()=>b.mutate(T),disabled:b.isPending,children:"Delete App"})]}):o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(ke,{size:"sm",variant:"outline",className:"border-orange-600 text-orange-500 hover:bg-orange-600 hover:text-white",onClick:()=>b.mutate(T),disabled:b.isPending,children:"Delete App"})})]})},T.id)})]})}function Ube(){const i=vn(),[n,a]=M.useState(""),[l,u]=M.useState("all"),[m,y]=M.useState(null),[w,b]=M.useState({loading:!0,connected:!1,error:null}),[x,T]=M.useState(!1);M.useEffect(()=>{(async()=>{try{b({loading:!0,connected:!1,error:null});const G=await BR();y(G);const se=await HD();b({loading:!1,connected:se.success,error:se.error||null}),se.success||console.warn("Square connection issues:",se.error)}catch(G){console.error("Error checking Square status:",G),b({loading:!1,connected:!1,error:G.message})}})()},[]);const{data:N=[],isLoading:O}=mt({queryKey:["cashoutRecords",n,l],queryFn:async()=>{if(!K.__isConfigured)return[];let Q=K.from("cashout_requests").select(`
          *,
          profiles!user_id(username, full_name, email)
        `).order("created_at",{ascending:!1}).limit(200);if(n.trim().length>=2){const ie=n.trim().toLowerCase();Q=Q.or(`profiles.username.ilike.%${ie}%,profiles.full_name.ilike.%${ie}%`)}l!=="all"&&(Q=Q.eq("status",l));const{data:G,error:se}=await Q;return se?(console.error("Error fetching cashouts:",se),pe.error("Failed to load cashout records"),[]):G||[]}}),P=Wt({mutationFn:async({cashoutId:Q,approve:G,reason:se=""})=>{const{error:ie}=await K.from("cashout_requests").update({status:G?"approved":"rejected",processed_at:new Date().toISOString(),processed_by:"admin",rejection_reason:se}).eq("id",Q);if(ie)throw ie},onSuccess:()=>{i.invalidateQueries(["cashoutRecords"]),pe.success("Cashout processed successfully!")},onError:Q=>{pe.error("Failed to process cashout: "+Q.message)}}),F=Wt({mutationFn:async()=>{if(!w.connected)throw new Error("Square integration is not active");const{data:Q,error:G}=await K.from("cashout_requests").select(`
          *,
          profiles!user_id(username, full_name, email, square_customer_id)
        `).eq("status","pending").order("created_at",{ascending:!0}).limit(10);if(G)throw G;if(!Q||Q.length===0)throw new Error("No pending cashout requests found");let se=0,ie=0;for(const ce of Q)try{const{data:Se,error:oe}=await K.functions.invoke("processSquarePayout",{body:{cashoutId:ce.id,amount:ce.coins_cost/100,currency:"USD",paymentMethod:ce.payment_method,userId:ce.user_id}});if(oe)throw new Error(`Square payout failed: ${oe.message}`);if(Se.success)se++;else throw new Error(Se.error||"Payout failed")}catch(Se){ie++,console.error(`Error processing payout for cashout ${ce.id}:`,Se),await K.from("cashout_requests").update({status:"failed",processed_at:new Date().toISOString(),processed_by:"auto_payout",rejection_reason:`Auto-payout failed: ${Se.message}`}).eq("id",ce.id)}return{processedCount:se,errorCount:ie,total:Q.length}},onSuccess:Q=>{i.invalidateQueries(["cashoutRecords"]),pe.success(`Auto-payout completed! Processed: ${Q.processedCount}, Errors: ${Q.errorCount}`)},onError:Q=>{pe.error("Auto-payout failed: "+Q.message)}}),z=async Q=>{try{if(!w.connected)return{success:!1,error:"Square integration not active"};const G=Q.coins_cost/100,se=Math.round(G*100),{data:ie,error:ce}=await K.functions.invoke("processSquarePayout",{body:{cashoutId:Q.id,amount:G,currency:"USD",paymentMethod:Q.payment_method,userId:Q.user_id}});return ce?(console.error("Square payout function error:",ce),{success:!1,error:ce.message||"Payout processing failed"}):{success:ie.success,transactionId:ie.payoutId,amount:se,currency:ie.currency,message:ie.message}}catch(G){return console.error("Square payout error:",G),{success:!1,error:G.message||"Payout processing failed"}}},V=Q=>{switch(Q){case"pending":return o.jsxs(wt,{className:"bg-yellow-600 text-white",children:[o.jsx(uo,{className:"w-3 h-3 mr-1"}),"Pending"]});case"approved":return o.jsxs(wt,{className:"bg-green-600 text-white",children:[o.jsx(Ui,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return o.jsxs(wt,{className:"bg-red-600 text-white",children:[o.jsx(Aw,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return o.jsx(wt,{variant:"outline",children:Q})}},W=Q=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Q),te=N.filter(Q=>Q.status==="pending").reduce((Q,G)=>Q+(G.amount||0),0),$=N.filter(Q=>Q.status==="approved").reduce((Q,G)=>Q+(G.amount||0),0);return o.jsxs("div",{className:"space-y-6",children:[o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(_y,{className:"w-6 h-6 text-blue-400"}),o.jsx("h3",{className:"text-lg font-semibold text-white",children:"Square Integration"})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[w.loading?o.jsxs(wt,{variant:"outline",className:"text-yellow-400 border-yellow-400",children:[o.jsx(uo,{className:"w-3 h-3 mr-1"})," Checking..."]}):w.connected?o.jsxs(wt,{className:"bg-green-600 text-white",children:[o.jsx(Ui,{className:"w-3 h-3 mr-1"})," Connected"]}):o.jsxs(wt,{className:"bg-red-600 text-white",children:[o.jsx(Aw,{className:"w-3 h-3 mr-1"})," Disconnected"]}),o.jsxs(ke,{size:"sm",variant:"outline",onClick:()=>T(!x),className:"border-blue-400 text-blue-400 hover:bg-blue-400 hover:text-white",children:[o.jsx(My,{className:"w-4 h-4 mr-1"}),"Auto-Payout"]}),o.jsx(ke,{size:"sm",onClick:()=>F.mutate(),disabled:!w.connected||F.isLoading,className:"bg-blue-600 hover:bg-blue-700 text-white",children:F.isLoading?o.jsxs(o.Fragment,{children:[o.jsx(uo,{className:"w-4 h-4 mr-1 animate-spin"}),"Processing..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Pw,{className:"w-4 h-4 mr-1"}),"Process All"]})})]})]}),w.error&&o.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[o.jsx(Ic,{className:"w-4 h-4"}),w.error]}),x&&o.jsxs("div",{className:"mt-4 p-4 bg-[#2a2a3a] rounded-lg",children:[o.jsx("h4",{className:"text-white font-medium mb-2",children:"Auto-Payout Settings"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400",children:"Max Batch Size"}),o.jsx("p",{className:"text-white",children:"10 requests"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400",children:"Processing Delay"}),o.jsx("p",{className:"text-white",children:"500ms per payout"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-gray-400",children:"Coin Conversion"}),o.jsx("p",{className:"text-white",children:"100 coins = $1.00"})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-400",children:"Total Pending"}),o.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:W(te)})]}),o.jsx(uo,{className:"w-8 h-8 text-yellow-400"})]})}),o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-400",children:"Total Approved"}),o.jsx("p",{className:"text-2xl font-bold text-green-400",children:W($)})]}),o.jsx(Ui,{className:"w-8 h-8 text-green-400"})]})}),o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-400",children:"Pending Count"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:N.filter(Q=>Q.status==="pending").length})]}),o.jsx(Gce,{className:"w-8 h-8 text-gray-400"})]})}),o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-400",children:"Total Requests"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:N.length})]}),o.jsx(Es,{className:"w-8 h-8 text-gray-400"})]})})]}),o.jsxs("div",{className:"flex gap-4 mb-4",children:[o.jsx("div",{className:"flex-1",children:o.jsx(Zt,{placeholder:"Search by username or name...",value:n,onChange:Q=>a(Q.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})}),o.jsxs("select",{value:l,onChange:Q=>u(Q.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white rounded-lg px-3 py-2",children:[o.jsx("option",{value:"all",children:"All Status"}),o.jsx("option",{value:"pending",children:"Pending"}),o.jsx("option",{value:"approved",children:"Approved"}),o.jsx("option",{value:"rejected",children:"Rejected"})]})]}),o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-sm text-left",children:[o.jsx("thead",{className:"text-xs text-gray-400 uppercase bg-[#1a1a24]",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-6 py-3",children:"User"}),o.jsx("th",{className:"px-6 py-3",children:"Amount"}),o.jsx("th",{className:"px-6 py-3",children:"Status"}),o.jsx("th",{className:"px-6 py-3",children:"Requested"}),o.jsx("th",{className:"px-6 py-3",children:"Payment Method"}),o.jsx("th",{className:"px-6 py-3",children:"Square Transaction"}),o.jsx("th",{className:"px-6 py-3",children:"Notes"}),o.jsx("th",{className:"px-6 py-3",children:"Actions"})]})}),o.jsx("tbody",{className:"divide-y divide-[#2a2a3a]",children:O?o.jsx("tr",{children:o.jsx("td",{colSpan:"8",className:"px-6 py-8 text-center text-gray-400",children:"Loading cashout records..."})}):N.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:"8",className:"px-6 py-8 text-center text-gray-400",children:"No cashout records found"})}):N.map(Q=>{var G,se,ie;return o.jsxs("tr",{className:"hover:bg-[#2a2a3a]",children:[o.jsx("td",{className:"px-6 py-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Pa,{className:"w-5 h-5 text-gray-400"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-white font-medium",children:((G=Q.profiles)==null?void 0:G.full_name)||((se=Q.profiles)==null?void 0:se.username)||"Unknown User"}),o.jsx("div",{className:"text-xs text-gray-400",children:(ie=Q.profiles)==null?void 0:ie.email})]})]})}),o.jsxs("td",{className:"px-6 py-4",children:[o.jsx("div",{className:"text-white font-medium",children:W(Q.amount)}),o.jsxs("div",{className:"text-xs text-gray-400",children:[Q.coins_cost," coins"]})]}),o.jsx("td",{className:"px-6 py-4",children:V(Q.status)}),o.jsxs("td",{className:"px-6 py-4",children:[o.jsx("div",{className:"text-white",children:new Date(Q.created_at).toLocaleDateString()}),o.jsx("div",{className:"text-xs text-gray-400",children:new Date(Q.created_at).toLocaleTimeString()})]}),o.jsxs("td",{className:"px-6 py-4",children:[o.jsx("div",{className:"text-white text-sm",children:Q.payment_method}),Q.payment_details&&o.jsxs("div",{className:"text-xs text-gray-400",children:[Q.payment_details.substring(0,20),"..."]})]}),o.jsx("td",{className:"px-6 py-4",children:Q.square_transaction_id?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(wt,{variant:"outline",className:"text-green-400 border-green-400",children:[o.jsx(Ui,{className:"w-3 h-3 mr-1"}),Q.square_transaction_id.substring(0,8),"..."]}),o.jsx(bD,{className:"w-4 h-4 text-blue-400 cursor-pointer hover:text-blue-300"})]}):Q.status==="approved"?o.jsxs(wt,{variant:"outline",className:"text-yellow-400 border-yellow-400",children:[o.jsx(uo,{className:"w-3 h-3 mr-1"}),"Pending Sync"]}):o.jsx("span",{className:"text-gray-500 text-sm",children:""})}),o.jsx("td",{className:"px-6 py-4",children:Q.notes?o.jsx("div",{className:"text-xs text-gray-300 max-w-40 truncate",title:Q.notes,children:Q.notes}):Q.rejection_reason?o.jsx("div",{className:"text-xs text-red-400 max-w-40 truncate",title:Q.rejection_reason,children:Q.rejection_reason}):o.jsx("span",{className:"text-gray-500 text-sm",children:""})}),o.jsxs("td",{className:"px-6 py-4",children:[Q.status==="pending"&&o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ke,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>P.mutate({cashoutId:Q.id,approve:!0}),children:"Approve"}),o.jsx(ke,{size:"sm",className:"bg-red-600 hover:bg-red-700 text-white",onClick:()=>{const ce=prompt("Enter rejection reason:");ce!==null&&P.mutate({cashoutId:Q.id,approve:!1,reason:ce})},children:"Reject"})]}),Q.status==="approved"&&!Q.square_transaction_id&&o.jsxs(ke,{size:"sm",variant:"outline",className:"border-blue-400 text-blue-400 hover:bg-blue-400 hover:text-white",onClick:async()=>{try{const ce=await z(Q);ce.success?(await K.from("cashout_requests").update({square_transaction_id:ce.transactionId,notes:`Square payout processed - ${ce.message}`}).eq("id",Q.id),pe.success("Square payout processed!"),i.invalidateQueries(["cashoutRecords"])):pe.error("Square payout failed: "+ce.error)}catch(ce){pe.error("Error processing payout: "+ce.message)}},children:[o.jsx(Pw,{className:"w-3 h-3 mr-1"}),"Process"]})]})]},Q.id)})})]})})})]})}function HY({className:i="",children:n,...a}){return o.jsx("div",{className:"w-full overflow-auto",children:o.jsx("table",{className:`w-full caption-bottom text-sm ${i}`,...a,children:n})})}function KY({className:i="",children:n,...a}){return o.jsx("thead",{className:`[&_tr]:border-b [&_tr]:border-[#2a2a3a] ${i}`,...a,children:n})}function zY({className:i="",children:n,...a}){return o.jsx("tbody",{className:`[&_tr:last-child]:border-0 ${i}`,...a,children:n})}function xR({className:i="",children:n,...a}){return o.jsx("tr",{className:`border-b border-[#2a2a3a] transition-colors hover:bg-[#1a1a25] data-[state=selected]:bg-[#2a2a3a] ${i}`,...a,children:n})}function co({className:i="",children:n,...a}){return o.jsx("th",{className:`h-12 px-4 text-left align-middle font-medium text-[#a0a0b0] [&:has([role=checkbox])]:pr-0 ${i}`,...a,children:n})}function lo({className:i="",children:n,...a}){return o.jsx("td",{className:`p-4 align-middle [&:has([role=checkbox])]:pr-0 ${i}`,...a,children:n})}const $Y={kick:500,ban:2e3,ban3x:5e3,family_create:500,message_admin:3200,disable_chat:100,racism_lock:1500};async function Fbe(i,n,a={}){if(!i)throw new Error("payFee: missing userId");const l=$Y[n];if(!l||l<=0)return{skipped:!0};const{data:u,error:m}=await K.from("profiles").select("purchased_coins, coins").eq("id",i).single();if(m)throw m;if(Number((u==null?void 0:u.purchased_coins)||0)<l)throw new Error(`Not enough purchased coins (${l} required)`);return await WR(i,l,{reason:`fee_${n}`,source:"fee",reference:a.reference})}async function DG(i){if(!i)return 0;try{const{data:n}=await K.from("profiles").select("message_fee_paid_coins").eq("id",i).single(),a=Number((n==null?void 0:n.message_fee_paid_coins)||0);return Number.isFinite(a)&&a>0?a:0}catch{return 0}}function Vbe({currentUser:i}){const n=vn(),[a,l]=M.useState(!1),[u,m]=M.useState(null),[y,w]=M.useState(!1),[b,x]=M.useState("platform"),[T,N]=M.useState({code:"",name:"",amount:0,category:"platform",description:"",is_active:!0}),{data:O=[],isLoading:P}=mt({queryKey:["customFees"],queryFn:async()=>{const{data:ce,error:Se}=await K.from("fees").select("*").order("category",{ascending:!0}).order("code",{ascending:!0});if(Se)throw Se;return ce||[]}}),{data:F=[]}=mt({queryKey:["feeCategories"],queryFn:async()=>{const{data:ce,error:Se}=await K.from("fee_categories").select("*").order("name",{ascending:!0});if(Se)throw Se;return ce||[]}}),z=Wt({mutationFn:async ce=>{const{error:Se}=await K.from("fees").insert({...ce,created_by:i==null?void 0:i.id,created_at:new Date().toISOString()});if(Se)throw Se},onSuccess:()=>{n.invalidateQueries(["customFees"]),pe.success("Fee created successfully"),w(!1),N({code:"",name:"",amount:0,category:"platform",description:"",is_active:!0})},onError:ce=>{pe.error((ce==null?void 0:ce.message)||"Failed to create fee")}});Wt({mutationFn:async ce=>{const{error:Se}=await K.from("fees").update({...ce,updated_by:i==null?void 0:i.id,updated_at:new Date().toISOString()}).eq("id",ce.id);if(Se)throw Se},onSuccess:()=>{n.invalidateQueries(["customFees"]),pe.success("Fee updated successfully"),l(!1),m(null)},onError:ce=>{pe.error((ce==null?void 0:ce.message)||"Failed to update fee")}});const V=Wt({mutationFn:async ce=>{const{error:Se}=await K.from("fees").delete().eq("id",ce);if(Se)throw Se},onSuccess:()=>{n.invalidateQueries(["customFees"]),pe.success("Fee deleted successfully")},onError:ce=>{pe.error((ce==null?void 0:ce.message)||"Failed to delete fee")}}),W=()=>[...Object.entries($Y).map(([oe,ve])=>({id:`static_${oe}`,code:oe,name:te(oe),amount:ve,category:"platform",description:$(oe),is_active:!0,is_static:!0})),...O].filter(oe=>oe.category===b||b==="all"),te=ce=>ce.split("_").map(Se=>Se.charAt(0).toUpperCase()+Se.slice(1)).join(" "),$=ce=>({kick:"Fee for kicking a user from stream",ban:"Fee for banning a user",ban3x:"Fee for 3x ban (extended ban)",family_create:"Fee for creating a new family",message_admin:"Fee for sending messages to admin",disable_chat:"Fee for disabling chat",racism_lock:"Fee for racism-related locks"})[ce]||"Platform fee",Q=ce=>{if(ce.preventDefault(),!T.code||!T.name||T.amount<0){pe.error("Please fill in all required fields");return}z.mutate(T)},G=ce=>{m(ce),l(!0)},se=ce=>{if(ce.startsWith("static_")){pe.error("Cannot delete static platform fees");return}window.confirm("Are you sure you want to delete this fee?")&&V.mutate(ce)},ie=()=>{const ce=W(),Se={};return ce.forEach(oe=>{Se[oe.category]||(Se[oe.category]=0),Se[oe.category]+=oe.amount}),Se};return P?o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:o.jsx(pa,{className:"p-6",children:o.jsxs("div",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),o.jsx("span",{className:"ml-2 text-gray-400",children:"Loading fees..."})]})})}):o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsxs(oo,{className:"flex items-center gap-2 text-white",children:[o.jsx(Es,{className:"w-5 h-5"}),"Fee Management"]})}),o.jsxs(pa,{children:[o.jsxs("div",{className:"mb-6 p-4 bg-[#0a0a0f] border border-[#2a2a3a] rounded-lg",children:[o.jsx("h3",{className:"text-white font-semibold mb-3",children:"Fee Overview"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(ie()).map(([ce,Se])=>o.jsxs("div",{className:"text-center",children:[o.jsx("p",{className:"text-2xl font-bold text-purple-400",children:Se.toLocaleString()}),o.jsxs("p",{className:"text-xs text-gray-400 capitalize",children:[ce," Total"]})]},ce))})]}),o.jsxs(db,{value:b,onValueChange:x,className:"space-y-4",children:[o.jsxs(ub,{className:"bg-[#0a0a0f]",children:[o.jsx(es,{value:"platform",children:"Platform Fees"}),o.jsx(es,{value:"stream",children:"Stream Fees"}),o.jsx(es,{value:"premium",children:"Premium Fees"}),o.jsx(es,{value:"custom",children:"Custom Fees"}),o.jsx(es,{value:"all",children:"All Fees"})]}),o.jsxs(Gs,{value:b,className:"space-y-4",children:[o.jsx("div",{className:"overflow-x-auto",children:o.jsxs(HY,{children:[o.jsx(KY,{children:o.jsxs(xR,{className:"border-[#2a2a3a]",children:[o.jsx(co,{className:"text-gray-300",children:"Code"}),o.jsx(co,{className:"text-gray-300",children:"Name"}),o.jsx(co,{className:"text-gray-300",children:"Amount"}),o.jsx(co,{className:"text-gray-300",children:"Category"}),o.jsx(co,{className:"text-gray-300",children:"Status"}),o.jsx(co,{className:"text-gray-300",children:"Type"}),o.jsx(co,{className:"text-gray-300",children:"Actions"})]})}),o.jsx(zY,{children:W().map(ce=>o.jsxs(xR,{className:"border-[#2a2a3a]",children:[o.jsx(lo,{className:"text-white font-mono text-sm",children:ce.code}),o.jsx(lo,{className:"text-white",children:ce.name}),o.jsxs(lo,{className:"text-purple-400 font-semibold",children:[ce.amount.toLocaleString()," coins"]}),o.jsx(lo,{children:o.jsx(wt,{className:"bg-purple-600 text-white capitalize",children:ce.category})}),o.jsx(lo,{children:ce.is_active?o.jsx(wt,{className:"bg-green-600 text-white",children:"Active"}):o.jsx(wt,{className:"bg-red-600 text-white",children:"Inactive"})}),o.jsx(lo,{children:ce.is_static?o.jsx(wt,{className:"bg-blue-600 text-white",children:"Static"}):o.jsx(wt,{className:"bg-yellow-600 text-white",children:"Custom"})}),o.jsx(lo,{children:o.jsx("div",{className:"flex gap-2",children:!ce.is_static&&o.jsxs(o.Fragment,{children:[o.jsx(ke,{size:"sm",variant:"outline",onClick:()=>G(ce),className:"border-blue-500 text-blue-400 hover:bg-blue-500/20",children:o.jsx(SD,{className:"w-3 h-3"})}),o.jsx(ke,{size:"sm",variant:"outline",onClick:()=>se(ce.id),className:"border-red-500 text-red-400 hover:bg-red-500/20",children:o.jsx(up,{className:"w-3 h-3"})})]})})})]},ce.id))})]})}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs(ke,{onClick:()=>w(!0),className:"bg-purple-600 hover:bg-purple-700 text-white",children:[o.jsx(kH,{className:"w-4 h-4 mr-2"}),"Add New Fee"]}),o.jsxs("div",{className:"text-sm text-gray-400",children:["Total ",W().length," fees  ",W().filter(ce=>!ce.is_static).length," custom"]})]}),y&&o.jsxs(Fe,{className:"bg-[#0a0a0f] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white text-lg",children:"Add New Fee"})}),o.jsx(pa,{children:o.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx(jr,{className:"text-gray-300",children:"Fee Code *"}),o.jsx(Zt,{type:"text",value:T.code,onChange:ce=>N({...T,code:ce.target.value.toLowerCase().replace(/\s+/g,"_")}),placeholder:"e.g., custom_fee",className:"bg-[#1a1a24] border-[#2a2a3a] text-white",required:!0})]}),o.jsxs("div",{children:[o.jsx(jr,{className:"text-gray-300",children:"Fee Name *"}),o.jsx(Zt,{type:"text",value:T.name,onChange:ce=>N({...T,name:ce.target.value}),placeholder:"e.g., Custom Platform Fee",className:"bg-[#1a1a24] border-[#2a2a3a] text-white",required:!0})]}),o.jsxs("div",{children:[o.jsx(jr,{className:"text-gray-300",children:"Amount (coins) *"}),o.jsx(Zt,{type:"number",min:"0",value:T.amount,onChange:ce=>N({...T,amount:parseInt(ce.target.value)||0}),placeholder:"100",className:"bg-[#1a1a24] border-[#2a2a3a] text-white",required:!0})]}),o.jsxs("div",{children:[o.jsx(jr,{className:"text-gray-300",children:"Category"}),o.jsxs(gs,{value:T.category,onValueChange:ce=>N({...T,category:ce}),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"platform",children:"Platform"}),o.jsx(Ct,{value:"stream",children:"Stream"}),o.jsx(Ct,{value:"premium",children:"Premium"}),o.jsx(Ct,{value:"custom",children:"Custom"})]})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{className:"text-gray-300",children:"Description"}),o.jsx(Zt,{type:"text",value:T.description,onChange:ce=>N({...T,description:ce.target.value}),placeholder:"Description of what this fee is for",className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{type:"submit",disabled:z.isPending,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[o.jsx(RR,{className:"w-4 h-4 mr-2"}),z.isPending?"Creating...":"Create Fee"]}),o.jsxs(ke,{type:"button",onClick:()=>w(!1),variant:"outline",className:"border-[#2a2a3a] text-gray-300 hover:bg-[#1a1a24]",children:[o.jsx(Oc,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})})]})]})]})]})]})}function Bbe(){const[i,n]=M.useState([]),[a,l]=M.useState([]),[u,m]=M.useState({totalIncidents:0,emergencyIncidents:0,resolvedIncidents:0,pendingIncidents:0}),[y,w]=M.useState(!0),[b,x]=M.useState(null),[T,N]=M.useState(!1);M.useEffect(()=>{O();const V=K.channel("safety_incidents").on("postgres_changes",{event:"*",schema:"public",table:"safety_incidents"},W=>{console.log("Safety incident update:",W),O(),W.eventType==="INSERT"&&W.new.severity_level>=4&&pe.error(` SAFETY ALERT: ${W.new.severity_level===5?"EMERGENCY":"HIGH RISK"} incident detected!`)}).subscribe();return()=>{V.unsubscribe()}},[]);const O=async()=>{try{w(!0);const{data:V,error:W}=await K.from("safety_incidents").select("*").order("created_at",{ascending:!1}).limit(100);if(W)throw W;const{data:te,error:$}=await K.from("safety_keywords").select("*").eq("is_active",!0).order("severity_level",{ascending:!1});if($)throw $;const Q=(V==null?void 0:V.length)||0,G=(V==null?void 0:V.filter(ce=>ce.is_emergency).length)||0,se=(V==null?void 0:V.filter(ce=>ce.resolved_at).length)||0,ie=Q-se;n(V||[]),l(te||[]),m({totalIncidents:Q,emergencyIncidents:G,resolvedIncidents:se,pendingIncidents:ie})}catch(V){console.error("Error fetching safety data:",V),pe.error("Failed to load safety data")}finally{w(!1)}},P=async(V,W)=>{var te;try{const{error:$}=await K.from("safety_incidents").update({resolved_at:new Date().toISOString(),resolved_by:(te=(await K.auth.getUser()).data.user)==null?void 0:te.id,resolution_notes:W}).eq("id",V);if($)throw $;pe.success("Incident resolved successfully"),O()}catch($){console.error("Error resolving incident:",$),pe.error("Failed to resolve incident")}},F=V=>{switch(V){case 5:return"bg-red-600 text-white";case 4:return"bg-orange-600 text-white";case 3:return"bg-yellow-600 text-black";case 2:return"bg-blue-600 text-white";default:return"bg-gray-600 text-white"}},z=V=>{switch(V){case"self_harm":return"bg-red-100 text-red-800";case"violence":return"bg-orange-100 text-orange-800";case"substance_abuse":return"bg-yellow-100 text-yellow-800";case"harassment":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return y?o.jsx("div",{className:"p-6",children:o.jsxs("div",{className:"animate-pulse space-y-4",children:[o.jsx("div",{className:"h-8 bg-gray-700 rounded w-1/4"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(V=>o.jsx("div",{className:"h-24 bg-gray-700 rounded"},V))})]})}):o.jsxs("div",{className:"p-6 space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("h1",{className:"text-3xl font-bold text-white",children:"Safety Dashboard"}),o.jsx(ke,{onClick:O,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:"Refresh Data"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white",children:"Total Incidents"})}),o.jsx(pa,{children:o.jsx("div",{className:"text-3xl font-bold text-blue-400",children:u.totalIncidents})})]}),o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white",children:"Emergency Incidents"})}),o.jsx(pa,{children:o.jsx("div",{className:"text-3xl font-bold text-red-400",children:u.emergencyIncidents})})]}),o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white",children:"Resolved"})}),o.jsx(pa,{children:o.jsx("div",{className:"text-3xl font-bold text-green-400",children:u.resolvedIncidents})})]}),o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white",children:"Pending"})}),o.jsx(pa,{children:o.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:u.pendingIncidents})})]})]}),o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white",children:"Active Safety Keywords"})}),o.jsx(pa,{children:o.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(V=>o.jsxs(wt,{className:F(V.severity_level),children:[V.keyword," (",V.severity_level,")"]},V.id))})})]}),o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a]",children:[o.jsx(ao,{children:o.jsx(oo,{className:"text-white",children:"Recent Safety Incidents"})}),o.jsx(pa,{children:i.length===0?o.jsx("p",{className:"text-gray-400",children:"No safety incidents recorded"}):o.jsx("div",{className:"overflow-x-auto",children:o.jsxs(HY,{children:[o.jsx(KY,{children:o.jsxs(xR,{className:"border-[#2a2a3a]",children:[o.jsx(co,{className:"text-gray-300",children:"Time"}),o.jsx(co,{className:"text-gray-300",children:"User"}),o.jsx(co,{className:"text-gray-300",children:"Keyword"}),o.jsx(co,{className:"text-gray-300",children:"Category"}),o.jsx(co,{className:"text-gray-300",children:"Severity"}),o.jsx(co,{className:"text-gray-300",children:"Status"}),o.jsx(co,{className:"text-gray-300",children:"Actions"})]})}),o.jsx(zY,{children:i.map(V=>{var W,te,$,Q;return o.jsxs(xR,{className:"border-[#2a2a3a] hover:bg-[#1a1a25]",children:[o.jsx(lo,{className:"text-white",children:new Date(V.created_at).toLocaleString()}),o.jsx(lo,{className:"text-white",children:((W=V.user)==null?void 0:W.email)||"Unknown User"}),o.jsx(lo,{className:"text-white",children:((te=V.keyword)==null?void 0:te.keyword)||"N/A"}),o.jsx(lo,{children:o.jsx(wt,{className:z(($=V.keyword)==null?void 0:$.category),children:((Q=V.keyword)==null?void 0:Q.category)||"N/A"})}),o.jsx(lo,{children:o.jsxs(wt,{className:F(V.severity_level),children:["Level ",V.severity_level]})}),o.jsx(lo,{children:V.resolved_at?o.jsx(wt,{className:"bg-green-600 text-white",children:"Resolved"}):V.is_emergency?o.jsx(wt,{className:"bg-red-600 text-white animate-pulse",children:" EMERGENCY"}):o.jsx(wt,{className:"bg-yellow-600 text-black",children:"Pending"})}),o.jsx(lo,{children:o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ke,{size:"sm",variant:"outline",onClick:()=>{x(V),N(!0)},className:"border-blue-500 text-blue-400 hover:bg-blue-500/10",children:"View"}),!V.resolved_at&&o.jsx(ke,{size:"sm",onClick:()=>P(V.id,"Incident reviewed and appropriate action taken"),className:"bg-green-600 hover:bg-green-700",children:"Resolve"})]})})]},V.id)})})]})})})]}),T&&b&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:o.jsxs(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a] max-w-2xl w-full mx-4",children:[o.jsxs(ao,{children:[o.jsx(oo,{className:"text-white",children:"Incident Details"}),o.jsx(ke,{variant:"ghost",onClick:()=>N(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-white",children:""})]}),o.jsxs(pa,{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-400",children:"Context:"}),o.jsx("p",{className:"text-white bg-[#1a1a25] p-3 rounded",children:b.context_text})]}),b.location_latitude&&o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-400",children:"Location:"}),o.jsxs("p",{className:"text-white",children:[b.location_latitude,", ",b.location_longitude]})]}),b.video_clip_url&&o.jsxs("div",{children:[o.jsx("label",{className:"text-gray-400",children:"Video Clip:"}),o.jsx("video",{src:b.video_clip_url,controls:!0,className:"w-full max-h-64"})]}),o.jsxs("div",{className:"flex gap-2 pt-4",children:[o.jsx(ke,{onClick:()=>{P(b.id,"Incident reviewed and appropriate action taken"),N(!1)},className:"bg-green-600 hover:bg-green-700",disabled:!!b.resolved_at,children:b.resolved_at?"Already Resolved":"Mark as Resolved"}),o.jsx(ke,{onClick:()=>N(!1),className:"bg-gray-600 hover:bg-gray-700",children:"Close"})]})]})]})})]})}function Wbe({message:i="You do not have access to view this page."}){return o.jsxs("div",{className:"p-6 border border-red-500/30 bg-red-500/10 rounded text-red-300",children:[o.jsx("p",{className:"font-semibold",children:"Access Denied"}),o.jsx("p",{className:"text-sm mt-1",children:i})]})}function qbe(){const i=vn(),[n,a]=M.useState("general"),[l,u]=M.useState({app_name:"TrollCity",app_description:"The ultimate streaming platform",max_stream_duration:240,max_participants:9,entrance_effect_price:100,gift_animation_duration:5,level_up_coins:1e3,daily_reward_coins:50,referral_bonus_coins:500,min_withdrawal_amount:100,max_withdrawal_amount:1e4,stream_quality:"720p",chat_message_limit:100,max_gifts_per_minute:10,verification_required:!1,age_restriction:18,content_moderation:"strict",theme_primary:"#00ff88",theme_secondary:"#ff0844",theme_background:"#0a0a0f"}),{data:m={},isLoading:y}=mt({queryKey:["appSettings"],queryFn:async()=>{if(!K.__isConfigured)return l;const{data:P,error:F}=await K.from("app_settings").select("*").single();return F?(console.log("No app settings found, using defaults"),l):(P==null?void 0:P.settings)||l},staleTime:3e4});M.useEffect(()=>{m&&Object.keys(m).length>0&&u(m)},[m]);const w=Wt({mutationFn:async P=>{if(!K.__isConfigured)throw new Error("Supabase not configured");const{error:F}=await K.from("app_settings").upsert({id:1,settings:P,updated_at:new Date().toISOString()});if(F)throw F;return P},onSuccess:()=>{i.invalidateQueries(["appSettings"]),pe.success("App settings saved successfully")},onError:P=>{pe.error(P.message||"Failed to save settings")}}),b=(P,F)=>{u(z=>({...z,[P]:F}))},x=()=>{w.mutate(l)},T=()=>{u(m),pe.info("Settings reset to saved values")},N=[{id:"general",label:"General",icon:My},{id:"streaming",label:"Streaming",icon:jn},{id:"economy",label:"Economy",icon:ni},{id:"gifts",label:"Gifts & Effects",icon:jy},{id:"theme",label:"Theme",icon:hle},{id:"moderation",label:"Moderation",icon:Ow}],O=()=>{switch(n){case"general":return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"app_name",children:"App Name"}),o.jsx(Zt,{id:"app_name",value:l.app_name,onChange:P=>b("app_name",P.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"app_description",children:"App Description"}),o.jsx(Zt,{id:"app_description",value:l.app_description,onChange:P=>b("app_description",P.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"age_restriction",children:"Age Restriction"}),o.jsxs(gs,{value:String(l.age_restriction),onValueChange:P=>b("age_restriction",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"13",children:"13+"}),o.jsx(Ct,{value:"16",children:"16+"}),o.jsx(Ct,{value:"18",children:"18+"}),o.jsx(Ct,{value:"21",children:"21+"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"verification_required",children:"Verification Required"}),o.jsxs(gs,{value:String(l.verification_required),onValueChange:P=>b("verification_required",P==="true"),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"true",children:"Yes"}),o.jsx(Ct,{value:"false",children:"No"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"content_moderation",children:"Content Moderation"}),o.jsxs(gs,{value:l.content_moderation,onValueChange:P=>b("content_moderation",P),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"relaxed",children:"Relaxed"}),o.jsx(Ct,{value:"moderate",children:"Moderate"}),o.jsx(Ct,{value:"strict",children:"Strict"})]})]})]})]})]});case"streaming":return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"max_stream_duration",children:"Max Stream Duration (minutes)"}),o.jsxs(gs,{value:String(l.max_stream_duration),onValueChange:P=>b("max_stream_duration",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"60",children:"1 hour"}),o.jsx(Ct,{value:"120",children:"2 hours"}),o.jsx(Ct,{value:"180",children:"3 hours"}),o.jsx(Ct,{value:"240",children:"4 hours"}),o.jsx(Ct,{value:"480",children:"8 hours"}),o.jsx(Ct,{value:"720",children:"12 hours"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"max_participants",children:"Max Participants"}),o.jsxs(gs,{value:String(l.max_participants),onValueChange:P=>b("max_participants",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"1",children:"1 (Solo)"}),o.jsx(Ct,{value:"4",children:"4"}),o.jsx(Ct,{value:"9",children:"9"}),o.jsx(Ct,{value:"16",children:"16"}),o.jsx(Ct,{value:"25",children:"25"})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"stream_quality",children:"Default Stream Quality"}),o.jsxs(gs,{value:l.stream_quality,onValueChange:P=>b("stream_quality",P),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"480p",children:"480p"}),o.jsx(Ct,{value:"720p",children:"720p"}),o.jsx(Ct,{value:"1080p",children:"1080p"}),o.jsx(Ct,{value:"1440p",children:"1440p"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"chat_message_limit",children:"Chat Message Limit"}),o.jsxs(gs,{value:String(l.chat_message_limit),onValueChange:P=>b("chat_message_limit",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"50",children:"50 messages"}),o.jsx(Ct,{value:"100",children:"100 messages"}),o.jsx(Ct,{value:"200",children:"200 messages"}),o.jsx(Ct,{value:"500",children:"500 messages"})]})]})]})]})]});case"economy":return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"level_up_coins",children:"Level Up Coins"}),o.jsxs(gs,{value:String(l.level_up_coins),onValueChange:P=>b("level_up_coins",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"500",children:"500 coins"}),o.jsx(Ct,{value:"1000",children:"1,000 coins"}),o.jsx(Ct,{value:"2000",children:"2,000 coins"}),o.jsx(Ct,{value:"5000",children:"5,000 coins"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"daily_reward_coins",children:"Daily Reward Coins"}),o.jsxs(gs,{value:String(l.daily_reward_coins),onValueChange:P=>b("daily_reward_coins",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"10",children:"10 coins"}),o.jsx(Ct,{value:"25",children:"25 coins"}),o.jsx(Ct,{value:"50",children:"50 coins"}),o.jsx(Ct,{value:"100",children:"100 coins"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"referral_bonus_coins",children:"Referral Bonus Coins"}),o.jsxs(gs,{value:String(l.referral_bonus_coins),onValueChange:P=>b("referral_bonus_coins",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"100",children:"100 coins"}),o.jsx(Ct,{value:"250",children:"250 coins"}),o.jsx(Ct,{value:"500",children:"500 coins"}),o.jsx(Ct,{value:"1000",children:"1,000 coins"})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"min_withdrawal_amount",children:"Min Withdrawal Amount"}),o.jsxs(gs,{value:String(l.min_withdrawal_amount),onValueChange:P=>b("min_withdrawal_amount",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"50",children:"$50"}),o.jsx(Ct,{value:"100",children:"$100"}),o.jsx(Ct,{value:"250",children:"$250"}),o.jsx(Ct,{value:"500",children:"$500"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"max_withdrawal_amount",children:"Max Withdrawal Amount"}),o.jsxs(gs,{value:String(l.max_withdrawal_amount),onValueChange:P=>b("max_withdrawal_amount",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"1000",children:"$1,000"}),o.jsx(Ct,{value:"5000",children:"$5,000"}),o.jsx(Ct,{value:"10000",children:"$10,000"}),o.jsx(Ct,{value:"50000",children:"$50,000"})]})]})]})]})]});case"gifts":return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"entrance_effect_price",children:"Entrance Effect Price"}),o.jsxs(gs,{value:String(l.entrance_effect_price),onValueChange:P=>b("entrance_effect_price",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"50",children:"50 coins"}),o.jsx(Ct,{value:"100",children:"100 coins"}),o.jsx(Ct,{value:"250",children:"250 coins"}),o.jsx(Ct,{value:"500",children:"500 coins"})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"gift_animation_duration",children:"Gift Animation Duration (seconds)"}),o.jsxs(gs,{value:String(l.gift_animation_duration),onValueChange:P=>b("gift_animation_duration",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"3",children:"3 seconds"}),o.jsx(Ct,{value:"5",children:"5 seconds"}),o.jsx(Ct,{value:"10",children:"10 seconds"}),o.jsx(Ct,{value:"15",children:"15 seconds"})]})]})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"max_gifts_per_minute",children:"Max Gifts Per Minute"}),o.jsxs(gs,{value:String(l.max_gifts_per_minute),onValueChange:P=>b("max_gifts_per_minute",parseInt(P)),children:[o.jsx(_s,{className:"bg-[#1a1a24] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(Ct,{value:"5",children:"5 gifts"}),o.jsx(Ct,{value:"10",children:"10 gifts"}),o.jsx(Ct,{value:"20",children:"20 gifts"}),o.jsx(Ct,{value:"50",children:"50 gifts"})]})]})]})]});case"theme":return o.jsx("div",{className:"space-y-6",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"theme_primary",children:"Primary Theme Color"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Zt,{id:"theme_primary",type:"color",value:l.theme_primary,onChange:P=>b("theme_primary",P.target.value),className:"w-16 h-10 p-1 bg-[#1a1a24] border-[#2a2a3a]"}),o.jsx(Zt,{value:l.theme_primary,onChange:P=>b("theme_primary",P.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"theme_secondary",children:"Secondary Theme Color"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Zt,{id:"theme_secondary",type:"color",value:l.theme_secondary,onChange:P=>b("theme_secondary",P.target.value),className:"w-16 h-10 p-1 bg-[#1a1a24] border-[#2a2a3a]"}),o.jsx(Zt,{value:l.theme_secondary,onChange:P=>b("theme_secondary",P.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})]})]}),o.jsxs("div",{children:[o.jsx(jr,{htmlFor:"theme_background",children:"Background Color"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Zt,{id:"theme_background",type:"color",value:l.theme_background,onChange:P=>b("theme_background",P.target.value),className:"w-16 h-10 p-1 bg-[#1a1a24] border-[#2a2a3a]"}),o.jsx(Zt,{value:l.theme_background,onChange:P=>b("theme_background",P.target.value),className:"bg-[#1a1a24] border-[#2a2a3a] text-white"})]})]})]})});case"moderation":return o.jsx("div",{className:"space-y-6",children:o.jsx("p",{className:"text-gray-400",children:"Moderation settings are configured in the General section above."})});default:return null}};return y?o.jsx("div",{className:"flex items-center justify-center h-64",children:o.jsx("div",{className:"text-gray-400",children:"Loading app settings..."})}):o.jsxs("div",{className:"space-y-6",children:[o.jsx(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:o.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(P=>{const F=P.icon;return o.jsxs(ke,{variant:n===P.id?"default":"outline",size:"sm",className:`${n===P.id?"bg-blue-600 hover:bg-blue-700":"border-[#2a2a3a] text-gray-300 hover:border-blue-500"}`,onClick:()=>a(P.id),children:[o.jsx(F,{className:"w-4 h-4 mr-1"}),P.label]},P.id)})})}),o.jsx(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-6",children:O()}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs(ke,{onClick:x,disabled:w.isPending,className:"bg-emerald-600 hover:bg-emerald-700",children:[o.jsx(RR,{className:"w-4 h-4 mr-1"}),w.isPending?"Saving...":"Save Settings"]}),o.jsxs(ke,{onClick:T,variant:"outline",className:"border-[#2a2a3a] text-gray-300 hover:border-blue-500",children:[o.jsx(cp,{className:"w-4 h-4 mr-1"}),"Reset Changes"]})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("h4",{className:"text-white font-semibold mb-3",children:"Settings Preview"}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{className:"text-gray-400",children:[o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"App Name:"})," ",l.app_name]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Max Stream Duration:"})," ",l.max_stream_duration," minutes"]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Max Participants:"})," ",l.max_participants]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Entrance Effect Price:"})," ",l.entrance_effect_price," coins"]})]}),o.jsxs("div",{className:"text-gray-400",children:[o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Level Up Coins:"})," ",l.level_up_coins]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Daily Reward:"})," ",l.daily_reward_coins," coins"]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Min Withdrawal:"})," $",l.min_withdrawal_amount]}),o.jsxs("p",{children:[o.jsx("span",{className:"text-white",children:"Max Withdrawal:"})," $",l.max_withdrawal_amount]})]})]})]})]})}function Gbe(){var l;const{data:i,isLoading:n}=mt({queryKey:["currentUser"],queryFn:ib});if(n)return o.jsx("div",{children:"Loading user info..."});if(!i)return o.jsx("div",{children:"No user found"});const a=i.role==="admin"||i.is_admin||((l=i.user_metadata)==null?void 0:l.role)==="admin";return o.jsxs("div",{className:"p-4 bg-gray-900 text-white",children:[o.jsx("h3",{children:"User Debug Info"}),o.jsx("pre",{children:JSON.stringify({id:i.id,username:i.username,role:i.role,is_admin:i.is_admin,user_metadata:i.user_metadata,isAdmin:a},null,2)})]})}function Hbe(){const[i,n]=M.useState([]),[a,l]=M.useState(""),[u,m]=M.useState(!1),[y,w]=M.useState(!0),[b,x]=M.useState("idle"),[T,N]=M.useState(!1),[O,P]=M.useState(!0),[F,z]=M.useState(!0),[V,W]=M.useState(""),[te,$]=M.useState(!1),[Q,G]=M.useState("idle"),se=M.useRef(null);M.useEffect(()=>{se.current&&(se.current.scrollTop=se.current.scrollHeight)},[i]),M.useEffect(()=>{(async()=>{try{const Ee=await ib(),Oe=(Ee==null?void 0:Ee.role)==="admin"||(Ee==null?void 0:Ee.is_admin)===!0;N(Oe),Oe&&n([{id:Date.now(),type:"welcome",content:` Welcome ${(Ee==null?void 0:Ee.username)||"Admin"}! TRAE.AI is ready to help you manage and optimize the application.

I can:
 Analyze code for issues and auto-fix them
 Deploy updates with zero downtime
 Add new features to your app
 Monitor performance and optimize
 Debug errors in real-time

What would you like me to work on?`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}])}catch(Ee){console.error("Error checking admin status:",Ee),pe.error("Failed to verify admin access")}finally{P(!1)}})()},[]);const ie=async()=>{if(!V.trim()){pe.error("Please enter the admin password");return}V==="TRAESUPERADMIN2025"?(z(!1),$(!1),pe.success("Admin access granted"),n(ge=>[...ge,{id:Date.now(),type:"success",content:" Admin access unlocked! TRAE.AI is now fully operational.",timestamp:new Date().toLocaleTimeString(),sender:"ai"}])):(pe.error("Invalid admin password"),W(""))},ce=async ge=>{m(!0),await new Promise(Oe=>setTimeout(Oe,1500)),m(!1),Se(ge).forEach((Oe,we)=>{setTimeout(()=>{n(fe=>[...fe,Oe]),y&&Oe.type==="fix"&&Oe.autoFix&&oe(),y&&Oe.type==="deploy"&&ve(),y&&Oe.type==="payout"&&Oe.autoProcess&&ye()},we*500)})},Se=ge=>{const Ee=ge.toLowerCase();if(Ee.includes("payout")||Ee.includes("pay")||Ee.includes("cashout"))return[{id:Date.now()+1,type:"payout",content:" TRAE.AI Payout System Activated!",timestamp:new Date().toLocaleTimeString(),sender:"ai"},{id:Date.now()+2,type:"payout",content:` Square Integration Status: Connected
 Ready to process payouts automatically

Available commands:
 "process all payouts" - Process all pending cashouts
 "check payout status" - Show current payout statistics
 "enable auto-payout" - Enable automatic payout processing
 "disable auto-payout" - Disable automatic processing

I can process payouts with zero downtime and automatic error handling. What would you like me to do?`,timestamp:new Date().toLocaleTimeString(),sender:"ai",autoProcess:Ee.includes("all")||Ee.includes("process")}];if(Ee.includes("auto-payout")){if(Ee.includes("enable")||Ee.includes("on"))return[{id:Date.now()+1,type:"success",content:` Auto-payout processing enabled!

TRAE.AI will now automatically:
 Monitor pending cashout requests
 Process payments via Square
 Update user balances
 Handle errors gracefully

You will receive notifications for each processed payout.`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}];if(Ee.includes("disable")||Ee.includes("off"))return[{id:Date.now()+1,type:"success",content:` Auto-payout processing disabled!

TRAE.AI will no longer automatically process payouts. You can still process them manually through the admin dashboard or by asking me to process them.`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]}return Ee.includes("check payout")||Ee.includes("payout status")?[{id:Date.now()+1,type:"payout",content:" Fetching current payout statistics...",timestamp:new Date().toLocaleTimeString(),sender:"ai"},{id:Date.now()+2,type:"payout",content:` Payout Statistics:

 Total Pending: $0.00
 Total Processed Today: $0.00
 Success Rate: 100%
 Average Processing Time: 2.3 seconds

Square Integration:  Active
Auto-Payout:  Enabled

All systems operational!`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]:Ee.includes("analyze")||Ee.includes("check")?[{id:Date.now()+1,type:"analysis",content:" Analyzing your codebase for issues...",timestamp:new Date().toLocaleTimeString(),sender:"ai"},{id:Date.now()+2,type:"fix",content:`Found 3 potential issues:

1. Missing key prop in list rendering
2. Unused variable in component
3. Potential memory leak in useEffect

I can fix these automatically. Shall I proceed?`,timestamp:new Date().toLocaleTimeString(),sender:"ai",autoFix:!0,issues:[{file:"src/components/UserList.jsx",line:45,issue:"Missing key prop",fix:"Add key={user.id} to map function"},{file:"src/pages/Dashboard.jsx",line:123,issue:"Unused variable",fix:"Remove unused variable declaration"},{file:"src/hooks/useStream.js",line:67,issue:"Memory leak",fix:"Add cleanup function to useEffect"}]}]:Ee.includes("deploy")||Ee.includes("update")?[{id:Date.now()+1,type:"deploy",content:" Preparing deployment with zero downtime...",timestamp:new Date().toLocaleTimeString(),sender:"ai"},{id:Date.now()+2,type:"deploy",content:" Code validated, building optimized bundle...",timestamp:new Date().toLocaleTimeString(),sender:"ai"}]:Ee.includes("add")||Ee.includes("create")?[{id:Date.now()+1,type:"feature",content:` I can help you add new features! What would you like to implement?

Some suggestions:
 Add a new admin dashboard widget
 Implement real-time notifications
 Create a new user profile feature
 Add analytics tracking

Just describe what you need.`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]:[{id:Date.now()+1,type:"help",content:` TRAE.AI is ready to help! I can:

 Process payouts automatically via Square
 Analyze code for issues and auto-fix them
 Deploy updates with zero downtime
 Add new features to your app
 Monitor performance and optimize
 Debug errors in real-time

What would you like me to work on?`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]},oe=async ge=>{try{x("fixing"),n(Ee=>[...Ee,{id:Date.now()+3,type:"fix",content:" Applying fixes...",timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),await new Promise(Ee=>setTimeout(Ee,2e3)),n(Ee=>[...Ee,{id:Date.now()+4,type:"success",content:" All issues fixed successfully!",timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),x("idle"),pe.success("TRAE.AI auto-fixed the issues")}catch(Ee){n(Oe=>[...Oe,{id:Date.now()+5,type:"error",content:` Error applying fixes: ${Ee.message}`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),x("idle"),pe.error("Failed to auto-fix issues")}},ve=async ge=>{try{x("deploying");const Ee=[" Building optimized bundle..."," Running tests..."," Deploying to staging..."," Verifying deployment..."," Switching to production..."];for(let Oe=0;Oe<Ee.length;Oe++)await new Promise(we=>setTimeout(we,1e3)),n(we=>[...we,{id:Date.now()+Oe+10,type:"deploy",content:Ee[Oe],timestamp:new Date().toLocaleTimeString(),sender:"ai"}]);x("completed"),pe.success("Deployment completed successfully!"),setTimeout(()=>x("idle"),3e3)}catch(Ee){x("failed"),n(Oe=>[...Oe,{id:Date.now()+100,type:"error",content:` Deployment failed: ${Ee.message}`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),pe.error("Deployment failed")}},he=async ge=>{if(ge.preventDefault(),!a.trim()||u)return;const Ee={id:Date.now(),type:"user",content:a,timestamp:new Date().toLocaleTimeString(),sender:"user"};n(Oe=>[...Oe,Ee]),l(""),await ce(a)},Ze=ge=>{switch(ge){case"analysis":return o.jsx(ay,{className:"w-4 h-4"});case"fix":return o.jsx(Nce,{className:"w-4 h-4"});case"deploy":return o.jsx(cp,{className:"w-4 h-4"});case"success":return o.jsx(Ui,{className:"w-4 h-4"});case"error":return o.jsx(Ic,{className:"w-4 h-4"});case"feature":return o.jsx(Pw,{className:"w-4 h-4"});case"payout":return o.jsx(Es,{className:"w-4 h-4"});case"processing":return o.jsx(uo,{className:"w-4 h-4"});case"info":return o.jsx(ay,{className:"w-4 h-4"});case"welcome":return o.jsx(xi,{className:"w-4 h-4"});default:return o.jsx(ay,{className:"w-4 h-4"})}},Qe=ge=>{switch(ge){case"deploying":return"text-yellow-400";case"fixing":return"text-blue-400";case"completed":return"text-green-400";case"failed":return"text-red-400";case"processing":return"text-blue-400";case"paid":return"text-green-400";default:return"text-gray-400"}},me=async(ge,Ee)=>{try{const[{data:Oe},{data:we}]=await Promise.all([K.from("profiles").select("coins, purchased_coins, free_coins, level, payout_method, payout_details").eq("id",ge).single(),K.from("earnings_config").select("*").single()]);if(!Oe||!we)return{canPayout:!1,reason:"Missing user data or configuration",missingRequirements:["user_data","config"]};const fe={canPayout:!0,missingRequirements:[],warnings:[],details:{}};Ee<we.minimum_payout&&(fe.canPayout=!1,fe.missingRequirements.push("minimum_payout"),fe.details.minimum_payout=`Amount $${Ee} below minimum $${we.minimum_payout}`),Oe.coins<Ee&&(fe.canPayout=!1,fe.missingRequirements.push("insufficient_balance"),fe.details.balance=`User has ${Oe.coins} coins, needs ${Ee}`),(!Oe.payout_method||!Oe.payout_details)&&(fe.canPayout=!1,fe.missingRequirements.push("payout_method"),fe.details.payout_method="User has not configured payout method"),we.square_account_active||(fe.canPayout=!1,fe.missingRequirements.push("square_integration"),fe.details.square="Square integration is not active");const De=Oe.level||1;let je=null;if(De>=40?je={netPayout:.9,fee:.1,instant:!0}:De>=20?je={netPayout:.85,fee:.15,instant:!1}:De>=10?je={netPayout:.8,fee:.2,instant:!1}:je={netPayout:.75,fee:.25,instant:!1},fe.details.tier={level:De,netPayout:je.netPayout,fee:je.fee,instant:je.instant},!je.instant){const{data:Je}=await K.from("cashout_requests").select("created_at").eq("user_id",ge).eq("status","approved").gte("created_at",new Date(Date.now()-864e5).toISOString()).limit(1);Je&&Je.length>0&&fe.warnings.push("Recent cashout detected within 24h")}const{data:_e}=await K.from("user_verifications").select("verification_type, status").eq("user_id",ge).eq("status","verified");return(!_e||_e.length===0)&&fe.warnings.push("User has no verified identity"),fe.canPayout?fe.warnings.length>0?fe.reason=`Eligible with warnings: ${fe.warnings.join(", ")}`:fe.reason="All requirements met":fe.reason=`Missing requirements: ${fe.missingRequirements.join(", ")}`,fe}catch(Oe){return console.error("Error verifying payout requirements:",Oe),{canPayout:!1,reason:"Verification error",missingRequirements:["verification_error"]}}},ye=async()=>{try{G("processing");const{data:ge,error:Ee}=await K.from("cashout_requests").select(`
          *,
          profiles!user_id(username, full_name, email, square_customer_id)
        `).eq("status","pending").order("created_at",{ascending:!0}).limit(10);if(Ee)throw Ee;if(!ge||ge.length===0){n(Je=>[...Je,{id:Date.now(),type:"info",content:" No pending payout requests found.",timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),G("idle");return}n(Je=>[...Je,{id:Date.now(),type:"processing",content:` TRAE.AI is verifying user requirements for ${ge.length} pending cashouts...`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]);const Oe=[],we=[];for(const Je of ge){const st=await me(Je.user_id,Je.coins_amount);st.canPayout?Oe.push({...Je,verification:st}):we.push({...Je,verification:st})}n(Je=>[...Je,{id:Date.now(),type:"info",content:` Verification Complete:
 Approved: ${Oe.length}/${ge.length}
 Rejected: ${we.length}/${ge.length}
 Processing approved requests now...`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]);for(const Je of we)await K.from("cashout_requests").update({status:"rejected",processed_at:new Date().toISOString(),notes:`TRAE.AI Rejection: ${Je.verification.reason}`}).eq("id",Je.id),await K.rpc("increment_user_coins",{user_id:Je.user_id,amount:Je.coins_amount});const fe=Oe.reduce((Je,st)=>Je+st.coins_cost/100,0);n(Je=>[...Je,{id:Date.now(),type:"processing",content:` Processing ${Oe.length} approved cashouts
 Total amount: $${fe.toFixed(2)}
 Processing via Square API with zero downtime...`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]);let De=0,je=0;for(const Je of Oe)try{const{data:st}=await K.from("profiles").select("coins, purchased_coins, free_coins").eq("id",Je.user_id).single();if(!st||st.coins<Je.coins_amount)throw new Error("Insufficient balance");const{data:vt,error:pt}=await K.functions.invoke("processSquarePayout",{body:{cashoutId:Je.id,amount:usdAmount,currency:"USD",paymentMethod:Je.payment_method,userId:Je.user_id}});if(pt)throw new Error(`Square payout failed: ${pt.message}`);if(vt.success)De++,totalAmount+=vt.amount,n(er=>{var gt,qe;return[...er,{id:Date.now()+De,type:"success",content:` Processed: ${((gt=Je.profiles)==null?void 0:gt.username)||"User"}  $${usdAmount.toFixed(2)} (TX: ${(qe=vt.payoutId)==null?void 0:qe.substring(0,8)}...)`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]});else throw new Error(vt.error||"Payout failed")}catch(st){je++,await K.from("cashout_requests").update({status:"failed",processed_at:new Date().toISOString(),notes:`TRAE.AI Error: ${st.message}`}).eq("id",Je.id),console.error(`Payout failed for cashout ${Je.id}:`,st)}G("completed");const _e=De>0?Math.round(De/ge.length*100):0;n(Je=>[...Je,{id:Date.now(),type:"success",content:` TRAE.AI Payout Processing Complete!

 Statistics:
 Successfully processed: ${De}/${ge.length}
 Total amount: $${(totalAmount/100).toFixed(2)}
 Success rate: ${_e}%
 Failed: ${je}

 All payouts processed via Square with zero downtime!
 User balances updated automatically
 Notifications sent to users`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),pe.success(`TRAE.AI payout complete! ${De} successful, ${je} failed`),setTimeout(()=>G("idle"),4e3)}catch(ge){G("failed"),n(Ee=>[...Ee,{id:Date.now(),type:"error",content:` TRAE.AI payout processing failed: ${ge.message}

 Troubleshooting:
 Check Square integration status
 Verify admin privileges
 Review user balances
 Check network connectivity`,timestamp:new Date().toLocaleTimeString(),sender:"ai"}]),pe.error("TRAE.AI payout processing failed: "+ge.message),setTimeout(()=>G("idle"),4e3)}};return O?o.jsx("div",{className:"h-full flex items-center justify-center bg-[#0a0a0f]",children:o.jsxs("div",{className:"text-center",children:[o.jsx(xi,{className:"w-12 h-12 text-purple-400 mx-auto mb-4 animate-pulse"}),o.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Verifying Admin Access..."}),o.jsx("p",{className:"text-gray-400",children:"Checking permissions for TRAE.AI"})]})}):T?F?o.jsx("div",{className:"h-full flex items-center justify-center bg-[#0a0a0f]",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 max-w-md",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ly,{className:"w-16 h-16 text-yellow-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-white text-xl font-semibold mb-2",children:"TRAE.AI Security Lock"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"This is a secure AI assistant. Enter the admin password to unlock TRAE.AI features."}),te?o.jsxs("div",{className:"space-y-4",children:[o.jsx(Zt,{type:"password",value:V,onChange:ge=>W(ge.target.value),placeholder:"Enter admin password...",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",onKeyPress:ge=>ge.key==="Enter"&&ie()}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{onClick:ie,className:"flex-1 bg-green-600 hover:bg-green-700",children:[o.jsx(oP,{className:"w-4 h-4 mr-2"}),"Unlock"]}),o.jsx(ke,{onClick:()=>$(!1),variant:"outline",className:"border-[#2a2a3a] text-gray-300",children:"Cancel"})]})]}):o.jsxs(ke,{onClick:()=>$(!0),className:"bg-purple-600 hover:bg-purple-700",children:[o.jsx(oP,{className:"w-4 h-4 mr-2"}),"Unlock TRAE.AI"]}),o.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Hint: Contact your system administrator for the password."})]})})}):o.jsxs("div",{className:"h-full flex flex-col bg-[#0a0a0f]",children:[o.jsx("div",{className:"p-4 border-b border-[#2a2a3a]",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center",children:o.jsx(ay,{className:"w-5 h-5 text-white"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-semibold",children:"TRAE.AI Assistant"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Live code editing & deployment"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(wt,{className:"bg-green-600",children:[o.jsx(xi,{className:"w-3 h-3 mr-1"}),"Admin"]}),o.jsxs(wt,{variant:y?"default":"secondary",className:`cursor-pointer ${y?"bg-green-600":"bg-gray-600"}`,onClick:()=>w(!y),children:[o.jsx(Pw,{className:"w-3 h-3 mr-1"}),"Auto-Fix ",y?"ON":"OFF"]}),Q!=="idle"&&o.jsxs(wt,{className:`${Qe(Q)} bg-transparent border border-current`,children:[Q==="processing"&&o.jsx(Es,{className:"w-3 h-3 mr-1 animate-pulse"}),Q==="completed"&&o.jsx(Ui,{className:"w-3 h-3 mr-1"}),Q==="failed"&&o.jsx(Ic,{className:"w-3 h-3 mr-1"}),"Payout: ",Q.charAt(0).toUpperCase()+Q.slice(1)]}),b!=="idle"&&o.jsxs(wt,{className:`${Qe(b)} bg-transparent border border-current`,children:[b==="deploying"&&o.jsx(cp,{className:"w-3 h-3 mr-1 animate-spin"}),b==="fixing"&&o.jsx(uo,{className:"w-3 h-3 mr-1 animate-pulse"}),b==="completed"&&o.jsx(Ui,{className:"w-3 h-3 mr-1"}),b==="failed"&&o.jsx(Ic,{className:"w-3 h-3 mr-1"}),b.charAt(0).toUpperCase()+b.slice(1)]})]})]})}),o.jsx("div",{className:"flex-1 p-4 overflow-y-auto",ref:se,children:o.jsx("div",{className:"space-y-4",children:o.jsxs(E2,{children:[i.map(ge=>o.jsx(Xi.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`flex gap-3 ${ge.sender==="user"?"justify-end":"justify-start"}`,children:o.jsxs("div",{className:`flex gap-3 max-w-[80%] ${ge.sender==="user"?"flex-row-reverse":""}`,children:[o.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${ge.sender==="user"?"bg-blue-600":ge.type==="success"?"bg-green-600":ge.type==="error"?"bg-red-600":"bg-purple-600"}`,children:ge.sender==="user"?o.jsx(Pa,{className:"w-4 h-4 text-white"}):Ze(ge.type)}),o.jsxs("div",{className:`rounded-lg p-3 ${ge.sender==="user"?"bg-blue-600 text-white":"bg-[#1a1a24] text-gray-300 border border-[#2a2a3a]"}`,children:[o.jsx("div",{className:"whitespace-pre-wrap text-sm",children:ge.content}),o.jsx("div",{className:`text-xs mt-1 ${ge.sender==="user"?"text-blue-200":"text-gray-500"}`,children:ge.timestamp})]})]})},ge.id)),u&&o.jsxs(Xi.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center",children:o.jsx(ay,{className:"w-4 h-4 text-white animate-pulse"})}),o.jsx("div",{className:"bg-[#1a1a24] text-gray-300 rounded-lg p-3 border border-[#2a2a3a]",children:o.jsxs("div",{className:"flex gap-1",children:[o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),o.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})]})})}),o.jsxs("div",{className:"p-4 border-t border-[#2a2a3a]",children:[o.jsxs("form",{onSubmit:he,className:"flex gap-2",children:[o.jsx(Zt,{value:a,onChange:ge=>l(ge.target.value),placeholder:"Ask TRAE.AI to analyze, fix, deploy, or process payouts...",className:"bg-[#1a1a24] border-[#2a2a3a] text-white placeholder-gray-400",disabled:u||b!=="idle"||Q!=="idle"}),o.jsx(ke,{type:"submit",disabled:!a.trim()||u||b!=="idle"||Q!=="idle",className:"bg-purple-600 hover:bg-purple-700",children:o.jsx(Iw,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"mt-2 flex gap-2 text-xs text-gray-400",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Fle,{className:"w-3 h-3"}),'Try: "analyze code for issues"']}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Wce,{className:"w-3 h-3"}),'Try: "deploy latest changes"']}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(Es,{className:"w-3 h-3"}),'Try: "process payouts"']})]})]})]}):o.jsx("div",{className:"h-full flex items-center justify-center bg-[#0a0a0f]",children:o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-8 max-w-md",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Ly,{className:"w-16 h-16 text-red-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-white text-xl font-semibold mb-2",children:"Admin Access Required"}),o.jsx("p",{className:"text-gray-400 mb-6",children:"TRAE.AI features require administrator privileges. Please contact your system administrator to gain access."}),o.jsx(ke,{onClick:()=>window.location.reload(),className:"bg-purple-600 hover:bg-purple-700",children:"Refresh Page"})]})})})}function Kbe(){const[i,n]=M.useState(!1),[a,l]=M.useState(null),[u,m]=M.useState([]),[y,w]=M.useState({totalParticipants:0,totalRevenue:0,activeShows:0}),[b,x]=M.useState(!1);M.useEffect(()=>{T(),N(),O();const $=K.channel("troll-live-show-admin").on("postgres_changes",{event:"*",schema:"public",table:"troll_live_show"},G=>{P(G.new)}).subscribe(),Q=K.channel("troll-live-waitlist-admin").on("postgres_changes",{event:"*",schema:"public",table:"troll_live_show_waitlist"},G=>{N()}).subscribe();return()=>{K.removeChannel($),K.removeChannel(Q)}},[]);const T=async()=>{try{const{data:$,error:Q}=await K.from("troll_live_show").select(`
          *,
          current_performer:profiles!troll_live_show_current_performer_id_fkey(*)
        `).eq("is_active",!0).single();$&&!Q?(n(!0),l($.current_performer)):(n(!1),l(null))}catch($){console.error("Error fetching show status:",$)}},N=async()=>{try{const{data:$,error:Q}=await K.from("troll_live_show_waitlist").select(`
          *,
          user:profiles(*)
        `).order("position",{ascending:!0});$&&!Q&&m($)}catch($){console.error("Error fetching waitlist:",$)}},O=async()=>{try{const{count:$}=await K.from("troll_live_show_waitlist").select("*",{count:"exact",head:!0}),{data:Q}=await K.from("coin_transactions").select("amount").eq("type","troll_live_show_entry"),G=(Q==null?void 0:Q.reduce((ie,ce)=>ie+Math.abs(ce.amount),0))||0,{count:se}=await K.from("troll_live_show").select("*",{count:"exact",head:!0}).eq("is_active",!0);w({totalParticipants:$||0,totalRevenue:G,activeShows:se||0})}catch($){console.error("Error fetching stats:",$)}},P=$=>{$&&$.is_active?(n(!0),l($.current_performer)):(n(!1),l(null))},F=async()=>{x(!0);try{const{data:$,error:Q}=await K.from("troll_live_show").insert({is_active:!0,entry_fee_coins:500,show_duration_minutes:5}).select().single();if(Q)throw Q;pe.success("Troll Live Show started successfully!"),n(!0)}catch($){console.error("Error starting show:",$),pe.error("Failed to start show")}finally{x(!1)}},z=async()=>{x(!0);try{const{error:$}=await K.from("troll_live_show").update({is_active:!1}).eq("is_active",!0);if($)throw $;pe.success("Troll Live Show ended successfully!"),n(!1),l(null)}catch($){console.error("Error ending show:",$),pe.error("Failed to end show")}finally{x(!1)}},V=async()=>{var $,Q;if(a){x(!0);try{const{data:G}=await K.from("troll_live_show").select("id").eq("is_active",!0).single();if(!G)throw new Error("No active show found");if(!(await fetch("/api/manageTrollLiveShow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${($=(await K.auth.getSession()).data.session)==null?void 0:$.access_token}`},body:JSON.stringify({action:"end_performance",userId:(Q=(await K.auth.getUser()).data.user)==null?void 0:Q.id,showId:G.id,performerId:a.id})})).ok)throw new Error("Failed to skip performer");pe.success("Current performer skipped!")}catch(G){console.error("Error skipping performer:",G),pe.error("Failed to skip performer")}finally{x(!1)}}},W=async()=>{x(!0);try{const $=new Date;$.setDate($.getDate()-7);const{data:Q}=await K.from("coin_transactions").select(`
          *,
          user:profiles(id, username)
        `).gte("created_at",$.toISOString()).eq("type","troll_live_show_entry").order("created_at",{ascending:!1}),{data:G}=await K.from("troll_live_show_waitlist").select(`
          *,
          user:profiles(*)
        `).gte("created_at",$.toISOString()).order("created_at",{ascending:!1}),se={weekEnding:new Date().toISOString().split("T")[0],totalRevenue:(Q==null?void 0:Q.reduce((ve,he)=>ve+Math.abs(he.amount),0))||0,totalParticipants:(G==null?void 0:G.length)||0,successfulPerformances:(G==null?void 0:G.filter(ve=>ve.status==="completed").length)||0,kickedPerformances:(G==null?void 0:G.filter(ve=>ve.status==="kicked").length)||0,transactions:(Q==null?void 0:Q.map(ve=>{var he;return{date:ve.created_at,user:((he=ve.user)==null?void 0:he.username)||"Unknown",amount:Math.abs(ve.amount),type:ve.type}}))||[],participants:(G==null?void 0:G.map(ve=>{var he;return{username:((he=ve.user)==null?void 0:he.username)||"Unknown",status:ve.status,duration:ve.performance_duration_seconds,votesReceived:ve.votes_received,votesAgainst:ve.votes_against}}))||[]},ie=te(se),ce=new Blob([ie],{type:"text/csv"}),Se=window.URL.createObjectURL(ce),oe=document.createElement("a");oe.href=Se,oe.download=`troll-live-show-statement-${se.weekEnding}.csv`,document.body.appendChild(oe),oe.click(),document.body.removeChild(oe),window.URL.revokeObjectURL(Se),pe.success("Weekly statement generated and downloaded!")}catch($){console.error("Error generating statement:",$),pe.error("Failed to generate statement")}finally{x(!1)}},te=$=>{let Q=`TROLL LIVE SHOW - WEEKLY STATEMENT
`;return Q+=`Week Ending: ${$.weekEnding}
`,Q+=`Total Revenue: ${$.totalRevenue} coins
`,Q+=`Total Participants: ${$.totalParticipants}
`,Q+=`Successful Performances: ${$.successfulPerformances}
`,Q+=`Kicked Performances: ${$.kickedPerformances}

`,Q+=`TRANSACTIONS
`,Q+=`Date,User,Amount,Type
`,$.transactions.forEach(G=>{Q+=`${G.date},${G.user},${G.amount},${G.type}
`}),Q+=`
PARTICIPANTS
`,Q+=`Username,Status,Duration (seconds),Votes Received,Votes Against
`,$.participants.forEach(G=>{Q+=`${G.username},${G.status},${G.duration||0},${G.votesReceived||0},${G.votesAgainst||0}
`}),Q};return o.jsxs("div",{className:"container mx-auto px-4 py-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:" Troll Live Show Admin"}),o.jsx("p",{className:"text-gray-400",children:"Manage the ultimate variety show experience"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-purple-500/30 p-6",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-purple-400 text-sm font-medium",children:"Total Participants"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:y.totalParticipants})]}),o.jsx(jn,{className:"w-8 h-8 text-purple-400"})]})}),o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-green-500/30 p-6",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-green-400 text-sm font-medium",children:"Total Revenue"}),o.jsxs("p",{className:"text-2xl font-bold text-white",children:[y.totalRevenue.toLocaleString()," coins"]})]}),o.jsx(Es,{className:"w-8 h-8 text-green-400"})]})}),o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-blue-500/30 p-6",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-blue-400 text-sm font-medium",children:"Active Shows"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:y.activeShows})]}),o.jsx(uo,{className:"w-8 h-8 text-blue-400"})]})}),o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-yellow-500/30 p-6",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-yellow-400 text-sm font-medium",children:"Show Status"}),o.jsx("p",{className:"text-2xl font-bold text-white",children:i?" LIVE":" OFFLINE"})]}),o.jsx(Ow,{className:"w-8 h-8 text-yellow-400"})]})})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-red-500/30",children:o.jsxs("div",{className:"p-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-6",children:" Show Controls"}),o.jsxs("div",{className:"space-y-4",children:[i?o.jsxs(o.Fragment,{children:[o.jsxs(ke,{onClick:z,disabled:b,className:"w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800",children:[o.jsx(fle,{className:"w-4 h-4 mr-2"}),"End Current Show"]}),a&&o.jsxs(ke,{onClick:V,disabled:b,className:"w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800",children:[o.jsx(Ow,{className:"w-4 h-4 mr-2"}),"Skip Current Performer"]})]}):o.jsxs(ke,{onClick:F,disabled:b,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800",children:[o.jsx(OH,{className:"w-4 h-4 mr-2"}),"Start New Show"]}),o.jsxs(ke,{onClick:W,disabled:b,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800",children:[o.jsx(Uce,{className:"w-4 h-4 mr-2"}),"Generate Weekly Statement"]})]}),a&&o.jsxs("div",{className:"mt-6 p-4 bg-black/20 rounded-lg",children:[o.jsx("h3",{className:"text-white font-bold mb-2",children:"Current Performer"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:o.jsx(jn,{className:"w-5 h-5 text-white"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-white font-medium",children:a.username}),o.jsxs("p",{className:"text-gray-400 text-sm",children:["ID: ",a.id]})]})]})]})]})}),o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-purple-500/30",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("h2",{className:"text-xl font-bold text-white mb-6",children:[" Waitlist (",u.length,")"]}),o.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[u.map(($,Q)=>{var G;return o.jsxs("div",{className:"flex items-center justify-between p-3 bg-black/20 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"text-yellow-400 font-bold w-6 text-center",children:$.position}),o.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:o.jsx(jn,{className:"w-4 h-4 text-white"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-white font-medium",children:((G=$.user)==null?void 0:G.username)||"Unknown"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["Status: ",$.status]})]})]}),o.jsx(wt,{className:`text-xs ${$.status==="waiting"?"bg-yellow-500/20 text-yellow-300":$.status==="performing"?"bg-green-500/20 text-green-300":$.status==="completed"?"bg-blue-500/20 text-blue-300":"bg-red-500/20 text-red-300"}`,children:$.status})]},$.id)}),u.length===0&&o.jsxs("div",{className:"text-center text-gray-400 py-8",children:[o.jsx(jn,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),o.jsx("p",{children:"No users in waitlist"})]})]})]})})]})]})}async function zbe(){var i;try{const{data:n}=await K.auth.getUser(),a=(i=n==null?void 0:n.user)==null?void 0:i.id;if(!a)return console.log("No user logged in"),!1;const{error:l}=await K.from("profiles").update({is_admin:!0}).eq("id",a);return l?(console.error("Error updating user admin status:",l),!1):(console.log("User admin status updated successfully"),!0)}catch(n){return console.error("Error:",n),!1}}function YY(){const i=vn(),{data:n,isLoading:a}=mt({queryKey:["currentUser"],queryFn:ib,staleTime:3e4,retry:1});M.useEffect(()=>{!a&&!n&&xz().then(G=>{G&&(console.log("Admin profile ensured:",G.username),i.invalidateQueries(["currentUser"]))}).catch(G=>{console.error("Error ensuring admin profile:",G)})},[n,a]);const l=G=>(G==null?void 0:G.role)??(G==null?void 0:G.user_role)??null,[u,m]=M.useState("overview"),[y,w]=M.useState(""),[b,x]=M.useState("Home"),[T,N]=M.useState("content"),[O,P]=M.useState("");M.useEffect(()=>{(async()=>{if(!K.__isConfigured){P("");return}try{const{data:se}=await K.from("admin_content").select("content").eq("page_name",b).eq("field_name",T).eq("is_active",!0).order("updated_at",{ascending:!1}).limit(1),ie=Array.isArray(se)?se[0]:null;P((ie==null?void 0:ie.content)||"")}catch{P("")}})()},[b,T]);const F=!!n&&(l(n)==="admin"||(n==null?void 0:n.is_admin)===!0),z=a,{data:V={totalUsers:0,pendingApps:0,pendingPayouts:0,trollOfficers:0,flags:0}}=mt({queryKey:["adminCounters"],queryFn:async()=>{if(!K.__isConfigured)return{totalUsers:0,pendingApps:0,pendingPayouts:0,trollOfficers:0,flags:0};const G={totalUsers:0,pendingApps:0,pendingPayouts:0,trollOfficers:0,flags:0};try{const se=await K.from("profiles").select("id",{count:"exact",head:!0});G.totalUsers=(se==null?void 0:se.count)||0}catch{}try{const se=await K.from("broadcaster_applications").select("id",{count:"exact",head:!0}).eq("status","pending");G.pendingApps=(se==null?void 0:se.count)||0}catch{}try{const se=await K.from("square_transactions").select("id",{count:"exact",head:!0}).eq("status","pending");G.pendingPayouts=(se==null?void 0:se.count)||0}catch{}try{const se=await K.from("profiles").select("id",{count:"exact",head:!0}).eq("is_troll_officer",!0);G.trollOfficers=(se==null?void 0:se.count)||0}catch{}try{const se=await K.from("moderation_actions").select("id",{count:"exact",head:!0}).eq("action","message_flagged");G.flags=(se==null?void 0:se.count)||0}catch{}return G},staleTime:1e4}),{data:W={purchased:0,earned:0,free:0,total:0}}=mt({queryKey:["coinsLive"],queryFn:async()=>{if(!K.__isConfigured)return{purchased:0,earned:0,free:0,total:0};try{const{data:G=[]}=await K.from("profiles").select("coins, purchased_coins, free_coins"),se=(G||[]).reduce((ie,ce)=>(ie.total+=Number((ce==null?void 0:ce.coins)||0),ie.purchased+=Number((ce==null?void 0:ce.purchased_coins)||0),ie.free+=Number((ce==null?void 0:ce.free_coins)||0),ie),{purchased:0,earned:0,free:0,total:0});return se.earned=Math.max(0,se.total-se.purchased),se}catch{return{purchased:0,earned:0,free:0,total:0}}},refetchInterval:15e3,staleTime:5e3}),{data:te={payoutsUsd:0,purchasesUsd:0,totalUsd:0}}=mt({queryKey:["financeLive"],queryFn:async()=>{if(!K.__isConfigured)return{payoutsUsd:0,purchasesUsd:0,totalUsd:0};const G={payoutsUsd:0,purchasesUsd:0,totalUsd:0};try{const{data:se=[]}=await K.from("square_transactions").select("amount_cents,status").eq("status","completed");G.purchasesUsd=(se||[]).reduce((ie,ce)=>ie+Number((ce==null?void 0:ce.amount_cents)||0),0)/100}catch{}try{const{data:se=[]}=await K.from("payouts").select("amount_usd,status").eq("status","completed");G.payoutsUsd=(se||[]).reduce((ie,ce)=>ie+Number((ce==null?void 0:ce.amount_usd)||0),0)}catch{}return G.totalUsd=G.purchasesUsd-G.payoutsUsd,G},refetchInterval:3e4,staleTime:1e4}),{data:$=[],isLoading:Q}=mt({queryKey:["adminLiveStreams"],queryFn:async()=>{if(!K.__isConfigured)return[];try{const{data:G,error:se}=await K.from("streams").select(`
            *,
            profiles!streamer_id(username, full_name, avatar_url)
          `).eq("is_live",!0).order("created_at",{ascending:!1});if(se)throw se;return G||[]}catch(G){return console.error("Error fetching live streams:",G),[]}},refetchInterval:1e4,staleTime:5e3});return z?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(xi,{className:"w-16 h-16 text-purple-400 mx-auto mb-4 animate-pulse"}),o.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Loading Admin Dashboard..."}),o.jsx("p",{className:"text-gray-400",children:"Checking permissions..."})]})}):F?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6 md:p-8",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx(xi,{className:"w-10 h-10 text-purple-400"}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-bold text-white",children:"Admin Dashboard"}),o.jsxs("p",{className:"text-gray-400 mt-1",children:["Welcome, ",o.jsxs("span",{className:"text-purple-400 font-semibold",children:["@",(n==null?void 0:n.username)||(n==null?void 0:n.full_name)||"Admin"]}),o.jsx(wt,{className:"ml-2 bg-red-500 text-white",children:l(n)})]})]})]})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(ao,{className:"pb-2",children:o.jsx(oo,{className:"text-white text-sm font-semibold",children:"System Status"})}),o.jsxs(pa,{children:[o.jsx("p",{className:"text-3xl font-bold text-green-400",children:""}),o.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Operational"})]})]}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(ao,{className:"pb-2",children:o.jsx(oo,{className:"text-white text-sm font-semibold",children:"Admin Access"})}),o.jsxs(pa,{children:[o.jsx("p",{className:"text-3xl font-bold text-blue-400",children:""}),o.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Granted"})]})]}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(ao,{className:"pb-2",children:o.jsx(oo,{className:"text-white text-sm font-semibold",children:"Platform Health"})}),o.jsxs(pa,{children:[o.jsx("p",{className:"text-3xl font-bold text-yellow-400",children:""}),o.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Healthy"})]})]}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(ao,{className:"pb-2",children:o.jsx(oo,{className:"text-white text-sm font-semibold",children:"Connection"})}),o.jsxs(pa,{children:[o.jsx("p",{className:"text-3xl font-bold text-purple-400",children:""}),o.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Connected"})]})]})]}),o.jsxs(db,{value:u,onValueChange:m,className:"space-y-6",children:[o.jsxs(ub,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(es,{value:"overview",className:"data-[state=active]:bg-[#2a2a3a]",children:"Overview"}),o.jsx(es,{value:"users",className:"data-[state=active]:bg-[#2a2a3a]",children:"Users"}),o.jsxs(es,{value:"livestreams",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(Si,{className:"w-4 h-4 mr-1"}),"Live Streams"]}),o.jsxs(es,{value:"content-editor",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(cP,{className:"w-4 h-4 mr-1"}),"App Editor"]}),o.jsxs(es,{value:"earnings-editor",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(Es,{className:"w-4 h-4 mr-1"}),"Earnings Editor"]}),o.jsx(es,{value:"integrations",className:"data-[state=active]:bg-[#2a2a3a]",children:"Integrations"}),o.jsx(es,{value:"applications",className:"data-[state=active]:bg-[#2a2a3a]",children:"Applications"}),o.jsx(es,{value:"cashouts",className:"data-[state=active]:bg-[#2a2a3a]",children:"Cashouts"}),o.jsx(es,{value:"fees",className:"data-[state=active]:bg-[#2a2a3a]",children:"Fees"}),o.jsxs(es,{value:"safety",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(Ic,{className:"w-4 h-4 mr-1"}),"Safety"]}),o.jsxs(es,{value:"traeai",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(ay,{className:"w-4 h-4 mr-1"}),"TRAE.AI"]}),o.jsxs(es,{value:"troll-live-show",className:"data-[state=active]:bg-[#2a2a3a]",children:[o.jsx(Star,{className:"w-4 h-4 mr-1"}),"Troll Live Show"]})]}),o.jsx(Gs,{value:"overview",children:o.jsxs("div",{className:"space-y-6",children:[o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Total Users",value:V.totalUsers,color:"text-purple-400"},{label:"Pending Apps",value:V.pendingApps,color:"text-yellow-400"},{label:"Pending Payouts",value:V.pendingPayouts,color:"text-emerald-400"},{label:"Troll Officers",value:V.trollOfficers,color:"text-cyan-400"},{label:"All Flags",value:V.flags,color:"text-red-400"}].map((G,se)=>o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a]",children:[o.jsx(ao,{className:"pb-1",children:o.jsx(oo,{className:"text-xs text-gray-400",children:G.label})}),o.jsx(pa,{children:o.jsx("p",{className:`text-3xl font-bold ${G.color}`,children:G.value})})]},se))}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Coin Economy (Live)"}),o.jsxs(ke,{variant:"outline",size:"sm",className:"border-[#2a2a3a] text-gray-300",onClick:()=>{try{i.invalidateQueries(["coinsLive"]),i.invalidateQueries(["financeLive"]),i.invalidateQueries(["adminCounters"]),pe.success("Dashboard refreshed")}catch{}},children:[o.jsx(cp,{className:"w-3 h-3 mr-1"}),"Refresh"]})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Purchased"}),o.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:(W.purchased||0).toLocaleString()})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Purchased (User)"}),o.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:(W.purchased||0).toLocaleString()})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Earned Coins"}),o.jsx("p",{className:"text-2xl font-bold text-blue-400",children:(W.earned||0).toLocaleString()})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Free Coins"}),o.jsx("p",{className:"text-2xl font-bold text-red-400",children:(W.free||0).toLocaleString()})]})]}),o.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("p",{className:"text-gray-400 text-sm",children:"Total Coins in Circulation"}),o.jsx(ni,{className:"w-5 h-5 text-yellow-400"})]}),o.jsx("p",{className:"text-3xl font-bold text-yellow-400 mt-2",children:(W.total||0).toLocaleString()}),o.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"Purchased"}),o.jsxs("p",{className:"text-sm font-bold text-emerald-400",children:[((W.purchased||0)/(W.total||1)*100).toFixed(1),"%"]})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"Earned"}),o.jsxs("p",{className:"text-sm font-bold text-blue-400",children:[((W.earned||0)/(W.total||1)*100).toFixed(1),"%"]})]}),o.jsxs("div",{className:"bg-black/30 rounded p-2",children:[o.jsx("p",{className:"text-xs text-gray-400",children:"Free"}),o.jsxs("p",{className:"text-sm font-bold text-red-400",children:[((W.free||0)/(W.total||1)*100).toFixed(1),"%"]})]})]})]})})]}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Revenue & Finance (Live)"}),o.jsx(wt,{className:"bg-green-500 text-black",children:"Auto-updating"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Total Purchases"}),o.jsxs("p",{className:"text-2xl font-bold text-emerald-400",children:["$",Number(te.purchasesUsd||0).toFixed(2)]})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Total Payouts"}),o.jsxs("p",{className:"text-2xl font-bold text-blue-400",children:["$",Number(te.payoutsUsd||0).toFixed(2)]})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("p",{className:"text-gray-400 text-xs mb-1",children:"Net"}),o.jsxs("p",{className:"text-2xl font-bold text-yellow-400",children:["$",Number(te.totalUsd||0).toFixed(2)]})]})]})]}),o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("div",{className:"mb-4",children:o.jsx(wt,{className:"bg-blue-500 text-white",children:"System Health Check"})}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-white font-semibold",children:"Agora Live Streaming"}),o.jsx(ke,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:async()=>{try{window.AgoraRTC||await new Promise((oe,ve)=>{const he=document.createElement("script");he.src="https://download.agora.io/sdk/release/AgoraRTC_N-4.20.0.js",he.onload=oe,he.onerror=()=>ve(new Error("Failed to load Agora SDK")),document.head.appendChild(he)});const G="7b95b64b0e154f7ab931e2abf000e694",se=`admin_health_${Date.now()}`;let ie;try{const oe=await K.functions.invoke("generateagoratoken",{body:{channelName:se,role:"publisher",uid:1}});ie=(oe==null?void 0:oe.data)||oe}catch{ie=await qy(se,1)}if(!((ie==null?void 0:ie.token)||(ie==null?void 0:ie.rtcToken)||void 0||null))throw new Error("Failed to retrieve Agora token");if(!window.AgoraRTC.createClient({mode:"live",codec:"vp8"}))throw new Error("Failed to create Agora client");pe.success("Agora check: OK")}catch(G){pe.error(G.message||"Agora check failed")}},children:"Test Streaming"})]}),o.jsx("p",{className:"text-xs text-gray-400",children:"Validates SDK load, App ID, token fetch"})]}),o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-white font-semibold",children:"Square Payments & Cashouts"}),o.jsx(ke,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",onClick:async()=>{try{const G=await HD();if(!(G!=null&&G.success))throw new Error((G==null?void 0:G.error)||"Square test failed");pe.success("Square test: OK")}catch(G){pe.error(G.message||"Square test failed")}},children:"Test Square"})]}),o.jsx("p",{className:"text-xs text-gray-400",children:"Uses earnings_config + edge function"})]}),o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-white font-semibold",children:"Supabase Database"}),o.jsx(ke,{size:"sm",variant:"outline",onClick:async()=>{try{const G="https://qaffpsbiciegxxonsxzl.supabase.co",se="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZmZwc2JpY2llZ3h4b25zeHpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NDEyMzgsImV4cCI6MjA3ODMxNzIzOH0.Rfb4WfqYHCGwZHv8HE3OxUSZbpEFqTfAnL0K4jaFnZU",{data:ie,error:ce}=await K.from("profiles").select("id").limit(1);if(ce)throw ce;const{data:Se}=await K.rpc("get_current_high_paying_broadcasters");pe.success("Supabase check: OK")}catch(G){pe.error(G.message||"Supabase check failed")}},children:"Test Supabase"})]}),o.jsx("p",{className:"text-xs text-gray-400",children:"Checks env keys and query success"})]}),o.jsxs(Fe,{className:"p-4 bg-[#0f0f14] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("p",{className:"text-white font-semibold",children:"Stream Cleanup & Viewers"}),o.jsx(ke,{size:"sm",variant:"outline",onClick:async()=>{try{const{error:G}=await K.from("streams").update({last_heartbeat:new Date().toISOString()}).is("last_heartbeat",null);if(G)throw G;pe.success("Cleanup executed")}catch(G){pe.error(G.message||"Cleanup failed")}},children:"Run Cleanup"})]}),o.jsx("p",{className:"text-xs text-gray-400",children:"Heartbeat"})]})]})]})]})}),o.jsx(Gs,{value:"users",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"User Management"}),o.jsx(jbe,{})]})}),o.jsx(Gs,{value:"livestreams",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Si,{className:"w-6 h-6 text-red-500"}),o.jsx("h3",{className:"text-xl font-bold text-white",children:"Live Streams"}),o.jsxs(wt,{variant:"outline",className:"border-red-500 text-red-400",children:[$.length," Active"]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{variant:"destructive",size:"sm",className:"bg-red-600 hover:bg-red-700 text-white",onClick:async()=>{if(window.confirm(`Are you sure you want to delete ALL ${$.length} live streams? This action cannot be undone.`))try{let G=0,se=0;for(const ie of $)try{const{error:ce}=await K.from("streams").delete().eq("id",ie.id);ce?se++:G++}catch{se++}se>0?pe.warning(`Deleted ${G} streams, ${se} failed`):pe.success(`Successfully deleted all ${G} live streams`),i.invalidateQueries(["adminLiveStreams"])}catch(G){pe.error(`Error deleting streams: ${G.message}`)}},disabled:$.length===0,children:[o.jsx(up,{className:"w-3 h-3 mr-1"}),"Delete All"]}),o.jsxs(ke,{variant:"outline",size:"sm",className:"border-[#2a2a3a] text-gray-300",onClick:()=>{i.invalidateQueries(["adminLiveStreams"]),pe.success("Live streams refreshed")},children:[o.jsx(cp,{className:"w-3 h-3 mr-1"}),"Refresh"]})]})]}),Q?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Si,{className:"w-8 h-8 text-purple-400 mx-auto mb-4 animate-pulse"}),o.jsx("p",{className:"text-gray-400",children:"Loading live streams..."})]})}):$.length===0?o.jsxs("div",{className:"text-center py-12",children:[o.jsx(Si,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-400 text-lg",children:"No active live streams"}),o.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Streams will appear here when broadcasters go live"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:$.map(G=>{var se,ie,ce;return o.jsx(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] hover:border-purple-500 transition-colors cursor-pointer group",children:o.jsxs(pa,{className:"p-4",children:[o.jsxs("div",{className:"flex items-start justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:(se=G.profiles)!=null&&se.avatar_url?o.jsx("img",{src:G.profiles.avatar_url,alt:G.profiles.username,className:"w-10 h-10 rounded-full object-cover"}):o.jsx(Pa,{className:"w-5 h-5 text-white"})}),o.jsxs("div",{children:[o.jsxs("h4",{className:"text-white font-semibold group-hover:text-purple-400 transition-colors",children:["@",((ie=G.profiles)==null?void 0:ie.username)||"Unknown"]}),o.jsx("p",{className:"text-gray-400 text-sm",children:((ce=G.profiles)==null?void 0:ce.full_name)||"Broadcaster"})]})]}),o.jsx(wt,{className:"bg-red-500 text-white animate-pulse",children:"LIVE"})]}),o.jsxs("div",{className:"space-y-2 mb-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(Mm,{className:"w-4 h-4 text-gray-400"}),o.jsxs("span",{className:"text-gray-300",children:[G.viewer_count||0," viewers"]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(wD,{className:"w-4 h-4 text-gray-400"}),o.jsx("span",{className:"text-gray-300",children:new Date(G.created_at).toLocaleTimeString()})]}),G.title&&o.jsx("p",{className:"text-gray-300 text-sm line-clamp-2",children:G.title})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(ke,{size:"sm",className:"flex-1 bg-purple-600 hover:bg-purple-700",onClick:()=>{window.open(`/stream/${G.id}`,"_blank")},children:[o.jsx(OH,{className:"w-4 h-4 mr-1"}),"Watch Stream"]}),o.jsx(ke,{size:"sm",variant:"outline",className:"border-[#2a2a3a] text-gray-300 hover:border-purple-500",onClick:()=>{var Se;window.open(`/@${(Se=G.profiles)==null?void 0:Se.username}`,"_blank")},children:o.jsx(bD,{className:"w-4 h-4"})}),o.jsx(ke,{size:"sm",variant:"destructive",className:"bg-red-600 hover:bg-red-700 text-white",onClick:async()=>{var Se;if(window.confirm(`Are you sure you want to delete the live stream by @${(Se=G.profiles)==null?void 0:Se.username}? This action cannot be undone.`))try{const{error:oe}=await K.from("streams").delete().eq("id",G.id);oe?pe.error(`Failed to delete stream: ${oe.message}`):(pe.success("Live stream deleted successfully"),i.invalidateQueries(["adminLiveStreams"]))}catch(oe){pe.error(`Error deleting stream: ${oe.message}`)}},children:o.jsx(up,{className:"w-4 h-4"})})]})]})},G.id)})})]})}),o.jsx(Gs,{value:"integrations",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Integrations"}),o.jsx(Lbe,{})]})}),o.jsx(Gs,{value:"applications",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Applications"}),o.jsx(Mbe,{})]})}),o.jsx(Gs,{value:"cashouts",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Cashout Records"}),o.jsx(Ube,{})]})}),o.jsx(Gs,{value:"fees",children:o.jsx(Vbe,{currentUser:n})}),o.jsx(Gs,{value:"safety",children:o.jsx(Bbe,{})}),o.jsx(Gs,{value:"traeai",children:o.jsx(Hbe,{})}),o.jsx(Gs,{value:"troll-live-show",children:o.jsx(Kbe,{})}),o.jsx(Gs,{value:"content-editor",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(cP,{className:"w-6 h-6 text-blue-500"}),o.jsx("h3",{className:"text-xl font-bold text-white",children:"App Content Editor"}),o.jsx(wt,{variant:"outline",className:"border-blue-500 text-blue-400",children:"Global Editor"})]}),o.jsxs(ke,{variant:"outline",size:"sm",className:"border-[#2a2a3a] text-gray-300",onClick:()=>{i.invalidateQueries(["adminContent"]),pe.success("Content refreshed")},children:[o.jsx(cp,{className:"w-3 h-3 mr-1"}),"Refresh"]})]}),o.jsx(qbe,{})]})}),o.jsx(Gs,{value:"earnings-editor",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Es,{className:"w-6 h-6 text-green-500"}),o.jsx("h3",{className:"text-xl font-bold text-white",children:"Earnings Configuration Editor"}),o.jsx(wt,{variant:"outline",className:"border-green-500 text-green-400",children:"Revenue Settings"})]}),o.jsxs(ke,{variant:"outline",size:"sm",className:"border-[#2a2a3a] text-gray-300",onClick:()=>{i.invalidateQueries(["earningsConfig"]),pe.success("Earnings config refreshed")},children:[o.jsx(cp,{className:"w-3 h-3 mr-1"}),"Refresh"]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("h4",{className:"text-white font-semibold mb-3",children:"Quick Earnings Settings"}),o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{page:"Earnings",field:"content",label:"Earnings Page"},{page:"GoLive",field:"earnings_info",label:"Stream Earnings Info"},{page:"Store",field:"earnings_content",label:"Store Earnings"},{page:"Profile",field:"earnings_section",label:"Profile Earnings"},{page:"Home",field:"earnings_banner",label:"Home Earnings Banner"},{page:"StreamViewer",field:"earnings_tips",label:"Viewer Tips Info"}].map(G=>o.jsx(ke,{variant:"outline",size:"sm",className:"border-[#2a2a3a] text-gray-300 hover:border-green-500",onClick:()=>{x(G.page),N(G.field),m("content")},children:G.label},G.page))})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("h4",{className:"text-white font-semibold mb-3",children:"Revenue Configuration"}),o.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage broadcaster revenue shares, tip percentages, and payout structures."}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs(ke,{onClick:()=>{x("Earnings"),N("content"),m("content")},className:"bg-green-600 hover:bg-green-700",children:[o.jsx(Es,{className:"w-4 h-4 mr-2"}),"Edit Earnings Page"]}),o.jsxs(ke,{onClick:()=>{x("Earnings"),N("header_content"),m("content")},variant:"outline",className:"border-[#2a2a3a] text-gray-300 hover:border-green-500",children:[o.jsx(My,{className:"w-4 h-4 mr-2"}),"Revenue Settings"]})]})]}),o.jsxs(Fe,{className:"bg-[#0f0f14] border-[#2a2a3a] p-4",children:[o.jsx("h4",{className:"text-white font-semibold mb-3",children:"Payout Management"}),o.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Configure payout thresholds, schedules, and payment methods."}),o.jsxs(ke,{onClick:()=>m("cashouts"),variant:"outline",className:"border-[#2a2a3a] text-gray-300 hover:border-green-500",children:[o.jsx(Es,{className:"w-4 h-4 mr-2"}),"View Cashout Records"]})]})]})]})}),o.jsx(Gs,{value:"system",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"System Management"}),o.jsxs("div",{className:"text-center py-8",children:[o.jsx(fp,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500",children:"System management features are available"}),o.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Admin dashboard is now stable and responsive"})]})]})}),o.jsx(Gs,{value:"content",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Content Management"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-gray-400",children:"Page"}),o.jsx("select",{value:b,onChange:G=>x(G.target.value),className:"w-full bg-[#0a0a0f] border border-[#2a2a3a] text-white rounded-lg px-3 py-2",children:["Home","Profile","ProfilePage","Store","GoLive","StreamViewer","Messages","Notifications","AdminDashboard","PublicProfile","Trending"].map(G=>o.jsx("option",{value:G,children:G},G))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-gray-400",children:"Field"}),o.jsx("select",{value:T,onChange:G=>N(G.target.value),className:"w-full bg-[#0a0a0f] border border-[#2a2a3a] text-white rounded-lg px-3 py-2",children:["content","hero_title","hero_subtitle","banner","footer"].map(G=>o.jsx("option",{value:G,children:G},G))})]}),o.jsx("div",{className:"flex items-end",children:o.jsx(ke,{type:"button",onClick:()=>{const G=new Event("refresh-admin-content");window.dispatchEvent(G),pe.success("Content loaded")},className:"w-full",children:"Refresh"})})]}),o.jsx(cY,{pageName:`${b}/${T}`,currentContent:O||"",fieldName:T,onSave:async G=>{var Se;try{await K.from("admin_content").update({is_active:!1}).eq("page_name",b).eq("field_name",T).eq("is_active",!0)}catch{}const{data:se}=await K.auth.getUser(),ie=((Se=se==null?void 0:se.user)==null?void 0:Se.id)||null,{error:ce}=await K.from("admin_content").insert({page_name:b,field_name:T,content:G,updated_by:ie,is_active:!0});if(ce)throw ce;P(G),i.invalidateQueries(["adminContent",b,T])}})]})]})})]})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsx(Gbe,{}),o.jsxs("div",{className:"bg-[#1a1a24] border border-[#2a2a3a] rounded-lg p-6 mb-6",children:[o.jsx("h3",{className:"text-white text-lg font-semibold mb-4",children:"Admin Access Required"}),o.jsx("p",{className:"text-gray-400 mb-4",children:"You don't have admin access. Click below to make yourself an admin for testing."}),o.jsx(ke,{onClick:async()=>{await zbe()?(pe.success("You are now an admin! Please refresh the page."),i.invalidateQueries(["currentUser"])):pe.error("Failed to make you an admin")},className:"bg-purple-600 hover:bg-purple-700",children:"Update Admin Status"})]}),o.jsx(Wbe,{})]})})}function $be({isOpen:i,onClose:n,onConsent:a,userId:l}){const[u,m]=M.useState("prompt"),[y,w]=M.useState(null),[b,x]=M.useState(!1),[T,N]=M.useState(!1);M.useEffect(()=>{i&&O()},[i]);const O=async()=>{if(!navigator.permissions){m("unknown");return}try{const z=await navigator.permissions.query({name:"geolocation"});m(z.state),z.addEventListener("change",V=>{m(V.target.state)})}catch(z){console.error("Error checking location permission:",z),m("unknown")}},P=()=>{if(!navigator.geolocation){pe.error("Geolocation is not supported by this browser");return}x(!0),navigator.geolocation.getCurrentPosition(z=>{const V={latitude:z.coords.latitude,longitude:z.coords.longitude,accuracy:z.coords.accuracy,timestamp:new Date().toISOString()};w(V),x(!1),pe.success("Location retrieved successfully")},z=>{x(!1);let V="Failed to get location";switch(z.code){case z.PERMISSION_DENIED:V="Location access denied by user";break;case z.POSITION_UNAVAILABLE:V="Location information unavailable";break;case z.TIMEOUT:V="Location request timed out";break}pe.error(V)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},F=async z=>{try{N(!0);const{error:V}=await K.from("user_location_consent").upsert({user_id:l,has_consented:z,consent_given_at:z?new Date().toISOString():null,consent_version:1},{onConflict:"user_id"});if(V)throw V;z&&y&&await K.from("user_location_consent").update({location_latitude:y.latitude,location_longitude:y.longitude,location_accuracy:y.accuracy}).eq("user_id",l),pe.success(z?"Location consent granted":"Location consent denied"),a(z,y),setTimeout(()=>{n()},1e3)}catch(V){console.error("Error saving location consent:",V),pe.error("Failed to save location consent")}};return i?o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:o.jsx(Fe,{className:"bg-[#0f0f15] border-[#2a2a3a] max-w-md w-full",children:o.jsxs("div",{className:"p-6 space-y-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-12 h-12 mx-auto mb-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center",children:o.jsx(xi,{className:"w-6 h-6 text-white"})}),o.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Safety Features"}),o.jsx("p",{className:"text-gray-400 text-sm",children:"Help us keep our community safe by sharing your location for emergency situations"})]}),o.jsxs("div",{className:"bg-[#1a1a25] rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-white font-medium",children:"Location Permission"}),o.jsx(wt,{className:u==="granted"?"bg-green-600 text-white":u==="denied"?"bg-red-600 text-white":"bg-yellow-600 text-black",children:u==="granted"?"Granted":u==="denied"?"Denied":"Not Set"})]}),o.jsx("p",{className:"text-gray-400 text-sm",children:u==="granted"?"You have already granted location access.":u==="denied"?"Location access is blocked. You can still use the platform but emergency features will be limited.":"Your location will only be used for emergency safety situations."})]}),y&&o.jsxs("div",{className:"bg-[#1a1a25] rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(sle,{className:"w-4 h-4 text-blue-400"}),o.jsx("span",{className:"text-white font-medium",children:"Current Location"})]}),o.jsxs("div",{className:"text-gray-300 text-sm space-y-1",children:[o.jsxs("p",{children:["Latitude: ",y.latitude.toFixed(6)]}),o.jsxs("p",{children:["Longitude: ",y.longitude.toFixed(6)]}),o.jsxs("p",{children:["Accuracy: ",y.accuracy.toFixed(0)," meters"]})]})]}),u!=="denied"&&o.jsx(ke,{onClick:P,disabled:b,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:b?"Getting Location...":"Get My Location"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs(ke,{onClick:()=>F(!0),disabled:T,className:"flex-1 bg-green-600 hover:bg-green-700 disabled:opacity-50",children:[o.jsx(Ui,{className:"w-4 h-4 mr-2"}),"Allow"]}),o.jsxs(ke,{onClick:()=>F(!1),disabled:T,className:"flex-1 bg-red-600 hover:bg-red-700 disabled:opacity-50",children:[o.jsx(Aw,{className:"w-4 h-4 mr-2"}),"Deny"]})]}),o.jsx("p",{className:"text-gray-500 text-xs text-center",children:"Your location will only be accessed in emergency situations for safety purposes. You can change this setting at any time in your account settings."})]})})}):null}function VC(){const i=Wn(),[n,a]=M.useState(""),[l,u]=M.useState(""),[m,y]=M.useState(""),[w,b]=M.useState(!1),[x,T]=M.useState(!1),[N,O]=M.useState(""),[P,F]=M.useState(!1),[z,V]=M.useState(null),te=new URLSearchParams(window.location.search).get("token"),{data:$}=mt({queryKey:["authUser"],queryFn:async()=>{const{data:Se}=await K.auth.getUser();return(Se==null?void 0:Se.user)||null},staleTime:1e3}),{data:Q=[]}=mt({queryKey:["profilesForLogin"],queryFn:async()=>{if(!K.__isConfigured)return[];const{data:Se,error:oe}=await K.from("profiles").select("id, username, full_name, avatar, level, is_admin, is_og, is_troll_officer").order("created_at",{ascending:!1}).limit(24);return oe?[]:Se||[]},staleTime:5e3});M.useEffect(()=>{$&&i("/Home")},[$,i]);const[G,se]=ut.useState(null);M.useEffect(()=>{te&&(async()=>{try{const{data:Se,error:oe}=await K.from("pending_invites").select("email, assigned_role, expires_at, used").eq("token",te).single();!oe&&Se&&se(Se)}catch{}})()},[te]);const ie=async Se=>{Se.preventDefault(),y(""),b(!0);try{const{error:oe}=await K.auth.signInWithPassword({email:n,password:l});oe?y(oe.message||"Sign-in failed"):i("/Home")}catch(oe){y((oe==null?void 0:oe.message)||"Sign-in failed")}finally{b(!1)}},ce=async Se=>{var oe;Se.preventDefault(),y(""),b(!0);try{if(!N||N.length<6){y("Password must be at least 6 characters"),b(!1);return}const{data:ve,error:he}=await K.auth.signUp({email:n,password:N});if(he)throw he;if(!((oe=ve==null?void 0:ve.user)!=null&&oe.id))throw new Error("Sign-up failed");let Ze="user",Qe=null;if(te&&G&&!G.used)Ze=G.assigned_role||"user",Qe={token:te};else{const{data:me}=await K.from("pending_invites").select("assigned_role").eq("email",n.toLowerCase()).single();Ze=(me==null?void 0:me.assigned_role)||"user",Qe={email:n.toLowerCase()}}try{const{error:me}=await K.from("profiles").insert({id:ve.user.id,email:n,username:n.split("@")[0],role:Ze,is_admin:Ze==="admin",is_troll_officer:Ze==="troll_officer",is_troller:Ze==="troller",is_broadcaster:Ze==="broadcaster"});me&&(console.error("Profile creation error:",me),toast.warning("Account created but profile setup incomplete. Please refresh the page."))}catch(me){console.error("Profile creation failed:",me),toast.warning("Account created but profile setup failed. Please refresh the page.")}try{Qe&&await K.from("pending_invites").update({used:!0,used_date:new Date().toISOString(),used_by:ve.user.id}).match(Qe)}catch{}y(""),V(ve.user.id),F(!0)}catch(ve){y((ve==null?void 0:ve.message)||"Sign-up failed")}finally{b(!1)}};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center px-4",children:[o.jsxs("div",{className:"max-w-md w-full",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-full flex items-center justify-center shadow-lg shadow-emerald-500/30",children:o.jsx("span",{className:"text-3xl font-bold text-white",children:"T"})}),o.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"TrollCity"}),o.jsx("p",{className:"text-gray-400",children:"Join the community"})]}),o.jsx(Fe,{className:"bg-[#1a1a24]/90 border-[#2a2a3a] backdrop-blur-sm",children:o.jsxs("div",{className:"p-8",children:[o.jsxs("div",{className:"text-center mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:x?"Create Account":"Welcome Back"}),o.jsx("p",{className:"text-gray-400 text-sm",children:x?"Sign up to join TrollCity":"Sign in to continue"})]}),o.jsxs("form",{onSubmit:x?ce:ie,className:"space-y-4",children:[o.jsx("div",{children:o.jsx("input",{type:"email",value:n,onChange:Se=>a(Se.target.value),placeholder:"Email address",className:"w-full rounded-lg bg-[#0f0f16] border border-[#2a2a3a] p-3 text-white placeholder-gray-500 focus:border-emerald-500 focus:outline-none transition-colors",required:!0})}),o.jsx("div",{children:o.jsx("input",{type:"password",value:x?N:l,onChange:Se=>x?O(Se.target.value):u(Se.target.value),placeholder:x?"Create password":"Password",className:"w-full rounded-lg bg-[#0f0f16] border border-[#2a2a3a] p-3 text-white placeholder-gray-500 focus:border-emerald-500 focus:outline-none transition-colors",required:!0})}),x&&o.jsx("div",{children:o.jsx("input",{type:"password",value:l,onChange:Se=>u(Se.target.value),placeholder:"Confirm password",className:"w-full rounded-lg bg-[#0f0f16] border border-[#2a2a3a] p-3 text-white placeholder-gray-500 focus:border-emerald-500 focus:outline-none transition-colors",required:!0})}),m&&o.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:o.jsx("p",{className:"text-red-400 text-sm",children:m})}),o.jsx(ke,{type:"submit",disabled:w,className:"w-full bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-black font-semibold py-3 rounded-lg transition-all duration-200 transform hover:scale-[1.02]",children:w?o.jsxs("span",{className:"flex items-center justify-center",children:[o.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin mr-2"}),x?"Creating Account...":"Signing in..."]}):x?"Create Account":"Sign In"})]}),o.jsx("div",{className:"mt-6 text-center",children:o.jsx("button",{onClick:()=>{T(!x),y("")},className:"text-emerald-400 hover:text-emerald-300 text-sm font-medium transition-colors",children:x?"Already have an account? Sign in":"Don't have an account? Sign up"})}),!K.__isConfigured&&o.jsx("div",{className:"mt-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3",children:o.jsx("p",{className:"text-yellow-400 text-xs text-center",children:"Authentication system is currently being configured"})})]})}),o.jsx("div",{className:"text-center mt-6",children:o.jsx("p",{className:"text-gray-500 text-xs",children:"By continuing, you agree to our community guidelines"})})]}),o.jsx($be,{isOpen:P,onClose:()=>{F(!1),V(null),T(!1),a(""),u(""),O("")},onConsent:(Se,oe)=>{console.log(`Location consent ${Se?"granted":"denied"}`,oe),alert(`Sign-up successful! Your role is "${autoRole}". ${Se?"Location consent granted for emergency safety features.":""} Please log in.`)},userId:z})]})}function qk(i,n){try{const a=localStorage.getItem(i);return a?JSON.parse(a):n}catch{return n}}function ro(i,n){try{localStorage.setItem(i,JSON.stringify(n))}catch{}}function XY(){const i=Wn(),[n]=TH(),a=vn(),[l,u]=M.useState(null),[m,y]=M.useState(null),[w,b]=M.useState(()=>qk("tc_conversations",[])),[x,T]=M.useState(()=>qk("tc_messages",{})),[N,O]=M.useState(null),[P,F]=M.useState(""),[z,V]=M.useState(""),[W,te]=M.useState(!1),[$,Q]=M.useState(()=>qk("tc_archived_conversations",[]));M.useEffect(()=>{let ve=!0;return(async()=>{var he,Ze;try{const{data:Qe}=await K.auth.getUser(),me=(Qe==null?void 0:Qe.user)||null;if(!ve)return;if(u(me),K.__isConfigured&&(me!=null&&me.id))try{const{data:ye=[]}=await K.from("conversations").select("*").eq("participant1_id",me.id),{data:ge=[]}=await K.from("conversations").select("*").eq("participant2_id",me.id),Ee=[...ye,...ge],Oe=new Set,we=[];for(const fe of Ee)Oe.has(fe.id)||(Oe.add(fe.id),we.push(fe));try{const{data:fe}=await K.from("profiles").select("id, role").eq("id",me.id).single();y(fe||null),(fe==null?void 0:fe.role)==="admin"&&(we.some(je=>String(je.id)==="support-admin")||we.unshift({id:"support-admin",title:"Support Tickets"}))}catch{}if(we.length){b(we),ro("tc_conversations",we);const fe=n.get("conversation");if(fe){const De=we.find(je=>je.id===fe);De?O(De.id):N||O((he=we[0])==null?void 0:he.id)}else N||O((Ze=we[0])==null?void 0:Ze.id)}}catch{}else if(!w.length){const ye=[{id:"demo-1",title:"Demo Chat",participant1_id:"demo",participant2_id:"you",unread_count_p1:0,unread_count_p2:0}];b(ye),ro("tc_conversations",ye);const ge={"demo-1":[{id:"m1",from:"demo",text:"Welcome to Messages.",created_at:new Date().toISOString()}]};T(ge),ro("tc_messages",ge),O("demo-1")}}catch{}})(),()=>{ve=!1}},[n]),M.useEffect(()=>{(async()=>{if(l&&N){te(!0);try{if(N==="support"){const{data:Ze=[],error:Qe}=await K.from("officer_chats").select("*").eq("sender_id",l.id).order("created_date",{ascending:!0});if(!Qe){const me=Ze.map(ye=>({id:ye.id||Math.random().toString(36),from:ye.sender_id,text:ye.message_type==="support_ticket"?`Your Support Ticket: ${ye.message}`:ye.message,created_at:ye.created_date||new Date().toISOString(),message_type:ye.message_type}));T(ye=>({...ye,support:me})),ro("tc_messages",{...x,support:me})}return}if(N==="support-admin"&&(m==null?void 0:m.role)==="admin"){const{data:Ze=[],error:Qe}=await K.from("officer_chats").select("*").order("created_date",{ascending:!0});if(!Qe){const me=await Promise.all(Ze.map(async ye=>{const{data:ge}=await K.from("profiles").select("username, full_name").eq("id",ye.sender_id).single(),Ee=(ge==null?void 0:ge.username)||"Unknown User",Oe=ye.message_type==="support_ticket"?`Support Ticket from @${Ee}: ${ye.message}`:`${Ee}: ${ye.message}`;return{id:ye.id||Math.random().toString(36),from:ye.sender_id,text:Oe,created_at:ye.created_date||new Date().toISOString(),original_message:ye.message,username:Ee,message_type:ye.message_type}}));T(ye=>({...ye,"support-admin":me})),ro("tc_messages",{...x,"support-admin":me})}return}let he=!1;try{const{data:Ze,error:Qe}=await K.from("direct_messages").select("*").eq("conversation_id",N).is("deleted",null).order("created_date",{ascending:!0});if(!Qe&&Array.isArray(Ze)){const me=Ze.map(ye=>({id:ye.id||Math.random().toString(36),from:ye.sender_id,text:ye.message||ye.content||"",created_at:ye.created_date||ye.created_at||new Date().toISOString()}));T(ye=>({...ye,[N]:me})),ro("tc_messages",{...x,[N]:me}),he=!0}}catch{}if(!he){const{data:Ze,error:Qe}=await K.from("messages").select("*").eq("conversation_id",N).is("deleted",null).order("created_date",{ascending:!0});if(!Qe&&Array.isArray(Ze)){const me=Ze.map(ye=>({id:ye.id||Math.random().toString(36),from:ye.sender_id,text:ye.content||ye.message||"",created_at:ye.created_date||ye.created_at||new Date().toISOString()}));T(ye=>({...ye,[N]:me})),ro("tc_messages",{...x,[N]:me})}}}finally{te(!1)}}})()},[l,N]);const G=M.useMemo(()=>x[N]||[],[x,N]),se=M.useMemo(()=>{const ve=z.trim().toLowerCase(),he=w.filter(Ze=>!$.includes(Ze.id));return ve?he.filter(Ze=>(Ze.title||String(Ze.id)).toLowerCase().includes(ve)):he},[w,z,$]),ie=async()=>{if(!N||!P.trim())return;const ve={id:Math.random().toString(36).slice(2),from:(l==null?void 0:l.id)||"you",text:P.trim(),created_at:new Date().toISOString()},he={...x,[N]:[...G,ve]};if(T(he),ro("tc_messages",he),F(""),K.__isConfigured)try{if(N==="support")await K.from("officer_chats").insert({sender_id:l==null?void 0:l.id,message:ve.text,message_type:"support_ticket"}),pe.success("Support ticket submitted");else{try{const me=(w||[]).find(ge=>ge.id===N)||null;let ye=null;if(me){const ge=me.participant1_id,Ee=me.participant2_id;ye=String(ge)===String(l==null?void 0:l.id)?Ee:ge}if(ye){const{data:ge}=await K.from("profiles").select("role, is_admin").eq("id",l==null?void 0:l.id).single();if(!((ge==null?void 0:ge.role)==="admin"||(ge==null?void 0:ge.is_admin)===!0)){const{data:Oe}=await K.from("profiles").select("role").eq("id",ye).single();if((Oe==null?void 0:Oe.role)==="admin")await Fbe(l==null?void 0:l.id,"message_admin",{reference:ye});else{const we=await DG(ye);if(we>0&&(await $D(l==null?void 0:l.id,we,{reason:"fee_message_user",reference:ye})).needsStoreRedirect)throw pe.error("Insufficient coins. Redirecting to store..."),setTimeout(()=>i("/store"),2e3),new Error("Insufficient coins for message fee")}}}}catch(me){throw me}const Ze={conversation_id:N,sender_id:l==null?void 0:l.id,message:ve.text,created_date:new Date().toISOString()};let Qe=!1;for(let me=0;me<3&&!Qe;me++){const{error:ye}=await K.from("direct_messages").insert(Ze);if(!ye){Qe=!0;break}const Ee=String((ye==null?void 0:ye.message)||ye).match(/column\s+"?(\w+)"?\s+does not exist/i),Oe=Ee==null?void 0:Ee[1];if(Oe&&Ze.hasOwnProperty(Oe)){delete Ze[Oe];continue}break}Qe||await K.from("messages").insert({conversation_id:N,sender_id:l==null?void 0:l.id,content:ve.text}),pe.success("Message sent");try{const me=(w||[]).find(ge=>ge.id===N)||null;let ye=null;if(me){const ge=me.participant1_id,Ee=me.participant2_id;ye=String(ge)===String(l==null?void 0:l.id)?Ee:ge}if(ye){let ge=0;try{ge=await DG(ye)}catch{}await Owe(ye,(l==null?void 0:l.username)||(l==null?void 0:l.full_name)||"Someone",l==null?void 0:l.id,ve.text,ge)}}catch{}}}catch(Ze){pe.error((Ze==null?void 0:Ze.message)||"Failed to send message")}},ce=async ve=>{if(confirm("Delete this message?"))try{const he=G,Ze=he.find(Qe=>Qe.id===ve);if((Ze==null?void 0:Ze.from)===(l==null?void 0:l.id)){const Qe=he.filter(ye=>ye.id!==ve),me={...x,[N]:Qe};T(me),ro("tc_messages",me),a.setQueryData(["messages",N],Qe);try{const{error:ye}=await K.from("direct_messages").update({deleted:!0,deleted_at:new Date().toISOString()}).eq("id",ve);if(ye)throw ye}catch{try{const{error:ye}=await K.from("messages").update({deleted:!0,deleted_at:new Date().toISOString()}).eq("id",ve);if(ye)throw ye}catch{}}a.invalidateQueries(["messages",N]),a.invalidateQueries(["direct_messages",N]),pe.success("Message deleted")}else pe.error("You can only delete your own messages")}catch{pe.error("Failed to delete message")}},Se=ve=>{ve&&i(`${Or("PublicProfile")}?userId=${encodeURIComponent(ve)}`)},oe=ve=>{ve.key==="Enter"&&!ve.shiftKey&&N&&(ve.preventDefault(),ie())};return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#120a1f] to-[#0a0a0f] py-10 px-4",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center",children:o.jsx(Um,{className:"w-5 h-5 text-white"})}),o.jsx("h1",{className:"text-2xl font-bold text-white",children:"Messages"})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Zt,{value:z,onChange:ve=>V(ve.target.value),placeholder:"Search conversations",className:"w-64 bg-[#0f0f16] border-[#2a2a3a] text-white"}),o.jsx(ke,{className:"bg-purple-600 hover:bg-purple-700",children:"New"})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsxs(Fe,{className:"bg-[#11121a] border-[#2a2a3a] p-0 lg:col-span-1 rounded-xl overflow-hidden",children:[o.jsx("div",{className:"p-4 bg-gradient-to-r from-[#1a0a2f] to-[#151226] border-b border-[#2a2a3a]",children:o.jsx("p",{className:"text-white text-sm",children:"Conversations"})}),o.jsx("div",{className:"max-h-[65vh] overflow-y-auto",children:se.map(ve=>{var he;return o.jsx("button",{onClick:()=>O(ve.id),className:`w-full text-left px-4 py-3 border-b border-[#1f2030] ${N===ve.id?"bg-[#1a1b25] text-white":"text-gray-300 hover:bg-[#161622]"}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-bold",children:(he=(ve.title||"C")[0])==null?void 0:he.toUpperCase()}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"font-semibold truncate",children:ve.title||`Conversation ${ve.id}`}),o.jsx(wt,{className:"bg-red-500 text-white text-[10px]",children:(ve.unread_count_p1||0)+(ve.unread_count_p2||0)})]}),o.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:ve.last_message_preview||""})]})]})},ve.id)})})]}),o.jsxs(Fe,{className:"bg-[#11121a] border-[#2a2a3a] p-0 lg:col-span-2 rounded-xl overflow-hidden",children:[o.jsxs("div",{className:"p-4 bg-gradient-to-r from-[#1a0a2f] to-[#151226] border-b border-[#2a2a3a] flex items-center justify-between",children:[o.jsx("p",{className:"text-white font-semibold",children:N?`Chat: ${N}`:"Select a conversation"}),N&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs(ke,{type:"button",onClick:async()=>{if(!(!l||!N)&&confirm("Delete all your messages in this conversation?"))try{const ve={...x,[N]:[]};if(T(ve),ro("tc_messages",ve),a.setQueryData(["messages",N],[]),K.__isConfigured){try{await K.from("direct_messages").delete().eq("conversation_id",N).eq("sender_id",l.id)}catch{}try{await K.from("messages").delete().eq("conversation_id",N).eq("sender_id",l.id)}catch{}}a.invalidateQueries(["messages",N]),a.invalidateQueries(["direct_messages",N]),pe.success("Messages deleted")}catch{pe.error("Failed to delete conversation messages")}},className:"border-red-500 text-red-400 hover:bg-red-500/10",variant:"outline",size:"sm",children:[o.jsx(up,{className:"w-4 h-4 mr-1"})," Delete Messages"]}),o.jsxs(ke,{type:"button",onClick:async()=>{if(N&&confirm("Archive this conversation? You can restore later."))try{const ve=Array.from(new Set([...$,N]));if(Q(ve),ro("tc_archived_conversations",ve),K.__isConfigured){const he=new Date().toISOString(),Ze=[{is_archived:!0,archived_by:l==null?void 0:l.id,archived_date:he},{archived:!0,archived_by:l==null?void 0:l.id,archived_at:he},{status:"archived",last_message_time:he}];for(const Qe of Ze)try{await K.from("conversations").update(Qe).eq("id",N);break}catch{}}O(null),pe.success("Conversation archived")}catch{pe.error("Failed to archive conversation")}},className:"border-[#2a2a3a] text-gray-300 hover:bg-white/5",variant:"outline",size:"sm",children:[o.jsx(oce,{className:"w-4 h-4 mr-1"})," Archive"]}),o.jsxs(ke,{type:"button",onClick:async()=>{if(N&&confirm("Delete this conversation thread? This removes the record if allowed."))try{const ve=(w||[]).filter(Qe=>Qe.id!==N);b(ve),ro("tc_conversations",ve);const{[N]:he,...Ze}=x;if(T(Ze),ro("tc_messages",Ze),Q(Qe=>Qe.filter(me=>me!==N)),ro("tc_archived_conversations",($||[]).filter(Qe=>Qe!==N)),O(null),K.__isConfigured){try{await K.from("direct_messages").delete().eq("conversation_id",N)}catch{}try{await K.from("messages").delete().eq("conversation_id",N)}catch{}try{await K.from("conversations").delete().eq("id",N)}catch{const Qe=new Date().toISOString(),me=[{is_deleted:!0,deleted_date:Qe},{deleted:!0,deleted_at:Qe},{status:"deleted",last_message_time:Qe}];for(const ye of me)try{await K.from("conversations").update(ye).eq("id",N);break}catch{}}}pe.success("Conversation deleted")}catch{pe.error("Failed to delete conversation")}},className:"bg-red-600 hover:bg-red-700",size:"sm",children:[o.jsx(up,{className:"w-4 h-4 mr-1"})," Delete Conversation"]})]})]}),o.jsxs("div",{className:"p-4 max-h-[55vh] overflow-y-auto space-y-4",children:[G.map(ve=>o.jsxs("div",{className:`flex ${ve.from===((l==null?void 0:l.id)||"you")?"justify-end":"justify-start"} group`,children:[o.jsxs("div",{className:`max-w-[70%] px-4 py-2.5 rounded-2xl shadow-sm relative ${ve.from===((l==null?void 0:l.id)||"you")?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-[#0f0f16] text-gray-200 border border-[#2a2a3a]"}`,children:[o.jsx("p",{className:"text-sm leading-relaxed",children:ve.text}),o.jsx("p",{className:"text-[10px] opacity-70 mt-1",children:new Date(ve.created_at).toLocaleTimeString()}),ve.from&&ve.from!==((l==null?void 0:l.id)||"you")&&o.jsx("button",{type:"button",onClick:()=>Se(ve.from),className:"text-[10px] opacity-70 hover:opacity-100 hover:underline transition-opacity",children:ve.from})]}),ve.from===((l==null?void 0:l.id)||"you")&&o.jsx("button",{type:"button",onClick:()=>ce(ve.id),className:"opacity-0 group-hover:opacity-100 transition-opacity ml-2 text-red-400 hover:text-red-500 flex-shrink-0 self-center",title:"Delete message",children:o.jsx(up,{className:"w-4 h-4"})})]},ve.id)),G.length===0&&o.jsx("p",{className:"text-gray-500 text-sm",children:"No messages yet."})]}),o.jsxs("div",{className:"p-4 border-t border-[#2a2a3a] bg-[#0f0f16] flex items-center gap-3",children:[o.jsx(Nl,{value:P,onChange:ve=>F(ve.target.value),onKeyDown:oe,placeholder:N==="support-admin"?"Admin view: replies are not supported here":N==="support"?"Describe your issue to support...":"Type a message (Enter to send, Shift+Enter for newline)",disabled:N==="support-admin",className:"flex-1 bg-[#0f0f16] border-[#2a2a3a] text-white"}),o.jsx(ke,{type:"button",onClick:ie,disabled:N==="support-admin",className:"bg-purple-600 hover:bg-purple-700",children:N==="support"?"Submit Ticket":"Send"})]})]})]})]})})}function Ybe(){return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#08080b] to-[#0b1020] py-12 px-4",children:o.jsx("div",{className:"w-full max-w-4xl mx-auto",children:o.jsxs(Fe,{className:"p-8",children:[o.jsx("h1",{className:"text-3xl font-bold mb-4 text-white",children:"Careers at Troll City"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"We're growing. If you're excited about live experiences, community, and building new social features, we'd love to hear from you."}),o.jsx("h3",{className:"text-lg font-semibold text-white mt-4",children:"Open Positions"}),o.jsxs("ul",{className:"list-disc list-inside text-gray-300 mb-6",children:[o.jsx("li",{children:"Frontend Engineer (React)"}),o.jsx("li",{children:"Backend Engineer (Node / Supabase)"}),o.jsx("li",{children:"Live Operations / Community Manager"}),o.jsx("li",{children:"QA Engineer"})]}),o.jsxs("p",{className:"text-gray-300 mb-6",children:["To apply, please email your resume and a short note to ",o.jsx("strong",{children:"trollcity2025@gmail.com"}),"."]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{asChild:!0,children:o.jsx("a",{href:"mailto:trollcity2025@gmail.com",children:"Email Us"})}),o.jsx(ke,{variant:"ghost",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),children:"Back to top"})]})]})})})}function Xbe(){return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#08080b] to-[#0b1020] py-12 px-4",children:o.jsx("div",{className:"w-full max-w-3xl mx-auto",children:o.jsxs(Fe,{className:"p-8",children:[o.jsx("h1",{className:"text-2xl font-bold mb-2 text-white",children:"Contact Us"}),o.jsxs("p",{className:"text-gray-300 mb-6",children:["Have a question or need support? Drop us a message and we'll get back to you at ",o.jsx("strong",{children:"trollcity2025@gmail.com"}),"."]}),o.jsxs("form",{action:"mailto:trollcity2025@gmail.com",method:"post",encType:"text/plain",children:[o.jsx("label",{className:"block text-gray-300 text-sm mb-1",children:"Your name"}),o.jsx(Zt,{name:"name",className:"mb-4"}),o.jsx("label",{className:"block text-gray-300 text-sm mb-1",children:"Your email"}),o.jsx(Zt,{name:"email",className:"mb-4"}),o.jsx("label",{className:"block text-gray-300 text-sm mb-1",children:"Message"}),o.jsx(Nl,{name:"message",className:"mb-4 h-36"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{type:"submit",children:"Send"}),o.jsx(ke,{variant:"ghost",type:"reset",children:"Reset"})]})]})]})})})}function JY(){const{data:i}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me(),staleTime:1e3}),[n,a]=M.useState(!1),[l,u]=M.useState(!1),m=Wt(async()=>{var x;if(!i)throw new Error("Please sign in to apply");const w=i.id||((x=i.user)==null?void 0:x.id)||null;if(!w)throw new Error("No user");const{error:b}=await K.from("profiles").update({role:"troller",is_troller:!0}).eq("id",w);if(b)throw b},{onSuccess:()=>{pe.success("You are now a Troller  enjoy the Troller badge!")},onError:w=>{pe.error((w==null?void 0:w.message)||"Failed to apply")}}),y=()=>{if(!n){pe.error("You must promise to follow the Troller rules");return}m.mutate()};return o.jsx("div",{className:"min-h-screen p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Troller Application"}),o.jsxs(Fe,{className:"p-6 mb-6",children:[o.jsx("p",{className:"mb-4",children:"Thank you for wanting to be a Troller. Trollers are allowed to troll playfully but must promise NOT to discuss or harass about race, sexuality or gender. By applying you accept these rules. Trollers receive a special badge and are not subject to Troll Officer bans. Admins can demote or ban Trollers."}),o.jsx("div",{className:"mb-4",children:o.jsxs("label",{className:"flex items-center gap-3",children:[o.jsx("input",{type:"checkbox",checked:n,onChange:w=>a(w.target.checked)}),o.jsx("span",{children:"I promise to avoid race, sexuality, and gender topics and to follow community guidelines."})]})}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{onClick:y,className:"bg-emerald-500",children:"Apply to be a Troller"}),o.jsx("span",{className:"text-sm text-gray-400 self-center",children:"You will receive a Troller badge immediately after applying."})]})]}),o.jsxs(Fe,{className:"p-6",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Troller Notes"}),o.jsxs("ul",{className:"list-disc pl-5 text-sm text-gray-300",children:[o.jsx("li",{children:"Trollers can be kicked if users report them; they cannot be banned by Troll Officers."}),o.jsx("li",{children:"Admins retain full control including demote/ban."}),o.jsx("li",{children:"Troll badge is visible on profiles and in chat."})]})]})]})})}function QY(){const i=vn(),{data:n}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me()}),{data:a=[]}=mt({queryKey:["trollersList"],queryFn:async()=>{const{data:b,error:x}=await K.from("profiles").select("*").eq("role","troller").order("created_date",{ascending:!1}).limit(500);if(x)throw x;return b||[]},enabled:!!n}),l=Wt(async b=>{const{error:x}=await K.from("profiles").update({role:"user",is_troller:!1}).eq("id",b);if(x)throw x},{onSuccess:()=>{i.invalidateQueries(["trollersList"]),pe.success("Demoted to user")},onError:b=>pe.error((b==null?void 0:b.message)||"Failed")}),u=Wt(async b=>{const{error:x}=await K.from("profiles").update({is_banned:!0}).eq("id",b);if(x)throw x},{onSuccess:()=>{i.invalidateQueries(["trollersList"]),pe.success("Troller banned")},onError:b=>pe.error((b==null?void 0:b.message)||"Failed")}),m=Wt(async b=>{const{error:x}=await K.from("profiles").update({is_banned:!1}).eq("id",b);if(x)throw x},{onSuccess:()=>{i.invalidateQueries(["trollersList"]),pe.success("Unbanned")},onError:b=>pe.error((b==null?void 0:b.message)||"Failed")}),{data:y=[]}=mt({queryKey:["activeStreamBans"],queryFn:async()=>{const{data:b,error:x}=await K.from("user_stream_bans").select("*").eq("is_active",!0).order("created_date",{ascending:!1}).limit(500);if(x)throw x;return b||[]},enabled:!!n}),w=Wt(async b=>{const{error:x}=await K.from("user_stream_bans").update({is_active:!1,removed_date:new Date().toISOString()}).eq("id",b);if(x)throw x},{onSuccess:()=>{i.invalidateQueries(["activeStreamBans"]),pe.success("Unkicked")},onError:b=>pe.error((b==null?void 0:b.message)||"Failed")});return o.jsx("div",{className:"min-h-screen p-6",children:o.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[o.jsx("h1",{className:"text-3xl font-bold",children:"Admin: Trollers"}),o.jsxs(Fe,{className:"p-4",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Troller Accounts"}),o.jsx("div",{className:"grid grid-cols-1 gap-3",children:a.map(b=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#0a0a0f] rounded",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold",children:b.username||b.full_name||b.email}),o.jsxs("p",{className:"text-xs text-gray-400",children:["Joined: ",new Date(b.created_date||b.created_at||Date.now()).toLocaleString()]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[b.is_banned?o.jsx(ke,{size:"sm",onClick:()=>m.mutate(b.id),children:"Unban"}):o.jsx(ke,{size:"sm",onClick:()=>u.mutate(b.id),children:"Ban"}),o.jsx(ke,{size:"sm",onClick:()=>l.mutate(b.id),children:"Demote to User"})]})]},b.id))})]}),o.jsxs(Fe,{className:"p-4",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Active Stream Bans (Unkick)"}),o.jsx("div",{className:"space-y-2",children:y.map(b=>o.jsxs("div",{className:"flex items-center justify-between p-2 bg-[#0a0a0f] rounded",children:[o.jsxs("div",{children:[o.jsxs("p",{className:"text-sm",children:["User: ",b.user_id,"  Streamer: ",b.streamer_id]}),o.jsxs("p",{className:"text-xs text-gray-400",children:["Since: ",new Date(b.created_date).toLocaleString()]})]}),o.jsx("div",{children:o.jsx(ke,{size:"sm",onClick:()=>w.mutate(b.id),children:"Unkick"})})]},b.id))})]})]})})}function ZY(){const i=vn(),[n,a]=M.useState(""),[l,u]=M.useState("user"),[m,y]=M.useState(""),w=Wt(async()=>{var P,F;if(!n)throw new Error("Email required");if(!l)throw new Error("Role required");const x=crypto.getRandomValues(new Uint8Array(18)),T=Array.from(x).map(z=>z.toString(16).padStart(2,"0")).join(""),N=new Date(Date.now()+10080*60*1e3).toISOString(),{error:O}=await K.from("pending_invites").insert({email:n.toLowerCase(),assigned_role:l,invited_by:((F=(P=(await K.auth.getUser()).data)==null?void 0:P.user)==null?void 0:F.id)||null,token:T,expires_at:N,created_date:new Date().toISOString()});if(O)throw O;return{email:n,token:T}},{onSuccess:x=>{i.invalidateQueries(["pendingInvites"]),pe.success(`Invite created for ${x.email}. Copy the signup link below to email them.`),y(x.token);const T=`${window.location.origin}/Login?token=${encodeURIComponent(x.token)}`;try{navigator.clipboard.writeText(T),pe.success("Signup link copied to clipboard")}catch{}a(""),u("user")},onError:x=>{pe.error((x==null?void 0:x.message)||"Failed to send invite")}}),b=()=>{w.mutate()};return o.jsx("div",{className:"min-h-screen p-6",children:o.jsxs("div",{className:"max-w-2xl mx-auto",children:[o.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Admin: Send Invite"}),o.jsx(Fe,{className:"p-6",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Email"}),o.jsx(Zt,{type:"email",value:n,onChange:x=>a(x.target.value),placeholder:"user@example.com"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Auto-Assign Role"}),o.jsxs(gs,{value:l,onValueChange:u,children:[o.jsx(_s,{children:o.jsx(ys,{})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"user",children:"User"}),o.jsx(Ct,{value:"troll_officer",children:"Troll Officer"}),o.jsx(Ct,{value:"troller",children:"Troller"}),o.jsx(Ct,{value:"broadcaster",children:"Broadcaster"})]})]})]}),o.jsx("div",{className:"text-sm text-gray-400",children:o.jsxs("p",{children:['When the invited user signs up via the one-time link, they will automatically be assigned the "',l,'" role.']})}),o.jsx(ke,{onClick:b,className:"w-full bg-emerald-500",children:"Generate Invite Link"}),m&&o.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-4 mt-4",children:[o.jsx("p",{className:"text-sm text-gray-300",children:" Signup Link (auto-copied):"}),o.jsx("code",{className:"text-xs text-cyan-300 break-all mt-2 block bg-black/50 p-2 rounded",children:`${window.location.origin}/Login?token=${encodeURIComponent(m)}`})]})]})})]})})}const Jbe=[{id:"bronze",name:"Bronze",requirement:7e3,coins:"7,000",payout:25,fixedFee:4,color:"from-amber-600 to-amber-700"},{id:"silver",name:"Silver",requirement:14e3,coins:"14,000",payout:55,fixedFee:5.5,color:"from-gray-400 to-gray-500"},{id:"gold",name:"Gold",requirement:27e3,coins:"27,000",payout:100,fixedFee:10,color:"from-yellow-400 to-yellow-600"},{id:"platinum",name:"Platinum",requirement:48e3,coins:"48,000",payout:175,fixedFee:20,color:"from-blue-400 to-purple-600"}];function e9(){const[i,n]=M.useState(""),[a,l]=M.useState(!1),[u,m]=M.useState(""),[y,w]=M.useState(!1),b=vn(),x=parseInt(i||"0",10)||0,{data:T}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:{user:Q}}=await K.auth.getUser();if(!Q)return null;const{data:G}=await K.from("profiles").select("*").eq("id",Q.id).single();return G}}),{data:N,isLoading:O}=mt({queryKey:["earningsConfig"],queryFn:async()=>{const{data:Q,error:G}=await K.from("earnings_config").select("*").eq("id",1).single();return G?(console.warn("Failed to load earnings config, using defaults:",G.message),null):Q},staleTime:6e4}),P=Jbe,F=(Q,G)=>{if(typeof G=="number"&&G>=0)return Number((Q-G).toFixed(2));if(!N)return Q;const se=Math.round(Q*100),ce=Math.round(se*(N.transaction_fee_percentage??0)/100)+(N.transaction_fee_fixed_cents??0);return(se-ce)/100};N==null||N.transaction_fee_percentage,Number.isFinite(N==null?void 0:N.transaction_fee_fixed_cents)&&N.transaction_fee_fixed_cents;const z=P.map(Q=>{const G=Number(Q.requirement)||0,se=Number(Q.payout)||0,ie=F(se,Q.fixedFee),ce=x>=G;return{...Q,requirement:G,payout:se,netPayout:ie,meets:ce}}),V=z.filter(Q=>Q.meets),W=V.length>0?V[V.length-1]:null,te=z.find(Q=>!Q.meets)||null,$=Wt({mutationFn:async()=>{if(!T)throw new Error("Not authenticated");if(!W)throw new Error("No eligible tier unlocked");Math.round(W.netPayout*100),Number(W.requirement||0);const{data:Q}=await K.from("profiles").select("payout_method, square_customer_id, cashapp_tag, apple_pay_id, google_wallet_id, chime_id").eq("id",T.id).single();if(!(Q!=null&&Q.payout_method))throw new Error("No payout method configured. Please set up a payment method in your profile first.");const G={square_customer_id:Q.square_customer_id,cashapp_tag:Q.cashapp_tag,apple_pay_id:Q.apple_pay_id,google_wallet_id:Q.google_wallet_id,chime_id:Q.chime_id},{data:se,error:ie}=await K.rpc("create_cashout_request",{p_user_id:T.id,p_amount:W.netPayout,p_payment_method:Q.payout_method,p_payment_details:G});if(ie)throw ie;if(!se.success)throw se.wait_hours>0?new Error(`${se.message} Please wait ${se.wait_hours} more hours.`):new Error(se.message);return T.level>=40&&setTimeout(async()=>{var ce,Se;try{const{data:oe}=await K.from("cashout_requests").select("id, user_id, amount, coins_cost").eq("user_id",T.id).eq("status","pending").order("created_at",{ascending:!0}).limit(1);if(oe&&oe.length>0){const ve=oe[0],{data:he}=await K.auth.getUser(),Ze=await K.functions.invoke("processSquarePayout",{body:{cashoutId:ve.id,amount:ve.amount,userId:ve.user_id,currency:"USD",paymentMethod:Q.payout_method},headers:{Authorization:`Bearer ${(ce=he.data.session)==null?void 0:ce.access_token}`}});(Se=Ze.data)!=null&&Se.success&&pe.success(` Cashout processed in ${Ze.data.processingTime/1e3}s!`)}}catch(oe){console.log("Auto-processing failed, will be processed manually:",oe)}},1e3),se},onSuccess:Q=>{const G=Q.message||` Payout request of $${W.netPayout.toFixed(2)} submitted successfully!`;pe.success(G),b.invalidateQueries(["currentUser"]),l(!1),n("")},onError:Q=>{pe.error(` Payout failed: ${(Q==null?void 0:Q.message)||"Unknown error"}`)}});return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#09090d] to-[#07060a] py-10 px-4",children:o.jsxs("div",{className:"max-w-6xl mx-auto",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:" Earnings & Payout Tiers"}),o.jsx("p",{className:"text-gray-400",children:"Track your coins and unlock higher payout tiers"}),o.jsxs("div",{className:"mt-3 space-y-2",children:[o.jsxs("div",{className:"p-3 rounded bg-yellow-900/20 border border-yellow-600/30 text-yellow-300 text-sm flex items-center gap-2",children:[o.jsx(fp,{className:"w-4 h-4"}),"Payouts are processed 30 minutes after you cash out."]}),T&&o.jsxs("div",{className:`p-3 rounded border text-sm flex items-center gap-2 ${T.level>=40?"bg-green-900/20 border-green-600/30 text-green-300":"bg-blue-900/20 border-blue-600/30 text-blue-300"}`,children:[o.jsx(fp,{className:"w-4 h-4"}),T.level>=40?` Level ${T.level}+ - You have INSTANT cashout access! No 24-hour wait required.`:` Level ${T.level} - 24-hour wait between cashouts. Reach level 40 for instant access!`]})]})]}),o.jsxs(Fe,{className:"bg-gradient-to-r from-[#1a1a24] to-[#0f0f14] border-[#2a2a3a] p-6 mb-6",children:[o.jsxs("h2",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[o.jsx(kw,{className:"w-5 h-5 text-emerald-400"}),"Coin Calculator"]}),o.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("label",{className:"text-gray-400 text-sm mb-2 block",children:"Enter Your Current Coins"}),o.jsx(Zt,{value:i,onChange:Q=>n(Q.target.value),placeholder:"e.g., 12500",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white text-lg"})]}),o.jsx(ke,{onClick:()=>n(""),variant:"outline",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white hover:bg-[#1a1a24]",children:"Clear"})]}),i&&o.jsx("div",{className:"mt-6 p-4 bg-[#0a0a0f] rounded-lg border border-[#2a2a3a]",children:W?o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:"text-gray-300 mb-2",children:[" You've unlocked ",o.jsx("span",{className:"font-bold text-green-400",children:W.name})," tier!"]}),o.jsxs("p",{className:"text-sm text-gray-500",children:["Gross payout: ",o.jsxs("span",{className:"text-yellow-400 font-semibold",children:["$",W.payout.toFixed(2)]})]}),o.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["After fees: ",o.jsxs("span",{className:"text-emerald-300 font-semibold",children:["$",W.netPayout.toFixed(2)]})]})]}):te?o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:"text-gray-300 mb-2",children:["Next tier: ",o.jsx("span",{className:"font-bold text-cyan-400",children:te.name})]}),o.jsxs("p",{className:"text-sm text-gray-500",children:["Earn ",o.jsx("span",{className:"text-emerald-400 font-semibold",children:(te.requirement-x).toLocaleString()})," more coins to unlock $",te.payout.toFixed(2)," payout"]})]}):null})]}),W&&o.jsxs(Fe,{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/30 p-6 mb-6",children:[o.jsxs("h2",{className:"text-white font-semibold mb-4 flex items-center gap-2",children:[o.jsx(Es,{className:"w-5 h-5 text-emerald-400"}),"Request Payout"]}),a?o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"bg-[#0a0a0f] p-4 rounded-lg border border-[#2a2a3a]",children:[o.jsxs("p",{className:"text-gray-300 text-sm mb-2",children:["Payout Method: ",o.jsx("span",{className:"text-emerald-400 font-semibold",children:(T==null?void 0:T.payout_method)||"Not configured"})]}),o.jsx("p",{className:"text-xs text-gray-500",children:" Make sure you have configured a payout method in your profile (CashApp, Apple Pay, Google Wallet, or Chime)."})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{onClick:()=>l(!1),variant:"outline",className:"border-[#2a2a3a] text-gray-300 hover:bg-[#1a1a24] flex-1",children:"Cancel"}),o.jsx(ke,{onClick:()=>$.mutate(),disabled:!(T!=null&&T.payout_method)||$.isPending||((W==null?void 0:W.payout)||0)<25,className:"bg-emerald-600 hover:bg-emerald-700 text-white flex-1",children:$.isPending?o.jsxs(o.Fragment,{children:[o.jsx(yy,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Es,{className:"w-4 h-4 mr-2"}),"Request Payout"]})})]}),!(T!=null&&T.payout_method)&&o.jsx("p",{className:"text-xs text-red-400 mt-2",children:"Please configure a payout method in your profile first."}),((W==null?void 0:W.payout)||0)<25&&o.jsx("p",{className:"text-xs text-red-400 mt-2",children:"Minimum payout is $25."})]}):o.jsxs(ke,{onClick:()=>l(!0),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:["Request $",W.netPayout.toFixed(2)," Payout"]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:z.map((Q,G)=>o.jsxs(Fe,{className:`border-2 bg-gradient-to-br ${Q.meets?`border-green-500 ${Q.color}`:"border-[#2a2a3a] from-[#1a1a24] to-[#0f0f14]"} p-6 transition-all ${Q.meets?"shadow-lg shadow-green-500/20":"opacity-70"}`,children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h3",{className:`font-bold text-lg ${Q.meets?"text-white":"text-gray-300"}`,children:Q.name}),Q.meets&&o.jsx(wt,{className:"bg-green-500 text-white",children:" Unlocked"})]}),o.jsxs("div",{className:"mb-4 p-3 bg-black/30 rounded",children:[o.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Requirement"}),o.jsx("p",{className:`text-xl font-bold ${Q.meets?"text-green-400":"text-gray-300"}`,children:Q.coins})]}),o.jsxs("div",{className:"mb-4 p-3 bg-black/30 rounded",children:[o.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Gross Payout"}),o.jsxs("p",{className:"text-2xl font-bold text-yellow-400",children:["$",Q.payout.toFixed(2)]})]}),o.jsxs("div",{className:"mb-4 p-3 bg-black/20 rounded border border-purple-500/20",children:[o.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"After Fees"}),o.jsxs("p",{className:"text-lg font-bold text-emerald-300",children:["$",Q.netPayout.toFixed(2)]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Fee: $",(Q.payout-Q.netPayout).toFixed(2)]})]}),Q.meets?o.jsx("p",{className:"text-green-300 text-xs font-semibold",children:"You qualify for this tier"}):o.jsxs("p",{className:"text-gray-400 text-xs",children:["Need ",Q.coins," coins"]})]},`tier-${Q.id}-${G}`))}),o.jsxs(Fe,{className:"bg-[#0f1014] border-[#2a2a3a] p-6 mb-6",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:" Submit a Support Ticket"}),o.jsx("p",{className:"text-gray-400 text-sm mb-3",children:"Send a ticket to admin. It appears in Messages under Support Tickets."}),o.jsx(Nl,{placeholder:"Describe your issue or question",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white",value:u,onChange:Q=>m(Q.target.value)}),o.jsx("div",{className:"mt-3 flex justify-end",children:o.jsx(ke,{disabled:!u.trim()||y,onClick:async()=>{if(!T){pe.error("Login required");return}w(!0);try{await K.from("officer_chats").insert({sender_id:T.id,message:u.trim(),message_type:"support_ticket",created_date:new Date().toISOString()}),m(""),pe.success("Support ticket submitted")}catch(Q){pe.error((Q==null?void 0:Q.message)||"Failed to submit ticket")}finally{w(!1)}},className:"bg-blue-600 hover:bg-blue-700 text-white",children:y?"Submitting...":"Submit Ticket"})})]}),o.jsxs(Fe,{className:"bg-[#0f1014] border-[#2a2a3a] p-6 mb-6",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:"All Levels  Paid Coins"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("div",{className:"min-w-[520px] grid grid-cols-3 gap-2",children:[o.jsx("div",{className:"text-xs text-gray-400",children:"Level"}),o.jsx("div",{className:"text-xs text-gray-400",children:"Range"}),o.jsx("div",{className:"text-xs text-gray-400",children:"Extra per day (paid)"}),Qbe.map((Q,G)=>o.jsxs(ut.Fragment,{children:[o.jsx("div",{className:"p-2 bg-[#0a0a0f] text-white rounded",children:Q.name}),o.jsx("div",{className:"p-2 bg-[#0a0a0f] text-gray-300 rounded",children:Q.range}),o.jsxs("div",{className:"p-2 bg-[#0a0a0f] text-emerald-300 rounded",children:[Q.dailyPaid," coins"]})]},`level-bonus-${Q.name}-${G}`))]})})]}),o.jsxs(Fe,{className:"bg-[#0f1014] border-[#2a2a3a] p-6",children:[o.jsx("h3",{className:"text-white font-semibold mb-4",children:" Payout Information"}),o.jsxs("ul",{className:"text-gray-400 text-sm space-y-3",children:[o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-emerald-400",children:""}),o.jsx("span",{children:"Payout amounts are estimates and subject to platform fees."})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-emerald-400",children:""}),o.jsx("span",{children:"Minimum payout is $25"})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-emerald-400",children:""}),o.jsx("span",{children:"Payout eligibility may depend on account standing and verification."})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-cyan-400",children:""}),o.jsx("span",{className:"font-semibold text-emerald-400",children:"In your profile, you must set up a payout method to ensure cashouts are sent."})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-yellow-400",children:""}),o.jsx("span",{children:"Payouts are processed 30 minutes after you cash out."})]}),o.jsxs("li",{className:"flex gap-2",children:[o.jsx("span",{className:"text-blue-400",children:""}),o.jsx("span",{children:"Contact the admin team for questions about earnings and payouts."})]})]})]})]})})}const Qbe=[{name:"Tiny Troller",range:"09",dailyPaid:15},{name:"Gang Troller",range:"1019",dailyPaid:35},{name:"OG Troller",range:"2040",dailyPaid:75},{name:"Old Ass troller",range:"4160",dailyPaid:100},{name:"Dead troller",range:"6170",dailyPaid:200},{name:"Graveyard",range:"71100",dailyPaid:500}];function Zbe(i,n){try{localStorage.setItem(i,JSON.stringify(n))}catch{}}function eSe(i,n){try{const a=localStorage.getItem(i);return a?JSON.parse(a):n}catch{return n}}function t9(){const[i,n]=M.useState(""),[a,l]=M.useState(""),[u,m]=M.useState("purple"),[y,w]=M.useState(""),[b,x]=M.useState(""),[T,N]=M.useState(1),[O,P]=M.useState("private"),[F,z]=M.useState(""),V=async W=>{var Q;if(W.preventDefault(),z(""),K.__isConfigured)try{const{data:G}=await K.auth.getUser(),se=((Q=G==null?void 0:G.user)==null?void 0:Q.id)||null;if(!se){pe.error("You must be logged in to submit an application");return}const{data:ie}=await K.from("profiles").select("paid_coins").eq("id",se).single();if(!ie||(ie.paid_coins||0)<1e3){pe.error("You need at least 1000 paid coins to submit a Troll Family application");return}const{error:ce}=await K.from("profiles").update({paid_coins:(ie.paid_coins||0)-1e3}).eq("id",se);if(ce){pe.error("Failed to deduct coins. Please try again.");return}const Se={user_id:se,family_name:i,family_description:y,status:"pending"};await K.from("troll_family_applications").insert(Se);const oe={family_emoji:a||null,family_color:u||null,family_rules:b||null,min_level:T||1,privacy:O||"private"};await K.from("troll_family_applications").update(oe).eq("family_name",i).eq("status","pending").limit(1);const{data:ve}=await K.from("profiles").select("*").eq("role","admin").limit(10);if(Array.isArray(ve)){const he=ve.map(Ze=>({user_id:Ze.id,type:"family_application",title:"New Troll Family Application",message:`${i} submitted a troll family application`,is_read:!1,created_date:new Date().toISOString()}));await K.from("notifications").insert(he).catch(()=>{})}pe.success("Application submitted successfully! 1000 paid coins have been deducted from your account.")}catch(G){console.error("Application submission error:",G),pe.error("Failed to submit application. Please try again.");return}const te={family_name:i,emoji:a,color:u,description:y,rules:b,min_level:T,privacy:O,created_at:new Date().toISOString(),type:"family"},$=eSe("tc_apps_family",[]);Zbe("tc_apps_family",[te,...$]),z("Submitted"),n(""),l(""),m("purple"),w(""),x(""),N(1),P("private")};return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#120a1f] to-[#0a0a0f] py-10 px-4",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center",children:o.jsx(jn,{className:"w-8 h-8 text-white"})}),o.jsx("h1",{className:"text-3xl font-bold text-white",children:"Create a Troll Family"}),o.jsx("p",{className:"text-gray-400",children:"Build your own community within TrollCity"})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsx(Fe,{className:"bg-[#11121a] border-[#2a2a3a] p-6 lg:col-span-2 rounded-xl",children:o.jsxs("form",{onSubmit:V,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"md:col-span-2",children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Family Name *"}),o.jsx(Zt,{value:i,onChange:W=>n(W.target.value),placeholder:"Enter your family name...",className:"bg-[#0f0f16] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Family Emoji"}),o.jsx(Zt,{value:a,onChange:W=>l(W.target.value),placeholder:"e.g. ",className:"bg-[#0f0f16] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Family Color"}),o.jsxs(gs,{value:u,onValueChange:W=>m(W),children:[o.jsx(_s,{className:"bg-[#0f0f16] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"purple",children:"Purple"}),o.jsx(Ct,{value:"blue",children:"Blue"}),o.jsx(Ct,{value:"red",children:"Red"}),o.jsx(Ct,{value:"green",children:"Green"}),o.jsx(Ct,{value:"gold",children:"Gold"})]})]})]}),o.jsxs("div",{className:"md:col-span-2",children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Family Description *"}),o.jsx(Nl,{value:y,onChange:W=>w(W.target.value),placeholder:"Describe your Troll Family and what makes it special...",className:"bg-[#0f0f16] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{className:"md:col-span-2",children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Family Rules (Optional)"}),o.jsx(Nl,{value:b,onChange:W=>x(W.target.value),placeholder:"Enter your family rules and guidelines...",className:"bg-[#0f0f16] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Minimum Level"}),o.jsx(Zt,{type:"number",min:1,value:T,onChange:W=>N(parseInt(W.target.value||"1")),className:"bg-[#0f0f16] border-[#2a2a3a] text-white"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-white font-semibold mb-2 block",children:"Privacy"}),o.jsxs(gs,{value:O,onValueChange:W=>P(W),children:[o.jsx(_s,{className:"bg-[#0f0f16] border-[#2a2a3a] text-white",children:o.jsx(ys,{})}),o.jsxs(vs,{children:[o.jsx(Ct,{value:"private",children:"Private (requires approval)"}),o.jsx(Ct,{value:"public",children:"Public"})]})]})]}),o.jsx("div",{className:"md:col-span-2 bg-[#0a0a0f] border border-[#2a2a3a] rounded-lg p-3 text-sm text-gray-300",children:"Applications are reviewed by admin. If approved, you'll be able to recruit members and build your Troll Family."}),o.jsxs("div",{className:"md:col-span-2 flex items-center justify-between",children:[F&&o.jsx("p",{className:"text-emerald-400 text-sm",children:F}),o.jsx(ke,{type:"submit",className:"bg-emerald-500 hover:bg-emerald-600 text-black",children:"Submit Application"})]})]})}),o.jsx(Fe,{className:"bg-yellow-500/10 border-yellow-500/30 p-6 rounded-xl",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx("p",{className:"text-white font-semibold",children:"Application Fee"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(ni,{className:"w-5 h-5 text-yellow-400"}),o.jsx("span",{className:"text-yellow-400 font-bold",children:"1000 Paid Coins"})]}),o.jsx("p",{className:"text-sm text-yellow-300",children:"This fee will be deducted from your paid coins balance upon submission."}),o.jsx("p",{className:"text-sm text-yellow-200",children:"Pick a name, emoji, and color that represents your family."}),o.jsx("p",{className:"text-sm text-yellow-200",children:"Clear rules help members understand expectations."})]})})]})]})})}async function tSe(i=new Date){const n=new Date(i),a=n.getDay(),l=a>=5?a-5:7-(5-a),u=new Date(n);u.setDate(n.getDate()-l),u.setHours(0,0,0,0);const m=new Date(u.getTime()-10080*60*1e3),y=new Date(u.getTime()),w=`
    SELECT p.troll_family_id, p.troll_family_name, SUM(g.coin_value) as total_coins
    FROM stream_gifts g
    JOIN profiles p ON p.id = g.recipient_id
    WHERE g.created_date >= $1 AND g.created_date < $2
      AND p.troll_family_id IS NOT NULL
    GROUP BY p.troll_family_id, p.troll_family_name
    ORDER BY total_coins DESC
    LIMIT 1
  `;let b=null,x=null;try{b=(await K.rpc("sql",{q:w,params:[m.toISOString(),y.toISOString()]})).data}catch(N){x=N}if(x){const{data:N,error:O}=await K.from("stream_gifts").select("*, recipient:recipient_id(id, troll_family_id, troll_family_name)").gte("created_date",m.toISOString()).lt("created_date",y.toISOString());if(O)throw O;const P={};(N||[]).forEach(V=>{var $,Q;const W=($=V.recipient)==null?void 0:$.troll_family_id;if(!W)return;const te=((Q=V.recipient)==null?void 0:Q.troll_family_name)||"Unknown";P[W]=P[W]||{family_id:W,family_name:te,total_coins:0},P[W].total_coins+=Number(V.coin_value||0)});const F=Object.values(P).sort((V,W)=>W.total_coins-V.total_coins);if(F.length===0)return null;const z=F[0];return await jG(z,m,y)}const T=b&&b.length>0?b[0]:null;return T?await jG({family_id:T.troll_family_id,family_name:T.troll_family_name,total_coins:Number(T.total_coins)},m,y):null}async function jG(i,n,a){const{family_id:u,family_name:m,total_coins:y}=i,{data:w,error:b}=await K.from("profiles").select("id, username, email").eq("troll_family_id",u);if(b)throw b;const x=(w||[]).length;if(x===0)return null;const T=parseFloat((50/x).toFixed(2)),{error:N}=await K.from("family_weekly_payouts").insert({family_id:u,family_name:m,total_coins_received:y,payout_amount_total:50,payout_per_member:T,week_start:n.toISOString(),week_end:a.toISOString(),created_date:new Date().toISOString()});if(N)throw N;for(const O of w)await K.from("payouts").insert({user_id:O.id,user_name:O.username||O.email,user_email:O.email||null,coin_amount:0,usd_amount:T,fee_amount:0,payout_amount:T,payment_method:"manual",payment_details:`Family weekly payout ${m}`,status:"pending",admin_notes:`Family weekly payout for week ${n.toISOString()} - ${a.toISOString()}`,created_date:new Date().toISOString()});return{family_id:u,family_name:m,total_coins:y,memberCount:x,perMember:T}}async function rSe(i=10){const{data:n,error:a}=await K.from("family_weekly_payouts").select("*").order("created_date",{ascending:!1}).limit(i);if(a)throw a;return n||[]}function r9(){const i=vn(),{data:n=[]}=mt({queryKey:["familyPayoutsRecent"],queryFn:()=>rSe(20)}),a=Wt({mutationFn:async()=>await tSe(new Date),onSuccess:l=>{i.invalidateQueries(["familyPayoutsRecent"]),i.invalidateQueries(["adminAllPayouts"]),l?pe.success(`Weekly family payout generated: ${l.family_name}  $${l.perMember} per member`):pe.info("No family qualified for this week")},onError:l=>{pe.error(l.message||"Failed to generate payouts")}});return o.jsx("div",{className:"min-h-screen p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[o.jsx("h1",{className:"text-3xl font-bold",children:"Family Weekly Payouts"}),o.jsxs(Fe,{className:"p-4",children:[o.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Generate the weekly top Troll Family payout ($50 split evenly among members). This should be scheduled weekly (Friday) via a cron job; you can trigger it manually here for testing."}),o.jsx(ke,{onClick:()=>a.mutate(),className:"bg-purple-600",children:"Run Weekly Payout Now"})]}),o.jsxs(Fe,{className:"p-4",children:[o.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Recent Family Payouts"}),o.jsxs("div",{className:"space-y-3",children:[n.length===0&&o.jsx("p",{className:"text-sm text-gray-400",children:"No payouts yet"}),n.map(l=>o.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#0a0a0f] rounded",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-semibold",children:l.family_name}),o.jsxs("p",{className:"text-xs text-gray-400",children:["Week: ",new Date(l.week_start).toLocaleDateString()," - ",new Date(l.week_end).toLocaleDateString()]})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("p",{className:"text-yellow-400 font-semibold",children:["$",l.payout_per_member]}),o.jsxs("p",{className:"text-xs text-gray-400",children:["Total: $",l.payout_amount_total]})]})]},`${l.family_id}-${l.created_date}`))]})]})]})})}const n9=()=>{const i=Wn(),n=vn(),[a,l]=M.useState(""),[u,m]=M.useState(null),[y,w]=M.useState(!1),[b,x]=M.useState({wins:0,losses:0,totalWon:0,totalLost:0}),[T,N]=M.useState(0),[O,P]=M.useState(null),{data:F}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:ie}=await K.auth.getUser();return(ie==null?void 0:ie.user)||null},retry:!1,staleTime:5e3}),{data:z,isLoading:V}=mt({queryKey:["userProfile",F==null?void 0:F.id],queryFn:async()=>{if(!(F!=null&&F.id))return null;const{data:ie,error:ce}=await K.from("profiles").select("id, coins, free_coins, purchased_coins, username").eq("id",F.id).single();if(ce)throw ce;return ie},enabled:!!(F!=null&&F.id),refetchInterval:3e3}),{data:W=[]}=mt({queryKey:["gamblingHistory",F==null?void 0:F.id],queryFn:async()=>{if(!(F!=null&&F.id))return[];const{data:ie,error:ce}=await K.from("gambling_records").select("*").eq("user_id",F.id).order("created_date",{ascending:!1}).limit(50);if(ce)throw ce;return ie||[]},enabled:!!(F!=null&&F.id),refetchInterval:5e3}),{data:te={}}=mt({queryKey:["houseGamblingStats"],queryFn:async()=>{const{data:ie,error:ce}=await K.from("gambling_stats").select("*").single();return ce?(console.warn("No house stats yet"),{total_wagered:0,total_paid_out:0,total_house_profit:0}):ie},refetchInterval:1e4});M.useEffect(()=>{if(W.length>0){const ie=W.filter(ve=>ve.result==="win").length,ce=W.filter(ve=>ve.result==="loss").length,Se=W.filter(ve=>ve.result==="win").reduce((ve,he)=>ve+(he.winnings||0),0),oe=W.filter(ve=>ve.result==="loss").reduce((ve,he)=>ve+(he.bet_amount||0),0);x({wins:ie,losses:ce,totalWon:Se,totalLost:oe})}},[W]);const $=Wt({mutationFn:async({userId:ie,bet:ce})=>{if(!ie)throw new Error("User not found");if(ce<=0)throw new Error("Bet amount must be greater than 0");if(!z)throw new Error("Profile not loaded");let Se;try{if(Se=await $D(ie,ce,{reason:"gamble_bet",source:"gambling_house",reference:"gamble_game"}),Se.needsStoreRedirect){pe.error("Insufficient coins. Redirecting to store..."),setTimeout(()=>i("/store"),2e3),w(!1);return}}catch{if((z.purchased_coins||0)<ce)throw new Error("Insufficient paid coins. Only paid coins can be used for gambling.");await WR(ie,ce,{reason:"gamble_bet",source:"gambling_house"})}const oe=new Date().toDateString();if((O?new Date(O).toDateString():null)===oe){if(T>=5)throw new Error("Daily limit reached! You can only play 5 times per day.")}else N(0),P(new Date().toISOString());const Ze=Math.random()<.6;let Qe=1.5;ce>=1e3?Qe=3:ce>=500?Qe=2.5:ce>=100?Qe=2:ce>=50&&(Qe=1.8);const me=Ze?Math.floor(ce*Qe):0,{error:ye}=await K.from("gambling_records").insert({user_id:ie,bet_amount:ce,result:Ze?"win":"loss",winnings:me,multiplier:Ze?Qe:0,created_date:new Date().toISOString()});if(ye)throw ye;Ze&&await zD(ie,me,{reason:"gamble_win",source:"gambling_house"});const{data:ge}=await K.from("gambling_stats").select("*").single(),Ee=ge||{id:"1",total_wagered:0,total_paid_out:0,total_house_profit:0},Oe={...Ee,total_wagered:(Ee.total_wagered||0)+ce,total_paid_out:(Ee.total_paid_out||0)+me,total_house_profit:(Ee.total_wagered||0)+ce-((Ee.total_paid_out||0)+me)};return ge!=null&&ge.id?await K.from("gambling_stats").update(Oe).eq("id",ge.id):await K.from("gambling_stats").insert(Oe),{didWin:Ze,winnings:me,bet:ce,multiplier:Qe}},onSuccess:ie=>{m(ie),l(""),ie.didWin?pe.success(` You won ${ie.winnings} coins! (${ie.multiplier}x multiplier)`):pe.error(" You lost this round. Better luck next time!"),n.invalidateQueries({queryKey:["userProfile"]}),n.invalidateQueries({queryKey:["gamblingHistory"]}),n.invalidateQueries({queryKey:["houseGamblingStats"]})},onError:ie=>{pe.error(ie.message||"Gambling failed")}}),Q=()=>{const ie=parseInt(a);if(!ie||ie<=0){pe.error("Please enter a valid bet amount");return}if(!(F!=null&&F.id)){pe.error("Please log in first");return}const ce=new Date().toDateString();if(((O?new Date(O).toDateString():null)===ce?T:0)>=5){pe.error("Daily limit reached! You can only play 5 times per day.");return}w(!0),m(null),setTimeout(()=>{$.mutate({userId:F.id,bet:ie}),w(!1)},2e3)},G=ie=>{l(ie.toString())};if(V)return o.jsx("div",{className:"flex justify-center items-center h-screen",children:o.jsx("p",{className:"text-gray-400",children:"Loading your profile..."})});const se=b.wins+b.losses>0?(b.wins/(b.wins+b.losses)*100).toFixed(1):0;return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#0f0f1a] via-[#1a0a2e] to-[#16213e] p-4 md:p-8",children:[o.jsxs("div",{className:"max-w-6xl mx-auto mb-8",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(jce,{className:"w-8 h-8 text-purple-500"}),o.jsx("h1",{className:"text-4xl font-bold text-white",children:"Troll Casino"})]}),o.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[o.jsx("p",{className:"text-gray-400",children:"60% chance to win! Higher bets = higher multipliers!"}),o.jsxs("div",{className:"flex items-center gap-2 bg-blue-500/10 px-3 py-1 rounded-full",children:[o.jsx(uo,{className:"w-4 h-4 text-blue-400"}),o.jsxs("span",{className:"text-blue-400 font-semibold",children:["Daily Plays: ",T,"/5"]})]})]})]}),o.jsxs("div",{className:"max-w-6xl mx-auto grid md:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsx(Fe,{className:"bg-[#1a1a2e] border-purple-500/30 p-6",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-bold text-white",children:"Your Balance"}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-purple-500/10 rounded-lg p-4",children:[o.jsx("p",{className:"text-sm text-gray-400",children:"Paid Coins"}),o.jsx("p",{className:"text-3xl font-bold text-purple-400",children:(z==null?void 0:z.purchased_coins)||0})]}),o.jsxs("div",{className:"bg-blue-500/10 rounded-lg p-4",children:[o.jsx("p",{className:"text-sm text-gray-400",children:"Free Coins"}),o.jsx("p",{className:"text-3xl font-bold text-blue-400",children:(z==null?void 0:z.free_coins)||0})]})]})]})}),o.jsxs(Fe,{className:"bg-[#1a1a2e] border-purple-500/30 p-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Place Your Bet"}),T>=4&&o.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 flex items-center gap-2",children:[o.jsx(fp,{className:"w-4 h-4 text-yellow-400"}),o.jsxs("span",{className:"text-yellow-400 text-sm font-semibold",children:["Warning: You have ",5-T," play",5-T===1?"":"s"," left today!"]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-gray-400 mb-2 block",children:"Bet Amount (Paid Coins Only)"}),o.jsx(Zt,{type:"number",value:a,onChange:ie=>l(ie.target.value),placeholder:"Enter bet amount",disabled:y,className:"bg-[#0f0f1a] border-purple-500/30 text-white"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:[10,50,100,500].map(ie=>o.jsx(ke,{onClick:()=>G(ie),disabled:y||((z==null?void 0:z.purchased_coins)||0)<ie,variant:"outline",size:"sm",className:"text-xs",children:ie},ie))}),o.jsx(ke,{onClick:Q,disabled:y||!a||$.isPending,className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-6 text-lg",children:y?" SPINNING...":" SPIN"}),u&&o.jsxs("div",{className:`p-4 rounded-lg text-center ${u.didWin?"bg-green-500/20":"bg-red-500/20"}`,children:[o.jsx("p",{className:"text-2xl font-bold mb-2",children:u.didWin?" YOU WON!":" YOU LOST"}),o.jsxs("p",{className:"text-gray-300",children:["Bet: ",u.bet," coins",u.didWin&&`  Won: ${u.winnings} coins`]})]}),o.jsxs("div",{className:"bg-blue-500/10 rounded-lg p-4 text-sm text-gray-300 space-y-2",children:[o.jsxs("p",{children:[" ",o.jsx("strong",{children:"Rules:"})]}),o.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[o.jsx("li",{children:"Only paid coins can be used for gambling"}),o.jsx("li",{children:"60% chance to win (high win rate!)"}),o.jsx("li",{children:"Higher bets = higher multipliers (1.5x to 3x)"}),o.jsx("li",{children:"Lost bets go to the house"}),o.jsx("li",{children:"Maximum 5 plays per day"}),o.jsx("li",{children:"Winnings credited instantly"})]})]})]})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs(Fe,{className:"bg-[#1a1a2e] border-purple-500/30 p-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Your Stats"}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-center p-3 bg-[#0f0f1a] rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"Total Bets:"}),o.jsx("span",{className:"text-white font-bold",children:b.wins+b.losses})]}),o.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-500/10 rounded-lg",children:[o.jsxs("span",{className:"text-gray-400 flex items-center gap-2",children:[o.jsx(kw,{className:"w-4 h-4 text-green-400"})," Wins:"]}),o.jsx("span",{className:"text-green-400 font-bold",children:b.wins})]}),o.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-500/10 rounded-lg",children:[o.jsxs("span",{className:"text-gray-400 flex items-center gap-2",children:[o.jsx(Wle,{className:"w-4 h-4 text-red-400"})," Losses:"]}),o.jsx("span",{className:"text-red-400 font-bold",children:b.losses})]}),o.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-500/10 rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"Win Rate:"}),o.jsxs("span",{className:"text-blue-400 font-bold",children:[se,"%"]})]}),o.jsxs("div",{className:"flex justify-between items-center p-3 bg-purple-500/10 rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"Total Won:"}),o.jsx("span",{className:"text-purple-400 font-bold",children:b.totalWon})]}),o.jsxs("div",{className:"flex justify-between items-center p-3 bg-red-500/10 rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"Total Lost:"}),o.jsx("span",{className:"text-red-400 font-bold",children:b.totalLost})]})]})]}),o.jsxs(Fe,{className:"bg-[#1a1a2e] border-yellow-500/30 p-6",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx(GC,{className:"w-5 h-5 text-yellow-500"}),o.jsx("h2",{className:"text-xl font-bold text-white",children:"House Stats"})]}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"flex justify-between p-3 bg-[#0f0f1a] rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"Total Wagered:"}),o.jsx("span",{className:"text-white font-bold",children:(te==null?void 0:te.total_wagered)||0})]}),o.jsxs("div",{className:"flex justify-between p-3 bg-[#0f0f1a] rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"Total Paid Out:"}),o.jsx("span",{className:"text-white font-bold",children:(te==null?void 0:te.total_paid_out)||0})]}),o.jsxs("div",{className:"flex justify-between p-3 bg-green-500/10 rounded-lg",children:[o.jsx("span",{className:"text-gray-400",children:"House Profit:"}),o.jsx("span",{className:"text-green-400 font-bold",children:(te==null?void 0:te.total_house_profit)||0})]})]})]})]})]}),o.jsx("div",{className:"max-w-6xl mx-auto mt-8",children:o.jsxs(Fe,{className:"bg-[#1a1a2e] border-purple-500/30 p-6",children:[o.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Recent Bets"}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-sm",children:[o.jsx("thead",{className:"border-b border-purple-500/30",children:o.jsxs("tr",{children:[o.jsx("th",{className:"text-left text-gray-400 py-3 px-4",children:"Date"}),o.jsx("th",{className:"text-left text-gray-400 py-3 px-4",children:"Bet"}),o.jsx("th",{className:"text-left text-gray-400 py-3 px-4",children:"Result"}),o.jsx("th",{className:"text-left text-gray-400 py-3 px-4",children:"Winnings"})]})}),o.jsx("tbody",{children:W.slice(0,10).map((ie,ce)=>o.jsxs("tr",{className:"border-b border-[#0f0f1a] hover:bg-[#0f0f1a]/50",children:[o.jsx("td",{className:"py-3 px-4 text-gray-400",children:new Date(ie.created_date).toLocaleString()}),o.jsx("td",{className:"py-3 px-4 text-white",children:ie.bet_amount}),o.jsx("td",{className:"py-3 px-4",children:o.jsx(wt,{className:ie.result==="win"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400",children:ie.result.toUpperCase()})}),o.jsx("td",{className:`py-3 px-4 font-bold ${ie.result==="win"?"text-green-400":"text-red-400"}`,children:ie.winnings>0?`+${ie.winnings}`:`-${ie.bet_amount}`})]},ce))})]})})]})})]})};function nSe(){const i=vn(),{data:n}=mt({queryKey:["currentUser"],queryFn:ib}),a=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.is_troll_officer)||(n==null?void 0:n.is_admin),{data:l=[],isLoading:u}=mt({queryKey:["liveStreams"],queryFn:async()=>{const{data:O,error:P}=await K.from("streams").select("*").eq("is_live",!0).order("created_date",{ascending:!1}).limit(200);return P?(console.warn("Failed to fetch live streams:",P.message),[]):O||[]},enabled:!!a,refetchInterval:5e3}),[m,y]=M.useState(""),w=Wt({mutationFn:async O=>{const{error:P}=await K.from("streams").update({is_live:!1,status:"ended",ended_date:new Date().toISOString()}).eq("id",O);if(P)throw P},onSuccess:()=>{i.invalidateQueries(["liveStreams"]),pe.success("Stream ended")},onError:O=>pe.error((O==null?void 0:O.message)||"Failed to end stream")}),b=Wt({mutationFn:async({streamId:O,userId:P})=>{const{error:F}=await K.from("streams").update({is_live:!1,status:"kicked",ended_date:new Date().toISOString()}).eq("id",O);if(F)throw F;const{error:z}=await K.from("moderation_actions").insert([{user_id:P,action:"kick",target_type:"stream",target_id:O,moderator_id:(n==null?void 0:n.id)||null,created_date:new Date().toISOString()}]);if(z)throw z},onSuccess:()=>{i.invalidateQueries(["liveStreams"]),pe.success("Streamer kicked")},onError:O=>pe.error((O==null?void 0:O.message)||"Failed to kick streamer")}),x=Wt({mutationFn:async({userId:O,streamId:P})=>{const{error:F}=await K.from("profiles").update({is_banned:!0,ban_reason:"Banned by moderator via live admin",ban_expires:null,banned_by:(n==null?void 0:n.id)||null}).eq("id",O);if(F)throw F;await K.from("moderation_actions").insert([{user_id:O,action:"ban",target_type:"user",target_id:O,moderator_id:(n==null?void 0:n.id)||null,created_date:new Date().toISOString(),notes:`From stream ${P}`}])},onSuccess:()=>{i.invalidateQueries(["adminAllUsers","liveStreams"]),pe.success("User banned")},onError:O=>pe.error((O==null?void 0:O.message)||"Failed to ban user")}),T=Wt({mutationFn:async({userId:O})=>{const{error:P}=await K.from("profiles").update({is_muted:!0}).eq("id",O);if(P)throw P;await K.from("moderation_actions").insert([{user_id:O,action:"mute",target_type:"user",target_id:O,moderator_id:(n==null?void 0:n.id)||null,created_date:new Date().toISOString()}])},onSuccess:()=>{i.invalidateQueries(["adminAllUsers"]),pe.success("User muted")},onError:O=>pe.error((O==null?void 0:O.message)||"Failed to mute user")});if(!a)return o.jsx("main",{className:"min-h-screen p-6",children:o.jsx(Fe,{className:"p-6 bg-[#0b0b10]",children:"You do not have access to the Officer Command Center."})});const N=(l||[]).filter(O=>{if(!m)return!0;const P=m.toLowerCase();return(O.title||"").toLowerCase().includes(P)||(O.broadcaster_name||"").toLowerCase().includes(P)||String(O.broadcaster_id||"").toLowerCase().includes(P)});return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#09090d] to-[#07060a] py-8 px-4",children:o.jsxs("div",{className:"max-w-6xl mx-auto",children:[o.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Officer Command Center  Live Streams"}),o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx(Zt,{value:m,onChange:O=>y(O.target.value),placeholder:"Search streams or broadcaster...",className:"w-96 bg-[#0a0a0f] text-white"}),o.jsx(ke,{onClick:()=>i.invalidateQueries(["liveStreams"]),children:"Refresh"})]}),o.jsx("div",{className:"space-y-3",children:N.length===0?o.jsx(Fe,{className:"p-6 bg-[#0b0b10]",children:"No live streams found."}):N.map(O=>o.jsxs(Fe,{className:"p-4 bg-[#0b0b10] flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"text-white font-bold",children:O.title||`Stream ${O.id}`}),o.jsxs("div",{className:"text-sm text-gray-400",children:["by ",O.broadcaster_name||O.broadcaster_id]})]}),o.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Viewers: ",O.viewer_count||0,"  Started: ",O.created_date?new Date(O.created_date).toLocaleString():"unknown"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ke,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:()=>w.mutate(O.id),disabled:w.isLoading,children:"End"}),o.jsx(ke,{size:"sm",className:"bg-yellow-600 hover:bg-yellow-700",onClick:()=>b.mutate({streamId:O.id,userId:O.broadcaster_id}),disabled:b.isLoading,children:"Kick"}),o.jsx(ke,{size:"sm",className:"bg-purple-600 hover:bg-purple-700",onClick:()=>T.mutate({userId:O.broadcaster_id}),disabled:T.isLoading,children:"Mute"}),o.jsx(ke,{size:"sm",className:"bg-black text-white border border-red-500",onClick:()=>{confirm("Ban this user? This will disable their account.")&&x.mutate({userId:O.broadcaster_id,streamId:O.id})},disabled:x.isLoading,children:"Ban"})]})]},O.id))})]})})}function sSe(){const[i,n]=M.useState(""),[a,l]=M.useState("gpt-5-nano"),[u,m]=M.useState(null),[y,w]=M.useState(!1);vn();const b=async()=>{w(!0),m(null);try{m({error:"OpenAI API not configured. Please add OPENAI_API_KEY to Supabase secrets or contact support."})}catch(x){m({error:(x==null?void 0:x.message)||String(x)})}w(!1)};return o.jsx("main",{className:"min-h-screen p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Admin AI Console"}),o.jsx(Fe,{className:"p-4 mb-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx(Zt,{value:a,onChange:x=>l(x.target.value),placeholder:"Model (e.g. gpt-5-nano)"}),o.jsx(Nl,{value:i,onChange:x=>n(x.target.value),placeholder:"Enter prompt or command",rows:6}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ke,{onClick:b,disabled:y||!i,className:"bg-emerald-600",children:y?"Running...":"Run"}),o.jsx(ke,{onClick:()=>{n(""),m(null)},className:"bg-gray-600",children:"Clear"})]})]})}),o.jsxs(Fe,{className:"p-4",children:[o.jsx("h2",{className:"font-semibold text-white mb-2",children:"Result"}),o.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-200 bg-[#0b0b10] rounded p-3",children:u?JSON.stringify(u,null,2):"No result yet"})]})]})})}function iSe(){const i=Wn(),n=Pc(),l=new URLSearchParams(n.search).get("reason"),m=(()=>{switch(l){case"kicked":return{title:"You Have Been Kicked",message:"You have been kicked by an admin. You need to pay the kick fee to regain access.",icon:o.jsx(jH,{className:"w-8 h-8 text-orange-400"}),buttonText:"Pay Kick Fee"};case"banned":return{title:"You Have Been Banned",message:"You have been banned by an admin. You need to pay the ban fee to regain access.",icon:o.jsx(xi,{className:"w-8 h-8 text-red-400"}),buttonText:"Pay Ban Fee"};default:return{title:"Access Restricted",message:"Your account is currently restricted. If you were banned or kicked, your access is limited.",icon:o.jsx(xi,{className:"w-8 h-8 text-red-400"}),buttonText:"Pay Kick/Ban Fee"}}})();return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] flex items-center justify-center px-6",children:o.jsx("div",{className:"max-w-lg w-full",children:o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6 rounded-2xl text-center",children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[m.icon,o.jsx("h1",{className:"text-2xl font-bold text-white",children:m.title})]}),o.jsx("p",{className:"text-sm text-gray-400 mb-3",children:m.message}),o.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3 flex items-center gap-2 text-left mb-4",children:[o.jsx(fp,{className:"w-4 h-4 text-red-400"}),o.jsx("span",{className:"text-red-300 text-sm",children:"Please contact support or an admin if you believe this is a mistake."})]}),o.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[o.jsx(ke,{onClick:()=>i(Or("KickBanFee")),className:"bg-emerald-600 hover:bg-emerald-700",children:m.buttonText}),o.jsx(ke,{onClick:()=>K.auth.signOut(),className:"bg-red-600 hover:bg-red-700",children:"Logout"}),o.jsx(ke,{onClick:()=>K.auth.redirectToLogin(),variant:"outline",className:"border-[#2a2a3a] text-gray-300",children:"Sign In"})]})]})})})}function s9(){const i=Wn(),n=vn(),[a,l]=M.useState("kick_fee"),[u,m]=M.useState(5),[y,w]=M.useState(null),[b,x]=M.useState(!1),[T,N]=M.useState(null),[O,P]=M.useState(null),[F,z]=M.useState(null),[V,W]=M.useState(!1),{data:te}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:{user:G}}=await K.auth.getUser();if(!G)return null;const{data:se}=await K.from("profiles").select("*").eq("id",G.id).single();return se}}),{data:$}=mt({queryKey:["moderationSettingsForFees"],queryFn:async()=>{const{data:G,error:se}=await K.from("moderation_settings").select("*").eq("setting_key","global_moderation").limit(1);return se?[]:G||[]},staleTime:6e4});M.useEffect(()=>{const G=$==null?void 0:$[0];G&&typeof G=="object"&&(a==="kick_fee"?m(5):a==="do_not_kick_fee"?m(10):typeof G.ban_fee_usd=="number"&&G.ban_fee_usd>0&&a==="ban_fee"&&m(G.ban_fee_usd))},[$,a]),M.useEffect(()=>{let G=!1;async function se(){try{N(null),x(!1);const ie=await BR(),ce=ie==null?void 0:ie.square_application_id,Se=ie==null?void 0:ie.square_location_id;if(!ce||!Se||!(ie!=null&&ie.square_account_active)){N("Square is not configured by admin");return}window.Square||await new Promise((he,Ze)=>{const Qe=document.createElement("script");Qe.src="https://web.squarecdn.com/v1/square.js",Qe.async=!0,Qe.onload=he,Qe.onerror=()=>Ze(new Error("Failed to load Square SDK")),document.head.appendChild(Qe)});const oe=window.Square.payments(ce,Se);if(G)return;P(oe);const ve=await oe.card();if(await ve.attach("#kickban-square-card"),G){try{ve.destroy&&ve.destroy()}catch{}return}z(ve),x(!0)}catch(ie){N((ie==null?void 0:ie.message)||String(ie))}}return se(),()=>{G=!0;try{F&&F.destroy&&F.destroy()}catch{}z(null),P(null),x(!1)}},[]),Wt({mutationFn:async()=>{throw te!=null&&te.id?(new Date().toISOString(),new Error("This flow has moved to Square payments")):new Error("Not authenticated")},onSuccess:()=>{n.invalidateQueries(["manualPaymentRequests"]),pe.success("Fee submitted  awaiting admin review"),i(Or("PaymentRequired"))},onError:G=>pe.error((G==null?void 0:G.message)||"Failed to submit fee")});const Q=Wt({mutationFn:async()=>{if(!(te!=null&&te.id))throw new Error("Not authenticated");if(!F)throw new Error("Square card is not ready");const G=await F.tokenize();if(G.status!=="OK"||!G.token){const he=(G.errors||[]).map(Ze=>Ze.message).join(", ");throw new Error(he||"Failed to tokenize card")}const se=G.token,ie=Math.round(Number(u||0)*100);let ce="Kick Fee Payment",Se="kick_fee_paid";a==="ban_fee"?(ce="Ban Appeal Fee Payment",Se="ban_fee_paid"):a==="do_not_kick_fee"&&(ce="Do Not Kick Protection Fee",Se="do_not_kick_paid");const oe=await GD({amount:ie,currency:"USD",sourceId:se,description:ce,userId:te.id,metadata:{idempotency_key:`${te.id}-${Date.now()}-${ie}`,fee_type:a}});if(!(oe!=null&&oe.success))throw new Error("Square payment failed");const ve=new Date().toISOString();if(a==="do_not_kick_fee"&&u>=10){const he=Math.floor(u*.5*100),Ze=ie-he;try{await K.from("coin_transactions").insert({user_id:te.id,amount:he,transaction_type:"do_not_kick_admin_share",reference_id:oe.paymentId||oe.transactionId||"n/a",description:"Admin share of Do Not Kick protection fee",created_at:ve}),y&&await K.from("coin_transactions").insert({user_id:y,amount:Ze,transaction_type:"do_not_kick_broadcaster_share",reference_id:oe.paymentId||oe.transactionId||"n/a",description:"Broadcaster share of Do Not Kick protection fee",created_at:ve})}catch(Qe){console.error("Error recording split transactions:",Qe)}}try{await K.from("moderation_actions").insert({user_id:te.id,action:Se,target_type:"user",target_id:te.id,created_date:ve,notes:`Paid $${Number(u).toFixed(2)} via Square; paymentId=${oe.paymentId||oe.transactionId||"n/a"}`})}catch{}try{await K.from("notifications").insert({user_id:null,type:"admin_payment_review",title:"Kick/Ban Fee Paid",message:`User ${te.username||te.email} paid ${a} for $${Number(u).toFixed(2)} via Square`,is_read:!1,created_date:ve})}catch{}return oe},onSuccess:async()=>{pe.success("Payment successful  admin will review shortly"),W(!1),await Promise.all([n.invalidateQueries(["currentUser"]),n.invalidateQueries(["moderationQueue"])]),i(Or("PaymentRequired"))},onError:G=>{W(!1),pe.error((G==null?void 0:G.message)||"Failed to process payment")}});return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] via-[#1a0a1f] to-[#0a0a0f] py-10 px-4",children:o.jsxs("div",{className:"max-w-xl mx-auto",children:[o.jsxs(Fe,{className:"bg-[#1a1a24] border-[#2a2a3a] p-6 rounded-2xl",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx(xi,{className:"w-6 h-6 text-red-400"}),o.jsx("h1",{className:"text-xl font-bold text-white",children:"Kick/Ban Fee Payment"})]}),o.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Pay the required fee to restore access. Payments are processed securely via Square and reviewed by admins."}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-gray-300 mb-2 block",children:"Fee Type"}),o.jsxs("div",{className:"flex gap-2 flex-wrap",children:[o.jsx(ke,{type:"button",variant:a==="kick_fee"?"default":"outline",onClick:()=>l("kick_fee"),children:"Kick Unblock Fee"}),o.jsx(ke,{type:"button",variant:a==="do_not_kick_fee"?"default":"outline",onClick:()=>l("do_not_kick_fee"),children:"Do Not Kick Protection"}),o.jsx(ke,{type:"button",variant:a==="ban_fee"?"default":"outline",onClick:()=>l("ban_fee"),children:"Ban Appeal Fee"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-gray-300 mb-2 block",children:"Amount (USD)"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Es,{className:"w-4 h-4 text-yellow-400"}),o.jsx(Zt,{type:"number",value:u,onChange:G=>m(Number(G.target.value||0)),className:"bg-[#0f0f16] border-[#2a2a3a] text-white"})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a==="kick_fee"&&"Kick fee defaults to $5.",a==="do_not_kick_fee"&&"Do Not Kick protection fee is $10 (50% goes to broadcaster).",a==="ban_fee"&&"Ban fee uses admin setting."]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm text-gray-300 mb-2 block",children:"Card Payment"}),o.jsxs("div",{className:"p-3 bg-[#0f0f16] border border-[#2a2a3a] rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(_y,{className:"w-4 h-4 text-blue-400"}),o.jsx("span",{className:"text-xs text-gray-400",children:"Powered by Square Web Payments SDK"})]}),T?o.jsx("div",{className:"text-red-400 text-sm",children:T}):o.jsx("div",{id:"kickban-square-card",className:"min-h-[48px]"})]})]}),o.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 flex items-center gap-2",children:[o.jsx(fp,{className:"w-4 h-4 text-yellow-400"}),o.jsx("span",{className:"text-yellow-200 text-xs",children:"Submissions are reviewed within 13 business days."})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(ke,{type:"button",onClick:()=>{W(!0),Q.mutate()},disabled:!b||Q.isPending||V,className:"bg-emerald-600 hover:bg-emerald-700 flex-1",children:V||Q.isPending?o.jsxs(o.Fragment,{children:[o.jsx(yy,{className:"w-4 h-4 mr-2 animate-spin"}),"Processing..."]}):o.jsx(o.Fragment,{children:"Pay with Square"})}),o.jsx(ke,{type:"button",variant:"outline",onClick:()=>i(Or("PaymentRequired")),className:"flex-1",children:"Back"})]})]})]}),o.jsx("div",{className:"mt-4 text-center",children:o.jsx(wt,{className:"bg-purple-600",children:"Admin Review"})})]})})}function aSe(){const{data:i}=mt({queryKey:["currentUser"],queryFn:()=>K.auth.me(),staleTime:5e3}),[n,a]=M.useState([]),[l,u]=M.useState(null),[m,y]=M.useState(""),[w,b]=M.useState([]);M.useEffect(()=>{(async()=>{try{const{data:N}=await K.from("troll_families").select("*").order("created_date",{ascending:!1});a(N||[])}catch{}})()},[]),M.useEffect(()=>{if(!l)return;const T=l.id;(async()=>{try{const{data:O}=await K.from("messages").select("*").eq("room",`family_${T}`).order("created_date",{ascending:!1}).limit(200);b(O||[])}catch{}})();try{const O=K.channel(`family_room_${T}`);return O.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`room=eq.family_${T}`},P=>{const F=(P==null?void 0:P.new)||null;F&&b(z=>[F,...z].slice(0,200))}).subscribe(),()=>{try{O.unsubscribe()}catch{}}}catch{}},[l]);const x=async()=>{if(!l||!m.trim())return;const T={room:`family_${l.id}`,text:m,user_id:(i==null?void 0:i.id)||null,created_date:new Date().toISOString()},{error:N}=await K.from("messages").insert(T);N||y("")};return o.jsx("main",{className:"min-h-screen bg-gradient-to-br from-[#06060a] to-[#0b0b12] p-6",children:o.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsx("h3",{className:"text-white font-semibold mb-3",children:"Troll Families"}),o.jsx("div",{className:"space-y-2",children:n.map(T=>o.jsx("button",{type:"button",className:`w-full text-left px-3 py-2 rounded ${(l==null?void 0:l.id)===T.id?"bg-purple-600/20 border border-purple-600/40":"bg-[#0a0a0f]"}`,onClick:()=>u(T),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-white font-semibold",children:T.name}),o.jsx(wt,{className:"bg-yellow-500",children:T.color||"purple"})]})},T.id))})]}),o.jsx(Fe,{className:"lg:col-span-2 p-6 bg-[#11121a] border-[#2a2a3a]",children:l?o.jsxs(o.Fragment,{children:[o.jsxs("h3",{className:"text-white font-semibold mb-3",children:["Family Chat  ",l.name]}),o.jsx("div",{className:"h-[60vh] overflow-y-auto space-y-3 pr-2",children:w.map(T=>o.jsxs("div",{className:"bg-[#0a0a0f] rounded p-3",children:[o.jsx("div",{className:"text-white text-sm",children:T.text}),o.jsx("div",{className:"text-xs text-gray-500 mt-1",children:T.created_date?new Date(T.created_date).toLocaleString():""})]},T.id||T.created_date))}),o.jsxs("div",{className:"flex gap-2 mt-4",children:[o.jsx(Zt,{value:m,onChange:T=>y(T.target.value),placeholder:"Say something to your family",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"}),o.jsx(ke,{onClick:x,className:"bg-purple-600 hover:bg-purple-700",children:"Send"})]})]}):o.jsx("p",{className:"text-gray-400",children:"Select a family to chat and send gifts."})})]})})}function i9(){var ie,ce,Se;const i=vn(),n=Wn(),[a,l]=M.useState("chat"),[u,m]=M.useState(""),[y,w]=M.useState(""),[b,x]=M.useState(null),{data:T,isLoading:N}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:{user:oe}}=await K.auth.getUser();return oe}}),O=((ie=T==null?void 0:T.user_metadata)==null?void 0:ie.troll_family_name)||(T==null?void 0:T.troll_family_name)||(T==null?void 0:T.role)==="admin"||((ce=T==null?void 0:T.user_metadata)==null?void 0:ce.role)==="admin";if(N)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] to-[#1a1a2e] p-6",children:o.jsx("div",{className:"max-w-4xl mx-auto",children:o.jsxs(Fe,{className:"p-8 bg-[#11121a] border-[#2a2a3a] text-center",children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 animate-pulse bg-gray-600 rounded-full"}),o.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Checking Permissions..."}),o.jsx("p",{className:"text-gray-400",children:"Please wait while we verify your access."})]})})});const{data:P=[],isLoading:F,error:z}=mt({queryKey:["trollFamilyMembers"],queryFn:async()=>{try{const{data:oe,error:ve}=await K.from("profiles").select("id, username, full_name, avatar_url, level, coins, created_at, troll_family_name").not("troll_family_name","is",null).order("created_at",{ascending:!0});if(ve)throw console.error("Error fetching family members:",ve),ve;return oe||[]}catch(oe){return console.error("Failed to fetch family members:",oe),pe.error("Failed to load family data"),[]}},enabled:O}),{data:V=[],isLoading:W}=mt({queryKey:["familyChatMessages"],queryFn:async()=>{try{const{data:oe,error:ve}=await K.from("family_chats").select(`
            *,
            profiles(id, username, full_name, avatar_url, level, troll_family_name)
          `).order("created_at",{ascending:!1}).limit(100);return ve?(console.warn("Family chats table not found, using fallback chat system:",ve),[]):oe||[]}catch(oe){return console.warn("Failed to fetch family chat messages, using fallback:",oe),[]}},enabled:O}),{data:te=[]}=mt({queryKey:["familyAnnouncements"],queryFn:async()=>{try{const{data:oe,error:ve}=await K.from("admin_content").select("*").eq("page_name","family_announcements").eq("is_active",!0).order("created_at",{ascending:!1});if(ve)throw console.error("Error fetching announcements:",ve),ve;return oe||[]}catch(oe){return console.error("Failed to fetch announcements:",oe),pe.error("Failed to load announcements"),[]}},enabled:O}),$=Wt({mutationFn:async oe=>{const{error:ve}=await K.from("family_chats").insert({member_id:T.id,message:oe});if(ve)throw ve},onSuccess:()=>{i.invalidateQueries(["familyChatMessages"]),pe.success("Message sent!")},onError:oe=>{pe.error("Failed to send message: "+oe.message)}}),Q=Wt({mutationFn:async oe=>{const{error:ve}=await K.from("admin_content").insert({page_name:"family_announcements",field_name:"announcement",content:oe,updated_by:T.id});if(ve)throw ve},onSuccess:()=>{i.invalidateQueries(["familyAnnouncements"]),pe.success("Announcement sent!")},onError:oe=>{pe.error("Failed to send announcement: "+oe.message)}});M.useEffect(()=>{if(!O)return;const oe=K.channel("family_chat_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"family_chats"},ve=>{i.invalidateQueries(["familyChatMessages"])}).subscribe();return()=>{K.removeChannel(oe)}},[O,i]);const G=oe=>{oe.preventDefault(),u.trim()&&($.mutate(u),m(""))},se=oe=>{oe.preventDefault(),y.trim()&&(Q.mutate(y),w(""))};return O?o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] to-[#1a1a2e] p-6",children:o.jsxs("div",{className:"max-w-7xl mx-auto",children:[o.jsx("div",{className:"mb-8",children:o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center space-x-4",children:[o.jsx("div",{className:"p-3 bg-gradient-to-r from-pink-600 to-purple-600 rounded-full",children:o.jsx(Ru,{className:"w-8 h-8 text-white"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-3xl font-bold text-white",children:"T Fam"}),o.jsx("p",{className:"text-gray-300",children:"Exclusive area for Troll Family members"})]})]}),o.jsx("div",{className:"flex items-center space-x-2",children:o.jsxs(wt,{className:"bg-gradient-to-r from-pink-600 to-purple-600 text-white",children:[o.jsx(Ow,{className:"w-4 h-4 mr-1"}),"Family Status"]})})]})}),o.jsxs(db,{value:a,onValueChange:l,className:"space-y-6",children:[o.jsxs(ub,{className:"bg-[#11121a] border-[#2a2a3a] p-1",children:[o.jsxs(es,{value:"chat",className:"data-[state=active]:bg-pink-600",children:[o.jsx(mp,{className:"w-4 h-4 mr-2"}),"Family Chat"]}),o.jsxs(es,{value:"roster",className:"data-[state=active]:bg-pink-600",children:[o.jsx(jn,{className:"w-4 h-4 mr-2"}),"Family Roster"]}),o.jsxs(es,{value:"announcements",className:"data-[state=active]:bg-pink-600",children:[o.jsx(dk,{className:"w-4 h-4 mr-2"}),"Announcements"]}),o.jsxs(es,{value:"tools",className:"data-[state=active]:bg-pink-600",children:[o.jsx(My,{className:"w-4 h-4 mr-2"}),"Family Tools"]})]}),o.jsx(Gs,{value:"chat",className:"space-y-4",children:o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[o.jsx(mp,{className:"w-5 h-5 mr-2"}),"Family Chat"]}),o.jsx("div",{className:"h-96 overflow-y-auto mb-4 space-y-3 p-4 bg-[#0a0a0f] rounded-lg border border-[#2a2a3a]",children:W?o.jsx("div",{className:"text-center text-gray-400 py-8",children:"Loading messages..."}):V.length===0?o.jsx("div",{className:"text-center text-gray-400 py-8",children:"No messages yet. Start the conversation!"}):V.map(oe=>{var ve,he,Ze,Qe,me,ye,ge,Ee,Oe;return o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-pink-600 to-purple-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white text-sm font-bold",children:((he=(ve=oe.profiles)==null?void 0:ve.full_name)==null?void 0:he.charAt(0))||((Qe=(Ze=oe.profiles)==null?void 0:Ze.username)==null?void 0:Qe.charAt(0))||"?"})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[o.jsx(tD,{username:((me=oe.profiles)==null?void 0:me.username)||"Unknown",userId:(ye=oe.profiles)==null?void 0:ye.id,children:o.jsx("span",{className:"font-semibold text-white text-sm hover:text-blue-400 cursor-pointer transition-colors",children:((ge=oe.profiles)==null?void 0:ge.full_name)||((Ee=oe.profiles)==null?void 0:Ee.username)||"Unknown"})}),o.jsx(wt,{className:"bg-pink-500 text-white text-xs",children:((Oe=oe.profiles)==null?void 0:Oe.troll_family_name)||"Family"}),o.jsx("span",{className:"text-xs text-gray-400",children:new Date(oe.created_at).toLocaleTimeString()})]}),o.jsx("p",{className:"text-gray-200 text-sm",children:oe.message})]})]},oe.id)})}),o.jsx("form",{onSubmit:G,className:"space-y-3",children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(Zt,{value:u,onChange:oe=>m(oe.target.value),placeholder:"Type your message...",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"}),o.jsx(ke,{type:"submit",className:"bg-pink-600 hover:bg-pink-700",children:o.jsx(Iw,{className:"w-4 h-4"})})]})})]})}),o.jsx(Gs,{value:"roster",className:"space-y-4",children:o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[o.jsx(jn,{className:"w-5 h-5 mr-2"}),"Family Roster (",P.length," members)"]}),F?o.jsx("div",{className:"text-center text-gray-400 py-8",children:"Loading family members..."}):P.length===0?o.jsx("div",{className:"text-center text-gray-400 py-8",children:"No family members found"}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(oe=>{var ve,he;return o.jsx(Fe,{className:"p-4 bg-[#0a0a0f] border-[#2a2a3a] hover:border-pink-500 transition-colors",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-pink-600 to-purple-600 rounded-full flex items-center justify-center",children:o.jsx("span",{className:"text-white font-bold",children:((ve=oe.full_name)==null?void 0:ve.charAt(0))||((he=oe.username)==null?void 0:he.charAt(0))||"?"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"font-semibold text-white",children:oe.full_name||oe.username}),o.jsx(tD,{username:oe.username,userId:oe.id,children:o.jsxs("p",{className:"text-sm text-gray-400 hover:text-blue-400 cursor-pointer transition-colors",children:["@",oe.username]})}),o.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[o.jsxs(wt,{className:"bg-purple-500 text-white text-xs",children:["Level ",oe.level]}),o.jsx(wt,{className:"bg-pink-500 text-white text-xs",children:oe.troll_family_name})]})]})]})},oe.id)})})]})}),o.jsx(Gs,{value:"announcements",className:"space-y-4",children:o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[o.jsx(dk,{className:"w-5 h-5 mr-2"}),"Family Announcements"]}),((T==null?void 0:T.role)==="admin"||((Se=T==null?void 0:T.user_metadata)==null?void 0:Se.role)==="admin")&&o.jsx("form",{onSubmit:se,className:"mb-6 space-y-3",children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx(Zt,{value:y,onChange:oe=>w(oe.target.value),placeholder:"Post a family announcement...",className:"bg-[#0a0a0f] border-[#2a2a3a] text-white"}),o.jsx(ke,{type:"submit",className:"bg-pink-600 hover:bg-pink-700",children:o.jsx(Iw,{className:"w-4 h-4"})})]})}),te.length===0?o.jsx("div",{className:"text-center text-gray-400 py-8",children:"No announcements yet"}):o.jsx("div",{className:"space-y-4",children:te.map(oe=>o.jsx(Fe,{className:"p-4 bg-[#0a0a0f] border-[#2a2a3a]",children:o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-pink-600 to-purple-600 rounded-full flex items-center justify-center",children:o.jsx(dk,{className:"w-4 h-4 text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-gray-200",children:oe.content}),o.jsx("p",{className:"text-xs text-gray-400 mt-2",children:new Date(oe.created_at).toLocaleString()})]})]})},oe.id))})]})}),o.jsx(Gs,{value:"tools",className:"space-y-4",children:o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[o.jsx(My,{className:"w-5 h-5 mr-2"}),"Family Tools"]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs(Fe,{className:"p-4 bg-[#0a0a0f] border-[#2a2a3a]",children:[o.jsx("h3",{className:"font-semibold text-white mb-2",children:"Family Statistics"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-400",children:"Total Members:"}),o.jsx("span",{className:"text-white",children:P.length})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-400",children:"Average Level:"}),o.jsx("span",{className:"text-white",children:P.length>0?Math.round(P.reduce((oe,ve)=>oe+(ve.level||0),0)/P.length):0})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-400",children:"Total Coins:"}),o.jsx("span",{className:"text-white",children:P.reduce((oe,ve)=>oe+(ve.coins||0),0).toLocaleString()})]})]})]}),o.jsxs(Fe,{className:"p-4 bg-[#0a0a0f] border-[#2a2a3a]",children:[o.jsx("h3",{className:"font-semibold text-white mb-2",children:"Quick Actions"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(ke,{onClick:()=>n("/TrollFamilyApplication"),className:"w-full bg-pink-600 hover:bg-pink-700 text-sm",children:"Invite to Family"}),o.jsx(ke,{onClick:()=>n("/FamilyPayouts"),className:"w-full bg-purple-600 hover:bg-purple-700 text-sm",children:"Family Payouts"})]})]})]})]})})]})]})}):o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] to-[#1a1a2e] p-6",children:o.jsx("div",{className:"max-w-4xl mx-auto",children:o.jsxs(Fe,{className:"p-8 bg-[#11121a] border-[#2a2a3a] text-center",children:[o.jsx(IH,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),o.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Access Denied"}),o.jsx("p",{className:"text-gray-300 mb-6",children:"This area is restricted to Troll Family members only."}),o.jsx(ke,{onClick:()=>n("/"),className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:"Return to Home"})]})})})}function a9(){return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] to-[#1a1a2e] p-6",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:o.jsx(xi,{className:"w-8 h-8 text-white"})}),o.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Community Rules & Guidelines"}),o.jsx("p",{className:"text-gray-400",children:"Keeping TrollCity safe and fun for everyone"})]}),o.jsxs("div",{className:"grid gap-6",children:[o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(Ly,{className:"w-6 h-6 text-blue-400 mr-3"}),o.jsx("h2",{className:"text-xl font-semibold text-white",children:"Privacy & Safety"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(Mm,{className:"w-5 h-5 text-gray-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Personal Information"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Never share personal information such as your real name, address, phone number, or financial details in public chats or with other users."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(jn,{className:"w-5 h-5 text-gray-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"User Interactions"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Be respectful in all interactions. Harassment, bullying, or any form of abuse will not be tolerated and may result in immediate account suspension."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(xi,{className:"w-5 h-5 text-gray-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Account Security"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Keep your account credentials secure. Do not share your password or login information with anyone. Report suspicious activity immediately."})]})]})]})]}),o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(mp,{className:"w-6 h-6 text-green-400 mr-3"}),o.jsx("h2",{className:"text-xl font-semibold text-white",children:"Content Guidelines"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(Ui,{className:"w-5 h-5 text-green-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Appropriate Content"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Keep all content family-friendly and suitable for a general audience. No explicit, violent, or hateful content is allowed."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(Ic,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Spam & Abuse"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Do not spam, flood chats, or use automated systems to disrupt the community. This includes excessive messaging, repetitive content, or malicious scripts."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(jn,{className:"w-5 h-5 text-gray-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Respectful Communication"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Treat all users with respect regardless of their background, beliefs, or opinions. Constructive criticism is welcome, but personal attacks are not."})]})]})]})]}),o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(jn,{className:"w-6 h-6 text-purple-400 mr-3"}),o.jsx("h2",{className:"text-xl font-semibold text-white",children:"Community Standards"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(Ui,{className:"w-5 h-5 text-green-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Positive Environment"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Contribute to a positive and welcoming environment. Help new users feel welcome and assist others when possible."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(Ic,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Reporting Issues"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Report any violations of these rules or suspicious behavior to moderators or administrators. Do not attempt to handle serious issues yourself."})]})]}),o.jsxs("div",{className:"flex items-start space-x-3",children:[o.jsx(xi,{className:"w-5 h-5 text-gray-400 mt-0.5"}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-medium",children:"Consequences"}),o.jsx("p",{className:"text-gray-300 text-sm",children:"Violations of these rules may result in warnings, temporary suspensions, or permanent bans depending on the severity and frequency of the offense."})]})]})]})]}),o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(Ic,{className:"w-6 h-6 text-red-400 mr-3"}),o.jsx("h2",{className:"text-xl font-semibold text-white",children:"Enforcement & Appeals"})]}),o.jsxs("div",{className:"space-y-4 text-gray-300",children:[o.jsx("p",{className:"text-sm",children:"Our moderation team actively monitors the platform to ensure compliance with these rules. We use a combination of automated systems and human review to identify violations."}),o.jsx("p",{className:"text-sm",children:"If you believe a moderation action was taken in error, you can appeal by contacting our support team. Provide relevant details and context for your appeal."}),o.jsx("p",{className:"text-sm",children:"These rules may be updated periodically. We encourage users to review them regularly to stay informed about any changes."})]})]}),o.jsxs(Fe,{className:"p-6 bg-[#11121a] border-[#2a2a3a]",children:[o.jsxs("div",{className:"flex items-center mb-4",children:[o.jsx(mp,{className:"w-6 h-6 text-blue-400 mr-3"}),o.jsx("h2",{className:"text-xl font-semibold text-white",children:"Contact & Support"})]}),o.jsxs("div",{className:"text-gray-300 space-y-2",children:[o.jsx("p",{className:"text-sm",children:"For questions about these rules or to report violations:"}),o.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",children:[o.jsx("li",{children:"Use the in-app reporting features"}),o.jsx("li",{children:"Contact moderators through official channels"}),o.jsx("li",{children:"Reach out to administrators for serious concerns"})]}),o.jsx("p",{className:"text-sm mt-4",children:"Thank you for helping us maintain a safe and enjoyable community for everyone!"})]})]})]})]})})}const o9=()=>{var on,Sr,js,ts;const i=Wn(),{streamId:n}=ooe(),a=vn(),l=M.useRef(null),u=M.useRef(null),m=M.useRef(null),y=M.useRef(null),[w,b]=M.useState(!0),[x,T]=M.useState(!1),[N,O]=M.useState(!1),[P,F]=M.useState(!0),[z,V]=M.useState(!1),[W,te]=M.useState(""),[$,Q]=M.useState([]),[G,se]=M.useState([]),[ie,ce]=M.useState(0),[Se,oe]=M.useState(0),[ve,he]=M.useState(0),[Ze,Qe]=M.useState(!1),[me,ye]=M.useState("auto"),[ge,Ee]=M.useState(!1),[Oe,we]=M.useState(!1),[fe,De]=M.useState(""),{data:je}=mt({queryKey:["currentUser"],queryFn:async()=>{const{data:{user:_t}}=await K.auth.getUser();if(!_t)return null;const{data:wr}=await K.from("profiles").select("*").eq("id",_t.id).single();return wr},staleTime:3e4}),{data:_e,isLoading:Je}=mt({queryKey:["stream",n],queryFn:async()=>{const{data:_t,error:wr}=await K.from("streams").select(`
          *,
          streamer:profiles!streamer_id(username, full_name, avatar, is_verified)
        `).eq("id",n).eq("status","live").single();if(wr)throw wr;return _t},enabled:!!n,refetchInterval:5e3});M.useEffect(()=>{je&&_e&&Ee(je.id===_e.streamer_id)},[je,_e]);const{data:st}=mt({queryKey:["streamStats",n],queryFn:async()=>{const[{data:_t},{data:wr},{data:Ur}]=await Promise.all([K.from("stream_viewers").select("id",{count:"exact"}).eq("stream_id",n),K.from("stream_likes").select("id",{count:"exact"}).eq("stream_id",n),K.from("stream_gifts").select("coin_value",{count:"exact"}).eq("stream_id",n)]);return{viewerCount:(_t==null?void 0:_t.length)||0,likeCount:(wr==null?void 0:wr.length)||0,totalCoins:(Ur==null?void 0:Ur.reduce((dn,bs)=>dn+(bs.coin_value||0),0))||0}},enabled:!!n&&!!_e,refetchInterval:3e3});M.useEffect(()=>{st&&(ce(st.viewerCount),oe(st.likeCount),he(st.totalCoins))},[st]);const{data:vt}=mt({queryKey:["followStatus",je==null?void 0:je.id,_e==null?void 0:_e.streamer_id],queryFn:async()=>{const{data:_t}=await K.from("follows").select("id").eq("follower_id",je.id).eq("following_id",_e.streamer_id).single();return!!_t},enabled:!!(je!=null&&je.id)&&!!(_e!=null&&_e.streamer_id)});M.useEffect(()=>{Qe(vt||!1)},[vt]);const pt=M.useCallback(async _t=>{var wr;if(!(!n||!(je!=null&&je.id)))try{const Ur=await fetch("/api/track-stream-viewer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(wr=(await K.auth.getSession()).data.session)==null?void 0:wr.access_token}`},body:JSON.stringify({streamId:n,userId:je.id,action:_t})}),dn=await Ur.json();Ur.ok?console.log(`Stream viewer ${_t}:`,dn.message):console.error("Failed to track stream viewer:",dn.error)}catch(Ur){console.error("Error tracking stream viewer:",Ur)}},[n,je==null?void 0:je.id]),er=M.useCallback(async()=>{if(!(!_e||x)){T(!0);try{await pt("join");const _t=await qy(_e.channel_name,(je==null?void 0:je.id)||0);if(!(_t!=null&&_t.token))throw new Error("Failed to get stream token");const wr=QC.createClient({mode:"live",codec:"vp8"});u.current=wr,wr.on("user-published",async(dn,bs)=>{if(await wr.subscribe(dn,bs),bs==="video"){const di=dn.videoTrack,Be=document.createElement("div");Be.id=`remote-${dn.uid}`,Be.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
          `,l.current&&(l.current.appendChild(Be),di.play(Be,{fit:"cover",mirror:!1}))}bs==="audio"&&dn.audioTrack.play()}),wr.on("user-unpublished",(dn,bs)=>{if(bs==="video"){const di=document.getElementById(`remote-${dn.uid}`);di&&di.remove()}}),wr.on("stream-ended",()=>{O(!0),pe.info("Stream has ended")}),await wr.join(_t.appId,_e.channel_name,_t.token,(je==null?void 0:je.id)||0),T(!1),b(!1);const Ur=setInterval(()=>{pt("heartbeat")},15e3);y.current=Ur}catch(_t){console.error("Failed to connect to stream:",_t),pe.error("Failed to connect to stream"),T(!1),b(!1)}}},[_e,je,x]);M.useEffect(()=>{_e&&!x&&er()},[_e,er]),M.useEffect(()=>{N&&setTimeout(()=>{i("/")},3e3)},[N,i]),M.useEffect(()=>()=>{y.current&&(clearInterval(y.current),y.current=null),u.current&&n&&(je!=null&&je.id)&&pt("leave"),u.current&&u.current.leave()},[]);const{data:gt=[]}=mt({queryKey:["chatMessages",n,ge],queryFn:async()=>{const _t=ge?["text","system","broadcaster"]:["text","system"],{data:wr,error:Ur}=await K.from("chat_messages").select(`
          *,
          user:profiles!user_id(username, full_name, avatar, is_verified)
        `).eq("stream_id",n).in("message_type",_t).order("created_date",{ascending:!0}).limit(100);if(Ur)throw Ur;return wr||[]},enabled:!!n,refetchInterval:1e3}),qe=Wt({mutationFn:async _t=>{!je||!_e||await K.from("chat_messages").insert({stream_id:n,user_id:je.id,username:je.username||je.full_name,message:_t.trim(),message_type:"text",created_date:new Date().toISOString()})},onSuccess:()=>{te("")},onError:_t=>{pe.error("Failed to send message")}}),Wr=Wt({mutationFn:async _t=>{!je||!_e||!ge||await K.from("chat_messages").insert({stream_id:n,user_id:je.id,username:je.username||je.full_name,message:_t.trim(),message_type:"broadcaster",created_date:new Date().toISOString()})},onSuccess:()=>{De("")},onError:_t=>{pe.error("Failed to send broadcaster message")}}),en=Wt({mutationFn:async()=>{if(!je||!_e)return;const{data:_t}=await K.from("stream_likes").select("id").eq("user_id",je.id).eq("stream_id",n).single();if(_t)await K.from("stream_likes").delete().eq("id",_t.id);else{await K.from("stream_likes").insert({user_id:je.id,stream_id:n,created_date:new Date().toISOString()});const wr=Date.now();se(Ur=>[...Ur,{id:wr,x:Math.random()*100}]),setTimeout(()=>{se(Ur=>Ur.filter(dn=>dn.id!==wr))},2e3)}}}),Cn=Wt({mutationFn:async()=>{!je||!_e||(Ze?await K.from("follows").delete().eq("follower_id",je.id).eq("following_id",_e.streamer_id):await K.from("follows").insert({follower_id:je.id,following_id:_e.streamer_id,created_at:new Date().toISOString()}),a.invalidateQueries(["followStatus"]))}}),Lr=Wt({mutationFn:async({giftId:_t,giftName:wr,coinValue:Ur})=>{if(!(!je||!_e)){if(je.coins<Ur){pe.error("Insufficient coins");return}await K.rpc("decrement_user_coins",{user_id:je.id,amount:Ur}),await K.from("stream_gifts").insert({sender_id:je.id,recipient_id:_e.streamer_id,stream_id:n,gift_id:_t,gift_name:wr,coin_value:Ur,created_date:new Date().toISOString()}),Q(dn=>[...dn,{id:Date.now(),giftName:wr,senderName:je.username||je.full_name,coinValue:Ur}]),setTimeout(()=>{Q(dn=>dn.filter(bs=>bs.id!==Date.now()))},3e3),pe.success(`Sent ${wr}!`)}}}),Le=_t=>{_t.preventDefault(),W.trim()&&je&&qe.mutate(W)},it=_t=>{_t.preventDefault(),fe.trim()&&je&&ge&&Wr.mutate(fe)},jt=()=>{en.mutate()},xt=()=>{Cn.mutate()},Tr=async()=>{var _t,wr;if(navigator.share)try{await navigator.share({title:`${(_t=_e==null?void 0:_e.streamer)==null?void 0:_t.full_name} is live on TrollCity`,text:`Watch ${(wr=_e==null?void 0:_e.streamer)==null?void 0:wr.full_name}'s live stream`,url:window.location.href})}catch(Ur){console.log("Error sharing:",Ur)}else navigator.clipboard.writeText(window.location.href),pe.success("Link copied to clipboard")},An=()=>{pe.info("Report feature coming soon")},En=()=>{y.current&&(clearInterval(y.current),y.current=null),pt("leave"),u.current&&(u.current.leave(),u.current=null),m.current&&(m.current.stop(),m.current=null),l.current&&(l.current.innerHTML=""),i("/")};return w||Je?o.jsx("div",{className:"h-screen bg-black flex items-center justify-center",children:o.jsxs("div",{className:"text-white text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),o.jsx("p",{className:"text-lg",children:"Loading stream..."})]})}):_e?N?o.jsx("div",{className:"h-screen bg-black flex items-center justify-center",children:o.jsxs("div",{className:"text-white text-center",children:[o.jsx("p",{className:"text-xl mb-4",children:"Stream has ended"}),o.jsx("p",{className:"text-gray-400 mb-4",children:"Redirecting to home..."})]})}):o.jsxs("div",{className:"h-screen bg-black relative overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 z-0",children:o.jsx("div",{ref:l,className:"w-full h-full bg-black relative",children:x&&o.jsxs("div",{className:"text-white text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),o.jsx("p",{children:"Connecting to stream..."})]})})}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-black/20 z-10"}),o.jsx("div",{className:"absolute top-0 left-0 right-0 z-20 p-4",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("button",{onClick:En,className:"bg-red-600/80 hover:bg-red-700 text-white p-2 rounded-full transition-colors",children:o.jsx(Oc,{className:"w-6 h-6"})}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx("button",{onClick:Tr,className:"bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors",children:o.jsx(Rle,{className:"w-5 h-5"})}),o.jsx("button",{onClick:An,className:"bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-colors",children:o.jsx(Kce,{className:"w-5 h-5"})})]})]})}),o.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 z-20 p-4",children:o.jsxs("div",{className:"flex flex-col space-y-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("div",{className:"relative mb-2",children:[o.jsx("img",{src:((on=_e.streamer)==null?void 0:on.avatar)||"/default-avatar.png",alt:(Sr=_e.streamer)==null?void 0:Sr.full_name,className:"w-16 h-16 rounded-full border-2 border-white object-cover"}),((js=_e.streamer)==null?void 0:js.is_verified)&&o.jsx("div",{className:"absolute -bottom-1 -right-1 bg-blue-500 rounded-full p-1",children:o.jsx("span",{className:"text-white text-xs",children:""})})]}),o.jsx("p",{className:"text-white text-sm font-semibold truncate max-w-20",children:(ts=_e.streamer)==null?void 0:ts.full_name}),o.jsx("button",{onClick:xt,className:`mt-2 px-4 py-1 rounded-full text-xs font-semibold transition-colors ${Ze?"bg-gray-600 text-white":"bg-purple-600 hover:bg-purple-700 text-white"}`,children:Ze?"Following":"Follow"})]}),o.jsxs("button",{onClick:jt,className:"bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors group",children:[o.jsx(Ru,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),o.jsx("p",{className:"text-xs mt-1",children:Se})]}),o.jsxs("button",{onClick:()=>F(!P),className:"bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors",children:[o.jsx(Um,{className:"w-6 h-6"}),o.jsx("p",{className:"text-xs mt-1",children:"Chat"})]}),o.jsxs("button",{onClick:()=>V(!z),className:"bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors",children:[o.jsx(jy,{className:"w-6 h-6"}),o.jsx("p",{className:"text-xs mt-1",children:"Gift"})]})]})}),o.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-4",children:[o.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[o.jsx("div",{className:"bg-red-600 px-2 py-1 rounded text-white text-xs font-bold",children:"LIVE"}),o.jsxs("div",{className:"text-white text-sm",children:[ie," viewers"]}),o.jsxs("div",{className:"text-yellow-400 text-sm",children:[" ",ve," coins"]})]}),_e.title&&o.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:_e.title})]}),P&&o.jsxs("div",{className:`absolute bottom-20 right-4 ${ge?"w-[600px]":"w-80"} h-96 bg-black/80 backdrop-blur-sm rounded-lg z-30`,children:[o.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[o.jsx("h3",{className:"text-white font-semibold",children:ge?"Broadcaster Dashboard":"Live Chat"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[ge&&o.jsx("button",{onClick:()=>we(!Oe),className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm transition-colors",children:Oe?"Hide Panel":"Show Panel"}),o.jsx("button",{onClick:()=>F(!1),className:"text-gray-400 hover:text-white",children:o.jsx(Oc,{className:"w-5 h-5"})})]})]}),o.jsxs("div",{className:`flex ${ge&&Oe?"flex-row":"flex-col"} h-[calc(100%-60px)]`,children:[o.jsxs("div",{className:`${ge&&Oe?"w-1/2 border-r border-gray-700":"w-full"} flex flex-col`,children:[o.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:gt.filter(_t=>_t.message_type!=="broadcaster").map(_t=>{var wr,Ur;return o.jsx("div",{className:`flex items-start space-x-2 ${_t.message_type==="system"?"opacity-75":""}`,children:_t.message_type==="system"?o.jsx("div",{className:"flex-1 text-center",children:o.jsx("p",{className:"text-gray-400 text-xs italic",children:_t.message})}):o.jsxs(o.Fragment,{children:[o.jsx("img",{src:((wr=_t.user)==null?void 0:wr.avatar)||"/default-avatar.png",alt:(Ur=_t.user)==null?void 0:Ur.username,className:"w-6 h-6 rounded-full flex-shrink-0"}),o.jsx("div",{className:"flex-1",children:o.jsxs("p",{className:"text-white text-sm",children:[o.jsx("span",{className:"font-semibold",children:_t.username}),o.jsx("span",{className:"ml-2",children:_t.message})]})})]})},_t.id)})}),o.jsx("form",{onSubmit:Le,className:"p-4 border-t border-gray-700",children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("input",{type:"text",value:W,onChange:_t=>te(_t.target.value),placeholder:"Type a message...",className:"flex-1 bg-gray-800 text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500",disabled:!je}),o.jsx("button",{type:"submit",disabled:!W.trim()||!je,className:"bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white p-2 rounded-lg transition-colors",children:o.jsx(Iw,{className:"w-4 h-4"})})]})})]}),ge&&Oe&&o.jsxs("div",{className:"w-1/2 flex flex-col",children:[o.jsx("div",{className:"p-4 border-b border-gray-700",children:o.jsx("h4",{className:"text-white font-semibold text-sm",children:"Broadcaster Messages"})}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[gt.filter(_t=>_t.message_type==="broadcaster").map(_t=>{var wr,Ur;return o.jsxs("div",{className:"flex items-start space-x-2",children:[o.jsx("img",{src:((wr=_t.user)==null?void 0:wr.avatar)||"/default-avatar.png",alt:(Ur=_t.user)==null?void 0:Ur.username,className:"w-6 h-6 rounded-full flex-shrink-0"}),o.jsx("div",{className:"flex-1",children:o.jsxs("p",{className:"text-yellow-400 text-sm",children:[o.jsxs("span",{className:"font-semibold",children:[_t.username," (Broadcaster)"]}),o.jsx("span",{className:"ml-2",children:_t.message})]})})]},_t.id)}),gt.filter(_t=>_t.message_type==="broadcaster").length===0&&o.jsx("p",{className:"text-gray-500 text-xs text-center py-4",children:"No broadcaster messages yet"})]}),o.jsx("form",{onSubmit:it,className:"p-4 border-t border-gray-700",children:o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("input",{type:"text",value:fe,onChange:_t=>De(_t.target.value),placeholder:"Broadcast message...",className:"flex-1 bg-gray-800 text-white px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500"}),o.jsx("button",{type:"submit",disabled:!fe.trim(),className:"bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-600 text-white p-2 rounded-lg transition-colors",children:o.jsx(Iw,{className:"w-4 h-4"})})]})})]})]})]}),z&&o.jsxs("div",{className:"absolute bottom-20 right-4 w-80 bg-black/90 backdrop-blur-sm rounded-lg z-30",children:[o.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center justify-between",children:[o.jsx("h3",{className:"text-white font-semibold",children:"Send Gift"}),o.jsx("button",{onClick:()=>V(!1),className:"text-gray-400 hover:text-white",children:o.jsx(Oc,{className:"w-5 h-5"})})]}),o.jsxs("div",{className:"p-4",children:[o.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:1,name:"Rose",coins:10,emoji:""},{id:2,name:"Heart",coins:50,emoji:""},{id:3,name:"Star",coins:100,emoji:""},{id:4,name:"Crown",coins:500,emoji:""},{id:5,name:"Diamond",coins:1e3,emoji:""},{id:6,name:"Rocket",coins:5e3,emoji:""}].map(_t=>o.jsxs("button",{onClick:()=>Lr.mutate({giftId:_t.id,giftName:_t.name,coinValue:_t.coins}),disabled:!je||je.coins<_t.coins,className:"bg-gray-800 hover:bg-gray-700 disabled:bg-gray-900 disabled:opacity-50 text-white p-3 rounded-lg transition-colors text-center",children:[o.jsx("div",{className:"text-2xl mb-1",children:_t.emoji}),o.jsx("div",{className:"text-xs font-semibold",children:_t.name}),o.jsxs("div",{className:"text-xs text-yellow-400",children:[_t.coins,""]})]},_t.id))}),je&&o.jsx("div",{className:"mt-4 text-center",children:o.jsxs("p",{className:"text-white text-sm",children:["Your coins: ",o.jsx("span",{className:"text-yellow-400 font-semibold",children:je.coins})]})})]})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none z-40",children:$.map(_t=>o.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:o.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-full text-lg font-bold animate-bounce",children:[" ",_t.senderName," sent ",_t.giftName,"! (",_t.coinValue," coins)"]})},_t.id))}),o.jsx("div",{className:"absolute inset-0 pointer-events-none z-40",children:G.map(_t=>o.jsx("div",{className:"absolute bottom-20 animate-ping",style:{left:`${_t.x}%`},children:o.jsx("div",{className:"text-4xl animate-bounce",children:""})},_t.id))})]}):o.jsx("div",{className:"h-screen bg-black flex items-center justify-center",children:o.jsxs("div",{className:"text-white text-center",children:[o.jsx("p",{className:"text-xl mb-4",children:"Stream not found or has ended"}),o.jsx("button",{onClick:()=>i("/"),className:"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors",children:"Go Home"})]})})},_l=[{label:"1 Coin",value:1,color:"#10b981",type:"coins"},{label:"100 Coins",value:100,color:"#3b82f6",type:"coins"},{label:"1,000 Coins",value:1e3,color:"#8b5cf6",type:"coins"},{label:"10,000 Coins",value:1e4,color:"#f59e0b",type:"coins"},{label:"100,000 Coins",value:1e5,color:"#ef4444",type:"coins"},{label:"BANKRUPT",value:0,color:"#dc2626",type:"bankrupt"},{label:"No Kick Day",value:1,color:"#06b6d4",type:"no_kick"},{label:"No Ban Day",value:1,color:"#10b981",type:"no_ban"},{label:"0 Coins",value:0,color:"#6b7280",type:"zero"},{label:"FREE SPIN",value:1,color:"#fbbf24",type:"free_spin"}],pw=500;function c9(){var z;const i=Wn(),[n,a]=M.useState(null),[l,u]=M.useState(!1),[m,y]=M.useState(0),[w,b]=M.useState(null),[x,T]=M.useState([]),N=M.useRef(null);M.useEffect(()=>{(async()=>{try{const{data:{user:W}}=await K.auth.getUser();if(W){const{data:te}=await K.from("profiles").select("id, username, coins, free_coins, purchased_coins").eq("id",W.id).single();a(te)}}catch(W){console.error("Error fetching user:",W)}})()},[]);const O=()=>n&&n.purchased_coins>=pw,P=async()=>{if(!l){if(!O()){pe.error("Insufficient paid coins! You need 500 paid coins to spin.");return}u(!0);try{await Tz(n.id,pw,{reason:"troll_wheel_spin"});const V=Math.floor(Math.random()*_l.length),W=_l[V],te=360/_l.length,Q=1800+(360-(V*te+te/2));y(Q),setTimeout(async()=>{switch(b(W),T(se=>[W,...se.slice(0,9)]),W.type){case"coins":await PP(n.id,W.value,{source:"troll_wheel_prize"}),pe.success(` You won ${W.value.toLocaleString()} coins!`);break;case"bankrupt":pe.error(" BANKRUPT! You lost all your coins!"),await K.from("profiles").update({coins:0,free_coins:0}).eq("id",n.id);break;case"no_kick":pe.success(" No kick protection for 24 hours!");break;case"no_ban":pe.success(" No ban protection for 24 hours!");break;case"zero":pe.info(" You got 0 coins!");break;case"free_spin":pe.success(" FREE SPIN! Spin again for free!"),await PP(n.id,pw,{source:"troll_wheel_free_spin"});break}const{data:G}=await K.from("profiles").select("id, username, coins, free_coins, purchased_coins").eq("id",n.id).single();a(G),u(!1)},3e3)}catch(V){console.error("Error spinning wheel:",V),pe.error("Failed to spin wheel. Please try again."),u(!1)}}},F=(V,W)=>{const te=2*Math.PI/W,$=V*te,Q=(V+1)*te,G=50+40*Math.cos($),se=50+40*Math.sin($),ie=50+40*Math.cos(Q),ce=50+40*Math.sin(Q),Se=te>Math.PI?1:0;return`M 50 50 L ${G} ${se} A 40 40 0 ${Se} 1 ${ie} ${ce} Z`};return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 py-8 px-4",children:o.jsxs("div",{className:"max-w-4xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("h1",{className:"text-5xl font-bold text-white mb-2 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent",children:" Troll Wheel of Trolling "}),o.jsx("p",{className:"text-gray-300 text-lg",children:"Spin the wheel and win amazing prizes!"}),o.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[o.jsxs(wt,{variant:"secondary",className:"bg-yellow-500/20 text-yellow-300 border-yellow-500/30",children:[o.jsx(ni,{className:"w-4 h-4 mr-1"}),"Cost: ",pw," paid coins"]}),o.jsxs(wt,{variant:"secondary",className:"bg-green-500/20 text-green-300 border-green-500/30",children:[o.jsx(ni,{className:"w-4 h-4 mr-1"}),"Paid Coins: ",((z=n==null?void 0:n.purchased_coins)==null?void 0:z.toLocaleString())||0]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsxs(Fe,{className:"bg-black/30 backdrop-blur-sm border-purple-500/30 p-8",children:[o.jsx("div",{className:"relative flex justify-center items-center",children:o.jsxs("div",{className:"relative",children:[o.jsxs("svg",{ref:N,width:"400",height:"400",viewBox:"0 0 100 100",className:"drop-shadow-2xl",style:{transform:`rotate(${m}deg)`,transition:l?"transform 3s cubic-bezier(0.25, 0.1, 0.25, 1)":"none"},children:[_l.map((V,W)=>o.jsxs("g",{children:[o.jsx("path",{d:F(W,_l.length),fill:V.color,stroke:"#000",strokeWidth:"0.5",className:"hover:opacity-80 transition-opacity"}),o.jsx("text",{x:50+25*Math.cos((W+.5)*(2*Math.PI)/_l.length),y:50+25*Math.sin((W+.5)*(2*Math.PI)/_l.length),textAnchor:"middle",dominantBaseline:"middle",className:"fill-white text-xs font-bold",transform:`rotate(${W*(360/_l.length)+360/_l.length/2}, ${50+25*Math.cos((W+.5)*(2*Math.PI)/_l.length)}, ${50+25*Math.sin((W+.5)*(2*Math.PI)/_l.length)})`,children:V.label})]},W)),o.jsx("circle",{cx:"50",cy:"50",r:"8",fill:"#1a1a1a",stroke:"#fff",strokeWidth:"1"})]}),o.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2",children:o.jsx("div",{className:"w-0 h-0 border-l-4 border-r-4 border-b-8 border-l-transparent border-r-transparent border-b-red-500"})})]})}),o.jsxs("div",{className:"text-center mt-8",children:[o.jsx(ke,{onClick:P,disabled:l||!O(),className:"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-4 px-8 text-xl rounded-full shadow-lg transform hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:l?o.jsxs(o.Fragment,{children:[o.jsx(wle,{className:"w-6 h-6 mr-2 animate-spin inline"}),"Spinning..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Pw,{className:"w-6 h-6 mr-2 inline"}),"SPIN THE WHEEL!"]})}),!O()&&o.jsxs("p",{className:"text-red-400 mt-2 text-sm",children:["You need ",pw," paid coins to spin.",o.jsx(ke,{variant:"link",onClick:()=>i(Or("Store")),className:"text-yellow-400 hover:text-yellow-300 p-0 h-auto",children:"Buy coins"})]})]})]})}),o.jsxs("div",{className:"space-y-6",children:[w&&o.jsxs(Fe,{className:"bg-black/30 backdrop-blur-sm border-green-500/30 p-6",children:[o.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center",children:[o.jsx(PH,{className:"w-5 h-5 mr-2 text-yellow-400"}),"Last Result"]}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl font-bold mb-2",style:{color:w.color},children:w.label}),o.jsx(wt,{className:`${w.type==="coins"?"bg-green-500/20 text-green-300":w.type==="bankrupt"?"bg-red-500/20 text-red-300":w.type==="free_spin"?"bg-yellow-500/20 text-yellow-300":"bg-blue-500/20 text-blue-300"} border-0`,children:w.type==="coins"?" Coins Won":w.type==="bankrupt"?" Bankrupt":w.type==="free_spin"?" Free Spin":" Protection"})]})]}),o.jsxs(Fe,{className:"bg-black/30 backdrop-blur-sm border-purple-500/30 p-6",children:[o.jsx("h3",{className:"text-white font-bold mb-4",children:"Spin History"}),x.length>0?o.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:x.map((V,W)=>o.jsxs("div",{className:"flex items-center justify-between p-2 bg-black/20 rounded",children:[o.jsx("span",{className:"text-white text-sm",children:V.label}),o.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:V.color}})]},W))}):o.jsx("p",{className:"text-gray-400 text-sm",children:"No spins yet. Start spinning!"})]}),o.jsxs(Fe,{className:"bg-black/30 backdrop-blur-sm border-blue-500/30 p-6",children:[o.jsx("h3",{className:"text-white font-bold mb-4",children:"Prize Info"}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:" Coin Prizes:"}),o.jsx("span",{className:"text-green-400",children:"1 - 100,000"})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:" Bankrupt:"}),o.jsx("span",{className:"text-red-400",children:"Lose all coins"})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:" Protection:"}),o.jsx("span",{className:"text-blue-400",children:"24h safety"})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-gray-300",children:" Free Spin:"}),o.jsx("span",{className:"text-yellow-400",children:"Refund cost"})]})]})]})]})]})]})})}const fw=300*1e3,sm=500;function l9(){Wn();const[i,n]=M.useState(null),[a,l]=M.useState(!1),[u,m]=M.useState(null),[y,w]=M.useState([]),[b,x]=M.useState({pass:0,kick:0}),[T,N]=M.useState(!1),[O,P]=M.useState(fw),[F,z]=M.useState(null),[V,W]=M.useState(!1),[te,$]=M.useState(0),Q=M.useRef(null);M.useEffect(()=>{G(),se(),ie(),ce();const we=K.channel("troll-live-show").on("postgres_changes",{event:"*",schema:"public",table:"troll_live_show"},je=>{oe(je.new)}).subscribe(),fe=K.channel("troll-live-waitlist").on("postgres_changes",{event:"*",schema:"public",table:"troll_live_show_waitlist"},je=>{ie()}).subscribe(),De=K.channel("troll-live-votes").on("postgres_changes",{event:"*",schema:"public",table:"troll_live_show_votes"},je=>{ce()}).subscribe();return()=>{Q.current&&clearInterval(Q.current),K.removeChannel(we),K.removeChannel(fe),K.removeChannel(De)}},[]),M.useEffect(()=>{if(a&&F)return Q.current=setInterval(()=>{const fe=Date.now()-new Date(F).getTime(),De=Math.max(0,fw-fe);P(De),De===0&&ve()},1e3),()=>{Q.current&&clearInterval(Q.current)}},[a,F]);const G=async()=>{try{const{data:{user:we}}=await K.auth.getUser();if(we){const{data:fe}=await K.from("profiles").select("id, username, purchased_coins, wins_count").eq("id",we.id).single();n(fe),$((fe==null?void 0:fe.wins_count)||0)}}catch(we){console.error("Error fetching user:",we)}},se=async()=>{var we;try{const fe=await fetch("/api/manageTrollLiveShow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(we=(await K.auth.getSession()).data.session)==null?void 0:we.access_token}`},body:JSON.stringify({action:"get_current_show",userId:i==null?void 0:i.id})}),De=await fe.json();fe.ok&&De.show?(l(!0),m(De.show.current_performer),z(De.show.current_performer_start_time)):(l(!1),m(null),z(null),P(fw))}catch(fe){console.error("Error fetching show status:",fe)}},ie=async()=>{try{const{data:we,error:fe}=await K.from("troll_live_show_waitlist").select("*, user:profiles(id, username, avatar_url)").order("position",{ascending:!0});if(we&&!fe&&(w(we),i)){const De=we.find(je=>je.user_id===i.id);W(!!De)}}catch(we){console.error("Error fetching waitlist:",we)}},ce=async()=>{try{if(!u||!a)return;const{data:we}=await K.from("troll_live_show").select("id").eq("is_active",!0).single();if(!we)return;const{data:fe}=await K.from("troll_live_show_waitlist").select("id, votes_received, votes_against").eq("show_id",we.id).eq("user_id",u.id).eq("status","performing").single();if(fe&&(x({pass:fe.votes_received||0,kick:fe.votes_against||0}),i)){const{data:De}=await K.from("troll_live_show_votes").select("id").eq("show_id",we.id).eq("waitlist_entry_id",fe.id).eq("voter_id",i.id).single();N(!!De)}}catch(we){console.error("Error fetching votes:",we)}},Se=()=>a?"current":null,oe=we=>{we&&we.status==="live"?(l(!0),m(we.current_performer?JSON.parse(we.current_performer):null),z(we.start_time)):(l(!1),m(null),z(null),P(fw))},ve=async()=>{try{const we=b.pass+b.kick;(we>0?b.kick/we*100:0)>50?pe.error(" Performer was kicked by majority vote!"):(pe.success(" Performer completed their session!"),u&&await he(u.id)),x({pass:0,kick:0}),N(!1),await Ze()}catch(we){console.error("Error handling show end:",we)}},he=async we=>{try{await K.from("profiles").update({wins:K.sql`wins + 1`}).eq("id",we),i&&i.id===we&&$(fe=>fe+1)}catch(fe){console.error("Error awarding win:",fe)}},Ze=async()=>{try{if(y.length>0){const we=y[0];await K.from("troll_live_show_waitlist").delete().eq("id",we.id),await K.from("troll_live_show").update({current_performer:JSON.stringify(we.user),start_time:new Date().toISOString(),status:"live"}).eq("status","live"),await K.from("troll_live_show_votes").delete().eq("show_id",Se())}else await Qe()}catch(we){console.error("Error moving to next performer:",we)}},Qe=async()=>{try{await K.from("troll_live_show").update({status:"ended"}).eq("status","live"),l(!1),m(null),z(null),P(fw)}catch(we){console.error("Error ending show:",we)}},me=async()=>{var we;if(!i){pe.error("Please login to join the waitlist");return}if(i.purchased_coins<sm){pe.error(`You need ${sm} paid coins to join. Please purchase coins first.`);return}if(V){pe.error("You are already in the waitlist");return}try{const fe=await fetch("/api/manageTrollLiveShow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(we=(await K.auth.getSession()).data.session)==null?void 0:we.access_token}`},body:JSON.stringify({action:"join_waitlist",userId:i.id})}),De=await fe.json();fe.ok?(pe.success(`Joined waitlist! ${sm} coins deducted.`),G(),ie()):pe.error(De.error||"Failed to join waitlist")}catch(fe){console.error("Error joining waitlist:",fe),pe.error("Failed to join waitlist")}},ye=async()=>{var we;if(!(!i||!V))try{const fe=await fetch("/api/manageTrollLiveShow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(we=(await K.auth.getSession()).data.session)==null?void 0:we.access_token}`},body:JSON.stringify({action:"leave_waitlist",userId:i.id,showId:Se()})}),De=await fe.json();fe.ok?(pe.success("Left waitlist"),ie()):pe.error(De.error||"Failed to leave waitlist")}catch(fe){console.error("Error leaving waitlist:",fe),pe.error("Failed to leave waitlist")}},ge=async we=>{var fe;if(!(!i||!u||T))try{const{data:De}=await K.from("troll_live_show").select("id").eq("is_active",!0).single();if(!De)return;const{data:je}=await K.from("troll_live_show_waitlist").select("id").eq("show_id",De.id).eq("user_id",u.id).eq("status","performing").single();if(!je)return;const _e=await fetch("/api/manageTrollLiveShow",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(fe=(await K.auth.getSession()).data.session)==null?void 0:fe.access_token}`},body:JSON.stringify({action:"cast_vote",userId:i.id,showId:De.id,waitlistEntryId:je.id,voteType:we==="pass"?"keep":"kick"})}),Je=await _e.json();_e.ok?(N(!0),pe.success(`Voted to ${we==="pass"?"PASS":"KICK"}!`),ce()):pe.error(Je.error||"Failed to vote")}catch(De){console.error("Error voting:",De),pe.error("Failed to vote")}},Ee=we=>{const fe=Math.floor(we/6e4),De=Math.floor(we%6e4/1e3);return`${fe}:${De.toString().padStart(2,"0")}`},Oe=we=>{const fe=b.pass+b.kick;return fe===0?0:Math.round(b[we]/fe*100)};return o.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-red-900 via-purple-900 to-indigo-900",children:[o.jsxs("div",{className:"relative bg-gradient-to-b from-red-800 to-red-900 border-b-4 border-red-600",children:[o.jsx("div",{className:"absolute inset-0 bg-red-900 opacity-50",style:{backgroundImage:"linear-gradient(45deg, #7f1d1d 25%, transparent 25%), linear-gradient(-45deg, #7f1d1d 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #7f1d1d 75%), linear-gradient(-45deg, transparent 75%, #7f1d1d 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"}}),o.jsxs("div",{className:"relative container mx-auto px-4 py-8 text-center",children:[o.jsxs("h1",{className:"text-5xl font-bold text-white mb-2 flex items-center justify-center gap-4",children:[o.jsx(dp,{className:"w-12 h-12 text-yellow-400"})," TROLL LIVE SHOW ",o.jsx(dp,{className:"w-12 h-12 text-yellow-400"})]}),o.jsx("p",{className:"text-red-200 text-lg",children:"The ultimate variety show where viewers control the stage!"}),o.jsxs("div",{className:"flex justify-center items-center gap-4 mt-4",children:[o.jsxs(wt,{className:"bg-yellow-500 text-black px-4 py-2",children:[o.jsx(ni,{className:"w-4 h-4 mr-1"}),"Entry: ",sm," coins"]}),o.jsxs(wt,{className:"bg-purple-500 text-white px-4 py-2",children:[o.jsx(uo,{className:"w-4 h-4 mr-1"}),"5 minutes per performer"]}),o.jsxs(wt,{className:"bg-green-500 text-white px-4 py-2",children:[o.jsx(Ow,{className:"w-4 h-4 mr-1"}),"Wins: ",te]})]})]})]}),o.jsx("div",{className:"container mx-auto px-4 py-8",children:o.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[o.jsx("div",{className:"lg:col-span-2",children:o.jsxs(Fe,{className:"bg-black/50 backdrop-blur-sm border-red-500/30 overflow-hidden",children:[o.jsx("div",{className:"relative bg-gradient-to-b from-red-700 to-red-800 p-1",children:o.jsx("div",{className:"bg-black rounded-lg overflow-hidden",children:a&&u?o.jsxs("div",{className:"aspect-video bg-gradient-to-br from-purple-900 to-blue-900 flex items-center justify-center relative",children:[o.jsxs("div",{className:"text-center",children:[o.jsx(Pa,{className:"w-24 h-24 text-white mb-4 mx-auto"}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:u.username}),o.jsx("p",{className:"text-gray-300",children:"Performing Live!"}),o.jsx("div",{className:"absolute top-4 right-4 bg-red-600 text-white px-3 py-1 rounded-full font-bold",children:Ee(O)})]}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-yellow-400 via-red-500 to-yellow-400 animate-pulse"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-blue-400 via-purple-500 to-blue-400 animate-pulse"})]})]}):o.jsx("div",{className:"aspect-video bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(dp,{className:"w-16 h-16 text-yellow-400 mb-4 mx-auto"}),o.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Show Offline"}),o.jsx("p",{className:"text-gray-400",children:"Waiting for the next performer..."})]})})})}),a&&u&&o.jsxs("div",{className:"p-6 bg-black/30",children:[o.jsx("h3",{className:"text-white font-bold mb-4 text-center",children:" VOTE NOW! "}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[o.jsxs("div",{className:"bg-green-500/20 border border-green-500/30 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-green-300 font-bold",children:" PASS"}),o.jsx("span",{className:"text-green-300 font-bold",children:b.pass})]}),o.jsx("div",{className:"w-full bg-green-900 rounded-full h-2",children:o.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${Oe("pass")}%`}})}),o.jsxs("div",{className:"text-green-300 text-sm mt-1",children:[Oe("pass"),"%"]})]}),o.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("span",{className:"text-red-300 font-bold flex items-center gap-1",children:[o.jsx(cW,{className:"w-4 h-4"}),"KICK"]}),o.jsx("span",{className:"text-red-300 font-bold",children:b.kick})]}),o.jsx("div",{className:"w-full bg-red-900 rounded-full h-2",children:o.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${Oe("kick")}%`}})}),o.jsxs("div",{className:"text-red-300 text-sm mt-1",children:[Oe("kick"),"%"]})]})]}),T?o.jsx("div",{className:"text-center text-yellow-300 font-bold",children:" You have voted! Results updating live..."}):o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs(ke,{onClick:()=>ge("pass"),className:"bg-green-600 hover:bg-green-700 text-white font-bold py-4",children:[o.jsx(AH,{className:"w-5 h-5 mr-2"}),"PASS"]}),o.jsxs(ke,{onClick:()=>ge("kick"),className:"bg-red-600 hover:bg-red-700 text-white font-bold py-4",children:[o.jsx(cW,{className:"w-5 h-5 mr-2"}),"KICK"]})]})]})]})}),o.jsxs("div",{className:"space-y-6",children:[o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-purple-500/30",children:o.jsxs("div",{className:"p-6",children:[o.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2",children:[o.jsx(jn,{className:"w-5 h-5"}),"Waitlist (",y.length,")"]}),V?o.jsxs("div",{className:"mb-4",children:[o.jsxs("div",{className:"bg-green-500/20 border border-green-500/30 rounded-lg p-3 mb-2",children:[o.jsx("p",{className:"text-green-300 font-bold",children:" You're in the waitlist!"}),o.jsxs("p",{className:"text-green-200 text-sm",children:["Position: #",y.findIndex(we=>we.user_id===(i==null?void 0:i.id))+1]})]}),o.jsx(ke,{onClick:ye,variant:"outline",className:"w-full border-red-500 text-red-400 hover:bg-red-500/10",children:"Leave Waitlist"})]}):o.jsxs(ke,{onClick:me,disabled:!i||i.purchased_coins<sm,className:"w-full mb-4 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600",children:[o.jsx(ni,{className:"w-4 h-4 mr-2"}),"Join Waitlist (",sm," coins)"]}),o.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[y.map((we,fe)=>{var De;return o.jsxs("div",{className:"flex items-center gap-3 p-2 bg-black/20 rounded-lg",children:[o.jsx("div",{className:"text-yellow-400 font-bold w-6 text-center",children:fe+1}),o.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center",children:o.jsx(Pa,{className:"w-4 h-4 text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-white text-sm font-medium",children:((De=we.user)==null?void 0:De.username)||"Unknown"}),o.jsxs("p",{className:"text-gray-400 text-xs",children:["Joined ",new Date(we.joined_at).toLocaleTimeString()]})]}),we.user_id===(i==null?void 0:i.id)&&o.jsx(wt,{className:"bg-green-500 text-white text-xs",children:"You"})]},we.id)}),y.length===0&&o.jsxs("div",{className:"text-center text-gray-400 py-8",children:[o.jsx(jn,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),o.jsx("p",{children:"No one in waitlist yet"}),o.jsx("p",{className:"text-xs",children:"Be the first to join!"})]})]})]})}),o.jsx(Fe,{className:"bg-black/30 backdrop-blur-sm border-blue-500/30",children:o.jsxs("div",{className:"p-6",children:[o.jsx("h3",{className:"text-white font-bold mb-4",children:" Show Rules"}),o.jsxs("div",{className:"space-y-3 text-sm text-gray-300",children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-yellow-400",children:""}),o.jsx("span",{children:"Each performer gets 5 minutes on stage"})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-yellow-400",children:""}),o.jsx("span",{children:"Viewers vote: PASS (green) or KICK (hammer)"})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-yellow-400",children:""}),o.jsx("span",{children:"Majority KICK vote = immediate removal"})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-yellow-400",children:""}),o.jsx("span",{children:"Completing 5 minutes = WIN (+1 to profile)"})]}),o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-yellow-400",children:""}),o.jsxs("span",{children:["Entry fee: ",sm," paid coins"]})]})]})]})})]})]})})]})}const LG={Home:kP,Store:lY,StreamViewer:yY,ModernStreamViewer:o9,GoLive:kY,ProfileSetup:PY,Profile:jY,Earnings:e9,Trending:UY,Following:FY,Followers:VY,BroadcasterApplication:BY,PublicProfile:WY,Notifications:qY,NotificationsPage:GY,Admin:YY,Messages:XY,TrollerApplication:JY,TrollFamilyApplication:t9,TrollFamilyHub:aSe,FamilyPayouts:r9,Gamble:n9,Trollers:QY,AdminInvite:ZY,KickBanFee:s9,TFam:i9,Rules:a9,TrollWheel:c9,TrollLiveShow:l9};function oSe(i){i.endsWith("/")&&(i=i.slice(0,-1));let n=i.split("/").pop();return n.includes("?")&&(n=n.split("?")[0]),Object.keys(LG).find(l=>l.toLowerCase()===n.toLowerCase())||Object.keys(LG)[0]}function cSe(){const i=Pc(),n=Wn(),a=vn(),{data:l,isLoading:u}=mt({queryKey:["authUser"],queryFn:async()=>{try{const{data:N,error:O}=await K.auth.getUser();return(N==null?void 0:N.user)||null}catch{return null}},staleTime:3e4,retry:1,retryDelay:500,refetchOnWindowFocus:!1}),{data:m}=mt({queryKey:["isUserKicked",l==null?void 0:l.id],queryFn:async()=>{if(!(l!=null&&l.id))return!1;const{data:N,error:O}=await K.from("kicked_users").select("id").eq("user_id",l.id).order("kicked_at",{ascending:!1}).limit(1);return O?!1:N&&N.length>0},enabled:!!(l!=null&&l.id),staleTime:3e4,refetchOnWindowFocus:!1}),{data:y}=mt({queryKey:["isUserBanned",l==null?void 0:l.id],queryFn:async()=>{if(!(l!=null&&l.id))return!1;const{data:N,error:O}=await K.from("profiles").select("is_banned").eq("id",l.id).single();return O?!1:(N==null?void 0:N.is_banned)||!1},enabled:!!(l!=null&&l.id),staleTime:3e4,refetchOnWindowFocus:!1}),w=M.useRef(!1);M.useEffect(()=>{const{data:N}=K.auth.onAuthStateChange((O,P)=>{if(O==="SIGNED_IN"||O==="SIGNED_OUT"||O==="TOKEN_REFRESHED")try{a.invalidateQueries({queryKey:["authUser"]})}catch{}});return()=>{try{N.subscription.unsubscribe()}catch{}}},[a]),M.useEffect(()=>{i.pathname.toLowerCase(),!u&&!l&&!w.current&&K.__isConfigured},[u,l,i.pathname]);const b=oSe(i.pathname),x=!!K.__isConfigured,T=M.useRef(!1);if(M.useEffect(()=>{if(!u&&!l&&x&&T.current){const N=["/login","/auth","/Login","/Auth"],O=i.pathname.toLowerCase();N.some(F=>O===F.toLowerCase())||(console.log(" Redirecting to login - user not authenticated"),n("/login",{replace:!0}))}u||(T.current=!0)},[u,l,i.pathname,n,x]),M.useEffect(()=>{if(!u&&l&&(m||y)){const N=["/paymentrequired","/PaymentRequired","/KickBanFee","/kickbanfee"],O=i.pathname.toLowerCase();N.some(F=>O===F.toLowerCase())||n("/paymentrequired",{replace:!0})}},[u,l,m,y,i.pathname,n]),u)return o.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#0a0a0f] to-[#1a1a2e] flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-purple-300",children:"Loading..."})]})});if(!u&&!l&&x){const N=["/login","/auth","/Login","/Auth"],O=i.pathname.toLowerCase();if(!N.some(F=>O===F.toLowerCase()))return o.jsx(VC,{})}return o.jsx(Nge,{children:o.jsx(Cge,{currentPageName:b,children:o.jsxs(boe,{children:[o.jsx(an,{path:"/Login",element:o.jsx(VC,{})}),o.jsx(an,{path:"/login",element:o.jsx(VC,{})}),o.jsx(an,{path:"/Auth",element:o.jsx(VC,{})}),o.jsx(an,{path:"/",element:o.jsx(kP,{})}),o.jsx(an,{path:"/Home",element:o.jsx(kP,{})}),o.jsx(an,{path:"/Store",element:o.jsx(lY,{})}),o.jsx(an,{path:"/StreamViewer",element:o.jsx(yY,{})}),o.jsx(an,{path:"/stream/:streamId",element:o.jsx(o9,{})}),o.jsx(an,{path:"/GoLive",element:o.jsx(kY,{})}),o.jsx(an,{path:"/ProfileSetup",element:o.jsx(PY,{})}),o.jsx(an,{path:"/Profile",element:o.jsx(jY,{})}),o.jsx(an,{path:"/Trending",element:o.jsx(UY,{})}),o.jsx(an,{path:"/Following",element:o.jsx(FY,{})}),o.jsx(an,{path:"/Followers",element:o.jsx(VY,{})}),o.jsx(an,{path:"/Messages",element:o.jsx(XY,{})}),o.jsx(an,{path:"/BroadcasterApplication",element:o.jsx(BY,{})}),o.jsx(an,{path:"/PublicProfile",element:o.jsx(WY,{})}),o.jsx(an,{path:"/Notifications",element:o.jsx(qY,{})}),o.jsx(an,{path:"/NotificationsPage",element:o.jsx(GY,{})}),o.jsx(an,{path:"/Admin",element:o.jsx(YY,{})}),o.jsx(an,{path:"/Employment",element:o.jsx(Ybe,{})}),o.jsx(an,{path:"/ContactUs",element:o.jsx(Xbe,{})}),o.jsx(an,{path:"/TrollerApplication",element:o.jsx(JY,{})}),o.jsx(an,{path:"/TrollFamilyApplication",element:o.jsx(t9,{})}),o.jsx(an,{path:"/Trollers",element:o.jsx(QY,{})}),o.jsx(an,{path:"/FamilyPayouts",element:o.jsx(r9,{})}),o.jsx(an,{path:"/Gamble",element:o.jsx(n9,{})}),o.jsx(an,{path:"/Earnings",element:o.jsx(e9,{})}),o.jsx(an,{path:"/AdminAI",element:o.jsx(sSe,{})}),o.jsx(an,{path:"/AdminLiveControl",element:o.jsx(nSe,{})}),o.jsx(an,{path:"/AdminInvite",element:o.jsx(ZY,{})}),o.jsx(an,{path:"/PaymentRequired",element:o.jsx(iSe,{})}),o.jsx(an,{path:"/KickBanFee",element:o.jsx(s9,{})}),o.jsx(an,{path:"/TFam",element:o.jsx(i9,{})}),o.jsx(an,{path:"/Rules",element:o.jsx(a9,{})}),o.jsx(an,{path:"/TrollWheel",element:o.jsx(c9,{})}),o.jsx(an,{path:"/TrollLiveShow",element:o.jsx(l9,{})})]})})})}function lSe(){return o.jsx(cSe,{})}window.addEventListener("error",i=>{if(i.error&&i.error.message){const n=i.error.message.toLowerCase();if(n.includes("please log in")||n.includes("authentication")||n.includes("unauthorized"))return console.log(" Suppressed authentication error popup:",i.error.message),i.preventDefault(),!1}});window.addEventListener("unhandledrejection",i=>{if(i.reason&&i.reason.message){const n=i.reason.message.toLowerCase();if(n.includes("please log in")||n.includes("authentication")||n.includes("unauthorized"))return console.log(" Suppressed authentication promise rejection:",i.reason.message),i.preventDefault(),!1}});const dSe=new vae({defaultOptions:{queries:{staleTime:6e4,gcTime:6e5,refetchOnWindowFocus:!1,retry:1,refetchOnReconnect:!1,refetchOnMount:!1},mutations:{retry:0}}});Xie.createRoot(document.getElementById("root")).render(o.jsx(ut.StrictMode,{children:o.jsx(Eae,{client:dSe,children:o.jsx(Koe,{children:o.jsx(lSe,{})})})}));
